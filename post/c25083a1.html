<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"timewait7.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="个人博客系统实现指南我将为你提供完整的个人博客系统实现代码，分为前后端两部分，你可以按照步骤逐步实现。 第一部分：后端实现（Java + Spring Boot）1. 项目搭建pom.xml xml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545">
<meta property="og:type" content="article">
<meta property="og:title" content="Java实践:个人博客">
<meta property="og:url" content="http://timewait7.github.io/post/c25083a1.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="个人博客系统实现指南我将为你提供完整的个人博客系统实现代码，分为前后端两部分，你可以按照步骤逐步实现。 第一部分：后端实现（Java + Spring Boot）1. 项目搭建pom.xml xml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-12-17T11:04:59.000Z">
<meta property="article:modified_time" content="2025-12-17T16:17:24.209Z">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://timewait7.github.io/post/c25083a1.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://timewait7.github.io/post/c25083a1.html","path":"post/c25083a1.html","title":"Java实践:个人博客"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Java实践:个人博客 | Hexo</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Hexo</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-archives"><a href="/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="Searching..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0%E6%8C%87%E5%8D%97"><span class="nav-number">1.</span> <span class="nav-text">个人博客系统实现指南</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%9A%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0%EF%BC%88Java-Spring-Boot%EF%BC%89"><span class="nav-number">1.1.</span> <span class="nav-text">第一部分：后端实现（Java + Spring Boot）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="nav-number">1.1.1.</span> <span class="nav-text">1. 项目搭建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE"><span class="nav-number">1.1.2.</span> <span class="nav-text">2. 应用配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="nav-number">1.1.3.</span> <span class="nav-text">3. 实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-DTO%EF%BC%88%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E5%AF%B9%E8%B1%A1%EF%BC%89"><span class="nav-number">1.1.4.</span> <span class="nav-text">4. DTO（数据传输对象）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-Repository%EF%BC%88%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E5%B1%82%EF%BC%89"><span class="nav-number">1.1.5.</span> <span class="nav-text">5. Repository（数据访问层）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-Service%EF%BC%88%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E5%B1%82%EF%BC%89"><span class="nav-number">1.1.6.</span> <span class="nav-text">6. Service（业务逻辑层）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-number">1.1.7.</span> <span class="nav-text">7. 安全配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-Controller%EF%BC%88%E6%8E%A7%E5%88%B6%E5%99%A8%E5%B1%82%EF%BC%89"><span class="nav-number">1.1.8.</span> <span class="nav-text">8. Controller（控制器层）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="nav-number">1.1.9.</span> <span class="nav-text">9. 异常处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-%E4%B8%BB%E5%BA%94%E7%94%A8%E7%B1%BB"><span class="nav-number">1.1.10.</span> <span class="nav-text">10. 主应用类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%EF%BC%9A%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0%EF%BC%88%E7%BA%AFHTML-CSS-JavaScript%EF%BC%89"><span class="nav-number">1.2.</span> <span class="nav-text">第二部分：前端实现（纯HTML&#x2F;CSS&#x2F;JavaScript）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-number">1.2.1.</span> <span class="nav-text">1. 项目结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%A0%B8%E5%BF%83HTML%E6%96%87%E4%BB%B6"><span class="nav-number">1.2.2.</span> <span class="nav-text">2. 核心HTML文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E4%B8%BB%E6%A0%B7%E5%BC%8F%E6%96%87%E4%BB%B6"><span class="nav-number">1.2.3.</span> <span class="nav-text">3. 主样式文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-JavaScript%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97"><span class="nav-number">1.2.4.</span> <span class="nav-text">4. JavaScript核心模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E9%A1%B5%E9%9D%A2%E6%A8%A1%E5%9D%97"><span class="nav-number">1.2.5.</span> <span class="nav-text">5. 页面模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E7%BB%84%E4%BB%B6"><span class="nav-number">1.2.6.</span> <span class="nav-text">6. 组件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E8%84%9A%E6%9C%AC"><span class="nav-number">1.3.</span> <span class="nav-text">第三部分：数据库脚本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86%EF%BC%9A%E9%83%A8%E7%BD%B2%E5%92%8C%E8%BF%90%E8%A1%8C"><span class="nav-number">1.4.</span> <span class="nav-text">第四部分：部署和运行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="nav-number">1.4.1.</span> <span class="nav-text">1. 环境准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%90%8E%E7%AB%AF%E8%BF%90%E8%A1%8C%E6%AD%A5%E9%AA%A4"><span class="nav-number">1.4.2.</span> <span class="nav-text">2. 后端运行步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%89%8D%E7%AB%AF%E8%BF%90%E8%A1%8C%E6%AD%A5%E9%AA%A4"><span class="nav-number">1.4.3.</span> <span class="nav-text">3. 前端运行步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E8%AE%BF%E9%97%AE%E5%BA%94%E7%94%A8"><span class="nav-number">1.4.4.</span> <span class="nav-text">4. 访问应用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86%EF%BC%9A%E6%89%A9%E5%B1%95%E5%8A%9F%E8%83%BD%E5%BB%BA%E8%AE%AE"><span class="nav-number">1.5.</span> <span class="nav-text">第五部分：扩展功能建议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%8F%AF%E4%BB%A5%E6%B7%BB%E5%8A%A0%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="nav-number">1.5.1.</span> <span class="nav-text">1. 可以添加的功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">1.5.2.</span> <span class="nav-text">2. 性能优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%AE%89%E5%85%A8%E5%A2%9E%E5%BC%BA"><span class="nav-number">1.5.3.</span> <span class="nav-text">3. 安全增强</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%B1%95%E5%AE%9E%E7%8E%B0"><span class="nav-number">2.</span> <span class="nav-text">个人博客系统扩展实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%9A%E5%90%8E%E7%AB%AF%E6%89%A9%E5%B1%95"><span class="nav-number">2.1.</span> <span class="nav-text">第一部分：后端扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%B7%BB%E5%8A%A0%E7%BC%93%E5%AD%98%E6%94%AF%E6%8C%81"><span class="nav-number">2.1.1.</span> <span class="nav-text">1. 添加缓存支持</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%B7%BB%E5%8A%A0%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD"><span class="nav-number">2.1.2.</span> <span class="nav-text">2. 添加全文搜索功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%B7%BB%E5%8A%A0WebSocket%E5%AE%9E%E6%97%B6%E9%80%9A%E7%9F%A5"><span class="nav-number">2.1.3.</span> <span class="nav-text">3. 添加WebSocket实时通知</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%B7%BB%E5%8A%A0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%9C%8D%E5%8A%A1"><span class="nav-number">2.1.4.</span> <span class="nav-text">4. 添加文件上传服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%B7%BB%E5%8A%A0%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1"><span class="nav-number">2.1.5.</span> <span class="nav-text">5. 添加邮件服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E6%B7%BB%E5%8A%A0%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="nav-number">2.1.6.</span> <span class="nav-text">6. 添加定时任务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E6%B7%BB%E5%8A%A0API%E6%96%87%E6%A1%A3"><span class="nav-number">2.1.7.</span> <span class="nav-text">7. 添加API文档</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%EF%BC%9A%E5%89%8D%E7%AB%AF%E6%89%A9%E5%B1%95"><span class="nav-number">2.2.</span> <span class="nav-text">第二部分：前端扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%B7%BB%E5%8A%A0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%A2%9E%E5%BC%BA"><span class="nav-number">2.2.1.</span> <span class="nav-text">1. 添加状态管理增强</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%B7%BB%E5%8A%A0WebSocket%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">2.2.2.</span> <span class="nav-text">2. 添加WebSocket客户端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%B7%BB%E5%8A%A0%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8%E7%BB%84%E4%BB%B6"><span class="nav-number">2.2.3.</span> <span class="nav-text">3. 添加富文本编辑器组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%B7%BB%E5%8A%A0%E5%9B%BE%E8%A1%A8%E5%88%86%E6%9E%90%E7%BB%84%E4%BB%B6"><span class="nav-number">2.2.4.</span> <span class="nav-text">4. 添加图表分析组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%B7%BB%E5%8A%A0SEO%E4%BC%98%E5%8C%96%E7%BB%84%E4%BB%B6"><span class="nav-number">2.2.5.</span> <span class="nav-text">5. 添加SEO优化组件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%EF%BC%9A%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD%E9%A1%B5%E9%9D%A2"><span class="nav-number">2.3.</span> <span class="nav-text">第三部分：高级功能页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0%E9%A1%B5%E9%9D%A2"><span class="nav-number">2.3.1.</span> <span class="nav-text">1. 管理后台页面</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86%EF%BC%9A%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="nav-number">2.4.</span> <span class="nav-text">第四部分：高级功能实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%96%87%E7%AB%A0%E5%AF%BC%E5%87%BA%E4%B8%BAPDF%E5%8A%9F%E8%83%BD"><span class="nav-number">2.4.1.</span> <span class="nav-text">1. 文章导出为PDF功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91%E5%8A%9F%E8%83%BD"><span class="nav-number">2.4.2.</span> <span class="nav-text">2. 文章翻译功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%96%87%E7%AB%A0%E7%9B%B8%E4%BC%BC%E5%BA%A6%E6%8E%A8%E8%8D%90"><span class="nav-number">2.4.3.</span> <span class="nav-text">3. 文章相似度推荐</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86%EF%BC%9A%E9%83%A8%E7%BD%B2%E5%92%8C%E8%BF%90%E7%BB%B4"><span class="nav-number">2.5.</span> <span class="nav-text">第五部分：部署和运维</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Docker%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">2.5.1.</span> <span class="nav-text">1. Docker配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Kubernetes%E9%83%A8%E7%BD%B2%E9%85%8D%E7%BD%AE"><span class="nav-number">2.5.2.</span> <span class="nav-text">2. Kubernetes部署配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%9B%91%E6%8E%A7%E5%92%8C%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE"><span class="nav-number">2.5.3.</span> <span class="nav-text">3. 监控和日志配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%85%AD%E9%83%A8%E5%88%86%EF%BC%9A%E5%AE%89%E5%85%A8%E5%A2%9E%E5%BC%BA"><span class="nav-number">2.6.</span> <span class="nav-text">第六部分：安全增强</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE%E5%A2%9E%E5%BC%BA"><span class="nav-number">2.6.1.</span> <span class="nav-text">1. 安全配置增强</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%99%90%E6%B5%81%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">2.6.2.</span> <span class="nav-text">2. 限流过滤器</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/">
          <span class="site-state-item-count">56</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>

    
        <div class="sidebar-inner sidebar-post-related">
          <div class="animated">
              <div class="links-of-blogroll-title"><i class="fa fa-signs-post fa-fw"></i>
    Related Posts
  </div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <a class="popular-posts-link" href="/post/5dd55120.html" rel="bookmark">
        <time class="popular-posts-time">2025-12-17</time>
        <br>
      Java实践:代办清单
      </a>
    </li>
  </ul>

          </div>
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://timewait7.github.io/post/c25083a1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Java实践:个人博客 | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Java实践:个人博客
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-12-17 19:04:59" itemprop="dateCreated datePublished" datetime="2025-12-17T19:04:59+08:00">2025-12-17</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>21k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>1:15</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="个人博客系统实现指南"><a href="#个人博客系统实现指南" class="headerlink" title="个人博客系统实现指南"></a>个人博客系统实现指南</h1><p>我将为你提供完整的个人博客系统实现代码，分为前后端两部分，你可以按照步骤逐步实现。</p>
<h2 id="第一部分：后端实现（Java-Spring-Boot）"><a href="#第一部分：后端实现（Java-Spring-Boot）" class="headerlink" title="第一部分：后端实现（Java + Spring Boot）"></a>第一部分：后端实现（Java + Spring Boot）</h2><h3 id="1-项目搭建"><a href="#1-项目搭建" class="headerlink" title="1. 项目搭建"></a>1. 项目搭建</h3><p><strong>pom.xml</strong></p>
<p>xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 </span><br><span class="line">         http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.7.0&lt;/version&gt;</span><br><span class="line">        &lt;relativePath/&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;groupId&gt;com.blog&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;blog-system&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0.0&lt;/version&gt;</span><br><span class="line">    &lt;name&gt;Blog System&lt;/name&gt;</span><br><span class="line">    &lt;description&gt;Personal Blog System&lt;/description&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;java.version&gt;11&lt;/java.version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!-- Spring Boot Starters --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- Database --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- JWT --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jjwt-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;0.11.5&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jjwt-impl&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;0.11.5&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;jjwt-jackson&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;0.11.5&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- Utilities --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">            &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- Testing --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;excludes&gt;</span><br><span class="line">                        &lt;exclude&gt;</span><br><span class="line">                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">                        &lt;/exclude&gt;</span><br><span class="line">                    &lt;/excludes&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>



<h3 id="2-应用配置"><a href="#2-应用配置" class="headerlink" title="2. 应用配置"></a>2. 应用配置</h3><p><strong>application.yml</strong></p>
<p>yaml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8080</span><br><span class="line">  servlet:</span><br><span class="line">    context-path: /api</span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    url: jdbc:mysql://localhost:3306/blog_db?useSSL=false&amp;serverTimezone=UTC&amp;characterEncoding=utf8</span><br><span class="line">    username: root</span><br><span class="line">    password: yourpassword</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    hikari:</span><br><span class="line">      maximum-pool-size: 10</span><br><span class="line">      minimum-idle: 5</span><br><span class="line">      idle-timeout: 30000</span><br><span class="line">      connection-timeout: 30000</span><br><span class="line">  </span><br><span class="line">  jpa:</span><br><span class="line">    hibernate:</span><br><span class="line">      ddl-auto: update</span><br><span class="line">    show-sql: true</span><br><span class="line">    properties:</span><br><span class="line">      hibernate:</span><br><span class="line">        dialect: org.hibernate.dialect.MySQL8Dialect</span><br><span class="line">        format_sql: true</span><br><span class="line">        jdbc:</span><br><span class="line">          batch_size: 20</span><br><span class="line">        order_inserts: true</span><br><span class="line">        order_updates: true</span><br><span class="line">    </span><br><span class="line">  servlet:</span><br><span class="line">    multipart:</span><br><span class="line">      max-file-size: 10MB</span><br><span class="line">      max-request-size: 10MB</span><br><span class="line"></span><br><span class="line">app:</span><br><span class="line">  jwt:</span><br><span class="line">    secret: your-secret-key-should-be-at-least-32-characters-long</span><br><span class="line">    expiration-ms: 86400000  # 24小时</span><br><span class="line">  cors:</span><br><span class="line">    allowed-origins: http://localhost:3000,http://127.0.0.1:5500</span><br><span class="line"></span><br><span class="line">logging:</span><br><span class="line">  level:</span><br><span class="line">    com.blog: DEBUG</span><br><span class="line">    org.springframework.security: DEBUG</span><br><span class="line">  file:</span><br><span class="line">    name: logs/blog-system.log</span><br><span class="line">  pattern:</span><br><span class="line">    file: &quot;%d&#123;yyyy-MM-dd HH:mm:ss&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&quot;</span><br></pre></td></tr></table></figure>



<h3 id="3-实体类"><a href="#3-实体类" class="headerlink" title="3. 实体类"></a>3. 实体类</h3><p><strong>User.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.entity;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.NoArgsConstructor;</span><br><span class="line">import lombok.AllArgsConstructor;</span><br><span class="line">import javax.persistence.*;</span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@Entity</span><br><span class="line">@Table(name = &quot;users&quot;, uniqueConstraints = &#123;</span><br><span class="line">    @UniqueConstraint(columnNames = &quot;username&quot;),</span><br><span class="line">    @UniqueConstraint(columnNames = &quot;email&quot;)</span><br><span class="line">&#125;)</span><br><span class="line">@Data</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">public class User &#123;</span><br><span class="line">    @Id</span><br><span class="line">    @GeneratedValue(strategy = GenerationType.IDENTITY)</span><br><span class="line">    private Long id;</span><br><span class="line">    </span><br><span class="line">    @Column(nullable = false, length = 50)</span><br><span class="line">    private String username;</span><br><span class="line">    </span><br><span class="line">    @Column(nullable = false, length = 100)</span><br><span class="line">    private String email;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;password_hash&quot;, nullable = false)</span><br><span class="line">    private String passwordHash;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;display_name&quot;, length = 100)</span><br><span class="line">    private String displayName;</span><br><span class="line">    </span><br><span class="line">    @Column(length = 500)</span><br><span class="line">    private String bio;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;avatar_url&quot;)</span><br><span class="line">    private String avatarUrl;</span><br><span class="line">    </span><br><span class="line">    @Enumerated(EnumType.STRING)</span><br><span class="line">    @Column(nullable = false, length = 20)</span><br><span class="line">    private Role role = Role.USER;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;is_active&quot;)</span><br><span class="line">    private Boolean isActive = true;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;created_at&quot;, nullable = false, updatable = false)</span><br><span class="line">    private LocalDateTime createdAt;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;updated_at&quot;)</span><br><span class="line">    private LocalDateTime updatedAt;</span><br><span class="line">    </span><br><span class="line">    @OneToMany(mappedBy = &quot;author&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)</span><br><span class="line">    private List&lt;Article&gt; articles = new ArrayList&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    @OneToMany(mappedBy = &quot;user&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)</span><br><span class="line">    private List&lt;Comment&gt; comments = new ArrayList&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    @PrePersist</span><br><span class="line">    protected void onCreate() &#123;</span><br><span class="line">        createdAt = LocalDateTime.now();</span><br><span class="line">        updatedAt = LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @PreUpdate</span><br><span class="line">    protected void onUpdate() &#123;</span><br><span class="line">        updatedAt = LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public enum Role &#123;</span><br><span class="line">        USER, ADMIN</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>Article.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.entity;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.NoArgsConstructor;</span><br><span class="line">import lombok.AllArgsConstructor;</span><br><span class="line">import javax.persistence.*;</span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.HashSet;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Set;</span><br><span class="line"></span><br><span class="line">@Entity</span><br><span class="line">@Table(name = &quot;articles&quot;)</span><br><span class="line">@Data</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">public class Article &#123;</span><br><span class="line">    @Id</span><br><span class="line">    @GeneratedValue(strategy = GenerationType.IDENTITY)</span><br><span class="line">    private Long id;</span><br><span class="line">    </span><br><span class="line">    @Column(nullable = false, length = 200)</span><br><span class="line">    private String title;</span><br><span class="line">    </span><br><span class="line">    @Column(columnDefinition = &quot;TEXT&quot;)</span><br><span class="line">    private String summary;</span><br><span class="line">    </span><br><span class="line">    @Column(columnDefinition = &quot;LONGTEXT&quot;, nullable = false)</span><br><span class="line">    private String content;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;cover_image&quot;)</span><br><span class="line">    private String coverImage;</span><br><span class="line">    </span><br><span class="line">    @Enumerated(EnumType.STRING)</span><br><span class="line">    @Column(nullable = false, length = 20)</span><br><span class="line">    private Status status = Status.DRAFT;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;view_count&quot;)</span><br><span class="line">    private Integer viewCount = 0;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;like_count&quot;)</span><br><span class="line">    private Integer likeCount = 0;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;comment_count&quot;)</span><br><span class="line">    private Integer commentCount = 0;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;is_featured&quot;)</span><br><span class="line">    private Boolean isFeatured = false;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;allow_comment&quot;)</span><br><span class="line">    private Boolean allowComment = true;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;created_at&quot;, nullable = false, updatable = false)</span><br><span class="line">    private LocalDateTime createdAt;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;updated_at&quot;)</span><br><span class="line">    private LocalDateTime updatedAt;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;published_at&quot;)</span><br><span class="line">    private LocalDateTime publishedAt;</span><br><span class="line">    </span><br><span class="line">    @ManyToOne(fetch = FetchType.LAZY)</span><br><span class="line">    @JoinColumn(name = &quot;author_id&quot;, nullable = false)</span><br><span class="line">    private User author;</span><br><span class="line">    </span><br><span class="line">    @OneToMany(mappedBy = &quot;article&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)</span><br><span class="line">    @OrderBy(&quot;createdAt DESC&quot;)</span><br><span class="line">    private List&lt;Comment&gt; comments = new ArrayList&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    @ManyToMany(fetch = FetchType.LAZY)</span><br><span class="line">    @JoinTable(</span><br><span class="line">        name = &quot;article_tags&quot;,</span><br><span class="line">        joinColumns = @JoinColumn(name = &quot;article_id&quot;),</span><br><span class="line">        inverseJoinColumns = @JoinColumn(name = &quot;tag_id&quot;)</span><br><span class="line">    )</span><br><span class="line">    private Set&lt;Tag&gt; tags = new HashSet&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    @ManyToOne(fetch = FetchType.LAZY)</span><br><span class="line">    @JoinColumn(name = &quot;category_id&quot;)</span><br><span class="line">    private Category category;</span><br><span class="line">    </span><br><span class="line">    @PrePersist</span><br><span class="line">    protected void onCreate() &#123;</span><br><span class="line">        createdAt = LocalDateTime.now();</span><br><span class="line">        updatedAt = LocalDateTime.now();</span><br><span class="line">        if (status == Status.PUBLISHED) &#123;</span><br><span class="line">            publishedAt = LocalDateTime.now();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @PreUpdate</span><br><span class="line">    protected void onUpdate() &#123;</span><br><span class="line">        updatedAt = LocalDateTime.now();</span><br><span class="line">        if (status == Status.PUBLISHED &amp;&amp; publishedAt == null) &#123;</span><br><span class="line">            publishedAt = LocalDateTime.now();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public enum Status &#123;</span><br><span class="line">        DRAFT, PUBLISHED, ARCHIVED</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>Comment.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.entity;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.NoArgsConstructor;</span><br><span class="line">import lombok.AllArgsConstructor;</span><br><span class="line">import javax.persistence.*;</span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@Entity</span><br><span class="line">@Table(name = &quot;comments&quot;)</span><br><span class="line">@Data</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">public class Comment &#123;</span><br><span class="line">    @Id</span><br><span class="line">    @GeneratedValue(strategy = GenerationType.IDENTITY)</span><br><span class="line">    private Long id;</span><br><span class="line">    </span><br><span class="line">    @Column(columnDefinition = &quot;TEXT&quot;, nullable = false)</span><br><span class="line">    private String content;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;author_name&quot;, length = 100)</span><br><span class="line">    private String authorName;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;author_email&quot;, length = 100)</span><br><span class="line">    private String authorEmail;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;author_ip&quot;, length = 45)</span><br><span class="line">    private String authorIp;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;is_approved&quot;)</span><br><span class="line">    private Boolean isApproved = false;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;like_count&quot;)</span><br><span class="line">    private Integer likeCount = 0;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;created_at&quot;, nullable = false, updatable = false)</span><br><span class="line">    private LocalDateTime createdAt;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;updated_at&quot;)</span><br><span class="line">    private LocalDateTime updatedAt;</span><br><span class="line">    </span><br><span class="line">    @ManyToOne(fetch = FetchType.LAZY)</span><br><span class="line">    @JoinColumn(name = &quot;article_id&quot;, nullable = false)</span><br><span class="line">    private Article article;</span><br><span class="line">    </span><br><span class="line">    @ManyToOne(fetch = FetchType.LAZY)</span><br><span class="line">    @JoinColumn(name = &quot;user_id&quot;)</span><br><span class="line">    private User user;</span><br><span class="line">    </span><br><span class="line">    @ManyToOne(fetch = FetchType.LAZY)</span><br><span class="line">    @JoinColumn(name = &quot;parent_id&quot;)</span><br><span class="line">    private Comment parent;</span><br><span class="line">    </span><br><span class="line">    @OneToMany(mappedBy = &quot;parent&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)</span><br><span class="line">    @OrderBy(&quot;createdAt ASC&quot;)</span><br><span class="line">    private List&lt;Comment&gt; replies = new ArrayList&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    @PrePersist</span><br><span class="line">    protected void onCreate() &#123;</span><br><span class="line">        createdAt = LocalDateTime.now();</span><br><span class="line">        updatedAt = LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @PreUpdate</span><br><span class="line">    protected void onUpdate() &#123;</span><br><span class="line">        updatedAt = LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>Tag.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.entity;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.NoArgsConstructor;</span><br><span class="line">import lombok.AllArgsConstructor;</span><br><span class="line">import javax.persistence.*;</span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.util.HashSet;</span><br><span class="line">import java.util.Set;</span><br><span class="line"></span><br><span class="line">@Entity</span><br><span class="line">@Table(name = &quot;tags&quot;)</span><br><span class="line">@Data</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">public class Tag &#123;</span><br><span class="line">    @Id</span><br><span class="line">    @GeneratedValue(strategy = GenerationType.IDENTITY)</span><br><span class="line">    private Long id;</span><br><span class="line">    </span><br><span class="line">    @Column(nullable = false, unique = true, length = 50)</span><br><span class="line">    private String name;</span><br><span class="line">    </span><br><span class="line">    @Column(length = 100)</span><br><span class="line">    private String slug;</span><br><span class="line">    </span><br><span class="line">    @Column(length = 200)</span><br><span class="line">    private String description;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;created_at&quot;, nullable = false, updatable = false)</span><br><span class="line">    private LocalDateTime createdAt;</span><br><span class="line">    </span><br><span class="line">    @ManyToMany(mappedBy = &quot;tags&quot;, fetch = FetchType.LAZY)</span><br><span class="line">    private Set&lt;Article&gt; articles = new HashSet&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    @PrePersist</span><br><span class="line">    protected void onCreate() &#123;</span><br><span class="line">        createdAt = LocalDateTime.now();</span><br><span class="line">        if (slug == null || slug.isEmpty()) &#123;</span><br><span class="line">            slug = name.toLowerCase().replaceAll(&quot;[^a-z0-9]+&quot;, &quot;-&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>Category.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.entity;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.NoArgsConstructor;</span><br><span class="line">import lombok.AllArgsConstructor;</span><br><span class="line">import javax.persistence.*;</span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@Entity</span><br><span class="line">@Table(name = &quot;categories&quot;)</span><br><span class="line">@Data</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">public class Category &#123;</span><br><span class="line">    @Id</span><br><span class="line">    @GeneratedValue(strategy = GenerationType.IDENTITY)</span><br><span class="line">    private Long id;</span><br><span class="line">    </span><br><span class="line">    @Column(nullable = false, length = 100)</span><br><span class="line">    private String name;</span><br><span class="line">    </span><br><span class="line">    @Column(length = 100)</span><br><span class="line">    private String slug;</span><br><span class="line">    </span><br><span class="line">    @Column(length = 200)</span><br><span class="line">    private String description;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;parent_id&quot;)</span><br><span class="line">    private Long parentId;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;sort_order&quot;)</span><br><span class="line">    private Integer sortOrder = 0;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;article_count&quot;)</span><br><span class="line">    private Integer articleCount = 0;</span><br><span class="line">    </span><br><span class="line">    @Column(name = &quot;created_at&quot;, nullable = false, updatable = false)</span><br><span class="line">    private LocalDateTime createdAt;</span><br><span class="line">    </span><br><span class="line">    @OneToMany(mappedBy = &quot;category&quot;, fetch = FetchType.LAZY)</span><br><span class="line">    private List&lt;Article&gt; articles = new ArrayList&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    @PrePersist</span><br><span class="line">    protected void onCreate() &#123;</span><br><span class="line">        createdAt = LocalDateTime.now();</span><br><span class="line">        if (slug == null || slug.isEmpty()) &#123;</span><br><span class="line">            slug = name.toLowerCase().replaceAll(&quot;[^a-z0-9]+&quot;, &quot;-&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-DTO（数据传输对象）"><a href="#4-DTO（数据传输对象）" class="headerlink" title="4. DTO（数据传输对象）"></a>4. DTO（数据传输对象）</h3><p><strong>AuthRequest.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.dto;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line">import javax.validation.constraints.Email;</span><br><span class="line">import javax.validation.constraints.NotBlank;</span><br><span class="line">import javax.validation.constraints.Size;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">public class AuthRequest &#123;</span><br><span class="line">    @NotBlank(message = &quot;用户名不能为空&quot;)</span><br><span class="line">    @Size(min = 3, max = 50, message = &quot;用户名长度必须在3-50个字符之间&quot;)</span><br><span class="line">    private String username;</span><br><span class="line">    </span><br><span class="line">    @NotBlank(message = &quot;密码不能为空&quot;)</span><br><span class="line">    @Size(min = 6, max = 100, message = &quot;密码长度必须在6-100个字符之间&quot;)</span><br><span class="line">    private String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>RegisterRequest.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.dto;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line">import javax.validation.constraints.Email;</span><br><span class="line">import javax.validation.constraints.NotBlank;</span><br><span class="line">import javax.validation.constraints.Size;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">public class RegisterRequest &#123;</span><br><span class="line">    @NotBlank(message = &quot;用户名不能为空&quot;)</span><br><span class="line">    @Size(min = 3, max = 50, message = &quot;用户名长度必须在3-50个字符之间&quot;)</span><br><span class="line">    private String username;</span><br><span class="line">    </span><br><span class="line">    @NotBlank(message = &quot;邮箱不能为空&quot;)</span><br><span class="line">    @Email(message = &quot;邮箱格式不正确&quot;)</span><br><span class="line">    @Size(max = 100, message = &quot;邮箱长度不能超过100个字符&quot;)</span><br><span class="line">    private String email;</span><br><span class="line">    </span><br><span class="line">    @NotBlank(message = &quot;密码不能为空&quot;)</span><br><span class="line">    @Size(min = 6, max = 100, message = &quot;密码长度必须在6-100个字符之间&quot;)</span><br><span class="line">    private String password;</span><br><span class="line">    </span><br><span class="line">    @NotBlank(message = &quot;确认密码不能为空&quot;)</span><br><span class="line">    private String confirmPassword;</span><br><span class="line">    </span><br><span class="line">    private String displayName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>AuthResponse.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.dto;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.AllArgsConstructor;</span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">public class AuthResponse &#123;</span><br><span class="line">    private String accessToken;</span><br><span class="line">    private String tokenType = &quot;Bearer&quot;;</span><br><span class="line">    private LocalDateTime expiresAt;</span><br><span class="line">    private UserDTO user;</span><br><span class="line">    </span><br><span class="line">    public AuthResponse(String accessToken, LocalDateTime expiresAt, UserDTO user) &#123;</span><br><span class="line">        this.accessToken = accessToken;</span><br><span class="line">        this.expiresAt = expiresAt;</span><br><span class="line">        this.user = user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>ArticleDTO.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.dto;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.NoArgsConstructor;</span><br><span class="line">import lombok.AllArgsConstructor;</span><br><span class="line">import com.blog.entity.Article;</span><br><span class="line">import com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line">import com.fasterxml.jackson.annotation.JsonInclude;</span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.util.HashSet;</span><br><span class="line">import java.util.Set;</span><br><span class="line">import java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@JsonInclude(JsonInclude.Include.NON_NULL)</span><br><span class="line">public class ArticleDTO &#123;</span><br><span class="line">    private Long id;</span><br><span class="line">    private String title;</span><br><span class="line">    private String summary;</span><br><span class="line">    private String content;</span><br><span class="line">    private String coverImage;</span><br><span class="line">    private String status;</span><br><span class="line">    private Integer viewCount;</span><br><span class="line">    private Integer likeCount;</span><br><span class="line">    private Integer commentCount;</span><br><span class="line">    private Boolean isFeatured;</span><br><span class="line">    private Boolean allowComment;</span><br><span class="line">    </span><br><span class="line">    @JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span><br><span class="line">    private LocalDateTime createdAt;</span><br><span class="line">    </span><br><span class="line">    @JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span><br><span class="line">    private LocalDateTime updatedAt;</span><br><span class="line">    </span><br><span class="line">    @JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span><br><span class="line">    private LocalDateTime publishedAt;</span><br><span class="line">    </span><br><span class="line">    private UserSimpleDTO author;</span><br><span class="line">    private CategorySimpleDTO category;</span><br><span class="line">    private Set&lt;TagSimpleDTO&gt; tags = new HashSet&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    // 用于创建和更新</span><br><span class="line">    private Long authorId;</span><br><span class="line">    private Long categoryId;</span><br><span class="line">    private Set&lt;Long&gt; tagIds = new HashSet&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    public static ArticleDTO fromEntity(Article article) &#123;</span><br><span class="line">        ArticleDTO dto = new ArticleDTO();</span><br><span class="line">        dto.setId(article.getId());</span><br><span class="line">        dto.setTitle(article.getTitle());</span><br><span class="line">        dto.setSummary(article.getSummary());</span><br><span class="line">        dto.setContent(article.getContent());</span><br><span class="line">        dto.setCoverImage(article.getCoverImage());</span><br><span class="line">        dto.setStatus(article.getStatus().name());</span><br><span class="line">        dto.setViewCount(article.getViewCount());</span><br><span class="line">        dto.setLikeCount(article.getLikeCount());</span><br><span class="line">        dto.setCommentCount(article.getCommentCount());</span><br><span class="line">        dto.setIsFeatured(article.getIsFeatured());</span><br><span class="line">        dto.setAllowComment(article.getAllowComment());</span><br><span class="line">        dto.setCreatedAt(article.getCreatedAt());</span><br><span class="line">        dto.setUpdatedAt(article.getUpdatedAt());</span><br><span class="line">        dto.setPublishedAt(article.getPublishedAt());</span><br><span class="line">        </span><br><span class="line">        if (article.getAuthor() != null) &#123;</span><br><span class="line">            dto.setAuthor(UserSimpleDTO.fromEntity(article.getAuthor()));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (article.getCategory() != null) &#123;</span><br><span class="line">            dto.setCategory(CategorySimpleDTO.fromEntity(article.getCategory()));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (article.getTags() != null) &#123;</span><br><span class="line">            dto.setTags(article.getTags().stream()</span><br><span class="line">                .map(TagSimpleDTO::fromEntity)</span><br><span class="line">                .collect(Collectors.toSet()));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return dto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">class UserSimpleDTO &#123;</span><br><span class="line">    private Long id;</span><br><span class="line">    private String username;</span><br><span class="line">    private String displayName;</span><br><span class="line">    private String avatarUrl;</span><br><span class="line">    </span><br><span class="line">    public static UserSimpleDTO fromEntity(com.blog.entity.User user) &#123;</span><br><span class="line">        UserSimpleDTO dto = new UserSimpleDTO();</span><br><span class="line">        dto.setId(user.getId());</span><br><span class="line">        dto.setUsername(user.getUsername());</span><br><span class="line">        dto.setDisplayName(user.getDisplayName());</span><br><span class="line">        dto.setAvatarUrl(user.getAvatarUrl());</span><br><span class="line">        return dto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">class CategorySimpleDTO &#123;</span><br><span class="line">    private Long id;</span><br><span class="line">    private String name;</span><br><span class="line">    private String slug;</span><br><span class="line">    </span><br><span class="line">    public static CategorySimpleDTO fromEntity(Category category) &#123;</span><br><span class="line">        CategorySimpleDTO dto = new CategorySimpleDTO();</span><br><span class="line">        dto.setId(category.getId());</span><br><span class="line">        dto.setName(category.getName());</span><br><span class="line">        dto.setSlug(category.getSlug());</span><br><span class="line">        return dto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">class TagSimpleDTO &#123;</span><br><span class="line">    private Long id;</span><br><span class="line">    private String name;</span><br><span class="line">    private String slug;</span><br><span class="line">    </span><br><span class="line">    public static TagSimpleDTO fromEntity(Tag tag) &#123;</span><br><span class="line">        TagSimpleDTO dto = new TagSimpleDTO();</span><br><span class="line">        dto.setId(tag.getId());</span><br><span class="line">        dto.setName(tag.getName());</span><br><span class="line">        dto.setSlug(tag.getSlug());</span><br><span class="line">        return dto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>CommentDTO.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.dto;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line">import lombok.NoArgsConstructor;</span><br><span class="line">import lombok.AllArgsConstructor;</span><br><span class="line">import com.blog.entity.Comment;</span><br><span class="line">import com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line">import com.fasterxml.jackson.annotation.JsonInclude;</span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@JsonInclude(JsonInclude.Include.NON_NULL)</span><br><span class="line">public class CommentDTO &#123;</span><br><span class="line">    private Long id;</span><br><span class="line">    private String content;</span><br><span class="line">    private String authorName;</span><br><span class="line">    private String authorEmail;</span><br><span class="line">    private Boolean isApproved;</span><br><span class="line">    private Integer likeCount;</span><br><span class="line">    </span><br><span class="line">    @JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span><br><span class="line">    private LocalDateTime createdAt;</span><br><span class="line">    </span><br><span class="line">    @JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span><br><span class="line">    private LocalDateTime updatedAt;</span><br><span class="line">    </span><br><span class="line">    private Long articleId;</span><br><span class="line">    private UserSimpleDTO user;</span><br><span class="line">    private Long parentId;</span><br><span class="line">    private List&lt;CommentDTO&gt; replies = new ArrayList&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    // 用于创建</span><br><span class="line">    private String authorIp;</span><br><span class="line">    </span><br><span class="line">    public static CommentDTO fromEntity(Comment comment) &#123;</span><br><span class="line">        CommentDTO dto = new CommentDTO();</span><br><span class="line">        dto.setId(comment.getId());</span><br><span class="line">        dto.setContent(comment.getContent());</span><br><span class="line">        dto.setAuthorName(comment.getAuthorName());</span><br><span class="line">        dto.setAuthorEmail(comment.getAuthorEmail());</span><br><span class="line">        dto.setIsApproved(comment.getIsApproved());</span><br><span class="line">        dto.setLikeCount(comment.getLikeCount());</span><br><span class="line">        dto.setCreatedAt(comment.getCreatedAt());</span><br><span class="line">        dto.setUpdatedAt(comment.getUpdatedAt());</span><br><span class="line">        </span><br><span class="line">        if (comment.getArticle() != null) &#123;</span><br><span class="line">            dto.setArticleId(comment.getArticle().getId());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (comment.getUser() != null) &#123;</span><br><span class="line">            dto.setUser(UserSimpleDTO.fromEntity(comment.getUser()));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (comment.getParent() != null) &#123;</span><br><span class="line">            dto.setParentId(comment.getParent().getId());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (comment.getReplies() != null &amp;&amp; !comment.getReplies().isEmpty()) &#123;</span><br><span class="line">            dto.setReplies(comment.getReplies().stream()</span><br><span class="line">                .map(CommentDTO::fromEntity)</span><br><span class="line">                .collect(Collectors.toList()));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return dto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5-Repository（数据访问层）"><a href="#5-Repository（数据访问层）" class="headerlink" title="5. Repository（数据访问层）"></a>5. Repository（数据访问层）</h3><p><strong>UserRepository.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.repository;</span><br><span class="line"></span><br><span class="line">import com.blog.entity.User;</span><br><span class="line">import org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line">import org.springframework.data.jpa.repository.Query;</span><br><span class="line">import org.springframework.data.repository.query.Param;</span><br><span class="line">import org.springframework.stereotype.Repository;</span><br><span class="line">import java.util.Optional;</span><br><span class="line"></span><br><span class="line">@Repository</span><br><span class="line">public interface UserRepository extends JpaRepository&lt;User, Long&gt; &#123;</span><br><span class="line">    Optional&lt;User&gt; findByUsername(String username);</span><br><span class="line">    Optional&lt;User&gt; findByEmail(String email);</span><br><span class="line">    Boolean existsByUsername(String username);</span><br><span class="line">    Boolean existsByEmail(String email);</span><br><span class="line">    </span><br><span class="line">    @Query(&quot;SELECT u FROM User u WHERE u.username = :username OR u.email = :email&quot;)</span><br><span class="line">    Optional&lt;User&gt; findByUsernameOrEmail(@Param(&quot;username&quot;) String username, </span><br><span class="line">                                         @Param(&quot;email&quot;) String email);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>ArticleRepository.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.repository;</span><br><span class="line"></span><br><span class="line">import com.blog.entity.Article;</span><br><span class="line">import org.springframework.data.domain.Page;</span><br><span class="line">import org.springframework.data.domain.Pageable;</span><br><span class="line">import org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line">import org.springframework.data.jpa.repository.Query;</span><br><span class="line">import org.springframework.data.repository.query.Param;</span><br><span class="line">import org.springframework.stereotype.Repository;</span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@Repository</span><br><span class="line">public interface ArticleRepository extends JpaRepository&lt;Article, Long&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    Page&lt;Article&gt; findByStatus(Article.Status status, Pageable pageable);</span><br><span class="line">    </span><br><span class="line">    Page&lt;Article&gt; findByAuthorIdAndStatus(Long authorId, Article.Status status, Pageable pageable);</span><br><span class="line">    </span><br><span class="line">    Page&lt;Article&gt; findByCategoryIdAndStatus(Long categoryId, Article.Status status, Pageable pageable);</span><br><span class="line">    </span><br><span class="line">    @Query(&quot;SELECT a FROM Article a JOIN a.tags t WHERE t.id = :tagId AND a.status = :status&quot;)</span><br><span class="line">    Page&lt;Article&gt; findByTagIdAndStatus(@Param(&quot;tagId&quot;) Long tagId, </span><br><span class="line">                                       @Param(&quot;status&quot;) Article.Status status, </span><br><span class="line">                                       Pageable pageable);</span><br><span class="line">    </span><br><span class="line">    @Query(&quot;SELECT a FROM Article a WHERE a.status = &#x27;PUBLISHED&#x27; AND &quot; +</span><br><span class="line">           &quot;(LOWER(a.title) LIKE LOWER(CONCAT(&#x27;%&#x27;, :keyword, &#x27;%&#x27;)) OR &quot; +</span><br><span class="line">           &quot;LOWER(a.summary) LIKE LOWER(CONCAT(&#x27;%&#x27;, :keyword, &#x27;%&#x27;)) OR &quot; +</span><br><span class="line">           &quot;LOWER(a.content) LIKE LOWER(CONCAT(&#x27;%&#x27;, :keyword, &#x27;%&#x27;)))&quot;)</span><br><span class="line">    Page&lt;Article&gt; searchPublished(@Param(&quot;keyword&quot;) String keyword, Pageable pageable);</span><br><span class="line">    </span><br><span class="line">    @Query(&quot;SELECT a FROM Article a WHERE a.status = &#x27;PUBLISHED&#x27; AND a.isFeatured = true&quot;)</span><br><span class="line">    Page&lt;Article&gt; findFeaturedArticles(Pageable pageable);</span><br><span class="line">    </span><br><span class="line">    @Query(&quot;SELECT a FROM Article a WHERE a.status = &#x27;PUBLISHED&#x27; &quot; +</span><br><span class="line">           &quot;AND a.publishedAt &gt;= :startDate AND a.publishedAt &lt;= :endDate&quot;)</span><br><span class="line">    Page&lt;Article&gt; findPublishedBetween(@Param(&quot;startDate&quot;) LocalDateTime startDate,</span><br><span class="line">                                       @Param(&quot;endDate&quot;) LocalDateTime endDate,</span><br><span class="line">                                       Pageable pageable);</span><br><span class="line">    </span><br><span class="line">    @Query(&quot;SELECT YEAR(a.publishedAt) as year, MONTH(a.publishedAt) as month, COUNT(a) as count &quot; +</span><br><span class="line">           &quot;FROM Article a WHERE a.status = &#x27;PUBLISHED&#x27; &quot; +</span><br><span class="line">           &quot;GROUP BY YEAR(a.publishedAt), MONTH(a.publishedAt) &quot; +</span><br><span class="line">           &quot;ORDER BY year DESC, month DESC&quot;)</span><br><span class="line">    List&lt;Object[]&gt; findArchiveStatistics();</span><br><span class="line">    </span><br><span class="line">    @Query(&quot;SELECT COUNT(a) FROM Article a WHERE a.status = &#x27;PUBLISHED&#x27;&quot;)</span><br><span class="line">    Long countPublishedArticles();</span><br><span class="line">    </span><br><span class="line">    @Query(&quot;SELECT a FROM Article a WHERE a.status = &#x27;PUBLISHED&#x27; ORDER BY a.viewCount DESC&quot;)</span><br><span class="line">    Page&lt;Article&gt; findPopularArticles(Pageable pageable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>CommentRepository.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.repository;</span><br><span class="line"></span><br><span class="line">import com.blog.entity.Comment;</span><br><span class="line">import org.springframework.data.domain.Page;</span><br><span class="line">import org.springframework.data.domain.Pageable;</span><br><span class="line">import org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line">import org.springframework.data.jpa.repository.Query;</span><br><span class="line">import org.springframework.data.repository.query.Param;</span><br><span class="line">import org.springframework.stereotype.Repository;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@Repository</span><br><span class="line">public interface CommentRepository extends JpaRepository&lt;Comment, Long&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    Page&lt;Comment&gt; findByArticleIdAndIsApprovedTrue(Long articleId, Pageable pageable);</span><br><span class="line">    </span><br><span class="line">    Page&lt;Comment&gt; findByArticleId(Long articleId, Pageable pageable);</span><br><span class="line">    </span><br><span class="line">    @Query(&quot;SELECT c FROM Comment c WHERE c.parent IS NULL AND c.article.id = :articleId AND c.isApproved = true&quot;)</span><br><span class="line">    Page&lt;Comment&gt; findRootCommentsByArticleId(@Param(&quot;articleId&quot;) Long articleId, Pageable pageable);</span><br><span class="line">    </span><br><span class="line">    @Query(&quot;SELECT c FROM Comment c WHERE c.parent.id = :parentId AND c.isApproved = true&quot;)</span><br><span class="line">    List&lt;Comment&gt; findRepliesByParentId(@Param(&quot;parentId&quot;) Long parentId);</span><br><span class="line">    </span><br><span class="line">    Long countByArticleIdAndIsApprovedTrue(Long articleId);</span><br><span class="line">    </span><br><span class="line">    @Query(&quot;SELECT c FROM Comment c WHERE c.isApproved = false ORDER BY c.createdAt DESC&quot;)</span><br><span class="line">    Page&lt;Comment&gt; findUnapprovedComments(Pageable pageable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="6-Service（业务逻辑层）"><a href="#6-Service（业务逻辑层）" class="headerlink" title="6. Service（业务逻辑层）"></a>6. Service（业务逻辑层）</h3><p><strong>UserService.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.service;</span><br><span class="line"></span><br><span class="line">import com.blog.dto.RegisterRequest;</span><br><span class="line">import com.blog.dto.UserDTO;</span><br><span class="line">import com.blog.entity.User;</span><br><span class="line">import com.blog.exception.ResourceNotFoundException;</span><br><span class="line">import com.blog.exception.BusinessException;</span><br><span class="line">import com.blog.repository.UserRepository;</span><br><span class="line">import lombok.RequiredArgsConstructor;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import org.springframework.transaction.annotation.Transactional;</span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.util.Optional;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">@RequiredArgsConstructor</span><br><span class="line">@Slf4j</span><br><span class="line">public class UserService &#123;</span><br><span class="line">    </span><br><span class="line">    private final UserRepository userRepository;</span><br><span class="line">    private final PasswordEncoder passwordEncoder;</span><br><span class="line">    </span><br><span class="line">    @Transactional(readOnly = true)</span><br><span class="line">    public Optional&lt;User&gt; findByUsername(String username) &#123;</span><br><span class="line">        return userRepository.findByUsername(username);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Transactional(readOnly = true)</span><br><span class="line">    public Optional&lt;User&gt; findByEmail(String email) &#123;</span><br><span class="line">        return userRepository.findByEmail(email);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Transactional(readOnly = true)</span><br><span class="line">    public UserDTO getUserById(Long id) &#123;</span><br><span class="line">        User user = userRepository.findById(id)</span><br><span class="line">            .orElseThrow(() -&gt; new ResourceNotFoundException(&quot;用户不存在，ID: &quot; + id));</span><br><span class="line">        return convertToDTO(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Transactional</span><br><span class="line">    public UserDTO registerUser(RegisterRequest request) &#123;</span><br><span class="line">        // 验证用户名是否已存在</span><br><span class="line">        if (userRepository.existsByUsername(request.getUsername())) &#123;</span><br><span class="line">            throw new BusinessException(&quot;用户名已存在&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 验证邮箱是否已存在</span><br><span class="line">        if (userRepository.existsByEmail(request.getEmail())) &#123;</span><br><span class="line">            throw new BusinessException(&quot;邮箱已被注册&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 验证密码确认</span><br><span class="line">        if (!request.getPassword().equals(request.getConfirmPassword())) &#123;</span><br><span class="line">            throw new BusinessException(&quot;两次输入的密码不一致&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 创建新用户</span><br><span class="line">        User user = new User();</span><br><span class="line">        user.setUsername(request.getUsername());</span><br><span class="line">        user.setEmail(request.getEmail());</span><br><span class="line">        user.setPasswordHash(passwordEncoder.encode(request.getPassword()));</span><br><span class="line">        user.setDisplayName(request.getDisplayName() != null ? </span><br><span class="line">                          request.getDisplayName() : request.getUsername());</span><br><span class="line">        user.setRole(User.Role.USER);</span><br><span class="line">        user.setIsActive(true);</span><br><span class="line">        </span><br><span class="line">        User savedUser = userRepository.save(user);</span><br><span class="line">        log.info(&quot;用户注册成功: &#123;&#125;&quot;, savedUser.getUsername());</span><br><span class="line">        </span><br><span class="line">        return convertToDTO(savedUser);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Transactional</span><br><span class="line">    public UserDTO updateUserProfile(Long userId, UserDTO userDTO) &#123;</span><br><span class="line">        User user = userRepository.findById(userId)</span><br><span class="line">            .orElseThrow(() -&gt; new ResourceNotFoundException(&quot;用户不存在，ID: &quot; + userId));</span><br><span class="line">        </span><br><span class="line">        // 更新允许修改的字段</span><br><span class="line">        if (userDTO.getDisplayName() != null) &#123;</span><br><span class="line">            user.setDisplayName(userDTO.getDisplayName());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (userDTO.getBio() != null) &#123;</span><br><span class="line">            user.setBio(userDTO.getBio());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (userDTO.getAvatarUrl() != null) &#123;</span><br><span class="line">            user.setAvatarUrl(userDTO.getAvatarUrl());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        userRepository.save(user);</span><br><span class="line">        log.info(&quot;用户资料已更新: &#123;&#125;&quot;, user.getUsername());</span><br><span class="line">        </span><br><span class="line">        return convertToDTO(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Transactional</span><br><span class="line">    public void changePassword(Long userId, String oldPassword, String newPassword) &#123;</span><br><span class="line">        User user = userRepository.findById(userId)</span><br><span class="line">            .orElseThrow(() -&gt; new ResourceNotFoundException(&quot;用户不存在，ID: &quot; + userId));</span><br><span class="line">        </span><br><span class="line">        // 验证旧密码</span><br><span class="line">        if (!passwordEncoder.matches(oldPassword, user.getPasswordHash())) &#123;</span><br><span class="line">            throw new BusinessException(&quot;旧密码不正确&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 更新密码</span><br><span class="line">        user.setPasswordHash(passwordEncoder.encode(newPassword));</span><br><span class="line">        userRepository.save(user);</span><br><span class="line">        log.info(&quot;用户密码已修改: &#123;&#125;&quot;, user.getUsername());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Transactional</span><br><span class="line">    public void deactivateUser(Long userId) &#123;</span><br><span class="line">        User user = userRepository.findById(userId)</span><br><span class="line">            .orElseThrow(() -&gt; new ResourceNotFoundException(&quot;用户不存在，ID: &quot; + userId));</span><br><span class="line">        </span><br><span class="line">        user.setIsActive(false);</span><br><span class="line">        userRepository.save(user);</span><br><span class="line">        log.info(&quot;用户已停用: &#123;&#125;&quot;, user.getUsername());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private UserDTO convertToDTO(User user) &#123;</span><br><span class="line">        UserDTO dto = new UserDTO();</span><br><span class="line">        dto.setId(user.getId());</span><br><span class="line">        dto.setUsername(user.getUsername());</span><br><span class="line">        dto.setEmail(user.getEmail());</span><br><span class="line">        dto.setDisplayName(user.getDisplayName());</span><br><span class="line">        dto.setBio(user.getBio());</span><br><span class="line">        dto.setAvatarUrl(user.getAvatarUrl());</span><br><span class="line">        dto.setRole(user.getRole().name());</span><br><span class="line">        dto.setIsActive(user.getIsActive());</span><br><span class="line">        dto.setCreatedAt(user.getCreatedAt());</span><br><span class="line">        dto.setUpdatedAt(user.getUpdatedAt());</span><br><span class="line">        return dto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>ArticleService.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.service;</span><br><span class="line"></span><br><span class="line">import com.blog.dto.ArticleDTO;</span><br><span class="line">import com.blog.entity.Article;</span><br><span class="line">import com.blog.entity.Category;</span><br><span class="line">import com.blog.entity.Tag;</span><br><span class="line">import com.blog.entity.User;</span><br><span class="line">import com.blog.exception.ResourceNotFoundException;</span><br><span class="line">import com.blog.exception.BusinessException;</span><br><span class="line">import com.blog.repository.ArticleRepository;</span><br><span class="line">import com.blog.repository.CategoryRepository;</span><br><span class="line">import com.blog.repository.TagRepository;</span><br><span class="line">import com.blog.repository.UserRepository;</span><br><span class="line">import lombok.RequiredArgsConstructor;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.data.domain.Page;</span><br><span class="line">import org.springframework.data.domain.Pageable;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import org.springframework.transaction.annotation.Transactional;</span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.util.HashSet;</span><br><span class="line">import java.util.Set;</span><br><span class="line">import java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">@RequiredArgsConstructor</span><br><span class="line">@Slf4j</span><br><span class="line">public class ArticleService &#123;</span><br><span class="line">    </span><br><span class="line">    private final ArticleRepository articleRepository;</span><br><span class="line">    private final UserRepository userRepository;</span><br><span class="line">    private final CategoryRepository categoryRepository;</span><br><span class="line">    private final TagRepository tagRepository;</span><br><span class="line">    </span><br><span class="line">    @Transactional(readOnly = true)</span><br><span class="line">    public Page&lt;ArticleDTO&gt; getPublishedArticles(Pageable pageable) &#123;</span><br><span class="line">        return articleRepository.findByStatus(Article.Status.PUBLISHED, pageable)</span><br><span class="line">            .map(ArticleDTO::fromEntity);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Transactional(readOnly = true)</span><br><span class="line">    public Page&lt;ArticleDTO&gt; searchPublishedArticles(String keyword, Pageable pageable) &#123;</span><br><span class="line">        return articleRepository.searchPublished(keyword, pageable)</span><br><span class="line">            .map(ArticleDTO::fromEntity);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Transactional(readOnly = true)</span><br><span class="line">    public ArticleDTO getArticleById(Long id) &#123;</span><br><span class="line">        Article article = articleRepository.findById(id)</span><br><span class="line">            .orElseThrow(() -&gt; new ResourceNotFoundException(&quot;文章不存在，ID: &quot; + id));</span><br><span class="line">        </span><br><span class="line">        // 增加阅读计数</span><br><span class="line">        article.setViewCount(article.getViewCount() + 1);</span><br><span class="line">        articleRepository.save(article);</span><br><span class="line">        </span><br><span class="line">        return ArticleDTO.fromEntity(article);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Transactional(readOnly = true)</span><br><span class="line">    public Page&lt;ArticleDTO&gt; getArticlesByCategory(Long categoryId, Pageable pageable) &#123;</span><br><span class="line">        return articleRepository.findByCategoryIdAndStatus(categoryId, Article.Status.PUBLISHED, pageable)</span><br><span class="line">            .map(ArticleDTO::fromEntity);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Transactional(readOnly = true)</span><br><span class="line">    public Page&lt;ArticleDTO&gt; getArticlesByTag(Long tagId, Pageable pageable) &#123;</span><br><span class="line">        return articleRepository.findByTagIdAndStatus(tagId, Article.Status.PUBLISHED, pageable)</span><br><span class="line">            .map(ArticleDTO::fromEntity);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Transactional(readOnly = true)</span><br><span class="line">    public Page&lt;ArticleDTO&gt; getArticlesByAuthor(Long authorId, Pageable pageable) &#123;</span><br><span class="line">        return articleRepository.findByAuthorIdAndStatus(authorId, Article.Status.PUBLISHED, pageable)</span><br><span class="line">            .map(ArticleDTO::fromEntity);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Transactional</span><br><span class="line">    public ArticleDTO createArticle(ArticleDTO articleDTO, Long authorId) &#123;</span><br><span class="line">        User author = userRepository.findById(authorId)</span><br><span class="line">            .orElseThrow(() -&gt; new ResourceNotFoundException(&quot;作者不存在，ID: &quot; + authorId));</span><br><span class="line">        </span><br><span class="line">        Article article = new Article();</span><br><span class="line">        article.setTitle(articleDTO.getTitle());</span><br><span class="line">        article.setSummary(articleDTO.getSummary());</span><br><span class="line">        article.setContent(articleDTO.getContent());</span><br><span class="line">        article.setCoverImage(articleDTO.getCoverImage());</span><br><span class="line">        article.setStatus(Article.Status.valueOf(articleDTO.getStatus()));</span><br><span class="line">        article.setIsFeatured(articleDTO.getIsFeatured());</span><br><span class="line">        article.setAllowComment(articleDTO.getAllowComment());</span><br><span class="line">        article.setAuthor(author);</span><br><span class="line">        </span><br><span class="line">        // 设置分类</span><br><span class="line">        if (articleDTO.getCategoryId() != null) &#123;</span><br><span class="line">            Category category = categoryRepository.findById(articleDTO.getCategoryId())</span><br><span class="line">                .orElseThrow(() -&gt; new ResourceNotFoundException(&quot;分类不存在，ID: &quot; + articleDTO.getCategoryId()));</span><br><span class="line">            article.setCategory(category);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 设置标签</span><br><span class="line">        if (articleDTO.getTagIds() != null &amp;&amp; !articleDTO.getTagIds().isEmpty()) &#123;</span><br><span class="line">            Set&lt;Tag&gt; tags = new HashSet&lt;&gt;(tagRepository.findAllById(articleDTO.getTagIds()));</span><br><span class="line">            article.setTags(tags);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Article savedArticle = articleRepository.save(article);</span><br><span class="line">        log.info(&quot;文章创建成功: &#123;&#125;&quot;, savedArticle.getTitle());</span><br><span class="line">        </span><br><span class="line">        return ArticleDTO.fromEntity(savedArticle);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Transactional</span><br><span class="line">    public ArticleDTO updateArticle(Long id, ArticleDTO articleDTO, Long userId) &#123;</span><br><span class="line">        Article article = articleRepository.findById(id)</span><br><span class="line">            .orElseThrow(() -&gt; new ResourceNotFoundException(&quot;文章不存在，ID: &quot; + id));</span><br><span class="line">        </span><br><span class="line">        // 检查权限：只有作者或管理员可以修改</span><br><span class="line">        if (!article.getAuthor().getId().equals(userId)) &#123;</span><br><span class="line">            throw new BusinessException(&quot;无权修改此文章&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 更新文章信息</span><br><span class="line">        if (articleDTO.getTitle() != null) &#123;</span><br><span class="line">            article.setTitle(articleDTO.getTitle());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (articleDTO.getSummary() != null) &#123;</span><br><span class="line">            article.setSummary(articleDTO.getSummary());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (articleDTO.getContent() != null) &#123;</span><br><span class="line">            article.setContent(articleDTO.getContent());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (articleDTO.getCoverImage() != null) &#123;</span><br><span class="line">            article.setCoverImage(articleDTO.getCoverImage());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (articleDTO.getStatus() != null) &#123;</span><br><span class="line">            article.setStatus(Article.Status.valueOf(articleDTO.getStatus()));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (articleDTO.getIsFeatured() != null) &#123;</span><br><span class="line">            article.setIsFeatured(articleDTO.getIsFeatured());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (articleDTO.getAllowComment() != null) &#123;</span><br><span class="line">            article.setAllowComment(articleDTO.getAllowComment());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 更新分类</span><br><span class="line">        if (articleDTO.getCategoryId() != null) &#123;</span><br><span class="line">            Category category = categoryRepository.findById(articleDTO.getCategoryId())</span><br><span class="line">                .orElseThrow(() -&gt; new ResourceNotFoundException(&quot;分类不存在，ID: &quot; + articleDTO.getCategoryId()));</span><br><span class="line">            article.setCategory(category);</span><br><span class="line">        &#125; else if (articleDTO.getCategoryId() == null &amp;&amp; article.getCategory() != null) &#123;</span><br><span class="line">            // 清除分类</span><br><span class="line">            article.setCategory(null);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 更新标签</span><br><span class="line">        if (articleDTO.getTagIds() != null) &#123;</span><br><span class="line">            Set&lt;Tag&gt; tags = new HashSet&lt;&gt;(tagRepository.findAllById(articleDTO.getTagIds()));</span><br><span class="line">            article.setTags(tags);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Article updatedArticle = articleRepository.save(article);</span><br><span class="line">        log.info(&quot;文章更新成功: &#123;&#125;&quot;, updatedArticle.getTitle());</span><br><span class="line">        </span><br><span class="line">        return ArticleDTO.fromEntity(updatedArticle);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Transactional</span><br><span class="line">    public void deleteArticle(Long id, Long userId) &#123;</span><br><span class="line">        Article article = articleRepository.findById(id)</span><br><span class="line">            .orElseThrow(() -&gt; new ResourceNotFoundException(&quot;文章不存在，ID: &quot; + id));</span><br><span class="line">        </span><br><span class="line">        // 检查权限：只有作者或管理员可以删除</span><br><span class="line">        if (!article.getAuthor().getId().equals(userId)) &#123;</span><br><span class="line">            throw new BusinessException(&quot;无权删除此文章&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        articleRepository.delete(article);</span><br><span class="line">        log.info(&quot;文章删除成功: &#123;&#125;&quot;, article.getTitle());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Transactional</span><br><span class="line">    public void likeArticle(Long articleId) &#123;</span><br><span class="line">        Article article = articleRepository.findById(articleId)</span><br><span class="line">            .orElseThrow(() -&gt; new ResourceNotFoundException(&quot;文章不存在，ID: &quot; + articleId));</span><br><span class="line">        </span><br><span class="line">        article.setLikeCount(article.getLikeCount() + 1);</span><br><span class="line">        articleRepository.save(article);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Transactional(readOnly = true)</span><br><span class="line">    public Page&lt;ArticleDTO&gt; getFeaturedArticles(Pageable pageable) &#123;</span><br><span class="line">        return articleRepository.findFeaturedArticles(pageable)</span><br><span class="line">            .map(ArticleDTO::fromEntity);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Transactional(readOnly = true)</span><br><span class="line">    public Page&lt;ArticleDTO&gt; getPopularArticles(Pageable pageable) &#123;</span><br><span class="line">        return articleRepository.findPopularArticles(pageable)</span><br><span class="line">            .map(ArticleDTO::fromEntity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="7-安全配置"><a href="#7-安全配置" class="headerlink" title="7. 安全配置"></a>7. 安全配置</h3><p><strong>JwtTokenProvider.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.security;</span><br><span class="line"></span><br><span class="line">import io.jsonwebtoken.*;</span><br><span class="line">import io.jsonwebtoken.security.Keys;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line">import org.springframework.security.core.Authentication;</span><br><span class="line">import org.springframework.security.core.GrantedAuthority;</span><br><span class="line">import org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class="line">import org.springframework.security.core.userdetails.User;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import javax.crypto.SecretKey;</span><br><span class="line">import java.nio.charset.StandardCharsets;</span><br><span class="line">import java.util.Arrays;</span><br><span class="line">import java.util.Collection;</span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">@Slf4j</span><br><span class="line">public class JwtTokenProvider &#123;</span><br><span class="line">    </span><br><span class="line">    @Value(&quot;$&#123;app.jwt.secret&#125;&quot;)</span><br><span class="line">    private String jwtSecret;</span><br><span class="line">    </span><br><span class="line">    @Value(&quot;$&#123;app.jwt.expiration-ms&#125;&quot;)</span><br><span class="line">    private long jwtExpirationMs;</span><br><span class="line">    </span><br><span class="line">    private SecretKey getSigningKey() &#123;</span><br><span class="line">        return Keys.hmacShaKeyFor(jwtSecret.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public String generateToken(Authentication authentication) &#123;</span><br><span class="line">        String authorities = authentication.getAuthorities().stream()</span><br><span class="line">            .map(GrantedAuthority::getAuthority)</span><br><span class="line">            .collect(Collectors.joining(&quot;,&quot;));</span><br><span class="line">        </span><br><span class="line">        long now = System.currentTimeMillis();</span><br><span class="line">        Date expiryDate = new Date(now + jwtExpirationMs);</span><br><span class="line">        </span><br><span class="line">        return Jwts.builder()</span><br><span class="line">            .setSubject(authentication.getName())</span><br><span class="line">            .claim(&quot;auth&quot;, authorities)</span><br><span class="line">            .setIssuedAt(new Date(now))</span><br><span class="line">            .setExpiration(expiryDate)</span><br><span class="line">            .signWith(getSigningKey(), SignatureAlgorithm.HS512)</span><br><span class="line">            .compact();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public Authentication getAuthentication(String token) &#123;</span><br><span class="line">        Claims claims = Jwts.parserBuilder()</span><br><span class="line">            .setSigningKey(getSigningKey())</span><br><span class="line">            .build()</span><br><span class="line">            .parseClaimsJws(token)</span><br><span class="line">            .getBody();</span><br><span class="line">        </span><br><span class="line">        Collection&lt;? extends GrantedAuthority&gt; authorities =</span><br><span class="line">            Arrays.stream(claims.get(&quot;auth&quot;).toString().split(&quot;,&quot;))</span><br><span class="line">                .map(SimpleGrantedAuthority::new)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        User principal = new User(claims.getSubject(), &quot;&quot;, authorities);</span><br><span class="line">        </span><br><span class="line">        return new UsernamePasswordAuthenticationToken(principal, token, authorities);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public boolean validateToken(String authToken) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Jwts.parserBuilder()</span><br><span class="line">                .setSigningKey(getSigningKey())</span><br><span class="line">                .build()</span><br><span class="line">                .parseClaimsJws(authToken);</span><br><span class="line">            return true;</span><br><span class="line">        &#125; catch (SecurityException ex) &#123;</span><br><span class="line">            log.error(&quot;无效的JWT签名: &#123;&#125;&quot;, ex.getMessage());</span><br><span class="line">        &#125; catch (MalformedJwtException ex) &#123;</span><br><span class="line">            log.error(&quot;无效的JWT令牌: &#123;&#125;&quot;, ex.getMessage());</span><br><span class="line">        &#125; catch (ExpiredJwtException ex) &#123;</span><br><span class="line">            log.error(&quot;JWT令牌已过期: &#123;&#125;&quot;, ex.getMessage());</span><br><span class="line">        &#125; catch (UnsupportedJwtException ex) &#123;</span><br><span class="line">            log.error(&quot;不支持的JWT令牌: &#123;&#125;&quot;, ex.getMessage());</span><br><span class="line">        &#125; catch (IllegalArgumentException ex) &#123;</span><br><span class="line">            log.error(&quot;JWT claims string is empty: &#123;&#125;&quot;, ex.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public String getUsernameFromToken(String token) &#123;</span><br><span class="line">        return Jwts.parserBuilder()</span><br><span class="line">            .setSigningKey(getSigningKey())</span><br><span class="line">            .build()</span><br><span class="line">            .parseClaimsJws(token)</span><br><span class="line">            .getBody()</span><br><span class="line">            .getSubject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>JwtAuthenticationFilter.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.security;</span><br><span class="line"></span><br><span class="line">import lombok.RequiredArgsConstructor;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line">import org.springframework.security.core.Authentication;</span><br><span class="line">import org.springframework.security.web.authentication.WebAuthenticationDetailsSource;</span><br><span class="line">import org.springframework.util.StringUtils;</span><br><span class="line">import org.springframework.web.filter.OncePerRequestFilter;</span><br><span class="line">import javax.servlet.FilterChain;</span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line"></span><br><span class="line">@RequiredArgsConstructor</span><br><span class="line">@Slf4j</span><br><span class="line">public class JwtAuthenticationFilter extends OncePerRequestFilter &#123;</span><br><span class="line">    </span><br><span class="line">    private final JwtTokenProvider tokenProvider;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    protected void doFilterInternal(HttpServletRequest request, </span><br><span class="line">                                   HttpServletResponse response, </span><br><span class="line">                                   FilterChain filterChain) </span><br><span class="line">            throws ServletException, IOException &#123;</span><br><span class="line">        </span><br><span class="line">        try &#123;</span><br><span class="line">            String jwt = getJwtFromRequest(request);</span><br><span class="line">            </span><br><span class="line">            if (StringUtils.hasText(jwt) &amp;&amp; tokenProvider.validateToken(jwt)) &#123;</span><br><span class="line">                Authentication authentication = tokenProvider.getAuthentication(jwt);</span><br><span class="line">                SecurityContextHolder.getContext().setAuthentication(authentication);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception ex) &#123;</span><br><span class="line">            log.error(&quot;无法设置用户认证&quot;, ex);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        filterChain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private String getJwtFromRequest(HttpServletRequest request) &#123;</span><br><span class="line">        String bearerToken = request.getHeader(&quot;Authorization&quot;);</span><br><span class="line">        if (StringUtils.hasText(bearerToken) &amp;&amp; bearerToken.startsWith(&quot;Bearer &quot;)) &#123;</span><br><span class="line">            return bearerToken.substring(7);</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>SecurityConfig.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.config;</span><br><span class="line"></span><br><span class="line">import com.blog.security.JwtAuthenticationFilter;</span><br><span class="line">import com.blog.service.UserDetailsServiceImpl;</span><br><span class="line">import lombok.RequiredArgsConstructor;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.security.authentication.AuthenticationManager;</span><br><span class="line">import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;</span><br><span class="line">import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;</span><br><span class="line">import org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line">import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line">import org.springframework.security.config.http.SessionCreationPolicy;</span><br><span class="line">import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class="line">import org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line">import org.springframework.security.web.SecurityFilterChain;</span><br><span class="line">import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;</span><br><span class="line">import org.springframework.web.cors.CorsConfiguration;</span><br><span class="line">import org.springframework.web.cors.CorsConfigurationSource;</span><br><span class="line">import org.springframework.web.cors.UrlBasedCorsConfigurationSource;</span><br><span class="line">import java.util.Arrays;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">@EnableWebSecurity</span><br><span class="line">@EnableGlobalMethodSecurity(prePostEnabled = true)</span><br><span class="line">@RequiredArgsConstructor</span><br><span class="line">public class SecurityConfig &#123;</span><br><span class="line">    </span><br><span class="line">    private final UserDetailsServiceImpl userDetailsService;</span><br><span class="line">    private final JwtAuthenticationFilter jwtAuthenticationFilter;</span><br><span class="line">    </span><br><span class="line">    @Bean</span><br><span class="line">    public PasswordEncoder passwordEncoder() &#123;</span><br><span class="line">        return new BCryptPasswordEncoder();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Bean</span><br><span class="line">    public AuthenticationManager authenticationManager(</span><br><span class="line">            AuthenticationConfiguration authenticationConfiguration) throws Exception &#123;</span><br><span class="line">        return authenticationConfiguration.getAuthenticationManager();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Bean</span><br><span class="line">    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception &#123;</span><br><span class="line">        http</span><br><span class="line">            .cors().and()</span><br><span class="line">            .csrf().disable()</span><br><span class="line">            .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">            .and()</span><br><span class="line">            .authorizeRequests()</span><br><span class="line">                .antMatchers(&quot;/api/auth/**&quot;).permitAll()</span><br><span class="line">                .antMatchers(&quot;/api/articles/public/**&quot;).permitAll()</span><br><span class="line">                .antMatchers(&quot;/api/comments/public/**&quot;).permitAll()</span><br><span class="line">                .antMatchers(&quot;/api/files/**&quot;).permitAll()</span><br><span class="line">                .antMatchers(&quot;/api/admin/**&quot;).hasRole(&quot;ADMIN&quot;)</span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);</span><br><span class="line">        </span><br><span class="line">        return http.build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Bean</span><br><span class="line">    public CorsConfigurationSource corsConfigurationSource() &#123;</span><br><span class="line">        CorsConfiguration configuration = new CorsConfiguration();</span><br><span class="line">        configuration.setAllowedOrigins(Arrays.asList(&quot;http://localhost:3000&quot;, &quot;http://127.0.0.1:5500&quot;));</span><br><span class="line">        configuration.setAllowedMethods(Arrays.asList(&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;OPTIONS&quot;));</span><br><span class="line">        configuration.setAllowedHeaders(Arrays.asList(&quot;*&quot;));</span><br><span class="line">        configuration.setAllowCredentials(true);</span><br><span class="line">        configuration.setMaxAge(3600L);</span><br><span class="line">        </span><br><span class="line">        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();</span><br><span class="line">        source.registerCorsConfiguration(&quot;/api/**&quot;, configuration);</span><br><span class="line">        return source;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>UserDetailsServiceImpl.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.service;</span><br><span class="line"></span><br><span class="line">import com.blog.entity.User;</span><br><span class="line">import com.blog.repository.UserRepository;</span><br><span class="line">import lombok.RequiredArgsConstructor;</span><br><span class="line">import org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class="line">import org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line">import org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line">import org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import org.springframework.transaction.annotation.Transactional;</span><br><span class="line">import java.util.Collections;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">@RequiredArgsConstructor</span><br><span class="line">public class UserDetailsServiceImpl implements UserDetailsService &#123;</span><br><span class="line">    </span><br><span class="line">    private final UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    @Transactional(readOnly = true)</span><br><span class="line">    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException &#123;</span><br><span class="line">        User user = userRepository.findByUsername(username)</span><br><span class="line">            .orElseThrow(() -&gt; new UsernameNotFoundException(&quot;用户不存在: &quot; + username));</span><br><span class="line">        </span><br><span class="line">        if (!user.getIsActive()) &#123;</span><br><span class="line">            throw new UsernameNotFoundException(&quot;用户已被停用: &quot; + username);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return new org.springframework.security.core.userdetails.User(</span><br><span class="line">            user.getUsername(),</span><br><span class="line">            user.getPasswordHash(),</span><br><span class="line">            Collections.singletonList(new SimpleGrantedAuthority(&quot;ROLE_&quot; + user.getRole().name()))</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="8-Controller（控制器层）"><a href="#8-Controller（控制器层）" class="headerlink" title="8. Controller（控制器层）"></a>8. Controller（控制器层）</h3><p><strong>AuthController.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.controller;</span><br><span class="line"></span><br><span class="line">import com.blog.dto.AuthRequest;</span><br><span class="line">import com.blog.dto.AuthResponse;</span><br><span class="line">import com.blog.dto.RegisterRequest;</span><br><span class="line">import com.blog.dto.UserDTO;</span><br><span class="line">import com.blog.entity.User;</span><br><span class="line">import com.blog.repository.UserRepository;</span><br><span class="line">import com.blog.security.JwtTokenProvider;</span><br><span class="line">import com.blog.service.UserService;</span><br><span class="line">import lombok.RequiredArgsConstructor;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.http.ResponseEntity;</span><br><span class="line">import org.springframework.security.authentication.AuthenticationManager;</span><br><span class="line">import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line">import org.springframework.security.core.Authentication;</span><br><span class="line">import org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line">import javax.validation.Valid;</span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/api/auth&quot;)</span><br><span class="line">@RequiredArgsConstructor</span><br><span class="line">@Slf4j</span><br><span class="line">public class AuthController &#123;</span><br><span class="line">    </span><br><span class="line">    private final AuthenticationManager authenticationManager;</span><br><span class="line">    private final JwtTokenProvider tokenProvider;</span><br><span class="line">    private final UserService userService;</span><br><span class="line">    private final UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    @PostMapping(&quot;/login&quot;)</span><br><span class="line">    public ResponseEntity&lt;?&gt; authenticateUser(@Valid @RequestBody AuthRequest authRequest) &#123;</span><br><span class="line">        Authentication authentication = authenticationManager.authenticate(</span><br><span class="line">            new UsernamePasswordAuthenticationToken(</span><br><span class="line">                authRequest.getUsername(),</span><br><span class="line">                authRequest.getPassword()</span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        SecurityContextHolder.getContext().setAuthentication(authentication);</span><br><span class="line">        String jwt = tokenProvider.generateToken(authentication);</span><br><span class="line">        </span><br><span class="line">        User user = userRepository.findByUsername(authRequest.getUsername())</span><br><span class="line">            .orElseThrow(() -&gt; new RuntimeException(&quot;用户不存在&quot;));</span><br><span class="line">        </span><br><span class="line">        UserDTO userDTO = new UserDTO();</span><br><span class="line">        userDTO.setId(user.getId());</span><br><span class="line">        userDTO.setUsername(user.getUsername());</span><br><span class="line">        userDTO.setEmail(user.getEmail());</span><br><span class="line">        userDTO.setDisplayName(user.getDisplayName());</span><br><span class="line">        userDTO.setAvatarUrl(user.getAvatarUrl());</span><br><span class="line">        userDTO.setRole(user.getRole().name());</span><br><span class="line">        </span><br><span class="line">        LocalDateTime expiryDate = LocalDateTime.now().plusSeconds(tokenProvider.getJwtExpirationMs() / 1000);</span><br><span class="line">        </span><br><span class="line">        return ResponseEntity.ok(new AuthResponse(jwt, expiryDate, userDTO));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @PostMapping(&quot;/register&quot;)</span><br><span class="line">    public ResponseEntity&lt;?&gt; registerUser(@Valid @RequestBody RegisterRequest registerRequest) &#123;</span><br><span class="line">        UserDTO userDTO = userService.registerUser(registerRequest);</span><br><span class="line">        return ResponseEntity.ok(userDTO);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @GetMapping(&quot;/me&quot;)</span><br><span class="line">    public ResponseEntity&lt;?&gt; getCurrentUser() &#123;</span><br><span class="line">        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">        String username = authentication.getName();</span><br><span class="line">        </span><br><span class="line">        User user = userRepository.findByUsername(username)</span><br><span class="line">            .orElseThrow(() -&gt; new RuntimeException(&quot;用户不存在&quot;));</span><br><span class="line">        </span><br><span class="line">        UserDTO userDTO = new UserDTO();</span><br><span class="line">        userDTO.setId(user.getId());</span><br><span class="line">        userDTO.setUsername(user.getUsername());</span><br><span class="line">        userDTO.setEmail(user.getEmail());</span><br><span class="line">        userDTO.setDisplayName(user.getDisplayName());</span><br><span class="line">        userDTO.setBio(user.getBio());</span><br><span class="line">        userDTO.setAvatarUrl(user.getAvatarUrl());</span><br><span class="line">        userDTO.setRole(user.getRole().name());</span><br><span class="line">        userDTO.setCreatedAt(user.getCreatedAt());</span><br><span class="line">        userDTO.setUpdatedAt(user.getUpdatedAt());</span><br><span class="line">        </span><br><span class="line">        return ResponseEntity.ok(userDTO);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>ArticleController.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.controller;</span><br><span class="line"></span><br><span class="line">import com.blog.dto.ArticleDTO;</span><br><span class="line">import com.blog.service.ArticleService;</span><br><span class="line">import lombok.RequiredArgsConstructor;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.data.domain.Page;</span><br><span class="line">import org.springframework.data.domain.PageRequest;</span><br><span class="line">import org.springframework.data.domain.Pageable;</span><br><span class="line">import org.springframework.data.domain.Sort;</span><br><span class="line">import org.springframework.http.ResponseEntity;</span><br><span class="line">import org.springframework.security.access.prepost.PreAuthorize;</span><br><span class="line">import org.springframework.security.core.annotation.AuthenticationPrincipal;</span><br><span class="line">import org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line">import javax.validation.Valid;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/api/articles&quot;)</span><br><span class="line">@RequiredArgsConstructor</span><br><span class="line">@Slf4j</span><br><span class="line">public class ArticleController &#123;</span><br><span class="line">    </span><br><span class="line">    private final ArticleService articleService;</span><br><span class="line">    </span><br><span class="line">    @GetMapping(&quot;/public&quot;)</span><br><span class="line">    public ResponseEntity&lt;?&gt; getPublishedArticles(</span><br><span class="line">            @RequestParam(defaultValue = &quot;0&quot;) int page,</span><br><span class="line">            @RequestParam(defaultValue = &quot;10&quot;) int size,</span><br><span class="line">            @RequestParam(defaultValue = &quot;publishedAt&quot;) String sortBy,</span><br><span class="line">            @RequestParam(defaultValue = &quot;DESC&quot;) String direction) &#123;</span><br><span class="line">        </span><br><span class="line">        Sort sort = direction.equalsIgnoreCase(&quot;ASC&quot;) ? </span><br><span class="line">            Sort.by(sortBy).ascending() : Sort.by(sortBy).descending();</span><br><span class="line">        Pageable pageable = PageRequest.of(page, size, sort);</span><br><span class="line">        </span><br><span class="line">        Page&lt;ArticleDTO&gt; articles = articleService.getPublishedArticles(pageable);</span><br><span class="line">        </span><br><span class="line">        Map&lt;String, Object&gt; response = new HashMap&lt;&gt;();</span><br><span class="line">        response.put(&quot;articles&quot;, articles.getContent());</span><br><span class="line">        response.put(&quot;currentPage&quot;, articles.getNumber());</span><br><span class="line">        response.put(&quot;totalItems&quot;, articles.getTotalElements());</span><br><span class="line">        response.put(&quot;totalPages&quot;, articles.getTotalPages());</span><br><span class="line">        </span><br><span class="line">        return ResponseEntity.ok(response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @GetMapping(&quot;/public/search&quot;)</span><br><span class="line">    public ResponseEntity&lt;?&gt; searchArticles(</span><br><span class="line">            @RequestParam String keyword,</span><br><span class="line">            @RequestParam(defaultValue = &quot;0&quot;) int page,</span><br><span class="line">            @RequestParam(defaultValue = &quot;10&quot;) int size) &#123;</span><br><span class="line">        </span><br><span class="line">        Pageable pageable = PageRequest.of(page, size);</span><br><span class="line">        Page&lt;ArticleDTO&gt; articles = articleService.searchPublishedArticles(keyword, pageable);</span><br><span class="line">        </span><br><span class="line">        Map&lt;String, Object&gt; response = new HashMap&lt;&gt;();</span><br><span class="line">        response.put(&quot;articles&quot;, articles.getContent());</span><br><span class="line">        response.put(&quot;currentPage&quot;, articles.getNumber());</span><br><span class="line">        response.put(&quot;totalItems&quot;, articles.getTotalElements());</span><br><span class="line">        response.put(&quot;totalPages&quot;, articles.getTotalPages());</span><br><span class="line">        </span><br><span class="line">        return ResponseEntity.ok(response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @GetMapping(&quot;/public/&#123;id&#125;&quot;)</span><br><span class="line">    public ResponseEntity&lt;?&gt; getArticle(@PathVariable Long id) &#123;</span><br><span class="line">        ArticleDTO article = articleService.getArticleById(id);</span><br><span class="line">        return ResponseEntity.ok(article);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @GetMapping(&quot;/public/featured&quot;)</span><br><span class="line">    public ResponseEntity&lt;?&gt; getFeaturedArticles(</span><br><span class="line">            @RequestParam(defaultValue = &quot;0&quot;) int page,</span><br><span class="line">            @RequestParam(defaultValue = &quot;5&quot;) int size) &#123;</span><br><span class="line">        </span><br><span class="line">        Pageable pageable = PageRequest.of(page, size);</span><br><span class="line">        Page&lt;ArticleDTO&gt; articles = articleService.getFeaturedArticles(pageable);</span><br><span class="line">        </span><br><span class="line">        return ResponseEntity.ok(articles.getContent());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @GetMapping(&quot;/public/popular&quot;)</span><br><span class="line">    public ResponseEntity&lt;?&gt; getPopularArticles(</span><br><span class="line">            @RequestParam(defaultValue = &quot;0&quot;) int page,</span><br><span class="line">            @RequestParam(defaultValue = &quot;5&quot;) int size) &#123;</span><br><span class="line">        </span><br><span class="line">        Pageable pageable = PageRequest.of(page, size);</span><br><span class="line">        Page&lt;ArticleDTO&gt; articles = articleService.getPopularArticles(pageable);</span><br><span class="line">        </span><br><span class="line">        return ResponseEntity.ok(articles.getContent());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @PostMapping</span><br><span class="line">    @PreAuthorize(&quot;hasRole(&#x27;USER&#x27;)&quot;)</span><br><span class="line">    public ResponseEntity&lt;?&gt; createArticle(</span><br><span class="line">            @Valid @RequestBody ArticleDTO articleDTO,</span><br><span class="line">            @AuthenticationPrincipal UserDetails userDetails) &#123;</span><br><span class="line">        </span><br><span class="line">        // 这里需要根据username获取userId，实际项目中应该从token中获取userId</span><br><span class="line">        // 简化处理：假设userDetails包含用户信息</span><br><span class="line">        Long userId = getUserIdFromUserDetails(userDetails);</span><br><span class="line">        </span><br><span class="line">        ArticleDTO createdArticle = articleService.createArticle(articleDTO, userId);</span><br><span class="line">        return ResponseEntity.ok(createdArticle);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @PutMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">    @PreAuthorize(&quot;hasRole(&#x27;USER&#x27;)&quot;)</span><br><span class="line">    public ResponseEntity&lt;?&gt; updateArticle(</span><br><span class="line">            @PathVariable Long id,</span><br><span class="line">            @Valid @RequestBody ArticleDTO articleDTO,</span><br><span class="line">            @AuthenticationPrincipal UserDetails userDetails) &#123;</span><br><span class="line">        </span><br><span class="line">        Long userId = getUserIdFromUserDetails(userDetails);</span><br><span class="line">        ArticleDTO updatedArticle = articleService.updateArticle(id, articleDTO, userId);</span><br><span class="line">        return ResponseEntity.ok(updatedArticle);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @DeleteMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">    @PreAuthorize(&quot;hasRole(&#x27;USER&#x27;)&quot;)</span><br><span class="line">    public ResponseEntity&lt;?&gt; deleteArticle(</span><br><span class="line">            @PathVariable Long id,</span><br><span class="line">            @AuthenticationPrincipal UserDetails userDetails) &#123;</span><br><span class="line">        </span><br><span class="line">        Long userId = getUserIdFromUserDetails(userDetails);</span><br><span class="line">        articleService.deleteArticle(id, userId);</span><br><span class="line">        return ResponseEntity.ok().build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @PostMapping(&quot;/&#123;id&#125;/like&quot;)</span><br><span class="line">    @PreAuthorize(&quot;hasRole(&#x27;USER&#x27;)&quot;)</span><br><span class="line">    public ResponseEntity&lt;?&gt; likeArticle(@PathVariable Long id) &#123;</span><br><span class="line">        articleService.likeArticle(id);</span><br><span class="line">        return ResponseEntity.ok().build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 辅助方法：从UserDetails获取userId</span><br><span class="line">    private Long getUserIdFromUserDetails(UserDetails userDetails) &#123;</span><br><span class="line">        // 这里需要根据实际情况实现，例如从数据库查询</span><br><span class="line">        // 简化处理：返回1</span><br><span class="line">        return 1L;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="9-异常处理"><a href="#9-异常处理" class="headerlink" title="9. 异常处理"></a>9. 异常处理</h3><p><strong>GlobalExceptionHandler.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.exception;</span><br><span class="line"></span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.http.HttpStatus;</span><br><span class="line">import org.springframework.http.ResponseEntity;</span><br><span class="line">import org.springframework.security.access.AccessDeniedException;</span><br><span class="line">import org.springframework.security.authentication.BadCredentialsException;</span><br><span class="line">import org.springframework.validation.FieldError;</span><br><span class="line">import org.springframework.web.bind.MethodArgumentNotValidException;</span><br><span class="line">import org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line">import org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line">import org.springframework.web.multipart.MaxUploadSizeExceededException;</span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">@RestControllerAdvice</span><br><span class="line">@Slf4j</span><br><span class="line">public class GlobalExceptionHandler &#123;</span><br><span class="line">    </span><br><span class="line">    @ExceptionHandler(ResourceNotFoundException.class)</span><br><span class="line">    public ResponseEntity&lt;ErrorResponse&gt; handleResourceNotFound(ResourceNotFoundException ex) &#123;</span><br><span class="line">        ErrorResponse error = new ErrorResponse(</span><br><span class="line">            HttpStatus.NOT_FOUND.value(),</span><br><span class="line">            &quot;Resource Not Found&quot;,</span><br><span class="line">            ex.getMessage(),</span><br><span class="line">            LocalDateTime.now()</span><br><span class="line">        );</span><br><span class="line">        return new ResponseEntity&lt;&gt;(error, HttpStatus.NOT_FOUND);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @ExceptionHandler(BusinessException.class)</span><br><span class="line">    public ResponseEntity&lt;ErrorResponse&gt; handleBusinessException(BusinessException ex) &#123;</span><br><span class="line">        ErrorResponse error = new ErrorResponse(</span><br><span class="line">            HttpStatus.BAD_REQUEST.value(),</span><br><span class="line">            &quot;Business Error&quot;,</span><br><span class="line">            ex.getMessage(),</span><br><span class="line">            LocalDateTime.now()</span><br><span class="line">        );</span><br><span class="line">        return new ResponseEntity&lt;&gt;(error, HttpStatus.BAD_REQUEST);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @ExceptionHandler(MethodArgumentNotValidException.class)</span><br><span class="line">    public ResponseEntity&lt;ErrorResponse&gt; handleValidationExceptions(</span><br><span class="line">            MethodArgumentNotValidException ex) &#123;</span><br><span class="line">        Map&lt;String, String&gt; errors = new HashMap&lt;&gt;();</span><br><span class="line">        ex.getBindingResult().getAllErrors().forEach((error) -&gt; &#123;</span><br><span class="line">            String fieldName = ((FieldError) error).getField();</span><br><span class="line">            String errorMessage = error.getDefaultMessage();</span><br><span class="line">            errors.put(fieldName, errorMessage);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        ErrorResponse error = new ErrorResponse(</span><br><span class="line">            HttpStatus.BAD_REQUEST.value(),</span><br><span class="line">            &quot;Validation Failed&quot;,</span><br><span class="line">            errors.toString(),</span><br><span class="line">            LocalDateTime.now()</span><br><span class="line">        );</span><br><span class="line">        return new ResponseEntity&lt;&gt;(error, HttpStatus.BAD_REQUEST);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @ExceptionHandler(BadCredentialsException.class)</span><br><span class="line">    public ResponseEntity&lt;ErrorResponse&gt; handleBadCredentials(BadCredentialsException ex) &#123;</span><br><span class="line">        ErrorResponse error = new ErrorResponse(</span><br><span class="line">            HttpStatus.UNAUTHORIZED.value(),</span><br><span class="line">            &quot;Authentication Failed&quot;,</span><br><span class="line">            &quot;用户名或密码错误&quot;,</span><br><span class="line">            LocalDateTime.now()</span><br><span class="line">        );</span><br><span class="line">        return new ResponseEntity&lt;&gt;(error, HttpStatus.UNAUTHORIZED);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @ExceptionHandler(AccessDeniedException.class)</span><br><span class="line">    public ResponseEntity&lt;ErrorResponse&gt; handleAccessDenied(AccessDeniedException ex) &#123;</span><br><span class="line">        ErrorResponse error = new ErrorResponse(</span><br><span class="line">            HttpStatus.FORBIDDEN.value(),</span><br><span class="line">            &quot;Access Denied&quot;,</span><br><span class="line">            &quot;没有访问权限&quot;,</span><br><span class="line">            LocalDateTime.now()</span><br><span class="line">        );</span><br><span class="line">        return new ResponseEntity&lt;&gt;(error, HttpStatus.FORBIDDEN);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @ExceptionHandler(MaxUploadSizeExceededException.class)</span><br><span class="line">    public ResponseEntity&lt;ErrorResponse&gt; handleMaxSizeException(MaxUploadSizeExceededException ex) &#123;</span><br><span class="line">        ErrorResponse error = new ErrorResponse(</span><br><span class="line">            HttpStatus.BAD_REQUEST.value(),</span><br><span class="line">            &quot;File Too Large&quot;,</span><br><span class="line">            &quot;文件大小超过限制&quot;,</span><br><span class="line">            LocalDateTime.now()</span><br><span class="line">        );</span><br><span class="line">        return new ResponseEntity&lt;&gt;(error, HttpStatus.BAD_REQUEST);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @ExceptionHandler(Exception.class)</span><br><span class="line">    public ResponseEntity&lt;ErrorResponse&gt; handleGenericException(Exception ex) &#123;</span><br><span class="line">        log.error(&quot;未处理的异常&quot;, ex);</span><br><span class="line">        </span><br><span class="line">        ErrorResponse error = new ErrorResponse(</span><br><span class="line">            HttpStatus.INTERNAL_SERVER_ERROR.value(),</span><br><span class="line">            &quot;Internal Server Error&quot;,</span><br><span class="line">            &quot;服务器内部错误&quot;,</span><br><span class="line">            LocalDateTime.now()</span><br><span class="line">        );</span><br><span class="line">        return new ResponseEntity&lt;&gt;(error, HttpStatus.INTERNAL_SERVER_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ErrorResponse &#123;</span><br><span class="line">    private int status;</span><br><span class="line">    private String error;</span><br><span class="line">    private String message;</span><br><span class="line">    private LocalDateTime timestamp;</span><br><span class="line">    </span><br><span class="line">    public ErrorResponse(int status, String error, String message, LocalDateTime timestamp) &#123;</span><br><span class="line">        this.status = status;</span><br><span class="line">        this.error = error;</span><br><span class="line">        this.message = message;</span><br><span class="line">        this.timestamp = timestamp;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // Getters and setters</span><br><span class="line">    public int getStatus() &#123; return status; &#125;</span><br><span class="line">    public void setStatus(int status) &#123; this.status = status; &#125;</span><br><span class="line">    public String getError() &#123; return error; &#125;</span><br><span class="line">    public void setError(String error) &#123; this.error = error; &#125;</span><br><span class="line">    public String getMessage() &#123; return message; &#125;</span><br><span class="line">    public void setMessage(String message) &#123; this.message = message; &#125;</span><br><span class="line">    public LocalDateTime getTimestamp() &#123; return timestamp; &#125;</span><br><span class="line">    public void setTimestamp(LocalDateTime timestamp) &#123; this.timestamp = timestamp; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="10-主应用类"><a href="#10-主应用类" class="headerlink" title="10. 主应用类"></a>10. 主应用类</h3><p><strong>BlogApplication.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">package com.blog;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.data.jpa.repository.config.EnableJpaAuditing;</span><br><span class="line">import org.springframework.web.servlet.config.annotation.CorsRegistry;</span><br><span class="line">import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">@EnableJpaAuditing</span><br><span class="line">public class BlogApplication &#123;</span><br><span class="line">    </span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(BlogApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Bean</span><br><span class="line">    public WebMvcConfigurer corsConfigurer() &#123;</span><br><span class="line">        return new WebMvcConfigurer() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void addCorsMappings(CorsRegistry registry) &#123;</span><br><span class="line">                registry.addMapping(&quot;/api/**&quot;)</span><br><span class="line">                    .allowedOrigins(&quot;http://localhost:3000&quot;, &quot;http://127.0.0.1:5500&quot;)</span><br><span class="line">                    .allowedMethods(&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;OPTIONS&quot;)</span><br><span class="line">                    .allowedHeaders(&quot;*&quot;)</span><br><span class="line">                    .allowCredentials(true)</span><br><span class="line">                    .maxAge(3600);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="第二部分：前端实现（纯HTML-CSS-JavaScript）"><a href="#第二部分：前端实现（纯HTML-CSS-JavaScript）" class="headerlink" title="第二部分：前端实现（纯HTML&#x2F;CSS&#x2F;JavaScript）"></a>第二部分：前端实现（纯HTML&#x2F;CSS&#x2F;JavaScript）</h2><h3 id="1-项目结构"><a href="#1-项目结构" class="headerlink" title="1. 项目结构"></a>1. 项目结构</h3><p>text</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">blog-frontend/</span><br><span class="line">├── index.html              # 首页</span><br><span class="line">├── article.html            # 文章详情页</span><br><span class="line">├── login.html              # 登录页</span><br><span class="line">├── register.html           # 注册页</span><br><span class="line">├── admin.html              # 管理后台</span><br><span class="line">├── css/</span><br><span class="line">│   ├── style.css          # 主样式</span><br><span class="line">│   ├── admin.css          # 管理后台样式</span><br><span class="line">│   └── article.css        # 文章样式</span><br><span class="line">├── js/</span><br><span class="line">│   ├── app.js             # 应用主文件</span><br><span class="line">│   ├── api.js             # API封装</span><br><span class="line">│   ├── auth.js            # 认证相关</span><br><span class="line">│   ├── router.js          # 前端路由</span><br><span class="line">│   ├── store.js           # 状态管理</span><br><span class="line">│   ├── components/        # 组件</span><br><span class="line">│   │   ├── header.js</span><br><span class="line">│   │   ├── footer.js</span><br><span class="line">│   │   ├── article-list.js</span><br><span class="line">│   │   ├── comment-form.js</span><br><span class="line">│   │   ├── pagination.js</span><br><span class="line">│   │   └── editor.js</span><br><span class="line">│   └── pages/             # 页面模块</span><br><span class="line">│       ├── home.js</span><br><span class="line">│       ├── article.js</span><br><span class="line">│       ├── login.js</span><br><span class="line">│       ├── register.js</span><br><span class="line">│       └── admin.js</span><br><span class="line">└── assets/</span><br><span class="line">    ├── images/</span><br><span class="line">    └── uploads/</span><br></pre></td></tr></table></figure>



<h3 id="2-核心HTML文件"><a href="#2-核心HTML文件" class="headerlink" title="2. 核心HTML文件"></a>2. 核心HTML文件</h3><p><strong>index.html</strong></p>
<p>html</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;zh-CN&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;个人博客&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot;&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;!-- 顶部导航栏 --&gt;</span><br><span class="line">    &lt;header id=&quot;header&quot;&gt;</span><br><span class="line">        &lt;nav class=&quot;navbar&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;nav-brand&quot;&gt;</span><br><span class="line">                &lt;a href=&quot;/&quot; data-link&gt;我的博客&lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;button class=&quot;nav-toggle&quot; aria-label=&quot;Toggle navigation&quot;&gt;</span><br><span class="line">                &lt;i class=&quot;fas fa-bars&quot;&gt;&lt;/i&gt;</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;ul class=&quot;nav-menu&quot;&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;/&quot; class=&quot;nav-link&quot; data-link&gt;首页&lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;/categories&quot; class=&quot;nav-link&quot; data-link&gt;分类&lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;/tags&quot; class=&quot;nav-link&quot; data-link&gt;标签&lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;/archive&quot; class=&quot;nav-link&quot; data-link&gt;归档&lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;/about&quot; class=&quot;nav-link&quot; data-link&gt;关于&lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                </span><br><span class="line">                &lt;!-- 用户相关菜单 --&gt;</span><br><span class="line">                &lt;div class=&quot;user-menu&quot; id=&quot;user-menu&quot;&gt;</span><br><span class="line">                    &lt;!-- 动态加载用户菜单 --&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">        &lt;/nav&gt;</span><br><span class="line">    &lt;/header&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 主内容区域 --&gt;</span><br><span class="line">    &lt;main class=&quot;container&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;main-content&quot;&gt;</span><br><span class="line">            &lt;!-- 左侧内容区 --&gt;</span><br><span class="line">            &lt;div class=&quot;content-left&quot; id=&quot;content-left&quot;&gt;</span><br><span class="line">                &lt;!-- 动态加载内容 --&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;!-- 右侧边栏 --&gt;</span><br><span class="line">            &lt;div class=&quot;sidebar&quot; id=&quot;sidebar&quot;&gt;</span><br><span class="line">                &lt;!-- 搜索框 --&gt;</span><br><span class="line">                &lt;div class=&quot;widget search-widget&quot;&gt;</span><br><span class="line">                    &lt;form id=&quot;search-form&quot; class=&quot;search-form&quot;&gt;</span><br><span class="line">                        &lt;input type=&quot;text&quot; id=&quot;search-input&quot; placeholder=&quot;搜索文章...&quot;&gt;</span><br><span class="line">                        &lt;button type=&quot;submit&quot; class=&quot;search-btn&quot;&gt;</span><br><span class="line">                            &lt;i class=&quot;fas fa-search&quot;&gt;&lt;/i&gt;</span><br><span class="line">                        &lt;/button&gt;</span><br><span class="line">                    &lt;/form&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                </span><br><span class="line">                &lt;!-- 关于我 --&gt;</span><br><span class="line">                &lt;div class=&quot;widget about-widget&quot;&gt;</span><br><span class="line">                    &lt;h3 class=&quot;widget-title&quot;&gt;关于我&lt;/h3&gt;</span><br><span class="line">                    &lt;div class=&quot;about-content&quot;&gt;</span><br><span class="line">                        &lt;p&gt;一个热爱技术的开发者，分享编程心得和项目经验。&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                </span><br><span class="line">                &lt;!-- 最新文章 --&gt;</span><br><span class="line">                &lt;div class=&quot;widget recent-posts&quot;&gt;</span><br><span class="line">                    &lt;h3 class=&quot;widget-title&quot;&gt;最新文章&lt;/h3&gt;</span><br><span class="line">                    &lt;div id=&quot;recent-posts&quot; class=&quot;posts-list&quot;&gt;</span><br><span class="line">                        &lt;!-- 动态加载最新文章 --&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                </span><br><span class="line">                &lt;!-- 标签云 --&gt;</span><br><span class="line">                &lt;div class=&quot;widget tag-cloud&quot;&gt;</span><br><span class="line">                    &lt;h3 class=&quot;widget-title&quot;&gt;标签&lt;/h3&gt;</span><br><span class="line">                    &lt;div id=&quot;tag-cloud&quot; class=&quot;tags&quot;&gt;</span><br><span class="line">                        &lt;!-- 动态加载标签 --&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/main&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 页脚 --&gt;</span><br><span class="line">    &lt;footer class=&quot;footer&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;footer-content&quot;&gt;</span><br><span class="line">            &lt;p&gt;&amp;copy; 2023 个人博客. All rights reserved.&lt;/p&gt;</span><br><span class="line">            &lt;div class=&quot;social-links&quot;&gt;</span><br><span class="line">                &lt;a href=&quot;#&quot; class=&quot;social-link&quot;&gt;&lt;i class=&quot;fab fa-github&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span><br><span class="line">                &lt;a href=&quot;#&quot; class=&quot;social-link&quot;&gt;&lt;i class=&quot;fab fa-twitter&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span><br><span class="line">                &lt;a href=&quot;#&quot; class=&quot;social-link&quot;&gt;&lt;i class=&quot;fab fa-weibo&quot;&gt;&lt;/i&gt;&lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/footer&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 加载提示 --&gt;</span><br><span class="line">    &lt;div id=&quot;loading&quot; class=&quot;loading-overlay&quot; style=&quot;display: none;&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;loading-spinner&quot;&gt;</span><br><span class="line">            &lt;i class=&quot;fas fa-spinner fa-spin&quot;&gt;&lt;/i&gt;</span><br><span class="line">            &lt;span&gt;加载中...&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 模态框容器 --&gt;</span><br><span class="line">    &lt;div id=&quot;modal-container&quot;&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script type=&quot;module&quot; src=&quot;js/app.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<h3 id="3-主样式文件"><a href="#3-主样式文件" class="headerlink" title="3. 主样式文件"></a>3. 主样式文件</h3><p><strong>css&#x2F;style.css</strong></p>
<p>css</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br></pre></td><td class="code"><pre><span class="line">/* 重置和基础样式 */</span><br><span class="line">* &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    padding: 0;</span><br><span class="line">    box-sizing: border-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">:root &#123;</span><br><span class="line">    --primary-color: #007bff;</span><br><span class="line">    --secondary-color: #6c757d;</span><br><span class="line">    --success-color: #28a745;</span><br><span class="line">    --danger-color: #dc3545;</span><br><span class="line">    --warning-color: #ffc107;</span><br><span class="line">    --info-color: #17a2b8;</span><br><span class="line">    --light-color: #f8f9fa;</span><br><span class="line">    --dark-color: #343a40;</span><br><span class="line">    --text-color: #333;</span><br><span class="line">    --text-light: #666;</span><br><span class="line">    --text-lighter: #999;</span><br><span class="line">    --border-color: #dee2e6;</span><br><span class="line">    --bg-color: #fff;</span><br><span class="line">    --bg-light: #f5f5f5;</span><br><span class="line">    --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);</span><br><span class="line">    --radius: 4px;</span><br><span class="line">    --transition: all 0.3s ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">body &#123;</span><br><span class="line">    font-family: -apple-system, BlinkMacSystemFont, &#x27;Segoe UI&#x27;, &#x27;PingFang SC&#x27;, &#x27;Hiragino Sans GB&#x27;, &#x27;Microsoft YaHei&#x27;, sans-serif;</span><br><span class="line">    line-height: 1.6;</span><br><span class="line">    color: var(--text-color);</span><br><span class="line">    background-color: var(--bg-light);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a &#123;</span><br><span class="line">    color: var(--primary-color);</span><br><span class="line">    text-decoration: none;</span><br><span class="line">    transition: var(--transition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a:hover &#123;</span><br><span class="line">    color: #0056b3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ul, ol &#123;</span><br><span class="line">    list-style: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">img &#123;</span><br><span class="line">    max-width: 100%;</span><br><span class="line">    height: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.container &#123;</span><br><span class="line">    max-width: 1200px;</span><br><span class="line">    margin: 0 auto;</span><br><span class="line">    padding: 0 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 导航栏样式 */</span><br><span class="line">.navbar &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    align-items: center;</span><br><span class="line">    padding: 1rem 2rem;</span><br><span class="line">    background-color: var(--bg-color);</span><br><span class="line">    box-shadow: var(--shadow);</span><br><span class="line">    position: sticky;</span><br><span class="line">    top: 0;</span><br><span class="line">    z-index: 1000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-brand a &#123;</span><br><span class="line">    font-size: 1.5rem;</span><br><span class="line">    font-weight: bold;</span><br><span class="line">    color: var(--dark-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-menu &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    gap: 2rem;</span><br><span class="line">    align-items: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-item .nav-link &#123;</span><br><span class="line">    color: var(--text-color);</span><br><span class="line">    padding: 0.5rem 0;</span><br><span class="line">    position: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-item .nav-link:hover &#123;</span><br><span class="line">    color: var(--primary-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-item .nav-link::after &#123;</span><br><span class="line">    content: &#x27;&#x27;;</span><br><span class="line">    position: absolute;</span><br><span class="line">    bottom: 0;</span><br><span class="line">    left: 0;</span><br><span class="line">    width: 0;</span><br><span class="line">    height: 2px;</span><br><span class="line">    background-color: var(--primary-color);</span><br><span class="line">    transition: var(--transition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-item .nav-link:hover::after &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-toggle &#123;</span><br><span class="line">    display: none;</span><br><span class="line">    background: none;</span><br><span class="line">    border: none;</span><br><span class="line">    font-size: 1.5rem;</span><br><span class="line">    color: var(--text-color);</span><br><span class="line">    cursor: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 用户菜单 */</span><br><span class="line">.user-menu &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    gap: 1rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.auth-links &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    gap: 1rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-profile &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-avatar &#123;</span><br><span class="line">    width: 40px;</span><br><span class="line">    height: 40px;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    border: 2px solid var(--border-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-avatar img &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 100%;</span><br><span class="line">    object-fit: cover;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-dropdown &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 100%;</span><br><span class="line">    right: 0;</span><br><span class="line">    background-color: var(--bg-color);</span><br><span class="line">    box-shadow: var(--shadow);</span><br><span class="line">    border-radius: var(--radius);</span><br><span class="line">    min-width: 200px;</span><br><span class="line">    display: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-profile:hover .user-dropdown &#123;</span><br><span class="line">    display: block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-dropdown a &#123;</span><br><span class="line">    display: block;</span><br><span class="line">    padding: 0.75rem 1rem;</span><br><span class="line">    color: var(--text-color);</span><br><span class="line">    border-bottom: 1px solid var(--border-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-dropdown a:hover &#123;</span><br><span class="line">    background-color: var(--bg-light);</span><br><span class="line">    color: var(--primary-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-dropdown a:last-child &#123;</span><br><span class="line">    border-bottom: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 主内容区 */</span><br><span class="line">.main-content &#123;</span><br><span class="line">    display: grid;</span><br><span class="line">    grid-template-columns: 2fr 1fr;</span><br><span class="line">    gap: 2rem;</span><br><span class="line">    padding: 2rem 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 文章卡片 */</span><br><span class="line">.article-card &#123;</span><br><span class="line">    background-color: var(--bg-color);</span><br><span class="line">    border-radius: var(--radius);</span><br><span class="line">    overflow: hidden;</span><br><span class="line">    box-shadow: var(--shadow);</span><br><span class="line">    margin-bottom: 2rem;</span><br><span class="line">    transition: var(--transition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.article-card:hover &#123;</span><br><span class="line">    transform: translateY(-5px);</span><br><span class="line">    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.article-header &#123;</span><br><span class="line">    padding: 1.5rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.article-title &#123;</span><br><span class="line">    font-size: 1.5rem;</span><br><span class="line">    margin-bottom: 0.5rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.article-title a &#123;</span><br><span class="line">    color: var(--dark-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.article-title a:hover &#123;</span><br><span class="line">    color: var(--primary-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.article-meta &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    gap: 1rem;</span><br><span class="line">    color: var(--text-light);</span><br><span class="line">    font-size: 0.9rem;</span><br><span class="line">    margin-bottom: 1rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.article-meta i &#123;</span><br><span class="line">    margin-right: 0.25rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.article-excerpt &#123;</span><br><span class="line">    color: var(--text-color);</span><br><span class="line">    margin-bottom: 1rem;</span><br><span class="line">    line-height: 1.8;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.article-footer &#123;</span><br><span class="line">    padding: 1rem 1.5rem;</span><br><span class="line">    border-top: 1px solid var(--border-color);</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    align-items: center;</span><br><span class="line">    background-color: var(--bg-light);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.article-tags &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    gap: 0.5rem;</span><br><span class="line">    flex-wrap: wrap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.tag &#123;</span><br><span class="line">    background-color: var(--light-color);</span><br><span class="line">    color: var(--secondary-color);</span><br><span class="line">    padding: 0.25rem 0.75rem;</span><br><span class="line">    border-radius: 20px;</span><br><span class="line">    font-size: 0.85rem;</span><br><span class="line">    transition: var(--transition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.tag:hover &#123;</span><br><span class="line">    background-color: var(--primary-color);</span><br><span class="line">    color: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.read-more &#123;</span><br><span class="line">    color: var(--primary-color);</span><br><span class="line">    font-weight: 500;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.read-more:hover &#123;</span><br><span class="line">    color: #0056b3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 侧边栏 */</span><br><span class="line">.sidebar &#123;</span><br><span class="line">    position: sticky;</span><br><span class="line">    top: 100px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.widget &#123;</span><br><span class="line">    background-color: var(--bg-color);</span><br><span class="line">    border-radius: var(--radius);</span><br><span class="line">    padding: 1.5rem;</span><br><span class="line">    margin-bottom: 2rem;</span><br><span class="line">    box-shadow: var(--shadow);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.widget-title &#123;</span><br><span class="line">    font-size: 1.1rem;</span><br><span class="line">    margin-bottom: 1rem;</span><br><span class="line">    padding-bottom: 0.5rem;</span><br><span class="line">    border-bottom: 2px solid var(--primary-color);</span><br><span class="line">    color: var(--dark-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 搜索框 */</span><br><span class="line">.search-form &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.search-input &#123;</span><br><span class="line">    flex: 1;</span><br><span class="line">    padding: 0.75rem;</span><br><span class="line">    border: 1px solid var(--border-color);</span><br><span class="line">    border-right: none;</span><br><span class="line">    border-radius: var(--radius) 0 0 var(--radius);</span><br><span class="line">    font-size: 0.95rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.search-btn &#123;</span><br><span class="line">    background-color: var(--primary-color);</span><br><span class="line">    color: white;</span><br><span class="line">    border: none;</span><br><span class="line">    padding: 0.75rem 1.25rem;</span><br><span class="line">    border-radius: 0 var(--radius) var(--radius) 0;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    transition: var(--transition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.search-btn:hover &#123;</span><br><span class="line">    background-color: #0056b3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 最新文章列表 */</span><br><span class="line">.posts-list &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-direction: column;</span><br><span class="line">    gap: 1rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.post-item &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    gap: 1rem;</span><br><span class="line">    padding: 0.75rem;</span><br><span class="line">    border-radius: var(--radius);</span><br><span class="line">    transition: var(--transition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.post-item:hover &#123;</span><br><span class="line">    background-color: var(--bg-light);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.post-thumbnail &#123;</span><br><span class="line">    width: 60px;</span><br><span class="line">    height: 60px;</span><br><span class="line">    border-radius: var(--radius);</span><br><span class="line">    overflow: hidden;</span><br><span class="line">    flex-shrink: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.post-thumbnail img &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    height: 100%;</span><br><span class="line">    object-fit: cover;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.post-info h4 &#123;</span><br><span class="line">    font-size: 0.95rem;</span><br><span class="line">    margin-bottom: 0.25rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.post-info h4 a &#123;</span><br><span class="line">    color: var(--text-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.post-info h4 a:hover &#123;</span><br><span class="line">    color: var(--primary-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.post-date &#123;</span><br><span class="line">    font-size: 0.85rem;</span><br><span class="line">    color: var(--text-light);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 标签云 */</span><br><span class="line">.tags &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-wrap: wrap;</span><br><span class="line">    gap: 0.5rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.tag-cloud &#123;</span><br><span class="line">    background-color: var(--light-color);</span><br><span class="line">    color: var(--secondary-color);</span><br><span class="line">    padding: 0.5rem 1rem;</span><br><span class="line">    border-radius: 20px;</span><br><span class="line">    font-size: 0.9rem;</span><br><span class="line">    transition: var(--transition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.tag-cloud:hover &#123;</span><br><span class="line">    background-color: var(--primary-color);</span><br><span class="line">    color: white;</span><br><span class="line">    transform: translateY(-2px);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 页脚 */</span><br><span class="line">.footer &#123;</span><br><span class="line">    background-color: var(--dark-color);</span><br><span class="line">    color: white;</span><br><span class="line">    padding: 2rem 0;</span><br><span class="line">    margin-top: 2rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.footer-content &#123;</span><br><span class="line">    text-align: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.social-links &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    gap: 1.5rem;</span><br><span class="line">    margin-top: 1rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.social-link &#123;</span><br><span class="line">    color: white;</span><br><span class="line">    font-size: 1.5rem;</span><br><span class="line">    transition: var(--transition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.social-link:hover &#123;</span><br><span class="line">    color: var(--primary-color);</span><br><span class="line">    transform: translateY(-3px);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 加载动画 */</span><br><span class="line">.loading-overlay &#123;</span><br><span class="line">    position: fixed;</span><br><span class="line">    top: 0;</span><br><span class="line">    left: 0;</span><br><span class="line">    right: 0;</span><br><span class="line">    bottom: 0;</span><br><span class="line">    background-color: rgba(255, 255, 255, 0.9);</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    align-items: center;</span><br><span class="line">    z-index: 9999;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.loading-spinner &#123;</span><br><span class="line">    text-align: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.loading-spinner i &#123;</span><br><span class="line">    font-size: 3rem;</span><br><span class="line">    color: var(--primary-color);</span><br><span class="line">    margin-bottom: 1rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.loading-spinner span &#123;</span><br><span class="line">    display: block;</span><br><span class="line">    color: var(--text-color);</span><br><span class="line">    font-size: 1.1rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 分页样式 */</span><br><span class="line">.pagination &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    gap: 0.5rem;</span><br><span class="line">    margin: 2rem 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.page-link &#123;</span><br><span class="line">    padding: 0.5rem 1rem;</span><br><span class="line">    border: 1px solid var(--border-color);</span><br><span class="line">    border-radius: var(--radius);</span><br><span class="line">    color: var(--text-color);</span><br><span class="line">    transition: var(--transition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.page-link:hover &#123;</span><br><span class="line">    background-color: var(--bg-light);</span><br><span class="line">    color: var(--primary-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.page-link.active &#123;</span><br><span class="line">    background-color: var(--primary-color);</span><br><span class="line">    color: white;</span><br><span class="line">    border-color: var(--primary-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.page-link.disabled &#123;</span><br><span class="line">    opacity: 0.5;</span><br><span class="line">    cursor: not-allowed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 响应式设计 */</span><br><span class="line">@media (max-width: 768px) &#123;</span><br><span class="line">    .nav-menu &#123;</span><br><span class="line">        display: none;</span><br><span class="line">        flex-direction: column;</span><br><span class="line">        position: absolute;</span><br><span class="line">        top: 100%;</span><br><span class="line">        left: 0;</span><br><span class="line">        right: 0;</span><br><span class="line">        background-color: var(--bg-color);</span><br><span class="line">        box-shadow: var(--shadow);</span><br><span class="line">        padding: 1rem;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .nav-menu.show &#123;</span><br><span class="line">        display: flex;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .nav-toggle &#123;</span><br><span class="line">        display: block;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .main-content &#123;</span><br><span class="line">        grid-template-columns: 1fr;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .sidebar &#123;</span><br><span class="line">        order: -1;</span><br><span class="line">        position: static;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-JavaScript核心模块"><a href="#4-JavaScript核心模块" class="headerlink" title="4. JavaScript核心模块"></a>4. JavaScript核心模块</h3><p><strong>js&#x2F;app.js</strong></p>
<p>javascript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line">// 应用主入口文件</span><br><span class="line">import &#123; Router &#125; from &#x27;./router.js&#x27;;</span><br><span class="line">import &#123; Store &#125; from &#x27;./store.js&#x27;;</span><br><span class="line">import &#123; Auth &#125; from &#x27;./auth.js&#x27;;</span><br><span class="line">import &#123; API &#125; from &#x27;./api.js&#x27;;</span><br><span class="line">import &#123; Header &#125; from &#x27;./components/header.js&#x27;;</span><br><span class="line">import &#123; Loading &#125; from &#x27;./utils/loading.js&#x27;;</span><br><span class="line"></span><br><span class="line">class App &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        this.store = new Store();</span><br><span class="line">        this.api = new API();</span><br><span class="line">        this.auth = new Auth(this.store);</span><br><span class="line">        this.router = new Router(this);</span><br><span class="line">        this.loading = new Loading();</span><br><span class="line">        </span><br><span class="line">        // 全局事件监听</span><br><span class="line">        this.initGlobalEvents();</span><br><span class="line">        </span><br><span class="line">        // 检查登录状态</span><br><span class="line">        this.checkAuthStatus();</span><br><span class="line">        </span><br><span class="line">        // 初始化UI组件</span><br><span class="line">        this.initUI();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    initGlobalEvents() &#123;</span><br><span class="line">        // 全局点击事件委托</span><br><span class="line">        document.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;</span><br><span class="line">            // 处理导航链接</span><br><span class="line">            if (e.target.matches(&#x27;[data-link]&#x27;)) &#123;</span><br><span class="line">                e.preventDefault();</span><br><span class="line">                const href = e.target.getAttribute(&#x27;href&#x27;);</span><br><span class="line">                this.router.navigate(href);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            // 处理模态框关闭</span><br><span class="line">            if (e.target.matches(&#x27;.modal-overlay, .modal-close&#x27;)) &#123;</span><br><span class="line">                this.closeModal();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        // 全局搜索表单提交</span><br><span class="line">        const searchForm = document.getElementById(&#x27;search-form&#x27;);</span><br><span class="line">        if (searchForm) &#123;</span><br><span class="line">            searchForm.addEventListener(&#x27;submit&#x27;, (e) =&gt; &#123;</span><br><span class="line">                e.preventDefault();</span><br><span class="line">                const keyword = document.getElementById(&#x27;search-input&#x27;).value;</span><br><span class="line">                if (keyword.trim()) &#123;</span><br><span class="line">                    this.router.navigate(`/search?q=$&#123;encodeURIComponent(keyword)&#125;`);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async checkAuthStatus() &#123;</span><br><span class="line">        const token = localStorage.getItem(&#x27;token&#x27;);</span><br><span class="line">        if (token) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                const user = await this.auth.getCurrentUser();</span><br><span class="line">                this.store.setState(&#123; user, isAuthenticated: true &#125;);</span><br><span class="line">                this.updateUserMenu(user);</span><br><span class="line">            &#125; catch (error) &#123;</span><br><span class="line">                console.error(&#x27;获取用户信息失败:&#x27;, error);</span><br><span class="line">                localStorage.removeItem(&#x27;token&#x27;);</span><br><span class="line">                this.store.setState(&#123; user: null, isAuthenticated: false &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    updateUserMenu(user) &#123;</span><br><span class="line">        const userMenu = document.getElementById(&#x27;user-menu&#x27;);</span><br><span class="line">        if (!userMenu) return;</span><br><span class="line">        </span><br><span class="line">        if (user) &#123;</span><br><span class="line">            userMenu.innerHTML = `</span><br><span class="line">                &lt;div class=&quot;user-profile&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;user-avatar&quot;&gt;</span><br><span class="line">                        &lt;img src=&quot;$&#123;user.avatarUrl || &#x27;assets/images/default-avatar.png&#x27;&#125;&quot; alt=&quot;$&#123;user.username&#125;&quot;&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;user-dropdown&quot;&gt;</span><br><span class="line">                        &lt;a href=&quot;/profile&quot; data-link&gt;&lt;i class=&quot;fas fa-user&quot;&gt;&lt;/i&gt; 个人资料&lt;/a&gt;</span><br><span class="line">                        &lt;a href=&quot;/dashboard&quot; data-link&gt;&lt;i class=&quot;fas fa-tachometer-alt&quot;&gt;&lt;/i&gt; 控制台&lt;/a&gt;</span><br><span class="line">                        &lt;a href=&quot;/admin&quot; data-link&gt;&lt;i class=&quot;fas fa-cog&quot;&gt;&lt;/i&gt; 管理后台&lt;/a&gt;</span><br><span class="line">                        &lt;hr&gt;</span><br><span class="line">                        &lt;a href=&quot;#&quot; id=&quot;logout&quot;&gt;&lt;i class=&quot;fas fa-sign-out-alt&quot;&gt;&lt;/i&gt; 退出登录&lt;/a&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            `;</span><br><span class="line">            </span><br><span class="line">            document.getElementById(&#x27;logout&#x27;).addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;</span><br><span class="line">                e.preventDefault();</span><br><span class="line">                this.auth.logout();</span><br><span class="line">                window.location.href = &#x27;/&#x27;;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            userMenu.innerHTML = `</span><br><span class="line">                &lt;div class=&quot;auth-links&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;/login&quot; class=&quot;btn btn-outline&quot; data-link&gt;登录&lt;/a&gt;</span><br><span class="line">                    &lt;a href=&quot;/register&quot; class=&quot;btn btn-primary&quot; data-link&gt;注册&lt;/a&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            `;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    initUI() &#123;</span><br><span class="line">        // 初始化导航栏</span><br><span class="line">        new Header();</span><br><span class="line">        </span><br><span class="line">        // 初始化侧边栏</span><br><span class="line">        this.loadSidebarContent();</span><br><span class="line">        </span><br><span class="line">        // 监听store变化</span><br><span class="line">        this.store.subscribe((state) =&gt; &#123;</span><br><span class="line">            if (state.user !== this.lastUserState) &#123;</span><br><span class="line">                this.updateUserMenu(state.user);</span><br><span class="line">                this.lastUserState = state.user;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async loadSidebarContent() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            // 加载最新文章</span><br><span class="line">            const recentPosts = await this.api.getArticles(&#123; page: 0, size: 5 &#125;);</span><br><span class="line">            this.renderRecentPosts(recentPosts.content);</span><br><span class="line">            </span><br><span class="line">            // 加载标签</span><br><span class="line">            const tags = await this.api.getTags();</span><br><span class="line">            this.renderTagCloud(tags);</span><br><span class="line">        &#125; catch (error) &#123;</span><br><span class="line">            console.error(&#x27;加载侧边栏内容失败:&#x27;, error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    renderRecentPosts(posts) &#123;</span><br><span class="line">        const container = document.getElementById(&#x27;recent-posts&#x27;);</span><br><span class="line">        if (!container) return;</span><br><span class="line">        </span><br><span class="line">        container.innerHTML = posts.map(post =&gt; `</span><br><span class="line">            &lt;div class=&quot;post-item&quot;&gt;</span><br><span class="line">                $&#123;post.coverImage ? `</span><br><span class="line">                    &lt;div class=&quot;post-thumbnail&quot;&gt;</span><br><span class="line">                        &lt;img src=&quot;$&#123;post.coverImage&#125;&quot; alt=&quot;$&#123;post.title&#125;&quot;&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                ` : &#x27;&#x27;&#125;</span><br><span class="line">                &lt;div class=&quot;post-info&quot;&gt;</span><br><span class="line">                    &lt;h4&gt;&lt;a href=&quot;/article/$&#123;post.id&#125;&quot; data-link&gt;$&#123;post.title&#125;&lt;/a&gt;&lt;/h4&gt;</span><br><span class="line">                    &lt;div class=&quot;post-date&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;far fa-calendar&quot;&gt;&lt;/i&gt; $&#123;new Date(post.createdAt).toLocaleDateString()&#125;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        `).join(&#x27;&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    renderTagCloud(tags) &#123;</span><br><span class="line">        const container = document.getElementById(&#x27;tag-cloud&#x27;);</span><br><span class="line">        if (!container) return;</span><br><span class="line">        </span><br><span class="line">        container.innerHTML = tags.map(tag =&gt; `</span><br><span class="line">            &lt;a href=&quot;/tag/$&#123;tag.id&#125;&quot; class=&quot;tag-cloud&quot; data-link&gt;$&#123;tag.name&#125;&lt;/a&gt;</span><br><span class="line">        `).join(&#x27;&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    showModal(content) &#123;</span><br><span class="line">        const modalContainer = document.getElementById(&#x27;modal-container&#x27;);</span><br><span class="line">        modalContainer.innerHTML = `</span><br><span class="line">            &lt;div class=&quot;modal-overlay&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;modal&quot;&gt;</span><br><span class="line">                    &lt;button class=&quot;modal-close&quot;&gt;&lt;i class=&quot;fas fa-times&quot;&gt;&lt;/i&gt;&lt;/button&gt;</span><br><span class="line">                    &lt;div class=&quot;modal-content&quot;&gt;$&#123;content&#125;&lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        `;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    closeModal() &#123;</span><br><span class="line">        const modalContainer = document.getElementById(&#x27;modal-container&#x27;);</span><br><span class="line">        modalContainer.innerHTML = &#x27;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    showLoading() &#123;</span><br><span class="line">        this.loading.show();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    hideLoading() &#123;</span><br><span class="line">        this.loading.hide();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 启动应用</span><br><span class="line">document.addEventListener(&#x27;DOMContentLoaded&#x27;, () =&gt; &#123;</span><br><span class="line">    window.app = new App();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p><strong>js&#x2F;api.js</strong></p>
<p>javascript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line">// API封装层</span><br><span class="line">export class API &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        this.baseURL = &#x27;http://localhost:8080/api&#x27;;</span><br><span class="line">        this.defaultHeaders = &#123;</span><br><span class="line">            &#x27;Content-Type&#x27;: &#x27;application/json&#x27;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async request(endpoint, options = &#123;&#125;) &#123;</span><br><span class="line">        const url = `$&#123;this.baseURL&#125;$&#123;endpoint&#125;`;</span><br><span class="line">        const token = localStorage.getItem(&#x27;token&#x27;);</span><br><span class="line">        </span><br><span class="line">        const headers = &#123;</span><br><span class="line">            ...this.defaultHeaders,</span><br><span class="line">            ...options.headers</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        if (token) &#123;</span><br><span class="line">            headers[&#x27;Authorization&#x27;] = `Bearer $&#123;token&#125;`;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        const config = &#123;</span><br><span class="line">            ...options,</span><br><span class="line">            headers</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        try &#123;</span><br><span class="line">            const response = await fetch(url, config);</span><br><span class="line">            </span><br><span class="line">            if (!response.ok) &#123;</span><br><span class="line">                const error = await response.json();</span><br><span class="line">                throw new Error(error.message || `HTTP $&#123;response.status&#125;`);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            const contentType = response.headers.get(&#x27;content-type&#x27;);</span><br><span class="line">            if (contentType &amp;&amp; contentType.includes(&#x27;application/json&#x27;)) &#123;</span><br><span class="line">                return await response.json();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            return await response.text();</span><br><span class="line">        &#125; catch (error) &#123;</span><br><span class="line">            console.error(&#x27;API请求失败:&#x27;, error);</span><br><span class="line">            throw error;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 认证相关</span><br><span class="line">    async login(credentials) &#123;</span><br><span class="line">        return this.request(&#x27;/auth/login&#x27;, &#123;</span><br><span class="line">            method: &#x27;POST&#x27;,</span><br><span class="line">            body: JSON.stringify(credentials)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async register(userData) &#123;</span><br><span class="line">        return this.request(&#x27;/auth/register&#x27;, &#123;</span><br><span class="line">            method: &#x27;POST&#x27;,</span><br><span class="line">            body: JSON.stringify(userData)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async getCurrentUser() &#123;</span><br><span class="line">        return this.request(&#x27;/auth/me&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 文章相关</span><br><span class="line">    async getArticles(params = &#123;&#125;) &#123;</span><br><span class="line">        const query = new URLSearchParams(params).toString();</span><br><span class="line">        return this.request(`/articles/public$&#123;query ? &#x27;?&#x27; + query : &#x27;&#x27;&#125;`);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async getArticle(id) &#123;</span><br><span class="line">        return this.request(`/articles/public/$&#123;id&#125;`);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async createArticle(article) &#123;</span><br><span class="line">        return this.request(&#x27;/articles&#x27;, &#123;</span><br><span class="line">            method: &#x27;POST&#x27;,</span><br><span class="line">            body: JSON.stringify(article)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async updateArticle(id, article) &#123;</span><br><span class="line">        return this.request(`/articles/$&#123;id&#125;`, &#123;</span><br><span class="line">            method: &#x27;PUT&#x27;,</span><br><span class="line">            body: JSON.stringify(article)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async deleteArticle(id) &#123;</span><br><span class="line">        return this.request(`/articles/$&#123;id&#125;`, &#123;</span><br><span class="line">            method: &#x27;DELETE&#x27;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async likeArticle(id) &#123;</span><br><span class="line">        return this.request(`/articles/$&#123;id&#125;/like`, &#123;</span><br><span class="line">            method: &#x27;POST&#x27;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async getFeaturedArticles() &#123;</span><br><span class="line">        return this.request(&#x27;/articles/public/featured&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async getPopularArticles() &#123;</span><br><span class="line">        return this.request(&#x27;/articles/public/popular&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 评论相关</span><br><span class="line">    async getComments(articleId, params = &#123;&#125;) &#123;</span><br><span class="line">        const query = new URLSearchParams(params).toString();</span><br><span class="line">        return this.request(`/comments/public/articles/$&#123;articleId&#125;$&#123;query ? &#x27;?&#x27; + query : &#x27;&#x27;&#125;`);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async createComment(articleId, comment) &#123;</span><br><span class="line">        return this.request(`/comments`, &#123;</span><br><span class="line">            method: &#x27;POST&#x27;,</span><br><span class="line">            body: JSON.stringify(&#123;</span><br><span class="line">                ...comment,</span><br><span class="line">                articleId</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async deleteComment(id) &#123;</span><br><span class="line">        return this.request(`/comments/$&#123;id&#125;`, &#123;</span><br><span class="line">            method: &#x27;DELETE&#x27;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 标签相关</span><br><span class="line">    async getTags() &#123;</span><br><span class="line">        return this.request(&#x27;/tags&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async getTag(id) &#123;</span><br><span class="line">        return this.request(`/tags/$&#123;id&#125;`);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 分类相关</span><br><span class="line">    async getCategories() &#123;</span><br><span class="line">        return this.request(&#x27;/categories&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async getCategory(id) &#123;</span><br><span class="line">        return this.request(`/categories/$&#123;id&#125;`);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 文件上传</span><br><span class="line">    async uploadFile(file) &#123;</span><br><span class="line">        const formData = new FormData();</span><br><span class="line">        formData.append(&#x27;file&#x27;, file);</span><br><span class="line">        </span><br><span class="line">        return this.request(&#x27;/files/upload&#x27;, &#123;</span><br><span class="line">            method: &#x27;POST&#x27;,</span><br><span class="line">            headers: &#123;&#125;,</span><br><span class="line">            body: formData</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>js&#x2F;router.js</strong></p>
<p>javascript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">// 前端路由</span><br><span class="line">export class Router &#123;</span><br><span class="line">    constructor(app) &#123;</span><br><span class="line">        this.app = app;</span><br><span class="line">        this.routes = new Map();</span><br><span class="line">        this.initRoutes();</span><br><span class="line">        this.init();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    initRoutes() &#123;</span><br><span class="line">        // 页面路由</span><br><span class="line">        this.routes.set(&#x27;/&#x27;, () =&gt; this.loadPage(&#x27;home&#x27;));</span><br><span class="line">        this.routes.set(&#x27;/article/:id&#x27;, (params) =&gt; this.loadArticlePage(params.id));</span><br><span class="line">        this.routes.set(&#x27;/login&#x27;, () =&gt; this.loadPage(&#x27;login&#x27;));</span><br><span class="line">        this.routes.set(&#x27;/register&#x27;, () =&gt; this.loadPage(&#x27;register&#x27;));</span><br><span class="line">        this.routes.set(&#x27;/admin&#x27;, () =&gt; this.loadPage(&#x27;admin&#x27;));</span><br><span class="line">        this.routes.set(&#x27;/search&#x27;, (_, query) =&gt; this.loadSearchPage(query.get(&#x27;q&#x27;)));</span><br><span class="line">        this.routes.set(&#x27;/tag/:id&#x27;, (params) =&gt; this.loadTagPage(params.id));</span><br><span class="line">        this.routes.set(&#x27;/category/:id&#x27;, (params) =&gt; this.loadCategoryPage(params.id));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    init() &#123;</span><br><span class="line">        // 监听popstate事件</span><br><span class="line">        window.addEventListener(&#x27;popstate&#x27;, () =&gt; &#123;</span><br><span class="line">            this.handleRoute(window.location.pathname);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        // 初始路由</span><br><span class="line">        this.handleRoute(window.location.pathname);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    navigate(path) &#123;</span><br><span class="line">        history.pushState(&#123;&#125;, &#x27;&#x27;, path);</span><br><span class="line">        this.handleRoute(path);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async handleRoute(path) &#123;</span><br><span class="line">        const url = new URL(path, window.location.origin);</span><br><span class="line">        const pathname = url.pathname;</span><br><span class="line">        </span><br><span class="line">        // 解析路径参数</span><br><span class="line">        for (const [route, handler] of this.routes) &#123;</span><br><span class="line">            const params = this.matchRoute(route, pathname);</span><br><span class="line">            if (params !== null) &#123;</span><br><span class="line">                this.app.showLoading();</span><br><span class="line">                try &#123;</span><br><span class="line">                    await handler(params, url.searchParams);</span><br><span class="line">                &#125; finally &#123;</span><br><span class="line">                    this.app.hideLoading();</span><br><span class="line">                &#125;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 未匹配的路由</span><br><span class="line">        this.loadPage(&#x27;404&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    matchRoute(route, pathname) &#123;</span><br><span class="line">        const routeParts = route.split(&#x27;/&#x27;);</span><br><span class="line">        const pathParts = pathname.split(&#x27;/&#x27;).filter(p =&gt; p);</span><br><span class="line">        </span><br><span class="line">        if (routeParts.length !== pathParts.length) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        const params = &#123;&#125;;</span><br><span class="line">        </span><br><span class="line">        for (let i = 0; i &lt; routeParts.length; i++) &#123;</span><br><span class="line">            const routePart = routeParts[i];</span><br><span class="line">            const pathPart = pathParts[i];</span><br><span class="line">            </span><br><span class="line">            if (routePart.startsWith(&#x27;:&#x27;)) &#123;</span><br><span class="line">                const paramName = routePart.slice(1);</span><br><span class="line">                params[paramName] = pathPart;</span><br><span class="line">            &#125; else if (routePart !== pathPart) &#123;</span><br><span class="line">                return null;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return params;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async loadPage(pageName) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            const module = await import(`./pages/$&#123;pageName&#125;.js`);</span><br><span class="line">            const content = await module.render(this.app);</span><br><span class="line">            this.updateContent(content);</span><br><span class="line">        &#125; catch (error) &#123;</span><br><span class="line">            console.error(`加载页面 $&#123;pageName&#125; 失败:`, error);</span><br><span class="line">            this.loadPage(&#x27;404&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async loadArticlePage(articleId) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            const module = await import(&#x27;./pages/article.js&#x27;);</span><br><span class="line">            const content = await module.render(this.app, articleId);</span><br><span class="line">            this.updateContent(content);</span><br><span class="line">        &#125; catch (error) &#123;</span><br><span class="line">            console.error(&#x27;加载文章页面失败:&#x27;, error);</span><br><span class="line">            this.loadPage(&#x27;404&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async loadSearchPage(keyword) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            const module = await import(&#x27;./pages/search.js&#x27;);</span><br><span class="line">            const content = await module.render(this.app, keyword);</span><br><span class="line">            this.updateContent(content);</span><br><span class="line">        &#125; catch (error) &#123;</span><br><span class="line">            console.error(&#x27;加载搜索页面失败:&#x27;, error);</span><br><span class="line">            this.loadPage(&#x27;404&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async loadTagPage(tagId) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            const module = await import(&#x27;./pages/tag.js&#x27;);</span><br><span class="line">            const content = await module.render(this.app, tagId);</span><br><span class="line">            this.updateContent(content);</span><br><span class="line">        &#125; catch (error) &#123;</span><br><span class="line">            console.error(&#x27;加载标签页面失败:&#x27;, error);</span><br><span class="line">            this.loadPage(&#x27;404&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async loadCategoryPage(categoryId) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            const module = await import(&#x27;./pages/category.js&#x27;);</span><br><span class="line">            const content = await module.render(this.app, categoryId);</span><br><span class="line">            this.updateContent(content);</span><br><span class="line">        &#125; catch (error) &#123;</span><br><span class="line">            console.error(&#x27;加载分类页面失败:&#x27;, error);</span><br><span class="line">            this.loadPage(&#x27;404&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    updateContent(content) &#123;</span><br><span class="line">        const container = document.getElementById(&#x27;content-left&#x27;);</span><br><span class="line">        if (container) &#123;</span><br><span class="line">            container.innerHTML = content;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>js&#x2F;store.js</strong></p>
<p>javascript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">// 状态管理</span><br><span class="line">export class Store &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            user: null,</span><br><span class="line">            isAuthenticated: false,</span><br><span class="line">            articles: [],</span><br><span class="line">            currentArticle: null,</span><br><span class="line">            comments: [],</span><br><span class="line">            tags: [],</span><br><span class="line">            categories: []</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        this.listeners = [];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    getState() &#123;</span><br><span class="line">        return this.state;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    setState(newState) &#123;</span><br><span class="line">        this.state = &#123; ...this.state, ...newState &#125;;</span><br><span class="line">        this.notify();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    subscribe(listener) &#123;</span><br><span class="line">        this.listeners.push(listener);</span><br><span class="line">        return () =&gt; &#123;</span><br><span class="line">            const index = this.listeners.indexOf(listener);</span><br><span class="line">            if (index &gt; -1) &#123;</span><br><span class="line">                this.listeners.splice(index, 1);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    notify() &#123;</span><br><span class="line">        this.listeners.forEach(listener =&gt; listener(this.state));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>js&#x2F;auth.js</strong></p>
<p>javascript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">// 认证管理</span><br><span class="line">export class Auth &#123;</span><br><span class="line">    constructor(store) &#123;</span><br><span class="line">        this.store = store;</span><br><span class="line">        this.api = new API();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async login(credentials) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            const response = await this.api.login(credentials);</span><br><span class="line">            </span><br><span class="line">            // 保存token</span><br><span class="line">            localStorage.setItem(&#x27;token&#x27;, response.accessToken);</span><br><span class="line">            </span><br><span class="line">            // 更新store状态</span><br><span class="line">            this.store.setState(&#123;</span><br><span class="line">                user: response.user,</span><br><span class="line">                isAuthenticated: true</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">            return response.user;</span><br><span class="line">        &#125; catch (error) &#123;</span><br><span class="line">            console.error(&#x27;登录失败:&#x27;, error);</span><br><span class="line">            throw error;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async register(userData) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            const user = await this.api.register(userData);</span><br><span class="line">            return user;</span><br><span class="line">        &#125; catch (error) &#123;</span><br><span class="line">            console.error(&#x27;注册失败:&#x27;, error);</span><br><span class="line">            throw error;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async getCurrentUser() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            const user = await this.api.getCurrentUser();</span><br><span class="line">            return user;</span><br><span class="line">        &#125; catch (error) &#123;</span><br><span class="line">            console.error(&#x27;获取用户信息失败:&#x27;, error);</span><br><span class="line">            throw error;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    logout() &#123;</span><br><span class="line">        localStorage.removeItem(&#x27;token&#x27;);</span><br><span class="line">        this.store.setState(&#123;</span><br><span class="line">            user: null,</span><br><span class="line">            isAuthenticated: false</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    isAuthenticated() &#123;</span><br><span class="line">        const token = localStorage.getItem(&#x27;token&#x27;);</span><br><span class="line">        return !!token;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    getToken() &#123;</span><br><span class="line">        return localStorage.getItem(&#x27;token&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5-页面模块"><a href="#5-页面模块" class="headerlink" title="5. 页面模块"></a>5. 页面模块</h3><p><strong>js&#x2F;pages&#x2F;home.js</strong></p>
<p>javascript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">// 首页</span><br><span class="line">import &#123; ArticleList &#125; from &#x27;../components/article-list.js&#x27;;</span><br><span class="line">import &#123; Pagination &#125; from &#x27;../components/pagination.js&#x27;;</span><br><span class="line"></span><br><span class="line">export async function render(app) &#123;</span><br><span class="line">    const articles = await app.api.getArticles(&#123; page: 0, size: 10 &#125;);</span><br><span class="line">    </span><br><span class="line">    return `</span><br><span class="line">        &lt;div class=&quot;home-page&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;page-header&quot;&gt;</span><br><span class="line">                &lt;h1&gt;最新文章&lt;/h1&gt;</span><br><span class="line">                &lt;p&gt;分享编程心得和技术经验&lt;/p&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;div id=&quot;articles-container&quot;&gt;</span><br><span class="line">                $&#123;ArticleList.render(articles.content)&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;div id=&quot;pagination-container&quot;&gt;</span><br><span class="line">                $&#123;Pagination.render(&#123;</span><br><span class="line">                    currentPage: articles.number,</span><br><span class="line">                    totalPages: articles.totalPages,</span><br><span class="line">                    totalItems: articles.totalElements</span><br><span class="line">                &#125;)&#125;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    `;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function init(app) &#123;</span><br><span class="line">    // 初始化分页</span><br><span class="line">    const pagination = document.getElementById(&#x27;pagination-container&#x27;);</span><br><span class="line">    if (pagination) &#123;</span><br><span class="line">        pagination.addEventListener(&#x27;click&#x27;, async (e) =&gt; &#123;</span><br><span class="line">            if (e.target.matches(&#x27;.page-link&#x27;)) &#123;</span><br><span class="line">                e.preventDefault();</span><br><span class="line">                </span><br><span class="line">                const page = parseInt(e.target.dataset.page);</span><br><span class="line">                if (!isNaN(page)) &#123;</span><br><span class="line">                    app.showLoading();</span><br><span class="line">                    try &#123;</span><br><span class="line">                        const articles = await app.api.getArticles(&#123; page, size: 10 &#125;);</span><br><span class="line">                        document.getElementById(&#x27;articles-container&#x27;).innerHTML = </span><br><span class="line">                            ArticleList.render(articles.content);</span><br><span class="line">                        </span><br><span class="line">                        document.getElementById(&#x27;pagination-container&#x27;).innerHTML = </span><br><span class="line">                            Pagination.render(&#123;</span><br><span class="line">                                currentPage: articles.number,</span><br><span class="line">                                totalPages: articles.totalPages,</span><br><span class="line">                                totalItems: articles.totalElements</span><br><span class="line">                            &#125;);</span><br><span class="line">                    &#125; finally &#123;</span><br><span class="line">                        app.hideLoading();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>js&#x2F;pages&#x2F;article.js</strong></p>
<p>javascript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line">// 文章详情页</span><br><span class="line">import &#123; CommentForm &#125; from &#x27;../components/comment-form.js&#x27;;</span><br><span class="line">import &#123; CommentList &#125; from &#x27;../components/comment-list.js&#x27;;</span><br><span class="line"></span><br><span class="line">export async function render(app, articleId) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        const article = await app.api.getArticle(articleId);</span><br><span class="line">        const comments = await app.api.getComments(articleId);</span><br><span class="line">        </span><br><span class="line">        return `</span><br><span class="line">            &lt;article class=&quot;article-detail&quot;&gt;</span><br><span class="line">                &lt;header class=&quot;article-header&quot;&gt;</span><br><span class="line">                    &lt;h1 class=&quot;article-title&quot;&gt;$&#123;article.title&#125;&lt;/h1&gt;</span><br><span class="line">                    &lt;div class=&quot;article-meta&quot;&gt;</span><br><span class="line">                        &lt;span class=&quot;meta-item&quot;&gt;</span><br><span class="line">                            &lt;i class=&quot;far fa-user&quot;&gt;&lt;/i&gt; $&#123;article.author.displayName&#125;</span><br><span class="line">                        &lt;/span&gt;</span><br><span class="line">                        &lt;span class=&quot;meta-item&quot;&gt;</span><br><span class="line">                            &lt;i class=&quot;far fa-calendar&quot;&gt;&lt;/i&gt; $&#123;new Date(article.publishedAt).toLocaleDateString()&#125;</span><br><span class="line">                        &lt;/span&gt;</span><br><span class="line">                        &lt;span class=&quot;meta-item&quot;&gt;</span><br><span class="line">                            &lt;i class=&quot;far fa-eye&quot;&gt;&lt;/i&gt; $&#123;article.viewCount&#125; 阅读</span><br><span class="line">                        &lt;/span&gt;</span><br><span class="line">                        &lt;span class=&quot;meta-item&quot;&gt;</span><br><span class="line">                            &lt;i class=&quot;far fa-comment&quot;&gt;&lt;/i&gt; $&#123;article.commentCount&#125; 评论</span><br><span class="line">                        &lt;/span&gt;</span><br><span class="line">                        &lt;span class=&quot;meta-item&quot;&gt;</span><br><span class="line">                            &lt;i class=&quot;far fa-heart&quot;&gt;&lt;/i&gt; $&#123;article.likeCount&#125; 喜欢</span><br><span class="line">                        &lt;/span&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/header&gt;</span><br><span class="line">                </span><br><span class="line">                $&#123;article.coverImage ? `</span><br><span class="line">                    &lt;div class=&quot;article-cover&quot;&gt;</span><br><span class="line">                        &lt;img src=&quot;$&#123;article.coverImage&#125;&quot; alt=&quot;$&#123;article.title&#125;&quot;&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                ` : &#x27;&#x27;&#125;</span><br><span class="line">                </span><br><span class="line">                &lt;div class=&quot;article-content&quot;&gt;</span><br><span class="line">                    $&#123;article.content&#125;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                </span><br><span class="line">                &lt;footer class=&quot;article-footer&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;article-tags&quot;&gt;</span><br><span class="line">                        $&#123;article.tags.map(tag =&gt; `</span><br><span class="line">                            &lt;a href=&quot;/tag/$&#123;tag.id&#125;&quot; class=&quot;tag&quot; data-link&gt;#$&#123;tag.name&#125;&lt;/a&gt;</span><br><span class="line">                        `).join(&#x27;&#x27;)&#125;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    </span><br><span class="line">                    &lt;div class=&quot;article-actions&quot;&gt;</span><br><span class="line">                        &lt;button class=&quot;btn btn-outline&quot; id=&quot;like-btn&quot;&gt;</span><br><span class="line">                            &lt;i class=&quot;far fa-heart&quot;&gt;&lt;/i&gt; 喜欢 ($&#123;article.likeCount&#125;)</span><br><span class="line">                        &lt;/button&gt;</span><br><span class="line">                        &lt;button class=&quot;btn btn-outline&quot; id=&quot;share-btn&quot;&gt;</span><br><span class="line">                            &lt;i class=&quot;fas fa-share-alt&quot;&gt;&lt;/i&gt; 分享</span><br><span class="line">                        &lt;/button&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/footer&gt;</span><br><span class="line">            &lt;/article&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;div class=&quot;comments-section&quot;&gt;</span><br><span class="line">                &lt;h3 class=&quot;comments-title&quot;&gt;评论 ($&#123;article.commentCount&#125;)&lt;/h3&gt;</span><br><span class="line">                </span><br><span class="line">                $&#123;article.allowComment ? CommentForm.render(articleId) : `</span><br><span class="line">                    &lt;div class=&quot;alert alert-info&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-info-circle&quot;&gt;&lt;/i&gt; 评论功能已关闭</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                `&#125;</span><br><span class="line">                </span><br><span class="line">                &lt;div id=&quot;comments-list&quot;&gt;</span><br><span class="line">                    $&#123;CommentList.render(comments)&#125;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        `;</span><br><span class="line">    &#125; catch (error) &#123;</span><br><span class="line">        console.error(&#x27;加载文章失败:&#x27;, error);</span><br><span class="line">        return `</span><br><span class="line">            &lt;div class=&quot;error-container&quot;&gt;</span><br><span class="line">                &lt;h2&gt;文章加载失败&lt;/h2&gt;</span><br><span class="line">                &lt;p&gt;$&#123;error.message&#125;&lt;/p&gt;</span><br><span class="line">                &lt;a href=&quot;/&quot; class=&quot;btn btn-primary&quot; data-link&gt;返回首页&lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        `;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function init(app, articleId) &#123;</span><br><span class="line">    // 点赞功能</span><br><span class="line">    const likeBtn = document.getElementById(&#x27;like-btn&#x27;);</span><br><span class="line">    if (likeBtn) &#123;</span><br><span class="line">        likeBtn.addEventListener(&#x27;click&#x27;, async () =&gt; &#123;</span><br><span class="line">            if (!app.store.state.isAuthenticated) &#123;</span><br><span class="line">                app.showModal(`</span><br><span class="line">                    &lt;h3&gt;需要登录&lt;/h3&gt;</span><br><span class="line">                    &lt;p&gt;请登录后再点赞&lt;/p&gt;</span><br><span class="line">                    &lt;div class=&quot;modal-actions&quot;&gt;</span><br><span class="line">                        &lt;a href=&quot;/login&quot; class=&quot;btn btn-primary&quot; data-link&gt;去登录&lt;/a&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                `);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            try &#123;</span><br><span class="line">                await app.api.likeArticle(articleId);</span><br><span class="line">                const count = parseInt(likeBtn.querySelector(&#x27;i&#x27;).nextSibling.textContent.match(/\d+/)[0]);</span><br><span class="line">                likeBtn.innerHTML = `&lt;i class=&quot;far fa-heart&quot;&gt;&lt;/i&gt; 喜欢 ($&#123;count + 1&#125;)`;</span><br><span class="line">                likeBtn.disabled = true;</span><br><span class="line">            &#125; catch (error) &#123;</span><br><span class="line">                console.error(&#x27;点赞失败:&#x27;, error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 评论表单</span><br><span class="line">    const commentForm = document.getElementById(&#x27;comment-form&#x27;);</span><br><span class="line">    if (commentForm) &#123;</span><br><span class="line">        commentForm.addEventListener(&#x27;submit&#x27;, async (e) =&gt; &#123;</span><br><span class="line">            e.preventDefault();</span><br><span class="line">            </span><br><span class="line">            if (!app.store.state.isAuthenticated) &#123;</span><br><span class="line">                app.showModal(`</span><br><span class="line">                    &lt;h3&gt;需要登录&lt;/h3&gt;</span><br><span class="line">                    &lt;p&gt;请登录后再评论&lt;/p&gt;</span><br><span class="line">                    &lt;div class=&quot;modal-actions&quot;&gt;</span><br><span class="line">                        &lt;a href=&quot;/login&quot; class=&quot;btn btn-primary&quot; data-link&gt;去登录&lt;/a&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                `);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            const content = document.getElementById(&#x27;comment-content&#x27;).value.trim();</span><br><span class="line">            if (!content) &#123;</span><br><span class="line">                alert(&#x27;请输入评论内容&#x27;);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            try &#123;</span><br><span class="line">                const comment = await app.api.createComment(articleId, &#123; content &#125;);</span><br><span class="line">                </span><br><span class="line">                // 添加新评论到列表</span><br><span class="line">                const commentsList = document.getElementById(&#x27;comments-list&#x27;);</span><br><span class="line">                commentsList.innerHTML = CommentList.render([comment, ...JSON.parse(commentsList.dataset.comments || &#x27;[]&#x27;)]);</span><br><span class="line">                commentsList.dataset.comments = JSON.stringify([comment, ...JSON.parse(commentsList.dataset.comments || &#x27;[]&#x27;)]);</span><br><span class="line">                </span><br><span class="line">                // 清空表单</span><br><span class="line">                document.getElementById(&#x27;comment-content&#x27;).value = &#x27;&#x27;;</span><br><span class="line">                </span><br><span class="line">                // 更新评论计数</span><br><span class="line">                const commentsTitle = document.querySelector(&#x27;.comments-title&#x27;);</span><br><span class="line">                if (commentsTitle) &#123;</span><br><span class="line">                    const count = parseInt(commentsTitle.textContent.match(/\d+/)[0]);</span><br><span class="line">                    commentsTitle.textContent = `评论 ($&#123;count + 1&#125;)`;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (error) &#123;</span><br><span class="line">                console.error(&#x27;发表评论失败:&#x27;, error);</span><br><span class="line">                alert(&#x27;评论发表失败，请稍后重试&#x27;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>js&#x2F;pages&#x2F;login.js</strong></p>
<p>javascript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">// 登录页</span><br><span class="line">export function render(app) &#123;</span><br><span class="line">    return `</span><br><span class="line">        &lt;div class=&quot;auth-page&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;auth-card&quot;&gt;</span><br><span class="line">                &lt;h2&gt;登录&lt;/h2&gt;</span><br><span class="line">                &lt;form id=&quot;login-form&quot; class=&quot;auth-form&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">                        &lt;label for=&quot;username&quot;&gt;用户名&lt;/label&gt;</span><br><span class="line">                        &lt;input type=&quot;text&quot; id=&quot;username&quot; name=&quot;username&quot; required </span><br><span class="line">                               placeholder=&quot;请输入用户名&quot; autocomplete=&quot;username&quot;&gt;</span><br><span class="line">                        &lt;div class=&quot;form-error&quot; id=&quot;username-error&quot;&gt;&lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    </span><br><span class="line">                    &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">                        &lt;label for=&quot;password&quot;&gt;密码&lt;/label&gt;</span><br><span class="line">                        &lt;input type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot; required </span><br><span class="line">                               placeholder=&quot;请输入密码&quot; autocomplete=&quot;current-password&quot;&gt;</span><br><span class="line">                        &lt;div class=&quot;form-error&quot; id=&quot;password-error&quot;&gt;&lt;/div&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    </span><br><span class="line">                    &lt;div class=&quot;form-group form-check&quot;&gt;</span><br><span class="line">                        &lt;input type=&quot;checkbox&quot; id=&quot;remember-me&quot; name=&quot;remember&quot;&gt;</span><br><span class="line">                        &lt;label for=&quot;remember-me&quot;&gt;记住我&lt;/label&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    </span><br><span class="line">                    &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary btn-block&quot;&gt;登录&lt;/button&gt;</span><br><span class="line">                    </span><br><span class="line">                    &lt;div class=&quot;auth-footer&quot;&gt;</span><br><span class="line">                        &lt;p&gt;还没有账号？ &lt;a href=&quot;/register&quot; data-link&gt;立即注册&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">                        &lt;p&gt;&lt;a href=&quot;/forgot-password&quot; data-link&gt;忘记密码？&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/form&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    `;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function init(app) &#123;</span><br><span class="line">    const form = document.getElementById(&#x27;login-form&#x27;);</span><br><span class="line">    </span><br><span class="line">    form.addEventListener(&#x27;submit&#x27;, async (e) =&gt; &#123;</span><br><span class="line">        e.preventDefault();</span><br><span class="line">        </span><br><span class="line">        // 清除错误信息</span><br><span class="line">        clearErrors();</span><br><span class="line">        </span><br><span class="line">        // 获取表单数据</span><br><span class="line">        const credentials = &#123;</span><br><span class="line">            username: document.getElementById(&#x27;username&#x27;).value,</span><br><span class="line">            password: document.getElementById(&#x27;password&#x27;).value</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        // 验证输入</span><br><span class="line">        if (!validateForm(credentials)) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 显示加载状态</span><br><span class="line">        const submitBtn = form.querySelector(&#x27;button[type=&quot;submit&quot;]&#x27;);</span><br><span class="line">        const originalText = submitBtn.textContent;</span><br><span class="line">        submitBtn.innerHTML = &#x27;&lt;i class=&quot;fas fa-spinner fa-spin&quot;&gt;&lt;/i&gt; 登录中...&#x27;;</span><br><span class="line">        submitBtn.disabled = true;</span><br><span class="line">        </span><br><span class="line">        try &#123;</span><br><span class="line">            const user = await app.auth.login(credentials);</span><br><span class="line">            </span><br><span class="line">            // 登录成功，重定向到首页或上一页</span><br><span class="line">            const redirectTo = new URLSearchParams(window.location.search).get(&#x27;redirect&#x27;) || &#x27;/&#x27;;</span><br><span class="line">            app.router.navigate(redirectTo);</span><br><span class="line">            </span><br><span class="line">        &#125; catch (error) &#123;</span><br><span class="line">            // 显示错误信息</span><br><span class="line">            if (error.message.includes(&#x27;用户名&#x27;) || error.message.includes(&#x27;密码&#x27;)) &#123;</span><br><span class="line">                showError(&#x27;password-error&#x27;, &#x27;用户名或密码错误&#x27;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                showError(&#x27;username-error&#x27;, &#x27;登录失败，请稍后重试&#x27;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            // 恢复按钮状态</span><br><span class="line">            submitBtn.textContent = originalText;</span><br><span class="line">            submitBtn.disabled = false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    function validateForm(credentials) &#123;</span><br><span class="line">        let isValid = true;</span><br><span class="line">        </span><br><span class="line">        if (!credentials.username.trim()) &#123;</span><br><span class="line">            showError(&#x27;username-error&#x27;, &#x27;请输入用户名&#x27;);</span><br><span class="line">            isValid = false;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (!credentials.password) &#123;</span><br><span class="line">            showError(&#x27;password-error&#x27;, &#x27;请输入密码&#x27;);</span><br><span class="line">            isValid = false;</span><br><span class="line">        &#125; else if (credentials.password.length &lt; 6) &#123;</span><br><span class="line">            showError(&#x27;password-error&#x27;, &#x27;密码长度至少6位&#x27;);</span><br><span class="line">            isValid = false;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return isValid;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function showError(elementId, message) &#123;</span><br><span class="line">        const element = document.getElementById(elementId);</span><br><span class="line">        if (element) &#123;</span><br><span class="line">            element.textContent = message;</span><br><span class="line">            element.style.display = &#x27;block&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function clearErrors() &#123;</span><br><span class="line">        const errorElements = document.querySelectorAll(&#x27;.form-error&#x27;);</span><br><span class="line">        errorElements.forEach(el =&gt; &#123;</span><br><span class="line">            el.textContent = &#x27;&#x27;;</span><br><span class="line">            el.style.display = &#x27;none&#x27;;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="6-组件"><a href="#6-组件" class="headerlink" title="6. 组件"></a>6. 组件</h3><p><strong>js&#x2F;components&#x2F;article-list.js</strong></p>
<p>javascript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">// 文章列表组件</span><br><span class="line">export class ArticleList &#123;</span><br><span class="line">    static render(articles) &#123;</span><br><span class="line">        if (!articles || articles.length === 0) &#123;</span><br><span class="line">            return `</span><br><span class="line">                &lt;div class=&quot;empty-state&quot;&gt;</span><br><span class="line">                    &lt;i class=&quot;far fa-newspaper&quot;&gt;&lt;/i&gt;</span><br><span class="line">                    &lt;h3&gt;暂无文章&lt;/h3&gt;</span><br><span class="line">                    &lt;p&gt;还没有发布任何文章&lt;/p&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            `;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return articles.map(article =&gt; `</span><br><span class="line">            &lt;article class=&quot;article-card&quot;&gt;</span><br><span class="line">                &lt;header class=&quot;article-header&quot;&gt;</span><br><span class="line">                    &lt;h2 class=&quot;article-title&quot;&gt;</span><br><span class="line">                        &lt;a href=&quot;/article/$&#123;article.id&#125;&quot; data-link&gt;$&#123;article.title&#125;&lt;/a&gt;</span><br><span class="line">                    &lt;/h2&gt;</span><br><span class="line">                    &lt;div class=&quot;article-meta&quot;&gt;</span><br><span class="line">                        &lt;span class=&quot;meta-item&quot;&gt;</span><br><span class="line">                            &lt;i class=&quot;far fa-user&quot;&gt;&lt;/i&gt; $&#123;article.author.displayName&#125;</span><br><span class="line">                        &lt;/span&gt;</span><br><span class="line">                        &lt;span class=&quot;meta-item&quot;&gt;</span><br><span class="line">                            &lt;i class=&quot;far fa-calendar&quot;&gt;&lt;/i&gt; $&#123;new Date(article.publishedAt).toLocaleDateString()&#125;</span><br><span class="line">                        &lt;/span&gt;</span><br><span class="line">                        &lt;span class=&quot;meta-item&quot;&gt;</span><br><span class="line">                            &lt;i class=&quot;far fa-eye&quot;&gt;&lt;/i&gt; $&#123;article.viewCount&#125; 阅读</span><br><span class="line">                        &lt;/span&gt;</span><br><span class="line">                        &lt;span class=&quot;meta-item&quot;&gt;</span><br><span class="line">                            &lt;i class=&quot;far fa-comment&quot;&gt;&lt;/i&gt; $&#123;article.commentCount&#125; 评论</span><br><span class="line">                        &lt;/span&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/header&gt;</span><br><span class="line">                </span><br><span class="line">                $&#123;article.summary ? `</span><br><span class="line">                    &lt;div class=&quot;article-excerpt&quot;&gt;</span><br><span class="line">                        &lt;p&gt;$&#123;article.summary&#125;&lt;/p&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                ` : &#x27;&#x27;&#125;</span><br><span class="line">                </span><br><span class="line">                &lt;footer class=&quot;article-footer&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;article-tags&quot;&gt;</span><br><span class="line">                        $&#123;article.tags.map(tag =&gt; `</span><br><span class="line">                            &lt;a href=&quot;/tag/$&#123;tag.id&#125;&quot; class=&quot;tag&quot; data-link&gt;$&#123;tag.name&#125;&lt;/a&gt;</span><br><span class="line">                        `).join(&#x27;&#x27;)&#125;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;a href=&quot;/article/$&#123;article.id&#125;&quot; class=&quot;read-more&quot; data-link&gt;</span><br><span class="line">                        阅读全文 &lt;i class=&quot;fas fa-arrow-right&quot;&gt;&lt;/i&gt;</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/footer&gt;</span><br><span class="line">            &lt;/article&gt;</span><br><span class="line">        `).join(&#x27;&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>js&#x2F;components&#x2F;comment-form.js</strong></p>
<p>javascript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// 评论表单组件</span><br><span class="line">export class CommentForm &#123;</span><br><span class="line">    static render(articleId) &#123;</span><br><span class="line">        return `</span><br><span class="line">            &lt;form id=&quot;comment-form&quot; class=&quot;comment-form&quot; data-article-id=&quot;$&#123;articleId&#125;&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">                    &lt;textarea id=&quot;comment-content&quot; class=&quot;form-control&quot; </span><br><span class="line">                              placeholder=&quot;写下你的评论...&quot; rows=&quot;4&quot; required&gt;&lt;/textarea&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">                    &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;发表评论&lt;/button&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/form&gt;</span><br><span class="line">        `;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="第三部分：数据库脚本"><a href="#第三部分：数据库脚本" class="headerlink" title="第三部分：数据库脚本"></a>第三部分：数据库脚本</h2><p><strong>blog_db.sql</strong></p>
<p>sql</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line">-- 创建数据库</span><br><span class="line">CREATE DATABASE IF NOT EXISTS blog_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;</span><br><span class="line">USE blog_db;</span><br><span class="line"></span><br><span class="line">-- 用户表</span><br><span class="line">CREATE TABLE users (</span><br><span class="line">    id BIGINT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    username VARCHAR(50) NOT NULL UNIQUE,</span><br><span class="line">    email VARCHAR(100) NOT NULL UNIQUE,</span><br><span class="line">    password_hash VARCHAR(255) NOT NULL,</span><br><span class="line">    display_name VARCHAR(100),</span><br><span class="line">    bio TEXT,</span><br><span class="line">    avatar_url VARCHAR(500),</span><br><span class="line">    role VARCHAR(20) NOT NULL DEFAULT &#x27;USER&#x27;,</span><br><span class="line">    is_active BOOLEAN DEFAULT TRUE,</span><br><span class="line">    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">    INDEX idx_username (username),</span><br><span class="line">    INDEX idx_email (email),</span><br><span class="line">    INDEX idx_created_at (created_at)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line">-- 文章表</span><br><span class="line">CREATE TABLE articles (</span><br><span class="line">    id BIGINT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    title VARCHAR(200) NOT NULL,</span><br><span class="line">    summary TEXT,</span><br><span class="line">    content LONGTEXT NOT NULL,</span><br><span class="line">    cover_image VARCHAR(500),</span><br><span class="line">    status VARCHAR(20) NOT NULL DEFAULT &#x27;DRAFT&#x27;,</span><br><span class="line">    view_count INT DEFAULT 0,</span><br><span class="line">    like_count INT DEFAULT 0,</span><br><span class="line">    comment_count INT DEFAULT 0,</span><br><span class="line">    is_featured BOOLEAN DEFAULT FALSE,</span><br><span class="line">    allow_comment BOOLEAN DEFAULT TRUE,</span><br><span class="line">    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">    published_at TIMESTAMP NULL,</span><br><span class="line">    author_id BIGINT NOT NULL,</span><br><span class="line">    category_id BIGINT,</span><br><span class="line">    FOREIGN KEY (author_id) REFERENCES users(id) ON DELETE CASCADE,</span><br><span class="line">    FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL,</span><br><span class="line">    INDEX idx_author_id (author_id),</span><br><span class="line">    INDEX idx_category_id (category_id),</span><br><span class="line">    INDEX idx_status_published (status, published_at),</span><br><span class="line">    INDEX idx_created_at (created_at),</span><br><span class="line">    INDEX idx_featured (is_featured, published_at),</span><br><span class="line">    FULLTEXT idx_search (title, summary, content)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line">-- 分类表</span><br><span class="line">CREATE TABLE categories (</span><br><span class="line">    id BIGINT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    name VARCHAR(100) NOT NULL,</span><br><span class="line">    slug VARCHAR(100) UNIQUE,</span><br><span class="line">    description VARCHAR(200),</span><br><span class="line">    parent_id BIGINT,</span><br><span class="line">    sort_order INT DEFAULT 0,</span><br><span class="line">    article_count INT DEFAULT 0,</span><br><span class="line">    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">    FOREIGN KEY (parent_id) REFERENCES categories(id) ON DELETE CASCADE,</span><br><span class="line">    INDEX idx_parent_id (parent_id),</span><br><span class="line">    INDEX idx_slug (slug)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line">-- 标签表</span><br><span class="line">CREATE TABLE tags (</span><br><span class="line">    id BIGINT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    name VARCHAR(50) NOT NULL UNIQUE,</span><br><span class="line">    slug VARCHAR(50) UNIQUE,</span><br><span class="line">    description VARCHAR(200),</span><br><span class="line">    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">    INDEX idx_slug (slug)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line">-- 文章-标签关联表</span><br><span class="line">CREATE TABLE article_tags (</span><br><span class="line">    article_id BIGINT NOT NULL,</span><br><span class="line">    tag_id BIGINT NOT NULL,</span><br><span class="line">    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">    PRIMARY KEY (article_id, tag_id),</span><br><span class="line">    FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE,</span><br><span class="line">    FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE,</span><br><span class="line">    INDEX idx_tag_id (tag_id)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line">-- 评论表</span><br><span class="line">CREATE TABLE comments (</span><br><span class="line">    id BIGINT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    content TEXT NOT NULL,</span><br><span class="line">    author_name VARCHAR(100),</span><br><span class="line">    author_email VARCHAR(100),</span><br><span class="line">    author_ip VARCHAR(45),</span><br><span class="line">    is_approved BOOLEAN DEFAULT FALSE,</span><br><span class="line">    like_count INT DEFAULT 0,</span><br><span class="line">    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,</span><br><span class="line">    article_id BIGINT NOT NULL,</span><br><span class="line">    user_id BIGINT,</span><br><span class="line">    parent_id BIGINT,</span><br><span class="line">    FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE,</span><br><span class="line">    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL,</span><br><span class="line">    FOREIGN KEY (parent_id) REFERENCES comments(id) ON DELETE CASCADE,</span><br><span class="line">    INDEX idx_article_id (article_id),</span><br><span class="line">    INDEX idx_user_id (user_id),</span><br><span class="line">    INDEX idx_parent_id (parent_id),</span><br><span class="line">    INDEX idx_approved_created (is_approved, created_at)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line">-- 插入示例数据</span><br><span class="line">INSERT INTO users (username, email, password_hash, display_name, role) VALUES</span><br><span class="line">(&#x27;admin&#x27;, &#x27;admin@example.com&#x27;, &#x27;$2a$10$YourHashedPasswordHere&#x27;, &#x27;管理员&#x27;, &#x27;ADMIN&#x27;),</span><br><span class="line">(&#x27;user1&#x27;, &#x27;user1@example.com&#x27;, &#x27;$2a$10$YourHashedPasswordHere&#x27;, &#x27;用户1&#x27;, &#x27;USER&#x27;);</span><br><span class="line"></span><br><span class="line">INSERT INTO categories (name, slug, description) VALUES</span><br><span class="line">(&#x27;编程&#x27;, &#x27;programming&#x27;, &#x27;编程相关文章&#x27;),</span><br><span class="line">(&#x27;技术&#x27;, &#x27;technology&#x27;, &#x27;技术分享&#x27;),</span><br><span class="line">(&#x27;生活&#x27;, &#x27;life&#x27;, &#x27;生活随笔&#x27;);</span><br><span class="line"></span><br><span class="line">INSERT INTO tags (name, slug, description) VALUES</span><br><span class="line">(&#x27;Java&#x27;, &#x27;java&#x27;, &#x27;Java编程&#x27;),</span><br><span class="line">(&#x27;Spring Boot&#x27;, &#x27;spring-boot&#x27;, &#x27;Spring Boot框架&#x27;),</span><br><span class="line">(&#x27;JavaScript&#x27;, &#x27;javascript&#x27;, &#x27;JavaScript语言&#x27;),</span><br><span class="line">(&#x27;前端开发&#x27;, &#x27;frontend&#x27;, &#x27;前端开发技术&#x27;),</span><br><span class="line">(&#x27;后端开发&#x27;, &#x27;backend&#x27;, &#x27;后端开发技术&#x27;);</span><br><span class="line"></span><br><span class="line">INSERT INTO articles (title, summary, content, status, author_id, category_id, published_at) VALUES</span><br><span class="line">(&#x27;Spring Boot入门教程&#x27;, &#x27;本文介绍Spring Boot的基础知识和快速入门方法。&#x27;, &#x27;Spring Boot是一个强大的框架...&#x27;, &#x27;PUBLISHED&#x27;, 1, 1, NOW()),</span><br><span class="line">(&#x27;JavaScript高级技巧&#x27;, &#x27;分享一些实用的JavaScript高级编程技巧。&#x27;, &#x27;JavaScript是一门灵活的语言...&#x27;, &#x27;PUBLISHED&#x27;, 2, 1, NOW());</span><br><span class="line"></span><br><span class="line">INSERT INTO article_tags (article_id, tag_id) VALUES</span><br><span class="line">(1, 1), (1, 2), (1, 5),</span><br><span class="line">(2, 3), (2, 4);</span><br><span class="line"></span><br><span class="line">INSERT INTO comments (content, author_name, author_email, is_approved, article_id, user_id) VALUES</span><br><span class="line">(&#x27;非常好的入门教程，感谢分享！&#x27;, &#x27;张三&#x27;, &#x27;zhangsan@example.com&#x27;, TRUE, 1, 2),</span><br><span class="line">(&#x27;期待更多Spring Boot相关内容。&#x27;, &#x27;李四&#x27;, &#x27;lisi@example.com&#x27;, TRUE, 1, NULL);</span><br></pre></td></tr></table></figure>



<h2 id="第四部分：部署和运行"><a href="#第四部分：部署和运行" class="headerlink" title="第四部分：部署和运行"></a>第四部分：部署和运行</h2><h3 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1. 环境准备"></a>1. 环境准备</h3><ol>
<li><strong>安装Java 11+</strong></li>
<li><strong>安装MySQL 8.0+</strong></li>
<li><strong>安装Node.js (可选，用于前端开发)</strong></li>
</ol>
<h3 id="2-后端运行步骤"><a href="#2-后端运行步骤" class="headerlink" title="2. 后端运行步骤"></a>2. 后端运行步骤</h3><p>bash</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 1. 克隆或创建项目</span><br><span class="line">git clone &lt;repository-url&gt;</span><br><span class="line">cd blog-backend</span><br><span class="line"></span><br><span class="line"># 2. 配置数据库</span><br><span class="line">mysql -u root -p &lt; blog_db.sql</span><br><span class="line"></span><br><span class="line"># 3. 修改配置文件</span><br><span class="line"># 编辑 application.yml，修改数据库连接信息</span><br><span class="line"></span><br><span class="line"># 4. 构建项目</span><br><span class="line">mvn clean package</span><br><span class="line"></span><br><span class="line"># 5. 运行项目</span><br><span class="line">java -jar target/blog-system-1.0.0.jar</span><br><span class="line"></span><br><span class="line"># 或者使用Maven直接运行</span><br><span class="line">mvn spring-boot:run</span><br></pre></td></tr></table></figure>



<h3 id="3-前端运行步骤"><a href="#3-前端运行步骤" class="headerlink" title="3. 前端运行步骤"></a>3. 前端运行步骤</h3><p>bash</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 1. 创建前端目录</span><br><span class="line">cd blog-frontend</span><br><span class="line"></span><br><span class="line"># 2. 启动HTTP服务器</span><br><span class="line"># 可以使用Python、Node.js等</span><br><span class="line">python3 -m http.server 3000</span><br><span class="line"></span><br><span class="line"># 或使用VS Code的Live Server插件</span><br></pre></td></tr></table></figure>



<h3 id="4-访问应用"><a href="#4-访问应用" class="headerlink" title="4. 访问应用"></a>4. 访问应用</h3><ul>
<li>前端：<a target="_blank" rel="noopener" href="http://localhost:3000/">http://localhost:3000</a></li>
<li>后端API：<a target="_blank" rel="noopener" href="http://localhost:8080/api">http://localhost:8080/api</a></li>
</ul>
<h2 id="第五部分：扩展功能建议"><a href="#第五部分：扩展功能建议" class="headerlink" title="第五部分：扩展功能建议"></a>第五部分：扩展功能建议</h2><h3 id="1-可以添加的功能"><a href="#1-可以添加的功能" class="headerlink" title="1. 可以添加的功能"></a>1. 可以添加的功能</h3><ol>
<li><strong>文章收藏功能</strong></li>
<li><strong>用户关注系统</strong></li>
<li><strong>站内消息</strong></li>
<li><strong>文章评分系统</strong></li>
<li><strong>访问统计图表</strong></li>
<li><strong>SEO优化</strong></li>
<li><strong>多语言支持</strong></li>
</ol>
<h3 id="2-性能优化"><a href="#2-性能优化" class="headerlink" title="2. 性能优化"></a>2. 性能优化</h3><ol>
<li><strong>Redis缓存</strong></li>
<li><strong>CDN静态资源</strong></li>
<li><strong>数据库读写分离</strong></li>
<li><strong>文章静态化</strong></li>
<li><strong>图片懒加载</strong></li>
</ol>
<h3 id="3-安全增强"><a href="#3-安全增强" class="headerlink" title="3. 安全增强"></a>3. 安全增强</h3><ol>
<li><strong>HTTPS支持</strong></li>
<li><strong>防止SQL注入</strong></li>
<li><strong>XSS防护</strong></li>
<li><strong>CSRF保护</strong></li>
<li><strong>API限流</strong></li>
</ol>
<p>这个完整项目包含了：</p>
<ul>
<li><strong>后端</strong>：完整的Spring Boot应用，包含用户认证、文章管理、评论系统等</li>
<li><strong>前端</strong>：纯HTML&#x2F;CSS&#x2F;JavaScript实现的SPA应用</li>
<li><strong>数据库</strong>：完整的MySQL表结构</li>
<li><strong>部署</strong>：详细的部署步骤</li>
</ul>
<p>你可以按照这个指南一步步实现，每个文件都有完整的代码。这个项目涵盖了现代Web开发的核心概念，完成后你将掌握前后端分离开发的全套技能。</p>
<h1 id="个人博客系统扩展实现"><a href="#个人博客系统扩展实现" class="headerlink" title="个人博客系统扩展实现"></a>个人博客系统扩展实现</h1><p>我将继续扩展这个项目，添加更多高级功能和优化。以下是完整的扩展实现：</p>
<h2 id="第一部分：后端扩展"><a href="#第一部分：后端扩展" class="headerlink" title="第一部分：后端扩展"></a>第一部分：后端扩展</h2><h3 id="1-添加缓存支持"><a href="#1-添加缓存支持" class="headerlink" title="1. 添加缓存支持"></a>1. 添加缓存支持</h3><p><strong>RedisConfig.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.config;</span><br><span class="line"></span><br><span class="line">import org.springframework.cache.CacheManager;</span><br><span class="line">import org.springframework.cache.annotation.EnableCaching;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.data.redis.cache.RedisCacheConfiguration;</span><br><span class="line">import org.springframework.data.redis.cache.RedisCacheManager;</span><br><span class="line">import org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line">import org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;</span><br><span class="line">import org.springframework.data.redis.serializer.RedisSerializationContext;</span><br><span class="line">import org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line">import java.time.Duration;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">@EnableCaching</span><br><span class="line">public class RedisConfig &#123;</span><br><span class="line">    </span><br><span class="line">    @Bean</span><br><span class="line">    public CacheManager cacheManager(RedisConnectionFactory connectionFactory) &#123;</span><br><span class="line">        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">            .entryTtl(Duration.ofMinutes(30))  // 默认30分钟过期</span><br><span class="line">            .disableCachingNullValues()</span><br><span class="line">            .serializeKeysWith(RedisSerializationContext.SerializationPair</span><br><span class="line">                .fromSerializer(new StringRedisSerializer()))</span><br><span class="line">            .serializeValuesWith(RedisSerializationContext.SerializationPair</span><br><span class="line">                .fromSerializer(new GenericJackson2JsonRedisSerializer()));</span><br><span class="line">        </span><br><span class="line">        return RedisCacheManager.builder(connectionFactory)</span><br><span class="line">            .cacheDefaults(config)</span><br><span class="line">            .withCacheConfiguration(&quot;articles&quot;, </span><br><span class="line">                RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                    .entryTtl(Duration.ofHours(1)))</span><br><span class="line">            .withCacheConfiguration(&quot;users&quot;,</span><br><span class="line">                RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                    .entryTtl(Duration.ofMinutes(10)))</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-添加全文搜索功能"><a href="#2-添加全文搜索功能" class="headerlink" title="2. 添加全文搜索功能"></a>2. 添加全文搜索功能</h3><p><strong>ElasticsearchConfig.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.config;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.data.elasticsearch.client.ClientConfiguration;</span><br><span class="line">import org.springframework.data.elasticsearch.client.elc.ElasticsearchConfiguration;</span><br><span class="line">import org.springframework.data.elasticsearch.repository.config.EnableElasticsearchRepositories;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">@EnableElasticsearchRepositories(basePackages = &quot;com.blog.repository.elasticsearch&quot;)</span><br><span class="line">public class ElasticsearchConfig extends ElasticsearchConfiguration &#123;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public ClientConfiguration clientConfiguration() &#123;</span><br><span class="line">        return ClientConfiguration.builder()</span><br><span class="line">            .connectedTo(&quot;localhost:9200&quot;)</span><br><span class="line">            .withSocketTimeout(10000)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>ArticleDocument.java</strong> (Elasticsearch文档)</p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.document;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line">import org.springframework.data.annotation.Id;</span><br><span class="line">import org.springframework.data.elasticsearch.annotations.*;</span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line">@Document(indexName = &quot;articles&quot;)</span><br><span class="line">@Data</span><br><span class="line">public class ArticleDocument &#123;</span><br><span class="line">    @Id</span><br><span class="line">    private Long id;</span><br><span class="line">    </span><br><span class="line">    @Field(type = FieldType.Text, analyzer = &quot;ik_max_word&quot;, searchAnalyzer = &quot;ik_smart&quot;)</span><br><span class="line">    private String title;</span><br><span class="line">    </span><br><span class="line">    @Field(type = FieldType.Text, analyzer = &quot;ik_max_word&quot;, searchAnalyzer = &quot;ik_smart&quot;)</span><br><span class="line">    private String content;</span><br><span class="line">    </span><br><span class="line">    @Field(type = FieldType.Text, analyzer = &quot;ik_max_word&quot;, searchAnalyzer = &quot;ik_smart&quot;)</span><br><span class="line">    private String summary;</span><br><span class="line">    </span><br><span class="line">    @Field(type = FieldType.Keyword)</span><br><span class="line">    private String authorName;</span><br><span class="line">    </span><br><span class="line">    @Field(type = FieldType.Date)</span><br><span class="line">    private LocalDateTime publishedAt;</span><br><span class="line">    </span><br><span class="line">    @Field(type = FieldType.Integer)</span><br><span class="line">    private Integer viewCount;</span><br><span class="line">    </span><br><span class="line">    @Field(type = FieldType.Integer)</span><br><span class="line">    private Integer likeCount;</span><br><span class="line">    </span><br><span class="line">    @Field(type = FieldType.Keyword)</span><br><span class="line">    private String status;</span><br><span class="line">    </span><br><span class="line">    @Field(type = FieldType.Nested)</span><br><span class="line">    private java.util.List&lt;String&gt; tags;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>ArticleSearchRepository.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.repository.elasticsearch;</span><br><span class="line"></span><br><span class="line">import com.blog.document.ArticleDocument;</span><br><span class="line">import org.springframework.data.domain.Page;</span><br><span class="line">import org.springframework.data.domain.Pageable;</span><br><span class="line">import org.springframework.data.elasticsearch.annotations.Query;</span><br><span class="line">import org.springframework.data.elasticsearch.repository.ElasticsearchRepository;</span><br><span class="line">import org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line">@Repository</span><br><span class="line">public interface ArticleSearchRepository extends ElasticsearchRepository&lt;ArticleDocument, Long&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    Page&lt;ArticleDocument&gt; findByTitleContainingOrContentContaining(</span><br><span class="line">            String title, String content, Pageable pageable);</span><br><span class="line">    </span><br><span class="line">    @Query(&quot;&#123;\&quot;multi_match\&quot;: &#123;\&quot;query\&quot;: \&quot;?0\&quot;, \&quot;fields\&quot;: [\&quot;title^2\&quot;, \&quot;content\&quot;, \&quot;summary\&quot;]&#125;&#125;&quot;)</span><br><span class="line">    Page&lt;ArticleDocument&gt; search(String keyword, Pageable pageable);</span><br><span class="line">    </span><br><span class="line">    Page&lt;ArticleDocument&gt; findByAuthorName(String authorName, Pageable pageable);</span><br><span class="line">    </span><br><span class="line">    Page&lt;ArticleDocument&gt; findByStatus(String status, Pageable pageable);</span><br><span class="line">    </span><br><span class="line">    Page&lt;ArticleDocument&gt; findByTagsContaining(String tag, Pageable pageable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>SearchService.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.service;</span><br><span class="line"></span><br><span class="line">import com.blog.document.ArticleDocument;</span><br><span class="line">import com.blog.entity.Article;</span><br><span class="line">import com.blog.repository.elasticsearch.ArticleSearchRepository;</span><br><span class="line">import lombok.RequiredArgsConstructor;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.data.domain.Page;</span><br><span class="line">import org.springframework.data.domain.Pageable;</span><br><span class="line">import org.springframework.scheduling.annotation.Async;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import org.springframework.transaction.event.TransactionalEventListener;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">@RequiredArgsConstructor</span><br><span class="line">@Slf4j</span><br><span class="line">public class SearchService &#123;</span><br><span class="line">    </span><br><span class="line">    private final ArticleSearchRepository articleSearchRepository;</span><br><span class="line">    </span><br><span class="line">    @Async</span><br><span class="line">    public void indexArticle(Article article) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            ArticleDocument document = convertToDocument(article);</span><br><span class="line">            articleSearchRepository.save(document);</span><br><span class="line">            log.info(&quot;文章已索引: &#123;&#125;&quot;, article.getTitle());</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(&quot;索引文章失败: &#123;&#125;&quot;, article.getId(), e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Async</span><br><span class="line">    public void deleteArticle(Long articleId) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            articleSearchRepository.deleteById(articleId);</span><br><span class="line">            log.info(&quot;文章已从索引删除: &#123;&#125;&quot;, articleId);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(&quot;删除文章索引失败: &#123;&#125;&quot;, articleId, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public Page&lt;ArticleDocument&gt; search(String keyword, Pageable pageable) &#123;</span><br><span class="line">        return articleSearchRepository.search(keyword, pageable);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public Page&lt;ArticleDocument&gt; searchByTag(String tag, Pageable pageable) &#123;</span><br><span class="line">        return articleSearchRepository.findByTagsContaining(tag, pageable);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public Page&lt;ArticleDocument&gt; searchByAuthor(String authorName, Pageable pageable) &#123;</span><br><span class="line">        return articleSearchRepository.findByAuthorName(authorName, pageable);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @TransactionalEventListener</span><br><span class="line">    public void handleArticlePublished(Article article) &#123;</span><br><span class="line">        if (article.getStatus() == Article.Status.PUBLISHED) &#123;</span><br><span class="line">            indexArticle(article);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private ArticleDocument convertToDocument(Article article) &#123;</span><br><span class="line">        ArticleDocument document = new ArticleDocument();</span><br><span class="line">        document.setId(article.getId());</span><br><span class="line">        document.setTitle(article.getTitle());</span><br><span class="line">        document.setContent(article.getContent());</span><br><span class="line">        document.setSummary(article.getSummary());</span><br><span class="line">        document.setAuthorName(article.getAuthor().getDisplayName());</span><br><span class="line">        document.setPublishedAt(article.getPublishedAt());</span><br><span class="line">        document.setViewCount(article.getViewCount());</span><br><span class="line">        document.setLikeCount(article.getLikeCount());</span><br><span class="line">        document.setStatus(article.getStatus().name());</span><br><span class="line">        document.setTags(article.getTags().stream()</span><br><span class="line">            .map(tag -&gt; tag.getName())</span><br><span class="line">            .collect(java.util.stream.Collectors.toList()));</span><br><span class="line">        return document;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-添加WebSocket实时通知"><a href="#3-添加WebSocket实时通知" class="headerlink" title="3. 添加WebSocket实时通知"></a>3. 添加WebSocket实时通知</h3><p><strong>WebSocketConfig.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.config;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.messaging.simp.config.MessageBrokerRegistry;</span><br><span class="line">import org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;</span><br><span class="line">import org.springframework.web.socket.config.annotation.StompEndpointRegistry;</span><br><span class="line">import org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">@EnableWebSocketMessageBroker</span><br><span class="line">public class WebSocketConfig implements WebSocketMessageBrokerConfigurer &#123;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void configureMessageBroker(MessageBrokerRegistry config) &#123;</span><br><span class="line">        config.enableSimpleBroker(&quot;/topic&quot;, &quot;/queue&quot;);</span><br><span class="line">        config.setApplicationDestinationPrefixes(&quot;/app&quot;);</span><br><span class="line">        config.setUserDestinationPrefix(&quot;/user&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void registerStompEndpoints(StompEndpointRegistry registry) &#123;</span><br><span class="line">        registry.addEndpoint(&quot;/ws&quot;)</span><br><span class="line">                .setAllowedOriginPatterns(&quot;*&quot;)</span><br><span class="line">                .withSockJS();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>NotificationService.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.service;</span><br><span class="line"></span><br><span class="line">import com.blog.dto.NotificationDTO;</span><br><span class="line">import lombok.RequiredArgsConstructor;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.messaging.simp.SimpMessagingTemplate;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">@RequiredArgsConstructor</span><br><span class="line">@Slf4j</span><br><span class="line">public class NotificationService &#123;</span><br><span class="line">    </span><br><span class="line">    private final SimpMessagingTemplate messagingTemplate;</span><br><span class="line">    </span><br><span class="line">    public void sendCommentNotification(Long userId, NotificationDTO notification) &#123;</span><br><span class="line">        String destination = &quot;/queue/notifications/&quot; + userId;</span><br><span class="line">        messagingTemplate.convertAndSend(destination, notification);</span><br><span class="line">        log.info(&quot;发送评论通知给用户: &#123;&#125;, 内容: &#123;&#125;&quot;, userId, notification.getContent());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public void sendArticleUpdateNotification(Long articleId, NotificationDTO notification) &#123;</span><br><span class="line">        String destination = &quot;/topic/articles/&quot; + articleId + &quot;/updates&quot;;</span><br><span class="line">        messagingTemplate.convertAndSend(destination, notification);</span><br><span class="line">        log.info(&quot;发送文章更新通知: &#123;&#125;&quot;, articleId);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public void sendGlobalNotification(NotificationDTO notification) &#123;</span><br><span class="line">        messagingTemplate.convertAndSend(&quot;/topic/notifications&quot;, notification);</span><br><span class="line">        log.info(&quot;发送全局通知: &#123;&#125;&quot;, notification.getContent());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">class NotificationDTO &#123;</span><br><span class="line">    private String id;</span><br><span class="line">    private String type; // COMMENT, ARTICLE_UPDATE, SYSTEM</span><br><span class="line">    private String title;</span><br><span class="line">    private String content;</span><br><span class="line">    private String targetUrl;</span><br><span class="line">    private Boolean read = false;</span><br><span class="line">    private java.time.LocalDateTime createdAt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-添加文件上传服务"><a href="#4-添加文件上传服务" class="headerlink" title="4. 添加文件上传服务"></a>4. 添加文件上传服务</h3><p><strong>FileStorageService.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.service;</span><br><span class="line"></span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import org.springframework.web.multipart.MultipartFile;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.nio.file.Files;</span><br><span class="line">import java.nio.file.Path;</span><br><span class="line">import java.nio.file.Paths;</span><br><span class="line">import java.nio.file.StandardCopyOption;</span><br><span class="line">import java.util.UUID;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">@Slf4j</span><br><span class="line">public class FileStorageService &#123;</span><br><span class="line">    </span><br><span class="line">    @Value(&quot;$&#123;app.file.upload-dir:uploads&#125;&quot;)</span><br><span class="line">    private String uploadDir;</span><br><span class="line">    </span><br><span class="line">    @Value(&quot;$&#123;app.file.max-size:10485760&#125;&quot;) // 10MB</span><br><span class="line">    private long maxFileSize;</span><br><span class="line">    </span><br><span class="line">    @Value(&quot;$&#123;app.file.allowed-extensions:jpg,jpeg,png,gif,pdf,doc,docx&#125;&quot;)</span><br><span class="line">    private String[] allowedExtensions;</span><br><span class="line">    </span><br><span class="line">    public String storeFile(MultipartFile file) throws IOException &#123;</span><br><span class="line">        // 验证文件大小</span><br><span class="line">        if (file.getSize() &gt; maxFileSize) &#123;</span><br><span class="line">            throw new RuntimeException(&quot;文件大小超过限制&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 验证文件扩展名</span><br><span class="line">        String originalFilename = file.getOriginalFilename();</span><br><span class="line">        String extension = getFileExtension(originalFilename);</span><br><span class="line">        if (!isAllowedExtension(extension)) &#123;</span><br><span class="line">            throw new RuntimeException(&quot;不支持的文件类型&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 生成唯一文件名</span><br><span class="line">        String filename = UUID.randomUUID().toString() + &quot;.&quot; + extension;</span><br><span class="line">        Path targetLocation = Paths.get(uploadDir).resolve(filename);</span><br><span class="line">        </span><br><span class="line">        // 确保目录存在</span><br><span class="line">        Files.createDirectories(targetLocation.getParent());</span><br><span class="line">        </span><br><span class="line">        // 保存文件</span><br><span class="line">        Files.copy(file.getInputStream(), targetLocation, StandardCopyOption.REPLACE_EXISTING);</span><br><span class="line">        </span><br><span class="line">        log.info(&quot;文件保存成功: &#123;&#125;&quot;, filename);</span><br><span class="line">        return &quot;/uploads/&quot; + filename;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public byte[] loadFile(String filename) throws IOException &#123;</span><br><span class="line">        Path filePath = Paths.get(uploadDir).resolve(filename).normalize();</span><br><span class="line">        return Files.readAllBytes(filePath);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public void deleteFile(String filename) throws IOException &#123;</span><br><span class="line">        Path filePath = Paths.get(uploadDir).resolve(filename).normalize();</span><br><span class="line">        Files.deleteIfExists(filePath);</span><br><span class="line">        log.info(&quot;文件删除成功: &#123;&#125;&quot;, filename);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private String getFileExtension(String filename) &#123;</span><br><span class="line">        if (filename == null || !filename.contains(&quot;.&quot;)) &#123;</span><br><span class="line">            return &quot;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        return filename.substring(filename.lastIndexOf(&quot;.&quot;) + 1).toLowerCase();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private boolean isAllowedExtension(String extension) &#123;</span><br><span class="line">        if (extension == null || extension.isEmpty()) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        for (String allowed : allowedExtensions) &#123;</span><br><span class="line">            if (allowed.equalsIgnoreCase(extension)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>FileController.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.controller;</span><br><span class="line"></span><br><span class="line">import com.blog.service.FileStorageService;</span><br><span class="line">import lombok.RequiredArgsConstructor;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.core.io.Resource;</span><br><span class="line">import org.springframework.core.io.UrlResource;</span><br><span class="line">import org.springframework.http.HttpHeaders;</span><br><span class="line">import org.springframework.http.MediaType;</span><br><span class="line">import org.springframework.http.ResponseEntity;</span><br><span class="line">import org.springframework.security.access.prepost.PreAuthorize;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line">import org.springframework.web.multipart.MultipartFile;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.nio.file.Path;</span><br><span class="line">import java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/api/files&quot;)</span><br><span class="line">@RequiredArgsConstructor</span><br><span class="line">@Slf4j</span><br><span class="line">public class FileController &#123;</span><br><span class="line">    </span><br><span class="line">    private final FileStorageService fileStorageService;</span><br><span class="line">    </span><br><span class="line">    @PostMapping(&quot;/upload&quot;)</span><br><span class="line">    @PreAuthorize(&quot;hasRole(&#x27;USER&#x27;)&quot;)</span><br><span class="line">    public ResponseEntity&lt;?&gt; uploadFile(@RequestParam(&quot;file&quot;) MultipartFile file) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            String fileUrl = fileStorageService.storeFile(file);</span><br><span class="line">            return ResponseEntity.ok(new FileUploadResponse(fileUrl));</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            log.error(&quot;文件上传失败&quot;, e);</span><br><span class="line">            return ResponseEntity.badRequest().body(&quot;文件上传失败: &quot; + e.getMessage());</span><br><span class="line">        &#125; catch (RuntimeException e) &#123;</span><br><span class="line">            return ResponseEntity.badRequest().body(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @GetMapping(&quot;/&#123;filename:.+&#125;&quot;)</span><br><span class="line">    public ResponseEntity&lt;Resource&gt; getFile(@PathVariable String filename) throws IOException &#123;</span><br><span class="line">        Path filePath = Paths.get(&quot;uploads&quot;).resolve(filename).normalize();</span><br><span class="line">        Resource resource = new UrlResource(filePath.toUri());</span><br><span class="line">        </span><br><span class="line">        if (!resource.exists()) &#123;</span><br><span class="line">            return ResponseEntity.notFound().build();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        String contentType = getContentType(filename);</span><br><span class="line">        </span><br><span class="line">        return ResponseEntity.ok()</span><br><span class="line">                .contentType(MediaType.parseMediaType(contentType))</span><br><span class="line">                .header(HttpHeaders.CONTENT_DISPOSITION, </span><br><span class="line">                        &quot;inline; filename=\&quot;&quot; + resource.getFilename() + &quot;\&quot;&quot;)</span><br><span class="line">                .body(resource);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @DeleteMapping(&quot;/&#123;filename:.+&#125;&quot;)</span><br><span class="line">    @PreAuthorize(&quot;hasRole(&#x27;ADMIN&#x27;)&quot;)</span><br><span class="line">    public ResponseEntity&lt;?&gt; deleteFile(@PathVariable String filename) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            fileStorageService.deleteFile(filename);</span><br><span class="line">            return ResponseEntity.ok().build();</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            log.error(&quot;文件删除失败&quot;, e);</span><br><span class="line">            return ResponseEntity.badRequest().body(&quot;文件删除失败&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private String getContentType(String filename) &#123;</span><br><span class="line">        String extension = filename.substring(filename.lastIndexOf(&quot;.&quot;) + 1).toLowerCase();</span><br><span class="line">        switch (extension) &#123;</span><br><span class="line">            case &quot;jpg&quot;:</span><br><span class="line">            case &quot;jpeg&quot;:</span><br><span class="line">                return &quot;image/jpeg&quot;;</span><br><span class="line">            case &quot;png&quot;:</span><br><span class="line">                return &quot;image/png&quot;;</span><br><span class="line">            case &quot;gif&quot;:</span><br><span class="line">                return &quot;image/gif&quot;;</span><br><span class="line">            case &quot;pdf&quot;:</span><br><span class="line">                return &quot;application/pdf&quot;;</span><br><span class="line">            case &quot;doc&quot;:</span><br><span class="line">                return &quot;application/msword&quot;;</span><br><span class="line">            case &quot;docx&quot;:</span><br><span class="line">                return &quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;;</span><br><span class="line">            default:</span><br><span class="line">                return &quot;application/octet-stream&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Data</span><br><span class="line">    static class FileUploadResponse &#123;</span><br><span class="line">        private final String url;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5-添加邮件服务"><a href="#5-添加邮件服务" class="headerlink" title="5. 添加邮件服务"></a>5. 添加邮件服务</h3><p><strong>EmailService.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.service;</span><br><span class="line"></span><br><span class="line">import lombok.RequiredArgsConstructor;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.mail.javamail.JavaMailSender;</span><br><span class="line">import org.springframework.mail.javamail.MimeMessageHelper;</span><br><span class="line">import org.springframework.scheduling.annotation.Async;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import org.thymeleaf.TemplateEngine;</span><br><span class="line">import org.thymeleaf.context.Context;</span><br><span class="line">import javax.mail.internet.MimeMessage;</span><br><span class="line">import java.util.Locale;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">@RequiredArgsConstructor</span><br><span class="line">@Slf4j</span><br><span class="line">public class EmailService &#123;</span><br><span class="line">    </span><br><span class="line">    private final JavaMailSender mailSender;</span><br><span class="line">    private final TemplateEngine templateEngine;</span><br><span class="line">    </span><br><span class="line">    @Value(&quot;$&#123;app.email.from:no-reply@blog.com&#125;&quot;)</span><br><span class="line">    private String fromEmail;</span><br><span class="line">    </span><br><span class="line">    @Value(&quot;$&#123;app.email.from-name:博客系统&#125;&quot;)</span><br><span class="line">    private String fromName;</span><br><span class="line">    </span><br><span class="line">    @Async</span><br><span class="line">    public void sendWelcomeEmail(String to, String username) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Context context = new Context(Locale.CHINA);</span><br><span class="line">            context.setVariable(&quot;username&quot;, username);</span><br><span class="line">            </span><br><span class="line">            String content = templateEngine.process(&quot;email/welcome&quot;, context);</span><br><span class="line">            String subject = &quot;欢迎加入博客系统&quot;;</span><br><span class="line">            </span><br><span class="line">            sendHtmlEmail(to, subject, content);</span><br><span class="line">            log.info(&quot;欢迎邮件发送成功: &#123;&#125;&quot;, to);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(&quot;发送欢迎邮件失败&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Async</span><br><span class="line">    public void sendCommentNotification(String to, String commenter, String articleTitle, String articleUrl) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Context context = new Context(Locale.CHINA);</span><br><span class="line">            context.setVariable(&quot;commenter&quot;, commenter);</span><br><span class="line">            context.setVariable(&quot;articleTitle&quot;, articleTitle);</span><br><span class="line">            context.setVariable(&quot;articleUrl&quot;, articleUrl);</span><br><span class="line">            </span><br><span class="line">            String content = templateEngine.process(&quot;email/comment-notification&quot;, context);</span><br><span class="line">            String subject = &quot;您的文章收到了新的评论&quot;;</span><br><span class="line">            </span><br><span class="line">            sendHtmlEmail(to, subject, content);</span><br><span class="line">            log.info(&quot;评论通知邮件发送成功: &#123;&#125;&quot;, to);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(&quot;发送评论通知邮件失败&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Async</span><br><span class="line">    public void sendPasswordResetEmail(String to, String resetToken) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Context context = new Context(Locale.CHINA);</span><br><span class="line">            context.setVariable(&quot;resetToken&quot;, resetToken);</span><br><span class="line">            </span><br><span class="line">            String content = templateEngine.process(&quot;email/password-reset&quot;, context);</span><br><span class="line">            String subject = &quot;密码重置请求&quot;;</span><br><span class="line">            </span><br><span class="line">            sendHtmlEmail(to, subject, content);</span><br><span class="line">            log.info(&quot;密码重置邮件发送成功: &#123;&#125;&quot;, to);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(&quot;发送密码重置邮件失败&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private void sendHtmlEmail(String to, String subject, String content) throws Exception &#123;</span><br><span class="line">        MimeMessage message = mailSender.createMimeMessage();</span><br><span class="line">        MimeMessageHelper helper = new MimeMessageHelper(message, true, &quot;UTF-8&quot;);</span><br><span class="line">        </span><br><span class="line">        helper.setFrom(fromEmail, fromName);</span><br><span class="line">        helper.setTo(to);</span><br><span class="line">        helper.setSubject(subject);</span><br><span class="line">        helper.setText(content, true);</span><br><span class="line">        </span><br><span class="line">        mailSender.send(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>邮件模板 resources&#x2F;templates&#x2F;email&#x2F;welcome.html</strong></p>
<p>html</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;欢迎加入&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        body &#123;</span><br><span class="line">            font-family: Arial, sans-serif;</span><br><span class="line">            line-height: 1.6;</span><br><span class="line">            color: #333;</span><br><span class="line">            max-width: 600px;</span><br><span class="line">            margin: 0 auto;</span><br><span class="line">            padding: 20px;</span><br><span class="line">        &#125;</span><br><span class="line">        .header &#123;</span><br><span class="line">            background-color: #007bff;</span><br><span class="line">            color: white;</span><br><span class="line">            padding: 20px;</span><br><span class="line">            text-align: center;</span><br><span class="line">            border-radius: 5px 5px 0 0;</span><br><span class="line">        &#125;</span><br><span class="line">        .content &#123;</span><br><span class="line">            background-color: #f8f9fa;</span><br><span class="line">            padding: 30px;</span><br><span class="line">            border-radius: 0 0 5px 5px;</span><br><span class="line">        &#125;</span><br><span class="line">        .btn &#123;</span><br><span class="line">            display: inline-block;</span><br><span class="line">            background-color: #007bff;</span><br><span class="line">            color: white;</span><br><span class="line">            text-decoration: none;</span><br><span class="line">            padding: 10px 20px;</span><br><span class="line">            border-radius: 5px;</span><br><span class="line">            margin: 20px 0;</span><br><span class="line">        &#125;</span><br><span class="line">        .footer &#123;</span><br><span class="line">            text-align: center;</span><br><span class="line">            margin-top: 30px;</span><br><span class="line">            color: #666;</span><br><span class="line">            font-size: 12px;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div class=&quot;header&quot;&gt;</span><br><span class="line">        &lt;h1&gt;欢迎加入博客系统&lt;/h1&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;div class=&quot;content&quot;&gt;</span><br><span class="line">        &lt;p&gt;亲爱的 &lt;span th:text=&quot;$&#123;username&#125;&quot;&gt;用户&lt;/span&gt;，&lt;/p&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;p&gt;感谢您注册博客系统！我们很高兴您能加入我们的社区。&lt;/p&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;p&gt;现在您可以：&lt;/p&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">            &lt;li&gt;发布您的第一篇博客文章&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;阅读其他作者的精彩文章&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;参与文章的讨论和评论&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;关注您喜欢的作者&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;div style=&quot;text-align: center;&quot;&gt;</span><br><span class="line">            &lt;a href=&quot;http://localhost:3000&quot; class=&quot;btn&quot;&gt;开始探索&lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;p&gt;如果您有任何问题，请随时联系我们的支持团队。&lt;/p&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;p&gt;祝您使用愉快！&lt;br&gt;博客系统团队&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;div class=&quot;footer&quot;&gt;</span><br><span class="line">        &lt;p&gt;这是一封自动发送的邮件，请勿直接回复。&lt;/p&gt;</span><br><span class="line">        &lt;p&gt;© 2023 博客系统. All rights reserved.&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<h3 id="6-添加定时任务"><a href="#6-添加定时任务" class="headerlink" title="6. 添加定时任务"></a>6. 添加定时任务</h3><p><strong>ScheduledTasks.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.task;</span><br><span class="line"></span><br><span class="line">import com.blog.repository.ArticleRepository;</span><br><span class="line">import com.blog.repository.UserRepository;</span><br><span class="line">import lombok.RequiredArgsConstructor;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.cache.annotation.CacheEvict;</span><br><span class="line">import org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import org.springframework.transaction.annotation.Transactional;</span><br><span class="line">import java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">@RequiredArgsConstructor</span><br><span class="line">@Slf4j</span><br><span class="line">public class ScheduledTasks &#123;</span><br><span class="line">    </span><br><span class="line">    private final ArticleRepository articleRepository;</span><br><span class="line">    private final UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    // 每天凌晨3点清理未激活用户</span><br><span class="line">    @Scheduled(cron = &quot;0 0 3 * * ?&quot;)</span><br><span class="line">    @Transactional</span><br><span class="line">    public void cleanupInactiveUsers() &#123;</span><br><span class="line">        LocalDateTime cutoffDate = LocalDateTime.now().minusDays(7);</span><br><span class="line">        int deleted = userRepository.deleteByIsActiveFalseAndCreatedAtBefore(cutoffDate);</span><br><span class="line">        log.info(&quot;清理了 &#123;&#125; 个未激活用户&quot;, deleted);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 每小时更新文章缓存</span><br><span class="line">    @Scheduled(cron = &quot;0 0 * * * ?&quot;)</span><br><span class="line">    @CacheEvict(value = &quot;articles&quot;, allEntries = true)</span><br><span class="line">    public void evictArticleCache() &#123;</span><br><span class="line">        log.info(&quot;文章缓存已清理&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 每周一凌晨2点生成统计报告</span><br><span class="line">    @Scheduled(cron = &quot;0 0 2 ? * MON&quot;)</span><br><span class="line">    public void generateWeeklyReport() &#123;</span><br><span class="line">        long totalArticles = articleRepository.countPublishedArticles();</span><br><span class="line">        long totalUsers = userRepository.count();</span><br><span class="line">        long newArticles = articleRepository.countByPublishedAtAfter(LocalDateTime.now().minusDays(7));</span><br><span class="line">        </span><br><span class="line">        log.info(&quot;周度统计报告:&quot;);</span><br><span class="line">        log.info(&quot;总文章数: &#123;&#125;&quot;, totalArticles);</span><br><span class="line">        log.info(&quot;总用户数: &#123;&#125;&quot;, totalUsers);</span><br><span class="line">        log.info(&quot;本周新文章数: &#123;&#125;&quot;, newArticles);</span><br><span class="line">        </span><br><span class="line">        // 这里可以添加发送统计邮件或保存到数据库的逻辑</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 每天凌晨1点备份数据库</span><br><span class="line">    @Scheduled(cron = &quot;0 0 1 * * ?&quot;)</span><br><span class="line">    public void backupDatabase() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            // 这里实现数据库备份逻辑</span><br><span class="line">            log.info(&quot;数据库备份任务开始执行&quot;);</span><br><span class="line">            // 备份逻辑...</span><br><span class="line">            log.info(&quot;数据库备份完成&quot;);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(&quot;数据库备份失败&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="7-添加API文档"><a href="#7-添加API文档" class="headerlink" title="7. 添加API文档"></a>7. 添加API文档</h3><p><strong>SwaggerConfig.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.config;</span><br><span class="line"></span><br><span class="line">import io.swagger.v3.oas.models.OpenAPI;</span><br><span class="line">import io.swagger.v3.oas.models.info.Contact;</span><br><span class="line">import io.swagger.v3.oas.models.info.Info;</span><br><span class="line">import io.swagger.v3.oas.models.info.License;</span><br><span class="line">import io.swagger.v3.oas.models.security.SecurityScheme;</span><br><span class="line">import org.springdoc.core.GroupedOpenApi;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public class SwaggerConfig &#123;</span><br><span class="line">    </span><br><span class="line">    @Bean</span><br><span class="line">    public OpenAPI blogOpenAPI() &#123;</span><br><span class="line">        return new OpenAPI()</span><br><span class="line">                .info(new Info()</span><br><span class="line">                        .title(&quot;博客系统API文档&quot;)</span><br><span class="line">                        .description(&quot;个人博客系统后端API接口文档&quot;)</span><br><span class="line">                        .version(&quot;v1.0.0&quot;)</span><br><span class="line">                        .contact(new Contact()</span><br><span class="line">                                .name(&quot;开发者&quot;)</span><br><span class="line">                                .email(&quot;developer@blog.com&quot;))</span><br><span class="line">                        .license(new License()</span><br><span class="line">                                .name(&quot;Apache 2.0&quot;)</span><br><span class="line">                                .url(&quot;http://springdoc.org&quot;)))</span><br><span class="line">                .schemaRequirement(&quot;BearerAuth&quot;, </span><br><span class="line">                        new SecurityScheme()</span><br><span class="line">                                .type(SecurityScheme.Type.HTTP)</span><br><span class="line">                                .scheme(&quot;bearer&quot;)</span><br><span class="line">                                .bearerFormat(&quot;JWT&quot;));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Bean</span><br><span class="line">    public GroupedOpenApi publicApi() &#123;</span><br><span class="line">        return GroupedOpenApi.builder()</span><br><span class="line">                .group(&quot;public&quot;)</span><br><span class="line">                .pathsToMatch(&quot;/api/auth/**&quot;, &quot;/api/articles/public/**&quot;)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Bean</span><br><span class="line">    public GroupedOpenApi userApi() &#123;</span><br><span class="line">        return GroupedOpenApi.builder()</span><br><span class="line">                .group(&quot;user&quot;)</span><br><span class="line">                .pathsToMatch(&quot;/api/articles/**&quot;, &quot;/api/comments/**&quot;)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Bean</span><br><span class="line">    public GroupedOpenApi adminApi() &#123;</span><br><span class="line">        return GroupedOpenApi.builder()</span><br><span class="line">                .group(&quot;admin&quot;)</span><br><span class="line">                .pathsToMatch(&quot;/api/admin/**&quot;)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="第二部分：前端扩展"><a href="#第二部分：前端扩展" class="headerlink" title="第二部分：前端扩展"></a>第二部分：前端扩展</h2><h3 id="1-添加状态管理增强"><a href="#1-添加状态管理增强" class="headerlink" title="1. 添加状态管理增强"></a>1. 添加状态管理增强</h3><p><strong>js&#x2F;store&#x2F;enhanced-store.js</strong></p>
<p>javascript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line">// 增强版状态管理</span><br><span class="line">export class EnhancedStore &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            user: null,</span><br><span class="line">            isAuthenticated: false,</span><br><span class="line">            articles: [],</span><br><span class="line">            currentArticle: null,</span><br><span class="line">            comments: [],</span><br><span class="line">            tags: [],</span><br><span class="line">            categories: [],</span><br><span class="line">            notifications: [],</span><br><span class="line">            unreadCount: 0,</span><br><span class="line">            searchHistory: [],</span><br><span class="line">            favorites: new Map(),</span><br><span class="line">            settings: &#123;</span><br><span class="line">                theme: &#x27;light&#x27;,</span><br><span class="line">                language: &#x27;zh-CN&#x27;,</span><br><span class="line">                notifications: true,</span><br><span class="line">                autoSave: true</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        this.listeners = new Set();</span><br><span class="line">        this.actions = new Map();</span><br><span class="line">        this.middlewares = [];</span><br><span class="line">        this.history = [];</span><br><span class="line">        this.historyIndex = -1;</span><br><span class="line">        this.maxHistory = 50;</span><br><span class="line">        </span><br><span class="line">        // 初始化默认actions</span><br><span class="line">        this.initActions();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    initActions() &#123;</span><br><span class="line">        this.defineAction(&#x27;SET_USER&#x27;, (state, payload) =&gt; (&#123;</span><br><span class="line">            ...state,</span><br><span class="line">            user: payload,</span><br><span class="line">            isAuthenticated: !!payload</span><br><span class="line">        &#125;));</span><br><span class="line">        </span><br><span class="line">        this.defineAction(&#x27;ADD_NOTIFICATION&#x27;, (state, payload) =&gt; (&#123;</span><br><span class="line">            ...state,</span><br><span class="line">            notifications: [payload, ...state.notifications],</span><br><span class="line">            unreadCount: state.unreadCount + 1</span><br><span class="line">        &#125;));</span><br><span class="line">        </span><br><span class="line">        this.defineAction(&#x27;MARK_NOTIFICATION_READ&#x27;, (state, payload) =&gt; (&#123;</span><br><span class="line">            ...state,</span><br><span class="line">            notifications: state.notifications.map(n =&gt; </span><br><span class="line">                n.id === payload ? &#123; ...n, read: true &#125; : n</span><br><span class="line">            ),</span><br><span class="line">            unreadCount: Math.max(0, state.unreadCount - 1)</span><br><span class="line">        &#125;));</span><br><span class="line">        </span><br><span class="line">        this.defineAction(&#x27;TOGGLE_FAVORITE&#x27;, (state, payload) =&gt; &#123;</span><br><span class="line">            const favorites = new Map(state.favorites);</span><br><span class="line">            if (favorites.has(payload.id)) &#123;</span><br><span class="line">                favorites.delete(payload.id);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                favorites.set(payload.id, payload);</span><br><span class="line">            &#125;</span><br><span class="line">            return &#123; ...state, favorites &#125;;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        this.defineAction(&#x27;UPDATE_SETTINGS&#x27;, (state, payload) =&gt; (&#123;</span><br><span class="line">            ...state,</span><br><span class="line">            settings: &#123; ...state.settings, ...payload &#125;</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    defineAction(type, reducer) &#123;</span><br><span class="line">        this.actions.set(type, reducer);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    dispatch(action) &#123;</span><br><span class="line">        const reducer = this.actions.get(action.type);</span><br><span class="line">        if (!reducer) &#123;</span><br><span class="line">            console.error(`未知的action类型: $&#123;action.type&#125;`);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 执行中间件</span><br><span class="line">        let nextState = this.state;</span><br><span class="line">        const middlewareAPI = &#123;</span><br><span class="line">            getState: () =&gt; this.state,</span><br><span class="line">            dispatch: this.dispatch.bind(this)</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        const chain = this.middlewares.map(middleware =&gt; middleware(middlewareAPI));</span><br><span class="line">        const dispatch = compose(...chain)(this.dispatch.bind(this));</span><br><span class="line">        </span><br><span class="line">        // 应用reducer</span><br><span class="line">        const newState = reducer(this.state, action.payload);</span><br><span class="line">        </span><br><span class="line">        // 保存到历史记录</span><br><span class="line">        this.saveToHistory(this.state);</span><br><span class="line">        this.state = newState;</span><br><span class="line">        </span><br><span class="line">        // 通知监听器</span><br><span class="line">        this.notify();</span><br><span class="line">        </span><br><span class="line">        // 持久化到localStorage</span><br><span class="line">        this.persistState();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    addMiddleware(middleware) &#123;</span><br><span class="line">        this.middlewares.push(middleware);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    saveToHistory(state) &#123;</span><br><span class="line">        this.history = this.history.slice(0, this.historyIndex + 1);</span><br><span class="line">        this.history.push(JSON.parse(JSON.stringify(state)));</span><br><span class="line">        if (this.history.length &gt; this.maxHistory) &#123;</span><br><span class="line">            this.history.shift();</span><br><span class="line">        &#125;</span><br><span class="line">        this.historyIndex = this.history.length - 1;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    undo() &#123;</span><br><span class="line">        if (this.historyIndex &gt; 0) &#123;</span><br><span class="line">            this.historyIndex--;</span><br><span class="line">            this.state = this.history[this.historyIndex];</span><br><span class="line">            this.notify();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    redo() &#123;</span><br><span class="line">        if (this.historyIndex &lt; this.history.length - 1) &#123;</span><br><span class="line">            this.historyIndex++;</span><br><span class="line">            this.state = this.history[this.historyIndex];</span><br><span class="line">            this.notify();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    persistState() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            const stateToPersist = &#123;</span><br><span class="line">                user: this.state.user,</span><br><span class="line">                settings: this.state.settings,</span><br><span class="line">                favorites: Array.from(this.state.favorites.values())</span><br><span class="line">            &#125;;</span><br><span class="line">            localStorage.setItem(&#x27;blog_state&#x27;, JSON.stringify(stateToPersist));</span><br><span class="line">        &#125; catch (error) &#123;</span><br><span class="line">            console.error(&#x27;状态持久化失败:&#x27;, error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    restoreState() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            const savedState = localStorage.getItem(&#x27;blog_state&#x27;);</span><br><span class="line">            if (savedState) &#123;</span><br><span class="line">                const parsed = JSON.parse(savedState);</span><br><span class="line">                this.state.user = parsed.user;</span><br><span class="line">                this.state.settings = parsed.settings;</span><br><span class="line">                this.state.favorites = new Map(</span><br><span class="line">                    parsed.favorites?.map(item =&gt; [item.id, item]) || []</span><br><span class="line">                );</span><br><span class="line">                this.state.isAuthenticated = !!parsed.user;</span><br><span class="line">                this.notify();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (error) &#123;</span><br><span class="line">            console.error(&#x27;状态恢复失败:&#x27;, error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // 其他方法与之前的Store类相同</span><br><span class="line">    getState() &#123;</span><br><span class="line">        return this.state;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    setState(newState) &#123;</span><br><span class="line">        this.saveToHistory(this.state);</span><br><span class="line">        this.state = &#123; ...this.state, ...newState &#125;;</span><br><span class="line">        this.notify();</span><br><span class="line">        this.persistState();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    subscribe(listener) &#123;</span><br><span class="line">        this.listeners.add(listener);</span><br><span class="line">        return () =&gt; &#123;</span><br><span class="line">            this.listeners.delete(listener);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    notify() &#123;</span><br><span class="line">        this.listeners.forEach(listener =&gt; listener(this.state));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 组合函数</span><br><span class="line">function compose(...funcs) &#123;</span><br><span class="line">    if (funcs.length === 0) return arg =&gt; arg;</span><br><span class="line">    if (funcs.length === 1) return funcs[0];</span><br><span class="line">    return funcs.reduce((a, b) =&gt; (...args) =&gt; a(b(...args)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 日志中间件</span><br><span class="line">export const loggerMiddleware = store =&gt; next =&gt; action =&gt; &#123;</span><br><span class="line">    console.group(`Dispatching: $&#123;action.type&#125;`);</span><br><span class="line">    console.log(&#x27;Payload:&#x27;, action.payload);</span><br><span class="line">    console.log(&#x27;Previous state:&#x27;, store.getState());</span><br><span class="line">    const result = next(action);</span><br><span class="line">    console.log(&#x27;Next state:&#x27;, store.getState());</span><br><span class="line">    console.groupEnd();</span><br><span class="line">    return result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h3 id="2-添加WebSocket客户端"><a href="#2-添加WebSocket客户端" class="headerlink" title="2. 添加WebSocket客户端"></a>2. 添加WebSocket客户端</h3><p><strong>js&#x2F;websocket.js</strong></p>
<p>javascript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">// WebSocket客户端</span><br><span class="line">export class WebSocketClient &#123;</span><br><span class="line">    constructor(store) &#123;</span><br><span class="line">        this.store = store;</span><br><span class="line">        this.stompClient = null;</span><br><span class="line">        this.reconnectInterval = 5000; // 5秒重连间隔</span><br><span class="line">        this.maxReconnectAttempts = 10;</span><br><span class="line">        this.reconnectAttempts = 0;</span><br><span class="line">        this.subscriptions = new Map();</span><br><span class="line">        this.isConnected = false;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    connect() &#123;</span><br><span class="line">        const token = localStorage.getItem(&#x27;token&#x27;);</span><br><span class="line">        if (!token) return;</span><br><span class="line">        </span><br><span class="line">        const socket = new SockJS(&#x27;http://localhost:8080/ws&#x27;);</span><br><span class="line">        this.stompClient = Stomp.over(socket);</span><br><span class="line">        </span><br><span class="line">        this.stompClient.connect(</span><br><span class="line">            &#123; &#x27;Authorization&#x27;: `Bearer $&#123;token&#125;` &#125;,</span><br><span class="line">            this.onConnected.bind(this),</span><br><span class="line">            this.onError.bind(this)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    onConnected(frame) &#123;</span><br><span class="line">        console.log(&#x27;WebSocket连接成功:&#x27;, frame);</span><br><span class="line">        this.isConnected = true;</span><br><span class="line">        this.reconnectAttempts = 0;</span><br><span class="line">        </span><br><span class="line">        // 订阅用户通知</span><br><span class="line">        this.subscribeToUserNotifications();</span><br><span class="line">        </span><br><span class="line">        // 订阅文章更新</span><br><span class="line">        this.subscribeToArticleUpdates();</span><br><span class="line">        </span><br><span class="line">        // 通知store连接状态</span><br><span class="line">        this.store.dispatch(&#123;</span><br><span class="line">            type: &#x27;WEBSOCKET_CONNECTED&#x27;,</span><br><span class="line">            payload: true</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    onError(error) &#123;</span><br><span class="line">        console.error(&#x27;WebSocket连接错误:&#x27;, error);</span><br><span class="line">        this.isConnected = false;</span><br><span class="line">        </span><br><span class="line">        // 尝试重连</span><br><span class="line">        if (this.reconnectAttempts &lt; this.maxReconnectAttempts) &#123;</span><br><span class="line">            this.reconnectAttempts++;</span><br><span class="line">            setTimeout(() =&gt; this.connect(), this.reconnectInterval);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        this.store.dispatch(&#123;</span><br><span class="line">            type: &#x27;WEBSOCKET_DISCONNECTED&#x27;,</span><br><span class="line">            payload: true</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    subscribeToUserNotifications() &#123;</span><br><span class="line">        const userId = this.store.getState().user?.id;</span><br><span class="line">        if (!userId) return;</span><br><span class="line">        </span><br><span class="line">        const subscription = this.stompClient.subscribe(</span><br><span class="line">            `/queue/notifications/$&#123;userId&#125;`,</span><br><span class="line">            this.handleNotification.bind(this)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        this.subscriptions.set(&#x27;user-notifications&#x27;, subscription);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    subscribeToArticleUpdates() &#123;</span><br><span class="line">        const subscription = this.stompClient.subscribe(</span><br><span class="line">            &#x27;/topic/notifications&#x27;,</span><br><span class="line">            this.handleGlobalNotification.bind(this)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        this.subscriptions.set(&#x27;global-notifications&#x27;, subscription);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    handleNotification(message) &#123;</span><br><span class="line">        const notification = JSON.parse(message.body);</span><br><span class="line">        console.log(&#x27;收到通知:&#x27;, notification);</span><br><span class="line">        </span><br><span class="line">        this.store.dispatch(&#123;</span><br><span class="line">            type: &#x27;ADD_NOTIFICATION&#x27;,</span><br><span class="line">            payload: notification</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        // 显示桌面通知</span><br><span class="line">        if (Notification.permission === &#x27;granted&#x27;) &#123;</span><br><span class="line">            new Notification(notification.title, &#123;</span><br><span class="line">                body: notification.content,</span><br><span class="line">                icon: &#x27;/assets/images/logo.png&#x27;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    handleGlobalNotification(message) &#123;</span><br><span class="line">        const notification = JSON.parse(message.body);</span><br><span class="line">        console.log(&#x27;收到全局通知:&#x27;, notification);</span><br><span class="line">        </span><br><span class="line">        // 处理全局通知逻辑</span><br><span class="line">        // ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    subscribeToArticle(articleId) &#123;</span><br><span class="line">        const destination = `/topic/articles/$&#123;articleId&#125;/updates`;</span><br><span class="line">        const subscription = this.stompClient.subscribe(</span><br><span class="line">            destination,</span><br><span class="line">            (message) =&gt; &#123;</span><br><span class="line">                const update = JSON.parse(message.body);</span><br><span class="line">                this.handleArticleUpdate(update);</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        this.subscriptions.set(`article-$&#123;articleId&#125;`, subscription);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    handleArticleUpdate(update) &#123;</span><br><span class="line">        console.log(&#x27;文章更新:&#x27;, update);</span><br><span class="line">        // 更新store中的文章状态</span><br><span class="line">        // ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    sendCommentNotification(comment) &#123;</span><br><span class="line">        if (!this.isConnected) return;</span><br><span class="line">        </span><br><span class="line">        this.stompClient.send(</span><br><span class="line">            &#x27;/app/comment&#x27;,</span><br><span class="line">            &#123;&#125;,</span><br><span class="line">            JSON.stringify(comment)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    disconnect() &#123;</span><br><span class="line">        if (this.stompClient) &#123;</span><br><span class="line">            // 取消所有订阅</span><br><span class="line">            this.subscriptions.forEach(sub =&gt; sub.unsubscribe());</span><br><span class="line">            this.subscriptions.clear();</span><br><span class="line">            </span><br><span class="line">            this.stompClient.disconnect();</span><br><span class="line">            this.stompClient = null;</span><br><span class="line">            this.isConnected = false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-添加富文本编辑器组件"><a href="#3-添加富文本编辑器组件" class="headerlink" title="3. 添加富文本编辑器组件"></a>3. 添加富文本编辑器组件</h3><p><strong>js&#x2F;components&#x2F;editor.js</strong></p>
<p>javascript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><span class="line">// 富文本编辑器组件</span><br><span class="line">export class RichTextEditor &#123;</span><br><span class="line">    constructor(containerId, options = &#123;&#125;) &#123;</span><br><span class="line">        this.container = document.getElementById(containerId);</span><br><span class="line">        this.options = &#123;</span><br><span class="line">            placeholder: &#x27;请输入内容...&#x27;,</span><br><span class="line">            height: 400,</span><br><span class="line">            uploadUrl: &#x27;/api/files/upload&#x27;,</span><br><span class="line">            ...options</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        this.editor = null;</span><br><span class="line">        this.toolbar = null;</span><br><span class="line">        this.content = &#x27;&#x27;;</span><br><span class="line">        this.init();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    init() &#123;</span><br><span class="line">        if (!this.container) &#123;</span><br><span class="line">            console.error(&#x27;编辑器容器不存在&#x27;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        this.createEditor();</span><br><span class="line">        this.createToolbar();</span><br><span class="line">        this.bindEvents();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    createEditor() &#123;</span><br><span class="line">        this.editor = document.createElement(&#x27;div&#x27;);</span><br><span class="line">        this.editor.className = &#x27;rich-text-editor&#x27;;</span><br><span class="line">        this.editor.contentEditable = true;</span><br><span class="line">        this.editor.style.minHeight = `$&#123;this.options.height&#125;px`;</span><br><span class="line">        this.editor.style.padding = &#x27;10px&#x27;;</span><br><span class="line">        this.editor.style.border = &#x27;1px solid #ddd&#x27;;</span><br><span class="line">        this.editor.style.borderRadius = &#x27;4px&#x27;;</span><br><span class="line">        this.editor.style.outline = &#x27;none&#x27;;</span><br><span class="line">        </span><br><span class="line">        if (this.options.placeholder) &#123;</span><br><span class="line">            this.editor.setAttribute(&#x27;data-placeholder&#x27;, this.options.placeholder);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        this.container.appendChild(this.editor);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    createToolbar() &#123;</span><br><span class="line">        this.toolbar = document.createElement(&#x27;div&#x27;);</span><br><span class="line">        this.toolbar.className = &#x27;editor-toolbar&#x27;;</span><br><span class="line">        this.toolbar.style.marginBottom = &#x27;10px&#x27;;</span><br><span class="line">        this.toolbar.style.padding = &#x27;5px&#x27;;</span><br><span class="line">        this.toolbar.style.backgroundColor = &#x27;#f5f5f5&#x27;;</span><br><span class="line">        this.toolbar.style.borderRadius = &#x27;4px&#x27;;</span><br><span class="line">        </span><br><span class="line">        const buttons = [</span><br><span class="line">            &#123; icon: &#x27;format_bold&#x27;, command: &#x27;bold&#x27;, title: &#x27;加粗&#x27; &#125;,</span><br><span class="line">            &#123; icon: &#x27;format_italic&#x27;, command: &#x27;italic&#x27;, title: &#x27;斜体&#x27; &#125;,</span><br><span class="line">            &#123; icon: &#x27;format_underlined&#x27;, command: &#x27;underline&#x27;, title: &#x27;下划线&#x27; &#125;,</span><br><span class="line">            &#123; icon: &#x27;format_strikethrough&#x27;, command: &#x27;strikeThrough&#x27;, title: &#x27;删除线&#x27; &#125;,</span><br><span class="line">            &#123; separator: true &#125;,</span><br><span class="line">            &#123; icon: &#x27;format_list_bulleted&#x27;, command: &#x27;insertUnorderedList&#x27;, title: &#x27;无序列表&#x27; &#125;,</span><br><span class="line">            &#123; icon: &#x27;format_list_numbered&#x27;, command: &#x27;insertOrderedList&#x27;, title: &#x27;有序列表&#x27; &#125;,</span><br><span class="line">            &#123; icon: &#x27;format_quote&#x27;, command: &#x27;blockquote&#x27;, title: &#x27;引用&#x27; &#125;,</span><br><span class="line">            &#123; separator: true &#125;,</span><br><span class="line">            &#123; icon: &#x27;insert_link&#x27;, command: &#x27;createLink&#x27;, title: &#x27;链接&#x27; &#125;,</span><br><span class="line">            &#123; icon: &#x27;insert_photo&#x27;, action: &#x27;insertImage&#x27;, title: &#x27;插入图片&#x27; &#125;,</span><br><span class="line">            &#123; icon: &#x27;code&#x27;, command: &#x27;code&#x27;, title: &#x27;代码块&#x27; &#125;,</span><br><span class="line">            &#123; separator: true &#125;,</span><br><span class="line">            &#123; icon: &#x27;undo&#x27;, command: &#x27;undo&#x27;, title: &#x27;撤销&#x27; &#125;,</span><br><span class="line">            &#123; icon: &#x27;redo&#x27;, command: &#x27;redo&#x27;, title: &#x27;重做&#x27; &#125;</span><br><span class="line">        ];</span><br><span class="line">        </span><br><span class="line">        buttons.forEach(btn =&gt; &#123;</span><br><span class="line">            if (btn.separator) &#123;</span><br><span class="line">                const separator = document.createElement(&#x27;span&#x27;);</span><br><span class="line">                separator.style.margin = &#x27;0 5px&#x27;;</span><br><span class="line">                separator.style.color = &#x27;#ccc&#x27;;</span><br><span class="line">                separator.textContent = &#x27;|&#x27;;</span><br><span class="line">                this.toolbar.appendChild(separator);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                const button = document.createElement(&#x27;button&#x27;);</span><br><span class="line">                button.type = &#x27;button&#x27;;</span><br><span class="line">                button.className = &#x27;toolbar-btn&#x27;;</span><br><span class="line">                button.innerHTML = `&lt;i class=&quot;material-icons&quot;&gt;$&#123;btn.icon&#125;&lt;/i&gt;`;</span><br><span class="line">                button.title = btn.title;</span><br><span class="line">                button.style.margin = &#x27;0 2px&#x27;;</span><br><span class="line">                button.style.padding = &#x27;5px 8px&#x27;;</span><br><span class="line">                button.style.border = &#x27;none&#x27;;</span><br><span class="line">                button.style.background = &#x27;none&#x27;;</span><br><span class="line">                button.style.borderRadius = &#x27;3px&#x27;;</span><br><span class="line">                button.style.cursor = &#x27;pointer&#x27;;</span><br><span class="line">                </span><br><span class="line">                button.addEventListener(&#x27;mouseenter&#x27;, () =&gt; &#123;</span><br><span class="line">                    button.style.backgroundColor = &#x27;#e0e0e0&#x27;;</span><br><span class="line">                &#125;);</span><br><span class="line">                </span><br><span class="line">                button.addEventListener(&#x27;mouseleave&#x27;, () =&gt; &#123;</span><br><span class="line">                    button.style.backgroundColor = &#x27;transparent&#x27;;</span><br><span class="line">                &#125;);</span><br><span class="line">                </span><br><span class="line">                if (btn.command) &#123;</span><br><span class="line">                    button.addEventListener(&#x27;click&#x27;, () =&gt; &#123;</span><br><span class="line">                        this.execCommand(btn.command);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125; else if (btn.action) &#123;</span><br><span class="line">                    button.addEventListener(&#x27;click&#x27;, () =&gt; &#123;</span><br><span class="line">                        this[btn.action]();</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                this.toolbar.appendChild(button);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        this.container.insertBefore(this.toolbar, this.editor);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    execCommand(command, value = null) &#123;</span><br><span class="line">        document.execCommand(command, false, value);</span><br><span class="line">        this.editor.focus();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    insertImage() &#123;</span><br><span class="line">        const input = document.createElement(&#x27;input&#x27;);</span><br><span class="line">        input.type = &#x27;file&#x27;;</span><br><span class="line">        input.accept = &#x27;image/*&#x27;;</span><br><span class="line">        </span><br><span class="line">        input.onchange = async (e) =&gt; &#123;</span><br><span class="line">            const file = e.target.files[0];</span><br><span class="line">            if (!file) return;</span><br><span class="line">            </span><br><span class="line">            try &#123;</span><br><span class="line">                // 显示加载状态</span><br><span class="line">                const placeholder = this.insertPlaceholder(&#x27;上传中...&#x27;);</span><br><span class="line">                </span><br><span class="line">                // 上传图片</span><br><span class="line">                const url = await this.uploadImage(file);</span><br><span class="line">                </span><br><span class="line">                // 插入图片到编辑器</span><br><span class="line">                this.execCommand(&#x27;insertHTML&#x27;, </span><br><span class="line">                    `&lt;img src=&quot;$&#123;url&#125;&quot; alt=&quot;$&#123;file.name&#125;&quot; style=&quot;max-width: 100%;&quot;&gt;`);</span><br><span class="line">                </span><br><span class="line">                // 移除占位符</span><br><span class="line">                placeholder.remove();</span><br><span class="line">            &#125; catch (error) &#123;</span><br><span class="line">                console.error(&#x27;图片上传失败:&#x27;, error);</span><br><span class="line">                alert(&#x27;图片上传失败&#x27;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        input.click();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async uploadImage(file) &#123;</span><br><span class="line">        const formData = new FormData();</span><br><span class="line">        formData.append(&#x27;file&#x27;, file);</span><br><span class="line">        </span><br><span class="line">        const response = await fetch(this.options.uploadUrl, &#123;</span><br><span class="line">            method: &#x27;POST&#x27;,</span><br><span class="line">            headers: &#123;</span><br><span class="line">                &#x27;Authorization&#x27;: `Bearer $&#123;localStorage.getItem(&#x27;token&#x27;)&#125;`</span><br><span class="line">            &#125;,</span><br><span class="line">            body: formData</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        if (!response.ok) &#123;</span><br><span class="line">            throw new Error(&#x27;上传失败&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        const data = await response.json();</span><br><span class="line">        return data.url;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    insertPlaceholder(text) &#123;</span><br><span class="line">        const placeholder = document.createElement(&#x27;span&#x27;);</span><br><span class="line">        placeholder.className = &#x27;upload-placeholder&#x27;;</span><br><span class="line">        placeholder.textContent = text;</span><br><span class="line">        placeholder.style.color = &#x27;#999&#x27;;</span><br><span class="line">        placeholder.style.fontStyle = &#x27;italic&#x27;;</span><br><span class="line">        </span><br><span class="line">        const selection = window.getSelection();</span><br><span class="line">        const range = selection.getRangeAt(0);</span><br><span class="line">        range.deleteContents();</span><br><span class="line">        range.insertNode(placeholder);</span><br><span class="line">        </span><br><span class="line">        return placeholder;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    bindEvents() &#123;</span><br><span class="line">        // 自动保存</span><br><span class="line">        let saveTimer;</span><br><span class="line">        this.editor.addEventListener(&#x27;input&#x27;, () =&gt; &#123;</span><br><span class="line">            clearTimeout(saveTimer);</span><br><span class="line">            saveTimer = setTimeout(() =&gt; &#123;</span><br><span class="line">                this.autoSave();</span><br><span class="line">            &#125;, 1000);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        // 粘贴事件处理</span><br><span class="line">        this.editor.addEventListener(&#x27;paste&#x27;, (e) =&gt; &#123;</span><br><span class="line">            e.preventDefault();</span><br><span class="line">            const text = e.clipboardData.getData(&#x27;text/plain&#x27;);</span><br><span class="line">            document.execCommand(&#x27;insertText&#x27;, false, text);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        // 拖放图片</span><br><span class="line">        this.editor.addEventListener(&#x27;drop&#x27;, async (e) =&gt; &#123;</span><br><span class="line">            e.preventDefault();</span><br><span class="line">            const files = e.dataTransfer.files;</span><br><span class="line">            if (files.length &gt; 0) &#123;</span><br><span class="line">                for (const file of files) &#123;</span><br><span class="line">                    if (file.type.startsWith(&#x27;image/&#x27;)) &#123;</span><br><span class="line">                        const url = await this.uploadImage(file);</span><br><span class="line">                        this.execCommand(&#x27;insertHTML&#x27;,</span><br><span class="line">                            `&lt;img src=&quot;$&#123;url&#125;&quot; alt=&quot;$&#123;file.name&#125;&quot; style=&quot;max-width: 100%;&quot;&gt;`);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        this.editor.addEventListener(&#x27;dragover&#x27;, (e) =&gt; &#123;</span><br><span class="line">            e.preventDefault();</span><br><span class="line">            e.dataTransfer.dropEffect = &#x27;copy&#x27;;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    autoSave() &#123;</span><br><span class="line">        const content = this.getContent();</span><br><span class="line">        if (content !== this.content) &#123;</span><br><span class="line">            this.content = content;</span><br><span class="line">            this.options.onAutoSave?.(content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    getContent() &#123;</span><br><span class="line">        return this.editor.innerHTML;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    setContent(html) &#123;</span><br><span class="line">        this.editor.innerHTML = html;</span><br><span class="line">        this.content = html;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    getText() &#123;</span><br><span class="line">        return this.editor.textContent;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    focus() &#123;</span><br><span class="line">        this.editor.focus();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    destroy() &#123;</span><br><span class="line">        if (this.toolbar) &#123;</span><br><span class="line">            this.toolbar.remove();</span><br><span class="line">        &#125;</span><br><span class="line">        if (this.editor) &#123;</span><br><span class="line">            this.editor.remove();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-添加图表分析组件"><a href="#4-添加图表分析组件" class="headerlink" title="4. 添加图表分析组件"></a>4. 添加图表分析组件</h3><p><strong>js&#x2F;components&#x2F;charts.js</strong></p>
<p>javascript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line">// 图表组件</span><br><span class="line">export class BlogCharts &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        this.charts = new Map();</span><br><span class="line">        this.colors = [</span><br><span class="line">            &#x27;#007bff&#x27;, &#x27;#28a745&#x27;, &#x27;#dc3545&#x27;, &#x27;#ffc107&#x27;, &#x27;#17a2b8&#x27;,</span><br><span class="line">            &#x27;#6c757d&#x27;, &#x27;#6610f2&#x27;, &#x27;#fd7e14&#x27;, &#x27;#e83e8c&#x27;, &#x27;#20c997&#x27;</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    renderArticleStats(containerId, stats) &#123;</span><br><span class="line">        const container = document.getElementById(containerId);</span><br><span class="line">        if (!container) return;</span><br><span class="line">        </span><br><span class="line">        const canvas = document.createElement(&#x27;canvas&#x27;);</span><br><span class="line">        container.appendChild(canvas);</span><br><span class="line">        </span><br><span class="line">        const ctx = canvas.getContext(&#x27;2d&#x27;);</span><br><span class="line">        const chart = new Chart(ctx, &#123;</span><br><span class="line">            type: &#x27;bar&#x27;,</span><br><span class="line">            data: &#123;</span><br><span class="line">                labels: stats.months,</span><br><span class="line">                datasets: [&#123;</span><br><span class="line">                    label: &#x27;发布文章数&#x27;,</span><br><span class="line">                    data: stats.articleCounts,</span><br><span class="line">                    backgroundColor: this.colors[0],</span><br><span class="line">                    borderColor: this.colors[0],</span><br><span class="line">                    borderWidth: 1</span><br><span class="line">                &#125;, &#123;</span><br><span class="line">                    label: &#x27;阅读量&#x27;,</span><br><span class="line">                    data: stats.viewCounts,</span><br><span class="line">                    backgroundColor: this.colors[1],</span><br><span class="line">                    borderColor: this.colors[1],</span><br><span class="line">                    borderWidth: 1</span><br><span class="line">                &#125;]</span><br><span class="line">            &#125;,</span><br><span class="line">            options: &#123;</span><br><span class="line">                responsive: true,</span><br><span class="line">                scales: &#123;</span><br><span class="line">                    y: &#123;</span><br><span class="line">                        beginAtZero: true,</span><br><span class="line">                        ticks: &#123;</span><br><span class="line">                            stepSize: 1</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        this.charts.set(containerId, chart);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    renderTagCloud(containerId, tags) &#123;</span><br><span class="line">        const container = document.getElementById(containerId);</span><br><span class="line">        if (!container) return;</span><br><span class="line">        </span><br><span class="line">        container.innerHTML = &#x27;&#x27;;</span><br><span class="line">        </span><br><span class="line">        // 计算标签大小范围</span><br><span class="line">        const counts = tags.map(t =&gt; t.count);</span><br><span class="line">        const minCount = Math.min(...counts);</span><br><span class="line">        const maxCount = Math.max(...counts);</span><br><span class="line">        const minSize = 12;</span><br><span class="line">        const maxSize = 32;</span><br><span class="line">        </span><br><span class="line">        tags.forEach((tag, index) =&gt; &#123;</span><br><span class="line">            const size = minSize + (tag.count - minCount) * (maxSize - minSize) / (maxCount - minCount);</span><br><span class="line">            const color = this.colors[index % this.colors.length];</span><br><span class="line">            </span><br><span class="line">            const tagElement = document.createElement(&#x27;a&#x27;);</span><br><span class="line">            tagElement.href = `/tag/$&#123;tag.id&#125;`;</span><br><span class="line">            tagElement.className = &#x27;tag-cloud-item&#x27;;</span><br><span class="line">            tagElement.textContent = tag.name;</span><br><span class="line">            tagElement.style.fontSize = `$&#123;size&#125;px`;</span><br><span class="line">            tagElement.style.color = color;</span><br><span class="line">            tagElement.style.margin = &#x27;5px 10px&#x27;;</span><br><span class="line">            tagElement.style.display = &#x27;inline-block&#x27;;</span><br><span class="line">            tagElement.style.textDecoration = &#x27;none&#x27;;</span><br><span class="line">            tagElement.style.opacity = &#x27;0.8&#x27;;</span><br><span class="line">            tagElement.style.transition = &#x27;all 0.3s ease&#x27;;</span><br><span class="line">            </span><br><span class="line">            tagElement.addEventListener(&#x27;mouseenter&#x27;, () =&gt; &#123;</span><br><span class="line">                tagElement.style.opacity = &#x27;1&#x27;;</span><br><span class="line">                tagElement.style.transform = &#x27;translateY(-2px)&#x27;;</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">            tagElement.addEventListener(&#x27;mouseleave&#x27;, () =&gt; &#123;</span><br><span class="line">                tagElement.style.opacity = &#x27;0.8&#x27;;</span><br><span class="line">                tagElement.style.transform = &#x27;translateY(0)&#x27;;</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">            // 添加计数</span><br><span class="line">            const count = document.createElement(&#x27;span&#x27;);</span><br><span class="line">            count.textContent = `($&#123;tag.count&#125;)`;</span><br><span class="line">            count.style.fontSize = `$&#123;size * 0.7&#125;px`;</span><br><span class="line">            count.style.marginLeft = &#x27;5px&#x27;;</span><br><span class="line">            count.style.opacity = &#x27;0.7&#x27;;</span><br><span class="line">            tagElement.appendChild(count);</span><br><span class="line">            </span><br><span class="line">            container.appendChild(tagElement);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    renderUserActivity(containerId, activity) &#123;</span><br><span class="line">        const container = document.getElementById(containerId);</span><br><span class="line">        if (!container) return;</span><br><span class="line">        </span><br><span class="line">        const canvas = document.createElement(&#x27;canvas&#x27;);</span><br><span class="line">        container.appendChild(canvas);</span><br><span class="line">        </span><br><span class="line">        const ctx = canvas.getContext(&#x27;2d&#x27;);</span><br><span class="line">        const chart = new Chart(ctx, &#123;</span><br><span class="line">            type: &#x27;line&#x27;,</span><br><span class="line">            data: &#123;</span><br><span class="line">                labels: activity.dates,</span><br><span class="line">                datasets: [&#123;</span><br><span class="line">                    label: &#x27;发表文章&#x27;,</span><br><span class="line">                    data: activity.articles,</span><br><span class="line">                    borderColor: this.colors[0],</span><br><span class="line">                    backgroundColor: `$&#123;this.colors[0]&#125;20`,</span><br><span class="line">                    tension: 0.3,</span><br><span class="line">                    fill: true</span><br><span class="line">                &#125;, &#123;</span><br><span class="line">                    label: &#x27;发表评论&#x27;,</span><br><span class="line">                    data: activity.comments,</span><br><span class="line">                    borderColor: this.colors[1],</span><br><span class="line">                    backgroundColor: `$&#123;this.colors[1]&#125;20`,</span><br><span class="line">                    tension: 0.3,</span><br><span class="line">                    fill: true</span><br><span class="line">                &#125;]</span><br><span class="line">            &#125;,</span><br><span class="line">            options: &#123;</span><br><span class="line">                responsive: true,</span><br><span class="line">                interaction: &#123;</span><br><span class="line">                    intersect: false,</span><br><span class="line">                    mode: &#x27;index&#x27;</span><br><span class="line">                &#125;,</span><br><span class="line">                scales: &#123;</span><br><span class="line">                    y: &#123;</span><br><span class="line">                        beginAtZero: true,</span><br><span class="line">                        ticks: &#123;</span><br><span class="line">                            stepSize: 1</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        this.charts.set(containerId, chart);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    renderCategoryDistribution(containerId, categories) &#123;</span><br><span class="line">        const container = document.getElementById(containerId);</span><br><span class="line">        if (!container) return;</span><br><span class="line">        </span><br><span class="line">        const canvas = document.createElement(&#x27;canvas&#x27;);</span><br><span class="line">        container.appendChild(canvas);</span><br><span class="line">        </span><br><span class="line">        const ctx = canvas.getContext(&#x27;2d&#x27;);</span><br><span class="line">        const chart = new Chart(ctx, &#123;</span><br><span class="line">            type: &#x27;pie&#x27;,</span><br><span class="line">            data: &#123;</span><br><span class="line">                labels: categories.map(c =&gt; c.name),</span><br><span class="line">                datasets: [&#123;</span><br><span class="line">                    data: categories.map(c =&gt; c.count),</span><br><span class="line">                    backgroundColor: this.colors.slice(0, categories.length),</span><br><span class="line">                    borderWidth: 1</span><br><span class="line">                &#125;]</span><br><span class="line">            &#125;,</span><br><span class="line">            options: &#123;</span><br><span class="line">                responsive: true,</span><br><span class="line">                plugins: &#123;</span><br><span class="line">                    legend: &#123;</span><br><span class="line">                        position: &#x27;right&#x27;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    tooltip: &#123;</span><br><span class="line">                        callbacks: &#123;</span><br><span class="line">                            label: (context) =&gt; &#123;</span><br><span class="line">                                const label = context.label || &#x27;&#x27;;</span><br><span class="line">                                const value = context.raw || 0;</span><br><span class="line">                                const total = context.dataset.data.reduce((a, b) =&gt; a + b, 0);</span><br><span class="line">                                const percentage = Math.round((value / total) * 100);</span><br><span class="line">                                return `$&#123;label&#125;: $&#123;value&#125; ($&#123;percentage&#125;%)`;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        this.charts.set(containerId, chart);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    destroy(containerId) &#123;</span><br><span class="line">        const chart = this.charts.get(containerId);</span><br><span class="line">        if (chart) &#123;</span><br><span class="line">            chart.destroy();</span><br><span class="line">            this.charts.delete(containerId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    destroyAll() &#123;</span><br><span class="line">        this.charts.forEach(chart =&gt; chart.destroy());</span><br><span class="line">        this.charts.clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5-添加SEO优化组件"><a href="#5-添加SEO优化组件" class="headerlink" title="5. 添加SEO优化组件"></a>5. 添加SEO优化组件</h3><p><strong>js&#x2F;seo.js</strong></p>
<p>javascript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br></pre></td><td class="code"><pre><span class="line">// SEO优化</span><br><span class="line">export class SEO &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        this.metaTags = new Map();</span><br><span class="line">        this.init();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    init() &#123;</span><br><span class="line">        // 监听路由变化</span><br><span class="line">        window.addEventListener(&#x27;popstate&#x27;, () =&gt; this.update());</span><br><span class="line">        document.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;</span><br><span class="line">            if (e.target.matches(&#x27;[data-link]&#x27;)) &#123;</span><br><span class="line">                setTimeout(() =&gt; this.update(), 100);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    update() &#123;</span><br><span class="line">        const path = window.location.pathname;</span><br><span class="line">        const title = this.getPageTitle(path);</span><br><span class="line">        const description = this.getPageDescription(path);</span><br><span class="line">        const keywords = this.getPageKeywords(path);</span><br><span class="line">        </span><br><span class="line">        this.setTitle(title);</span><br><span class="line">        this.setMeta(&#x27;description&#x27;, description);</span><br><span class="line">        this.setMeta(&#x27;keywords&#x27;, keywords);</span><br><span class="line">        </span><br><span class="line">        // 设置Open Graph标签</span><br><span class="line">        this.setOGTags(path);</span><br><span class="line">        </span><br><span class="line">        // 设置Twitter Card标签</span><br><span class="line">        this.setTwitterTags(path);</span><br><span class="line">        </span><br><span class="line">        // 更新canonical链接</span><br><span class="line">        this.setCanonicalLink(path);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    getPageTitle(path) &#123;</span><br><span class="line">        const titles = &#123;</span><br><span class="line">            &#x27;/&#x27;: &#x27;个人博客 - 分享技术与生活&#x27;,</span><br><span class="line">            &#x27;/about&#x27;: &#x27;关于我们 - 个人博客&#x27;,</span><br><span class="line">            &#x27;/contact&#x27;: &#x27;联系我们 - 个人博客&#x27;,</span><br><span class="line">            &#x27;/login&#x27;: &#x27;登录 - 个人博客&#x27;,</span><br><span class="line">            &#x27;/register&#x27;: &#x27;注册 - 个人博客&#x27;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        // 文章页面</span><br><span class="line">        if (path.startsWith(&#x27;/article/&#x27;)) &#123;</span><br><span class="line">            const articleTitle = document.querySelector(&#x27;.article-title&#x27;)?.textContent;</span><br><span class="line">            return `$&#123;articleTitle&#125; - 个人博客`;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 分类页面</span><br><span class="line">        if (path.startsWith(&#x27;/category/&#x27;)) &#123;</span><br><span class="line">            const categoryName = document.querySelector(&#x27;.category-name&#x27;)?.textContent;</span><br><span class="line">            return `$&#123;categoryName&#125; - 文章分类 - 个人博客`;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return titles[path] || &#x27;个人博客&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    getPageDescription(path) &#123;</span><br><span class="line">        const descriptions = &#123;</span><br><span class="line">            &#x27;/&#x27;: &#x27;一个技术爱好者的个人博客，分享编程经验、技术文章和生活感悟&#x27;,</span><br><span class="line">            &#x27;/about&#x27;: &#x27;了解我们的博客故事和团队&#x27;,</span><br><span class="line">            &#x27;/contact&#x27;: &#x27;有任何问题或建议，欢迎联系我们&#x27;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        if (path.startsWith(&#x27;/article/&#x27;)) &#123;</span><br><span class="line">            const excerpt = document.querySelector(&#x27;.article-excerpt&#x27;)?.textContent;</span><br><span class="line">            return excerpt || &#x27;阅读技术文章，学习编程知识&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return descriptions[path] || &#x27;个人技术博客，分享有价值的技术内容&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    getPageKeywords(path) &#123;</span><br><span class="line">        const keywords = [&#x27;博客&#x27;, &#x27;技术&#x27;, &#x27;编程&#x27;, &#x27;开发&#x27;];</span><br><span class="line">        </span><br><span class="line">        if (path.startsWith(&#x27;/article/&#x27;)) &#123;</span><br><span class="line">            const tagElements = document.querySelectorAll(&#x27;.article-tags .tag&#x27;);</span><br><span class="line">            const tags = Array.from(tagElements).map(el =&gt; el.textContent);</span><br><span class="line">            return [...keywords, ...tags].join(&#x27;, &#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return keywords.join(&#x27;, &#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    setTitle(title) &#123;</span><br><span class="line">        document.title = title;</span><br><span class="line">        this.setMeta(&#x27;og:title&#x27;, title);</span><br><span class="line">        this.setMeta(&#x27;twitter:title&#x27;, title);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    setMeta(name, content) &#123;</span><br><span class="line">        if (!content) return;</span><br><span class="line">        </span><br><span class="line">        let meta = this.metaTags.get(name);</span><br><span class="line">        if (!meta) &#123;</span><br><span class="line">            meta = document.createElement(&#x27;meta&#x27;);</span><br><span class="line">            meta.setAttribute(&#x27;name&#x27;, name);</span><br><span class="line">            document.head.appendChild(meta);</span><br><span class="line">            this.metaTags.set(name, meta);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        meta.setAttribute(&#x27;content&#x27;, content);</span><br><span class="line">        </span><br><span class="line">        // 同时设置property属性（用于Open Graph）</span><br><span class="line">        if (name.startsWith(&#x27;og:&#x27;)) &#123;</span><br><span class="line">            meta.setAttribute(&#x27;property&#x27;, name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    setOGTags(path) &#123;</span><br><span class="line">        const url = window.location.href;</span><br><span class="line">        const image = this.getPageImage(path);</span><br><span class="line">        </span><br><span class="line">        this.setMeta(&#x27;og:type&#x27;, &#x27;website&#x27;);</span><br><span class="line">        this.setMeta(&#x27;og:url&#x27;, url);</span><br><span class="line">        this.setMeta(&#x27;og:image&#x27;, image);</span><br><span class="line">        this.setMeta(&#x27;og:locale&#x27;, &#x27;zh_CN&#x27;);</span><br><span class="line">        this.setMeta(&#x27;og:site_name&#x27;, &#x27;个人博客&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    setTwitterTags(path) &#123;</span><br><span class="line">        this.setMeta(&#x27;twitter:card&#x27;, &#x27;summary_large_image&#x27;);</span><br><span class="line">        this.setMeta(&#x27;twitter:site&#x27;, &#x27;@blog&#x27;);</span><br><span class="line">        this.setMeta(&#x27;twitter:creator&#x27;, &#x27;@author&#x27;);</span><br><span class="line">        this.setMeta(&#x27;twitter:image&#x27;, this.getPageImage(path));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    getPageImage(path) &#123;</span><br><span class="line">        if (path.startsWith(&#x27;/article/&#x27;)) &#123;</span><br><span class="line">            const image = document.querySelector(&#x27;.article-cover img&#x27;)?.src ||</span><br><span class="line">                         document.querySelector(&#x27;.article-content img&#x27;)?.src;</span><br><span class="line">            return image || &#x27;https://example.com/default-image.jpg&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        return &#x27;https://example.com/logo.png&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    setCanonicalLink(path) &#123;</span><br><span class="line">        let link = this.metaTags.get(&#x27;canonical&#x27;);</span><br><span class="line">        if (!link) &#123;</span><br><span class="line">            link = document.createElement(&#x27;link&#x27;);</span><br><span class="line">            link.setAttribute(&#x27;rel&#x27;, &#x27;canonical&#x27;);</span><br><span class="line">            document.head.appendChild(link);</span><br><span class="line">            this.metaTags.set(&#x27;canonical&#x27;, link);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        const url = `https://blog.example.com$&#123;path&#125;`;</span><br><span class="line">        link.setAttribute(&#x27;href&#x27;, url);</span><br><span class="line">        </span><br><span class="line">        // 设置hreflang标签</span><br><span class="line">        this.setHreflangTags();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    setHreflangTags() &#123;</span><br><span class="line">        const languages = [&#x27;zh-CN&#x27;, &#x27;en-US&#x27;];</span><br><span class="line">        const currentUrl = window.location.href;</span><br><span class="line">        </span><br><span class="line">        languages.forEach(lang =&gt; &#123;</span><br><span class="line">            const key = `hreflang-$&#123;lang&#125;`;</span><br><span class="line">            let link = this.metaTags.get(key);</span><br><span class="line">            </span><br><span class="line">            if (!link) &#123;</span><br><span class="line">                link = document.createElement(&#x27;link&#x27;);</span><br><span class="line">                link.setAttribute(&#x27;rel&#x27;, &#x27;alternate&#x27;);</span><br><span class="line">                link.setAttribute(&#x27;hreflang&#x27;, lang);</span><br><span class="line">                document.head.appendChild(link);</span><br><span class="line">                this.metaTags.set(key, link);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            // 这里应该根据语言生成对应的URL</span><br><span class="line">            link.setAttribute(&#x27;href&#x27;, currentUrl.replace(&#x27;/zh/&#x27;, `/$&#123;lang.split(&#x27;-&#x27;)[0]&#125;/`));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    generateStructuredData(article) &#123;</span><br><span class="line">        const structuredData = &#123;</span><br><span class="line">            &#x27;@context&#x27;: &#x27;https://schema.org&#x27;,</span><br><span class="line">            &#x27;@type&#x27;: &#x27;BlogPosting&#x27;,</span><br><span class="line">            &#x27;headline&#x27;: article.title,</span><br><span class="line">            &#x27;description&#x27;: article.summary,</span><br><span class="line">            &#x27;author&#x27;: &#123;</span><br><span class="line">                &#x27;@type&#x27;: &#x27;Person&#x27;,</span><br><span class="line">                &#x27;name&#x27;: article.author.displayName</span><br><span class="line">            &#125;,</span><br><span class="line">            &#x27;publisher&#x27;: &#123;</span><br><span class="line">                &#x27;@type&#x27;: &#x27;Organization&#x27;,</span><br><span class="line">                &#x27;name&#x27;: &#x27;个人博客&#x27;,</span><br><span class="line">                &#x27;logo&#x27;: &#123;</span><br><span class="line">                    &#x27;@type&#x27;: &#x27;ImageObject&#x27;,</span><br><span class="line">                    &#x27;url&#x27;: &#x27;https://blog.example.com/logo.png&#x27;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#x27;datePublished&#x27;: article.publishedAt,</span><br><span class="line">            &#x27;dateModified&#x27;: article.updatedAt,</span><br><span class="line">            &#x27;image&#x27;: article.coverImage,</span><br><span class="line">            &#x27;mainEntityOfPage&#x27;: &#123;</span><br><span class="line">                &#x27;@type&#x27;: &#x27;WebPage&#x27;,</span><br><span class="line">                &#x27;@id&#x27;: window.location.href</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        const script = document.createElement(&#x27;script&#x27;);</span><br><span class="line">        script.type = &#x27;application/ld+json&#x27;;</span><br><span class="line">        script.textContent = JSON.stringify(structuredData);</span><br><span class="line">        document.head.appendChild(script);</span><br><span class="line">        </span><br><span class="line">        this.structuredDataScript = script;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    removeStructuredData() &#123;</span><br><span class="line">        if (this.structuredDataScript) &#123;</span><br><span class="line">            this.structuredDataScript.remove();</span><br><span class="line">            this.structuredDataScript = null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    generateBreadcrumb(items) &#123;</span><br><span class="line">        const breadcrumbData = &#123;</span><br><span class="line">            &#x27;@context&#x27;: &#x27;https://schema.org&#x27;,</span><br><span class="line">            &#x27;@type&#x27;: &#x27;BreadcrumbList&#x27;,</span><br><span class="line">            &#x27;itemListElement&#x27;: items.map((item, index) =&gt; (&#123;</span><br><span class="line">                &#x27;@type&#x27;: &#x27;ListItem&#x27;,</span><br><span class="line">                &#x27;position&#x27;: index + 1,</span><br><span class="line">                &#x27;name&#x27;: item.name,</span><br><span class="line">                &#x27;item&#x27;: item.url</span><br><span class="line">            &#125;))</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        const script = document.createElement(&#x27;script&#x27;);</span><br><span class="line">        script.type = &#x27;application/ld+json&#x27;;</span><br><span class="line">        script.textContent = JSON.stringify(breadcrumbData);</span><br><span class="line">        document.head.appendChild(script);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="第三部分：高级功能页面"><a href="#第三部分：高级功能页面" class="headerlink" title="第三部分：高级功能页面"></a>第三部分：高级功能页面</h2><h3 id="1-管理后台页面"><a href="#1-管理后台页面" class="headerlink" title="1. 管理后台页面"></a>1. 管理后台页面</h3><p><strong>admin.html</strong></p>
<p>html</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;zh-CN&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;管理后台 - 个人博客&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;css/admin.css&quot;&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css&quot;&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.css&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body class=&quot;admin-body&quot;&gt;</span><br><span class="line">    &lt;!-- 侧边栏 --&gt;</span><br><span class="line">    &lt;aside class=&quot;admin-sidebar&quot; id=&quot;sidebar&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;sidebar-header&quot;&gt;</span><br><span class="line">            &lt;h2&gt;&lt;i class=&quot;fas fa-tachometer-alt&quot;&gt;&lt;/i&gt; 管理后台&lt;/h2&gt;</span><br><span class="line">            &lt;button class=&quot;sidebar-toggle&quot; id=&quot;sidebar-toggle&quot;&gt;</span><br><span class="line">                &lt;i class=&quot;fas fa-bars&quot;&gt;&lt;/i&gt;</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;nav class=&quot;sidebar-nav&quot;&gt;</span><br><span class="line">            &lt;ul class=&quot;nav-menu&quot;&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#dashboard&quot; class=&quot;nav-link active&quot; data-module=&quot;dashboard&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-home&quot;&gt;&lt;/i&gt; 仪表盘</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#articles&quot; class=&quot;nav-link&quot; data-module=&quot;articles&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-newspaper&quot;&gt;&lt;/i&gt; 文章管理</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#comments&quot; class=&quot;nav-link&quot; data-module=&quot;comments&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-comments&quot;&gt;&lt;/i&gt; 评论管理</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#categories&quot; class=&quot;nav-link&quot; data-module=&quot;categories&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-folder&quot;&gt;&lt;/i&gt; 分类管理</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#tags&quot; class=&quot;nav-link&quot; data-module=&quot;tags&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-tags&quot;&gt;&lt;/i&gt; 标签管理</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#users&quot; class=&quot;nav-link&quot; data-module=&quot;users&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-users&quot;&gt;&lt;/i&gt; 用户管理</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#media&quot; class=&quot;nav-link&quot; data-module=&quot;media&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-images&quot;&gt;&lt;/i&gt; 媒体库</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#settings&quot; class=&quot;nav-link&quot; data-module=&quot;settings&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-cog&quot;&gt;&lt;/i&gt; 系统设置</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#analytics&quot; class=&quot;nav-link&quot; data-module=&quot;analytics&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-chart-bar&quot;&gt;&lt;/i&gt; 数据分析</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;div class=&quot;sidebar-footer&quot;&gt;</span><br><span class="line">                &lt;a href=&quot;/&quot; class=&quot;btn btn-outline&quot;&gt;</span><br><span class="line">                    &lt;i class=&quot;fas fa-globe&quot;&gt;&lt;/i&gt; 查看网站</span><br><span class="line">                &lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/nav&gt;</span><br><span class="line">    &lt;/aside&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 主内容区 --&gt;</span><br><span class="line">    &lt;main class=&quot;admin-main&quot;&gt;</span><br><span class="line">        &lt;!-- 顶部导航栏 --&gt;</span><br><span class="line">        &lt;header class=&quot;admin-header&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;header-left&quot;&gt;</span><br><span class="line">                &lt;h1 id=&quot;page-title&quot;&gt;仪表盘&lt;/h1&gt;</span><br><span class="line">                &lt;nav class=&quot;breadcrumb&quot; id=&quot;breadcrumb&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#dashboard&quot;&gt;首页&lt;/a&gt;</span><br><span class="line">                &lt;/nav&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;div class=&quot;header-right&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;user-info&quot;&gt;</span><br><span class="line">                    &lt;img src=&quot;assets/images/avatar.jpg&quot; alt=&quot;用户头像&quot; class=&quot;user-avatar&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;user-details&quot;&gt;</span><br><span class="line">                        &lt;span class=&quot;user-name&quot; id=&quot;admin-username&quot;&gt;管理员&lt;/span&gt;</span><br><span class="line">                        &lt;span class=&quot;user-role&quot;&gt;超级管理员&lt;/span&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;button class=&quot;user-menu-btn&quot; id=&quot;user-menu-btn&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-chevron-down&quot;&gt;&lt;/i&gt;</span><br><span class="line">                    &lt;/button&gt;</span><br><span class="line">                    &lt;div class=&quot;user-dropdown&quot; id=&quot;user-dropdown&quot;&gt;</span><br><span class="line">                        &lt;a href=&quot;/profile&quot; data-link&gt;</span><br><span class="line">                            &lt;i class=&quot;fas fa-user&quot;&gt;&lt;/i&gt; 个人资料</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                        &lt;a href=&quot;/settings&quot;&gt;</span><br><span class="line">                            &lt;i class=&quot;fas fa-cog&quot;&gt;&lt;/i&gt; 账户设置</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                        &lt;hr&gt;</span><br><span class="line">                        &lt;a href=&quot;#&quot; id=&quot;logout&quot;&gt;</span><br><span class="line">                            &lt;i class=&quot;fas fa-sign-out-alt&quot;&gt;&lt;/i&gt; 退出登录</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                </span><br><span class="line">                &lt;button class=&quot;notification-btn&quot; id=&quot;notification-btn&quot;&gt;</span><br><span class="line">                    &lt;i class=&quot;fas fa-bell&quot;&gt;&lt;/i&gt;</span><br><span class="line">                    &lt;span class=&quot;notification-badge&quot; id=&quot;notification-badge&quot;&gt;3&lt;/span&gt;</span><br><span class="line">                &lt;/button&gt;</span><br><span class="line">                </span><br><span class="line">                &lt;div class=&quot;notification-panel&quot; id=&quot;notification-panel&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;notification-header&quot;&gt;</span><br><span class="line">                        &lt;h3&gt;通知&lt;/h3&gt;</span><br><span class="line">                        &lt;button class=&quot;mark-all-read&quot;&gt;全部标记为已读&lt;/button&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;notification-list&quot; id=&quot;notification-list&quot;&gt;</span><br><span class="line">                        &lt;!-- 通知列表 --&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/header&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- 页面内容 --&gt;</span><br><span class="line">        &lt;div class=&quot;admin-content&quot; id=&quot;admin-content&quot;&gt;</span><br><span class="line">            &lt;!-- 动态加载模块内容 --&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/main&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 模态框容器 --&gt;</span><br><span class="line">    &lt;div id=&quot;admin-modal-container&quot;&gt;&lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 加载动画 --&gt;</span><br><span class="line">    &lt;div id=&quot;admin-loading&quot; class=&quot;loading-overlay&quot; style=&quot;display: none;&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;loading-spinner&quot;&gt;</span><br><span class="line">            &lt;i class=&quot;fas fa-spinner fa-spin&quot;&gt;&lt;/i&gt;</span><br><span class="line">            &lt;span&gt;加载中...&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 脚本 --&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;js/admin/app.js&quot; type=&quot;module&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<p><strong>css&#x2F;admin.css</strong></p>
<p>css</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br></pre></td><td class="code"><pre><span class="line">/* 管理后台样式 */</span><br><span class="line"></span><br><span class="line">.admin-body &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    margin: 0;</span><br><span class="line">    font-family: -apple-system, BlinkMacSystemFont, &#x27;Segoe UI&#x27;, Roboto, &#x27;Helvetica Neue&#x27;, Arial, sans-serif;</span><br><span class="line">    background-color: #f5f5f5;</span><br><span class="line">    min-height: 100vh;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 侧边栏 */</span><br><span class="line">.admin-sidebar &#123;</span><br><span class="line">    width: 250px;</span><br><span class="line">    background-color: #2c3e50;</span><br><span class="line">    color: #ecf0f1;</span><br><span class="line">    transition: all 0.3s ease;</span><br><span class="line">    position: fixed;</span><br><span class="line">    height: 100vh;</span><br><span class="line">    overflow-y: auto;</span><br><span class="line">    z-index: 1000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.sidebar-header &#123;</span><br><span class="line">    padding: 20px;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    align-items: center;</span><br><span class="line">    border-bottom: 1px solid #34495e;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.sidebar-header h2 &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    font-size: 1.2rem;</span><br><span class="line">    font-weight: 600;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.sidebar-header h2 i &#123;</span><br><span class="line">    margin-right: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.sidebar-toggle &#123;</span><br><span class="line">    background: none;</span><br><span class="line">    border: none;</span><br><span class="line">    color: #ecf0f1;</span><br><span class="line">    font-size: 1.2rem;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    display: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.sidebar-nav &#123;</span><br><span class="line">    padding: 20px 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-menu &#123;</span><br><span class="line">    list-style: none;</span><br><span class="line">    padding: 0;</span><br><span class="line">    margin: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-item &#123;</span><br><span class="line">    margin: 5px 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-link &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    padding: 12px 20px;</span><br><span class="line">    color: #bdc3c7;</span><br><span class="line">    text-decoration: none;</span><br><span class="line">    transition: all 0.3s ease;</span><br><span class="line">    border-left: 3px solid transparent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-link:hover &#123;</span><br><span class="line">    background-color: #34495e;</span><br><span class="line">    color: #ecf0f1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-link.active &#123;</span><br><span class="line">    background-color: #34495e;</span><br><span class="line">    color: #ecf0f1;</span><br><span class="line">    border-left-color: #3498db;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-link i &#123;</span><br><span class="line">    margin-right: 10px;</span><br><span class="line">    width: 20px;</span><br><span class="line">    text-align: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.sidebar-footer &#123;</span><br><span class="line">    padding: 20px;</span><br><span class="line">    margin-top: 20px;</span><br><span class="line">    border-top: 1px solid #34495e;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.sidebar-footer .btn &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    justify-content: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 主内容区 */</span><br><span class="line">.admin-main &#123;</span><br><span class="line">    flex: 1;</span><br><span class="line">    margin-left: 250px;</span><br><span class="line">    transition: all 0.3s ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 头部 */</span><br><span class="line">.admin-header &#123;</span><br><span class="line">    background-color: white;</span><br><span class="line">    padding: 0 30px;</span><br><span class="line">    height: 70px;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    align-items: center;</span><br><span class="line">    box-shadow: 0 2px 4px rgba(0,0,0,0.1);</span><br><span class="line">    position: sticky;</span><br><span class="line">    top: 0;</span><br><span class="line">    z-index: 999;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.header-left h1 &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    font-size: 1.5rem;</span><br><span class="line">    font-weight: 600;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.breadcrumb &#123;</span><br><span class="line">    margin-top: 5px;</span><br><span class="line">    font-size: 0.9rem;</span><br><span class="line">    color: #7f8c8d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.breadcrumb a &#123;</span><br><span class="line">    color: #3498db;</span><br><span class="line">    text-decoration: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.breadcrumb a:hover &#123;</span><br><span class="line">    text-decoration: underline;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.breadcrumb a:not(:last-child)::after &#123;</span><br><span class="line">    content: &#x27;›&#x27;;</span><br><span class="line">    margin: 0 5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.header-right &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    gap: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 用户信息 */</span><br><span class="line">.user-info &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    position: relative;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-avatar &#123;</span><br><span class="line">    width: 40px;</span><br><span class="line">    height: 40px;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    object-fit: cover;</span><br><span class="line">    margin-right: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-details &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-direction: column;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-name &#123;</span><br><span class="line">    font-weight: 600;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-role &#123;</span><br><span class="line">    font-size: 0.85rem;</span><br><span class="line">    color: #7f8c8d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-menu-btn &#123;</span><br><span class="line">    background: none;</span><br><span class="line">    border: none;</span><br><span class="line">    color: #7f8c8d;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    padding: 5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-dropdown &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 100%;</span><br><span class="line">    right: 0;</span><br><span class="line">    background-color: white;</span><br><span class="line">    box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span><br><span class="line">    border-radius: 4px;</span><br><span class="line">    min-width: 200px;</span><br><span class="line">    display: none;</span><br><span class="line">    z-index: 1000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-dropdown.show &#123;</span><br><span class="line">    display: block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-dropdown a &#123;</span><br><span class="line">    display: block;</span><br><span class="line">    padding: 12px 20px;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">    text-decoration: none;</span><br><span class="line">    border-bottom: 1px solid #ecf0f1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-dropdown a:hover &#123;</span><br><span class="line">    background-color: #f8f9fa;</span><br><span class="line">    color: #3498db;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-dropdown a i &#123;</span><br><span class="line">    margin-right: 10px;</span><br><span class="line">    width: 20px;</span><br><span class="line">    text-align: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 通知按钮 */</span><br><span class="line">.notification-btn &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    background: none;</span><br><span class="line">    border: none;</span><br><span class="line">    color: #7f8c8d;</span><br><span class="line">    font-size: 1.2rem;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    padding: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-badge &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 0;</span><br><span class="line">    right: 0;</span><br><span class="line">    background-color: #e74c3c;</span><br><span class="line">    color: white;</span><br><span class="line">    font-size: 0.7rem;</span><br><span class="line">    min-width: 18px;</span><br><span class="line">    height: 18px;</span><br><span class="line">    border-radius: 9px;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    padding: 0 4px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-panel &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 100%;</span><br><span class="line">    right: 0;</span><br><span class="line">    background-color: white;</span><br><span class="line">    box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span><br><span class="line">    border-radius: 4px;</span><br><span class="line">    width: 350px;</span><br><span class="line">    max-height: 400px;</span><br><span class="line">    overflow-y: auto;</span><br><span class="line">    display: none;</span><br><span class="line">    z-index: 1000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-panel.show &#123;</span><br><span class="line">    display: block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-header &#123;</span><br><span class="line">    padding: 15px 20px;</span><br><span class="line">    border-bottom: 1px solid #ecf0f1;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    align-items: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-header h3 &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    font-size: 1.1rem;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.mark-all-read &#123;</span><br><span class="line">    background: none;</span><br><span class="line">    border: none;</span><br><span class="line">    color: #3498db;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    font-size: 0.9rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-list &#123;</span><br><span class="line">    padding: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-item &#123;</span><br><span class="line">    padding: 15px 20px;</span><br><span class="line">    border-bottom: 1px solid #ecf0f1;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: flex-start;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    transition: background-color 0.3s ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-item:hover &#123;</span><br><span class="line">    background-color: #f8f9fa;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-item.unread &#123;</span><br><span class="line">    background-color: #f8fdff;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-icon &#123;</span><br><span class="line">    margin-right: 15px;</span><br><span class="line">    font-size: 1.2rem;</span><br><span class="line">    color: #3498db;</span><br><span class="line">    flex-shrink: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-content &#123;</span><br><span class="line">    flex: 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-title &#123;</span><br><span class="line">    font-weight: 600;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">    margin-bottom: 5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-text &#123;</span><br><span class="line">    color: #7f8c8d;</span><br><span class="line">    font-size: 0.9rem;</span><br><span class="line">    line-height: 1.4;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-time &#123;</span><br><span class="line">    font-size: 0.8rem;</span><br><span class="line">    color: #95a5a6;</span><br><span class="line">    margin-top: 5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 主内容区 */</span><br><span class="line">.admin-content &#123;</span><br><span class="line">    padding: 30px;</span><br><span class="line">    min-height: calc(100vh - 70px);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 卡片组件 */</span><br><span class="line">.admin-card &#123;</span><br><span class="line">    background-color: white;</span><br><span class="line">    border-radius: 8px;</span><br><span class="line">    box-shadow: 0 2px 4px rgba(0,0,0,0.1);</span><br><span class="line">    margin-bottom: 30px;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.card-header &#123;</span><br><span class="line">    padding: 20px 30px;</span><br><span class="line">    border-bottom: 1px solid #ecf0f1;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    align-items: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.card-header h2 &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    font-size: 1.3rem;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.card-actions &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    gap: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.card-body &#123;</span><br><span class="line">    padding: 30px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.card-footer &#123;</span><br><span class="line">    padding: 20px 30px;</span><br><span class="line">    border-top: 1px solid #ecf0f1;</span><br><span class="line">    background-color: #f8f9fa;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 表格样式 */</span><br><span class="line">.data-table &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    border-collapse: collapse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.data-table th &#123;</span><br><span class="line">    background-color: #f8f9fa;</span><br><span class="line">    padding: 15px;</span><br><span class="line">    text-align: left;</span><br><span class="line">    font-weight: 600;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">    border-bottom: 1px solid #ecf0f1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.data-table td &#123;</span><br><span class="line">    padding: 15px;</span><br><span class="line">    border-bottom: 1px solid #ecf0f1;</span><br><span class="line">    color: #34495e;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.data-table tr:hover &#123;</span><br><span class="line">    background-color: #f8f9fa;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.data-table .actions &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    gap: 5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 统计卡片 */</span><br><span class="line">.stats-grid &#123;</span><br><span class="line">    display: grid;</span><br><span class="line">    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));</span><br><span class="line">    gap: 20px;</span><br><span class="line">    margin-bottom: 30px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.stat-card &#123;</span><br><span class="line">    background-color: white;</span><br><span class="line">    border-radius: 8px;</span><br><span class="line">    padding: 25px;</span><br><span class="line">    box-shadow: 0 2px 4px rgba(0,0,0,0.1);</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.stat-icon &#123;</span><br><span class="line">    width: 60px;</span><br><span class="line">    height: 60px;</span><br><span class="line">    border-radius: 8px;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    margin-right: 20px;</span><br><span class="line">    font-size: 1.5rem;</span><br><span class="line">    color: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.stat-icon.blue &#123;</span><br><span class="line">    background-color: #3498db;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.stat-icon.green &#123;</span><br><span class="line">    background-color: #2ecc71;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.stat-icon.orange &#123;</span><br><span class="line">    background-color: #e67e22;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.stat-icon.purple &#123;</span><br><span class="line">    background-color: #9b59b6;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.stat-content h3 &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    font-size: 2rem;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">    font-weight: 600;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.stat-content p &#123;</span><br><span class="line">    margin: 5px 0 0;</span><br><span class="line">    color: #7f8c8d;</span><br><span class="line">    font-size: 0.9rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 图表容器 */</span><br><span class="line">.chart-container &#123;</span><br><span class="line">    background-color: white;</span><br><span class="line">    border-radius: 8px;</span><br><span class="line">    padding: 25px;</span><br><span class="line">    box-shadow: 0 2px 4px rgba(0,0,0,0.1);</span><br><span class="line">    margin-bottom: 30px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.chart-header &#123;</span><br><span class="line">    margin-bottom: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.chart-header h3 &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    font-size: 1.2rem;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 表单样式 */</span><br><span class="line">.form-group &#123;</span><br><span class="line">    margin-bottom: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.form-group label &#123;</span><br><span class="line">    display: block;</span><br><span class="line">    margin-bottom: 8px;</span><br><span class="line">    font-weight: 600;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.form-control &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    padding: 12px 15px;</span><br><span class="line">    border: 1px solid #ddd;</span><br><span class="line">    border-radius: 4px;</span><br><span class="line">    font-size: 1rem;</span><br><span class="line">    transition: border-color 0.3s ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.form-control:focus &#123;</span><br><span class="line">    outline: none;</span><br><span class="line">    border-color: #3498db;</span><br><span class="line">    box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.form-text &#123;</span><br><span class="line">    margin-top: 5px;</span><br><span class="line">    font-size: 0.85rem;</span><br><span class="line">    color: #7f8c8d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.form-check &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    gap: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.form-check-input &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 按钮样式 */</span><br><span class="line">.btn &#123;</span><br><span class="line">    display: inline-flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    padding: 10px 20px;</span><br><span class="line">    border: none;</span><br><span class="line">    border-radius: 4px;</span><br><span class="line">    font-size: 1rem;</span><br><span class="line">    font-weight: 500;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    transition: all 0.3s ease;</span><br><span class="line">    gap: 8px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-primary &#123;</span><br><span class="line">    background-color: #3498db;</span><br><span class="line">    color: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-primary:hover &#123;</span><br><span class="line">    background-color: #2980b9;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-secondary &#123;</span><br><span class="line">    background-color: #95a5a6;</span><br><span class="line">    color: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-secondary:hover &#123;</span><br><span class="line">    background-color: #7f8c8d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-success &#123;</span><br><span class="line">    background-color: #2ecc71;</span><br><span class="line">    color: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-success:hover &#123;</span><br><span class="line">    background-color: #27ae60;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-danger &#123;</span><br><span class="line">    background-color: #e74c3c;</span><br><span class="line">    color: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-danger:hover &#123;</span><br><span class="line">    background-color: #c0392b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-outline &#123;</span><br><span class="line">    background-color: transparent;</span><br><span class="line">    border: 1px solid #ddd;</span><br><span class="line">    color: #34495e;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-outline:hover &#123;</span><br><span class="line">    background-color: #f8f9fa;</span><br><span class="line">    border-color: #3498db;</span><br><span class="line">    color: #3498db;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-sm &#123;</span><br><span class="line">    padding: 6px 12px;</span><br><span class="line">    font-size: 0.9rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-lg &#123;</span><br><span class="line">    padding: 14px 28px;</span><br><span class="line">    font-size: 1.1rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-block &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 模态框 */</span><br><span class="line">.modal-overlay &#123;</span><br><span class="line">    position: fixed;</span><br><span class="line">    top: 0;</span><br><span class="line">    left: 0;</span><br><span class="line">    right: 0;</span><br><span class="line">    bottom: 0;</span><br><span class="line">    background-color: rgba(0,0,0,0.5);</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    z-index: 1100;</span><br><span class="line">    padding: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal &#123;</span><br><span class="line">    background-color: white;</span><br><span class="line">    border-radius: 8px;</span><br><span class="line">    max-width: 600px;</span><br><span class="line">    width: 100%;</span><br><span class="line">    max-height: 90vh;</span><br><span class="line">    overflow-y: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal-header &#123;</span><br><span class="line">    padding: 20px 30px;</span><br><span class="line">    border-bottom: 1px solid #ecf0f1;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    align-items: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal-header h3 &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    font-size: 1.3rem;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal-close &#123;</span><br><span class="line">    background: none;</span><br><span class="line">    border: none;</span><br><span class="line">    font-size: 1.5rem;</span><br><span class="line">    color: #7f8c8d;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    padding: 5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal-body &#123;</span><br><span class="line">    padding: 30px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal-footer &#123;</span><br><span class="line">    padding: 20px 30px;</span><br><span class="line">    border-top: 1px solid #ecf0f1;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: flex-end;</span><br><span class="line">    gap: 10px;</span><br><span class="line">    background-color: #f8f9fa;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 加载动画 */</span><br><span class="line">.loading-overlay &#123;</span><br><span class="line">    position: fixed;</span><br><span class="line">    top: 0;</span><br><span class="line">    left: 0;</span><br><span class="line">    right: 0;</span><br><span class="line">    bottom: 0;</span><br><span class="line">    background-color: rgba(255, 255, 255, 0.9);</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    z-index: 1200;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.loading-spinner &#123;</span><br><span class="line">    text-align: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.loading-spinner i &#123;</span><br><span class="line">    font-size: 3rem;</span><br><span class="line">    color: #3498db;</span><br><span class="line">    margin-bottom: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.loading-spinner span &#123;</span><br><span class="line">    display: block;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">    font-size: 1.1rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 响应式设计 */</span><br><span class="line">@media (max-width: 992px) &#123;</span><br><span class="line">    .admin-sidebar &#123;</span><br><span class="line">        transform: translateX(-100%);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .admin-sidebar.show &#123;</span><br><span class="line">        transform: translateX(0);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .admin-main &#123;</span><br><span class="line">        margin-left: 0;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .sidebar-toggle &#123;</span><br><span class="line">        display: block;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .stats-grid &#123;</span><br><span class="line">        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@media (max-width: 768px) &#123;</span><br><span class="line">    .admin-header &#123;</span><br><span class="line">        padding: 0 15px;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .admin-content &#123;</span><br><span class="line">        padding: 15px;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .card-header,</span><br><span class="line">    .card-body,</span><br><span class="line">    .card-footer &#123;</span><br><span class="line">        padding: 15px;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .stats-grid &#123;</span><br><span class="line">        grid-template-columns: 1fr;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .header-left h1 &#123;</span><br><span class="line">        font-size: 1.2rem;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>js&#x2F;admin&#x2F;app.js</strong></p>
<p>javascript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line">// 管理后台应用主文件</span><br><span class="line">import &#123; AdminStore &#125; from &#x27;./store.js&#x27;;</span><br><span class="line">import &#123; AdminAPI &#125; from &#x27;./api.js&#x27;;</span><br><span class="line">import &#123; AdminRouter &#125; from &#x27;./router.js&#x27;;</span><br><span class="line">import &#123; DashboardModule &#125; from &#x27;./modules/dashboard.js&#x27;;</span><br><span class="line">import &#123; ArticleModule &#125; from &#x27;./modules/articles.js&#x27;;</span><br><span class="line">import &#123; UserModule &#125; from &#x27;./modules/users.js&#x27;;</span><br><span class="line">import &#123; NotificationManager &#125; from &#x27;./notifications.js&#x27;;</span><br><span class="line">import &#123; ChartManager &#125; from &#x27;./charts.js&#x27;;</span><br><span class="line"></span><br><span class="line">class AdminApp &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        this.store = new AdminStore();</span><br><span class="line">        this.api = new AdminAPI();</span><br><span class="line">        this.router = new AdminRouter(this);</span><br><span class="line">        this.notifications = new NotificationManager(this);</span><br><span class="line">        this.charts = new ChartManager();</span><br><span class="line">        </span><br><span class="line">        this.init();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    init() &#123;</span><br><span class="line">        this.initUI();</span><br><span class="line">        this.bindEvents();</span><br><span class="line">        this.checkAuth();</span><br><span class="line">        this.loadData();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    initUI() &#123;</span><br><span class="line">        // 初始化侧边栏</span><br><span class="line">        this.initSidebar();</span><br><span class="line">        </span><br><span class="line">        // 初始化用户菜单</span><br><span class="line">        this.initUserMenu();</span><br><span class="line">        </span><br><span class="line">        // 初始化通知</span><br><span class="line">        this.notifications.init();</span><br><span class="line">        </span><br><span class="line">        // 设置默认模块</span><br><span class="line">        this.router.navigate(&#x27;#dashboard&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    initSidebar() &#123;</span><br><span class="line">        const toggleBtn = document.getElementById(&#x27;sidebar-toggle&#x27;);</span><br><span class="line">        const sidebar = document.getElementById(&#x27;sidebar&#x27;);</span><br><span class="line">        const navLinks = document.querySelectorAll(&#x27;.nav-link&#x27;);</span><br><span class="line">        </span><br><span class="line">        toggleBtn?.addEventListener(&#x27;click&#x27;, () =&gt; &#123;</span><br><span class="line">            sidebar.classList.toggle(&#x27;show&#x27;);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        navLinks.forEach(link =&gt; &#123;</span><br><span class="line">            link.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;</span><br><span class="line">                e.preventDefault();</span><br><span class="line">                </span><br><span class="line">                // 移除其他链接的active类</span><br><span class="line">                navLinks.forEach(l =&gt; l.classList.remove(&#x27;active&#x27;));</span><br><span class="line">                </span><br><span class="line">                // 添加当前链接的active类</span><br><span class="line">                link.classList.add(&#x27;active&#x27;);</span><br><span class="line">                </span><br><span class="line">                // 移动端点击后隐藏侧边栏</span><br><span class="line">                if (window.innerWidth &lt;= 992) &#123;</span><br><span class="line">                    sidebar.classList.remove(&#x27;show&#x27;);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                // 加载模块</span><br><span class="line">                const module = link.dataset.module;</span><br><span class="line">                this.router.navigate(`#$&#123;module&#125;`);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    initUserMenu() &#123;</span><br><span class="line">        const menuBtn = document.getElementById(&#x27;user-menu-btn&#x27;);</span><br><span class="line">        const dropdown = document.getElementById(&#x27;user-dropdown&#x27;);</span><br><span class="line">        const logoutBtn = document.getElementById(&#x27;logout&#x27;);</span><br><span class="line">        </span><br><span class="line">        menuBtn?.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;</span><br><span class="line">            e.stopPropagation();</span><br><span class="line">            dropdown.classList.toggle(&#x27;show&#x27;);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        logoutBtn?.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;</span><br><span class="line">            e.preventDefault();</span><br><span class="line">            this.logout();</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        // 点击其他地方关闭菜单</span><br><span class="line">        document.addEventListener(&#x27;click&#x27;, () =&gt; &#123;</span><br><span class="line">            dropdown.classList.remove(&#x27;show&#x27;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async checkAuth() &#123;</span><br><span class="line">        const token = localStorage.getItem(&#x27;token&#x27;);</span><br><span class="line">        if (!token) &#123;</span><br><span class="line">            window.location.href = &#x27;/login&#x27;;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        try &#123;</span><br><span class="line">            const user = await this.api.getCurrentUser();</span><br><span class="line">            if (user.role !== &#x27;ADMIN&#x27;) &#123;</span><br><span class="line">                alert(&#x27;没有管理员权限&#x27;);</span><br><span class="line">                window.location.href = &#x27;/&#x27;;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            this.store.setState(&#123; user &#125;);</span><br><span class="line">            this.updateUserInfo(user);</span><br><span class="line">        &#125; catch (error) &#123;</span><br><span class="line">            console.error(&#x27;认证检查失败:&#x27;, error);</span><br><span class="line">            localStorage.removeItem(&#x27;token&#x27;);</span><br><span class="line">            window.location.href = &#x27;/login&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    updateUserInfo(user) &#123;</span><br><span class="line">        const usernameEl = document.getElementById(&#x27;admin-username&#x27;);</span><br><span class="line">        const avatarEl = document.querySelector(&#x27;.user-avatar&#x27;);</span><br><span class="line">        </span><br><span class="line">        if (usernameEl) &#123;</span><br><span class="line">            usernameEl.textContent = user.displayName || user.username;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (avatarEl &amp;&amp; user.avatarUrl) &#123;</span><br><span class="line">            avatarEl.src = user.avatarUrl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async loadData() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            // 并行加载初始数据</span><br><span class="line">            const [stats, recentArticles, recentComments] = await Promise.all([</span><br><span class="line">                this.api.getStats(),</span><br><span class="line">                this.api.getArticles(&#123; page: 0, size: 10 &#125;),</span><br><span class="line">                this.api.getComments(&#123; page: 0, size: 10 &#125;)</span><br><span class="line">            ]);</span><br><span class="line">            </span><br><span class="line">            this.store.setState(&#123; stats, recentArticles, recentComments &#125;);</span><br><span class="line">            </span><br><span class="line">            // 加载通知</span><br><span class="line">            const notifications = await this.api.getNotifications();</span><br><span class="line">            this.store.setState(&#123; notifications &#125;);</span><br><span class="line">            this.notifications.updateBadge(notifications.filter(n =&gt; !n.read).length);</span><br><span class="line">        &#125; catch (error) &#123;</span><br><span class="line">            console.error(&#x27;加载数据失败:&#x27;, error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    logout() &#123;</span><br><span class="line">        localStorage.removeItem(&#x27;token&#x27;);</span><br><span class="line">        window.location.href = &#x27;/login&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    bindEvents() &#123;</span><br><span class="line">        // 键盘快捷键</span><br><span class="line">        document.addEventListener(&#x27;keydown&#x27;, (e) =&gt; &#123;</span><br><span class="line">            // Ctrl + S 保存</span><br><span class="line">            if (e.ctrlKey &amp;&amp; e.key === &#x27;s&#x27;) &#123;</span><br><span class="line">                e.preventDefault();</span><br><span class="line">                this.saveCurrentModule();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            // Esc 关闭模态框</span><br><span class="line">            if (e.key === &#x27;Escape&#x27;) &#123;</span><br><span class="line">                this.closeModal();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    saveCurrentModule() &#123;</span><br><span class="line">        // 根据当前模块执行保存操作</span><br><span class="line">        const currentModule = this.router.getCurrentModule();</span><br><span class="line">        if (currentModule?.save) &#123;</span><br><span class="line">            currentModule.save();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    showLoading() &#123;</span><br><span class="line">        const loading = document.getElementById(&#x27;admin-loading&#x27;);</span><br><span class="line">        if (loading) &#123;</span><br><span class="line">            loading.style.display = &#x27;flex&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    hideLoading() &#123;</span><br><span class="line">        const loading = document.getElementById(&#x27;admin-loading&#x27;);</span><br><span class="line">        if (loading) &#123;</span><br><span class="line">            loading.style.display = &#x27;none&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    showModal(content) &#123;</span><br><span class="line">        const modalContainer = document.getElementById(&#x27;admin-modal-container&#x27;);</span><br><span class="line">        modalContainer.innerHTML = `</span><br><span class="line">            &lt;div class=&quot;modal-overlay&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;modal&quot;&gt;</span><br><span class="line">                    $&#123;content&#125;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        `;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    closeModal() &#123;</span><br><span class="line">        const modalContainer = document.getElementById(&#x27;admin-modal-container&#x27;);</span><br><span class="line">        modalContainer.innerHTML = &#x27;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 启动应用</span><br><span class="line">document.addEventListener(&#x27;DOMContentLoaded&#x27;, () =&gt; &#123;</span><br><span class="line">    window.adminApp = new AdminApp();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h2 id="第四部分：高级功能实现"><a href="#第四部分：高级功能实现" class="headerlink" title="第四部分：高级功能实现"></a>第四部分：高级功能实现</h2><h3 id="1-文章导出为PDF功能"><a href="#1-文章导出为PDF功能" class="headerlink" title="1. 文章导出为PDF功能"></a>1. 文章导出为PDF功能</h3><p><strong>PDFExportService.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.service;</span><br><span class="line"></span><br><span class="line">import com.blog.entity.Article;</span><br><span class="line">import com.itextpdf.kernel.pdf.PdfDocument;</span><br><span class="line">import com.itextpdf.kernel.pdf.PdfWriter;</span><br><span class="line">import com.itextpdf.layout.Document;</span><br><span class="line">import com.itextpdf.layout.element.Paragraph;</span><br><span class="line">import com.itextpdf.layout.element.Text;</span><br><span class="line">import com.itextpdf.layout.property.TextAlignment;</span><br><span class="line">import lombok.RequiredArgsConstructor;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import java.io.ByteArrayOutputStream;</span><br><span class="line">import java.time.format.DateTimeFormatter;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">@RequiredArgsConstructor</span><br><span class="line">@Slf4j</span><br><span class="line">public class PDFExportService &#123;</span><br><span class="line">    </span><br><span class="line">    private final ArticleService articleService;</span><br><span class="line">    </span><br><span class="line">    public byte[] exportArticleToPdf(Long articleId) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Article article = articleService.getArticleEntity(articleId);</span><br><span class="line">            </span><br><span class="line">            ByteArrayOutputStream outputStream = new ByteArrayOutputStream();</span><br><span class="line">            PdfWriter writer = new PdfWriter(outputStream);</span><br><span class="line">            PdfDocument pdfDoc = new PdfDocument(writer);</span><br><span class="line">            Document document = new Document(pdfDoc);</span><br><span class="line">            </span><br><span class="line">            // 设置文档信息</span><br><span class="line">            pdfDoc.getDocumentInfo()</span><br><span class="line">                .setTitle(article.getTitle())</span><br><span class="line">                .setAuthor(article.getAuthor().getDisplayName());</span><br><span class="line">            </span><br><span class="line">            // 添加标题</span><br><span class="line">            Paragraph title = new Paragraph(article.getTitle())</span><br><span class="line">                .setTextAlignment(TextAlignment.CENTER)</span><br><span class="line">                .setFontSize(24)</span><br><span class="line">                .setBold();</span><br><span class="line">            document.add(title);</span><br><span class="line">            </span><br><span class="line">            // 添加作者和日期</span><br><span class="line">            String meta = String.format(&quot;作者: %s | 发布日期: %s&quot;,</span><br><span class="line">                article.getAuthor().getDisplayName(),</span><br><span class="line">                article.getPublishedAt().format(DateTimeFormatter.ISO_LOCAL_DATE));</span><br><span class="line">            </span><br><span class="line">            Paragraph metaParagraph = new Paragraph(meta)</span><br><span class="line">                .setTextAlignment(TextAlignment.CENTER)</span><br><span class="line">                .setFontSize(12)</span><br><span class="line">                .setItalic();</span><br><span class="line">            document.add(metaParagraph);</span><br><span class="line">            </span><br><span class="line">            // 添加分隔线</span><br><span class="line">            document.add(new Paragraph(&quot;\n&quot;));</span><br><span class="line">            </span><br><span class="line">            // 添加摘要</span><br><span class="line">            if (article.getSummary() != null &amp;&amp; !article.getSummary().isEmpty()) &#123;</span><br><span class="line">                Paragraph summary = new Paragraph(&quot;摘要&quot;)</span><br><span class="line">                    .setBold()</span><br><span class="line">                    .setFontSize(14);</span><br><span class="line">                document.add(summary);</span><br><span class="line">                </span><br><span class="line">                Paragraph summaryContent = new Paragraph(article.getSummary())</span><br><span class="line">                    .setFontSize(12)</span><br><span class="line">                    .setMarginBottom(20);</span><br><span class="line">                document.add(summaryContent);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            // 添加内容</span><br><span class="line">            Paragraph contentTitle = new Paragraph(&quot;内容&quot;)</span><br><span class="line">                .setBold()</span><br><span class="line">                .setFontSize(14);</span><br><span class="line">            document.add(contentTitle);</span><br><span class="line">            </span><br><span class="line">            // 处理HTML内容</span><br><span class="line">            String plainContent = htmlToPlainText(article.getContent());</span><br><span class="line">            Paragraph content = new Paragraph(plainContent)</span><br><span class="line">                .setFontSize(12)</span><br><span class="line">                .setTextAlignment(TextAlignment.JUSTIFIED);</span><br><span class="line">            document.add(content);</span><br><span class="line">            </span><br><span class="line">            // 添加页脚</span><br><span class="line">            String footer = String.format(&quot;第 %d 页 / 共 %d 页&quot;,</span><br><span class="line">                pdfDoc.getPageNumber(pdfDoc.getLastPage()),</span><br><span class="line">                pdfDoc.getNumberOfPages());</span><br><span class="line">            </span><br><span class="line">            Text footerText = new Text(footer)</span><br><span class="line">                .setFontSize(10);</span><br><span class="line">            Paragraph footerParagraph = new Paragraph(footerText)</span><br><span class="line">                .setTextAlignment(TextAlignment.CENTER);</span><br><span class="line">            document.add(footerParagraph);</span><br><span class="line">            </span><br><span class="line">            document.close();</span><br><span class="line">            </span><br><span class="line">            log.info(&quot;文章导出为PDF成功: &#123;&#125;&quot;, articleId);</span><br><span class="line">            return outputStream.toByteArray();</span><br><span class="line">            </span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(&quot;导出PDF失败: &#123;&#125;&quot;, articleId, e);</span><br><span class="line">            throw new RuntimeException(&quot;导出PDF失败&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private String htmlToPlainText(String html) &#123;</span><br><span class="line">        if (html == null) return &quot;&quot;;</span><br><span class="line">        </span><br><span class="line">        // 简单的HTML标签清理</span><br><span class="line">        return html.replaceAll(&quot;&lt;[^&gt;]*&gt;&quot;, &quot;&quot;)</span><br><span class="line">                  .replaceAll(&quot;&amp;nbsp;&quot;, &quot; &quot;)</span><br><span class="line">                  .replaceAll(&quot;&amp;lt;&quot;, &quot;&lt;&quot;)</span><br><span class="line">                  .replaceAll(&quot;&amp;gt;&quot;, &quot;&gt;&quot;)</span><br><span class="line">                  .replaceAll(&quot;&amp;amp;&quot;, &quot;&amp;&quot;)</span><br><span class="line">                  .replaceAll(&quot;&amp;quot;&quot;, &quot;\&quot;&quot;)</span><br><span class="line">                  .replaceAll(&quot;&amp;#39;&quot;, &quot;&#x27;&quot;)</span><br><span class="line">                  .trim();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-文章翻译功能"><a href="#2-文章翻译功能" class="headerlink" title="2. 文章翻译功能"></a>2. 文章翻译功能</h3><p><strong>TranslationService.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.service;</span><br><span class="line"></span><br><span class="line">import com.fasterxml.jackson.databind.JsonNode;</span><br><span class="line">import com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.http.HttpEntity;</span><br><span class="line">import org.springframework.http.HttpHeaders;</span><br><span class="line">import org.springframework.http.HttpMethod;</span><br><span class="line">import org.springframework.http.ResponseEntity;</span><br><span class="line">import org.springframework.scheduling.annotation.Async;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import org.springframework.web.client.RestTemplate;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.concurrent.CompletableFuture;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">@Slf4j</span><br><span class="line">public class TranslationService &#123;</span><br><span class="line">    </span><br><span class="line">    @Value(&quot;$&#123;app.translation.api-key&#125;&quot;)</span><br><span class="line">    private String apiKey;</span><br><span class="line">    </span><br><span class="line">    @Value(&quot;$&#123;app.translation.api-url&#125;&quot;)</span><br><span class="line">    private String apiUrl;</span><br><span class="line">    </span><br><span class="line">    private final RestTemplate restTemplate = new RestTemplate();</span><br><span class="line">    private final ObjectMapper objectMapper = new ObjectMapper();</span><br><span class="line">    </span><br><span class="line">    @Async</span><br><span class="line">    public CompletableFuture&lt;String&gt; translate(String text, String targetLanguage) &#123;</span><br><span class="line">        return CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                HttpHeaders headers = new HttpHeaders();</span><br><span class="line">                headers.set(&quot;Authorization&quot;, &quot;Bearer &quot; + apiKey);</span><br><span class="line">                headers.set(&quot;Content-Type&quot;, &quot;application/json&quot;);</span><br><span class="line">                </span><br><span class="line">                Map&lt;String, Object&gt; requestBody = new HashMap&lt;&gt;();</span><br><span class="line">                requestBody.put(&quot;text&quot;, text);</span><br><span class="line">                requestBody.put(&quot;target_lang&quot;, targetLanguage);</span><br><span class="line">                requestBody.put(&quot;source_lang&quot;, &quot;ZH&quot;); // 假设原文是中文</span><br><span class="line">                </span><br><span class="line">                HttpEntity&lt;Map&lt;String, Object&gt;&gt; request = new HttpEntity&lt;&gt;(requestBody, headers);</span><br><span class="line">                </span><br><span class="line">                ResponseEntity&lt;String&gt; response = restTemplate.exchange(</span><br><span class="line">                    apiUrl,</span><br><span class="line">                    HttpMethod.POST,</span><br><span class="line">                    request,</span><br><span class="line">                    String.class</span><br><span class="line">                );</span><br><span class="line">                </span><br><span class="line">                JsonNode root = objectMapper.readTree(response.getBody());</span><br><span class="line">                return root.path(&quot;translations&quot;).get(0).path(&quot;text&quot;).asText();</span><br><span class="line">                </span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                log.error(&quot;翻译失败&quot;, e);</span><br><span class="line">                throw new RuntimeException(&quot;翻译失败: &quot; + e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public CompletableFuture&lt;Map&lt;String, String&gt;&gt; translateArticle(</span><br><span class="line">            String title, String content, String summary, </span><br><span class="line">            String targetLanguage) &#123;</span><br><span class="line">        </span><br><span class="line">        return CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                CompletableFuture&lt;String&gt; titleFuture = translate(title, targetLanguage);</span><br><span class="line">                CompletableFuture&lt;String&gt; contentFuture = translate(content, targetLanguage);</span><br><span class="line">                CompletableFuture&lt;String&gt; summaryFuture = summary != null ? </span><br><span class="line">                    translate(summary, targetLanguage) : </span><br><span class="line">                    CompletableFuture.completedFuture(null);</span><br><span class="line">                </span><br><span class="line">                CompletableFuture.allOf(titleFuture, contentFuture, summaryFuture).join();</span><br><span class="line">                </span><br><span class="line">                Map&lt;String, String&gt; result = new HashMap&lt;&gt;();</span><br><span class="line">                result.put(&quot;title&quot;, titleFuture.get());</span><br><span class="line">                result.put(&quot;content&quot;, contentFuture.get());</span><br><span class="line">                if (summaryFuture.get() != null) &#123;</span><br><span class="line">                    result.put(&quot;summary&quot;, summaryFuture.get());</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                return result;</span><br><span class="line">                </span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                log.error(&quot;文章翻译失败&quot;, e);</span><br><span class="line">                throw new RuntimeException(&quot;文章翻译失败&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-文章相似度推荐"><a href="#3-文章相似度推荐" class="headerlink" title="3. 文章相似度推荐"></a>3. 文章相似度推荐</h3><p><strong>RecommendationService.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.service;</span><br><span class="line"></span><br><span class="line">import com.blog.entity.Article;</span><br><span class="line">import com.blog.repository.ArticleRepository;</span><br><span class="line">import lombok.RequiredArgsConstructor;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.cache.annotation.Cacheable;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import org.springframework.transaction.annotation.Transactional;</span><br><span class="line">import java.util.*;</span><br><span class="line">import java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">@RequiredArgsConstructor</span><br><span class="line">@Slf4j</span><br><span class="line">public class RecommendationService &#123;</span><br><span class="line">    </span><br><span class="line">    private final ArticleRepository articleRepository;</span><br><span class="line">    private final TagRepository tagRepository;</span><br><span class="line">    </span><br><span class="line">    @Cacheable(value = &quot;recommendations&quot;, key = &quot;#articleId&quot;)</span><br><span class="line">    @Transactional(readOnly = true)</span><br><span class="line">    public List&lt;Article&gt; getRelatedArticles(Long articleId, int limit) &#123;</span><br><span class="line">        Article article = articleRepository.findById(articleId)</span><br><span class="line">            .orElseThrow(() -&gt; new RuntimeException(&quot;文章不存在&quot;));</span><br><span class="line">        </span><br><span class="line">        // 获取文章的标签</span><br><span class="line">        Set&lt;Long&gt; articleTagIds = article.getTags().stream()</span><br><span class="line">            .map(tag -&gt; tag.getId())</span><br><span class="line">            .collect(Collectors.toSet());</span><br><span class="line">        </span><br><span class="line">        if (articleTagIds.isEmpty()) &#123;</span><br><span class="line">            // 如果没有标签，返回最近发布的文章</span><br><span class="line">            return articleRepository.findByStatusOrderByPublishedAtDesc(</span><br><span class="line">                Article.Status.PUBLISHED, </span><br><span class="line">                PageRequest.of(0, limit)</span><br><span class="line">            ).getContent();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 查找有相同标签的文章</span><br><span class="line">        List&lt;Object[]&gt; results = articleRepository.findArticlesWithCommonTags(</span><br><span class="line">            articleTagIds, articleId, limit);</span><br><span class="line">        </span><br><span class="line">        return results.stream()</span><br><span class="line">            .map(result -&gt; (Article) result[0])</span><br><span class="line">            .filter(a -&gt; !a.getId().equals(articleId))</span><br><span class="line">            .limit(limit)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Cacheable(value = &quot;user_recommendations&quot;, key = &quot;#userId&quot;)</span><br><span class="line">    public List&lt;Article&gt; getPersonalizedRecommendations(Long userId, int limit) &#123;</span><br><span class="line">        // 获取用户最近阅读的文章</span><br><span class="line">        List&lt;Article&gt; recentArticles = articleRepository.findRecentlyViewedByUser(</span><br><span class="line">            userId, PageRequest.of(0, 10));</span><br><span class="line">        </span><br><span class="line">        if (recentArticles.isEmpty()) &#123;</span><br><span class="line">            return getPopularArticles(limit);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 从最近阅读的文章中提取标签</span><br><span class="line">        Set&lt;Long&gt; tagIds = recentArticles.stream()</span><br><span class="line">            .flatMap(article -&gt; article.getTags().stream())</span><br><span class="line">            .map(tag -&gt; tag.getId())</span><br><span class="line">            .collect(Collectors.toSet());</span><br><span class="line">        </span><br><span class="line">        // 基于标签推荐文章</span><br><span class="line">        List&lt;Article&gt; recommendations = new ArrayList&lt;&gt;();</span><br><span class="line">        for (Long tagId : tagIds) &#123;</span><br><span class="line">            List&lt;Article&gt; articles = articleRepository.findByTagIdAndStatus(</span><br><span class="line">                tagId, Article.Status.PUBLISHED, PageRequest.of(0, 5));</span><br><span class="line">            recommendations.addAll(articles);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 去重并排除已读文章</span><br><span class="line">        return recommendations.stream()</span><br><span class="line">            .filter(article -&gt; !recentArticles.contains(article))</span><br><span class="line">            .distinct()</span><br><span class="line">            .sorted((a1, a2) -&gt; &#123;</span><br><span class="line">                // 按相关度排序：共同标签数量 * 文章热度</span><br><span class="line">                int score1 = calculateRelevanceScore(a1, tagIds);</span><br><span class="line">                int score2 = calculateRelevanceScore(a2, tagIds);</span><br><span class="line">                return Integer.compare(score2, score1);</span><br><span class="line">            &#125;)</span><br><span class="line">            .limit(limit)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private int calculateRelevanceScore(Article article, Set&lt;Long&gt; userTagIds) &#123;</span><br><span class="line">        // 计算共同标签数量</span><br><span class="line">        long commonTags = article.getTags().stream()</span><br><span class="line">            .filter(tag -&gt; userTagIds.contains(tag.getId()))</span><br><span class="line">            .count();</span><br><span class="line">        </span><br><span class="line">        // 考虑文章热度（阅读量 + 点赞数）</span><br><span class="line">        int popularity = article.getViewCount() + article.getLikeCount();</span><br><span class="line">        </span><br><span class="line">        return (int) (commonTags * 10 + popularity);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Cacheable(value = &quot;popular_articles&quot;, key = &quot;#limit&quot;)</span><br><span class="line">    public List&lt;Article&gt; getPopularArticles(int limit) &#123;</span><br><span class="line">        return articleRepository.findPopularArticles(PageRequest.of(0, limit));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Cacheable(value = &quot;trending_articles&quot;)</span><br><span class="line">    public List&lt;Article&gt; getTrendingArticles(int limit) &#123;</span><br><span class="line">        // 获取最近一周的文章，按热度排序</span><br><span class="line">        LocalDateTime weekAgo = LocalDateTime.now().minusDays(7);</span><br><span class="line">        </span><br><span class="line">        return articleRepository.findTrendingArticles(</span><br><span class="line">            weekAgo, PageRequest.of(0, limit));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="第五部分：部署和运维"><a href="#第五部分：部署和运维" class="headerlink" title="第五部分：部署和运维"></a>第五部分：部署和运维</h2><h3 id="1-Docker配置文件"><a href="#1-Docker配置文件" class="headerlink" title="1. Docker配置文件"></a>1. Docker配置文件</h3><p><strong>Dockerfile</strong></p>
<p>dockerfile</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 后端Dockerfile</span><br><span class="line">FROM openjdk:11-jre-slim</span><br><span class="line"></span><br><span class="line"># 设置时区</span><br><span class="line">ENV TZ=Asia/Shanghai</span><br><span class="line">RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ &gt; /etc/timezone</span><br><span class="line"></span><br><span class="line"># 创建应用目录</span><br><span class="line">WORKDIR /app</span><br><span class="line"></span><br><span class="line"># 复制JAR文件</span><br><span class="line">COPY target/blog-system-*.jar app.jar</span><br><span class="line"></span><br><span class="line"># 复制配置文件</span><br><span class="line">COPY config/application-prod.yml /app/config/application-prod.yml</span><br><span class="line"></span><br><span class="line"># 创建非root用户</span><br><span class="line">RUN useradd -m -u 1000 appuser &amp;&amp; chown -R appuser:appuser /app</span><br><span class="line">USER appuser</span><br><span class="line"></span><br><span class="line"># 暴露端口</span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line"># 启动应用</span><br><span class="line">ENTRYPOINT [&quot;java&quot;, &quot;-jar&quot;, &quot;app.jar&quot;, &quot;--spring.config.location=classpath:/,file:/app/config/&quot;]</span><br></pre></td></tr></table></figure>



<p><strong>docker-compose.yml</strong></p>
<p>yaml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;3.8&#x27;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  mysql:</span><br><span class="line">    image: mysql:8.0</span><br><span class="line">    container_name: blog_mysql</span><br><span class="line">    environment:</span><br><span class="line">      MYSQL_ROOT_PASSWORD: $&#123;DB_PASSWORD&#125;</span><br><span class="line">      MYSQL_DATABASE: blog_db</span><br><span class="line">      MYSQL_USER: blog_user</span><br><span class="line">      MYSQL_PASSWORD: $&#123;DB_PASSWORD&#125;</span><br><span class="line">    volumes:</span><br><span class="line">      - mysql_data:/var/lib/mysql</span><br><span class="line">      - ./init.sql:/docker-entrypoint-initdb.d/init.sql</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;3306:3306&quot;</span><br><span class="line">    networks:</span><br><span class="line">      - blog_network</span><br><span class="line">    restart: unless-stopped</span><br><span class="line"></span><br><span class="line">  redis:</span><br><span class="line">    image: redis:7-alpine</span><br><span class="line">    container_name: blog_redis</span><br><span class="line">    command: redis-server --requirepass $&#123;REDIS_PASSWORD&#125;</span><br><span class="line">    volumes:</span><br><span class="line">      - redis_data:/data</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;6379:6379&quot;</span><br><span class="line">    networks:</span><br><span class="line">      - blog_network</span><br><span class="line">    restart: unless-stopped</span><br><span class="line"></span><br><span class="line">  elasticsearch:</span><br><span class="line">    image: elasticsearch:8.6.0</span><br><span class="line">    container_name: blog_elasticsearch</span><br><span class="line">    environment:</span><br><span class="line">      - discovery.type=single-node</span><br><span class="line">      - xpack.security.enabled=false</span><br><span class="line">      - &quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - elasticsearch_data:/usr/share/elasticsearch/data</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;9200:9200&quot;</span><br><span class="line">      - &quot;9300:9300&quot;</span><br><span class="line">    networks:</span><br><span class="line">      - blog_network</span><br><span class="line">    restart: unless-stopped</span><br><span class="line"></span><br><span class="line">  backend:</span><br><span class="line">    build: ./backend</span><br><span class="line">    container_name: blog_backend</span><br><span class="line">    environment:</span><br><span class="line">      - SPRING_PROFILES_ACTIVE=prod</span><br><span class="line">      - DB_HOST=mysql</span><br><span class="line">      - DB_PASSWORD=$&#123;DB_PASSWORD&#125;</span><br><span class="line">      - REDIS_HOST=redis</span><br><span class="line">      - REDIS_PASSWORD=$&#123;REDIS_PASSWORD&#125;</span><br><span class="line">      - ES_HOST=elasticsearch</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8080:8080&quot;</span><br><span class="line">    depends_on:</span><br><span class="line">      - mysql</span><br><span class="line">      - redis</span><br><span class="line">      - elasticsearch</span><br><span class="line">    networks:</span><br><span class="line">      - blog_network</span><br><span class="line">    restart: unless-stopped</span><br><span class="line"></span><br><span class="line">  frontend:</span><br><span class="line">    build: ./frontend</span><br><span class="line">    container_name: blog_frontend</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;3000:80&quot;</span><br><span class="line">    networks:</span><br><span class="line">      - blog_network</span><br><span class="line">    depends_on:</span><br><span class="line">      - backend</span><br><span class="line">    restart: unless-stopped</span><br><span class="line"></span><br><span class="line">  nginx:</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    container_name: blog_nginx</span><br><span class="line">    volumes:</span><br><span class="line">      - ./nginx.conf:/etc/nginx/nginx.conf</span><br><span class="line">      - ./frontend/dist:/usr/share/nginx/html</span><br><span class="line">      - ./ssl:/etc/nginx/ssl</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;80:80&quot;</span><br><span class="line">      - &quot;443:443&quot;</span><br><span class="line">    depends_on:</span><br><span class="line">      - backend</span><br><span class="line">      - frontend</span><br><span class="line">    networks:</span><br><span class="line">      - blog_network</span><br><span class="line">    restart: unless-stopped</span><br><span class="line"></span><br><span class="line">  prometheus:</span><br><span class="line">    image: prom/prometheus:latest</span><br><span class="line">    container_name: blog_prometheus</span><br><span class="line">    volumes:</span><br><span class="line">      - ./prometheus.yml:/etc/prometheus/prometheus.yml</span><br><span class="line">      - prometheus_data:/prometheus</span><br><span class="line">    command:</span><br><span class="line">      - &#x27;--config.file=/etc/prometheus/prometheus.yml&#x27;</span><br><span class="line">      - &#x27;--storage.tsdb.path=/prometheus&#x27;</span><br><span class="line">      - &#x27;--web.console.libraries=/etc/prometheus/console_libraries&#x27;</span><br><span class="line">      - &#x27;--web.console.templates=/etc/prometheus/consoles&#x27;</span><br><span class="line">      - &#x27;--storage.tsdb.retention.time=200h&#x27;</span><br><span class="line">      - &#x27;--web.enable-lifecycle&#x27;</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;9090:9090&quot;</span><br><span class="line">    networks:</span><br><span class="line">      - blog_network</span><br><span class="line">    restart: unless-stopped</span><br><span class="line"></span><br><span class="line">  grafana:</span><br><span class="line">    image: grafana/grafana:latest</span><br><span class="line">    container_name: blog_grafana</span><br><span class="line">    environment:</span><br><span class="line">      - GF_SECURITY_ADMIN_PASSWORD=$&#123;GRAFANA_PASSWORD&#125;</span><br><span class="line">    volumes:</span><br><span class="line">      - grafana_data:/var/lib/grafana</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;3001:3000&quot;</span><br><span class="line">    networks:</span><br><span class="line">      - blog_network</span><br><span class="line">    restart: unless-stopped</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  blog_network:</span><br><span class="line">    driver: bridge</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  mysql_data:</span><br><span class="line">  redis_data:</span><br><span class="line">  elasticsearch_data:</span><br><span class="line">  prometheus_data:</span><br><span class="line">  grafana_data:</span><br></pre></td></tr></table></figure>



<p><strong>nginx.conf</strong></p>
<p>nginx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line">events &#123;</span><br><span class="line">    worker_connections 1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include /etc/nginx/mime.types;</span><br><span class="line">    default_type application/octet-stream;</span><br><span class="line"></span><br><span class="line">    # 日志格式</span><br><span class="line">    log_format main &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                    &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                    &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log /var/log/nginx/access.log main;</span><br><span class="line">    error_log /var/log/nginx/error.log warn;</span><br><span class="line"></span><br><span class="line">    # Gzip压缩</span><br><span class="line">    gzip on;</span><br><span class="line">    gzip_vary on;</span><br><span class="line">    gzip_min_length 1024;</span><br><span class="line">    gzip_types text/plain text/css text/xml text/javascript</span><br><span class="line">               application/javascript application/xml+rss application/json;</span><br><span class="line"></span><br><span class="line">    # 限制请求大小</span><br><span class="line">    client_max_body_size 10M;</span><br><span class="line"></span><br><span class="line">    # 隐藏Nginx版本号</span><br><span class="line">    server_tokens off;</span><br><span class="line"></span><br><span class="line">    # 缓存配置</span><br><span class="line">    proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=blog_cache:10m</span><br><span class="line">                     max_size=1g inactive=60m use_temp_path=off;</span><br><span class="line"></span><br><span class="line">    upstream backend &#123;</span><br><span class="line">        server backend:8080;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    upstream frontend &#123;</span><br><span class="line">        server frontend:80;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name blog.example.com;</span><br><span class="line">        return 301 https://$server_name$request_uri;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 443 ssl http2;</span><br><span class="line">        server_name blog.example.com;</span><br><span class="line"></span><br><span class="line">        ssl_certificate /etc/nginx/ssl/blog.crt;</span><br><span class="line">        ssl_certificate_key /etc/nginx/ssl/blog.key;</span><br><span class="line">        </span><br><span class="line">        ssl_protocols TLSv1.2 TLSv1.3;</span><br><span class="line">        ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;</span><br><span class="line">        ssl_prefer_server_ciphers off;</span><br><span class="line">        </span><br><span class="line">        ssl_session_cache shared:SSL:10m;</span><br><span class="line">        ssl_session_timeout 10m;</span><br><span class="line">        </span><br><span class="line">        # HSTS</span><br><span class="line">        add_header Strict-Transport-Security &quot;max-age=31536000; includeSubDomains&quot; always;</span><br><span class="line"></span><br><span class="line">        # 静态文件</span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://frontend;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">            </span><br><span class="line">            # 缓存静态文件</span><br><span class="line">            location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ &#123;</span><br><span class="line">                expires 1y;</span><br><span class="line">                add_header Cache-Control &quot;public, immutable&quot;;</span><br><span class="line">                proxy_pass http://frontend;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # API接口</span><br><span class="line">        location /api &#123;</span><br><span class="line">            proxy_pass http://backend;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">            </span><br><span class="line">            # 缓存API响应</span><br><span class="line">            proxy_cache blog_cache;</span><br><span class="line">            proxy_cache_key &quot;$scheme$request_method$host$request_uri&quot;;</span><br><span class="line">            proxy_cache_valid 200 302 10m;</span><br><span class="line">            proxy_cache_valid 404 1m;</span><br><span class="line">            </span><br><span class="line">            # WebSocket支持</span><br><span class="line">            location /ws &#123;</span><br><span class="line">                proxy_pass http://backend;</span><br><span class="line">                proxy_http_version 1.1;</span><br><span class="line">                proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">                proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class="line">                proxy_set_header Host $host;</span><br><span class="line">                proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">                proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # 文件上传</span><br><span class="line">        location /uploads &#123;</span><br><span class="line">            alias /app/uploads;</span><br><span class="line">            expires 30d;</span><br><span class="line">            add_header Cache-Control &quot;public&quot;;</span><br><span class="line">            </span><br><span class="line">            # 防盗链</span><br><span class="line">            valid_referers none blocked blog.example.com;</span><br><span class="line">            if ($invalid_referer) &#123;</span><br><span class="line">                return 403;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # 健康检查</span><br><span class="line">        location /health &#123;</span><br><span class="line">            access_log off;</span><br><span class="line">            return 200 &quot;healthy\n&quot;;</span><br><span class="line">            add_header Content-Type text/plain;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        # 阻止敏感文件访问</span><br><span class="line">        location ~ /\. &#123;</span><br><span class="line">            deny all;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>prometheus.yml</strong></p>
<p>yaml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">global:</span><br><span class="line">  scrape_interval: 15s</span><br><span class="line">  evaluation_interval: 15s</span><br><span class="line"></span><br><span class="line">rule_files:</span><br><span class="line">  - &quot;alert.rules&quot;</span><br><span class="line"></span><br><span class="line">alerting:</span><br><span class="line">  alertmanagers:</span><br><span class="line">    - static_configs:</span><br><span class="line">        - targets:</span><br><span class="line">          - alertmanager:9093</span><br><span class="line"></span><br><span class="line">scrape_configs:</span><br><span class="line">  - job_name: &#x27;spring-boot&#x27;</span><br><span class="line">    metrics_path: &#x27;/actuator/prometheus&#x27;</span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [&#x27;backend:8080&#x27;]</span><br><span class="line">        labels:</span><br><span class="line">          application: &#x27;blog-backend&#x27;</span><br><span class="line">  </span><br><span class="line">  - job_name: &#x27;node-exporter&#x27;</span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [&#x27;node-exporter:9100&#x27;]</span><br><span class="line">  </span><br><span class="line">  - job_name: &#x27;prometheus&#x27;</span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [&#x27;localhost:9090&#x27;]</span><br><span class="line"></span><br><span class="line">  - job_name: &#x27;nginx&#x27;</span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [&#x27;nginx-exporter:9113&#x27;]</span><br></pre></td></tr></table></figure>



<h3 id="2-Kubernetes部署配置"><a href="#2-Kubernetes部署配置" class="headerlink" title="2. Kubernetes部署配置"></a>2. Kubernetes部署配置</h3><p><strong>blog-deployment.yaml</strong></p>
<p>yaml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:</span><br><span class="line">  name: blog-system</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: blog-config</span><br><span class="line">  namespace: blog-system</span><br><span class="line">data:</span><br><span class="line">  application-prod.yml: |</span><br><span class="line">    spring:</span><br><span class="line">      datasource:</span><br><span class="line">        url: jdbc:mysql://blog-mysql.blog-system.svc.cluster.local:3306/blog_db</span><br><span class="line">        username: $&#123;DB_USERNAME&#125;</span><br><span class="line">        password: $&#123;DB_PASSWORD&#125;</span><br><span class="line">      redis:</span><br><span class="line">        host: blog-redis</span><br><span class="line">        port: 6379</span><br><span class="line">        password: $&#123;REDIS_PASSWORD&#125;</span><br><span class="line">      elasticsearch:</span><br><span class="line">        uris: http://blog-elasticsearch:9200</span><br><span class="line">    app:</span><br><span class="line">      jwt:</span><br><span class="line">        secret: $&#123;JWT_SECRET&#125;</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  name: blog-secrets</span><br><span class="line">  namespace: blog-system</span><br><span class="line">type: Opaque</span><br><span class="line">data:</span><br><span class="line">  db-password: &lt;base64-encoded-password&gt;</span><br><span class="line">  redis-password: &lt;base64-encoded-password&gt;</span><br><span class="line">  jwt-secret: &lt;base64-encoded-secret&gt;</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: blog-backend</span><br><span class="line">  namespace: blog-system</span><br><span class="line">spec:</span><br><span class="line">  replicas: 3</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: blog-backend</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: blog-backend</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: blog-backend</span><br><span class="line">        image: your-registry/blog-backend:latest</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 8080</span><br><span class="line">        env:</span><br><span class="line">        - name: DB_PASSWORD</span><br><span class="line">          valueFrom:</span><br><span class="line">            secretKeyRef:</span><br><span class="line">              name: blog-secrets</span><br><span class="line">              key: db-password</span><br><span class="line">        - name: REDIS_PASSWORD</span><br><span class="line">          valueFrom:</span><br><span class="line">            secretKeyRef:</span><br><span class="line">              name: blog-secrets</span><br><span class="line">              key: redis-password</span><br><span class="line">        - name: JWT_SECRET</span><br><span class="line">          valueFrom:</span><br><span class="line">            secretKeyRef:</span><br><span class="line">              name: blog-secrets</span><br><span class="line">              key: jwt-secret</span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            memory: &quot;512Mi&quot;</span><br><span class="line">            cpu: &quot;250m&quot;</span><br><span class="line">          limits:</span><br><span class="line">            memory: &quot;1Gi&quot;</span><br><span class="line">            cpu: &quot;500m&quot;</span><br><span class="line">        livenessProbe:</span><br><span class="line">          httpGet:</span><br><span class="line">            path: /actuator/health/liveness</span><br><span class="line">            port: 8080</span><br><span class="line">          initialDelaySeconds: 60</span><br><span class="line">          periodSeconds: 10</span><br><span class="line">        readinessProbe:</span><br><span class="line">          httpGet:</span><br><span class="line">            path: /actuator/health/readiness</span><br><span class="line">            port: 8080</span><br><span class="line">          initialDelaySeconds: 30</span><br><span class="line">          periodSeconds: 5</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: blog-frontend</span><br><span class="line">  namespace: blog-system</span><br><span class="line">spec:</span><br><span class="line">  replicas: 2</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: blog-frontend</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: blog-frontend</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: blog-frontend</span><br><span class="line">        image: your-registry/blog-frontend:latest</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">        resources:</span><br><span class="line">          requests:</span><br><span class="line">            memory: &quot;256Mi&quot;</span><br><span class="line">            cpu: &quot;100m&quot;</span><br><span class="line">          limits:</span><br><span class="line">            memory: &quot;512Mi&quot;</span><br><span class="line">            cpu: &quot;200m&quot;</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: blog-backend-service</span><br><span class="line">  namespace: blog-system</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: blog-backend</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    targetPort: 8080</span><br><span class="line">  type: ClusterIP</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: blog-frontend-service</span><br><span class="line">  namespace: blog-system</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: blog-frontend</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    targetPort: 80</span><br><span class="line">  type: ClusterIP</span><br><span class="line">---</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: blog-ingress</span><br><span class="line">  namespace: blog-system</span><br><span class="line">  annotations:</span><br><span class="line">    nginx.ingress.kubernetes.io/rewrite-target: /</span><br><span class="line">    nginx.ingress.kubernetes.io/ssl-redirect: &quot;true&quot;</span><br><span class="line">    cert-manager.io/cluster-issuer: &quot;letsencrypt-prod&quot;</span><br><span class="line">spec:</span><br><span class="line">  tls:</span><br><span class="line">  - hosts:</span><br><span class="line">    - blog.example.com</span><br><span class="line">    secretName: blog-tls</span><br><span class="line">  rules:</span><br><span class="line">  - host: blog.example.com</span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - path: /</span><br><span class="line">        pathType: Prefix</span><br><span class="line">        backend:</span><br><span class="line">          service:</span><br><span class="line">            name: blog-frontend-service</span><br><span class="line">            port:</span><br><span class="line">              number: 80</span><br><span class="line">      - path: /api</span><br><span class="line">        pathType: Prefix</span><br><span class="line">        backend:</span><br><span class="line">          service:</span><br><span class="line">            name: blog-backend-service</span><br><span class="line">            port:</span><br><span class="line">              number: 80</span><br></pre></td></tr></table></figure>



<h3 id="3-监控和日志配置"><a href="#3-监控和日志配置" class="headerlink" title="3. 监控和日志配置"></a>3. 监控和日志配置</h3><p><strong>application-monitoring.yml</strong></p>
<p>yaml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">management:</span><br><span class="line">  endpoints:</span><br><span class="line">    web:</span><br><span class="line">      exposure:</span><br><span class="line">        include: health,info,metrics,prometheus,loggers</span><br><span class="line">      base-path: /actuator</span><br><span class="line">  endpoint:</span><br><span class="line">    health:</span><br><span class="line">      show-details: always</span><br><span class="line">      probes:</span><br><span class="line">        enabled: true</span><br><span class="line">    metrics:</span><br><span class="line">      enabled: true</span><br><span class="line">    prometheus:</span><br><span class="line">      enabled: true</span><br><span class="line">  metrics:</span><br><span class="line">    export:</span><br><span class="line">      prometheus:</span><br><span class="line">        enabled: true</span><br><span class="line">    tags:</span><br><span class="line">      application: blog-system</span><br><span class="line">    distribution:</span><br><span class="line">      percentiles-histogram:</span><br><span class="line">        http.server.requests: true</span><br><span class="line">  tracing:</span><br><span class="line">    sampling:</span><br><span class="line">      probability: 1.0</span><br><span class="line"></span><br><span class="line">logging:</span><br><span class="line">  level:</span><br><span class="line">    com.blog: INFO</span><br><span class="line">    org.springframework.web: INFO</span><br><span class="line">    org.hibernate: WARN</span><br><span class="line">  pattern:</span><br><span class="line">    console: &quot;%d&#123;yyyy-MM-dd HH:mm:ss&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&quot;</span><br><span class="line">    file: &quot;%d&#123;yyyy-MM-dd HH:mm:ss&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&quot;</span><br><span class="line">  file:</span><br><span class="line">    name: /var/log/blog/blog-system.log</span><br><span class="line">    max-size: 10MB</span><br><span class="line">    max-history: 30</span><br><span class="line">  logstash:</span><br><span class="line">    enabled: true</span><br><span class="line">    host: localhost</span><br><span class="line">    port: 5000</span><br></pre></td></tr></table></figure>



<h2 id="第六部分：安全增强"><a href="#第六部分：安全增强" class="headerlink" title="第六部分：安全增强"></a>第六部分：安全增强</h2><h3 id="1-安全配置增强"><a href="#1-安全配置增强" class="headerlink" title="1. 安全配置增强"></a>1. 安全配置增强</h3><p><strong>SecurityConfigEnhanced.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.config;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;</span><br><span class="line">import org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line">import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line">import org.springframework.security.config.http.SessionCreationPolicy;</span><br><span class="line">import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class="line">import org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line">import org.springframework.security.web.SecurityFilterChain;</span><br><span class="line">import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;</span><br><span class="line">import org.springframework.security.web.csrf.CookieCsrfTokenRepository;</span><br><span class="line">import org.springframework.web.cors.CorsConfiguration;</span><br><span class="line">import org.springframework.web.cors.CorsConfigurationSource;</span><br><span class="line">import org.springframework.web.cors.UrlBasedCorsConfigurationSource;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.util.Arrays;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">@EnableWebSecurity</span><br><span class="line">@EnableGlobalMethodSecurity(</span><br><span class="line">    prePostEnabled = true,</span><br><span class="line">    securedEnabled = true,</span><br><span class="line">    jsr250Enabled = true</span><br><span class="line">)</span><br><span class="line">public class SecurityConfigEnhanced &#123;</span><br><span class="line">    </span><br><span class="line">    private final JwtAuthenticationFilter jwtAuthenticationFilter;</span><br><span class="line">    private final RateLimitFilter rateLimitFilter;</span><br><span class="line">    private final AuditFilter auditFilter;</span><br><span class="line">    </span><br><span class="line">    public SecurityConfigEnhanced(JwtAuthenticationFilter jwtAuthenticationFilter,</span><br><span class="line">                                 RateLimitFilter rateLimitFilter,</span><br><span class="line">                                 AuditFilter auditFilter) &#123;</span><br><span class="line">        this.jwtAuthenticationFilter = jwtAuthenticationFilter;</span><br><span class="line">        this.rateLimitFilter = rateLimitFilter;</span><br><span class="line">        this.auditFilter = auditFilter;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Bean</span><br><span class="line">    public PasswordEncoder passwordEncoder() &#123;</span><br><span class="line">        return new BCryptPasswordEncoder(12); // 增加强度</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Bean</span><br><span class="line">    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception &#123;</span><br><span class="line">        http</span><br><span class="line">            // CORS配置</span><br><span class="line">            .cors().configurationSource(corsConfigurationSource()).and()</span><br><span class="line">            </span><br><span class="line">            // CSRF配置</span><br><span class="line">            .csrf()</span><br><span class="line">                .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())</span><br><span class="line">                .ignoringAntMatchers(&quot;/api/auth/**&quot;, &quot;/api/webhook/**&quot;)</span><br><span class="line">                .and()</span><br><span class="line">            </span><br><span class="line">            // 会话管理</span><br><span class="line">            .sessionManagement()</span><br><span class="line">                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">                .and()</span><br><span class="line">            </span><br><span class="line">            // 异常处理</span><br><span class="line">            .exceptionHandling()</span><br><span class="line">                .authenticationEntryPoint((request, response, authException) -&gt; &#123;</span><br><span class="line">                    response.setContentType(&quot;application/json&quot;);</span><br><span class="line">                    response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);</span><br><span class="line">                    response.getWriter().write(&quot;&#123;\&quot;error\&quot;: \&quot;认证失败\&quot;&#125;&quot;);</span><br><span class="line">                &#125;)</span><br><span class="line">                .accessDeniedHandler((request, response, accessDeniedException) -&gt; &#123;</span><br><span class="line">                    response.setContentType(&quot;application/json&quot;);</span><br><span class="line">                    response.setStatus(HttpServletResponse.SC_FORBIDDEN);</span><br><span class="line">                    response.getWriter().write(&quot;&#123;\&quot;error\&quot;: \&quot;权限不足\&quot;&#125;&quot;);</span><br><span class="line">                &#125;)</span><br><span class="line">                .and()</span><br><span class="line">            </span><br><span class="line">            // 安全头配置</span><br><span class="line">            .headers()</span><br><span class="line">                .contentSecurityPolicy(&quot;default-src &#x27;self&#x27;; script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; &#x27;unsafe-eval&#x27;; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;;&quot;)</span><br><span class="line">                .and()</span><br><span class="line">                .xssProtection().block(true)</span><br><span class="line">                .and()</span><br><span class="line">                .frameOptions().deny()</span><br><span class="line">                .and()</span><br><span class="line">            </span><br><span class="line">            // 请求授权</span><br><span class="line">            .authorizeRequests()</span><br><span class="line">                // 公开接口</span><br><span class="line">                .antMatchers(</span><br><span class="line">                    &quot;/api/auth/**&quot;,</span><br><span class="line">                    &quot;/api/articles/public/**&quot;,</span><br><span class="line">                    &quot;/api/comments/public/**&quot;,</span><br><span class="line">                    &quot;/api/files/public/**&quot;,</span><br><span class="line">                    &quot;/actuator/health&quot;,</span><br><span class="line">                    &quot;/swagger-ui/**&quot;,</span><br><span class="line">                    &quot;/v3/api-docs/**&quot;</span><br><span class="line">                ).permitAll()</span><br><span class="line">                </span><br><span class="line">                // 用户接口</span><br><span class="line">                .antMatchers(</span><br><span class="line">                    &quot;/api/articles/**&quot;,</span><br><span class="line">                    &quot;/api/comments/**&quot;,</span><br><span class="line">                    &quot;/api/users/profile/**&quot;</span><br><span class="line">                ).hasAnyRole(&quot;USER&quot;, &quot;ADMIN&quot;)</span><br><span class="line">                </span><br><span class="line">                // 管理员接口</span><br><span class="line">                .antMatchers(</span><br><span class="line">                    &quot;/api/admin/**&quot;,</span><br><span class="line">                    &quot;/api/users/**&quot;,</span><br><span class="line">                    &quot;/api/system/**&quot;</span><br><span class="line">                ).hasRole(&quot;ADMIN&quot;)</span><br><span class="line">                </span><br><span class="line">                // 其他请求需要认证</span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">                .and()</span><br><span class="line">            </span><br><span class="line">            // 添加自定义过滤器</span><br><span class="line">            .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class)</span><br><span class="line">            .addFilterBefore(rateLimitFilter, JwtAuthenticationFilter.class)</span><br><span class="line">            .addFilterBefore(auditFilter, RateLimitFilter.class);</span><br><span class="line">        </span><br><span class="line">        return http.build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Bean</span><br><span class="line">    public CorsConfigurationSource corsConfigurationSource() &#123;</span><br><span class="line">        CorsConfiguration configuration = new CorsConfiguration();</span><br><span class="line">        configuration.setAllowedOrigins(List.of(</span><br><span class="line">            &quot;https://blog.example.com&quot;,</span><br><span class="line">            &quot;http://localhost:3000&quot;</span><br><span class="line">        ));</span><br><span class="line">        configuration.setAllowedMethods(Arrays.asList(</span><br><span class="line">            &quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;OPTIONS&quot;, &quot;PATCH&quot;</span><br><span class="line">        ));</span><br><span class="line">        configuration.setAllowedHeaders(Arrays.asList(</span><br><span class="line">            &quot;Authorization&quot;, &quot;Content-Type&quot;, &quot;X-Requested-With&quot;,</span><br><span class="line">            &quot;Accept&quot;, &quot;Origin&quot;, &quot;X-CSRF-TOKEN&quot;, &quot;Cache-Control&quot;</span><br><span class="line">        ));</span><br><span class="line">        configuration.setExposedHeaders(Arrays.asList(</span><br><span class="line">            &quot;Authorization&quot;, &quot;X-CSRF-TOKEN&quot;, &quot;X-Rate-Limit-Remaining&quot;</span><br><span class="line">        ));</span><br><span class="line">        configuration.setAllowCredentials(true);</span><br><span class="line">        configuration.setMaxAge(3600L);</span><br><span class="line">        </span><br><span class="line">        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();</span><br><span class="line">        source.registerCorsConfiguration(&quot;/api/**&quot;, configuration);</span><br><span class="line">        return source;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-限流过滤器"><a href="#2-限流过滤器" class="headerlink" title="2. 限流过滤器"></a>2. 限流过滤器</h3><p><strong>RateLimitFilter.java</strong></p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">package com.blog.security;</span><br><span class="line"></span><br><span class="line">import io.github.bucket4j.Bandwidth;</span><br><span class="line">import io.github.bucket4j.Bucket;</span><br><span class="line">import io.github.bucket4j.Refill;</span><br><span class="line">import io.github.bucket4j.local.LocalBucketBuilder;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import org.springframework.web.filter.OncePerRequestFilter;</span><br><span class="line">import javax.servlet.FilterChain;</span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.time.Duration;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">@Slf4j</span><br><span class="line">public class RateLimitFilter extends OncePerRequestFilter &#123;</span><br><span class="line">    </span><br><span class="line">    private final Map&lt;String, Bucket&gt; buckets = new ConcurrentHashMap&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    // 不同API的限流配置</span><br><span class="line">    private static final Map&lt;String, RateLimitConfig&gt; rateLimitConfigs = Map.of(</span><br><span class="line">        &quot;/api/auth/login&quot;, new RateLimitConfig(5, 1),      // 5次/分钟</span><br><span class="line">        &quot;/api/auth/register&quot;, new RateLimitConfig(2, 1),   // 2次/分钟</span><br><span class="line">        &quot;/api/comments&quot;, new RateLimitConfig(20, 1),       // 20次/分钟</span><br><span class="line">        &quot;/api/articles&quot;, new RateLimitConfig(30, 1),       // 30次/分钟</span><br><span class="line">        &quot;default&quot;, new RateLimitConfig(60, 1)              // 60次/分钟</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    protected void doFilterInternal(HttpServletRequest request,</span><br><span class="line">                                   HttpServletResponse response,</span><br><span class="line">                                   FilterChain filterChain)</span><br><span class="line">            throws ServletException, IOException &#123;</span><br><span class="line">        </span><br><span class="line">        String path = request.getServletPath();</span><br><span class="line">        String ip = getClientIP(request);</span><br><span class="line">        String key = ip + &quot;:&quot; + path;</span><br><span class="line">        </span><br><span class="line">        // 获取限流配置</span><br><span class="line">        RateLimitConfig config = rateLimitConfigs.entrySet().stream()</span><br><span class="line">            .filter(entry -&gt; path.startsWith(entry.getKey()))</span><br><span class="line">            .map(Map.Entry::getValue)</span><br><span class="line">            .findFirst()</span><br><span class="line">            .orElse(rateLimitConfigs.get(&quot;default&quot;));</span><br><span class="line">        </span><br><span class="line">        // 获取或创建令牌桶</span><br><span class="line">        Bucket bucket = buckets.computeIfAbsent(key, k -&gt; createBucket(config));</span><br><span class="line">        </span><br><span class="line">        // 尝试消费令牌</span><br><span class="line">        if (bucket.tryConsume(1)) &#123;</span><br><span class="line">            // 添加限流头信息</span><br><span class="line">            response.addHeader(&quot;X-Rate-Limit-Remaining&quot;,</span><br><span class="line">                String.valueOf(bucket.getAvailableTokens()));</span><br><span class="line">            filterChain.doFilter(request, response);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // 限流响应</span><br><span class="line">            response.setStatus(429); // Too Many Requests</span><br><span class="line">            response.setContentType(&quot;application/json&quot;);</span><br><span class="line">            response.getWriter().write(&quot;&#123;\&quot;error\&quot;: \&quot;请求过于频繁，请稍后再试\&quot;&#125;&quot;);</span><br><span class="line">            log.warn(&quot;请求被限流: IP=&#123;&#125;, Path=&#123;&#125;&quot;, ip, path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private Bucket createBucket(RateLimitConfig config) &#123;</span><br><span class="line">        Refill refill = Refill.intervally(config.capacity, Duration.ofMinutes(config.period));</span><br><span class="line">        Bandwidth limit = Bandwidth.classic(config.capacity, refill);</span><br><span class="line">        return new LocalBucketBuilder().addLimit(limit).build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private String getClientIP(HttpServletRequest request) &#123;</span><br><span class="line">        String xfHeader = request.getHeader(&quot;X-Forwarded-For&quot;);</span><br><span class="line">        if (xfHeader != null) &#123;</span><br><span class="line">            return xfHeader.split(&quot;,&quot;)[0];</span><br><span class="line">        &#125;</span><br><span class="line">        return request.getRemoteAddr();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private static class RateLimitConfig &#123;</span><br><span class="line">        final int capacity;</span><br><span class="line">        final int period; // 分钟</span><br><span class="line">        </span><br><span class="line">        RateLimitConfig(int capacity, int period) &#123;</span><br><span class="line">            this.capacity = capacity;</span><br><span class="line">            this.period = period;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>这个扩展版本提供了：</p>
<ol>
<li><strong>缓存优化</strong>：Redis缓存支持</li>
<li><strong>全文搜索</strong>：Elasticsearch集成</li>
<li><strong>实时通知</strong>：WebSocket支持</li>
<li><strong>文件处理</strong>：完整的文件上传服务</li>
<li><strong>邮件服务</strong>：用户通知和系统邮件</li>
<li><strong>定时任务</strong>：自动清理和统计</li>
<li><strong>API文档</strong>：Swagger集成</li>
<li><strong>状态管理</strong>：增强版前端状态管理</li>
<li><strong>富文本编辑器</strong>：完整的编辑器组件</li>
<li><strong>图表分析</strong>：数据可视化</li>
<li><strong>SEO优化</strong>：完整的SEO支持</li>
<li><strong>管理后台</strong>：完整的管理界面</li>
<li><strong>PDF导出</strong>：文章导出功能</li>
<li><strong>翻译服务</strong>：多语言支持</li>
<li><strong>推荐系统</strong>：个性化推荐算法</li>
<li><strong>容器化部署</strong>：Docker和Kubernetes配置</li>
<li><strong>监控系统</strong>：Prometheus + Grafana监控</li>
<li><strong>安全增强</strong>：完整的API安全防护</li>
<li><strong>限流保护</strong>：防止恶意请求</li>
</ol>
<p>这是一个企业级的完整博客系统，涵盖了现代Web开发的所有重要方面。</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/e21748aa.html" rel="prev" title="Java实践:消息队列">
                  <i class="fa fa-angle-left"></i> Java实践:消息队列
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/8eabe191.html" rel="next" title="Java实践:多线程断点续传下载器">
                  Java实践:多线程断点续传下载器 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa-regular fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder"></span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Word count total">407k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">24:41</span>
  </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.0/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>

  <script class="next-config" data-name="wavedrom" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.5.0/wavedrom.min.js","integrity":"sha256-INLAoJc6quTNfiMWkGZniYO2cxE8mHpddnLow1m6RFs="}}</script>
  <script class="next-config" data-name="wavedrom_skin" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.5.0/skins/default.js","integrity":"sha256-fduc/Zszk5ezWws2uInY/ALWVmIrmV6VTgXbsYSReFI="}}</script>
  <script src="/js/third-party/tags/wavedrom.js"></script>




  





</body>
</html>
