<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"timewait7.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="个人博客系统实现我将为你提供完整的个人博客系统实现代码，分为前后端两部分，你可以按照步骤逐步实现。 第一部分：后端实现（Java + Spring Boot）1. 项目搭建pom.xml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575">
<meta property="og:type" content="article">
<meta property="og:title" content="Java实践:个人博客">
<meta property="og:url" content="http://timewait7.github.io/post/c25083a1.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="个人博客系统实现我将为你提供完整的个人博客系统实现代码，分为前后端两部分，你可以按照步骤逐步实现。 第一部分：后端实现（Java + Spring Boot）1. 项目搭建pom.xml 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-12-17T11:07:59.000Z">
<meta property="article:modified_time" content="2025-12-19T12:27:37.234Z">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://timewait7.github.io/post/c25083a1.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://timewait7.github.io/post/c25083a1.html","path":"post/c25083a1.html","title":"Java实践:个人博客"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Java实践:个人博客 | Hexo</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Hexo</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-archives"><a href="/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="Searching..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.</span> <span class="nav-text">个人博客系统实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%9A%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0%EF%BC%88Java-Spring-Boot%EF%BC%89"><span class="nav-number">1.1.</span> <span class="nav-text">第一部分：后端实现（Java + Spring Boot）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="nav-number">1.1.1.</span> <span class="nav-text">1. 项目搭建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE"><span class="nav-number">1.1.2.</span> <span class="nav-text">2. 应用配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="nav-number">1.1.3.</span> <span class="nav-text">3. 实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-DTO%EF%BC%88%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E5%AF%B9%E8%B1%A1%EF%BC%89"><span class="nav-number">1.1.4.</span> <span class="nav-text">4. DTO（数据传输对象）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-Repository%EF%BC%88%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE%E5%B1%82%EF%BC%89"><span class="nav-number">1.1.5.</span> <span class="nav-text">5. Repository（数据访问层）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-Service%EF%BC%88%E4%B8%9A%E5%8A%A1%E9%80%BB%E8%BE%91%E5%B1%82%EF%BC%89"><span class="nav-number">1.1.6.</span> <span class="nav-text">6. Service（业务逻辑层）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="nav-number">1.1.7.</span> <span class="nav-text">7. 安全配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-Controller%EF%BC%88%E6%8E%A7%E5%88%B6%E5%99%A8%E5%B1%82%EF%BC%89"><span class="nav-number">1.1.8.</span> <span class="nav-text">8. Controller（控制器层）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="nav-number">1.1.9.</span> <span class="nav-text">9. 异常处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-%E4%B8%BB%E5%BA%94%E7%94%A8%E7%B1%BB"><span class="nav-number">1.1.10.</span> <span class="nav-text">10. 主应用类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%EF%BC%9A%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0%EF%BC%88%E7%BA%AFHTML-CSS-JavaScript%EF%BC%89"><span class="nav-number">1.2.</span> <span class="nav-text">第二部分：前端实现（纯HTML&#x2F;CSS&#x2F;JavaScript）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-number">1.2.1.</span> <span class="nav-text">1. 项目结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%A0%B8%E5%BF%83HTML%E6%96%87%E4%BB%B6"><span class="nav-number">1.2.2.</span> <span class="nav-text">2. 核心HTML文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E4%B8%BB%E6%A0%B7%E5%BC%8F%E6%96%87%E4%BB%B6"><span class="nav-number">1.2.3.</span> <span class="nav-text">3. 主样式文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-JavaScript%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97"><span class="nav-number">1.2.4.</span> <span class="nav-text">4. JavaScript核心模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E9%A1%B5%E9%9D%A2%E6%A8%A1%E5%9D%97"><span class="nav-number">1.2.5.</span> <span class="nav-text">5. 页面模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E7%BB%84%E4%BB%B6"><span class="nav-number">1.2.6.</span> <span class="nav-text">6. 组件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E8%84%9A%E6%9C%AC"><span class="nav-number">1.3.</span> <span class="nav-text">第三部分：数据库脚本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86%EF%BC%9A%E9%83%A8%E7%BD%B2%E5%92%8C%E8%BF%90%E8%A1%8C"><span class="nav-number">1.4.</span> <span class="nav-text">第四部分：部署和运行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="nav-number">1.4.1.</span> <span class="nav-text">1. 环境准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%90%8E%E7%AB%AF%E8%BF%90%E8%A1%8C%E6%AD%A5%E9%AA%A4"><span class="nav-number">1.4.2.</span> <span class="nav-text">2. 后端运行步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%89%8D%E7%AB%AF%E8%BF%90%E8%A1%8C%E6%AD%A5%E9%AA%A4"><span class="nav-number">1.4.3.</span> <span class="nav-text">3. 前端运行步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E8%AE%BF%E9%97%AE%E5%BA%94%E7%94%A8"><span class="nav-number">1.4.4.</span> <span class="nav-text">4. 访问应用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86%EF%BC%9A%E6%89%A9%E5%B1%95%E5%8A%9F%E8%83%BD%E5%BB%BA%E8%AE%AE"><span class="nav-number">1.5.</span> <span class="nav-text">第五部分：扩展功能建议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%8F%AF%E4%BB%A5%E6%B7%BB%E5%8A%A0%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="nav-number">1.5.1.</span> <span class="nav-text">1. 可以添加的功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">1.5.2.</span> <span class="nav-text">2. 性能优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%AE%89%E5%85%A8%E5%A2%9E%E5%BC%BA"><span class="nav-number">1.5.3.</span> <span class="nav-text">3. 安全增强</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E6%89%A9%E5%B1%95"><span class="nav-number">2.</span> <span class="nav-text">个人博客系统扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%9A%E5%90%8E%E7%AB%AF%E6%89%A9%E5%B1%95"><span class="nav-number">2.1.</span> <span class="nav-text">第一部分：后端扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%B7%BB%E5%8A%A0%E7%BC%93%E5%AD%98%E6%94%AF%E6%8C%81"><span class="nav-number">2.1.1.</span> <span class="nav-text">1. 添加缓存支持</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%B7%BB%E5%8A%A0%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD"><span class="nav-number">2.1.2.</span> <span class="nav-text">2. 添加全文搜索功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%B7%BB%E5%8A%A0WebSocket%E5%AE%9E%E6%97%B6%E9%80%9A%E7%9F%A5"><span class="nav-number">2.1.3.</span> <span class="nav-text">3. 添加WebSocket实时通知</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%B7%BB%E5%8A%A0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%9C%8D%E5%8A%A1"><span class="nav-number">2.1.4.</span> <span class="nav-text">4. 添加文件上传服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%B7%BB%E5%8A%A0%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1"><span class="nav-number">2.1.5.</span> <span class="nav-text">5. 添加邮件服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E6%B7%BB%E5%8A%A0%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="nav-number">2.1.6.</span> <span class="nav-text">6. 添加定时任务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E6%B7%BB%E5%8A%A0API%E6%96%87%E6%A1%A3"><span class="nav-number">2.1.7.</span> <span class="nav-text">7. 添加API文档</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%EF%BC%9A%E5%89%8D%E7%AB%AF%E6%89%A9%E5%B1%95"><span class="nav-number">2.2.</span> <span class="nav-text">第二部分：前端扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%B7%BB%E5%8A%A0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%A2%9E%E5%BC%BA"><span class="nav-number">2.2.1.</span> <span class="nav-text">1. 添加状态管理增强</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%B7%BB%E5%8A%A0WebSocket%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">2.2.2.</span> <span class="nav-text">2. 添加WebSocket客户端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%B7%BB%E5%8A%A0%E5%AF%8C%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91%E5%99%A8%E7%BB%84%E4%BB%B6"><span class="nav-number">2.2.3.</span> <span class="nav-text">3. 添加富文本编辑器组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%B7%BB%E5%8A%A0%E5%9B%BE%E8%A1%A8%E5%88%86%E6%9E%90%E7%BB%84%E4%BB%B6"><span class="nav-number">2.2.4.</span> <span class="nav-text">4. 添加图表分析组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%B7%BB%E5%8A%A0SEO%E4%BC%98%E5%8C%96%E7%BB%84%E4%BB%B6"><span class="nav-number">2.2.5.</span> <span class="nav-text">5. 添加SEO优化组件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%EF%BC%9A%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD%E9%A1%B5%E9%9D%A2"><span class="nav-number">2.3.</span> <span class="nav-text">第三部分：高级功能页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0%E9%A1%B5%E9%9D%A2"><span class="nav-number">2.3.1.</span> <span class="nav-text">1. 管理后台页面</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86%EF%BC%9A%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="nav-number">2.4.</span> <span class="nav-text">第四部分：高级功能实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%96%87%E7%AB%A0%E5%AF%BC%E5%87%BA%E4%B8%BAPDF%E5%8A%9F%E8%83%BD"><span class="nav-number">2.4.1.</span> <span class="nav-text">1. 文章导出为PDF功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%96%87%E7%AB%A0%E7%BF%BB%E8%AF%91%E5%8A%9F%E8%83%BD"><span class="nav-number">2.4.2.</span> <span class="nav-text">2. 文章翻译功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%96%87%E7%AB%A0%E7%9B%B8%E4%BC%BC%E5%BA%A6%E6%8E%A8%E8%8D%90"><span class="nav-number">2.4.3.</span> <span class="nav-text">3. 文章相似度推荐</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86%EF%BC%9A%E9%83%A8%E7%BD%B2%E5%92%8C%E8%BF%90%E7%BB%B4"><span class="nav-number">2.5.</span> <span class="nav-text">第五部分：部署和运维</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Docker%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">2.5.1.</span> <span class="nav-text">1. Docker配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Kubernetes%E9%83%A8%E7%BD%B2%E9%85%8D%E7%BD%AE"><span class="nav-number">2.5.2.</span> <span class="nav-text">2. Kubernetes部署配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%9B%91%E6%8E%A7%E5%92%8C%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE"><span class="nav-number">2.5.3.</span> <span class="nav-text">3. 监控和日志配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%85%AD%E9%83%A8%E5%88%86%EF%BC%9A%E5%AE%89%E5%85%A8%E5%A2%9E%E5%BC%BA"><span class="nav-number">2.6.</span> <span class="nav-text">第六部分：安全增强</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE%E5%A2%9E%E5%BC%BA"><span class="nav-number">2.6.1.</span> <span class="nav-text">1. 安全配置增强</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%99%90%E6%B5%81%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">2.6.2.</span> <span class="nav-text">2. 限流过滤器</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/">
          <span class="site-state-item-count">58</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://timewait7.github.io/post/c25083a1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Java实践:个人博客 | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Java实践:个人博客
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-12-17 19:07:59" itemprop="dateCreated datePublished" datetime="2025-12-17T19:07:59+08:00">2025-12-17</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>21k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>1:15</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="个人博客系统实现"><a href="#个人博客系统实现" class="headerlink" title="个人博客系统实现"></a>个人博客系统实现</h1><p>我将为你提供完整的个人博客系统实现代码，分为前后端两部分，你可以按照步骤逐步实现。</p>
<h2 id="第一部分：后端实现（Java-Spring-Boot）"><a href="#第一部分：后端实现（Java-Spring-Boot）" class="headerlink" title="第一部分：后端实现（Java + Spring Boot）"></a>第一部分：后端实现（Java + Spring Boot）</h2><h3 id="1-项目搭建"><a href="#1-项目搭建" class="headerlink" title="1. 项目搭建"></a>1. 项目搭建</h3><p><strong>pom.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 </span></span></span><br><span class="line"><span class="string"><span class="tag">         http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.blog<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>blog-system<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Blog System<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Personal Blog System<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>11<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Spring Boot Starters --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- Database --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- JWT --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.11.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.11.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.jsonwebtoken<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jjwt-jackson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.11.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- Utilities --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- Testing --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="2-应用配置"><a href="#2-应用配置" class="headerlink" title="2. 应用配置"></a>2. 应用配置</h3><p><strong>application.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/api</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/blog_db?useSSL=false&amp;serverTimezone=UTC&amp;characterEncoding=utf8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">yourpassword</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">idle-timeout:</span> <span class="number">30000</span></span><br><span class="line">      <span class="attr">connection-timeout:</span> <span class="number">30000</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">update</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">hibernate:</span></span><br><span class="line">        <span class="attr">dialect:</span> <span class="string">org.hibernate.dialect.MySQL8Dialect</span></span><br><span class="line">        <span class="attr">format_sql:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">jdbc:</span></span><br><span class="line">          <span class="attr">batch_size:</span> <span class="number">20</span></span><br><span class="line">        <span class="attr">order_inserts:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">order_updates:</span> <span class="literal">true</span></span><br><span class="line">    </span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="string">10MB</span></span><br><span class="line">      <span class="attr">max-request-size:</span> <span class="string">10MB</span></span><br><span class="line"></span><br><span class="line"><span class="attr">app:</span></span><br><span class="line">  <span class="attr">jwt:</span></span><br><span class="line">    <span class="attr">secret:</span> <span class="string">your-secret-key-should-be-at-least-32-characters-long</span></span><br><span class="line">    <span class="attr">expiration-ms:</span> <span class="number">86400000</span>  <span class="comment"># 24小时</span></span><br><span class="line">  <span class="attr">cors:</span></span><br><span class="line">    <span class="attr">allowed-origins:</span> <span class="string">http://localhost:3000,http://127.0.0.1:5500</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.blog:</span> <span class="string">DEBUG</span></span><br><span class="line">    <span class="attr">org.springframework.security:</span> <span class="string">DEBUG</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">logs/blog-system.log</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="3-实体类"><a href="#3-实体类" class="headerlink" title="3. 实体类"></a>3. 实体类</h3><p><strong>User.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;users&quot;, uniqueConstraints = &#123;</span></span><br><span class="line"><span class="meta">    @UniqueConstraint(columnNames = &quot;username&quot;),</span></span><br><span class="line"><span class="meta">    @UniqueConstraint(columnNames = &quot;email&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(nullable = false, length = 50)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(nullable = false, length = 100)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;password_hash&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> String passwordHash;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;display_name&quot;, length = 100)</span></span><br><span class="line">    <span class="keyword">private</span> String displayName;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(length = 500)</span></span><br><span class="line">    <span class="keyword">private</span> String bio;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;avatar_url&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String avatarUrl;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Enumerated(EnumType.STRING)</span></span><br><span class="line">    <span class="meta">@Column(nullable = false, length = 20)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Role</span> <span class="variable">role</span> <span class="operator">=</span> Role.USER;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;is_active&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">isActive</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;created_at&quot;, nullable = false, updatable = false)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;updated_at&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updatedAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;author&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Article&gt; articles = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;user&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Comment&gt; comments = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PrePersist</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">()</span> &#123;</span><br><span class="line">        createdAt = LocalDateTime.now();</span><br><span class="line">        updatedAt = LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PreUpdate</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">        updatedAt = LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Role</span> &#123;</span><br><span class="line">        USER, ADMIN</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>Article.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;articles&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Article</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(nullable = false, length = 200)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(columnDefinition = &quot;TEXT&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String summary;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(columnDefinition = &quot;LONGTEXT&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;cover_image&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String coverImage;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Enumerated(EnumType.STRING)</span></span><br><span class="line">    <span class="meta">@Column(nullable = false, length = 20)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Status</span> <span class="variable">status</span> <span class="operator">=</span> Status.DRAFT;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;view_count&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">viewCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;like_count&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">likeCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;comment_count&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">commentCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;is_featured&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">isFeatured</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;allow_comment&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">allowComment</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;created_at&quot;, nullable = false, updatable = false)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;updated_at&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updatedAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;published_at&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime publishedAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;author_id&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> User author;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;article&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@OrderBy(&quot;createdAt DESC&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Comment&gt; comments = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ManyToMany(fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinTable(</span></span><br><span class="line"><span class="meta">        name = &quot;article_tags&quot;,</span></span><br><span class="line"><span class="meta">        joinColumns = @JoinColumn(name = &quot;article_id&quot;),</span></span><br><span class="line"><span class="meta">        inverseJoinColumns = @JoinColumn(name = &quot;tag_id&quot;)</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;Tag&gt; tags = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;category_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Category category;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PrePersist</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">()</span> &#123;</span><br><span class="line">        createdAt = LocalDateTime.now();</span><br><span class="line">        updatedAt = LocalDateTime.now();</span><br><span class="line">        <span class="keyword">if</span> (status == Status.PUBLISHED) &#123;</span><br><span class="line">            publishedAt = LocalDateTime.now();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PreUpdate</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">        updatedAt = LocalDateTime.now();</span><br><span class="line">        <span class="keyword">if</span> (status == Status.PUBLISHED &amp;&amp; publishedAt == <span class="literal">null</span>) &#123;</span><br><span class="line">            publishedAt = LocalDateTime.now();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Status</span> &#123;</span><br><span class="line">        DRAFT, PUBLISHED, ARCHIVED</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>Comment.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;comments&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Comment</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(columnDefinition = &quot;TEXT&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;author_name&quot;, length = 100)</span></span><br><span class="line">    <span class="keyword">private</span> String authorName;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;author_email&quot;, length = 100)</span></span><br><span class="line">    <span class="keyword">private</span> String authorEmail;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;author_ip&quot;, length = 45)</span></span><br><span class="line">    <span class="keyword">private</span> String authorIp;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;is_approved&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">isApproved</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;like_count&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">likeCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;created_at&quot;, nullable = false, updatable = false)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;updated_at&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updatedAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;article_id&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> Article article;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;user_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ManyToOne(fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;parent_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Comment parent;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;parent&quot;, cascade = CascadeType.ALL, fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="meta">@OrderBy(&quot;createdAt ASC&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Comment&gt; replies = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PrePersist</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">()</span> &#123;</span><br><span class="line">        createdAt = LocalDateTime.now();</span><br><span class="line">        updatedAt = LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PreUpdate</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">        updatedAt = LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>Tag.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;tags&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Tag</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(nullable = false, unique = true, length = 50)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(length = 100)</span></span><br><span class="line">    <span class="keyword">private</span> String slug;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(length = 200)</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;created_at&quot;, nullable = false, updatable = false)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ManyToMany(mappedBy = &quot;tags&quot;, fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;Article&gt; articles = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PrePersist</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">()</span> &#123;</span><br><span class="line">        createdAt = LocalDateTime.now();</span><br><span class="line">        <span class="keyword">if</span> (slug == <span class="literal">null</span> || slug.isEmpty()) &#123;</span><br><span class="line">            slug = name.toLowerCase().replaceAll(<span class="string">&quot;[^a-z0-9]+&quot;</span>, <span class="string">&quot;-&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>Category.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;categories&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Category</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(nullable = false, length = 100)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(length = 100)</span></span><br><span class="line">    <span class="keyword">private</span> String slug;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(length = 200)</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;parent_id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long parentId;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;sort_order&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">sortOrder</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;article_count&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">articleCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Column(name = &quot;created_at&quot;, nullable = false, updatable = false)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;category&quot;, fetch = FetchType.LAZY)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Article&gt; articles = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PrePersist</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">()</span> &#123;</span><br><span class="line">        createdAt = LocalDateTime.now();</span><br><span class="line">        <span class="keyword">if</span> (slug == <span class="literal">null</span> || slug.isEmpty()) &#123;</span><br><span class="line">            slug = name.toLowerCase().replaceAll(<span class="string">&quot;[^a-z0-9]+&quot;</span>, <span class="string">&quot;-&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-DTO（数据传输对象）"><a href="#4-DTO（数据传输对象）" class="headerlink" title="4. DTO（数据传输对象）"></a>4. DTO（数据传输对象）</h3><p><strong>AuthRequest.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Email;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Size;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthRequest</span> &#123;</span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;用户名不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 3, max = 50, message = &quot;用户名长度必须在3-50个字符之间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;密码不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 6, max = 100, message = &quot;密码长度必须在6-100个字符之间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>RegisterRequest.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Email;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.NotBlank;</span><br><span class="line"><span class="keyword">import</span> javax.validation.constraints.Size;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegisterRequest</span> &#123;</span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;用户名不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 3, max = 50, message = &quot;用户名长度必须在3-50个字符之间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;邮箱不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Email(message = &quot;邮箱格式不正确&quot;)</span></span><br><span class="line">    <span class="meta">@Size(max = 100, message = &quot;邮箱长度不能超过100个字符&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;密码不能为空&quot;)</span></span><br><span class="line">    <span class="meta">@Size(min = 6, max = 100, message = &quot;密码长度必须在6-100个字符之间&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;确认密码不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String confirmPassword;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String displayName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>AuthResponse.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthResponse</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String accessToken;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">tokenType</span> <span class="operator">=</span> <span class="string">&quot;Bearer&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime expiresAt;</span><br><span class="line">    <span class="keyword">private</span> UserDTO user;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AuthResponse</span><span class="params">(String accessToken, LocalDateTime expiresAt, UserDTO user)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.accessToken = accessToken;</span><br><span class="line">        <span class="built_in">this</span>.expiresAt = expiresAt;</span><br><span class="line">        <span class="built_in">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>ArticleDTO.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> com.blog.entity.Article;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonInclude;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String summary;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="keyword">private</span> String coverImage;</span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">    <span class="keyword">private</span> Integer viewCount;</span><br><span class="line">    <span class="keyword">private</span> Integer likeCount;</span><br><span class="line">    <span class="keyword">private</span> Integer commentCount;</span><br><span class="line">    <span class="keyword">private</span> Boolean isFeatured;</span><br><span class="line">    <span class="keyword">private</span> Boolean allowComment;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updatedAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime publishedAt;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> UserSimpleDTO author;</span><br><span class="line">    <span class="keyword">private</span> CategorySimpleDTO category;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;TagSimpleDTO&gt; tags = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 用于创建和更新</span></span><br><span class="line">    <span class="keyword">private</span> Long authorId;</span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;Long&gt; tagIds = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ArticleDTO <span class="title function_">fromEntity</span><span class="params">(Article article)</span> &#123;</span><br><span class="line">        <span class="type">ArticleDTO</span> <span class="variable">dto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArticleDTO</span>();</span><br><span class="line">        dto.setId(article.getId());</span><br><span class="line">        dto.setTitle(article.getTitle());</span><br><span class="line">        dto.setSummary(article.getSummary());</span><br><span class="line">        dto.setContent(article.getContent());</span><br><span class="line">        dto.setCoverImage(article.getCoverImage());</span><br><span class="line">        dto.setStatus(article.getStatus().name());</span><br><span class="line">        dto.setViewCount(article.getViewCount());</span><br><span class="line">        dto.setLikeCount(article.getLikeCount());</span><br><span class="line">        dto.setCommentCount(article.getCommentCount());</span><br><span class="line">        dto.setIsFeatured(article.getIsFeatured());</span><br><span class="line">        dto.setAllowComment(article.getAllowComment());</span><br><span class="line">        dto.setCreatedAt(article.getCreatedAt());</span><br><span class="line">        dto.setUpdatedAt(article.getUpdatedAt());</span><br><span class="line">        dto.setPublishedAt(article.getPublishedAt());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (article.getAuthor() != <span class="literal">null</span>) &#123;</span><br><span class="line">            dto.setAuthor(UserSimpleDTO.fromEntity(article.getAuthor()));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (article.getCategory() != <span class="literal">null</span>) &#123;</span><br><span class="line">            dto.setCategory(CategorySimpleDTO.fromEntity(article.getCategory()));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (article.getTags() != <span class="literal">null</span>) &#123;</span><br><span class="line">            dto.setTags(article.getTags().stream()</span><br><span class="line">                .map(TagSimpleDTO::fromEntity)</span><br><span class="line">                .collect(Collectors.toSet()));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> dto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserSimpleDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String displayName;</span><br><span class="line">    <span class="keyword">private</span> String avatarUrl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UserSimpleDTO <span class="title function_">fromEntity</span><span class="params">(com.blog.entity.User user)</span> &#123;</span><br><span class="line">        <span class="type">UserSimpleDTO</span> <span class="variable">dto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserSimpleDTO</span>();</span><br><span class="line">        dto.setId(user.getId());</span><br><span class="line">        dto.setUsername(user.getUsername());</span><br><span class="line">        dto.setDisplayName(user.getDisplayName());</span><br><span class="line">        dto.setAvatarUrl(user.getAvatarUrl());</span><br><span class="line">        <span class="keyword">return</span> dto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CategorySimpleDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String slug;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CategorySimpleDTO <span class="title function_">fromEntity</span><span class="params">(Category category)</span> &#123;</span><br><span class="line">        <span class="type">CategorySimpleDTO</span> <span class="variable">dto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CategorySimpleDTO</span>();</span><br><span class="line">        dto.setId(category.getId());</span><br><span class="line">        dto.setName(category.getName());</span><br><span class="line">        dto.setSlug(category.getSlug());</span><br><span class="line">        <span class="keyword">return</span> dto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TagSimpleDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String slug;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> TagSimpleDTO <span class="title function_">fromEntity</span><span class="params">(Tag tag)</span> &#123;</span><br><span class="line">        <span class="type">TagSimpleDTO</span> <span class="variable">dto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TagSimpleDTO</span>();</span><br><span class="line">        dto.setId(tag.getId());</span><br><span class="line">        dto.setName(tag.getName());</span><br><span class="line">        dto.setSlug(tag.getSlug());</span><br><span class="line">        <span class="keyword">return</span> dto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>CommentDTO.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> com.blog.entity.Comment;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonInclude;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommentDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="keyword">private</span> String authorName;</span><br><span class="line">    <span class="keyword">private</span> String authorEmail;</span><br><span class="line">    <span class="keyword">private</span> Boolean isApproved;</span><br><span class="line">    <span class="keyword">private</span> Integer likeCount;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updatedAt;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Long articleId;</span><br><span class="line">    <span class="keyword">private</span> UserSimpleDTO user;</span><br><span class="line">    <span class="keyword">private</span> Long parentId;</span><br><span class="line">    <span class="keyword">private</span> List&lt;CommentDTO&gt; replies = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 用于创建</span></span><br><span class="line">    <span class="keyword">private</span> String authorIp;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CommentDTO <span class="title function_">fromEntity</span><span class="params">(Comment comment)</span> &#123;</span><br><span class="line">        <span class="type">CommentDTO</span> <span class="variable">dto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CommentDTO</span>();</span><br><span class="line">        dto.setId(comment.getId());</span><br><span class="line">        dto.setContent(comment.getContent());</span><br><span class="line">        dto.setAuthorName(comment.getAuthorName());</span><br><span class="line">        dto.setAuthorEmail(comment.getAuthorEmail());</span><br><span class="line">        dto.setIsApproved(comment.getIsApproved());</span><br><span class="line">        dto.setLikeCount(comment.getLikeCount());</span><br><span class="line">        dto.setCreatedAt(comment.getCreatedAt());</span><br><span class="line">        dto.setUpdatedAt(comment.getUpdatedAt());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (comment.getArticle() != <span class="literal">null</span>) &#123;</span><br><span class="line">            dto.setArticleId(comment.getArticle().getId());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (comment.getUser() != <span class="literal">null</span>) &#123;</span><br><span class="line">            dto.setUser(UserSimpleDTO.fromEntity(comment.getUser()));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (comment.getParent() != <span class="literal">null</span>) &#123;</span><br><span class="line">            dto.setParentId(comment.getParent().getId());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (comment.getReplies() != <span class="literal">null</span> &amp;&amp; !comment.getReplies().isEmpty()) &#123;</span><br><span class="line">            dto.setReplies(comment.getReplies().stream()</span><br><span class="line">                .map(CommentDTO::fromEntity)</span><br><span class="line">                .collect(Collectors.toList()));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> dto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5-Repository（数据访问层）"><a href="#5-Repository（数据访问层）" class="headerlink" title="5. Repository（数据访问层）"></a>5. Repository（数据访问层）</h3><p><strong>UserRepository.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.blog.entity.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.Query;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.repository.query.Param;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;User, Long&gt; &#123;</span><br><span class="line">    Optional&lt;User&gt; <span class="title function_">findByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">    Optional&lt;User&gt; <span class="title function_">findByEmail</span><span class="params">(String email)</span>;</span><br><span class="line">    Boolean <span class="title function_">existsByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">    Boolean <span class="title function_">existsByEmail</span><span class="params">(String email)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Query(&quot;SELECT u FROM User u WHERE u.username = :username OR u.email = :email&quot;)</span></span><br><span class="line">    Optional&lt;User&gt; <span class="title function_">findByUsernameOrEmail</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String username, </span></span><br><span class="line"><span class="params">                                         <span class="meta">@Param(&quot;email&quot;)</span> String email)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>ArticleRepository.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.blog.entity.Article;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Page;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Pageable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.Query;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.repository.query.Param;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ArticleRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Article, Long&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    Page&lt;Article&gt; <span class="title function_">findByStatus</span><span class="params">(Article.Status status, Pageable pageable)</span>;</span><br><span class="line">    </span><br><span class="line">    Page&lt;Article&gt; <span class="title function_">findByAuthorIdAndStatus</span><span class="params">(Long authorId, Article.Status status, Pageable pageable)</span>;</span><br><span class="line">    </span><br><span class="line">    Page&lt;Article&gt; <span class="title function_">findByCategoryIdAndStatus</span><span class="params">(Long categoryId, Article.Status status, Pageable pageable)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Query(&quot;SELECT a FROM Article a JOIN a.tags t WHERE t.id = :tagId AND a.status = :status&quot;)</span></span><br><span class="line">    Page&lt;Article&gt; <span class="title function_">findByTagIdAndStatus</span><span class="params">(<span class="meta">@Param(&quot;tagId&quot;)</span> Long tagId, </span></span><br><span class="line"><span class="params">                                       <span class="meta">@Param(&quot;status&quot;)</span> Article.Status status, </span></span><br><span class="line"><span class="params">                                       Pageable pageable)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Query(&quot;SELECT a FROM Article a WHERE a.status = &#x27;PUBLISHED&#x27; AND &quot; +</span></span><br><span class="line"><span class="meta">           &quot;(LOWER(a.title) LIKE LOWER(CONCAT(&#x27;%&#x27;, :keyword, &#x27;%&#x27;)) OR &quot; +</span></span><br><span class="line"><span class="meta">           &quot;LOWER(a.summary) LIKE LOWER(CONCAT(&#x27;%&#x27;, :keyword, &#x27;%&#x27;)) OR &quot; +</span></span><br><span class="line"><span class="meta">           &quot;LOWER(a.content) LIKE LOWER(CONCAT(&#x27;%&#x27;, :keyword, &#x27;%&#x27;)))&quot;)</span></span><br><span class="line">    Page&lt;Article&gt; <span class="title function_">searchPublished</span><span class="params">(<span class="meta">@Param(&quot;keyword&quot;)</span> String keyword, Pageable pageable)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Query(&quot;SELECT a FROM Article a WHERE a.status = &#x27;PUBLISHED&#x27; AND a.isFeatured = true&quot;)</span></span><br><span class="line">    Page&lt;Article&gt; <span class="title function_">findFeaturedArticles</span><span class="params">(Pageable pageable)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Query(&quot;SELECT a FROM Article a WHERE a.status = &#x27;PUBLISHED&#x27; &quot; +</span></span><br><span class="line"><span class="meta">           &quot;AND a.publishedAt &gt;= :startDate AND a.publishedAt &lt;= :endDate&quot;)</span></span><br><span class="line">    Page&lt;Article&gt; <span class="title function_">findPublishedBetween</span><span class="params">(<span class="meta">@Param(&quot;startDate&quot;)</span> LocalDateTime startDate,</span></span><br><span class="line"><span class="params">                                       <span class="meta">@Param(&quot;endDate&quot;)</span> LocalDateTime endDate,</span></span><br><span class="line"><span class="params">                                       Pageable pageable)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Query(&quot;SELECT YEAR(a.publishedAt) as year, MONTH(a.publishedAt) as month, COUNT(a) as count &quot; +</span></span><br><span class="line"><span class="meta">           &quot;FROM Article a WHERE a.status = &#x27;PUBLISHED&#x27; &quot; +</span></span><br><span class="line"><span class="meta">           &quot;GROUP BY YEAR(a.publishedAt), MONTH(a.publishedAt) &quot; +</span></span><br><span class="line"><span class="meta">           &quot;ORDER BY year DESC, month DESC&quot;)</span></span><br><span class="line">    List&lt;Object[]&gt; findArchiveStatistics();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Query(&quot;SELECT COUNT(a) FROM Article a WHERE a.status = &#x27;PUBLISHED&#x27;&quot;)</span></span><br><span class="line">    Long <span class="title function_">countPublishedArticles</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Query(&quot;SELECT a FROM Article a WHERE a.status = &#x27;PUBLISHED&#x27; ORDER BY a.viewCount DESC&quot;)</span></span><br><span class="line">    Page&lt;Article&gt; <span class="title function_">findPopularArticles</span><span class="params">(Pageable pageable)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>CommentRepository.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.blog.entity.Comment;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Page;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Pageable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.Query;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.repository.query.Param;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CommentRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Comment, Long&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    Page&lt;Comment&gt; <span class="title function_">findByArticleIdAndIsApprovedTrue</span><span class="params">(Long articleId, Pageable pageable)</span>;</span><br><span class="line">    </span><br><span class="line">    Page&lt;Comment&gt; <span class="title function_">findByArticleId</span><span class="params">(Long articleId, Pageable pageable)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Query(&quot;SELECT c FROM Comment c WHERE c.parent IS NULL AND c.article.id = :articleId AND c.isApproved = true&quot;)</span></span><br><span class="line">    Page&lt;Comment&gt; <span class="title function_">findRootCommentsByArticleId</span><span class="params">(<span class="meta">@Param(&quot;articleId&quot;)</span> Long articleId, Pageable pageable)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Query(&quot;SELECT c FROM Comment c WHERE c.parent.id = :parentId AND c.isApproved = true&quot;)</span></span><br><span class="line">    List&lt;Comment&gt; <span class="title function_">findRepliesByParentId</span><span class="params">(<span class="meta">@Param(&quot;parentId&quot;)</span> Long parentId)</span>;</span><br><span class="line">    </span><br><span class="line">    Long <span class="title function_">countByArticleIdAndIsApprovedTrue</span><span class="params">(Long articleId)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Query(&quot;SELECT c FROM Comment c WHERE c.isApproved = false ORDER BY c.createdAt DESC&quot;)</span></span><br><span class="line">    Page&lt;Comment&gt; <span class="title function_">findUnapprovedComments</span><span class="params">(Pageable pageable)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="6-Service（业务逻辑层）"><a href="#6-Service（业务逻辑层）" class="headerlink" title="6. Service（业务逻辑层）"></a>6. Service（业务逻辑层）</h3><p><strong>UserService.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.blog.dto.RegisterRequest;</span><br><span class="line"><span class="keyword">import</span> com.blog.dto.UserDTO;</span><br><span class="line"><span class="keyword">import</span> com.blog.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.blog.exception.ResourceNotFoundException;</span><br><span class="line"><span class="keyword">import</span> com.blog.exception.BusinessException;</span><br><span class="line"><span class="keyword">import</span> com.blog.repository.UserRepository;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PasswordEncoder passwordEncoder;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> Optional&lt;User&gt; <span class="title function_">findByUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.findByUsername(username);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> Optional&lt;User&gt; <span class="title function_">findByEmail</span><span class="params">(String email)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userRepository.findByEmail(email);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">getUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userRepository.findById(id)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">ResourceNotFoundException</span>(<span class="string">&quot;用户不存在，ID: &quot;</span> + id));</span><br><span class="line">        <span class="keyword">return</span> convertToDTO(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">registerUser</span><span class="params">(RegisterRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// 验证用户名是否已存在</span></span><br><span class="line">        <span class="keyword">if</span> (userRepository.existsByUsername(request.getUsername())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;用户名已存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证邮箱是否已存在</span></span><br><span class="line">        <span class="keyword">if</span> (userRepository.existsByEmail(request.getEmail())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;邮箱已被注册&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证密码确认</span></span><br><span class="line">        <span class="keyword">if</span> (!request.getPassword().equals(request.getConfirmPassword())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;两次输入的密码不一致&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建新用户</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUsername(request.getUsername());</span><br><span class="line">        user.setEmail(request.getEmail());</span><br><span class="line">        user.setPasswordHash(passwordEncoder.encode(request.getPassword()));</span><br><span class="line">        user.setDisplayName(request.getDisplayName() != <span class="literal">null</span> ? </span><br><span class="line">                          request.getDisplayName() : request.getUsername());</span><br><span class="line">        user.setRole(User.Role.USER);</span><br><span class="line">        user.setIsActive(<span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">User</span> <span class="variable">savedUser</span> <span class="operator">=</span> userRepository.save(user);</span><br><span class="line">        log.info(<span class="string">&quot;用户注册成功: &#123;&#125;&quot;</span>, savedUser.getUsername());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> convertToDTO(savedUser);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">updateUserProfile</span><span class="params">(Long userId, UserDTO userDTO)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userRepository.findById(userId)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">ResourceNotFoundException</span>(<span class="string">&quot;用户不存在，ID: &quot;</span> + userId));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 更新允许修改的字段</span></span><br><span class="line">        <span class="keyword">if</span> (userDTO.getDisplayName() != <span class="literal">null</span>) &#123;</span><br><span class="line">            user.setDisplayName(userDTO.getDisplayName());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (userDTO.getBio() != <span class="literal">null</span>) &#123;</span><br><span class="line">            user.setBio(userDTO.getBio());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (userDTO.getAvatarUrl() != <span class="literal">null</span>) &#123;</span><br><span class="line">            user.setAvatarUrl(userDTO.getAvatarUrl());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        userRepository.save(user);</span><br><span class="line">        log.info(<span class="string">&quot;用户资料已更新: &#123;&#125;&quot;</span>, user.getUsername());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> convertToDTO(user);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changePassword</span><span class="params">(Long userId, String oldPassword, String newPassword)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userRepository.findById(userId)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">ResourceNotFoundException</span>(<span class="string">&quot;用户不存在，ID: &quot;</span> + userId));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证旧密码</span></span><br><span class="line">        <span class="keyword">if</span> (!passwordEncoder.matches(oldPassword, user.getPasswordHash())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;旧密码不正确&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 更新密码</span></span><br><span class="line">        user.setPasswordHash(passwordEncoder.encode(newPassword));</span><br><span class="line">        userRepository.save(user);</span><br><span class="line">        log.info(<span class="string">&quot;用户密码已修改: &#123;&#125;&quot;</span>, user.getUsername());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deactivateUser</span><span class="params">(Long userId)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userRepository.findById(userId)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">ResourceNotFoundException</span>(<span class="string">&quot;用户不存在，ID: &quot;</span> + userId));</span><br><span class="line">        </span><br><span class="line">        user.setIsActive(<span class="literal">false</span>);</span><br><span class="line">        userRepository.save(user);</span><br><span class="line">        log.info(<span class="string">&quot;用户已停用: &#123;&#125;&quot;</span>, user.getUsername());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> UserDTO <span class="title function_">convertToDTO</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">dto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDTO</span>();</span><br><span class="line">        dto.setId(user.getId());</span><br><span class="line">        dto.setUsername(user.getUsername());</span><br><span class="line">        dto.setEmail(user.getEmail());</span><br><span class="line">        dto.setDisplayName(user.getDisplayName());</span><br><span class="line">        dto.setBio(user.getBio());</span><br><span class="line">        dto.setAvatarUrl(user.getAvatarUrl());</span><br><span class="line">        dto.setRole(user.getRole().name());</span><br><span class="line">        dto.setIsActive(user.getIsActive());</span><br><span class="line">        dto.setCreatedAt(user.getCreatedAt());</span><br><span class="line">        dto.setUpdatedAt(user.getUpdatedAt());</span><br><span class="line">        <span class="keyword">return</span> dto;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>ArticleService.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.blog.dto.ArticleDTO;</span><br><span class="line"><span class="keyword">import</span> com.blog.entity.Article;</span><br><span class="line"><span class="keyword">import</span> com.blog.entity.Category;</span><br><span class="line"><span class="keyword">import</span> com.blog.entity.Tag;</span><br><span class="line"><span class="keyword">import</span> com.blog.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.blog.exception.ResourceNotFoundException;</span><br><span class="line"><span class="keyword">import</span> com.blog.exception.BusinessException;</span><br><span class="line"><span class="keyword">import</span> com.blog.repository.ArticleRepository;</span><br><span class="line"><span class="keyword">import</span> com.blog.repository.CategoryRepository;</span><br><span class="line"><span class="keyword">import</span> com.blog.repository.TagRepository;</span><br><span class="line"><span class="keyword">import</span> com.blog.repository.UserRepository;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Page;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Pageable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ArticleRepository articleRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CategoryRepository categoryRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TagRepository tagRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> Page&lt;ArticleDTO&gt; <span class="title function_">getPublishedArticles</span><span class="params">(Pageable pageable)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> articleRepository.findByStatus(Article.Status.PUBLISHED, pageable)</span><br><span class="line">            .map(ArticleDTO::fromEntity);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> Page&lt;ArticleDTO&gt; <span class="title function_">searchPublishedArticles</span><span class="params">(String keyword, Pageable pageable)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> articleRepository.searchPublished(keyword, pageable)</span><br><span class="line">            .map(ArticleDTO::fromEntity);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> ArticleDTO <span class="title function_">getArticleById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> articleRepository.findById(id)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">ResourceNotFoundException</span>(<span class="string">&quot;文章不存在，ID: &quot;</span> + id));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 增加阅读计数</span></span><br><span class="line">        article.setViewCount(article.getViewCount() + <span class="number">1</span>);</span><br><span class="line">        articleRepository.save(article);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ArticleDTO.fromEntity(article);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> Page&lt;ArticleDTO&gt; <span class="title function_">getArticlesByCategory</span><span class="params">(Long categoryId, Pageable pageable)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> articleRepository.findByCategoryIdAndStatus(categoryId, Article.Status.PUBLISHED, pageable)</span><br><span class="line">            .map(ArticleDTO::fromEntity);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> Page&lt;ArticleDTO&gt; <span class="title function_">getArticlesByTag</span><span class="params">(Long tagId, Pageable pageable)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> articleRepository.findByTagIdAndStatus(tagId, Article.Status.PUBLISHED, pageable)</span><br><span class="line">            .map(ArticleDTO::fromEntity);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> Page&lt;ArticleDTO&gt; <span class="title function_">getArticlesByAuthor</span><span class="params">(Long authorId, Pageable pageable)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> articleRepository.findByAuthorIdAndStatus(authorId, Article.Status.PUBLISHED, pageable)</span><br><span class="line">            .map(ArticleDTO::fromEntity);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> ArticleDTO <span class="title function_">createArticle</span><span class="params">(ArticleDTO articleDTO, Long authorId)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">author</span> <span class="operator">=</span> userRepository.findById(authorId)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">ResourceNotFoundException</span>(<span class="string">&quot;作者不存在，ID: &quot;</span> + authorId));</span><br><span class="line">        </span><br><span class="line">        <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Article</span>();</span><br><span class="line">        article.setTitle(articleDTO.getTitle());</span><br><span class="line">        article.setSummary(articleDTO.getSummary());</span><br><span class="line">        article.setContent(articleDTO.getContent());</span><br><span class="line">        article.setCoverImage(articleDTO.getCoverImage());</span><br><span class="line">        article.setStatus(Article.Status.valueOf(articleDTO.getStatus()));</span><br><span class="line">        article.setIsFeatured(articleDTO.getIsFeatured());</span><br><span class="line">        article.setAllowComment(articleDTO.getAllowComment());</span><br><span class="line">        article.setAuthor(author);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置分类</span></span><br><span class="line">        <span class="keyword">if</span> (articleDTO.getCategoryId() != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryRepository.findById(articleDTO.getCategoryId())</span><br><span class="line">                .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">ResourceNotFoundException</span>(<span class="string">&quot;分类不存在，ID: &quot;</span> + articleDTO.getCategoryId()));</span><br><span class="line">            article.setCategory(category);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置标签</span></span><br><span class="line">        <span class="keyword">if</span> (articleDTO.getTagIds() != <span class="literal">null</span> &amp;&amp; !articleDTO.getTagIds().isEmpty()) &#123;</span><br><span class="line">            Set&lt;Tag&gt; tags = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(tagRepository.findAllById(articleDTO.getTagIds()));</span><br><span class="line">            article.setTags(tags);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">Article</span> <span class="variable">savedArticle</span> <span class="operator">=</span> articleRepository.save(article);</span><br><span class="line">        log.info(<span class="string">&quot;文章创建成功: &#123;&#125;&quot;</span>, savedArticle.getTitle());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ArticleDTO.fromEntity(savedArticle);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> ArticleDTO <span class="title function_">updateArticle</span><span class="params">(Long id, ArticleDTO articleDTO, Long userId)</span> &#123;</span><br><span class="line">        <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> articleRepository.findById(id)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">ResourceNotFoundException</span>(<span class="string">&quot;文章不存在，ID: &quot;</span> + id));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查权限：只有作者或管理员可以修改</span></span><br><span class="line">        <span class="keyword">if</span> (!article.getAuthor().getId().equals(userId)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;无权修改此文章&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 更新文章信息</span></span><br><span class="line">        <span class="keyword">if</span> (articleDTO.getTitle() != <span class="literal">null</span>) &#123;</span><br><span class="line">            article.setTitle(articleDTO.getTitle());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (articleDTO.getSummary() != <span class="literal">null</span>) &#123;</span><br><span class="line">            article.setSummary(articleDTO.getSummary());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (articleDTO.getContent() != <span class="literal">null</span>) &#123;</span><br><span class="line">            article.setContent(articleDTO.getContent());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (articleDTO.getCoverImage() != <span class="literal">null</span>) &#123;</span><br><span class="line">            article.setCoverImage(articleDTO.getCoverImage());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (articleDTO.getStatus() != <span class="literal">null</span>) &#123;</span><br><span class="line">            article.setStatus(Article.Status.valueOf(articleDTO.getStatus()));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (articleDTO.getIsFeatured() != <span class="literal">null</span>) &#123;</span><br><span class="line">            article.setIsFeatured(articleDTO.getIsFeatured());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (articleDTO.getAllowComment() != <span class="literal">null</span>) &#123;</span><br><span class="line">            article.setAllowComment(articleDTO.getAllowComment());</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 更新分类</span></span><br><span class="line">        <span class="keyword">if</span> (articleDTO.getCategoryId() != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Category</span> <span class="variable">category</span> <span class="operator">=</span> categoryRepository.findById(articleDTO.getCategoryId())</span><br><span class="line">                .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">ResourceNotFoundException</span>(<span class="string">&quot;分类不存在，ID: &quot;</span> + articleDTO.getCategoryId()));</span><br><span class="line">            article.setCategory(category);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (articleDTO.getCategoryId() == <span class="literal">null</span> &amp;&amp; article.getCategory() != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 清除分类</span></span><br><span class="line">            article.setCategory(<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 更新标签</span></span><br><span class="line">        <span class="keyword">if</span> (articleDTO.getTagIds() != <span class="literal">null</span>) &#123;</span><br><span class="line">            Set&lt;Tag&gt; tags = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(tagRepository.findAllById(articleDTO.getTagIds()));</span><br><span class="line">            article.setTags(tags);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">Article</span> <span class="variable">updatedArticle</span> <span class="operator">=</span> articleRepository.save(article);</span><br><span class="line">        log.info(<span class="string">&quot;文章更新成功: &#123;&#125;&quot;</span>, updatedArticle.getTitle());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ArticleDTO.fromEntity(updatedArticle);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteArticle</span><span class="params">(Long id, Long userId)</span> &#123;</span><br><span class="line">        <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> articleRepository.findById(id)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">ResourceNotFoundException</span>(<span class="string">&quot;文章不存在，ID: &quot;</span> + id));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查权限：只有作者或管理员可以删除</span></span><br><span class="line">        <span class="keyword">if</span> (!article.getAuthor().getId().equals(userId)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;无权删除此文章&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        articleRepository.delete(article);</span><br><span class="line">        log.info(<span class="string">&quot;文章删除成功: &#123;&#125;&quot;</span>, article.getTitle());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">likeArticle</span><span class="params">(Long articleId)</span> &#123;</span><br><span class="line">        <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> articleRepository.findById(articleId)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">ResourceNotFoundException</span>(<span class="string">&quot;文章不存在，ID: &quot;</span> + articleId));</span><br><span class="line">        </span><br><span class="line">        article.setLikeCount(article.getLikeCount() + <span class="number">1</span>);</span><br><span class="line">        articleRepository.save(article);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> Page&lt;ArticleDTO&gt; <span class="title function_">getFeaturedArticles</span><span class="params">(Pageable pageable)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> articleRepository.findFeaturedArticles(pageable)</span><br><span class="line">            .map(ArticleDTO::fromEntity);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> Page&lt;ArticleDTO&gt; <span class="title function_">getPopularArticles</span><span class="params">(Pageable pageable)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> articleRepository.findPopularArticles(pageable)</span><br><span class="line">            .map(ArticleDTO::fromEntity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="7-安全配置"><a href="#7-安全配置" class="headerlink" title="7. 安全配置"></a>7. 安全配置</h3><p><strong>JwtTokenProvider.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.*;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.security.Keys;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.Authentication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.GrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtTokenProvider</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.jwt.secret&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String jwtSecret;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.jwt.expiration-ms&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> jwtExpirationMs;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> SecretKey <span class="title function_">getSigningKey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Keys.hmacShaKeyFor(jwtSecret.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generateToken</span><span class="params">(Authentication authentication)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">authorities</span> <span class="operator">=</span> authentication.getAuthorities().stream()</span><br><span class="line">            .map(GrantedAuthority::getAuthority)</span><br><span class="line">            .collect(Collectors.joining(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">Date</span> <span class="variable">expiryDate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(now + jwtExpirationMs);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> Jwts.builder()</span><br><span class="line">            .setSubject(authentication.getName())</span><br><span class="line">            .claim(<span class="string">&quot;auth&quot;</span>, authorities)</span><br><span class="line">            .setIssuedAt(<span class="keyword">new</span> <span class="title class_">Date</span>(now))</span><br><span class="line">            .setExpiration(expiryDate)</span><br><span class="line">            .signWith(getSigningKey(), SignatureAlgorithm.HS512)</span><br><span class="line">            .compact();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Authentication <span class="title function_">getAuthentication</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> Jwts.parserBuilder()</span><br><span class="line">            .setSigningKey(getSigningKey())</span><br><span class="line">            .build()</span><br><span class="line">            .parseClaimsJws(token)</span><br><span class="line">            .getBody();</span><br><span class="line">        </span><br><span class="line">        Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; authorities =</span><br><span class="line">            Arrays.stream(claims.get(<span class="string">&quot;auth&quot;</span>).toString().split(<span class="string">&quot;,&quot;</span>))</span><br><span class="line">                .map(SimpleGrantedAuthority::<span class="keyword">new</span>)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        <span class="type">User</span> <span class="variable">principal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(claims.getSubject(), <span class="string">&quot;&quot;</span>, authorities);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(principal, token, authorities);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">validateToken</span><span class="params">(String authToken)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Jwts.parserBuilder()</span><br><span class="line">                .setSigningKey(getSigningKey())</span><br><span class="line">                .build()</span><br><span class="line">                .parseClaimsJws(authToken);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SecurityException ex) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;无效的JWT签名: &#123;&#125;&quot;</span>, ex.getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MalformedJwtException ex) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;无效的JWT令牌: &#123;&#125;&quot;</span>, ex.getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ExpiredJwtException ex) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;JWT令牌已过期: &#123;&#125;&quot;</span>, ex.getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedJwtException ex) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;不支持的JWT令牌: &#123;&#125;&quot;</span>, ex.getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException ex) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;JWT claims string is empty: &#123;&#125;&quot;</span>, ex.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsernameFromToken</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Jwts.parserBuilder()</span><br><span class="line">            .setSigningKey(getSigningKey())</span><br><span class="line">            .build()</span><br><span class="line">            .parseClaimsJws(token)</span><br><span class="line">            .getBody()</span><br><span class="line">            .getSubject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>JwtAuthenticationFilter.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.Authentication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.WebAuthenticationDetailsSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.OncePerRequestFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtAuthenticationFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JwtTokenProvider tokenProvider;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, </span></span><br><span class="line"><span class="params">                                   HttpServletResponse response, </span></span><br><span class="line"><span class="params">                                   FilterChain filterChain)</span> </span><br><span class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> getJwtFromRequest(request);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (StringUtils.hasText(jwt) &amp;&amp; tokenProvider.validateToken(jwt)) &#123;</span><br><span class="line">                <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> tokenProvider.getAuthentication(jwt);</span><br><span class="line">                SecurityContextHolder.getContext().setAuthentication(authentication);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;无法设置用户认证&quot;</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        filterChain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getJwtFromRequest</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">bearerToken</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(bearerToken) &amp;&amp; bearerToken.startsWith(<span class="string">&quot;Bearer &quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> bearerToken.substring(<span class="number">7</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>SecurityConfig.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.blog.security.JwtAuthenticationFilter;</span><br><span class="line"><span class="keyword">import</span> com.blog.service.UserDetailsServiceImpl;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.AuthenticationManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.http.SessionCreationPolicy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.SecurityFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.CorsConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.CorsConfigurationSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.UrlBasedCorsConfigurationSource;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity(prePostEnabled = true)</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserDetailsServiceImpl userDetailsService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JwtAuthenticationFilter jwtAuthenticationFilter;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> AuthenticationManager <span class="title function_">authenticationManager</span><span class="params">(</span></span><br><span class="line"><span class="params">            AuthenticationConfiguration authenticationConfiguration)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> authenticationConfiguration.getAuthenticationManager();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">filterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">            .cors().and()</span><br><span class="line">            .csrf().disable()</span><br><span class="line">            .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">            .and()</span><br><span class="line">            .authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/api/auth/**&quot;</span>).permitAll()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/api/articles/public/**&quot;</span>).permitAll()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/api/comments/public/**&quot;</span>).permitAll()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/api/files/**&quot;</span>).permitAll()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/api/admin/**&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> http.build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CorsConfigurationSource <span class="title function_">corsConfigurationSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CorsConfiguration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line">        configuration.setAllowedOrigins(Arrays.asList(<span class="string">&quot;http://localhost:3000&quot;</span>, <span class="string">&quot;http://127.0.0.1:5500&quot;</span>));</span><br><span class="line">        configuration.setAllowedMethods(Arrays.asList(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;PUT&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;OPTIONS&quot;</span>));</span><br><span class="line">        configuration.setAllowedHeaders(Arrays.asList(<span class="string">&quot;*&quot;</span>));</span><br><span class="line">        configuration.setAllowCredentials(<span class="literal">true</span>);</span><br><span class="line">        configuration.setMaxAge(<span class="number">3600L</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">UrlBasedCorsConfigurationSource</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>();</span><br><span class="line">        source.registerCorsConfiguration(<span class="string">&quot;/api/**&quot;</span>, configuration);</span><br><span class="line">        <span class="keyword">return</span> source;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>UserDetailsServiceImpl.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.blog.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.blog.repository.UserRepository;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.authority.SimpleGrantedAuthority;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UsernameNotFoundException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDetailsServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userRepository.findByUsername(username)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;用户不存在: &quot;</span> + username));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!user.getIsActive()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;用户已被停用: &quot;</span> + username);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">org</span>.springframework.security.core.userdetails.User(</span><br><span class="line">            user.getUsername(),</span><br><span class="line">            user.getPasswordHash(),</span><br><span class="line">            Collections.singletonList(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;ROLE_&quot;</span> + user.getRole().name()))</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="8-Controller（控制器层）"><a href="#8-Controller（控制器层）" class="headerlink" title="8. Controller（控制器层）"></a>8. Controller（控制器层）</h3><p><strong>AuthController.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.blog.dto.AuthRequest;</span><br><span class="line"><span class="keyword">import</span> com.blog.dto.AuthResponse;</span><br><span class="line"><span class="keyword">import</span> com.blog.dto.RegisterRequest;</span><br><span class="line"><span class="keyword">import</span> com.blog.dto.UserDTO;</span><br><span class="line"><span class="keyword">import</span> com.blog.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.blog.repository.UserRepository;</span><br><span class="line"><span class="keyword">import</span> com.blog.security.JwtTokenProvider;</span><br><span class="line"><span class="keyword">import</span> com.blog.service.UserService;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.AuthenticationManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.Authentication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> javax.validation.Valid;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/auth&quot;)</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AuthenticationManager authenticationManager;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JwtTokenProvider tokenProvider;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserService userService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; authenticateUser(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> AuthRequest authRequest) &#123;</span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> authenticationManager.authenticate(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(</span><br><span class="line">                authRequest.getUsername(),</span><br><span class="line">                authRequest.getPassword()</span><br><span class="line">            )</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        SecurityContextHolder.getContext().setAuthentication(authentication);</span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> tokenProvider.generateToken(authentication);</span><br><span class="line">        </span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userRepository.findByUsername(authRequest.getUsername())</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户不存在&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDTO</span>();</span><br><span class="line">        userDTO.setId(user.getId());</span><br><span class="line">        userDTO.setUsername(user.getUsername());</span><br><span class="line">        userDTO.setEmail(user.getEmail());</span><br><span class="line">        userDTO.setDisplayName(user.getDisplayName());</span><br><span class="line">        userDTO.setAvatarUrl(user.getAvatarUrl());</span><br><span class="line">        userDTO.setRole(user.getRole().name());</span><br><span class="line">        </span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">expiryDate</span> <span class="operator">=</span> LocalDateTime.now().plusSeconds(tokenProvider.getJwtExpirationMs() / <span class="number">1000</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(<span class="keyword">new</span> <span class="title class_">AuthResponse</span>(jwt, expiryDate, userDTO));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/register&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; registerUser(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> RegisterRequest registerRequest) &#123;</span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> userService.registerUser(registerRequest);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(userDTO);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/me&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; getCurrentUser() &#123;</span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">authentication</span> <span class="operator">=</span> SecurityContextHolder.getContext().getAuthentication();</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> authentication.getName();</span><br><span class="line">        </span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userRepository.findByUsername(username)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;用户不存在&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDTO</span>();</span><br><span class="line">        userDTO.setId(user.getId());</span><br><span class="line">        userDTO.setUsername(user.getUsername());</span><br><span class="line">        userDTO.setEmail(user.getEmail());</span><br><span class="line">        userDTO.setDisplayName(user.getDisplayName());</span><br><span class="line">        userDTO.setBio(user.getBio());</span><br><span class="line">        userDTO.setAvatarUrl(user.getAvatarUrl());</span><br><span class="line">        userDTO.setRole(user.getRole().name());</span><br><span class="line">        userDTO.setCreatedAt(user.getCreatedAt());</span><br><span class="line">        userDTO.setUpdatedAt(user.getUpdatedAt());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(userDTO);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>ArticleController.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.blog.dto.ArticleDTO;</span><br><span class="line"><span class="keyword">import</span> com.blog.service.ArticleService;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Page;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.PageRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Pageable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Sort;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.access.prepost.PreAuthorize;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.annotation.AuthenticationPrincipal;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> javax.validation.Valid;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/articles&quot;)</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ArticleService articleService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/public&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; getPublishedArticles(</span><br><span class="line">            <span class="meta">@RequestParam(defaultValue = &quot;0&quot;)</span> <span class="type">int</span> page,</span><br><span class="line">            <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> <span class="type">int</span> size,</span><br><span class="line">            <span class="meta">@RequestParam(defaultValue = &quot;publishedAt&quot;)</span> String sortBy,</span><br><span class="line">            <span class="meta">@RequestParam(defaultValue = &quot;DESC&quot;)</span> String direction) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">Sort</span> <span class="variable">sort</span> <span class="operator">=</span> direction.equalsIgnoreCase(<span class="string">&quot;ASC&quot;</span>) ? </span><br><span class="line">            Sort.by(sortBy).ascending() : Sort.by(sortBy).descending();</span><br><span class="line">        <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> PageRequest.of(page, size, sort);</span><br><span class="line">        </span><br><span class="line">        Page&lt;ArticleDTO&gt; articles = articleService.getPublishedArticles(pageable);</span><br><span class="line">        </span><br><span class="line">        Map&lt;String, Object&gt; response = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        response.put(<span class="string">&quot;articles&quot;</span>, articles.getContent());</span><br><span class="line">        response.put(<span class="string">&quot;currentPage&quot;</span>, articles.getNumber());</span><br><span class="line">        response.put(<span class="string">&quot;totalItems&quot;</span>, articles.getTotalElements());</span><br><span class="line">        response.put(<span class="string">&quot;totalPages&quot;</span>, articles.getTotalPages());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/public/search&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; searchArticles(</span><br><span class="line">            <span class="meta">@RequestParam</span> String keyword,</span><br><span class="line">            <span class="meta">@RequestParam(defaultValue = &quot;0&quot;)</span> <span class="type">int</span> page,</span><br><span class="line">            <span class="meta">@RequestParam(defaultValue = &quot;10&quot;)</span> <span class="type">int</span> size) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> PageRequest.of(page, size);</span><br><span class="line">        Page&lt;ArticleDTO&gt; articles = articleService.searchPublishedArticles(keyword, pageable);</span><br><span class="line">        </span><br><span class="line">        Map&lt;String, Object&gt; response = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        response.put(<span class="string">&quot;articles&quot;</span>, articles.getContent());</span><br><span class="line">        response.put(<span class="string">&quot;currentPage&quot;</span>, articles.getNumber());</span><br><span class="line">        response.put(<span class="string">&quot;totalItems&quot;</span>, articles.getTotalElements());</span><br><span class="line">        response.put(<span class="string">&quot;totalPages&quot;</span>, articles.getTotalPages());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/public/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; getArticle(<span class="meta">@PathVariable</span> Long id) &#123;</span><br><span class="line">        <span class="type">ArticleDTO</span> <span class="variable">article</span> <span class="operator">=</span> articleService.getArticleById(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(article);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/public/featured&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; getFeaturedArticles(</span><br><span class="line">            <span class="meta">@RequestParam(defaultValue = &quot;0&quot;)</span> <span class="type">int</span> page,</span><br><span class="line">            <span class="meta">@RequestParam(defaultValue = &quot;5&quot;)</span> <span class="type">int</span> size) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> PageRequest.of(page, size);</span><br><span class="line">        Page&lt;ArticleDTO&gt; articles = articleService.getFeaturedArticles(pageable);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(articles.getContent());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/public/popular&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; getPopularArticles(</span><br><span class="line">            <span class="meta">@RequestParam(defaultValue = &quot;0&quot;)</span> <span class="type">int</span> page,</span><br><span class="line">            <span class="meta">@RequestParam(defaultValue = &quot;5&quot;)</span> <span class="type">int</span> size) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> PageRequest.of(page, size);</span><br><span class="line">        Page&lt;ArticleDTO&gt; articles = articleService.getPopularArticles(pageable);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(articles.getContent());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasRole(&#x27;USER&#x27;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; createArticle(</span><br><span class="line">            <span class="meta">@Valid</span> <span class="meta">@RequestBody</span> ArticleDTO articleDTO,</span><br><span class="line">            <span class="meta">@AuthenticationPrincipal</span> UserDetails userDetails) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 这里需要根据username获取userId，实际项目中应该从token中获取userId</span></span><br><span class="line">        <span class="comment">// 简化处理：假设userDetails包含用户信息</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> getUserIdFromUserDetails(userDetails);</span><br><span class="line">        </span><br><span class="line">        <span class="type">ArticleDTO</span> <span class="variable">createdArticle</span> <span class="operator">=</span> articleService.createArticle(articleDTO, userId);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(createdArticle);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasRole(&#x27;USER&#x27;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; updateArticle(</span><br><span class="line">            <span class="meta">@PathVariable</span> Long id,</span><br><span class="line">            <span class="meta">@Valid</span> <span class="meta">@RequestBody</span> ArticleDTO articleDTO,</span><br><span class="line">            <span class="meta">@AuthenticationPrincipal</span> UserDetails userDetails) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> getUserIdFromUserDetails(userDetails);</span><br><span class="line">        <span class="type">ArticleDTO</span> <span class="variable">updatedArticle</span> <span class="operator">=</span> articleService.updateArticle(id, articleDTO, userId);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(updatedArticle);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasRole(&#x27;USER&#x27;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; deleteArticle(</span><br><span class="line">            <span class="meta">@PathVariable</span> Long id,</span><br><span class="line">            <span class="meta">@AuthenticationPrincipal</span> UserDetails userDetails) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> getUserIdFromUserDetails(userDetails);</span><br><span class="line">        articleService.deleteArticle(id, userId);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok().build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/&#123;id&#125;/like&quot;)</span></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasRole(&#x27;USER&#x27;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; likeArticle(<span class="meta">@PathVariable</span> Long id) &#123;</span><br><span class="line">        articleService.likeArticle(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok().build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 辅助方法：从UserDetails获取userId</span></span><br><span class="line">    <span class="keyword">private</span> Long <span class="title function_">getUserIdFromUserDetails</span><span class="params">(UserDetails userDetails)</span> &#123;</span><br><span class="line">        <span class="comment">// 这里需要根据实际情况实现，例如从数据库查询</span></span><br><span class="line">        <span class="comment">// 简化处理：返回1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1L</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="9-异常处理"><a href="#9-异常处理" class="headerlink" title="9. 异常处理"></a>9. 异常处理</h3><p><strong>GlobalExceptionHandler.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.access.AccessDeniedException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.BadCredentialsException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.FieldError;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.MethodArgumentNotValidException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MaxUploadSizeExceededException;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(ResourceNotFoundException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleResourceNotFound</span><span class="params">(ResourceNotFoundException ex)</span> &#123;</span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(</span><br><span class="line">            HttpStatus.NOT_FOUND.value(),</span><br><span class="line">            <span class="string">&quot;Resource Not Found&quot;</span>,</span><br><span class="line">            ex.getMessage(),</span><br><span class="line">            LocalDateTime.now()</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(error, HttpStatus.NOT_FOUND);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(BusinessException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleBusinessException</span><span class="params">(BusinessException ex)</span> &#123;</span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(</span><br><span class="line">            HttpStatus.BAD_REQUEST.value(),</span><br><span class="line">            <span class="string">&quot;Business Error&quot;</span>,</span><br><span class="line">            ex.getMessage(),</span><br><span class="line">            LocalDateTime.now()</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(error, HttpStatus.BAD_REQUEST);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleValidationExceptions</span><span class="params">(</span></span><br><span class="line"><span class="params">            MethodArgumentNotValidException ex)</span> &#123;</span><br><span class="line">        Map&lt;String, String&gt; errors = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        ex.getBindingResult().getAllErrors().forEach((error) -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">fieldName</span> <span class="operator">=</span> ((FieldError) error).getField();</span><br><span class="line">            <span class="type">String</span> <span class="variable">errorMessage</span> <span class="operator">=</span> error.getDefaultMessage();</span><br><span class="line">            errors.put(fieldName, errorMessage);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(</span><br><span class="line">            HttpStatus.BAD_REQUEST.value(),</span><br><span class="line">            <span class="string">&quot;Validation Failed&quot;</span>,</span><br><span class="line">            errors.toString(),</span><br><span class="line">            LocalDateTime.now()</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(error, HttpStatus.BAD_REQUEST);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(BadCredentialsException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleBadCredentials</span><span class="params">(BadCredentialsException ex)</span> &#123;</span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(</span><br><span class="line">            HttpStatus.UNAUTHORIZED.value(),</span><br><span class="line">            <span class="string">&quot;Authentication Failed&quot;</span>,</span><br><span class="line">            <span class="string">&quot;用户名或密码错误&quot;</span>,</span><br><span class="line">            LocalDateTime.now()</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(error, HttpStatus.UNAUTHORIZED);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(AccessDeniedException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleAccessDenied</span><span class="params">(AccessDeniedException ex)</span> &#123;</span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(</span><br><span class="line">            HttpStatus.FORBIDDEN.value(),</span><br><span class="line">            <span class="string">&quot;Access Denied&quot;</span>,</span><br><span class="line">            <span class="string">&quot;没有访问权限&quot;</span>,</span><br><span class="line">            LocalDateTime.now()</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(error, HttpStatus.FORBIDDEN);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(MaxUploadSizeExceededException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleMaxSizeException</span><span class="params">(MaxUploadSizeExceededException ex)</span> &#123;</span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(</span><br><span class="line">            HttpStatus.BAD_REQUEST.value(),</span><br><span class="line">            <span class="string">&quot;File Too Large&quot;</span>,</span><br><span class="line">            <span class="string">&quot;文件大小超过限制&quot;</span>,</span><br><span class="line">            LocalDateTime.now()</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(error, HttpStatus.BAD_REQUEST);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleGenericException</span><span class="params">(Exception ex)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;未处理的异常&quot;</span>, ex);</span><br><span class="line">        </span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">error</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(</span><br><span class="line">            HttpStatus.INTERNAL_SERVER_ERROR.value(),</span><br><span class="line">            <span class="string">&quot;Internal Server Error&quot;</span>,</span><br><span class="line">            <span class="string">&quot;服务器内部错误&quot;</span>,</span><br><span class="line">            LocalDateTime.now()</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(error, HttpStatus.INTERNAL_SERVER_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ErrorResponse</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> status;</span><br><span class="line">    <span class="keyword">private</span> String error;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime timestamp;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ErrorResponse</span><span class="params">(<span class="type">int</span> status, String error, String message, LocalDateTime timestamp)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.status = status;</span><br><span class="line">        <span class="built_in">this</span>.error = error;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">        <span class="built_in">this</span>.timestamp = timestamp;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Getters and setters</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getStatus</span><span class="params">()</span> &#123; <span class="keyword">return</span> status; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStatus</span><span class="params">(<span class="type">int</span> status)</span> &#123; <span class="built_in">this</span>.status = status; &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getError</span><span class="params">()</span> &#123; <span class="keyword">return</span> error; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setError</span><span class="params">(String error)</span> &#123; <span class="built_in">this</span>.error = error; &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123; <span class="keyword">return</span> message; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMessage</span><span class="params">(String message)</span> &#123; <span class="built_in">this</span>.message = message; &#125;</span><br><span class="line">    <span class="keyword">public</span> LocalDateTime <span class="title function_">getTimestamp</span><span class="params">()</span> &#123; <span class="keyword">return</span> timestamp; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTimestamp</span><span class="params">(LocalDateTime timestamp)</span> &#123; <span class="built_in">this</span>.timestamp = timestamp; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="10-主应用类"><a href="#10-主应用类" class="headerlink" title="10. 主应用类"></a>10. 主应用类</h3><p><strong>BlogApplication.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.config.EnableJpaAuditing;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.CorsRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableJpaAuditing</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlogApplication</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(BlogApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurer <span class="title function_">corsConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;</span><br><span class="line">                registry.addMapping(<span class="string">&quot;/api/**&quot;</span>)</span><br><span class="line">                    .allowedOrigins(<span class="string">&quot;http://localhost:3000&quot;</span>, <span class="string">&quot;http://127.0.0.1:5500&quot;</span>)</span><br><span class="line">                    .allowedMethods(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;PUT&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;OPTIONS&quot;</span>)</span><br><span class="line">                    .allowedHeaders(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                    .allowCredentials(<span class="literal">true</span>)</span><br><span class="line">                    .maxAge(<span class="number">3600</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="第二部分：前端实现（纯HTML-CSS-JavaScript）"><a href="#第二部分：前端实现（纯HTML-CSS-JavaScript）" class="headerlink" title="第二部分：前端实现（纯HTML&#x2F;CSS&#x2F;JavaScript）"></a>第二部分：前端实现（纯HTML&#x2F;CSS&#x2F;JavaScript）</h2><h3 id="1-项目结构"><a href="#1-项目结构" class="headerlink" title="1. 项目结构"></a>1. 项目结构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">blog-frontend/</span><br><span class="line">├── index.html              # 首页</span><br><span class="line">├── article.html            # 文章详情页</span><br><span class="line">├── login.html              # 登录页</span><br><span class="line">├── register.html           # 注册页</span><br><span class="line">├── admin.html              # 管理后台</span><br><span class="line">├── css/</span><br><span class="line">│   ├── style.css          # 主样式</span><br><span class="line">│   ├── admin.css          # 管理后台样式</span><br><span class="line">│   └── article.css        # 文章样式</span><br><span class="line">├── js/</span><br><span class="line">│   ├── app.js             # 应用主文件</span><br><span class="line">│   ├── api.js             # API封装</span><br><span class="line">│   ├── auth.js            # 认证相关</span><br><span class="line">│   ├── router.js          # 前端路由</span><br><span class="line">│   ├── store.js           # 状态管理</span><br><span class="line">│   ├── components/        # 组件</span><br><span class="line">│   │   ├── header.js</span><br><span class="line">│   │   ├── footer.js</span><br><span class="line">│   │   ├── article-list.js</span><br><span class="line">│   │   ├── comment-form.js</span><br><span class="line">│   │   ├── pagination.js</span><br><span class="line">│   │   └── editor.js</span><br><span class="line">│   └── pages/             # 页面模块</span><br><span class="line">│       ├── home.js</span><br><span class="line">│       ├── article.js</span><br><span class="line">│       ├── login.js</span><br><span class="line">│       ├── register.js</span><br><span class="line">│       └── admin.js</span><br><span class="line">└── assets/</span><br><span class="line">    ├── images/</span><br><span class="line">    └── uploads/</span><br></pre></td></tr></table></figure>



<h3 id="2-核心HTML文件"><a href="#2-核心HTML文件" class="headerlink" title="2. 核心HTML文件"></a>2. 核心HTML文件</h3><p><strong>index.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>个人博客<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/style.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 顶部导航栏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span> <span class="attr">id</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;navbar&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;nav-brand&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span> <span class="attr">data-link</span>&gt;</span>我的博客<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;nav-toggle&quot;</span> <span class="attr">aria-label</span>=<span class="string">&quot;Toggle navigation&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-bars&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav-menu&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">data-link</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/categories&quot;</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">data-link</span>&gt;</span>分类<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/tags&quot;</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">data-link</span>&gt;</span>标签<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/archive&quot;</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">data-link</span>&gt;</span>归档<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;nav-item&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/about&quot;</span> <span class="attr">class</span>=<span class="string">&quot;nav-link&quot;</span> <span class="attr">data-link</span>&gt;</span>关于<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">&lt;!-- 用户相关菜单 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;user-menu&quot;</span> <span class="attr">id</span>=<span class="string">&quot;user-menu&quot;</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 动态加载用户菜单 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 主内容区域 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main-content&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 左侧内容区 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content-left&quot;</span> <span class="attr">id</span>=<span class="string">&quot;content-left&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 动态加载内容 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">&lt;!-- 右侧边栏 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sidebar&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sidebar&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 搜索框 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;widget search-widget&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;search-form&quot;</span> <span class="attr">class</span>=<span class="string">&quot;search-form&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;search-input&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;搜索文章...&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;search-btn&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-search&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">&lt;!-- 关于我 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;widget about-widget&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;widget-title&quot;</span>&gt;</span>关于我<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;about-content&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">p</span>&gt;</span>一个热爱技术的开发者，分享编程心得和项目经验。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">&lt;!-- 最新文章 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;widget recent-posts&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;widget-title&quot;</span>&gt;</span>最新文章<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;recent-posts&quot;</span> <span class="attr">class</span>=<span class="string">&quot;posts-list&quot;</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- 动态加载最新文章 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">&lt;!-- 标签云 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;widget tag-cloud&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;widget-title&quot;</span>&gt;</span>标签<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;tag-cloud&quot;</span> <span class="attr">class</span>=<span class="string">&quot;tags&quot;</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- 动态加载标签 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 页脚 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer-content&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="symbol">&amp;copy;</span> 2023 个人博客. All rights reserved.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;social-links&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;social-link&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fab fa-github&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;social-link&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fab fa-twitter&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">class</span>=<span class="string">&quot;social-link&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fab fa-weibo&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 加载提示 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;loading&quot;</span> <span class="attr">class</span>=<span class="string">&quot;loading-overlay&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;loading-spinner&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-spinner fa-spin&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>加载中...<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 模态框容器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;modal-container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span> <span class="attr">src</span>=<span class="string">&quot;js/app.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="3-主样式文件"><a href="#3-主样式文件" class="headerlink" title="3. 主样式文件"></a>3. 主样式文件</h3><p><strong>css&#x2F;style.css</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 重置和基础样式 */</span></span><br><span class="line">* &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">    <span class="attr">--primary-color</span>: <span class="number">#007bff</span>;</span><br><span class="line">    <span class="attr">--secondary-color</span>: <span class="number">#6c757d</span>;</span><br><span class="line">    <span class="attr">--success-color</span>: <span class="number">#28a745</span>;</span><br><span class="line">    <span class="attr">--danger-color</span>: <span class="number">#dc3545</span>;</span><br><span class="line">    <span class="attr">--warning-color</span>: <span class="number">#ffc107</span>;</span><br><span class="line">    <span class="attr">--info-color</span>: <span class="number">#17a2b8</span>;</span><br><span class="line">    <span class="attr">--light-color</span>: <span class="number">#f8f9fa</span>;</span><br><span class="line">    <span class="attr">--dark-color</span>: <span class="number">#343a40</span>;</span><br><span class="line">    <span class="attr">--text-color</span>: <span class="number">#333</span>;</span><br><span class="line">    <span class="attr">--text-light</span>: <span class="number">#666</span>;</span><br><span class="line">    <span class="attr">--text-lighter</span>: <span class="number">#999</span>;</span><br><span class="line">    <span class="attr">--border-color</span>: <span class="number">#dee2e6</span>;</span><br><span class="line">    <span class="attr">--bg-color</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attr">--bg-light</span>: <span class="number">#f5f5f5</span>;</span><br><span class="line">    <span class="attr">--shadow</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">8px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>);</span><br><span class="line">    <span class="attr">--radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attr">--transition</span>: all <span class="number">0.3s</span> ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: -apple-system, BlinkMacSystemFont, <span class="string">&#x27;Segoe UI&#x27;</span>, <span class="string">&#x27;PingFang SC&#x27;</span>, <span class="string">&#x27;Hiragino Sans GB&#x27;</span>, <span class="string">&#x27;Microsoft YaHei&#x27;</span>, sans-serif;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1.6</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--text-color);</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--bg-light);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--primary-color);</span><br><span class="line">    <span class="attribute">text-decoration</span>: none;</span><br><span class="line">    <span class="attribute">transition</span>: <span class="built_in">var</span>(--transition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#0056b3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ul</span>, <span class="selector-tag">ol</span> &#123;</span><br><span class="line">    <span class="attribute">list-style</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">1200px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 导航栏样式 */</span></span><br><span class="line"><span class="selector-class">.navbar</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">1rem</span> <span class="number">2rem</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--bg-color);</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="built_in">var</span>(--shadow);</span><br><span class="line">    <span class="attribute">position</span>: sticky;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">1000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav-brand</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">1.5rem</span>;</span><br><span class="line">    <span class="attribute">font-weight</span>: bold;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--dark-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav-menu</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">2rem</span>;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav-item</span> <span class="selector-class">.nav-link</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--text-color);</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.5rem</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav-item</span> <span class="selector-class">.nav-link</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--primary-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav-item</span> <span class="selector-class">.nav-link</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--primary-color);</span><br><span class="line">    <span class="attribute">transition</span>: <span class="built_in">var</span>(--transition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav-item</span> <span class="selector-class">.nav-link</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav-toggle</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">    <span class="attribute">background</span>: none;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">1.5rem</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--text-color);</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 用户菜单 */</span></span><br><span class="line"><span class="selector-class">.user-menu</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">1rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.auth-links</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">1rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user-profile</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user-avatar</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">2px</span> solid <span class="built_in">var</span>(--border-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user-avatar</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">object-fit</span>: cover;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user-dropdown</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--bg-color);</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="built_in">var</span>(--shadow);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--radius);</span><br><span class="line">    <span class="attribute">min-width</span>: <span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user-profile</span><span class="selector-pseudo">:hover</span> <span class="selector-class">.user-dropdown</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user-dropdown</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.75rem</span> <span class="number">1rem</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--text-color);</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--border-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user-dropdown</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--bg-light);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--primary-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.user-dropdown</span> <span class="selector-tag">a</span><span class="selector-pseudo">:last-child</span> &#123;</span><br><span class="line">    <span class="attribute">border-bottom</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 主内容区 */</span></span><br><span class="line"><span class="selector-class">.main-content</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: grid;</span><br><span class="line">    <span class="attribute">grid-template-columns</span>: <span class="number">2</span>fr <span class="number">1</span>fr;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">2rem</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">2rem</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 文章卡片 */</span></span><br><span class="line"><span class="selector-class">.article-card</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--bg-color);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--radius);</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="built_in">var</span>(--shadow);</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">2rem</span>;</span><br><span class="line">    <span class="attribute">transition</span>: <span class="built_in">var</span>(--transition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.article-card</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">5px</span>);</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">5px</span> <span class="number">20px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.15</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.article-header</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">1.5rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.article-title</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">1.5rem</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">0.5rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.article-title</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--dark-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.article-title</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--primary-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.article-meta</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">1rem</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--text-light);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">0.9rem</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">1rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.article-meta</span> <span class="selector-tag">i</span> &#123;</span><br><span class="line">    <span class="attribute">margin-right</span>: <span class="number">0.25rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.article-excerpt</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--text-color);</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">1rem</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1.8</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.article-footer</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">1rem</span> <span class="number">1.5rem</span>;</span><br><span class="line">    <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--border-color);</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--bg-light);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.article-tags</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">0.5rem</span>;</span><br><span class="line">    <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tag</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--light-color);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--secondary-color);</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.25rem</span> <span class="number">0.75rem</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">0.85rem</span>;</span><br><span class="line">    <span class="attribute">transition</span>: <span class="built_in">var</span>(--transition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tag</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--primary-color);</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.read-more</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--primary-color);</span><br><span class="line">    <span class="attribute">font-weight</span>: <span class="number">500</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.read-more</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#0056b3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 侧边栏 */</span></span><br><span class="line"><span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: sticky;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">100px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.widget</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--bg-color);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--radius);</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">1.5rem</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">2rem</span>;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="built_in">var</span>(--shadow);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.widget-title</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">1.1rem</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">1rem</span>;</span><br><span class="line">    <span class="attribute">padding-bottom</span>: <span class="number">0.5rem</span>;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">2px</span> solid <span class="built_in">var</span>(--primary-color);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--dark-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 搜索框 */</span></span><br><span class="line"><span class="selector-class">.search-form</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.search-input</span> &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.75rem</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--border-color);</span><br><span class="line">    <span class="attribute">border-right</span>: none;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--radius) <span class="number">0</span> <span class="number">0</span> <span class="built_in">var</span>(--radius);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">0.95rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.search-btn</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--primary-color);</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.75rem</span> <span class="number">1.25rem</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">0</span> <span class="built_in">var</span>(--radius) <span class="built_in">var</span>(--radius) <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">transition</span>: <span class="built_in">var</span>(--transition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.search-btn</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#0056b3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 最新文章列表 */</span></span><br><span class="line"><span class="selector-class">.posts-list</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">1rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.post-item</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">1rem</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.75rem</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--radius);</span><br><span class="line">    <span class="attribute">transition</span>: <span class="built_in">var</span>(--transition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.post-item</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--bg-light);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.post-thumbnail</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">60px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">60px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--radius);</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">flex-shrink</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.post-thumbnail</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">object-fit</span>: cover;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.post-info</span> <span class="selector-tag">h4</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">0.95rem</span>;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">0.25rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.post-info</span> <span class="selector-tag">h4</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--text-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.post-info</span> <span class="selector-tag">h4</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--primary-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.post-date</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">0.85rem</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--text-light);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 标签云 */</span></span><br><span class="line"><span class="selector-class">.tags</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">flex-wrap</span>: wrap;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">0.5rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tag-cloud</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--light-color);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--secondary-color);</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.5rem</span> <span class="number">1rem</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">0.9rem</span>;</span><br><span class="line">    <span class="attribute">transition</span>: <span class="built_in">var</span>(--transition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.tag-cloud</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--primary-color);</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">2px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 页脚 */</span></span><br><span class="line"><span class="selector-class">.footer</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--dark-color);</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">2rem</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">2rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.footer-content</span> &#123;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.social-links</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">1.5rem</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">1rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.social-link</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">1.5rem</span>;</span><br><span class="line">    <span class="attribute">transition</span>: <span class="built_in">var</span>(--transition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.social-link</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--primary-color);</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">3px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 加载动画 */</span></span><br><span class="line"><span class="selector-class">.loading-overlay</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.9</span>);</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">9999</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.loading-spinner</span> &#123;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.loading-spinner</span> <span class="selector-tag">i</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">3rem</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--primary-color);</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">1rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.loading-spinner</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--text-color);</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">1.1rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 分页样式 */</span></span><br><span class="line"><span class="selector-class">.pagination</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">0.5rem</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">2rem</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.page-link</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.5rem</span> <span class="number">1rem</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--border-color);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--radius);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--text-color);</span><br><span class="line">    <span class="attribute">transition</span>: <span class="built_in">var</span>(--transition);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.page-link</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--bg-light);</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">var</span>(--primary-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.page-link</span><span class="selector-class">.active</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--primary-color);</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">    <span class="attribute">border-color</span>: <span class="built_in">var</span>(--primary-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.page-link</span><span class="selector-class">.disabled</span> &#123;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: not-allowed;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 响应式设计 */</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">768px</span>) &#123;</span><br><span class="line">    <span class="selector-class">.nav-menu</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: none;</span><br><span class="line">        <span class="attribute">flex-direction</span>: column;</span><br><span class="line">        <span class="attribute">position</span>: absolute;</span><br><span class="line">        <span class="attribute">top</span>: <span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">background-color</span>: <span class="built_in">var</span>(--bg-color);</span><br><span class="line">        <span class="attribute">box-shadow</span>: <span class="built_in">var</span>(--shadow);</span><br><span class="line">        <span class="attribute">padding</span>: <span class="number">1rem</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="selector-class">.nav-menu</span><span class="selector-class">.show</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: flex;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="selector-class">.nav-toggle</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: block;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="selector-class">.main-content</span> &#123;</span><br><span class="line">        <span class="attribute">grid-template-columns</span>: <span class="number">1</span>fr;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">        <span class="attribute">order</span>: -<span class="number">1</span>;</span><br><span class="line">        <span class="attribute">position</span>: static;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-JavaScript核心模块"><a href="#4-JavaScript核心模块" class="headerlink" title="4. JavaScript核心模块"></a>4. JavaScript核心模块</h3><p><strong>js&#x2F;app.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 应用主入口文件</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Router</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./router.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Store</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./store.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Auth</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./auth.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">API</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./api.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Header</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./components/header.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Loading</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils/loading.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">store</span> = <span class="keyword">new</span> <span class="title class_">Store</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">api</span> = <span class="keyword">new</span> <span class="title function_">API</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">auth</span> = <span class="keyword">new</span> <span class="title class_">Auth</span>(<span class="variable language_">this</span>.<span class="property">store</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">router</span> = <span class="keyword">new</span> <span class="title class_">Router</span>(<span class="variable language_">this</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">loading</span> = <span class="keyword">new</span> <span class="title class_">Loading</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 全局事件监听</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">initGlobalEvents</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 检查登录状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">checkAuthStatus</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 初始化UI组件</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">initUI</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">initGlobalEvents</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 全局点击事件委托</span></span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 处理导航链接</span></span><br><span class="line">            <span class="keyword">if</span> (e.<span class="property">target</span>.<span class="title function_">matches</span>(<span class="string">&#x27;[data-link]&#x27;</span>)) &#123;</span><br><span class="line">                e.<span class="title function_">preventDefault</span>();</span><br><span class="line">                <span class="keyword">const</span> href = e.<span class="property">target</span>.<span class="title function_">getAttribute</span>(<span class="string">&#x27;href&#x27;</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">router</span>.<span class="title function_">navigate</span>(href);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 处理模态框关闭</span></span><br><span class="line">            <span class="keyword">if</span> (e.<span class="property">target</span>.<span class="title function_">matches</span>(<span class="string">&#x27;.modal-overlay, .modal-close&#x27;</span>)) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">closeModal</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 全局搜索表单提交</span></span><br><span class="line">        <span class="keyword">const</span> searchForm = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;search-form&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (searchForm) &#123;</span><br><span class="line">            searchForm.<span class="title function_">addEventListener</span>(<span class="string">&#x27;submit&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                e.<span class="title function_">preventDefault</span>();</span><br><span class="line">                <span class="keyword">const</span> keyword = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;search-input&#x27;</span>).<span class="property">value</span>;</span><br><span class="line">                <span class="keyword">if</span> (keyword.<span class="title function_">trim</span>()) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">router</span>.<span class="title function_">navigate</span>(<span class="string">`/search?q=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(keyword)&#125;</span>`</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">checkAuthStatus</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> token = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (token) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> user = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">auth</span>.<span class="title function_">getCurrentUser</span>();</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">store</span>.<span class="title function_">setState</span>(&#123; user, <span class="attr">isAuthenticated</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">updateUserMenu</span>(user);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;获取用户信息失败:&#x27;</span>, error);</span><br><span class="line">                <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">store</span>.<span class="title function_">setState</span>(&#123; <span class="attr">user</span>: <span class="literal">null</span>, <span class="attr">isAuthenticated</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">updateUserMenu</span>(<span class="params">user</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> userMenu = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;user-menu&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!userMenu) <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (user) &#123;</span><br><span class="line">            userMenu.<span class="property">innerHTML</span> = <span class="string">`</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;user-profile&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;user-avatar&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;img src=&quot;<span class="subst">$&#123;user.avatarUrl || <span class="string">&#x27;assets/images/default-avatar.png&#x27;</span>&#125;</span>&quot; alt=&quot;<span class="subst">$&#123;user.username&#125;</span>&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;user-dropdown&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;a href=&quot;/profile&quot; data-link&gt;&lt;i class=&quot;fas fa-user&quot;&gt;&lt;/i&gt; 个人资料&lt;/a&gt;</span></span><br><span class="line"><span class="string">                        &lt;a href=&quot;/dashboard&quot; data-link&gt;&lt;i class=&quot;fas fa-tachometer-alt&quot;&gt;&lt;/i&gt; 控制台&lt;/a&gt;</span></span><br><span class="line"><span class="string">                        &lt;a href=&quot;/admin&quot; data-link&gt;&lt;i class=&quot;fas fa-cog&quot;&gt;&lt;/i&gt; 管理后台&lt;/a&gt;</span></span><br><span class="line"><span class="string">                        &lt;hr&gt;</span></span><br><span class="line"><span class="string">                        &lt;a href=&quot;#&quot; id=&quot;logout&quot;&gt;&lt;i class=&quot;fas fa-sign-out-alt&quot;&gt;&lt;/i&gt; 退出登录&lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;logout&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                e.<span class="title function_">preventDefault</span>();</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">auth</span>.<span class="title function_">logout</span>();</span><br><span class="line">                <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            userMenu.<span class="property">innerHTML</span> = <span class="string">`</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;auth-links&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;/login&quot; class=&quot;btn btn-outline&quot; data-link&gt;登录&lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;/register&quot; class=&quot;btn btn-primary&quot; data-link&gt;注册&lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">initUI</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 初始化导航栏</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Header</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 初始化侧边栏</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">loadSidebarContent</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 监听store变化</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">store</span>.<span class="title function_">subscribe</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (state.<span class="property">user</span> !== <span class="variable language_">this</span>.<span class="property">lastUserState</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">updateUserMenu</span>(state.<span class="property">user</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">lastUserState</span> = state.<span class="property">user</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">loadSidebarContent</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 加载最新文章</span></span><br><span class="line">            <span class="keyword">const</span> recentPosts = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">api</span>.<span class="title function_">getArticles</span>(&#123; <span class="attr">page</span>: <span class="number">0</span>, <span class="attr">size</span>: <span class="number">5</span> &#125;);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">renderRecentPosts</span>(recentPosts.<span class="property">content</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 加载标签</span></span><br><span class="line">            <span class="keyword">const</span> tags = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">api</span>.<span class="title function_">getTags</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">renderTagCloud</span>(tags);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;加载侧边栏内容失败:&#x27;</span>, error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">renderRecentPosts</span>(<span class="params">posts</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;recent-posts&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!container) <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">        container.<span class="property">innerHTML</span> = posts.<span class="title function_">map</span>(<span class="function"><span class="params">post</span> =&gt;</span> <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;post-item&quot;&gt;</span></span><br><span class="line"><span class="string">                <span class="subst">$&#123;post.coverImage ? <span class="string">`</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                    &lt;div class=&quot;post-thumbnail&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                        &lt;img src=&quot;<span class="subst">$&#123;post.coverImage&#125;</span>&quot; alt=&quot;<span class="subst">$&#123;post.title&#125;</span>&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                    &lt;/div&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                `</span> : <span class="string">&#x27;&#x27;</span>&#125;</span></span></span><br><span class="line"><span class="string">                &lt;div class=&quot;post-info&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;h4&gt;&lt;a href=&quot;/article/<span class="subst">$&#123;post.id&#125;</span>&quot; data-link&gt;<span class="subst">$&#123;post.title&#125;</span>&lt;/a&gt;&lt;/h4&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;post-date&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;i class=&quot;far fa-calendar&quot;&gt;&lt;/i&gt; <span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>(post.createdAt).toLocaleDateString()&#125;</span></span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        `</span>).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">renderTagCloud</span>(<span class="params">tags</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;tag-cloud&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!container) <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">        container.<span class="property">innerHTML</span> = tags.<span class="title function_">map</span>(<span class="function"><span class="params">tag</span> =&gt;</span> <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;a href=&quot;/tag/<span class="subst">$&#123;tag.id&#125;</span>&quot; class=&quot;tag-cloud&quot; data-link&gt;<span class="subst">$&#123;tag.name&#125;</span>&lt;/a&gt;</span></span><br><span class="line"><span class="string">        `</span>).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">showModal</span>(<span class="params">content</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> modalContainer = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;modal-container&#x27;</span>);</span><br><span class="line">        modalContainer.<span class="property">innerHTML</span> = <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;modal-overlay&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;modal&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;button class=&quot;modal-close&quot;&gt;&lt;i class=&quot;fas fa-times&quot;&gt;&lt;/i&gt;&lt;/button&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;modal-content&quot;&gt;<span class="subst">$&#123;content&#125;</span>&lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        `</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">closeModal</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> modalContainer = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;modal-container&#x27;</span>);</span><br><span class="line">        modalContainer.<span class="property">innerHTML</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">showLoading</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">loading</span>.<span class="title function_">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">hideLoading</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">loading</span>.<span class="title function_">hide</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动应用</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">app</span> = <span class="keyword">new</span> <span class="title class_">App</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p><strong>js&#x2F;api.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// API封装层</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">API</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">baseURL</span> = <span class="string">&#x27;http://localhost:8080/api&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">defaultHeaders</span> = &#123;</span><br><span class="line">            <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">request</span>(<span class="params">endpoint, options = &#123;&#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> url = <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseURL&#125;</span><span class="subst">$&#123;endpoint&#125;</span>`</span>;</span><br><span class="line">        <span class="keyword">const</span> token = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> headers = &#123;</span><br><span class="line">            ...<span class="variable language_">this</span>.<span class="property">defaultHeaders</span>,</span><br><span class="line">            ...options.<span class="property">headers</span></span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (token) &#123;</span><br><span class="line">            headers[<span class="string">&#x27;Authorization&#x27;</span>] = <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> config = &#123;</span><br><span class="line">            ...options,</span><br><span class="line">            headers</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(url, config);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> error = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(error.<span class="property">message</span> || <span class="string">`HTTP <span class="subst">$&#123;response.status&#125;</span>`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">const</span> contentType = response.<span class="property">headers</span>.<span class="title function_">get</span>(<span class="string">&#x27;content-type&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (contentType &amp;&amp; contentType.<span class="title function_">includes</span>(<span class="string">&#x27;application/json&#x27;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">await</span> response.<span class="title function_">text</span>();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;API请求失败:&#x27;</span>, error);</span><br><span class="line">            <span class="keyword">throw</span> error;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 认证相关</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params">credentials</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="string">&#x27;/auth/login&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(credentials)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">register</span>(<span class="params">userData</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="string">&#x27;/auth/register&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(userData)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getCurrentUser</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="string">&#x27;/auth/me&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 文章相关</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getArticles</span>(<span class="params">params = &#123;&#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> query = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(params).<span class="title function_">toString</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="string">`/articles/public<span class="subst">$&#123;query ? <span class="string">&#x27;?&#x27;</span> + query : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getArticle</span>(<span class="params">id</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="string">`/articles/public/<span class="subst">$&#123;id&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">createArticle</span>(<span class="params">article</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="string">&#x27;/articles&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(article)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">updateArticle</span>(<span class="params">id, article</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="string">`/articles/<span class="subst">$&#123;id&#125;</span>`</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;PUT&#x27;</span>,</span><br><span class="line">            <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(article)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">deleteArticle</span>(<span class="params">id</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="string">`/articles/<span class="subst">$&#123;id&#125;</span>`</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;DELETE&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">likeArticle</span>(<span class="params">id</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="string">`/articles/<span class="subst">$&#123;id&#125;</span>/like`</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getFeaturedArticles</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="string">&#x27;/articles/public/featured&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getPopularArticles</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="string">&#x27;/articles/public/popular&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 评论相关</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getComments</span>(<span class="params">articleId, params = &#123;&#125;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> query = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(params).<span class="title function_">toString</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="string">`/comments/public/articles/<span class="subst">$&#123;articleId&#125;</span><span class="subst">$&#123;query ? <span class="string">&#x27;?&#x27;</span> + query : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">createComment</span>(<span class="params">articleId, comment</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="string">`/comments`</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">                ...comment,</span><br><span class="line">                articleId</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">deleteComment</span>(<span class="params">id</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="string">`/comments/<span class="subst">$&#123;id&#125;</span>`</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;DELETE&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 标签相关</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getTags</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="string">&#x27;/tags&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getTag</span>(<span class="params">id</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="string">`/tags/<span class="subst">$&#123;id&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 分类相关</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getCategories</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="string">&#x27;/categories&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getCategory</span>(<span class="params">id</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="string">`/categories/<span class="subst">$&#123;id&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 文件上传</span></span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">uploadFile</span>(<span class="params">file</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">        formData.<span class="title function_">append</span>(<span class="string">&#x27;file&#x27;</span>, file);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">request</span>(<span class="string">&#x27;/files/upload&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123;&#125;,</span><br><span class="line">            <span class="attr">body</span>: formData</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>js&#x2F;router.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 前端路由</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Router</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">app</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">app</span> = app;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">routes</span> = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">initRoutes</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">init</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">initRoutes</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 页面路由</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">routes</span>.<span class="title function_">set</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">loadPage</span>(<span class="string">&#x27;home&#x27;</span>));</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">routes</span>.<span class="title function_">set</span>(<span class="string">&#x27;/article/:id&#x27;</span>, <span class="function">(<span class="params">params</span>) =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">loadArticlePage</span>(params.<span class="property">id</span>));</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">routes</span>.<span class="title function_">set</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">loadPage</span>(<span class="string">&#x27;login&#x27;</span>));</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">routes</span>.<span class="title function_">set</span>(<span class="string">&#x27;/register&#x27;</span>, <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">loadPage</span>(<span class="string">&#x27;register&#x27;</span>));</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">routes</span>.<span class="title function_">set</span>(<span class="string">&#x27;/admin&#x27;</span>, <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">loadPage</span>(<span class="string">&#x27;admin&#x27;</span>));</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">routes</span>.<span class="title function_">set</span>(<span class="string">&#x27;/search&#x27;</span>, <span class="function">(<span class="params">_, query</span>) =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">loadSearchPage</span>(query.<span class="title function_">get</span>(<span class="string">&#x27;q&#x27;</span>)));</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">routes</span>.<span class="title function_">set</span>(<span class="string">&#x27;/tag/:id&#x27;</span>, <span class="function">(<span class="params">params</span>) =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">loadTagPage</span>(params.<span class="property">id</span>));</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">routes</span>.<span class="title function_">set</span>(<span class="string">&#x27;/category/:id&#x27;</span>, <span class="function">(<span class="params">params</span>) =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">loadCategoryPage</span>(params.<span class="property">id</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 监听popstate事件</span></span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;popstate&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">handleRoute</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 初始路由</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">handleRoute</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">navigate</span>(<span class="params">path</span>) &#123;</span><br><span class="line">        history.<span class="title function_">pushState</span>(&#123;&#125;, <span class="string">&#x27;&#x27;</span>, path);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">handleRoute</span>(path);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">handleRoute</span>(<span class="params">path</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> url = <span class="keyword">new</span> <span class="title function_">URL</span>(path, <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">origin</span>);</span><br><span class="line">        <span class="keyword">const</span> pathname = url.<span class="property">pathname</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 解析路径参数</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> [route, handler] <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">routes</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> params = <span class="variable language_">this</span>.<span class="title function_">matchRoute</span>(route, pathname);</span><br><span class="line">            <span class="keyword">if</span> (params !== <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">app</span>.<span class="title function_">showLoading</span>();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">await</span> <span class="title function_">handler</span>(params, url.<span class="property">searchParams</span>);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">app</span>.<span class="title function_">hideLoading</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 未匹配的路由</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">loadPage</span>(<span class="string">&#x27;404&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">matchRoute</span>(<span class="params">route, pathname</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> routeParts = route.<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> pathParts = pathname.<span class="title function_">split</span>(<span class="string">&#x27;/&#x27;</span>).<span class="title function_">filter</span>(<span class="function"><span class="params">p</span> =&gt;</span> p);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (routeParts.<span class="property">length</span> !== pathParts.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> params = &#123;&#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; routeParts.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">const</span> routePart = routeParts[i];</span><br><span class="line">            <span class="keyword">const</span> pathPart = pathParts[i];</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (routePart.<span class="title function_">startsWith</span>(<span class="string">&#x27;:&#x27;</span>)) &#123;</span><br><span class="line">                <span class="keyword">const</span> paramName = routePart.<span class="title function_">slice</span>(<span class="number">1</span>);</span><br><span class="line">                params[paramName] = pathPart;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (routePart !== pathPart) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> params;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">loadPage</span>(<span class="params">pageName</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> <span class="variable language_">module</span> = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">`./pages/<span class="subst">$&#123;pageName&#125;</span>.js`</span>);</span><br><span class="line">            <span class="keyword">const</span> content = <span class="keyword">await</span> <span class="variable language_">module</span>.<span class="title function_">render</span>(<span class="variable language_">this</span>.<span class="property">app</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">updateContent</span>(content);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`加载页面 <span class="subst">$&#123;pageName&#125;</span> 失败:`</span>, error);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">loadPage</span>(<span class="string">&#x27;404&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">loadArticlePage</span>(<span class="params">articleId</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> <span class="variable language_">module</span> = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">&#x27;./pages/article.js&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> content = <span class="keyword">await</span> <span class="variable language_">module</span>.<span class="title function_">render</span>(<span class="variable language_">this</span>.<span class="property">app</span>, articleId);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">updateContent</span>(content);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;加载文章页面失败:&#x27;</span>, error);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">loadPage</span>(<span class="string">&#x27;404&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">loadSearchPage</span>(<span class="params">keyword</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> <span class="variable language_">module</span> = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">&#x27;./pages/search.js&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> content = <span class="keyword">await</span> <span class="variable language_">module</span>.<span class="title function_">render</span>(<span class="variable language_">this</span>.<span class="property">app</span>, keyword);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">updateContent</span>(content);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;加载搜索页面失败:&#x27;</span>, error);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">loadPage</span>(<span class="string">&#x27;404&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">loadTagPage</span>(<span class="params">tagId</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> <span class="variable language_">module</span> = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">&#x27;./pages/tag.js&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> content = <span class="keyword">await</span> <span class="variable language_">module</span>.<span class="title function_">render</span>(<span class="variable language_">this</span>.<span class="property">app</span>, tagId);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">updateContent</span>(content);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;加载标签页面失败:&#x27;</span>, error);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">loadPage</span>(<span class="string">&#x27;404&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">loadCategoryPage</span>(<span class="params">categoryId</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> <span class="variable language_">module</span> = <span class="keyword">await</span> <span class="keyword">import</span>(<span class="string">&#x27;./pages/category.js&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> content = <span class="keyword">await</span> <span class="variable language_">module</span>.<span class="title function_">render</span>(<span class="variable language_">this</span>.<span class="property">app</span>, categoryId);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">updateContent</span>(content);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;加载分类页面失败:&#x27;</span>, error);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">loadPage</span>(<span class="string">&#x27;404&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">updateContent</span>(<span class="params">content</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;content-left&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (container) &#123;</span><br><span class="line">            container.<span class="property">innerHTML</span> = content;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>js&#x2F;store.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 状态管理</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Store</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">            <span class="attr">user</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">isAuthenticated</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">articles</span>: [],</span><br><span class="line">            <span class="attr">currentArticle</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">comments</span>: [],</span><br><span class="line">            <span class="attr">tags</span>: [],</span><br><span class="line">            <span class="attr">categories</span>: []</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">listeners</span> = [];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">getState</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">setState</span>(<span class="params">newState</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123; ...<span class="variable language_">this</span>.<span class="property">state</span>, ...newState &#125;;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">notify</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">subscribe</span>(<span class="params">listener</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">push</span>(listener);</span><br><span class="line">        <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> index = <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">indexOf</span>(listener);</span><br><span class="line">            <span class="keyword">if</span> (index &gt; -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">listener</span> =&gt;</span> <span class="title function_">listener</span>(<span class="variable language_">this</span>.<span class="property">state</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>js&#x2F;auth.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 认证管理</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">Auth</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">store</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">store</span> = store;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">api</span> = <span class="keyword">new</span> <span class="title function_">API</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">login</span>(<span class="params">credentials</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">api</span>.<span class="title function_">login</span>(credentials);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 保存token</span></span><br><span class="line">            <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;token&#x27;</span>, response.<span class="property">accessToken</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 更新store状态</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">store</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">                <span class="attr">user</span>: response.<span class="property">user</span>,</span><br><span class="line">                <span class="attr">isAuthenticated</span>: <span class="literal">true</span></span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> response.<span class="property">user</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;登录失败:&#x27;</span>, error);</span><br><span class="line">            <span class="keyword">throw</span> error;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">register</span>(<span class="params">userData</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> user = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">api</span>.<span class="title function_">register</span>(userData);</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;注册失败:&#x27;</span>, error);</span><br><span class="line">            <span class="keyword">throw</span> error;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">getCurrentUser</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> user = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">api</span>.<span class="title function_">getCurrentUser</span>();</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;获取用户信息失败:&#x27;</span>, error);</span><br><span class="line">            <span class="keyword">throw</span> error;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">logout</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">store</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">            <span class="attr">user</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">isAuthenticated</span>: <span class="literal">false</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">isAuthenticated</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> token = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> !!token;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">getToken</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5-页面模块"><a href="#5-页面模块" class="headerlink" title="5. 页面模块"></a>5. 页面模块</h3><p><strong>js&#x2F;pages&#x2F;home.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 首页</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ArticleList</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../components/article-list.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Pagination</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../components/pagination.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">app</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> articles = <span class="keyword">await</span> app.<span class="property">api</span>.<span class="title function_">getArticles</span>(&#123; <span class="attr">page</span>: <span class="number">0</span>, <span class="attr">size</span>: <span class="number">10</span> &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;home-page&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;page-header&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;h1&gt;最新文章&lt;/h1&gt;</span></span><br><span class="line"><span class="string">                &lt;p&gt;分享编程心得和技术经验&lt;/p&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            &lt;div id=&quot;articles-container&quot;&gt;</span></span><br><span class="line"><span class="string">                <span class="subst">$&#123;ArticleList.render(articles.content)&#125;</span></span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            &lt;div id=&quot;pagination-container&quot;&gt;</span></span><br><span class="line"><span class="string">                <span class="subst">$&#123;Pagination.render(&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">                    currentPage: articles.number,</span></span></span><br><span class="line"><span class="subst"><span class="string">                    totalPages: articles.totalPages,</span></span></span><br><span class="line"><span class="subst"><span class="string">                    totalItems: articles.totalElements</span></span></span><br><span class="line"><span class="subst"><span class="string">                &#125;)&#125;</span></span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">init</span>(<span class="params">app</span>) &#123;</span><br><span class="line">    <span class="comment">// 初始化分页</span></span><br><span class="line">    <span class="keyword">const</span> pagination = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;pagination-container&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (pagination) &#123;</span><br><span class="line">        pagination.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">async</span> (e) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (e.<span class="property">target</span>.<span class="title function_">matches</span>(<span class="string">&#x27;.page-link&#x27;</span>)) &#123;</span><br><span class="line">                e.<span class="title function_">preventDefault</span>();</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">const</span> page = <span class="built_in">parseInt</span>(e.<span class="property">target</span>.<span class="property">dataset</span>.<span class="property">page</span>);</span><br><span class="line">                <span class="keyword">if</span> (!<span class="built_in">isNaN</span>(page)) &#123;</span><br><span class="line">                    app.<span class="title function_">showLoading</span>();</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">const</span> articles = <span class="keyword">await</span> app.<span class="property">api</span>.<span class="title function_">getArticles</span>(&#123; page, <span class="attr">size</span>: <span class="number">10</span> &#125;);</span><br><span class="line">                        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;articles-container&#x27;</span>).<span class="property">innerHTML</span> = </span><br><span class="line">                            <span class="title class_">ArticleList</span>.<span class="title function_">render</span>(articles.<span class="property">content</span>);</span><br><span class="line">                        </span><br><span class="line">                        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;pagination-container&#x27;</span>).<span class="property">innerHTML</span> = </span><br><span class="line">                            <span class="title class_">Pagination</span>.<span class="title function_">render</span>(&#123;</span><br><span class="line">                                <span class="attr">currentPage</span>: articles.<span class="property">number</span>,</span><br><span class="line">                                <span class="attr">totalPages</span>: articles.<span class="property">totalPages</span>,</span><br><span class="line">                                <span class="attr">totalItems</span>: articles.<span class="property">totalElements</span></span><br><span class="line">                            &#125;);</span><br><span class="line">                    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                        app.<span class="title function_">hideLoading</span>();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>js&#x2F;pages&#x2F;article.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文章详情页</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">CommentForm</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../components/comment-form.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">CommentList</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../components/comment-list.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">app, articleId</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> article = <span class="keyword">await</span> app.<span class="property">api</span>.<span class="title function_">getArticle</span>(articleId);</span><br><span class="line">        <span class="keyword">const</span> comments = <span class="keyword">await</span> app.<span class="property">api</span>.<span class="title function_">getComments</span>(articleId);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;article class=&quot;article-detail&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;header class=&quot;article-header&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;h1 class=&quot;article-title&quot;&gt;<span class="subst">$&#123;article.title&#125;</span>&lt;/h1&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;article-meta&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;span class=&quot;meta-item&quot;&gt;</span></span><br><span class="line"><span class="string">                            &lt;i class=&quot;far fa-user&quot;&gt;&lt;/i&gt; <span class="subst">$&#123;article.author.displayName&#125;</span></span></span><br><span class="line"><span class="string">                        &lt;/span&gt;</span></span><br><span class="line"><span class="string">                        &lt;span class=&quot;meta-item&quot;&gt;</span></span><br><span class="line"><span class="string">                            &lt;i class=&quot;far fa-calendar&quot;&gt;&lt;/i&gt; <span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>(article.publishedAt).toLocaleDateString()&#125;</span></span></span><br><span class="line"><span class="string">                        &lt;/span&gt;</span></span><br><span class="line"><span class="string">                        &lt;span class=&quot;meta-item&quot;&gt;</span></span><br><span class="line"><span class="string">                            &lt;i class=&quot;far fa-eye&quot;&gt;&lt;/i&gt; <span class="subst">$&#123;article.viewCount&#125;</span> 阅读</span></span><br><span class="line"><span class="string">                        &lt;/span&gt;</span></span><br><span class="line"><span class="string">                        &lt;span class=&quot;meta-item&quot;&gt;</span></span><br><span class="line"><span class="string">                            &lt;i class=&quot;far fa-comment&quot;&gt;&lt;/i&gt; <span class="subst">$&#123;article.commentCount&#125;</span> 评论</span></span><br><span class="line"><span class="string">                        &lt;/span&gt;</span></span><br><span class="line"><span class="string">                        &lt;span class=&quot;meta-item&quot;&gt;</span></span><br><span class="line"><span class="string">                            &lt;i class=&quot;far fa-heart&quot;&gt;&lt;/i&gt; <span class="subst">$&#123;article.likeCount&#125;</span> 喜欢</span></span><br><span class="line"><span class="string">                        &lt;/span&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/header&gt;</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                <span class="subst">$&#123;article.coverImage ? <span class="string">`</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                    &lt;div class=&quot;article-cover&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                        &lt;img src=&quot;<span class="subst">$&#123;article.coverImage&#125;</span>&quot; alt=&quot;<span class="subst">$&#123;article.title&#125;</span>&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                    &lt;/div&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                `</span> : <span class="string">&#x27;&#x27;</span>&#125;</span></span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                &lt;div class=&quot;article-content&quot;&gt;</span></span><br><span class="line"><span class="string">                    <span class="subst">$&#123;article.content&#125;</span></span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                &lt;footer class=&quot;article-footer&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;article-tags&quot;&gt;</span></span><br><span class="line"><span class="string">                        <span class="subst">$&#123;article.tags.map(tag =&gt; <span class="string">`</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                            &lt;a href=&quot;/tag/<span class="subst">$&#123;tag.id&#125;</span>&quot; class=&quot;tag&quot; data-link&gt;#<span class="subst">$&#123;tag.name&#125;</span>&lt;/a&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                        `</span>).join(<span class="string">&#x27;&#x27;</span>)&#125;</span></span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    </span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;article-actions&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;button class=&quot;btn btn-outline&quot; id=&quot;like-btn&quot;&gt;</span></span><br><span class="line"><span class="string">                            &lt;i class=&quot;far fa-heart&quot;&gt;&lt;/i&gt; 喜欢 (<span class="subst">$&#123;article.likeCount&#125;</span>)</span></span><br><span class="line"><span class="string">                        &lt;/button&gt;</span></span><br><span class="line"><span class="string">                        &lt;button class=&quot;btn btn-outline&quot; id=&quot;share-btn&quot;&gt;</span></span><br><span class="line"><span class="string">                            &lt;i class=&quot;fas fa-share-alt&quot;&gt;&lt;/i&gt; 分享</span></span><br><span class="line"><span class="string">                        &lt;/button&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/footer&gt;</span></span><br><span class="line"><span class="string">            &lt;/article&gt;</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            &lt;div class=&quot;comments-section&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;h3 class=&quot;comments-title&quot;&gt;评论 (<span class="subst">$&#123;article.commentCount&#125;</span>)&lt;/h3&gt;</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                <span class="subst">$&#123;article.allowComment ? CommentForm.render(articleId) : <span class="string">`</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                    &lt;div class=&quot;alert alert-info&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                        &lt;i class=&quot;fas fa-info-circle&quot;&gt;&lt;/i&gt; 评论功能已关闭</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                    &lt;/div&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                `</span>&#125;</span></span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                &lt;div id=&quot;comments-list&quot;&gt;</span></span><br><span class="line"><span class="string">                    <span class="subst">$&#123;CommentList.render(comments)&#125;</span></span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        `</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;加载文章失败:&#x27;</span>, error);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;error-container&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;h2&gt;文章加载失败&lt;/h2&gt;</span></span><br><span class="line"><span class="string">                &lt;p&gt;<span class="subst">$&#123;error.message&#125;</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;a href=&quot;/&quot; class=&quot;btn btn-primary&quot; data-link&gt;返回首页&lt;/a&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        `</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">init</span>(<span class="params">app, articleId</span>) &#123;</span><br><span class="line">    <span class="comment">// 点赞功能</span></span><br><span class="line">    <span class="keyword">const</span> likeBtn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;like-btn&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (likeBtn) &#123;</span><br><span class="line">        likeBtn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (!app.<span class="property">store</span>.<span class="property">state</span>.<span class="property">isAuthenticated</span>) &#123;</span><br><span class="line">                app.<span class="title function_">showModal</span>(<span class="string">`</span></span><br><span class="line"><span class="string">                    &lt;h3&gt;需要登录&lt;/h3&gt;</span></span><br><span class="line"><span class="string">                    &lt;p&gt;请登录后再点赞&lt;/p&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;modal-actions&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;a href=&quot;/login&quot; class=&quot;btn btn-primary&quot; data-link&gt;去登录&lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                `</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">await</span> app.<span class="property">api</span>.<span class="title function_">likeArticle</span>(articleId);</span><br><span class="line">                <span class="keyword">const</span> count = <span class="built_in">parseInt</span>(likeBtn.<span class="title function_">querySelector</span>(<span class="string">&#x27;i&#x27;</span>).<span class="property">nextSibling</span>.<span class="property">textContent</span>.<span class="title function_">match</span>(<span class="regexp">/\d+/</span>)[<span class="number">0</span>]);</span><br><span class="line">                likeBtn.<span class="property">innerHTML</span> = <span class="string">`&lt;i class=&quot;far fa-heart&quot;&gt;&lt;/i&gt; 喜欢 (<span class="subst">$&#123;count + <span class="number">1</span>&#125;</span>)`</span>;</span><br><span class="line">                likeBtn.<span class="property">disabled</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;点赞失败:&#x27;</span>, error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 评论表单</span></span><br><span class="line">    <span class="keyword">const</span> commentForm = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;comment-form&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (commentForm) &#123;</span><br><span class="line">        commentForm.<span class="title function_">addEventListener</span>(<span class="string">&#x27;submit&#x27;</span>, <span class="keyword">async</span> (e) =&gt; &#123;</span><br><span class="line">            e.<span class="title function_">preventDefault</span>();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (!app.<span class="property">store</span>.<span class="property">state</span>.<span class="property">isAuthenticated</span>) &#123;</span><br><span class="line">                app.<span class="title function_">showModal</span>(<span class="string">`</span></span><br><span class="line"><span class="string">                    &lt;h3&gt;需要登录&lt;/h3&gt;</span></span><br><span class="line"><span class="string">                    &lt;p&gt;请登录后再评论&lt;/p&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;modal-actions&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;a href=&quot;/login&quot; class=&quot;btn btn-primary&quot; data-link&gt;去登录&lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                `</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">const</span> content = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;comment-content&#x27;</span>).<span class="property">value</span>.<span class="title function_">trim</span>();</span><br><span class="line">            <span class="keyword">if</span> (!content) &#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&#x27;请输入评论内容&#x27;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> comment = <span class="keyword">await</span> app.<span class="property">api</span>.<span class="title function_">createComment</span>(articleId, &#123; content &#125;);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 添加新评论到列表</span></span><br><span class="line">                <span class="keyword">const</span> commentsList = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;comments-list&#x27;</span>);</span><br><span class="line">                commentsList.<span class="property">innerHTML</span> = <span class="title class_">CommentList</span>.<span class="title function_">render</span>([comment, ...<span class="title class_">JSON</span>.<span class="title function_">parse</span>(commentsList.<span class="property">dataset</span>.<span class="property">comments</span> || <span class="string">&#x27;[]&#x27;</span>)]);</span><br><span class="line">                commentsList.<span class="property">dataset</span>.<span class="property">comments</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>([comment, ...<span class="title class_">JSON</span>.<span class="title function_">parse</span>(commentsList.<span class="property">dataset</span>.<span class="property">comments</span> || <span class="string">&#x27;[]&#x27;</span>)]);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 清空表单</span></span><br><span class="line">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;comment-content&#x27;</span>).<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 更新评论计数</span></span><br><span class="line">                <span class="keyword">const</span> commentsTitle = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.comments-title&#x27;</span>);</span><br><span class="line">                <span class="keyword">if</span> (commentsTitle) &#123;</span><br><span class="line">                    <span class="keyword">const</span> count = <span class="built_in">parseInt</span>(commentsTitle.<span class="property">textContent</span>.<span class="title function_">match</span>(<span class="regexp">/\d+/</span>)[<span class="number">0</span>]);</span><br><span class="line">                    commentsTitle.<span class="property">textContent</span> = <span class="string">`评论 (<span class="subst">$&#123;count + <span class="number">1</span>&#125;</span>)`</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;发表评论失败:&#x27;</span>, error);</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&#x27;评论发表失败，请稍后重试&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>js&#x2F;pages&#x2F;login.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 登录页</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">render</span>(<span class="params">app</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;auth-page&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;auth-card&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;h2&gt;登录&lt;/h2&gt;</span></span><br><span class="line"><span class="string">                &lt;form id=&quot;login-form&quot; class=&quot;auth-form&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;form-group&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;label for=&quot;username&quot;&gt;用户名&lt;/label&gt;</span></span><br><span class="line"><span class="string">                        &lt;input type=&quot;text&quot; id=&quot;username&quot; name=&quot;username&quot; required </span></span><br><span class="line"><span class="string">                               placeholder=&quot;请输入用户名&quot; autocomplete=&quot;username&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class=&quot;form-error&quot; id=&quot;username-error&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    </span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;form-group&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;label for=&quot;password&quot;&gt;密码&lt;/label&gt;</span></span><br><span class="line"><span class="string">                        &lt;input type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot; required </span></span><br><span class="line"><span class="string">                               placeholder=&quot;请输入密码&quot; autocomplete=&quot;current-password&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class=&quot;form-error&quot; id=&quot;password-error&quot;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    </span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;form-group form-check&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;input type=&quot;checkbox&quot; id=&quot;remember-me&quot; name=&quot;remember&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;label for=&quot;remember-me&quot;&gt;记住我&lt;/label&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    </span></span><br><span class="line"><span class="string">                    &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary btn-block&quot;&gt;登录&lt;/button&gt;</span></span><br><span class="line"><span class="string">                    </span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;auth-footer&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;p&gt;还没有账号？ &lt;a href=&quot;/register&quot; data-link&gt;立即注册&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">                        &lt;p&gt;&lt;a href=&quot;/forgot-password&quot; data-link&gt;忘记密码？&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/form&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">init</span>(<span class="params">app</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> form = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;login-form&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    form.<span class="title function_">addEventListener</span>(<span class="string">&#x27;submit&#x27;</span>, <span class="keyword">async</span> (e) =&gt; &#123;</span><br><span class="line">        e.<span class="title function_">preventDefault</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 清除错误信息</span></span><br><span class="line">        <span class="title function_">clearErrors</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取表单数据</span></span><br><span class="line">        <span class="keyword">const</span> credentials = &#123;</span><br><span class="line">            <span class="attr">username</span>: <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;username&#x27;</span>).<span class="property">value</span>,</span><br><span class="line">            <span class="attr">password</span>: <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;password&#x27;</span>).<span class="property">value</span></span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证输入</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_">validateForm</span>(credentials)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 显示加载状态</span></span><br><span class="line">        <span class="keyword">const</span> submitBtn = form.<span class="title function_">querySelector</span>(<span class="string">&#x27;button[type=&quot;submit&quot;]&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> originalText = submitBtn.<span class="property">textContent</span>;</span><br><span class="line">        submitBtn.<span class="property">innerHTML</span> = <span class="string">&#x27;&lt;i class=&quot;fas fa-spinner fa-spin&quot;&gt;&lt;/i&gt; 登录中...&#x27;</span>;</span><br><span class="line">        submitBtn.<span class="property">disabled</span> = <span class="literal">true</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> user = <span class="keyword">await</span> app.<span class="property">auth</span>.<span class="title function_">login</span>(credentials);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 登录成功，重定向到首页或上一页</span></span><br><span class="line">            <span class="keyword">const</span> redirectTo = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>).<span class="title function_">get</span>(<span class="string">&#x27;redirect&#x27;</span>) || <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">            app.<span class="property">router</span>.<span class="title function_">navigate</span>(redirectTo);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="comment">// 显示错误信息</span></span><br><span class="line">            <span class="keyword">if</span> (error.<span class="property">message</span>.<span class="title function_">includes</span>(<span class="string">&#x27;用户名&#x27;</span>) || error.<span class="property">message</span>.<span class="title function_">includes</span>(<span class="string">&#x27;密码&#x27;</span>)) &#123;</span><br><span class="line">                <span class="title function_">showError</span>(<span class="string">&#x27;password-error&#x27;</span>, <span class="string">&#x27;用户名或密码错误&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="title function_">showError</span>(<span class="string">&#x27;username-error&#x27;</span>, <span class="string">&#x27;登录失败，请稍后重试&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 恢复按钮状态</span></span><br><span class="line">            submitBtn.<span class="property">textContent</span> = originalText;</span><br><span class="line">            submitBtn.<span class="property">disabled</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">validateForm</span>(<span class="params">credentials</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> isValid = <span class="literal">true</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!credentials.<span class="property">username</span>.<span class="title function_">trim</span>()) &#123;</span><br><span class="line">            <span class="title function_">showError</span>(<span class="string">&#x27;username-error&#x27;</span>, <span class="string">&#x27;请输入用户名&#x27;</span>);</span><br><span class="line">            isValid = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!credentials.<span class="property">password</span>) &#123;</span><br><span class="line">            <span class="title function_">showError</span>(<span class="string">&#x27;password-error&#x27;</span>, <span class="string">&#x27;请输入密码&#x27;</span>);</span><br><span class="line">            isValid = <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (credentials.<span class="property">password</span>.<span class="property">length</span> &lt; <span class="number">6</span>) &#123;</span><br><span class="line">            <span class="title function_">showError</span>(<span class="string">&#x27;password-error&#x27;</span>, <span class="string">&#x27;密码长度至少6位&#x27;</span>);</span><br><span class="line">            isValid = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> isValid;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">showError</span>(<span class="params">elementId, message</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> element = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(elementId);</span><br><span class="line">        <span class="keyword">if</span> (element) &#123;</span><br><span class="line">            element.<span class="property">textContent</span> = message;</span><br><span class="line">            element.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;block&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">clearErrors</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> errorElements = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.form-error&#x27;</span>);</span><br><span class="line">        errorElements.<span class="title function_">forEach</span>(<span class="function"><span class="params">el</span> =&gt;</span> &#123;</span><br><span class="line">            el.<span class="property">textContent</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            el.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="6-组件"><a href="#6-组件" class="headerlink" title="6. 组件"></a>6. 组件</h3><p><strong>js&#x2F;components&#x2F;article-list.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文章列表组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ArticleList</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">render</span>(<span class="params">articles</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!articles || articles.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;empty-state&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;i class=&quot;far fa-newspaper&quot;&gt;&lt;/i&gt;</span></span><br><span class="line"><span class="string">                    &lt;h3&gt;暂无文章&lt;/h3&gt;</span></span><br><span class="line"><span class="string">                    &lt;p&gt;还没有发布任何文章&lt;/p&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> articles.<span class="title function_">map</span>(<span class="function"><span class="params">article</span> =&gt;</span> <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;article class=&quot;article-card&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;header class=&quot;article-header&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;h2 class=&quot;article-title&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;a href=&quot;/article/<span class="subst">$&#123;article.id&#125;</span>&quot; data-link&gt;<span class="subst">$&#123;article.title&#125;</span>&lt;/a&gt;</span></span><br><span class="line"><span class="string">                    &lt;/h2&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;article-meta&quot;&gt;</span></span><br><span class="line"><span class="string">                        &lt;span class=&quot;meta-item&quot;&gt;</span></span><br><span class="line"><span class="string">                            &lt;i class=&quot;far fa-user&quot;&gt;&lt;/i&gt; <span class="subst">$&#123;article.author.displayName&#125;</span></span></span><br><span class="line"><span class="string">                        &lt;/span&gt;</span></span><br><span class="line"><span class="string">                        &lt;span class=&quot;meta-item&quot;&gt;</span></span><br><span class="line"><span class="string">                            &lt;i class=&quot;far fa-calendar&quot;&gt;&lt;/i&gt; <span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>(article.publishedAt).toLocaleDateString()&#125;</span></span></span><br><span class="line"><span class="string">                        &lt;/span&gt;</span></span><br><span class="line"><span class="string">                        &lt;span class=&quot;meta-item&quot;&gt;</span></span><br><span class="line"><span class="string">                            &lt;i class=&quot;far fa-eye&quot;&gt;&lt;/i&gt; <span class="subst">$&#123;article.viewCount&#125;</span> 阅读</span></span><br><span class="line"><span class="string">                        &lt;/span&gt;</span></span><br><span class="line"><span class="string">                        &lt;span class=&quot;meta-item&quot;&gt;</span></span><br><span class="line"><span class="string">                            &lt;i class=&quot;far fa-comment&quot;&gt;&lt;/i&gt; <span class="subst">$&#123;article.commentCount&#125;</span> 评论</span></span><br><span class="line"><span class="string">                        &lt;/span&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/header&gt;</span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                <span class="subst">$&#123;article.summary ? <span class="string">`</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                    &lt;div class=&quot;article-excerpt&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                        &lt;p&gt;<span class="subst">$&#123;article.summary&#125;</span>&lt;/p&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                    &lt;/div&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                `</span> : <span class="string">&#x27;&#x27;</span>&#125;</span></span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                &lt;footer class=&quot;article-footer&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;article-tags&quot;&gt;</span></span><br><span class="line"><span class="string">                        <span class="subst">$&#123;article.tags.map(tag =&gt; <span class="string">`</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                            &lt;a href=&quot;/tag/<span class="subst">$&#123;tag.id&#125;</span>&quot; class=&quot;tag&quot; data-link&gt;<span class="subst">$&#123;tag.name&#125;</span>&lt;/a&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="string">                        `</span>).join(<span class="string">&#x27;&#x27;</span>)&#125;</span></span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;a href=&quot;/article/<span class="subst">$&#123;article.id&#125;</span>&quot; class=&quot;read-more&quot; data-link&gt;</span></span><br><span class="line"><span class="string">                        阅读全文 &lt;i class=&quot;fas fa-arrow-right&quot;&gt;&lt;/i&gt;</span></span><br><span class="line"><span class="string">                    &lt;/a&gt;</span></span><br><span class="line"><span class="string">                &lt;/footer&gt;</span></span><br><span class="line"><span class="string">            &lt;/article&gt;</span></span><br><span class="line"><span class="string">        `</span>).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>js&#x2F;components&#x2F;comment-form.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 评论表单组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">CommentForm</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="title function_">render</span>(<span class="params">articleId</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;form id=&quot;comment-form&quot; class=&quot;comment-form&quot; data-article-id=&quot;<span class="subst">$&#123;articleId&#125;</span>&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;form-group&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;textarea id=&quot;comment-content&quot; class=&quot;form-control&quot; </span></span><br><span class="line"><span class="string">                              placeholder=&quot;写下你的评论...&quot; rows=&quot;4&quot; required&gt;&lt;/textarea&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;form-group&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;发表评论&lt;/button&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/form&gt;</span></span><br><span class="line"><span class="string">        `</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="第三部分：数据库脚本"><a href="#第三部分：数据库脚本" class="headerlink" title="第三部分：数据库脚本"></a>第三部分：数据库脚本</h2><p><strong>blog_db.sql</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> blog_db <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci;</span><br><span class="line">USE blog_db;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 用户表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> users (</span><br><span class="line">    id <span class="type">BIGINT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">    password_hash <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    display_name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    bio TEXT,</span><br><span class="line">    avatar_url <span class="type">VARCHAR</span>(<span class="number">500</span>),</span><br><span class="line">    role <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;USER&#x27;</span>,</span><br><span class="line">    is_active <span class="type">BOOLEAN</span> <span class="keyword">DEFAULT</span> <span class="literal">TRUE</span>,</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    updated_at <span class="type">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    INDEX idx_username (username),</span><br><span class="line">    INDEX idx_email (email),</span><br><span class="line">    INDEX idx_created_at (created_at)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 文章表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> articles (</span><br><span class="line">    id <span class="type">BIGINT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">    title <span class="type">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    summary TEXT,</span><br><span class="line">    content LONGTEXT <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    cover_image <span class="type">VARCHAR</span>(<span class="number">500</span>),</span><br><span class="line">    status <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;DRAFT&#x27;</span>,</span><br><span class="line">    view_count <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    like_count <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    comment_count <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    is_featured <span class="type">BOOLEAN</span> <span class="keyword">DEFAULT</span> <span class="literal">FALSE</span>,</span><br><span class="line">    allow_comment <span class="type">BOOLEAN</span> <span class="keyword">DEFAULT</span> <span class="literal">TRUE</span>,</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    updated_at <span class="type">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    published_at <span class="type">TIMESTAMP</span> <span class="keyword">NULL</span>,</span><br><span class="line">    author_id <span class="type">BIGINT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    category_id <span class="type">BIGINT</span>,</span><br><span class="line">    <span class="keyword">FOREIGN</span> KEY (author_id) <span class="keyword">REFERENCES</span> users(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE,</span><br><span class="line">    <span class="keyword">FOREIGN</span> KEY (category_id) <span class="keyword">REFERENCES</span> categories(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span>,</span><br><span class="line">    INDEX idx_author_id (author_id),</span><br><span class="line">    INDEX idx_category_id (category_id),</span><br><span class="line">    INDEX idx_status_published (status, published_at),</span><br><span class="line">    INDEX idx_created_at (created_at),</span><br><span class="line">    INDEX idx_featured (is_featured, published_at),</span><br><span class="line">    FULLTEXT idx_search (title, summary, content)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 分类表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> categories (</span><br><span class="line">    id <span class="type">BIGINT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    slug <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">    description <span class="type">VARCHAR</span>(<span class="number">200</span>),</span><br><span class="line">    parent_id <span class="type">BIGINT</span>,</span><br><span class="line">    sort_order <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    article_count <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    <span class="keyword">FOREIGN</span> KEY (parent_id) <span class="keyword">REFERENCES</span> categories(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE,</span><br><span class="line">    INDEX idx_parent_id (parent_id),</span><br><span class="line">    INDEX idx_slug (slug)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 标签表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tags (</span><br><span class="line">    id <span class="type">BIGINT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">    slug <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">    description <span class="type">VARCHAR</span>(<span class="number">200</span>),</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    INDEX idx_slug (slug)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 文章-标签关联表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> article_tags (</span><br><span class="line">    article_id <span class="type">BIGINT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    tag_id <span class="type">BIGINT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (article_id, tag_id),</span><br><span class="line">    <span class="keyword">FOREIGN</span> KEY (article_id) <span class="keyword">REFERENCES</span> articles(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE,</span><br><span class="line">    <span class="keyword">FOREIGN</span> KEY (tag_id) <span class="keyword">REFERENCES</span> tags(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE,</span><br><span class="line">    INDEX idx_tag_id (tag_id)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 评论表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> comments (</span><br><span class="line">    id <span class="type">BIGINT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">    content TEXT <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    author_name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    author_email <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    author_ip <span class="type">VARCHAR</span>(<span class="number">45</span>),</span><br><span class="line">    is_approved <span class="type">BOOLEAN</span> <span class="keyword">DEFAULT</span> <span class="literal">FALSE</span>,</span><br><span class="line">    like_count <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    updated_at <span class="type">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    article_id <span class="type">BIGINT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    user_id <span class="type">BIGINT</span>,</span><br><span class="line">    parent_id <span class="type">BIGINT</span>,</span><br><span class="line">    <span class="keyword">FOREIGN</span> KEY (article_id) <span class="keyword">REFERENCES</span> articles(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE,</span><br><span class="line">    <span class="keyword">FOREIGN</span> KEY (user_id) <span class="keyword">REFERENCES</span> users(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">FOREIGN</span> KEY (parent_id) <span class="keyword">REFERENCES</span> comments(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE,</span><br><span class="line">    INDEX idx_article_id (article_id),</span><br><span class="line">    INDEX idx_user_id (user_id),</span><br><span class="line">    INDEX idx_parent_id (parent_id),</span><br><span class="line">    INDEX idx_approved_created (is_approved, created_at)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_unicode_ci;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入示例数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> users (username, email, password_hash, display_name, role) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;admin@example.com&#x27;</span>, <span class="string">&#x27;$2a$10$YourHashedPasswordHere&#x27;</span>, <span class="string">&#x27;管理员&#x27;</span>, <span class="string">&#x27;ADMIN&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;user1&#x27;</span>, <span class="string">&#x27;user1@example.com&#x27;</span>, <span class="string">&#x27;$2a$10$YourHashedPasswordHere&#x27;</span>, <span class="string">&#x27;用户1&#x27;</span>, <span class="string">&#x27;USER&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> categories (name, slug, description) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;编程&#x27;</span>, <span class="string">&#x27;programming&#x27;</span>, <span class="string">&#x27;编程相关文章&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;技术&#x27;</span>, <span class="string">&#x27;technology&#x27;</span>, <span class="string">&#x27;技术分享&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;生活&#x27;</span>, <span class="string">&#x27;life&#x27;</span>, <span class="string">&#x27;生活随笔&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tags (name, slug, description) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;Java&#x27;</span>, <span class="string">&#x27;java&#x27;</span>, <span class="string">&#x27;Java编程&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;Spring Boot&#x27;</span>, <span class="string">&#x27;spring-boot&#x27;</span>, <span class="string">&#x27;Spring Boot框架&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;JavaScript&#x27;</span>, <span class="string">&#x27;javascript&#x27;</span>, <span class="string">&#x27;JavaScript语言&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;前端开发&#x27;</span>, <span class="string">&#x27;frontend&#x27;</span>, <span class="string">&#x27;前端开发技术&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;后端开发&#x27;</span>, <span class="string">&#x27;backend&#x27;</span>, <span class="string">&#x27;后端开发技术&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> articles (title, summary, content, status, author_id, category_id, published_at) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;Spring Boot入门教程&#x27;</span>, <span class="string">&#x27;本文介绍Spring Boot的基础知识和快速入门方法。&#x27;</span>, <span class="string">&#x27;Spring Boot是一个强大的框架...&#x27;</span>, <span class="string">&#x27;PUBLISHED&#x27;</span>, <span class="number">1</span>, <span class="number">1</span>, NOW()),</span><br><span class="line">(<span class="string">&#x27;JavaScript高级技巧&#x27;</span>, <span class="string">&#x27;分享一些实用的JavaScript高级编程技巧。&#x27;</span>, <span class="string">&#x27;JavaScript是一门灵活的语言...&#x27;</span>, <span class="string">&#x27;PUBLISHED&#x27;</span>, <span class="number">2</span>, <span class="number">1</span>, NOW());</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> article_tags (article_id, tag_id) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="number">1</span>), (<span class="number">1</span>, <span class="number">2</span>), (<span class="number">1</span>, <span class="number">5</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="number">3</span>), (<span class="number">2</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> comments (content, author_name, author_email, is_approved, article_id, user_id) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;非常好的入门教程，感谢分享！&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;zhangsan@example.com&#x27;</span>, <span class="literal">TRUE</span>, <span class="number">1</span>, <span class="number">2</span>),</span><br><span class="line">(<span class="string">&#x27;期待更多Spring Boot相关内容。&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;lisi@example.com&#x27;</span>, <span class="literal">TRUE</span>, <span class="number">1</span>, <span class="keyword">NULL</span>);</span><br></pre></td></tr></table></figure>



<h2 id="第四部分：部署和运行"><a href="#第四部分：部署和运行" class="headerlink" title="第四部分：部署和运行"></a>第四部分：部署和运行</h2><h3 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1. 环境准备"></a>1. 环境准备</h3><ol>
<li><strong>安装Java 11+</strong></li>
<li><strong>安装MySQL 8.0+</strong></li>
<li><strong>安装Node.js (可选，用于前端开发)</strong></li>
</ol>
<h3 id="2-后端运行步骤"><a href="#2-后端运行步骤" class="headerlink" title="2. 后端运行步骤"></a>2. 后端运行步骤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 克隆或创建项目</span></span><br><span class="line">git <span class="built_in">clone</span> &lt;repository-url&gt;</span><br><span class="line"><span class="built_in">cd</span> blog-backend</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 配置数据库</span></span><br><span class="line">mysql -u root -p &lt; blog_db.sql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 修改配置文件</span></span><br><span class="line"><span class="comment"># 编辑 application.yml，修改数据库连接信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 构建项目</span></span><br><span class="line">mvn clean package</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 运行项目</span></span><br><span class="line">java -jar target/blog-system-1.0.0.jar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用Maven直接运行</span></span><br><span class="line">mvn spring-boot:run</span><br></pre></td></tr></table></figure>



<h3 id="3-前端运行步骤"><a href="#3-前端运行步骤" class="headerlink" title="3. 前端运行步骤"></a>3. 前端运行步骤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建前端目录</span></span><br><span class="line"><span class="built_in">cd</span> blog-frontend</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 启动HTTP服务器</span></span><br><span class="line"><span class="comment"># 可以使用Python、Node.js等</span></span><br><span class="line">python3 -m http.server 3000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或使用VS Code的Live Server插件</span></span><br></pre></td></tr></table></figure>



<h3 id="4-访问应用"><a href="#4-访问应用" class="headerlink" title="4. 访问应用"></a>4. 访问应用</h3><ul>
<li>前端：<a target="_blank" rel="noopener" href="http://localhost:3000/">http://localhost:3000</a></li>
<li>后端API：<a target="_blank" rel="noopener" href="http://localhost:8080/api">http://localhost:8080/api</a></li>
</ul>
<h2 id="第五部分：扩展功能建议"><a href="#第五部分：扩展功能建议" class="headerlink" title="第五部分：扩展功能建议"></a>第五部分：扩展功能建议</h2><h3 id="1-可以添加的功能"><a href="#1-可以添加的功能" class="headerlink" title="1. 可以添加的功能"></a>1. 可以添加的功能</h3><ol>
<li><strong>文章收藏功能</strong></li>
<li><strong>用户关注系统</strong></li>
<li><strong>站内消息</strong></li>
<li><strong>文章评分系统</strong></li>
<li><strong>访问统计图表</strong></li>
<li><strong>SEO优化</strong></li>
<li><strong>多语言支持</strong></li>
</ol>
<h3 id="2-性能优化"><a href="#2-性能优化" class="headerlink" title="2. 性能优化"></a>2. 性能优化</h3><ol>
<li><strong>Redis缓存</strong></li>
<li><strong>CDN静态资源</strong></li>
<li><strong>数据库读写分离</strong></li>
<li><strong>文章静态化</strong></li>
<li><strong>图片懒加载</strong></li>
</ol>
<h3 id="3-安全增强"><a href="#3-安全增强" class="headerlink" title="3. 安全增强"></a>3. 安全增强</h3><ol>
<li><strong>HTTPS支持</strong></li>
<li><strong>防止SQL注入</strong></li>
<li><strong>XSS防护</strong></li>
<li><strong>CSRF保护</strong></li>
<li><strong>API限流</strong></li>
</ol>
<p>这个完整项目包含了：</p>
<ul>
<li><strong>后端</strong>：完整的Spring Boot应用，包含用户认证、文章管理、评论系统等</li>
<li><strong>前端</strong>：纯HTML&#x2F;CSS&#x2F;JavaScript实现的SPA应用</li>
<li><strong>数据库</strong>：完整的MySQL表结构</li>
<li><strong>部署</strong>：详细的部署步骤</li>
</ul>
<p>你可以按照这个指南一步步实现，每个文件都有完整的代码。这个项目涵盖了现代Web开发的核心概念，完成后你将掌握前后端分离开发的全套技能。</p>
<h1 id="个人博客系统扩展"><a href="#个人博客系统扩展" class="headerlink" title="个人博客系统扩展"></a>个人博客系统扩展</h1><p>我将继续扩展这个项目，添加更多高级功能和优化。以下是完整的扩展实现：</p>
<h2 id="第一部分：后端扩展"><a href="#第一部分：后端扩展" class="headerlink" title="第一部分：后端扩展"></a>第一部分：后端扩展</h2><h3 id="1-添加缓存支持"><a href="#1-添加缓存支持" class="headerlink" title="1. 添加缓存支持"></a>1. 添加缓存支持</h3><p><strong>RedisConfig.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.CacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.cache.RedisCacheConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.cache.RedisCacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.RedisSerializationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">(RedisConnectionFactory connectionFactory)</span> &#123;</span><br><span class="line">        <span class="type">RedisCacheConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">            .entryTtl(Duration.ofMinutes(<span class="number">30</span>))  <span class="comment">// 默认30分钟过期</span></span><br><span class="line">            .disableCachingNullValues()</span><br><span class="line">            .serializeKeysWith(RedisSerializationContext.SerializationPair</span><br><span class="line">                .fromSerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>()))</span><br><span class="line">            .serializeValuesWith(RedisSerializationContext.SerializationPair</span><br><span class="line">                .fromSerializer(<span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>()));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> RedisCacheManager.builder(connectionFactory)</span><br><span class="line">            .cacheDefaults(config)</span><br><span class="line">            .withCacheConfiguration(<span class="string">&quot;articles&quot;</span>, </span><br><span class="line">                RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                    .entryTtl(Duration.ofHours(<span class="number">1</span>)))</span><br><span class="line">            .withCacheConfiguration(<span class="string">&quot;users&quot;</span>,</span><br><span class="line">                RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                    .entryTtl(Duration.ofMinutes(<span class="number">10</span>)))</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-添加全文搜索功能"><a href="#2-添加全文搜索功能" class="headerlink" title="2. 添加全文搜索功能"></a>2. 添加全文搜索功能</h3><p><strong>ElasticsearchConfig.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.client.ClientConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.client.elc.ElasticsearchConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.repository.config.EnableElasticsearchRepositories;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableElasticsearchRepositories(basePackages = &quot;com.blog.repository.elasticsearch&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ElasticsearchConfig</span> <span class="keyword">extends</span> <span class="title class_">ElasticsearchConfiguration</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ClientConfiguration <span class="title function_">clientConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ClientConfiguration.builder()</span><br><span class="line">            .connectedTo(<span class="string">&quot;localhost:9200&quot;</span>)</span><br><span class="line">            .withSocketTimeout(<span class="number">10000</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>ArticleDocument.java</strong> (Elasticsearch文档)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.document;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.annotation.Id;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.annotations.*;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Document(indexName = &quot;articles&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleDocument</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Field(type = FieldType.Text, analyzer = &quot;ik_max_word&quot;, searchAnalyzer = &quot;ik_smart&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Field(type = FieldType.Text, analyzer = &quot;ik_max_word&quot;, searchAnalyzer = &quot;ik_smart&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Field(type = FieldType.Text, analyzer = &quot;ik_max_word&quot;, searchAnalyzer = &quot;ik_smart&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String summary;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Field(type = FieldType.Keyword)</span></span><br><span class="line">    <span class="keyword">private</span> String authorName;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Field(type = FieldType.Date)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime publishedAt;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Field(type = FieldType.Integer)</span></span><br><span class="line">    <span class="keyword">private</span> Integer viewCount;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Field(type = FieldType.Integer)</span></span><br><span class="line">    <span class="keyword">private</span> Integer likeCount;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Field(type = FieldType.Keyword)</span></span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Field(type = FieldType.Nested)</span></span><br><span class="line">    <span class="keyword">private</span> java.util.List&lt;String&gt; tags;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>ArticleSearchRepository.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.repository.elasticsearch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.blog.document.ArticleDocument;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Page;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Pageable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.annotations.Query;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.elasticsearch.repository.ElasticsearchRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ArticleSearchRepository</span> <span class="keyword">extends</span> <span class="title class_">ElasticsearchRepository</span>&lt;ArticleDocument, Long&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    Page&lt;ArticleDocument&gt; <span class="title function_">findByTitleContainingOrContentContaining</span><span class="params">(</span></span><br><span class="line"><span class="params">            String title, String content, Pageable pageable)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Query(&quot;&#123;\&quot;multi_match\&quot;: &#123;\&quot;query\&quot;: \&quot;?0\&quot;, \&quot;fields\&quot;: [\&quot;title^2\&quot;, \&quot;content\&quot;, \&quot;summary\&quot;]&#125;&#125;&quot;)</span></span><br><span class="line">    Page&lt;ArticleDocument&gt; <span class="title function_">search</span><span class="params">(String keyword, Pageable pageable)</span>;</span><br><span class="line">    </span><br><span class="line">    Page&lt;ArticleDocument&gt; <span class="title function_">findByAuthorName</span><span class="params">(String authorName, Pageable pageable)</span>;</span><br><span class="line">    </span><br><span class="line">    Page&lt;ArticleDocument&gt; <span class="title function_">findByStatus</span><span class="params">(String status, Pageable pageable)</span>;</span><br><span class="line">    </span><br><span class="line">    Page&lt;ArticleDocument&gt; <span class="title function_">findByTagsContaining</span><span class="params">(String tag, Pageable pageable)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>SearchService.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.blog.document.ArticleDocument;</span><br><span class="line"><span class="keyword">import</span> com.blog.entity.Article;</span><br><span class="line"><span class="keyword">import</span> com.blog.repository.elasticsearch.ArticleSearchRepository;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Page;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Pageable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Async;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.event.TransactionalEventListener;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SearchService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ArticleSearchRepository articleSearchRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">indexArticle</span><span class="params">(Article article)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ArticleDocument</span> <span class="variable">document</span> <span class="operator">=</span> convertToDocument(article);</span><br><span class="line">            articleSearchRepository.save(document);</span><br><span class="line">            log.info(<span class="string">&quot;文章已索引: &#123;&#125;&quot;</span>, article.getTitle());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;索引文章失败: &#123;&#125;&quot;</span>, article.getId(), e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteArticle</span><span class="params">(Long articleId)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            articleSearchRepository.deleteById(articleId);</span><br><span class="line">            log.info(<span class="string">&quot;文章已从索引删除: &#123;&#125;&quot;</span>, articleId);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;删除文章索引失败: &#123;&#125;&quot;</span>, articleId, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Page&lt;ArticleDocument&gt; <span class="title function_">search</span><span class="params">(String keyword, Pageable pageable)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> articleSearchRepository.search(keyword, pageable);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Page&lt;ArticleDocument&gt; <span class="title function_">searchByTag</span><span class="params">(String tag, Pageable pageable)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> articleSearchRepository.findByTagsContaining(tag, pageable);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Page&lt;ArticleDocument&gt; <span class="title function_">searchByAuthor</span><span class="params">(String authorName, Pageable pageable)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> articleSearchRepository.findByAuthorName(authorName, pageable);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TransactionalEventListener</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleArticlePublished</span><span class="params">(Article article)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (article.getStatus() == Article.Status.PUBLISHED) &#123;</span><br><span class="line">            indexArticle(article);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ArticleDocument <span class="title function_">convertToDocument</span><span class="params">(Article article)</span> &#123;</span><br><span class="line">        <span class="type">ArticleDocument</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArticleDocument</span>();</span><br><span class="line">        document.setId(article.getId());</span><br><span class="line">        document.setTitle(article.getTitle());</span><br><span class="line">        document.setContent(article.getContent());</span><br><span class="line">        document.setSummary(article.getSummary());</span><br><span class="line">        document.setAuthorName(article.getAuthor().getDisplayName());</span><br><span class="line">        document.setPublishedAt(article.getPublishedAt());</span><br><span class="line">        document.setViewCount(article.getViewCount());</span><br><span class="line">        document.setLikeCount(article.getLikeCount());</span><br><span class="line">        document.setStatus(article.getStatus().name());</span><br><span class="line">        document.setTags(article.getTags().stream()</span><br><span class="line">            .map(tag -&gt; tag.getName())</span><br><span class="line">            .collect(java.util.stream.Collectors.toList()));</span><br><span class="line">        <span class="keyword">return</span> document;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-添加WebSocket实时通知"><a href="#3-添加WebSocket实时通知" class="headerlink" title="3. 添加WebSocket实时通知"></a>3. 添加WebSocket实时通知</h3><p><strong>WebSocketConfig.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.simp.config.MessageBrokerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.StompEndpointRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocketMessageBroker</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketConfig</span> <span class="keyword">implements</span> <span class="title class_">WebSocketMessageBrokerConfigurer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureMessageBroker</span><span class="params">(MessageBrokerRegistry config)</span> &#123;</span><br><span class="line">        config.enableSimpleBroker(<span class="string">&quot;/topic&quot;</span>, <span class="string">&quot;/queue&quot;</span>);</span><br><span class="line">        config.setApplicationDestinationPrefixes(<span class="string">&quot;/app&quot;</span>);</span><br><span class="line">        config.setUserDestinationPrefix(<span class="string">&quot;/user&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerStompEndpoints</span><span class="params">(StompEndpointRegistry registry)</span> &#123;</span><br><span class="line">        registry.addEndpoint(<span class="string">&quot;/ws&quot;</span>)</span><br><span class="line">                .setAllowedOriginPatterns(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                .withSockJS();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>NotificationService.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.blog.dto.NotificationDTO;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.simp.SimpMessagingTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NotificationService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SimpMessagingTemplate messagingTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendCommentNotification</span><span class="params">(Long userId, NotificationDTO notification)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">destination</span> <span class="operator">=</span> <span class="string">&quot;/queue/notifications/&quot;</span> + userId;</span><br><span class="line">        messagingTemplate.convertAndSend(destination, notification);</span><br><span class="line">        log.info(<span class="string">&quot;发送评论通知给用户: &#123;&#125;, 内容: &#123;&#125;&quot;</span>, userId, notification.getContent());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendArticleUpdateNotification</span><span class="params">(Long articleId, NotificationDTO notification)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">destination</span> <span class="operator">=</span> <span class="string">&quot;/topic/articles/&quot;</span> + articleId + <span class="string">&quot;/updates&quot;</span>;</span><br><span class="line">        messagingTemplate.convertAndSend(destination, notification);</span><br><span class="line">        log.info(<span class="string">&quot;发送文章更新通知: &#123;&#125;&quot;</span>, articleId);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendGlobalNotification</span><span class="params">(NotificationDTO notification)</span> &#123;</span><br><span class="line">        messagingTemplate.convertAndSend(<span class="string">&quot;/topic/notifications&quot;</span>, notification);</span><br><span class="line">        log.info(<span class="string">&quot;发送全局通知: &#123;&#125;&quot;</span>, notification.getContent());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NotificationDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String type; <span class="comment">// COMMENT, ARTICLE_UPDATE, SYSTEM</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="keyword">private</span> String targetUrl;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Boolean</span> <span class="variable">read</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> java.time.LocalDateTime createdAt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-添加文件上传服务"><a href="#4-添加文件上传服务" class="headerlink" title="4. 添加文件上传服务"></a>4. 添加文件上传服务</h3><p><strong>FileStorageService.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.StandardCopyOption;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileStorageService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.file.upload-dir:uploads&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String uploadDir;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.file.max-size:10485760&#125;&quot;)</span> <span class="comment">// 10MB</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> maxFileSize;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.file.allowed-extensions:jpg,jpeg,png,gif,pdf,doc,docx&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String[] allowedExtensions;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">storeFile</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 验证文件大小</span></span><br><span class="line">        <span class="keyword">if</span> (file.getSize() &gt; maxFileSize) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;文件大小超过限制&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 验证文件扩展名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        <span class="type">String</span> <span class="variable">extension</span> <span class="operator">=</span> getFileExtension(originalFilename);</span><br><span class="line">        <span class="keyword">if</span> (!isAllowedExtension(extension)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;不支持的文件类型&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 生成唯一文件名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> UUID.randomUUID().toString() + <span class="string">&quot;.&quot;</span> + extension;</span><br><span class="line">        <span class="type">Path</span> <span class="variable">targetLocation</span> <span class="operator">=</span> Paths.get(uploadDir).resolve(filename);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 确保目录存在</span></span><br><span class="line">        Files.createDirectories(targetLocation.getParent());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 保存文件</span></span><br><span class="line">        Files.copy(file.getInputStream(), targetLocation, StandardCopyOption.REPLACE_EXISTING);</span><br><span class="line">        </span><br><span class="line">        log.info(<span class="string">&quot;文件保存成功: &#123;&#125;&quot;</span>, filename);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;/uploads/&quot;</span> + filename;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] loadFile(String filename) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Path</span> <span class="variable">filePath</span> <span class="operator">=</span> Paths.get(uploadDir).resolve(filename).normalize();</span><br><span class="line">        <span class="keyword">return</span> Files.readAllBytes(filePath);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteFile</span><span class="params">(String filename)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Path</span> <span class="variable">filePath</span> <span class="operator">=</span> Paths.get(uploadDir).resolve(filename).normalize();</span><br><span class="line">        Files.deleteIfExists(filePath);</span><br><span class="line">        log.info(<span class="string">&quot;文件删除成功: &#123;&#125;&quot;</span>, filename);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getFileExtension</span><span class="params">(String filename)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (filename == <span class="literal">null</span> || !filename.contains(<span class="string">&quot;.&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> filename.substring(filename.lastIndexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>).toLowerCase();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isAllowedExtension</span><span class="params">(String extension)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (extension == <span class="literal">null</span> || extension.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (String allowed : allowedExtensions) &#123;</span><br><span class="line">            <span class="keyword">if</span> (allowed.equalsIgnoreCase(extension)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>FileController.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.blog.service.FileStorageService;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.UrlResource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpHeaders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.access.prepost.PreAuthorize;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/files&quot;)</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> FileStorageService fileStorageService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasRole(&#x27;USER&#x27;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; uploadFile(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">fileUrl</span> <span class="operator">=</span> fileStorageService.storeFile(file);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(<span class="keyword">new</span> <span class="title class_">FileUploadResponse</span>(fileUrl));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;文件上传失败&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.badRequest().body(<span class="string">&quot;文件上传失败: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.badRequest().body(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;filename:.+&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Resource&gt; <span class="title function_">getFile</span><span class="params">(<span class="meta">@PathVariable</span> String filename)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">Path</span> <span class="variable">filePath</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;uploads&quot;</span>).resolve(filename).normalize();</span><br><span class="line">        <span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlResource</span>(filePath.toUri());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!resource.exists()) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.notFound().build();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">contentType</span> <span class="operator">=</span> getContentType(filename);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok()</span><br><span class="line">                .contentType(MediaType.parseMediaType(contentType))</span><br><span class="line">                .header(HttpHeaders.CONTENT_DISPOSITION, </span><br><span class="line">                        <span class="string">&quot;inline; filename=\&quot;&quot;</span> + resource.getFilename() + <span class="string">&quot;\&quot;&quot;</span>)</span><br><span class="line">                .body(resource);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;filename:.+&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasRole(&#x27;ADMIN&#x27;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; deleteFile(<span class="meta">@PathVariable</span> String filename) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fileStorageService.deleteFile(filename);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok().build();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;文件删除失败&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.badRequest().body(<span class="string">&quot;文件删除失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getContentType</span><span class="params">(String filename)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">extension</span> <span class="operator">=</span> filename.substring(filename.lastIndexOf(<span class="string">&quot;.&quot;</span>) + <span class="number">1</span>).toLowerCase();</span><br><span class="line">        <span class="keyword">switch</span> (extension) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;jpg&quot;</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;jpeg&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;image/jpeg&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;png&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;image/png&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;gif&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;image/gif&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;pdf&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;application/pdf&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;doc&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;application/msword&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;docx&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;application/octet-stream&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">FileUploadResponse</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String url;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5-添加邮件服务"><a href="#5-添加邮件服务" class="headerlink" title="5. 添加邮件服务"></a>5. 添加邮件服务</h3><p><strong>EmailService.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.JavaMailSender;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.MimeMessageHelper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Async;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.TemplateEngine;</span><br><span class="line"><span class="keyword">import</span> org.thymeleaf.context.Context;</span><br><span class="line"><span class="keyword">import</span> javax.mail.internet.MimeMessage;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JavaMailSender mailSender;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TemplateEngine templateEngine;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.email.from:no-reply@blog.com&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String fromEmail;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.email.from-name:博客系统&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String fromName;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendWelcomeEmail</span><span class="params">(String to, String username)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>(Locale.CHINA);</span><br><span class="line">            context.setVariable(<span class="string">&quot;username&quot;</span>, username);</span><br><span class="line">            </span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> templateEngine.process(<span class="string">&quot;email/welcome&quot;</span>, context);</span><br><span class="line">            <span class="type">String</span> <span class="variable">subject</span> <span class="operator">=</span> <span class="string">&quot;欢迎加入博客系统&quot;</span>;</span><br><span class="line">            </span><br><span class="line">            sendHtmlEmail(to, subject, content);</span><br><span class="line">            log.info(<span class="string">&quot;欢迎邮件发送成功: &#123;&#125;&quot;</span>, to);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;发送欢迎邮件失败&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendCommentNotification</span><span class="params">(String to, String commenter, String articleTitle, String articleUrl)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>(Locale.CHINA);</span><br><span class="line">            context.setVariable(<span class="string">&quot;commenter&quot;</span>, commenter);</span><br><span class="line">            context.setVariable(<span class="string">&quot;articleTitle&quot;</span>, articleTitle);</span><br><span class="line">            context.setVariable(<span class="string">&quot;articleUrl&quot;</span>, articleUrl);</span><br><span class="line">            </span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> templateEngine.process(<span class="string">&quot;email/comment-notification&quot;</span>, context);</span><br><span class="line">            <span class="type">String</span> <span class="variable">subject</span> <span class="operator">=</span> <span class="string">&quot;您的文章收到了新的评论&quot;</span>;</span><br><span class="line">            </span><br><span class="line">            sendHtmlEmail(to, subject, content);</span><br><span class="line">            log.info(<span class="string">&quot;评论通知邮件发送成功: &#123;&#125;&quot;</span>, to);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;发送评论通知邮件失败&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendPasswordResetEmail</span><span class="params">(String to, String resetToken)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>(Locale.CHINA);</span><br><span class="line">            context.setVariable(<span class="string">&quot;resetToken&quot;</span>, resetToken);</span><br><span class="line">            </span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> templateEngine.process(<span class="string">&quot;email/password-reset&quot;</span>, context);</span><br><span class="line">            <span class="type">String</span> <span class="variable">subject</span> <span class="operator">=</span> <span class="string">&quot;密码重置请求&quot;</span>;</span><br><span class="line">            </span><br><span class="line">            sendHtmlEmail(to, subject, content);</span><br><span class="line">            log.info(<span class="string">&quot;密码重置邮件发送成功: &#123;&#125;&quot;</span>, to);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;发送密码重置邮件失败&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendHtmlEmail</span><span class="params">(String to, String subject, String content)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">MimeMessage</span> <span class="variable">message</span> <span class="operator">=</span> mailSender.createMimeMessage();</span><br><span class="line">        <span class="type">MimeMessageHelper</span> <span class="variable">helper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MimeMessageHelper</span>(message, <span class="literal">true</span>, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        helper.setFrom(fromEmail, fromName);</span><br><span class="line">        helper.setTo(to);</span><br><span class="line">        helper.setSubject(subject);</span><br><span class="line">        helper.setText(content, <span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        mailSender.send(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>邮件模板 resources&#x2F;templates&#x2F;email&#x2F;welcome.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>欢迎加入<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-family</span>: Arial, sans-serif;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">line-height</span>: <span class="number">1.6</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">max-width</span>: <span class="number">600px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">0</span> auto;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.header</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#007bff</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">5px</span> <span class="number">5px</span> <span class="number">0</span> <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.content</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#f8f9fa</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">5px</span> <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.btn</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>: inline-block;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#007bff</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">text-decoration</span>: none;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">20px</span> <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.footer</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-top</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: <span class="number">#666</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-size</span>: <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎加入博客系统<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>亲爱的 <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>&gt;</span>用户<span class="tag">&lt;/<span class="name">span</span>&gt;</span>，<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>感谢您注册博客系统！我们很高兴您能加入我们的社区。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>现在您可以：<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>发布您的第一篇博客文章<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>阅读其他作者的精彩文章<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>参与文章的讨论和评论<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>关注您喜欢的作者<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://localhost:3000&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>开始探索<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>如果您有任何问题，请随时联系我们的支持团队。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>祝您使用愉快！<span class="tag">&lt;<span class="name">br</span>&gt;</span>博客系统团队<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是一封自动发送的邮件，请勿直接回复。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>© 2023 博客系统. All rights reserved.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="6-添加定时任务"><a href="#6-添加定时任务" class="headerlink" title="6. 添加定时任务"></a>6. 添加定时任务</h3><p><strong>ScheduledTasks.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.task;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.blog.repository.ArticleRepository;</span><br><span class="line"><span class="keyword">import</span> com.blog.repository.UserRepository;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CacheEvict;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScheduledTasks</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ArticleRepository articleRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 每天凌晨3点清理未激活用户</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0 3 * * ?&quot;)</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cleanupInactiveUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">cutoffDate</span> <span class="operator">=</span> LocalDateTime.now().minusDays(<span class="number">7</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">deleted</span> <span class="operator">=</span> userRepository.deleteByIsActiveFalseAndCreatedAtBefore(cutoffDate);</span><br><span class="line">        log.info(<span class="string">&quot;清理了 &#123;&#125; 个未激活用户&quot;</span>, deleted);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 每小时更新文章缓存</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0 * * * ?&quot;)</span></span><br><span class="line">    <span class="meta">@CacheEvict(value = &quot;articles&quot;, allEntries = true)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">evictArticleCache</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;文章缓存已清理&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 每周一凌晨2点生成统计报告</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0 2 ? * MON&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generateWeeklyReport</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">totalArticles</span> <span class="operator">=</span> articleRepository.countPublishedArticles();</span><br><span class="line">        <span class="type">long</span> <span class="variable">totalUsers</span> <span class="operator">=</span> userRepository.count();</span><br><span class="line">        <span class="type">long</span> <span class="variable">newArticles</span> <span class="operator">=</span> articleRepository.countByPublishedAtAfter(LocalDateTime.now().minusDays(<span class="number">7</span>));</span><br><span class="line">        </span><br><span class="line">        log.info(<span class="string">&quot;周度统计报告:&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;总文章数: &#123;&#125;&quot;</span>, totalArticles);</span><br><span class="line">        log.info(<span class="string">&quot;总用户数: &#123;&#125;&quot;</span>, totalUsers);</span><br><span class="line">        log.info(<span class="string">&quot;本周新文章数: &#123;&#125;&quot;</span>, newArticles);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 这里可以添加发送统计邮件或保存到数据库的逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 每天凌晨1点备份数据库</span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0 1 * * ?&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">backupDatabase</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 这里实现数据库备份逻辑</span></span><br><span class="line">            log.info(<span class="string">&quot;数据库备份任务开始执行&quot;</span>);</span><br><span class="line">            <span class="comment">// 备份逻辑...</span></span><br><span class="line">            log.info(<span class="string">&quot;数据库备份完成&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;数据库备份失败&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="7-添加API文档"><a href="#7-添加API文档" class="headerlink" title="7. 添加API文档"></a>7. 添加API文档</h3><p><strong>SwaggerConfig.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.models.OpenAPI;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.models.info.Contact;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.models.info.Info;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.models.info.License;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.models.security.SecurityScheme;</span><br><span class="line"><span class="keyword">import</span> org.springdoc.core.GroupedOpenApi;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> OpenAPI <span class="title function_">blogOpenAPI</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OpenAPI</span>()</span><br><span class="line">                .info(<span class="keyword">new</span> <span class="title class_">Info</span>()</span><br><span class="line">                        .title(<span class="string">&quot;博客系统API文档&quot;</span>)</span><br><span class="line">                        .description(<span class="string">&quot;个人博客系统后端API接口文档&quot;</span>)</span><br><span class="line">                        .version(<span class="string">&quot;v1.0.0&quot;</span>)</span><br><span class="line">                        .contact(<span class="keyword">new</span> <span class="title class_">Contact</span>()</span><br><span class="line">                                .name(<span class="string">&quot;开发者&quot;</span>)</span><br><span class="line">                                .email(<span class="string">&quot;developer@blog.com&quot;</span>))</span><br><span class="line">                        .license(<span class="keyword">new</span> <span class="title class_">License</span>()</span><br><span class="line">                                .name(<span class="string">&quot;Apache 2.0&quot;</span>)</span><br><span class="line">                                .url(<span class="string">&quot;http://springdoc.org&quot;</span>)))</span><br><span class="line">                .schemaRequirement(<span class="string">&quot;BearerAuth&quot;</span>, </span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">SecurityScheme</span>()</span><br><span class="line">                                .type(SecurityScheme.Type.HTTP)</span><br><span class="line">                                .scheme(<span class="string">&quot;bearer&quot;</span>)</span><br><span class="line">                                .bearerFormat(<span class="string">&quot;JWT&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> GroupedOpenApi <span class="title function_">publicApi</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> GroupedOpenApi.builder()</span><br><span class="line">                .group(<span class="string">&quot;public&quot;</span>)</span><br><span class="line">                .pathsToMatch(<span class="string">&quot;/api/auth/**&quot;</span>, <span class="string">&quot;/api/articles/public/**&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> GroupedOpenApi <span class="title function_">userApi</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> GroupedOpenApi.builder()</span><br><span class="line">                .group(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">                .pathsToMatch(<span class="string">&quot;/api/articles/**&quot;</span>, <span class="string">&quot;/api/comments/**&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> GroupedOpenApi <span class="title function_">adminApi</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> GroupedOpenApi.builder()</span><br><span class="line">                .group(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">                .pathsToMatch(<span class="string">&quot;/api/admin/**&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="第二部分：前端扩展"><a href="#第二部分：前端扩展" class="headerlink" title="第二部分：前端扩展"></a>第二部分：前端扩展</h2><h3 id="1-添加状态管理增强"><a href="#1-添加状态管理增强" class="headerlink" title="1. 添加状态管理增强"></a>1. 添加状态管理增强</h3><p><strong>js&#x2F;store&#x2F;enhanced-store.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 增强版状态管理</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">EnhancedStore</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">            <span class="attr">user</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">isAuthenticated</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">articles</span>: [],</span><br><span class="line">            <span class="attr">currentArticle</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">comments</span>: [],</span><br><span class="line">            <span class="attr">tags</span>: [],</span><br><span class="line">            <span class="attr">categories</span>: [],</span><br><span class="line">            <span class="attr">notifications</span>: [],</span><br><span class="line">            <span class="attr">unreadCount</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">searchHistory</span>: [],</span><br><span class="line">            <span class="attr">favorites</span>: <span class="keyword">new</span> <span class="title class_">Map</span>(),</span><br><span class="line">            <span class="attr">settings</span>: &#123;</span><br><span class="line">                <span class="attr">theme</span>: <span class="string">&#x27;light&#x27;</span>,</span><br><span class="line">                <span class="attr">language</span>: <span class="string">&#x27;zh-CN&#x27;</span>,</span><br><span class="line">                <span class="attr">notifications</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">autoSave</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">listeners</span> = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">actions</span> = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">middlewares</span> = [];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">history</span> = [];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">historyIndex</span> = -<span class="number">1</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">maxHistory</span> = <span class="number">50</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 初始化默认actions</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">initActions</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">initActions</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">defineAction</span>(<span class="string">&#x27;SET_USER&#x27;</span>, <span class="function">(<span class="params">state, payload</span>) =&gt;</span> (&#123;</span><br><span class="line">            ...state,</span><br><span class="line">            <span class="attr">user</span>: payload,</span><br><span class="line">            <span class="attr">isAuthenticated</span>: !!payload</span><br><span class="line">        &#125;));</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">defineAction</span>(<span class="string">&#x27;ADD_NOTIFICATION&#x27;</span>, <span class="function">(<span class="params">state, payload</span>) =&gt;</span> (&#123;</span><br><span class="line">            ...state,</span><br><span class="line">            <span class="attr">notifications</span>: [payload, ...state.<span class="property">notifications</span>],</span><br><span class="line">            <span class="attr">unreadCount</span>: state.<span class="property">unreadCount</span> + <span class="number">1</span></span><br><span class="line">        &#125;));</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">defineAction</span>(<span class="string">&#x27;MARK_NOTIFICATION_READ&#x27;</span>, <span class="function">(<span class="params">state, payload</span>) =&gt;</span> (&#123;</span><br><span class="line">            ...state,</span><br><span class="line">            <span class="attr">notifications</span>: state.<span class="property">notifications</span>.<span class="title function_">map</span>(<span class="function"><span class="params">n</span> =&gt;</span> </span><br><span class="line">                n.<span class="property">id</span> === payload ? &#123; ...n, <span class="attr">read</span>: <span class="literal">true</span> &#125; : n</span><br><span class="line">            ),</span><br><span class="line">            <span class="attr">unreadCount</span>: <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">0</span>, state.<span class="property">unreadCount</span> - <span class="number">1</span>)</span><br><span class="line">        &#125;));</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">defineAction</span>(<span class="string">&#x27;TOGGLE_FAVORITE&#x27;</span>, <span class="function">(<span class="params">state, payload</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> favorites = <span class="keyword">new</span> <span class="title class_">Map</span>(state.<span class="property">favorites</span>);</span><br><span class="line">            <span class="keyword">if</span> (favorites.<span class="title function_">has</span>(payload.<span class="property">id</span>)) &#123;</span><br><span class="line">                favorites.<span class="title function_">delete</span>(payload.<span class="property">id</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                favorites.<span class="title function_">set</span>(payload.<span class="property">id</span>, payload);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> &#123; ...state, favorites &#125;;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">defineAction</span>(<span class="string">&#x27;UPDATE_SETTINGS&#x27;</span>, <span class="function">(<span class="params">state, payload</span>) =&gt;</span> (&#123;</span><br><span class="line">            ...state,</span><br><span class="line">            <span class="attr">settings</span>: &#123; ...state.<span class="property">settings</span>, ...payload &#125;</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">defineAction</span>(<span class="params">type, reducer</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">actions</span>.<span class="title function_">set</span>(type, reducer);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">dispatch</span>(<span class="params">action</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> reducer = <span class="variable language_">this</span>.<span class="property">actions</span>.<span class="title function_">get</span>(action.<span class="property">type</span>);</span><br><span class="line">        <span class="keyword">if</span> (!reducer) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`未知的action类型: <span class="subst">$&#123;action.type&#125;</span>`</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 执行中间件</span></span><br><span class="line">        <span class="keyword">let</span> nextState = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">        <span class="keyword">const</span> middlewareAPI = &#123;</span><br><span class="line">            <span class="attr">getState</span>: <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">state</span>,</span><br><span class="line">            <span class="attr">dispatch</span>: <span class="variable language_">this</span>.<span class="property">dispatch</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> chain = <span class="variable language_">this</span>.<span class="property">middlewares</span>.<span class="title function_">map</span>(<span class="function"><span class="params">middleware</span> =&gt;</span> <span class="title function_">middleware</span>(middlewareAPI));</span><br><span class="line">        <span class="keyword">const</span> dispatch = <span class="title function_">compose</span>(...chain)(<span class="variable language_">this</span>.<span class="property">dispatch</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 应用reducer</span></span><br><span class="line">        <span class="keyword">const</span> newState = <span class="title function_">reducer</span>(<span class="variable language_">this</span>.<span class="property">state</span>, action.<span class="property">payload</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 保存到历史记录</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">saveToHistory</span>(<span class="variable language_">this</span>.<span class="property">state</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = newState;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 通知监听器</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">notify</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 持久化到localStorage</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">persistState</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">addMiddleware</span>(<span class="params">middleware</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">middlewares</span>.<span class="title function_">push</span>(middleware);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">saveToHistory</span>(<span class="params">state</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">history</span> = <span class="variable language_">this</span>.<span class="property">history</span>.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="variable language_">this</span>.<span class="property">historyIndex</span> + <span class="number">1</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">history</span>.<span class="title function_">push</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(state)));</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">history</span>.<span class="property">length</span> &gt; <span class="variable language_">this</span>.<span class="property">maxHistory</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">history</span>.<span class="title function_">shift</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">historyIndex</span> = <span class="variable language_">this</span>.<span class="property">history</span>.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">undo</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">historyIndex</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">historyIndex</span>--;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">state</span> = <span class="variable language_">this</span>.<span class="property">history</span>[<span class="variable language_">this</span>.<span class="property">historyIndex</span>];</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">notify</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">redo</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">historyIndex</span> &lt; <span class="variable language_">this</span>.<span class="property">history</span>.<span class="property">length</span> - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">historyIndex</span>++;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">state</span> = <span class="variable language_">this</span>.<span class="property">history</span>[<span class="variable language_">this</span>.<span class="property">historyIndex</span>];</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">notify</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">persistState</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> stateToPersist = &#123;</span><br><span class="line">                <span class="attr">user</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">user</span>,</span><br><span class="line">                <span class="attr">settings</span>: <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">settings</span>,</span><br><span class="line">                <span class="attr">favorites</span>: <span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">favorites</span>.<span class="title function_">values</span>())</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;blog_state&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(stateToPersist));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;状态持久化失败:&#x27;</span>, error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">restoreState</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> savedState = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;blog_state&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (savedState) &#123;</span><br><span class="line">                <span class="keyword">const</span> parsed = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(savedState);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">user</span> = parsed.<span class="property">user</span>;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">settings</span> = parsed.<span class="property">settings</span>;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">favorites</span> = <span class="keyword">new</span> <span class="title class_">Map</span>(</span><br><span class="line">                    parsed.<span class="property">favorites</span>?.<span class="title function_">map</span>(<span class="function"><span class="params">item</span> =&gt;</span> [item.<span class="property">id</span>, item]) || []</span><br><span class="line">                );</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">isAuthenticated</span> = !!parsed.<span class="property">user</span>;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">notify</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;状态恢复失败:&#x27;</span>, error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 其他方法与之前的Store类相同</span></span><br><span class="line">    <span class="title function_">getState</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">setState</span>(<span class="params">newState</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">saveToHistory</span>(<span class="variable language_">this</span>.<span class="property">state</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123; ...<span class="variable language_">this</span>.<span class="property">state</span>, ...newState &#125;;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">notify</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">persistState</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">subscribe</span>(<span class="params">listener</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">add</span>(listener);</span><br><span class="line">        <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">delete</span>(listener);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">notify</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">listeners</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">listener</span> =&gt;</span> <span class="title function_">listener</span>(<span class="variable language_">this</span>.<span class="property">state</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">compose</span>(<span class="params">...funcs</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (funcs.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span> <span class="function"><span class="params">arg</span> =&gt;</span> arg;</span><br><span class="line">    <span class="keyword">if</span> (funcs.<span class="property">length</span> === <span class="number">1</span>) <span class="keyword">return</span> funcs[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">return</span> funcs.<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> <span class="title function_">a</span>(<span class="title function_">b</span>(...args)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 日志中间件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">loggerMiddleware</span> = store =&gt; <span class="function"><span class="params">next</span> =&gt;</span> <span class="function"><span class="params">action</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">group</span>(<span class="string">`Dispatching: <span class="subst">$&#123;action.type&#125;</span>`</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Payload:&#x27;</span>, action.<span class="property">payload</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Previous state:&#x27;</span>, store.<span class="title function_">getState</span>());</span><br><span class="line">    <span class="keyword">const</span> result = <span class="title function_">next</span>(action);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Next state:&#x27;</span>, store.<span class="title function_">getState</span>());</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">groupEnd</span>();</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h3 id="2-添加WebSocket客户端"><a href="#2-添加WebSocket客户端" class="headerlink" title="2. 添加WebSocket客户端"></a>2. 添加WebSocket客户端</h3><p>**js&#x2F;websocket.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// WebSocket客户端</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">WebSocketClient</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">store</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">store</span> = store;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">stompClient</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reconnectInterval</span> = <span class="number">5000</span>; <span class="comment">// 5秒重连间隔</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">maxReconnectAttempts</span> = <span class="number">10</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reconnectAttempts</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">subscriptions</span> = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isConnected</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">connect</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> token = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!token) <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> socket = <span class="keyword">new</span> <span class="title class_">SockJS</span>(<span class="string">&#x27;http://localhost:8080/ws&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">stompClient</span> = <span class="title class_">Stomp</span>.<span class="title function_">over</span>(socket);</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">stompClient</span>.<span class="title function_">connect</span>(</span><br><span class="line">            &#123; <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span> &#125;,</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">onConnected</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>),</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">onError</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">onConnected</span>(<span class="params">frame</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;WebSocket连接成功:&#x27;</span>, frame);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isConnected</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">reconnectAttempts</span> = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 订阅用户通知</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">subscribeToUserNotifications</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 订阅文章更新</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">subscribeToArticleUpdates</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 通知store连接状态</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">store</span>.<span class="title function_">dispatch</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;WEBSOCKET_CONNECTED&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: <span class="literal">true</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">onError</span>(<span class="params">error</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;WebSocket连接错误:&#x27;</span>, error);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isConnected</span> = <span class="literal">false</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 尝试重连</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">reconnectAttempts</span> &lt; <span class="variable language_">this</span>.<span class="property">maxReconnectAttempts</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">reconnectAttempts</span>++;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">connect</span>(), <span class="variable language_">this</span>.<span class="property">reconnectInterval</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">store</span>.<span class="title function_">dispatch</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;WEBSOCKET_DISCONNECTED&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: <span class="literal">true</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">subscribeToUserNotifications</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> userId = <span class="variable language_">this</span>.<span class="property">store</span>.<span class="title function_">getState</span>().<span class="property">user</span>?.<span class="property">id</span>;</span><br><span class="line">        <span class="keyword">if</span> (!userId) <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> subscription = <span class="variable language_">this</span>.<span class="property">stompClient</span>.<span class="title function_">subscribe</span>(</span><br><span class="line">            <span class="string">`/queue/notifications/<span class="subst">$&#123;userId&#125;</span>`</span>,</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">handleNotification</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">subscriptions</span>.<span class="title function_">set</span>(<span class="string">&#x27;user-notifications&#x27;</span>, subscription);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">subscribeToArticleUpdates</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> subscription = <span class="variable language_">this</span>.<span class="property">stompClient</span>.<span class="title function_">subscribe</span>(</span><br><span class="line">            <span class="string">&#x27;/topic/notifications&#x27;</span>,</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">handleGlobalNotification</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>)</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">subscriptions</span>.<span class="title function_">set</span>(<span class="string">&#x27;global-notifications&#x27;</span>, subscription);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">handleNotification</span>(<span class="params">message</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> notification = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(message.<span class="property">body</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;收到通知:&#x27;</span>, notification);</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">store</span>.<span class="title function_">dispatch</span>(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;ADD_NOTIFICATION&#x27;</span>,</span><br><span class="line">            <span class="attr">payload</span>: notification</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 显示桌面通知</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Notification</span>.<span class="property">permission</span> === <span class="string">&#x27;granted&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Notification</span>(notification.<span class="property">title</span>, &#123;</span><br><span class="line">                <span class="attr">body</span>: notification.<span class="property">content</span>,</span><br><span class="line">                <span class="attr">icon</span>: <span class="string">&#x27;/assets/images/logo.png&#x27;</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">handleGlobalNotification</span>(<span class="params">message</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> notification = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(message.<span class="property">body</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;收到全局通知:&#x27;</span>, notification);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 处理全局通知逻辑</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">subscribeToArticle</span>(<span class="params">articleId</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> destination = <span class="string">`/topic/articles/<span class="subst">$&#123;articleId&#125;</span>/updates`</span>;</span><br><span class="line">        <span class="keyword">const</span> subscription = <span class="variable language_">this</span>.<span class="property">stompClient</span>.<span class="title function_">subscribe</span>(</span><br><span class="line">            destination,</span><br><span class="line">            <span class="function">(<span class="params">message</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> update = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(message.<span class="property">body</span>);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">handleArticleUpdate</span>(update);</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">subscriptions</span>.<span class="title function_">set</span>(<span class="string">`article-<span class="subst">$&#123;articleId&#125;</span>`</span>, subscription);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">handleArticleUpdate</span>(<span class="params">update</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;文章更新:&#x27;</span>, update);</span><br><span class="line">        <span class="comment">// 更新store中的文章状态</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">sendCommentNotification</span>(<span class="params">comment</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">isConnected</span>) <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">stompClient</span>.<span class="title function_">send</span>(</span><br><span class="line">            <span class="string">&#x27;/app/comment&#x27;</span>,</span><br><span class="line">            &#123;&#125;,</span><br><span class="line">            <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(comment)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">disconnect</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">stompClient</span>) &#123;</span><br><span class="line">            <span class="comment">// 取消所有订阅</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">subscriptions</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">sub</span> =&gt;</span> sub.<span class="title function_">unsubscribe</span>());</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">subscriptions</span>.<span class="title function_">clear</span>();</span><br><span class="line">            </span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">stompClient</span>.<span class="title function_">disconnect</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">stompClient</span> = <span class="literal">null</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isConnected</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-添加富文本编辑器组件"><a href="#3-添加富文本编辑器组件" class="headerlink" title="3. 添加富文本编辑器组件"></a>3. 添加富文本编辑器组件</h3><p><strong>js&#x2F;components&#x2F;editor.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 富文本编辑器组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">RichTextEditor</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">containerId, options = &#123;&#125;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">container</span> = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(containerId);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">options</span> = &#123;</span><br><span class="line">            <span class="attr">placeholder</span>: <span class="string">&#x27;请输入内容...&#x27;</span>,</span><br><span class="line">            <span class="attr">height</span>: <span class="number">400</span>,</span><br><span class="line">            <span class="attr">uploadUrl</span>: <span class="string">&#x27;/api/files/upload&#x27;</span>,</span><br><span class="line">            ...options</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">editor</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">toolbar</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">content</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">init</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">container</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;编辑器容器不存在&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">createEditor</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">createToolbar</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">bindEvents</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">createEditor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">editor</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="property">className</span> = <span class="string">&#x27;rich-text-editor&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="property">contentEditable</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="property">style</span>.<span class="property">minHeight</span> = <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.options.height&#125;</span>px`</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="property">style</span>.<span class="property">padding</span> = <span class="string">&#x27;10px&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="property">style</span>.<span class="property">border</span> = <span class="string">&#x27;1px solid #ddd&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="property">style</span>.<span class="property">borderRadius</span> = <span class="string">&#x27;4px&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="property">style</span>.<span class="property">outline</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">placeholder</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="title function_">setAttribute</span>(<span class="string">&#x27;data-placeholder&#x27;</span>, <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">placeholder</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">container</span>.<span class="title function_">appendChild</span>(<span class="variable language_">this</span>.<span class="property">editor</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">createToolbar</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">toolbar</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">toolbar</span>.<span class="property">className</span> = <span class="string">&#x27;editor-toolbar&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">toolbar</span>.<span class="property">style</span>.<span class="property">marginBottom</span> = <span class="string">&#x27;10px&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">toolbar</span>.<span class="property">style</span>.<span class="property">padding</span> = <span class="string">&#x27;5px&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">toolbar</span>.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&#x27;#f5f5f5&#x27;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">toolbar</span>.<span class="property">style</span>.<span class="property">borderRadius</span> = <span class="string">&#x27;4px&#x27;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> buttons = [</span><br><span class="line">            &#123; <span class="attr">icon</span>: <span class="string">&#x27;format_bold&#x27;</span>, <span class="attr">command</span>: <span class="string">&#x27;bold&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;加粗&#x27;</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">icon</span>: <span class="string">&#x27;format_italic&#x27;</span>, <span class="attr">command</span>: <span class="string">&#x27;italic&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;斜体&#x27;</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">icon</span>: <span class="string">&#x27;format_underlined&#x27;</span>, <span class="attr">command</span>: <span class="string">&#x27;underline&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;下划线&#x27;</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">icon</span>: <span class="string">&#x27;format_strikethrough&#x27;</span>, <span class="attr">command</span>: <span class="string">&#x27;strikeThrough&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;删除线&#x27;</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">separator</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">icon</span>: <span class="string">&#x27;format_list_bulleted&#x27;</span>, <span class="attr">command</span>: <span class="string">&#x27;insertUnorderedList&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;无序列表&#x27;</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">icon</span>: <span class="string">&#x27;format_list_numbered&#x27;</span>, <span class="attr">command</span>: <span class="string">&#x27;insertOrderedList&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;有序列表&#x27;</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">icon</span>: <span class="string">&#x27;format_quote&#x27;</span>, <span class="attr">command</span>: <span class="string">&#x27;blockquote&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;引用&#x27;</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">separator</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">icon</span>: <span class="string">&#x27;insert_link&#x27;</span>, <span class="attr">command</span>: <span class="string">&#x27;createLink&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;链接&#x27;</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">icon</span>: <span class="string">&#x27;insert_photo&#x27;</span>, <span class="attr">action</span>: <span class="string">&#x27;insertImage&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;插入图片&#x27;</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">icon</span>: <span class="string">&#x27;code&#x27;</span>, <span class="attr">command</span>: <span class="string">&#x27;code&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;代码块&#x27;</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">separator</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">icon</span>: <span class="string">&#x27;undo&#x27;</span>, <span class="attr">command</span>: <span class="string">&#x27;undo&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;撤销&#x27;</span> &#125;,</span><br><span class="line">            &#123; <span class="attr">icon</span>: <span class="string">&#x27;redo&#x27;</span>, <span class="attr">command</span>: <span class="string">&#x27;redo&#x27;</span>, <span class="attr">title</span>: <span class="string">&#x27;重做&#x27;</span> &#125;</span><br><span class="line">        ];</span><br><span class="line">        </span><br><span class="line">        buttons.<span class="title function_">forEach</span>(<span class="function"><span class="params">btn</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (btn.<span class="property">separator</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> separator = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;span&#x27;</span>);</span><br><span class="line">                separator.<span class="property">style</span>.<span class="property">margin</span> = <span class="string">&#x27;0 5px&#x27;</span>;</span><br><span class="line">                separator.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&#x27;#ccc&#x27;</span>;</span><br><span class="line">                separator.<span class="property">textContent</span> = <span class="string">&#x27;|&#x27;</span>;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">toolbar</span>.<span class="title function_">appendChild</span>(separator);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> button = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;button&#x27;</span>);</span><br><span class="line">                button.<span class="property">type</span> = <span class="string">&#x27;button&#x27;</span>;</span><br><span class="line">                button.<span class="property">className</span> = <span class="string">&#x27;toolbar-btn&#x27;</span>;</span><br><span class="line">                button.<span class="property">innerHTML</span> = <span class="string">`&lt;i class=&quot;material-icons&quot;&gt;<span class="subst">$&#123;btn.icon&#125;</span>&lt;/i&gt;`</span>;</span><br><span class="line">                button.<span class="property">title</span> = btn.<span class="property">title</span>;</span><br><span class="line">                button.<span class="property">style</span>.<span class="property">margin</span> = <span class="string">&#x27;0 2px&#x27;</span>;</span><br><span class="line">                button.<span class="property">style</span>.<span class="property">padding</span> = <span class="string">&#x27;5px 8px&#x27;</span>;</span><br><span class="line">                button.<span class="property">style</span>.<span class="property">border</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">                button.<span class="property">style</span>.<span class="property">background</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">                button.<span class="property">style</span>.<span class="property">borderRadius</span> = <span class="string">&#x27;3px&#x27;</span>;</span><br><span class="line">                button.<span class="property">style</span>.<span class="property">cursor</span> = <span class="string">&#x27;pointer&#x27;</span>;</span><br><span class="line">                </span><br><span class="line">                button.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mouseenter&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    button.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&#x27;#e0e0e0&#x27;</span>;</span><br><span class="line">                &#125;);</span><br><span class="line">                </span><br><span class="line">                button.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mouseleave&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    button.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&#x27;transparent&#x27;</span>;</span><br><span class="line">                &#125;);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (btn.<span class="property">command</span>) &#123;</span><br><span class="line">                    button.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="variable language_">this</span>.<span class="title function_">execCommand</span>(btn.<span class="property">command</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (btn.<span class="property">action</span>) &#123;</span><br><span class="line">                    button.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                        <span class="variable language_">this</span>[btn.<span class="property">action</span>]();</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">toolbar</span>.<span class="title function_">appendChild</span>(button);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">container</span>.<span class="title function_">insertBefore</span>(<span class="variable language_">this</span>.<span class="property">toolbar</span>, <span class="variable language_">this</span>.<span class="property">editor</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">execCommand</span>(<span class="params">command, value = <span class="literal">null</span></span>) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">execCommand</span>(command, <span class="literal">false</span>, value);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="title function_">focus</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">insertImage</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;input&#x27;</span>);</span><br><span class="line">        input.<span class="property">type</span> = <span class="string">&#x27;file&#x27;</span>;</span><br><span class="line">        input.<span class="property">accept</span> = <span class="string">&#x27;image/*&#x27;</span>;</span><br><span class="line">        </span><br><span class="line">        input.<span class="property">onchange</span> = <span class="keyword">async</span> (e) =&gt; &#123;</span><br><span class="line">            <span class="keyword">const</span> file = e.<span class="property">target</span>.<span class="property">files</span>[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span> (!file) <span class="keyword">return</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 显示加载状态</span></span><br><span class="line">                <span class="keyword">const</span> placeholder = <span class="variable language_">this</span>.<span class="title function_">insertPlaceholder</span>(<span class="string">&#x27;上传中...&#x27;</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 上传图片</span></span><br><span class="line">                <span class="keyword">const</span> url = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">uploadImage</span>(file);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 插入图片到编辑器</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">execCommand</span>(<span class="string">&#x27;insertHTML&#x27;</span>, </span><br><span class="line">                    <span class="string">`&lt;img src=&quot;<span class="subst">$&#123;url&#125;</span>&quot; alt=&quot;<span class="subst">$&#123;file.name&#125;</span>&quot; style=&quot;max-width: 100%;&quot;&gt;`</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 移除占位符</span></span><br><span class="line">                placeholder.<span class="title function_">remove</span>();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;图片上传失败:&#x27;</span>, error);</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&#x27;图片上传失败&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        input.<span class="title function_">click</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="title function_">uploadImage</span>(<span class="params">file</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">        formData.<span class="title function_">append</span>(<span class="string">&#x27;file&#x27;</span>, file);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">uploadUrl</span>, &#123;</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">            <span class="attr">headers</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">`Bearer <span class="subst">$&#123;<span class="variable language_">localStorage</span>.getItem(<span class="string">&#x27;token&#x27;</span>)&#125;</span>`</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">body</span>: formData</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;上传失败&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">        <span class="keyword">return</span> data.<span class="property">url</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">insertPlaceholder</span>(<span class="params">text</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> placeholder = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;span&#x27;</span>);</span><br><span class="line">        placeholder.<span class="property">className</span> = <span class="string">&#x27;upload-placeholder&#x27;</span>;</span><br><span class="line">        placeholder.<span class="property">textContent</span> = text;</span><br><span class="line">        placeholder.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&#x27;#999&#x27;</span>;</span><br><span class="line">        placeholder.<span class="property">style</span>.<span class="property">fontStyle</span> = <span class="string">&#x27;italic&#x27;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> selection = <span class="variable language_">window</span>.<span class="title function_">getSelection</span>();</span><br><span class="line">        <span class="keyword">const</span> range = selection.<span class="title function_">getRangeAt</span>(<span class="number">0</span>);</span><br><span class="line">        range.<span class="title function_">deleteContents</span>();</span><br><span class="line">        range.<span class="title function_">insertNode</span>(placeholder);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> placeholder;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">bindEvents</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 自动保存</span></span><br><span class="line">        <span class="keyword">let</span> saveTimer;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;input&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">clearTimeout</span>(saveTimer);</span><br><span class="line">            saveTimer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">autoSave</span>();</span><br><span class="line">            &#125;, <span class="number">1000</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 粘贴事件处理</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;paste&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">            e.<span class="title function_">preventDefault</span>();</span><br><span class="line">            <span class="keyword">const</span> text = e.<span class="property">clipboardData</span>.<span class="title function_">getData</span>(<span class="string">&#x27;text/plain&#x27;</span>);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">execCommand</span>(<span class="string">&#x27;insertText&#x27;</span>, <span class="literal">false</span>, text);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 拖放图片</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;drop&#x27;</span>, <span class="keyword">async</span> (e) =&gt; &#123;</span><br><span class="line">            e.<span class="title function_">preventDefault</span>();</span><br><span class="line">            <span class="keyword">const</span> files = e.<span class="property">dataTransfer</span>.<span class="property">files</span>;</span><br><span class="line">            <span class="keyword">if</span> (files.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">const</span> file <span class="keyword">of</span> files) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (file.<span class="property">type</span>.<span class="title function_">startsWith</span>(<span class="string">&#x27;image/&#x27;</span>)) &#123;</span><br><span class="line">                        <span class="keyword">const</span> url = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">uploadImage</span>(file);</span><br><span class="line">                        <span class="variable language_">this</span>.<span class="title function_">execCommand</span>(<span class="string">&#x27;insertHTML&#x27;</span>,</span><br><span class="line">                            <span class="string">`&lt;img src=&quot;<span class="subst">$&#123;url&#125;</span>&quot; alt=&quot;<span class="subst">$&#123;file.name&#125;</span>&quot; style=&quot;max-width: 100%;&quot;&gt;`</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;dragover&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">            e.<span class="title function_">preventDefault</span>();</span><br><span class="line">            e.<span class="property">dataTransfer</span>.<span class="property">dropEffect</span> = <span class="string">&#x27;copy&#x27;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">autoSave</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> content = <span class="variable language_">this</span>.<span class="title function_">getContent</span>();</span><br><span class="line">        <span class="keyword">if</span> (content !== <span class="variable language_">this</span>.<span class="property">content</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">content</span> = content;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">onAutoSave</span>?.(content);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">getContent</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="property">innerHTML</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">setContent</span>(<span class="params">html</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="property">innerHTML</span> = html;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">content</span> = html;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">getText</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="property">textContent</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">focus</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="title function_">focus</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">destroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">toolbar</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">toolbar</span>.<span class="title function_">remove</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">editor</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">editor</span>.<span class="title function_">remove</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-添加图表分析组件"><a href="#4-添加图表分析组件" class="headerlink" title="4. 添加图表分析组件"></a>4. 添加图表分析组件</h3><p><strong>js&#x2F;components&#x2F;charts.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 图表组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">BlogCharts</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">charts</span> = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">colors</span> = [</span><br><span class="line">            <span class="string">&#x27;#007bff&#x27;</span>, <span class="string">&#x27;#28a745&#x27;</span>, <span class="string">&#x27;#dc3545&#x27;</span>, <span class="string">&#x27;#ffc107&#x27;</span>, <span class="string">&#x27;#17a2b8&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;#6c757d&#x27;</span>, <span class="string">&#x27;#6610f2&#x27;</span>, <span class="string">&#x27;#fd7e14&#x27;</span>, <span class="string">&#x27;#e83e8c&#x27;</span>, <span class="string">&#x27;#20c997&#x27;</span></span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">renderArticleStats</span>(<span class="params">containerId, stats</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(containerId);</span><br><span class="line">        <span class="keyword">if</span> (!container) <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">        container.<span class="title function_">appendChild</span>(canvas);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> chart = <span class="keyword">new</span> <span class="title class_">Chart</span>(ctx, &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;</span><br><span class="line">                <span class="attr">labels</span>: stats.<span class="property">months</span>,</span><br><span class="line">                <span class="attr">datasets</span>: [&#123;</span><br><span class="line">                    <span class="attr">label</span>: <span class="string">&#x27;发布文章数&#x27;</span>,</span><br><span class="line">                    <span class="attr">data</span>: stats.<span class="property">articleCounts</span>,</span><br><span class="line">                    <span class="attr">backgroundColor</span>: <span class="variable language_">this</span>.<span class="property">colors</span>[<span class="number">0</span>],</span><br><span class="line">                    <span class="attr">borderColor</span>: <span class="variable language_">this</span>.<span class="property">colors</span>[<span class="number">0</span>],</span><br><span class="line">                    <span class="attr">borderWidth</span>: <span class="number">1</span></span><br><span class="line">                &#125;, &#123;</span><br><span class="line">                    <span class="attr">label</span>: <span class="string">&#x27;阅读量&#x27;</span>,</span><br><span class="line">                    <span class="attr">data</span>: stats.<span class="property">viewCounts</span>,</span><br><span class="line">                    <span class="attr">backgroundColor</span>: <span class="variable language_">this</span>.<span class="property">colors</span>[<span class="number">1</span>],</span><br><span class="line">                    <span class="attr">borderColor</span>: <span class="variable language_">this</span>.<span class="property">colors</span>[<span class="number">1</span>],</span><br><span class="line">                    <span class="attr">borderWidth</span>: <span class="number">1</span></span><br><span class="line">                &#125;]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">                <span class="attr">responsive</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">scales</span>: &#123;</span><br><span class="line">                    <span class="attr">y</span>: &#123;</span><br><span class="line">                        <span class="attr">beginAtZero</span>: <span class="literal">true</span>,</span><br><span class="line">                        <span class="attr">ticks</span>: &#123;</span><br><span class="line">                            <span class="attr">stepSize</span>: <span class="number">1</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">charts</span>.<span class="title function_">set</span>(containerId, chart);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">renderTagCloud</span>(<span class="params">containerId, tags</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(containerId);</span><br><span class="line">        <span class="keyword">if</span> (!container) <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">        container.<span class="property">innerHTML</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 计算标签大小范围</span></span><br><span class="line">        <span class="keyword">const</span> counts = tags.<span class="title function_">map</span>(<span class="function"><span class="params">t</span> =&gt;</span> t.<span class="property">count</span>);</span><br><span class="line">        <span class="keyword">const</span> minCount = <span class="title class_">Math</span>.<span class="title function_">min</span>(...counts);</span><br><span class="line">        <span class="keyword">const</span> maxCount = <span class="title class_">Math</span>.<span class="title function_">max</span>(...counts);</span><br><span class="line">        <span class="keyword">const</span> minSize = <span class="number">12</span>;</span><br><span class="line">        <span class="keyword">const</span> maxSize = <span class="number">32</span>;</span><br><span class="line">        </span><br><span class="line">        tags.<span class="title function_">forEach</span>(<span class="function">(<span class="params">tag, index</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> size = minSize + (tag.<span class="property">count</span> - minCount) * (maxSize - minSize) / (maxCount - minCount);</span><br><span class="line">            <span class="keyword">const</span> color = <span class="variable language_">this</span>.<span class="property">colors</span>[index % <span class="variable language_">this</span>.<span class="property">colors</span>.<span class="property">length</span>];</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">const</span> tagElement = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">            tagElement.<span class="property">href</span> = <span class="string">`/tag/<span class="subst">$&#123;tag.id&#125;</span>`</span>;</span><br><span class="line">            tagElement.<span class="property">className</span> = <span class="string">&#x27;tag-cloud-item&#x27;</span>;</span><br><span class="line">            tagElement.<span class="property">textContent</span> = tag.<span class="property">name</span>;</span><br><span class="line">            tagElement.<span class="property">style</span>.<span class="property">fontSize</span> = <span class="string">`<span class="subst">$&#123;size&#125;</span>px`</span>;</span><br><span class="line">            tagElement.<span class="property">style</span>.<span class="property">color</span> = color;</span><br><span class="line">            tagElement.<span class="property">style</span>.<span class="property">margin</span> = <span class="string">&#x27;5px 10px&#x27;</span>;</span><br><span class="line">            tagElement.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;inline-block&#x27;</span>;</span><br><span class="line">            tagElement.<span class="property">style</span>.<span class="property">textDecoration</span> = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">            tagElement.<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&#x27;0.8&#x27;</span>;</span><br><span class="line">            tagElement.<span class="property">style</span>.<span class="property">transition</span> = <span class="string">&#x27;all 0.3s ease&#x27;</span>;</span><br><span class="line">            </span><br><span class="line">            tagElement.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mouseenter&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                tagElement.<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">                tagElement.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">&#x27;translateY(-2px)&#x27;</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">            tagElement.<span class="title function_">addEventListener</span>(<span class="string">&#x27;mouseleave&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                tagElement.<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&#x27;0.8&#x27;</span>;</span><br><span class="line">                tagElement.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">&#x27;translateY(0)&#x27;</span>;</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 添加计数</span></span><br><span class="line">            <span class="keyword">const</span> count = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;span&#x27;</span>);</span><br><span class="line">            count.<span class="property">textContent</span> = <span class="string">`(<span class="subst">$&#123;tag.count&#125;</span>)`</span>;</span><br><span class="line">            count.<span class="property">style</span>.<span class="property">fontSize</span> = <span class="string">`<span class="subst">$&#123;size * <span class="number">0.7</span>&#125;</span>px`</span>;</span><br><span class="line">            count.<span class="property">style</span>.<span class="property">marginLeft</span> = <span class="string">&#x27;5px&#x27;</span>;</span><br><span class="line">            count.<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&#x27;0.7&#x27;</span>;</span><br><span class="line">            tagElement.<span class="title function_">appendChild</span>(count);</span><br><span class="line">            </span><br><span class="line">            container.<span class="title function_">appendChild</span>(tagElement);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">renderUserActivity</span>(<span class="params">containerId, activity</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(containerId);</span><br><span class="line">        <span class="keyword">if</span> (!container) <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">        container.<span class="title function_">appendChild</span>(canvas);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> chart = <span class="keyword">new</span> <span class="title class_">Chart</span>(ctx, &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;</span><br><span class="line">                <span class="attr">labels</span>: activity.<span class="property">dates</span>,</span><br><span class="line">                <span class="attr">datasets</span>: [&#123;</span><br><span class="line">                    <span class="attr">label</span>: <span class="string">&#x27;发表文章&#x27;</span>,</span><br><span class="line">                    <span class="attr">data</span>: activity.<span class="property">articles</span>,</span><br><span class="line">                    <span class="attr">borderColor</span>: <span class="variable language_">this</span>.<span class="property">colors</span>[<span class="number">0</span>],</span><br><span class="line">                    <span class="attr">backgroundColor</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.colors[<span class="number">0</span>]&#125;</span>20`</span>,</span><br><span class="line">                    <span class="attr">tension</span>: <span class="number">0.3</span>,</span><br><span class="line">                    <span class="attr">fill</span>: <span class="literal">true</span></span><br><span class="line">                &#125;, &#123;</span><br><span class="line">                    <span class="attr">label</span>: <span class="string">&#x27;发表评论&#x27;</span>,</span><br><span class="line">                    <span class="attr">data</span>: activity.<span class="property">comments</span>,</span><br><span class="line">                    <span class="attr">borderColor</span>: <span class="variable language_">this</span>.<span class="property">colors</span>[<span class="number">1</span>],</span><br><span class="line">                    <span class="attr">backgroundColor</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.colors[<span class="number">1</span>]&#125;</span>20`</span>,</span><br><span class="line">                    <span class="attr">tension</span>: <span class="number">0.3</span>,</span><br><span class="line">                    <span class="attr">fill</span>: <span class="literal">true</span></span><br><span class="line">                &#125;]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">                <span class="attr">responsive</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">interaction</span>: &#123;</span><br><span class="line">                    <span class="attr">intersect</span>: <span class="literal">false</span>,</span><br><span class="line">                    <span class="attr">mode</span>: <span class="string">&#x27;index&#x27;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">scales</span>: &#123;</span><br><span class="line">                    <span class="attr">y</span>: &#123;</span><br><span class="line">                        <span class="attr">beginAtZero</span>: <span class="literal">true</span>,</span><br><span class="line">                        <span class="attr">ticks</span>: &#123;</span><br><span class="line">                            <span class="attr">stepSize</span>: <span class="number">1</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">charts</span>.<span class="title function_">set</span>(containerId, chart);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">renderCategoryDistribution</span>(<span class="params">containerId, categories</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(containerId);</span><br><span class="line">        <span class="keyword">if</span> (!container) <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">        container.<span class="title function_">appendChild</span>(canvas);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> chart = <span class="keyword">new</span> <span class="title class_">Chart</span>(ctx, &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;pie&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: &#123;</span><br><span class="line">                <span class="attr">labels</span>: categories.<span class="title function_">map</span>(<span class="function"><span class="params">c</span> =&gt;</span> c.<span class="property">name</span>),</span><br><span class="line">                <span class="attr">datasets</span>: [&#123;</span><br><span class="line">                    <span class="attr">data</span>: categories.<span class="title function_">map</span>(<span class="function"><span class="params">c</span> =&gt;</span> c.<span class="property">count</span>),</span><br><span class="line">                    <span class="attr">backgroundColor</span>: <span class="variable language_">this</span>.<span class="property">colors</span>.<span class="title function_">slice</span>(<span class="number">0</span>, categories.<span class="property">length</span>),</span><br><span class="line">                    <span class="attr">borderWidth</span>: <span class="number">1</span></span><br><span class="line">                &#125;]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">                <span class="attr">responsive</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">plugins</span>: &#123;</span><br><span class="line">                    <span class="attr">legend</span>: &#123;</span><br><span class="line">                        <span class="attr">position</span>: <span class="string">&#x27;right&#x27;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">tooltip</span>: &#123;</span><br><span class="line">                        <span class="attr">callbacks</span>: &#123;</span><br><span class="line">                            <span class="attr">label</span>: <span class="function">(<span class="params">context</span>) =&gt;</span> &#123;</span><br><span class="line">                                <span class="keyword">const</span> label = context.<span class="property">label</span> || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                                <span class="keyword">const</span> value = context.<span class="property">raw</span> || <span class="number">0</span>;</span><br><span class="line">                                <span class="keyword">const</span> total = context.<span class="property">dataset</span>.<span class="property">data</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b, <span class="number">0</span>);</span><br><span class="line">                                <span class="keyword">const</span> percentage = <span class="title class_">Math</span>.<span class="title function_">round</span>((value / total) * <span class="number">100</span>);</span><br><span class="line">                                <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;label&#125;</span>: <span class="subst">$&#123;value&#125;</span> (<span class="subst">$&#123;percentage&#125;</span>%)`</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">charts</span>.<span class="title function_">set</span>(containerId, chart);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">destroy</span>(<span class="params">containerId</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> chart = <span class="variable language_">this</span>.<span class="property">charts</span>.<span class="title function_">get</span>(containerId);</span><br><span class="line">        <span class="keyword">if</span> (chart) &#123;</span><br><span class="line">            chart.<span class="title function_">destroy</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">charts</span>.<span class="title function_">delete</span>(containerId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">destroyAll</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">charts</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">chart</span> =&gt;</span> chart.<span class="title function_">destroy</span>());</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">charts</span>.<span class="title function_">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="5-添加SEO优化组件"><a href="#5-添加SEO优化组件" class="headerlink" title="5. 添加SEO优化组件"></a>5. 添加SEO优化组件</h3><p><strong>js&#x2F;seo.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SEO优化</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">SEO</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">metaTags</span> = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">init</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">init</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// 监听路由变化</span></span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;popstate&#x27;</span>, <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">update</span>());</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (e.<span class="property">target</span>.<span class="title function_">matches</span>(<span class="string">&#x27;[data-link]&#x27;</span>)) &#123;</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">update</span>(), <span class="number">100</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> path = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span>;</span><br><span class="line">        <span class="keyword">const</span> title = <span class="variable language_">this</span>.<span class="title function_">getPageTitle</span>(path);</span><br><span class="line">        <span class="keyword">const</span> description = <span class="variable language_">this</span>.<span class="title function_">getPageDescription</span>(path);</span><br><span class="line">        <span class="keyword">const</span> keywords = <span class="variable language_">this</span>.<span class="title function_">getPageKeywords</span>(path);</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setTitle</span>(title);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setMeta</span>(<span class="string">&#x27;description&#x27;</span>, description);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setMeta</span>(<span class="string">&#x27;keywords&#x27;</span>, keywords);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置Open Graph标签</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setOGTags</span>(path);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置Twitter Card标签</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setTwitterTags</span>(path);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 更新canonical链接</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setCanonicalLink</span>(path);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">getPageTitle</span>(<span class="params">path</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> titles = &#123;</span><br><span class="line">            <span class="string">&#x27;/&#x27;</span>: <span class="string">&#x27;个人博客 - 分享技术与生活&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/about&#x27;</span>: <span class="string">&#x27;关于我们 - 个人博客&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/contact&#x27;</span>: <span class="string">&#x27;联系我们 - 个人博客&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/login&#x27;</span>: <span class="string">&#x27;登录 - 个人博客&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/register&#x27;</span>: <span class="string">&#x27;注册 - 个人博客&#x27;</span></span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 文章页面</span></span><br><span class="line">        <span class="keyword">if</span> (path.<span class="title function_">startsWith</span>(<span class="string">&#x27;/article/&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">const</span> articleTitle = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.article-title&#x27;</span>)?.<span class="property">textContent</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;articleTitle&#125;</span> - 个人博客`</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 分类页面</span></span><br><span class="line">        <span class="keyword">if</span> (path.<span class="title function_">startsWith</span>(<span class="string">&#x27;/category/&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">const</span> categoryName = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.category-name&#x27;</span>)?.<span class="property">textContent</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;categoryName&#125;</span> - 文章分类 - 个人博客`</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> titles[path] || <span class="string">&#x27;个人博客&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">getPageDescription</span>(<span class="params">path</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> descriptions = &#123;</span><br><span class="line">            <span class="string">&#x27;/&#x27;</span>: <span class="string">&#x27;一个技术爱好者的个人博客，分享编程经验、技术文章和生活感悟&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/about&#x27;</span>: <span class="string">&#x27;了解我们的博客故事和团队&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;/contact&#x27;</span>: <span class="string">&#x27;有任何问题或建议，欢迎联系我们&#x27;</span></span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (path.<span class="title function_">startsWith</span>(<span class="string">&#x27;/article/&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">const</span> excerpt = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.article-excerpt&#x27;</span>)?.<span class="property">textContent</span>;</span><br><span class="line">            <span class="keyword">return</span> excerpt || <span class="string">&#x27;阅读技术文章，学习编程知识&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> descriptions[path] || <span class="string">&#x27;个人技术博客，分享有价值的技术内容&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">getPageKeywords</span>(<span class="params">path</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> keywords = [<span class="string">&#x27;博客&#x27;</span>, <span class="string">&#x27;技术&#x27;</span>, <span class="string">&#x27;编程&#x27;</span>, <span class="string">&#x27;开发&#x27;</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (path.<span class="title function_">startsWith</span>(<span class="string">&#x27;/article/&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">const</span> tagElements = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.article-tags .tag&#x27;</span>);</span><br><span class="line">            <span class="keyword">const</span> tags = <span class="title class_">Array</span>.<span class="title function_">from</span>(tagElements).<span class="title function_">map</span>(<span class="function"><span class="params">el</span> =&gt;</span> el.<span class="property">textContent</span>);</span><br><span class="line">            <span class="keyword">return</span> [...keywords, ...tags].<span class="title function_">join</span>(<span class="string">&#x27;, &#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> keywords.<span class="title function_">join</span>(<span class="string">&#x27;, &#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">setTitle</span>(<span class="params">title</span>) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">title</span> = title;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setMeta</span>(<span class="string">&#x27;og:title&#x27;</span>, title);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setMeta</span>(<span class="string">&#x27;twitter:title&#x27;</span>, title);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">setMeta</span>(<span class="params">name, content</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!content) <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> meta = <span class="variable language_">this</span>.<span class="property">metaTags</span>.<span class="title function_">get</span>(name);</span><br><span class="line">        <span class="keyword">if</span> (!meta) &#123;</span><br><span class="line">            meta = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;meta&#x27;</span>);</span><br><span class="line">            meta.<span class="title function_">setAttribute</span>(<span class="string">&#x27;name&#x27;</span>, name);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(meta);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">metaTags</span>.<span class="title function_">set</span>(name, meta);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        meta.<span class="title function_">setAttribute</span>(<span class="string">&#x27;content&#x27;</span>, content);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 同时设置property属性（用于Open Graph）</span></span><br><span class="line">        <span class="keyword">if</span> (name.<span class="title function_">startsWith</span>(<span class="string">&#x27;og:&#x27;</span>)) &#123;</span><br><span class="line">            meta.<span class="title function_">setAttribute</span>(<span class="string">&#x27;property&#x27;</span>, name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">setOGTags</span>(<span class="params">path</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> url = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>;</span><br><span class="line">        <span class="keyword">const</span> image = <span class="variable language_">this</span>.<span class="title function_">getPageImage</span>(path);</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setMeta</span>(<span class="string">&#x27;og:type&#x27;</span>, <span class="string">&#x27;website&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setMeta</span>(<span class="string">&#x27;og:url&#x27;</span>, url);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setMeta</span>(<span class="string">&#x27;og:image&#x27;</span>, image);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setMeta</span>(<span class="string">&#x27;og:locale&#x27;</span>, <span class="string">&#x27;zh_CN&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setMeta</span>(<span class="string">&#x27;og:site_name&#x27;</span>, <span class="string">&#x27;个人博客&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">setTwitterTags</span>(<span class="params">path</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setMeta</span>(<span class="string">&#x27;twitter:card&#x27;</span>, <span class="string">&#x27;summary_large_image&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setMeta</span>(<span class="string">&#x27;twitter:site&#x27;</span>, <span class="string">&#x27;@blog&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setMeta</span>(<span class="string">&#x27;twitter:creator&#x27;</span>, <span class="string">&#x27;@author&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setMeta</span>(<span class="string">&#x27;twitter:image&#x27;</span>, <span class="variable language_">this</span>.<span class="title function_">getPageImage</span>(path));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">getPageImage</span>(<span class="params">path</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (path.<span class="title function_">startsWith</span>(<span class="string">&#x27;/article/&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">const</span> image = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.article-cover img&#x27;</span>)?.<span class="property">src</span> ||</span><br><span class="line">                         <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.article-content img&#x27;</span>)?.<span class="property">src</span>;</span><br><span class="line">            <span class="keyword">return</span> image || <span class="string">&#x27;https://example.com/default-image.jpg&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;https://example.com/logo.png&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">setCanonicalLink</span>(<span class="params">path</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> link = <span class="variable language_">this</span>.<span class="property">metaTags</span>.<span class="title function_">get</span>(<span class="string">&#x27;canonical&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!link) &#123;</span><br><span class="line">            link = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;link&#x27;</span>);</span><br><span class="line">            link.<span class="title function_">setAttribute</span>(<span class="string">&#x27;rel&#x27;</span>, <span class="string">&#x27;canonical&#x27;</span>);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(link);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">metaTags</span>.<span class="title function_">set</span>(<span class="string">&#x27;canonical&#x27;</span>, link);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> url = <span class="string">`https://blog.example.com<span class="subst">$&#123;path&#125;</span>`</span>;</span><br><span class="line">        link.<span class="title function_">setAttribute</span>(<span class="string">&#x27;href&#x27;</span>, url);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置hreflang标签</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setHreflangTags</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">setHreflangTags</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> languages = [<span class="string">&#x27;zh-CN&#x27;</span>, <span class="string">&#x27;en-US&#x27;</span>];</span><br><span class="line">        <span class="keyword">const</span> currentUrl = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>;</span><br><span class="line">        </span><br><span class="line">        languages.<span class="title function_">forEach</span>(<span class="function"><span class="params">lang</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> key = <span class="string">`hreflang-<span class="subst">$&#123;lang&#125;</span>`</span>;</span><br><span class="line">            <span class="keyword">let</span> link = <span class="variable language_">this</span>.<span class="property">metaTags</span>.<span class="title function_">get</span>(key);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (!link) &#123;</span><br><span class="line">                link = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;link&#x27;</span>);</span><br><span class="line">                link.<span class="title function_">setAttribute</span>(<span class="string">&#x27;rel&#x27;</span>, <span class="string">&#x27;alternate&#x27;</span>);</span><br><span class="line">                link.<span class="title function_">setAttribute</span>(<span class="string">&#x27;hreflang&#x27;</span>, lang);</span><br><span class="line">                <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(link);</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">metaTags</span>.<span class="title function_">set</span>(key, link);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 这里应该根据语言生成对应的URL</span></span><br><span class="line">            link.<span class="title function_">setAttribute</span>(<span class="string">&#x27;href&#x27;</span>, currentUrl.<span class="title function_">replace</span>(<span class="string">&#x27;/zh/&#x27;</span>, <span class="string">`/<span class="subst">$&#123;lang.split(<span class="string">&#x27;-&#x27;</span>)[<span class="number">0</span>]&#125;</span>/`</span>));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">generateStructuredData</span>(<span class="params">article</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> structuredData = &#123;</span><br><span class="line">            <span class="string">&#x27;@context&#x27;</span>: <span class="string">&#x27;https://schema.org&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;@type&#x27;</span>: <span class="string">&#x27;BlogPosting&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;headline&#x27;</span>: article.<span class="property">title</span>,</span><br><span class="line">            <span class="string">&#x27;description&#x27;</span>: article.<span class="property">summary</span>,</span><br><span class="line">            <span class="string">&#x27;author&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;@type&#x27;</span>: <span class="string">&#x27;Person&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;name&#x27;</span>: article.<span class="property">author</span>.<span class="property">displayName</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&#x27;publisher&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;@type&#x27;</span>: <span class="string">&#x27;Organization&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;个人博客&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;logo&#x27;</span>: &#123;</span><br><span class="line">                    <span class="string">&#x27;@type&#x27;</span>: <span class="string">&#x27;ImageObject&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;url&#x27;</span>: <span class="string">&#x27;https://blog.example.com/logo.png&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&#x27;datePublished&#x27;</span>: article.<span class="property">publishedAt</span>,</span><br><span class="line">            <span class="string">&#x27;dateModified&#x27;</span>: article.<span class="property">updatedAt</span>,</span><br><span class="line">            <span class="string">&#x27;image&#x27;</span>: article.<span class="property">coverImage</span>,</span><br><span class="line">            <span class="string">&#x27;mainEntityOfPage&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;@type&#x27;</span>: <span class="string">&#x27;WebPage&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;@id&#x27;</span>: <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">        script.<span class="property">type</span> = <span class="string">&#x27;application/ld+json&#x27;</span>;</span><br><span class="line">        script.<span class="property">textContent</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(structuredData);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(script);</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">structuredDataScript</span> = script;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">removeStructuredData</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">structuredDataScript</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">structuredDataScript</span>.<span class="title function_">remove</span>();</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">structuredDataScript</span> = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">generateBreadcrumb</span>(<span class="params">items</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> breadcrumbData = &#123;</span><br><span class="line">            <span class="string">&#x27;@context&#x27;</span>: <span class="string">&#x27;https://schema.org&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;@type&#x27;</span>: <span class="string">&#x27;BreadcrumbList&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;itemListElement&#x27;</span>: items.<span class="title function_">map</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> (&#123;</span><br><span class="line">                <span class="string">&#x27;@type&#x27;</span>: <span class="string">&#x27;ListItem&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;position&#x27;</span>: index + <span class="number">1</span>,</span><br><span class="line">                <span class="string">&#x27;name&#x27;</span>: item.<span class="property">name</span>,</span><br><span class="line">                <span class="string">&#x27;item&#x27;</span>: item.<span class="property">url</span></span><br><span class="line">            &#125;))</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>);</span><br><span class="line">        script.<span class="property">type</span> = <span class="string">&#x27;application/ld+json&#x27;</span>;</span><br><span class="line">        script.<span class="property">textContent</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(breadcrumbData);</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(script);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="第三部分：高级功能页面"><a href="#第三部分：高级功能页面" class="headerlink" title="第三部分：高级功能页面"></a>第三部分：高级功能页面</h2><h3 id="1-管理后台页面"><a href="#1-管理后台页面" class="headerlink" title="1. 管理后台页面"></a>1. 管理后台页面</h3><p><strong>admin.html</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;zh-CN&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;管理后台 - 个人博客&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;css/admin.css&quot;&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css&quot;&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.css&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body class=&quot;admin-body&quot;&gt;</span><br><span class="line">    &lt;!-- 侧边栏 --&gt;</span><br><span class="line">    &lt;aside class=&quot;admin-sidebar&quot; id=&quot;sidebar&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;sidebar-header&quot;&gt;</span><br><span class="line">            &lt;h2&gt;&lt;i class=&quot;fas fa-tachometer-alt&quot;&gt;&lt;/i&gt; 管理后台&lt;/h2&gt;</span><br><span class="line">            &lt;button class=&quot;sidebar-toggle&quot; id=&quot;sidebar-toggle&quot;&gt;</span><br><span class="line">                &lt;i class=&quot;fas fa-bars&quot;&gt;&lt;/i&gt;</span><br><span class="line">            &lt;/button&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;nav class=&quot;sidebar-nav&quot;&gt;</span><br><span class="line">            &lt;ul class=&quot;nav-menu&quot;&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#dashboard&quot; class=&quot;nav-link active&quot; data-module=&quot;dashboard&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-home&quot;&gt;&lt;/i&gt; 仪表盘</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#articles&quot; class=&quot;nav-link&quot; data-module=&quot;articles&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-newspaper&quot;&gt;&lt;/i&gt; 文章管理</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#comments&quot; class=&quot;nav-link&quot; data-module=&quot;comments&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-comments&quot;&gt;&lt;/i&gt; 评论管理</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#categories&quot; class=&quot;nav-link&quot; data-module=&quot;categories&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-folder&quot;&gt;&lt;/i&gt; 分类管理</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#tags&quot; class=&quot;nav-link&quot; data-module=&quot;tags&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-tags&quot;&gt;&lt;/i&gt; 标签管理</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#users&quot; class=&quot;nav-link&quot; data-module=&quot;users&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-users&quot;&gt;&lt;/i&gt; 用户管理</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#media&quot; class=&quot;nav-link&quot; data-module=&quot;media&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-images&quot;&gt;&lt;/i&gt; 媒体库</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#settings&quot; class=&quot;nav-link&quot; data-module=&quot;settings&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-cog&quot;&gt;&lt;/i&gt; 系统设置</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">                &lt;li class=&quot;nav-item&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#analytics&quot; class=&quot;nav-link&quot; data-module=&quot;analytics&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-chart-bar&quot;&gt;&lt;/i&gt; 数据分析</span><br><span class="line">                    &lt;/a&gt;</span><br><span class="line">                &lt;/li&gt;</span><br><span class="line">            &lt;/ul&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;div class=&quot;sidebar-footer&quot;&gt;</span><br><span class="line">                &lt;a href=&quot;/&quot; class=&quot;btn btn-outline&quot;&gt;</span><br><span class="line">                    &lt;i class=&quot;fas fa-globe&quot;&gt;&lt;/i&gt; 查看网站</span><br><span class="line">                &lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/nav&gt;</span><br><span class="line">    &lt;/aside&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 主内容区 --&gt;</span><br><span class="line">    &lt;main class=&quot;admin-main&quot;&gt;</span><br><span class="line">        &lt;!-- 顶部导航栏 --&gt;</span><br><span class="line">        &lt;header class=&quot;admin-header&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;header-left&quot;&gt;</span><br><span class="line">                &lt;h1 id=&quot;page-title&quot;&gt;仪表盘&lt;/h1&gt;</span><br><span class="line">                &lt;nav class=&quot;breadcrumb&quot; id=&quot;breadcrumb&quot;&gt;</span><br><span class="line">                    &lt;a href=&quot;#dashboard&quot;&gt;首页&lt;/a&gt;</span><br><span class="line">                &lt;/nav&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;div class=&quot;header-right&quot;&gt;</span><br><span class="line">                &lt;div class=&quot;user-info&quot;&gt;</span><br><span class="line">                    &lt;img src=&quot;assets/images/avatar.jpg&quot; alt=&quot;用户头像&quot; class=&quot;user-avatar&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;user-details&quot;&gt;</span><br><span class="line">                        &lt;span class=&quot;user-name&quot; id=&quot;admin-username&quot;&gt;管理员&lt;/span&gt;</span><br><span class="line">                        &lt;span class=&quot;user-role&quot;&gt;超级管理员&lt;/span&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;button class=&quot;user-menu-btn&quot; id=&quot;user-menu-btn&quot;&gt;</span><br><span class="line">                        &lt;i class=&quot;fas fa-chevron-down&quot;&gt;&lt;/i&gt;</span><br><span class="line">                    &lt;/button&gt;</span><br><span class="line">                    &lt;div class=&quot;user-dropdown&quot; id=&quot;user-dropdown&quot;&gt;</span><br><span class="line">                        &lt;a href=&quot;/profile&quot; data-link&gt;</span><br><span class="line">                            &lt;i class=&quot;fas fa-user&quot;&gt;&lt;/i&gt; 个人资料</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                        &lt;a href=&quot;/settings&quot;&gt;</span><br><span class="line">                            &lt;i class=&quot;fas fa-cog&quot;&gt;&lt;/i&gt; 账户设置</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                        &lt;hr&gt;</span><br><span class="line">                        &lt;a href=&quot;#&quot; id=&quot;logout&quot;&gt;</span><br><span class="line">                            &lt;i class=&quot;fas fa-sign-out-alt&quot;&gt;&lt;/i&gt; 退出登录</span><br><span class="line">                        &lt;/a&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">                </span><br><span class="line">                &lt;button class=&quot;notification-btn&quot; id=&quot;notification-btn&quot;&gt;</span><br><span class="line">                    &lt;i class=&quot;fas fa-bell&quot;&gt;&lt;/i&gt;</span><br><span class="line">                    &lt;span class=&quot;notification-badge&quot; id=&quot;notification-badge&quot;&gt;3&lt;/span&gt;</span><br><span class="line">                &lt;/button&gt;</span><br><span class="line">                </span><br><span class="line">                &lt;div class=&quot;notification-panel&quot; id=&quot;notification-panel&quot;&gt;</span><br><span class="line">                    &lt;div class=&quot;notification-header&quot;&gt;</span><br><span class="line">                        &lt;h3&gt;通知&lt;/h3&gt;</span><br><span class="line">                        &lt;button class=&quot;mark-all-read&quot;&gt;全部标记为已读&lt;/button&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;div class=&quot;notification-list&quot; id=&quot;notification-list&quot;&gt;</span><br><span class="line">                        &lt;!-- 通知列表 --&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/header&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;!-- 页面内容 --&gt;</span><br><span class="line">        &lt;div class=&quot;admin-content&quot; id=&quot;admin-content&quot;&gt;</span><br><span class="line">            &lt;!-- 动态加载模块内容 --&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/main&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 模态框容器 --&gt;</span><br><span class="line">    &lt;div id=&quot;admin-modal-container&quot;&gt;&lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 加载动画 --&gt;</span><br><span class="line">    &lt;div id=&quot;admin-loading&quot; class=&quot;loading-overlay&quot; style=&quot;display: none;&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;loading-spinner&quot;&gt;</span><br><span class="line">            &lt;i class=&quot;fas fa-spinner fa-spin&quot;&gt;&lt;/i&gt;</span><br><span class="line">            &lt;span&gt;加载中...&lt;/span&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!-- 脚本 --&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;js/admin/app.js&quot; type=&quot;module&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<p><strong>css&#x2F;admin.css</strong></p>
<p>css</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br></pre></td><td class="code"><pre><span class="line">/* 管理后台样式 */</span><br><span class="line"></span><br><span class="line">.admin-body &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    margin: 0;</span><br><span class="line">    font-family: -apple-system, BlinkMacSystemFont, &#x27;Segoe UI&#x27;, Roboto, &#x27;Helvetica Neue&#x27;, Arial, sans-serif;</span><br><span class="line">    background-color: #f5f5f5;</span><br><span class="line">    min-height: 100vh;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 侧边栏 */</span><br><span class="line">.admin-sidebar &#123;</span><br><span class="line">    width: 250px;</span><br><span class="line">    background-color: #2c3e50;</span><br><span class="line">    color: #ecf0f1;</span><br><span class="line">    transition: all 0.3s ease;</span><br><span class="line">    position: fixed;</span><br><span class="line">    height: 100vh;</span><br><span class="line">    overflow-y: auto;</span><br><span class="line">    z-index: 1000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.sidebar-header &#123;</span><br><span class="line">    padding: 20px;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    align-items: center;</span><br><span class="line">    border-bottom: 1px solid #34495e;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.sidebar-header h2 &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    font-size: 1.2rem;</span><br><span class="line">    font-weight: 600;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.sidebar-header h2 i &#123;</span><br><span class="line">    margin-right: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.sidebar-toggle &#123;</span><br><span class="line">    background: none;</span><br><span class="line">    border: none;</span><br><span class="line">    color: #ecf0f1;</span><br><span class="line">    font-size: 1.2rem;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    display: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.sidebar-nav &#123;</span><br><span class="line">    padding: 20px 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-menu &#123;</span><br><span class="line">    list-style: none;</span><br><span class="line">    padding: 0;</span><br><span class="line">    margin: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-item &#123;</span><br><span class="line">    margin: 5px 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-link &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    padding: 12px 20px;</span><br><span class="line">    color: #bdc3c7;</span><br><span class="line">    text-decoration: none;</span><br><span class="line">    transition: all 0.3s ease;</span><br><span class="line">    border-left: 3px solid transparent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-link:hover &#123;</span><br><span class="line">    background-color: #34495e;</span><br><span class="line">    color: #ecf0f1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-link.active &#123;</span><br><span class="line">    background-color: #34495e;</span><br><span class="line">    color: #ecf0f1;</span><br><span class="line">    border-left-color: #3498db;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.nav-link i &#123;</span><br><span class="line">    margin-right: 10px;</span><br><span class="line">    width: 20px;</span><br><span class="line">    text-align: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.sidebar-footer &#123;</span><br><span class="line">    padding: 20px;</span><br><span class="line">    margin-top: 20px;</span><br><span class="line">    border-top: 1px solid #34495e;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.sidebar-footer .btn &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    justify-content: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 主内容区 */</span><br><span class="line">.admin-main &#123;</span><br><span class="line">    flex: 1;</span><br><span class="line">    margin-left: 250px;</span><br><span class="line">    transition: all 0.3s ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 头部 */</span><br><span class="line">.admin-header &#123;</span><br><span class="line">    background-color: white;</span><br><span class="line">    padding: 0 30px;</span><br><span class="line">    height: 70px;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    align-items: center;</span><br><span class="line">    box-shadow: 0 2px 4px rgba(0,0,0,0.1);</span><br><span class="line">    position: sticky;</span><br><span class="line">    top: 0;</span><br><span class="line">    z-index: 999;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.header-left h1 &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    font-size: 1.5rem;</span><br><span class="line">    font-weight: 600;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.breadcrumb &#123;</span><br><span class="line">    margin-top: 5px;</span><br><span class="line">    font-size: 0.9rem;</span><br><span class="line">    color: #7f8c8d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.breadcrumb a &#123;</span><br><span class="line">    color: #3498db;</span><br><span class="line">    text-decoration: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.breadcrumb a:hover &#123;</span><br><span class="line">    text-decoration: underline;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.breadcrumb a:not(:last-child)::after &#123;</span><br><span class="line">    content: &#x27;›&#x27;;</span><br><span class="line">    margin: 0 5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.header-right &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    gap: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 用户信息 */</span><br><span class="line">.user-info &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    position: relative;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-avatar &#123;</span><br><span class="line">    width: 40px;</span><br><span class="line">    height: 40px;</span><br><span class="line">    border-radius: 50%;</span><br><span class="line">    object-fit: cover;</span><br><span class="line">    margin-right: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-details &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    flex-direction: column;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-name &#123;</span><br><span class="line">    font-weight: 600;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-role &#123;</span><br><span class="line">    font-size: 0.85rem;</span><br><span class="line">    color: #7f8c8d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-menu-btn &#123;</span><br><span class="line">    background: none;</span><br><span class="line">    border: none;</span><br><span class="line">    color: #7f8c8d;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    padding: 5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-dropdown &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 100%;</span><br><span class="line">    right: 0;</span><br><span class="line">    background-color: white;</span><br><span class="line">    box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span><br><span class="line">    border-radius: 4px;</span><br><span class="line">    min-width: 200px;</span><br><span class="line">    display: none;</span><br><span class="line">    z-index: 1000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-dropdown.show &#123;</span><br><span class="line">    display: block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-dropdown a &#123;</span><br><span class="line">    display: block;</span><br><span class="line">    padding: 12px 20px;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">    text-decoration: none;</span><br><span class="line">    border-bottom: 1px solid #ecf0f1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-dropdown a:hover &#123;</span><br><span class="line">    background-color: #f8f9fa;</span><br><span class="line">    color: #3498db;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-dropdown a i &#123;</span><br><span class="line">    margin-right: 10px;</span><br><span class="line">    width: 20px;</span><br><span class="line">    text-align: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 通知按钮 */</span><br><span class="line">.notification-btn &#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    background: none;</span><br><span class="line">    border: none;</span><br><span class="line">    color: #7f8c8d;</span><br><span class="line">    font-size: 1.2rem;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    padding: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-badge &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 0;</span><br><span class="line">    right: 0;</span><br><span class="line">    background-color: #e74c3c;</span><br><span class="line">    color: white;</span><br><span class="line">    font-size: 0.7rem;</span><br><span class="line">    min-width: 18px;</span><br><span class="line">    height: 18px;</span><br><span class="line">    border-radius: 9px;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    padding: 0 4px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-panel &#123;</span><br><span class="line">    position: absolute;</span><br><span class="line">    top: 100%;</span><br><span class="line">    right: 0;</span><br><span class="line">    background-color: white;</span><br><span class="line">    box-shadow: 0 2px 10px rgba(0,0,0,0.1);</span><br><span class="line">    border-radius: 4px;</span><br><span class="line">    width: 350px;</span><br><span class="line">    max-height: 400px;</span><br><span class="line">    overflow-y: auto;</span><br><span class="line">    display: none;</span><br><span class="line">    z-index: 1000;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-panel.show &#123;</span><br><span class="line">    display: block;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-header &#123;</span><br><span class="line">    padding: 15px 20px;</span><br><span class="line">    border-bottom: 1px solid #ecf0f1;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    align-items: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-header h3 &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    font-size: 1.1rem;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.mark-all-read &#123;</span><br><span class="line">    background: none;</span><br><span class="line">    border: none;</span><br><span class="line">    color: #3498db;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    font-size: 0.9rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-list &#123;</span><br><span class="line">    padding: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-item &#123;</span><br><span class="line">    padding: 15px 20px;</span><br><span class="line">    border-bottom: 1px solid #ecf0f1;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: flex-start;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    transition: background-color 0.3s ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-item:hover &#123;</span><br><span class="line">    background-color: #f8f9fa;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-item.unread &#123;</span><br><span class="line">    background-color: #f8fdff;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-icon &#123;</span><br><span class="line">    margin-right: 15px;</span><br><span class="line">    font-size: 1.2rem;</span><br><span class="line">    color: #3498db;</span><br><span class="line">    flex-shrink: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-content &#123;</span><br><span class="line">    flex: 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-title &#123;</span><br><span class="line">    font-weight: 600;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">    margin-bottom: 5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-text &#123;</span><br><span class="line">    color: #7f8c8d;</span><br><span class="line">    font-size: 0.9rem;</span><br><span class="line">    line-height: 1.4;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.notification-time &#123;</span><br><span class="line">    font-size: 0.8rem;</span><br><span class="line">    color: #95a5a6;</span><br><span class="line">    margin-top: 5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 主内容区 */</span><br><span class="line">.admin-content &#123;</span><br><span class="line">    padding: 30px;</span><br><span class="line">    min-height: calc(100vh - 70px);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 卡片组件 */</span><br><span class="line">.admin-card &#123;</span><br><span class="line">    background-color: white;</span><br><span class="line">    border-radius: 8px;</span><br><span class="line">    box-shadow: 0 2px 4px rgba(0,0,0,0.1);</span><br><span class="line">    margin-bottom: 30px;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.card-header &#123;</span><br><span class="line">    padding: 20px 30px;</span><br><span class="line">    border-bottom: 1px solid #ecf0f1;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    align-items: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.card-header h2 &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    font-size: 1.3rem;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.card-actions &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    gap: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.card-body &#123;</span><br><span class="line">    padding: 30px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.card-footer &#123;</span><br><span class="line">    padding: 20px 30px;</span><br><span class="line">    border-top: 1px solid #ecf0f1;</span><br><span class="line">    background-color: #f8f9fa;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 表格样式 */</span><br><span class="line">.data-table &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    border-collapse: collapse;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.data-table th &#123;</span><br><span class="line">    background-color: #f8f9fa;</span><br><span class="line">    padding: 15px;</span><br><span class="line">    text-align: left;</span><br><span class="line">    font-weight: 600;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">    border-bottom: 1px solid #ecf0f1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.data-table td &#123;</span><br><span class="line">    padding: 15px;</span><br><span class="line">    border-bottom: 1px solid #ecf0f1;</span><br><span class="line">    color: #34495e;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.data-table tr:hover &#123;</span><br><span class="line">    background-color: #f8f9fa;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.data-table .actions &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    gap: 5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 统计卡片 */</span><br><span class="line">.stats-grid &#123;</span><br><span class="line">    display: grid;</span><br><span class="line">    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));</span><br><span class="line">    gap: 20px;</span><br><span class="line">    margin-bottom: 30px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.stat-card &#123;</span><br><span class="line">    background-color: white;</span><br><span class="line">    border-radius: 8px;</span><br><span class="line">    padding: 25px;</span><br><span class="line">    box-shadow: 0 2px 4px rgba(0,0,0,0.1);</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.stat-icon &#123;</span><br><span class="line">    width: 60px;</span><br><span class="line">    height: 60px;</span><br><span class="line">    border-radius: 8px;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    margin-right: 20px;</span><br><span class="line">    font-size: 1.5rem;</span><br><span class="line">    color: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.stat-icon.blue &#123;</span><br><span class="line">    background-color: #3498db;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.stat-icon.green &#123;</span><br><span class="line">    background-color: #2ecc71;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.stat-icon.orange &#123;</span><br><span class="line">    background-color: #e67e22;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.stat-icon.purple &#123;</span><br><span class="line">    background-color: #9b59b6;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.stat-content h3 &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    font-size: 2rem;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">    font-weight: 600;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.stat-content p &#123;</span><br><span class="line">    margin: 5px 0 0;</span><br><span class="line">    color: #7f8c8d;</span><br><span class="line">    font-size: 0.9rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 图表容器 */</span><br><span class="line">.chart-container &#123;</span><br><span class="line">    background-color: white;</span><br><span class="line">    border-radius: 8px;</span><br><span class="line">    padding: 25px;</span><br><span class="line">    box-shadow: 0 2px 4px rgba(0,0,0,0.1);</span><br><span class="line">    margin-bottom: 30px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.chart-header &#123;</span><br><span class="line">    margin-bottom: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.chart-header h3 &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    font-size: 1.2rem;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 表单样式 */</span><br><span class="line">.form-group &#123;</span><br><span class="line">    margin-bottom: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.form-group label &#123;</span><br><span class="line">    display: block;</span><br><span class="line">    margin-bottom: 8px;</span><br><span class="line">    font-weight: 600;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.form-control &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">    padding: 12px 15px;</span><br><span class="line">    border: 1px solid #ddd;</span><br><span class="line">    border-radius: 4px;</span><br><span class="line">    font-size: 1rem;</span><br><span class="line">    transition: border-color 0.3s ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.form-control:focus &#123;</span><br><span class="line">    outline: none;</span><br><span class="line">    border-color: #3498db;</span><br><span class="line">    box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.form-text &#123;</span><br><span class="line">    margin-top: 5px;</span><br><span class="line">    font-size: 0.85rem;</span><br><span class="line">    color: #7f8c8d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.form-check &#123;</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    gap: 10px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.form-check-input &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 按钮样式 */</span><br><span class="line">.btn &#123;</span><br><span class="line">    display: inline-flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    padding: 10px 20px;</span><br><span class="line">    border: none;</span><br><span class="line">    border-radius: 4px;</span><br><span class="line">    font-size: 1rem;</span><br><span class="line">    font-weight: 500;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    transition: all 0.3s ease;</span><br><span class="line">    gap: 8px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-primary &#123;</span><br><span class="line">    background-color: #3498db;</span><br><span class="line">    color: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-primary:hover &#123;</span><br><span class="line">    background-color: #2980b9;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-secondary &#123;</span><br><span class="line">    background-color: #95a5a6;</span><br><span class="line">    color: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-secondary:hover &#123;</span><br><span class="line">    background-color: #7f8c8d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-success &#123;</span><br><span class="line">    background-color: #2ecc71;</span><br><span class="line">    color: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-success:hover &#123;</span><br><span class="line">    background-color: #27ae60;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-danger &#123;</span><br><span class="line">    background-color: #e74c3c;</span><br><span class="line">    color: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-danger:hover &#123;</span><br><span class="line">    background-color: #c0392b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-outline &#123;</span><br><span class="line">    background-color: transparent;</span><br><span class="line">    border: 1px solid #ddd;</span><br><span class="line">    color: #34495e;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-outline:hover &#123;</span><br><span class="line">    background-color: #f8f9fa;</span><br><span class="line">    border-color: #3498db;</span><br><span class="line">    color: #3498db;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-sm &#123;</span><br><span class="line">    padding: 6px 12px;</span><br><span class="line">    font-size: 0.9rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-lg &#123;</span><br><span class="line">    padding: 14px 28px;</span><br><span class="line">    font-size: 1.1rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.btn-block &#123;</span><br><span class="line">    width: 100%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 模态框 */</span><br><span class="line">.modal-overlay &#123;</span><br><span class="line">    position: fixed;</span><br><span class="line">    top: 0;</span><br><span class="line">    left: 0;</span><br><span class="line">    right: 0;</span><br><span class="line">    bottom: 0;</span><br><span class="line">    background-color: rgba(0,0,0,0.5);</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    z-index: 1100;</span><br><span class="line">    padding: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal &#123;</span><br><span class="line">    background-color: white;</span><br><span class="line">    border-radius: 8px;</span><br><span class="line">    max-width: 600px;</span><br><span class="line">    width: 100%;</span><br><span class="line">    max-height: 90vh;</span><br><span class="line">    overflow-y: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal-header &#123;</span><br><span class="line">    padding: 20px 30px;</span><br><span class="line">    border-bottom: 1px solid #ecf0f1;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: space-between;</span><br><span class="line">    align-items: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal-header h3 &#123;</span><br><span class="line">    margin: 0;</span><br><span class="line">    font-size: 1.3rem;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal-close &#123;</span><br><span class="line">    background: none;</span><br><span class="line">    border: none;</span><br><span class="line">    font-size: 1.5rem;</span><br><span class="line">    color: #7f8c8d;</span><br><span class="line">    cursor: pointer;</span><br><span class="line">    padding: 5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal-body &#123;</span><br><span class="line">    padding: 30px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.modal-footer &#123;</span><br><span class="line">    padding: 20px 30px;</span><br><span class="line">    border-top: 1px solid #ecf0f1;</span><br><span class="line">    display: flex;</span><br><span class="line">    justify-content: flex-end;</span><br><span class="line">    gap: 10px;</span><br><span class="line">    background-color: #f8f9fa;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 加载动画 */</span><br><span class="line">.loading-overlay &#123;</span><br><span class="line">    position: fixed;</span><br><span class="line">    top: 0;</span><br><span class="line">    left: 0;</span><br><span class="line">    right: 0;</span><br><span class="line">    bottom: 0;</span><br><span class="line">    background-color: rgba(255, 255, 255, 0.9);</span><br><span class="line">    display: flex;</span><br><span class="line">    align-items: center;</span><br><span class="line">    justify-content: center;</span><br><span class="line">    z-index: 1200;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.loading-spinner &#123;</span><br><span class="line">    text-align: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.loading-spinner i &#123;</span><br><span class="line">    font-size: 3rem;</span><br><span class="line">    color: #3498db;</span><br><span class="line">    margin-bottom: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.loading-spinner span &#123;</span><br><span class="line">    display: block;</span><br><span class="line">    color: #2c3e50;</span><br><span class="line">    font-size: 1.1rem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 响应式设计 */</span><br><span class="line">@media (max-width: 992px) &#123;</span><br><span class="line">    .admin-sidebar &#123;</span><br><span class="line">        transform: translateX(-100%);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .admin-sidebar.show &#123;</span><br><span class="line">        transform: translateX(0);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .admin-main &#123;</span><br><span class="line">        margin-left: 0;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .sidebar-toggle &#123;</span><br><span class="line">        display: block;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .stats-grid &#123;</span><br><span class="line">        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@media (max-width: 768px) &#123;</span><br><span class="line">    .admin-header &#123;</span><br><span class="line">        padding: 0 15px;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .admin-content &#123;</span><br><span class="line">        padding: 15px;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .card-header,</span><br><span class="line">    .card-body,</span><br><span class="line">    .card-footer &#123;</span><br><span class="line">        padding: 15px;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .stats-grid &#123;</span><br><span class="line">        grid-template-columns: 1fr;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    .header-left h1 &#123;</span><br><span class="line">        font-size: 1.2rem;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>js&#x2F;admin&#x2F;app.js</strong></p>
<p>javascript</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line">// 管理后台应用主文件</span><br><span class="line">import &#123; AdminStore &#125; from &#x27;./store.js&#x27;;</span><br><span class="line">import &#123; AdminAPI &#125; from &#x27;./api.js&#x27;;</span><br><span class="line">import &#123; AdminRouter &#125; from &#x27;./router.js&#x27;;</span><br><span class="line">import &#123; DashboardModule &#125; from &#x27;./modules/dashboard.js&#x27;;</span><br><span class="line">import &#123; ArticleModule &#125; from &#x27;./modules/articles.js&#x27;;</span><br><span class="line">import &#123; UserModule &#125; from &#x27;./modules/users.js&#x27;;</span><br><span class="line">import &#123; NotificationManager &#125; from &#x27;./notifications.js&#x27;;</span><br><span class="line">import &#123; ChartManager &#125; from &#x27;./charts.js&#x27;;</span><br><span class="line"></span><br><span class="line">class AdminApp &#123;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">        this.store = new AdminStore();</span><br><span class="line">        this.api = new AdminAPI();</span><br><span class="line">        this.router = new AdminRouter(this);</span><br><span class="line">        this.notifications = new NotificationManager(this);</span><br><span class="line">        this.charts = new ChartManager();</span><br><span class="line">        </span><br><span class="line">        this.init();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    init() &#123;</span><br><span class="line">        this.initUI();</span><br><span class="line">        this.bindEvents();</span><br><span class="line">        this.checkAuth();</span><br><span class="line">        this.loadData();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    initUI() &#123;</span><br><span class="line">        // 初始化侧边栏</span><br><span class="line">        this.initSidebar();</span><br><span class="line">        </span><br><span class="line">        // 初始化用户菜单</span><br><span class="line">        this.initUserMenu();</span><br><span class="line">        </span><br><span class="line">        // 初始化通知</span><br><span class="line">        this.notifications.init();</span><br><span class="line">        </span><br><span class="line">        // 设置默认模块</span><br><span class="line">        this.router.navigate(&#x27;#dashboard&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    initSidebar() &#123;</span><br><span class="line">        const toggleBtn = document.getElementById(&#x27;sidebar-toggle&#x27;);</span><br><span class="line">        const sidebar = document.getElementById(&#x27;sidebar&#x27;);</span><br><span class="line">        const navLinks = document.querySelectorAll(&#x27;.nav-link&#x27;);</span><br><span class="line">        </span><br><span class="line">        toggleBtn?.addEventListener(&#x27;click&#x27;, () =&gt; &#123;</span><br><span class="line">            sidebar.classList.toggle(&#x27;show&#x27;);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        navLinks.forEach(link =&gt; &#123;</span><br><span class="line">            link.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;</span><br><span class="line">                e.preventDefault();</span><br><span class="line">                </span><br><span class="line">                // 移除其他链接的active类</span><br><span class="line">                navLinks.forEach(l =&gt; l.classList.remove(&#x27;active&#x27;));</span><br><span class="line">                </span><br><span class="line">                // 添加当前链接的active类</span><br><span class="line">                link.classList.add(&#x27;active&#x27;);</span><br><span class="line">                </span><br><span class="line">                // 移动端点击后隐藏侧边栏</span><br><span class="line">                if (window.innerWidth &lt;= 992) &#123;</span><br><span class="line">                    sidebar.classList.remove(&#x27;show&#x27;);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                // 加载模块</span><br><span class="line">                const module = link.dataset.module;</span><br><span class="line">                this.router.navigate(`#$&#123;module&#125;`);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    initUserMenu() &#123;</span><br><span class="line">        const menuBtn = document.getElementById(&#x27;user-menu-btn&#x27;);</span><br><span class="line">        const dropdown = document.getElementById(&#x27;user-dropdown&#x27;);</span><br><span class="line">        const logoutBtn = document.getElementById(&#x27;logout&#x27;);</span><br><span class="line">        </span><br><span class="line">        menuBtn?.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;</span><br><span class="line">            e.stopPropagation();</span><br><span class="line">            dropdown.classList.toggle(&#x27;show&#x27;);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        logoutBtn?.addEventListener(&#x27;click&#x27;, (e) =&gt; &#123;</span><br><span class="line">            e.preventDefault();</span><br><span class="line">            this.logout();</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        // 点击其他地方关闭菜单</span><br><span class="line">        document.addEventListener(&#x27;click&#x27;, () =&gt; &#123;</span><br><span class="line">            dropdown.classList.remove(&#x27;show&#x27;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async checkAuth() &#123;</span><br><span class="line">        const token = localStorage.getItem(&#x27;token&#x27;);</span><br><span class="line">        if (!token) &#123;</span><br><span class="line">            window.location.href = &#x27;/login&#x27;;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        try &#123;</span><br><span class="line">            const user = await this.api.getCurrentUser();</span><br><span class="line">            if (user.role !== &#x27;ADMIN&#x27;) &#123;</span><br><span class="line">                alert(&#x27;没有管理员权限&#x27;);</span><br><span class="line">                window.location.href = &#x27;/&#x27;;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            this.store.setState(&#123; user &#125;);</span><br><span class="line">            this.updateUserInfo(user);</span><br><span class="line">        &#125; catch (error) &#123;</span><br><span class="line">            console.error(&#x27;认证检查失败:&#x27;, error);</span><br><span class="line">            localStorage.removeItem(&#x27;token&#x27;);</span><br><span class="line">            window.location.href = &#x27;/login&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    updateUserInfo(user) &#123;</span><br><span class="line">        const usernameEl = document.getElementById(&#x27;admin-username&#x27;);</span><br><span class="line">        const avatarEl = document.querySelector(&#x27;.user-avatar&#x27;);</span><br><span class="line">        </span><br><span class="line">        if (usernameEl) &#123;</span><br><span class="line">            usernameEl.textContent = user.displayName || user.username;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (avatarEl &amp;&amp; user.avatarUrl) &#123;</span><br><span class="line">            avatarEl.src = user.avatarUrl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    async loadData() &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            // 并行加载初始数据</span><br><span class="line">            const [stats, recentArticles, recentComments] = await Promise.all([</span><br><span class="line">                this.api.getStats(),</span><br><span class="line">                this.api.getArticles(&#123; page: 0, size: 10 &#125;),</span><br><span class="line">                this.api.getComments(&#123; page: 0, size: 10 &#125;)</span><br><span class="line">            ]);</span><br><span class="line">            </span><br><span class="line">            this.store.setState(&#123; stats, recentArticles, recentComments &#125;);</span><br><span class="line">            </span><br><span class="line">            // 加载通知</span><br><span class="line">            const notifications = await this.api.getNotifications();</span><br><span class="line">            this.store.setState(&#123; notifications &#125;);</span><br><span class="line">            this.notifications.updateBadge(notifications.filter(n =&gt; !n.read).length);</span><br><span class="line">        &#125; catch (error) &#123;</span><br><span class="line">            console.error(&#x27;加载数据失败:&#x27;, error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    logout() &#123;</span><br><span class="line">        localStorage.removeItem(&#x27;token&#x27;);</span><br><span class="line">        window.location.href = &#x27;/login&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    bindEvents() &#123;</span><br><span class="line">        // 键盘快捷键</span><br><span class="line">        document.addEventListener(&#x27;keydown&#x27;, (e) =&gt; &#123;</span><br><span class="line">            // Ctrl + S 保存</span><br><span class="line">            if (e.ctrlKey &amp;&amp; e.key === &#x27;s&#x27;) &#123;</span><br><span class="line">                e.preventDefault();</span><br><span class="line">                this.saveCurrentModule();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            // Esc 关闭模态框</span><br><span class="line">            if (e.key === &#x27;Escape&#x27;) &#123;</span><br><span class="line">                this.closeModal();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    saveCurrentModule() &#123;</span><br><span class="line">        // 根据当前模块执行保存操作</span><br><span class="line">        const currentModule = this.router.getCurrentModule();</span><br><span class="line">        if (currentModule?.save) &#123;</span><br><span class="line">            currentModule.save();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    showLoading() &#123;</span><br><span class="line">        const loading = document.getElementById(&#x27;admin-loading&#x27;);</span><br><span class="line">        if (loading) &#123;</span><br><span class="line">            loading.style.display = &#x27;flex&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    hideLoading() &#123;</span><br><span class="line">        const loading = document.getElementById(&#x27;admin-loading&#x27;);</span><br><span class="line">        if (loading) &#123;</span><br><span class="line">            loading.style.display = &#x27;none&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    showModal(content) &#123;</span><br><span class="line">        const modalContainer = document.getElementById(&#x27;admin-modal-container&#x27;);</span><br><span class="line">        modalContainer.innerHTML = `</span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-overlay&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal&quot;</span>&gt;</span></span><br><span class="line">                    $&#123;content&#125;</span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        `;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    closeModal() &#123;</span><br><span class="line">        const modalContainer = document.getElementById(&#x27;admin-modal-container&#x27;);</span><br><span class="line">        modalContainer.innerHTML = &#x27;&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 启动应用</span><br><span class="line">document.addEventListener(&#x27;DOMContentLoaded&#x27;, () =&gt; &#123;</span><br><span class="line">    window.adminApp = new AdminApp();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h2 id="第四部分：高级功能实现"><a href="#第四部分：高级功能实现" class="headerlink" title="第四部分：高级功能实现"></a>第四部分：高级功能实现</h2><h3 id="1-文章导出为PDF功能"><a href="#1-文章导出为PDF功能" class="headerlink" title="1. 文章导出为PDF功能"></a>1. 文章导出为PDF功能</h3><p><strong>PDFExportService.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.blog.entity.Article;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.kernel.pdf.PdfDocument;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.kernel.pdf.PdfWriter;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.layout.Document;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.layout.element.Paragraph;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.layout.element.Text;</span><br><span class="line"><span class="keyword">import</span> com.itextpdf.layout.property.TextAlignment;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.time.format.DateTimeFormatter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PDFExportService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ArticleService articleService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] exportArticleToPdf(Long articleId) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> articleService.getArticleEntity(articleId);</span><br><span class="line">            </span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="type">PdfWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PdfWriter</span>(outputStream);</span><br><span class="line">            <span class="type">PdfDocument</span> <span class="variable">pdfDoc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PdfDocument</span>(writer);</span><br><span class="line">            <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>(pdfDoc);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 设置文档信息</span></span><br><span class="line">            pdfDoc.getDocumentInfo()</span><br><span class="line">                .setTitle(article.getTitle())</span><br><span class="line">                .setAuthor(article.getAuthor().getDisplayName());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 添加标题</span></span><br><span class="line">            <span class="type">Paragraph</span> <span class="variable">title</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Paragraph</span>(article.getTitle())</span><br><span class="line">                .setTextAlignment(TextAlignment.CENTER)</span><br><span class="line">                .setFontSize(<span class="number">24</span>)</span><br><span class="line">                .setBold();</span><br><span class="line">            document.add(title);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 添加作者和日期</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">meta</span> <span class="operator">=</span> String.format(<span class="string">&quot;作者: %s | 发布日期: %s&quot;</span>,</span><br><span class="line">                article.getAuthor().getDisplayName(),</span><br><span class="line">                article.getPublishedAt().format(DateTimeFormatter.ISO_LOCAL_DATE));</span><br><span class="line">            </span><br><span class="line">            <span class="type">Paragraph</span> <span class="variable">metaParagraph</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Paragraph</span>(meta)</span><br><span class="line">                .setTextAlignment(TextAlignment.CENTER)</span><br><span class="line">                .setFontSize(<span class="number">12</span>)</span><br><span class="line">                .setItalic();</span><br><span class="line">            document.add(metaParagraph);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 添加分隔线</span></span><br><span class="line">            document.add(<span class="keyword">new</span> <span class="title class_">Paragraph</span>(<span class="string">&quot;\n&quot;</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 添加摘要</span></span><br><span class="line">            <span class="keyword">if</span> (article.getSummary() != <span class="literal">null</span> &amp;&amp; !article.getSummary().isEmpty()) &#123;</span><br><span class="line">                <span class="type">Paragraph</span> <span class="variable">summary</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Paragraph</span>(<span class="string">&quot;摘要&quot;</span>)</span><br><span class="line">                    .setBold()</span><br><span class="line">                    .setFontSize(<span class="number">14</span>);</span><br><span class="line">                document.add(summary);</span><br><span class="line">                </span><br><span class="line">                <span class="type">Paragraph</span> <span class="variable">summaryContent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Paragraph</span>(article.getSummary())</span><br><span class="line">                    .setFontSize(<span class="number">12</span>)</span><br><span class="line">                    .setMarginBottom(<span class="number">20</span>);</span><br><span class="line">                document.add(summaryContent);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 添加内容</span></span><br><span class="line">            <span class="type">Paragraph</span> <span class="variable">contentTitle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Paragraph</span>(<span class="string">&quot;内容&quot;</span>)</span><br><span class="line">                .setBold()</span><br><span class="line">                .setFontSize(<span class="number">14</span>);</span><br><span class="line">            document.add(contentTitle);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 处理HTML内容</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">plainContent</span> <span class="operator">=</span> htmlToPlainText(article.getContent());</span><br><span class="line">            <span class="type">Paragraph</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Paragraph</span>(plainContent)</span><br><span class="line">                .setFontSize(<span class="number">12</span>)</span><br><span class="line">                .setTextAlignment(TextAlignment.JUSTIFIED);</span><br><span class="line">            document.add(content);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 添加页脚</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">footer</span> <span class="operator">=</span> String.format(<span class="string">&quot;第 %d 页 / 共 %d 页&quot;</span>,</span><br><span class="line">                pdfDoc.getPageNumber(pdfDoc.getLastPage()),</span><br><span class="line">                pdfDoc.getNumberOfPages());</span><br><span class="line">            </span><br><span class="line">            <span class="type">Text</span> <span class="variable">footerText</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Text</span>(footer)</span><br><span class="line">                .setFontSize(<span class="number">10</span>);</span><br><span class="line">            <span class="type">Paragraph</span> <span class="variable">footerParagraph</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Paragraph</span>(footerText)</span><br><span class="line">                .setTextAlignment(TextAlignment.CENTER);</span><br><span class="line">            document.add(footerParagraph);</span><br><span class="line">            </span><br><span class="line">            document.close();</span><br><span class="line">            </span><br><span class="line">            log.info(<span class="string">&quot;文章导出为PDF成功: &#123;&#125;&quot;</span>, articleId);</span><br><span class="line">            <span class="keyword">return</span> outputStream.toByteArray();</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;导出PDF失败: &#123;&#125;&quot;</span>, articleId, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;导出PDF失败&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">htmlToPlainText</span><span class="params">(String html)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (html == <span class="literal">null</span>) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 简单的HTML标签清理</span></span><br><span class="line">        <span class="keyword">return</span> html.replaceAll(<span class="string">&quot;&lt;[^&gt;]*&gt;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">                  .replaceAll(<span class="string">&quot;&amp;nbsp;&quot;</span>, <span class="string">&quot; &quot;</span>)</span><br><span class="line">                  .replaceAll(<span class="string">&quot;&amp;lt;&quot;</span>, <span class="string">&quot;&lt;&quot;</span>)</span><br><span class="line">                  .replaceAll(<span class="string">&quot;&amp;gt;&quot;</span>, <span class="string">&quot;&gt;&quot;</span>)</span><br><span class="line">                  .replaceAll(<span class="string">&quot;&amp;amp;&quot;</span>, <span class="string">&quot;&amp;&quot;</span>)</span><br><span class="line">                  .replaceAll(<span class="string">&quot;&amp;quot;&quot;</span>, <span class="string">&quot;\&quot;&quot;</span>)</span><br><span class="line">                  .replaceAll(<span class="string">&quot;&amp;#39;&quot;</span>, <span class="string">&quot;&#x27;&quot;</span>)</span><br><span class="line">                  .trim();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-文章翻译功能"><a href="#2-文章翻译功能" class="headerlink" title="2. 文章翻译功能"></a>2. 文章翻译功能</h3><p><strong>TranslationService.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonNode;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpHeaders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Async;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CompletableFuture;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TranslationService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.translation.api-key&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String apiKey;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.translation.api-url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String apiUrl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">RestTemplate</span> <span class="variable">restTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;String&gt; <span class="title function_">translate</span><span class="params">(String text, String targetLanguage)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>();</span><br><span class="line">                headers.set(<span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;Bearer &quot;</span> + apiKey);</span><br><span class="line">                headers.set(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">                </span><br><span class="line">                Map&lt;String, Object&gt; requestBody = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                requestBody.put(<span class="string">&quot;text&quot;</span>, text);</span><br><span class="line">                requestBody.put(<span class="string">&quot;target_lang&quot;</span>, targetLanguage);</span><br><span class="line">                requestBody.put(<span class="string">&quot;source_lang&quot;</span>, <span class="string">&quot;ZH&quot;</span>); <span class="comment">// 假设原文是中文</span></span><br><span class="line">                </span><br><span class="line">                HttpEntity&lt;Map&lt;String, Object&gt;&gt; request = <span class="keyword">new</span> <span class="title class_">HttpEntity</span>&lt;&gt;(requestBody, headers);</span><br><span class="line">                </span><br><span class="line">                ResponseEntity&lt;String&gt; response = restTemplate.exchange(</span><br><span class="line">                    apiUrl,</span><br><span class="line">                    HttpMethod.POST,</span><br><span class="line">                    request,</span><br><span class="line">                    String.class</span><br><span class="line">                );</span><br><span class="line">                </span><br><span class="line">                <span class="type">JsonNode</span> <span class="variable">root</span> <span class="operator">=</span> objectMapper.readTree(response.getBody());</span><br><span class="line">                <span class="keyword">return</span> root.path(<span class="string">&quot;translations&quot;</span>).get(<span class="number">0</span>).path(<span class="string">&quot;text&quot;</span>).asText();</span><br><span class="line">                </span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;翻译失败&quot;</span>, e);</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;翻译失败: &quot;</span> + e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;Map&lt;String, String&gt;&gt; <span class="title function_">translateArticle</span><span class="params">(</span></span><br><span class="line"><span class="params">            String title, String content, String summary, </span></span><br><span class="line"><span class="params">            String targetLanguage)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                CompletableFuture&lt;String&gt; titleFuture = translate(title, targetLanguage);</span><br><span class="line">                CompletableFuture&lt;String&gt; contentFuture = translate(content, targetLanguage);</span><br><span class="line">                CompletableFuture&lt;String&gt; summaryFuture = summary != <span class="literal">null</span> ? </span><br><span class="line">                    translate(summary, targetLanguage) : </span><br><span class="line">                    CompletableFuture.completedFuture(<span class="literal">null</span>);</span><br><span class="line">                </span><br><span class="line">                CompletableFuture.allOf(titleFuture, contentFuture, summaryFuture).join();</span><br><span class="line">                </span><br><span class="line">                Map&lt;String, String&gt; result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                result.put(<span class="string">&quot;title&quot;</span>, titleFuture.get());</span><br><span class="line">                result.put(<span class="string">&quot;content&quot;</span>, contentFuture.get());</span><br><span class="line">                <span class="keyword">if</span> (summaryFuture.get() != <span class="literal">null</span>) &#123;</span><br><span class="line">                    result.put(<span class="string">&quot;summary&quot;</span>, summaryFuture.get());</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">                </span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;文章翻译失败&quot;</span>, e);</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;文章翻译失败&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-文章相似度推荐"><a href="#3-文章相似度推荐" class="headerlink" title="3. 文章相似度推荐"></a>3. 文章相似度推荐</h3><p><strong>RecommendationService.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.blog.entity.Article;</span><br><span class="line"><span class="keyword">import</span> com.blog.repository.ArticleRepository;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RecommendationService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ArticleRepository articleRepository;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TagRepository tagRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;recommendations&quot;, key = &quot;#articleId&quot;)</span></span><br><span class="line">    <span class="meta">@Transactional(readOnly = true)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Article&gt; <span class="title function_">getRelatedArticles</span><span class="params">(Long articleId, <span class="type">int</span> limit)</span> &#123;</span><br><span class="line">        <span class="type">Article</span> <span class="variable">article</span> <span class="operator">=</span> articleRepository.findById(articleId)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;文章不存在&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取文章的标签</span></span><br><span class="line">        Set&lt;Long&gt; articleTagIds = article.getTags().stream()</span><br><span class="line">            .map(tag -&gt; tag.getId())</span><br><span class="line">            .collect(Collectors.toSet());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (articleTagIds.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// 如果没有标签，返回最近发布的文章</span></span><br><span class="line">            <span class="keyword">return</span> articleRepository.findByStatusOrderByPublishedAtDesc(</span><br><span class="line">                Article.Status.PUBLISHED, </span><br><span class="line">                PageRequest.of(<span class="number">0</span>, limit)</span><br><span class="line">            ).getContent();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 查找有相同标签的文章</span></span><br><span class="line">        List&lt;Object[]&gt; results = articleRepository.findArticlesWithCommonTags(</span><br><span class="line">            articleTagIds, articleId, limit);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> results.stream()</span><br><span class="line">            .map(result -&gt; (Article) result[<span class="number">0</span>])</span><br><span class="line">            .filter(a -&gt; !a.getId().equals(articleId))</span><br><span class="line">            .limit(limit)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;user_recommendations&quot;, key = &quot;#userId&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Article&gt; <span class="title function_">getPersonalizedRecommendations</span><span class="params">(Long userId, <span class="type">int</span> limit)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取用户最近阅读的文章</span></span><br><span class="line">        List&lt;Article&gt; recentArticles = articleRepository.findRecentlyViewedByUser(</span><br><span class="line">            userId, PageRequest.of(<span class="number">0</span>, <span class="number">10</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (recentArticles.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> getPopularArticles(limit);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 从最近阅读的文章中提取标签</span></span><br><span class="line">        Set&lt;Long&gt; tagIds = recentArticles.stream()</span><br><span class="line">            .flatMap(article -&gt; article.getTags().stream())</span><br><span class="line">            .map(tag -&gt; tag.getId())</span><br><span class="line">            .collect(Collectors.toSet());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 基于标签推荐文章</span></span><br><span class="line">        List&lt;Article&gt; recommendations = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Long tagId : tagIds) &#123;</span><br><span class="line">            List&lt;Article&gt; articles = articleRepository.findByTagIdAndStatus(</span><br><span class="line">                tagId, Article.Status.PUBLISHED, PageRequest.of(<span class="number">0</span>, <span class="number">5</span>));</span><br><span class="line">            recommendations.addAll(articles);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 去重并排除已读文章</span></span><br><span class="line">        <span class="keyword">return</span> recommendations.stream()</span><br><span class="line">            .filter(article -&gt; !recentArticles.contains(article))</span><br><span class="line">            .distinct()</span><br><span class="line">            .sorted((a1, a2) -&gt; &#123;</span><br><span class="line">                <span class="comment">// 按相关度排序：共同标签数量 * 文章热度</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">score1</span> <span class="operator">=</span> calculateRelevanceScore(a1, tagIds);</span><br><span class="line">                <span class="type">int</span> <span class="variable">score2</span> <span class="operator">=</span> calculateRelevanceScore(a2, tagIds);</span><br><span class="line">                <span class="keyword">return</span> Integer.compare(score2, score1);</span><br><span class="line">            &#125;)</span><br><span class="line">            .limit(limit)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">calculateRelevanceScore</span><span class="params">(Article article, Set&lt;Long&gt; userTagIds)</span> &#123;</span><br><span class="line">        <span class="comment">// 计算共同标签数量</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">commonTags</span> <span class="operator">=</span> article.getTags().stream()</span><br><span class="line">            .filter(tag -&gt; userTagIds.contains(tag.getId()))</span><br><span class="line">            .count();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 考虑文章热度（阅读量 + 点赞数）</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">popularity</span> <span class="operator">=</span> article.getViewCount() + article.getLikeCount();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>) (commonTags * <span class="number">10</span> + popularity);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;popular_articles&quot;, key = &quot;#limit&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Article&gt; <span class="title function_">getPopularArticles</span><span class="params">(<span class="type">int</span> limit)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> articleRepository.findPopularArticles(PageRequest.of(<span class="number">0</span>, limit));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Cacheable(value = &quot;trending_articles&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Article&gt; <span class="title function_">getTrendingArticles</span><span class="params">(<span class="type">int</span> limit)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取最近一周的文章，按热度排序</span></span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">weekAgo</span> <span class="operator">=</span> LocalDateTime.now().minusDays(<span class="number">7</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> articleRepository.findTrendingArticles(</span><br><span class="line">            weekAgo, PageRequest.of(<span class="number">0</span>, limit));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="第五部分：部署和运维"><a href="#第五部分：部署和运维" class="headerlink" title="第五部分：部署和运维"></a>第五部分：部署和运维</h2><h3 id="1-Docker配置文件"><a href="#1-Docker配置文件" class="headerlink" title="1. Docker配置文件"></a>1. Docker配置文件</h3><p><strong>Dockerfile</strong></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 后端Dockerfile</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">11</span>-jre-slim</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置时区</span></span><br><span class="line"><span class="keyword">ENV</span> TZ=Asia/Shanghai</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">ln</span> -snf /usr/share/zoneinfo/<span class="variable">$TZ</span> /etc/localtime &amp;&amp; <span class="built_in">echo</span> <span class="variable">$TZ</span> &gt; /etc/timezone</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建应用目录</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制JAR文件</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> target/blog-system-*.jar app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制配置文件</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> config/application-prod.yml /app/config/application-prod.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建非root用户</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> useradd -m -u 1000 appuser &amp;&amp; <span class="built_in">chown</span> -R appuser:appuser /app</span></span><br><span class="line"><span class="keyword">USER</span> appuser</span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动应用</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;app.jar&quot;</span>, <span class="string">&quot;--spring.config.location=classpath:/,file:/app/config/&quot;</span>]</span></span><br></pre></td></tr></table></figure>



<p><strong>docker-compose.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">blog_mysql</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">$&#123;DB_PASSWORD&#125;</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">blog_db</span></span><br><span class="line">      <span class="attr">MYSQL_USER:</span> <span class="string">blog_user</span></span><br><span class="line">      <span class="attr">MYSQL_PASSWORD:</span> <span class="string">$&#123;DB_PASSWORD&#125;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql_data:/var/lib/mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./init.sql:/docker-entrypoint-initdb.d/init.sql</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">blog_network</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:7-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">blog_redis</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span> <span class="string">--requirepass</span> <span class="string">$&#123;REDIS_PASSWORD&#125;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis_data:/data</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">blog_network</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">elasticsearch:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">elasticsearch:8.6.0</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">blog_elasticsearch</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.type=single-node</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">xpack.security.enabled=false</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elasticsearch_data:/usr/share/elasticsearch/data</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9200:9200&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9300:9300&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">blog_network</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">backend:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">./backend</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">blog_backend</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_PROFILES_ACTIVE=prod</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DB_HOST=mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DB_PASSWORD=$&#123;DB_PASSWORD&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REDIS_HOST=redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REDIS_PASSWORD=$&#123;REDIS_PASSWORD&#125;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ES_HOST=elasticsearch</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elasticsearch</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">blog_network</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">frontend:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">./frontend</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">blog_frontend</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3000:80&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">blog_network</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">backend</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">blog_nginx</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx.conf:/etc/nginx/nginx.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./frontend/dist:/usr/share/nginx/html</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./ssl:/etc/nginx/ssl</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;443:443&quot;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">backend</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">frontend</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">blog_network</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">prometheus:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">prom/prometheus:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">blog_prometheus</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./prometheus.yml:/etc/prometheus/prometheus.yml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">prometheus_data:/prometheus</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;--config.file=/etc/prometheus/prometheus.yml&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;--storage.tsdb.path=/prometheus&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;--web.console.libraries=/etc/prometheus/console_libraries&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;--web.console.templates=/etc/prometheus/consoles&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;--storage.tsdb.retention.time=200h&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;--web.enable-lifecycle&#x27;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9090:9090&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">blog_network</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">grafana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">grafana/grafana:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">blog_grafana</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">GF_SECURITY_ADMIN_PASSWORD=$&#123;GRAFANA_PASSWORD&#125;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">grafana_data:/var/lib/grafana</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3001:3000&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">blog_network</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">blog_network:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">mysql_data:</span></span><br><span class="line">  <span class="attr">redis_data:</span></span><br><span class="line">  <span class="attr">elasticsearch_data:</span></span><br><span class="line">  <span class="attr">prometheus_data:</span></span><br><span class="line">  <span class="attr">grafana_data:</span></span><br></pre></td></tr></table></figure>



<p><strong>nginx.conf</strong></p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span> /etc/nginx/mime.types;</span><br><span class="line">    <span class="attribute">default_type</span> application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 日志格式</span></span><br><span class="line">    <span class="attribute">log_format</span> main <span class="string">&#x27;<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] &quot;<span class="variable">$request</span>&quot; &#x27;</span></span><br><span class="line">                    <span class="string">&#x27;<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> &quot;<span class="variable">$http_referer</span>&quot; &#x27;</span></span><br><span class="line">                    <span class="string">&#x27;&quot;<span class="variable">$http_user_agent</span>&quot; &quot;<span class="variable">$http_x_forwarded_for</span>&quot;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">access_log</span> /var/log/nginx/access.log main;</span><br><span class="line">    <span class="attribute">error_log</span> /var/log/nginx/<span class="literal">error</span>.log <span class="literal">warn</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Gzip压缩</span></span><br><span class="line">    <span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">gzip_vary</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">gzip_min_length</span> <span class="number">1024</span>;</span><br><span class="line">    <span class="attribute">gzip_types</span> text/plain text/css text/xml text/javascript</span><br><span class="line">               application/javascript application/xml+rss application/json;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 限制请求大小</span></span><br><span class="line">    <span class="attribute">client_max_body_size</span> <span class="number">10M</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 隐藏Nginx版本号</span></span><br><span class="line">    <span class="attribute">server_tokens</span> <span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 缓存配置</span></span><br><span class="line">    <span class="attribute">proxy_cache_path</span> /var/cache/nginx levels=<span class="number">1</span>:<span class="number">2</span> keys_zone=blog_cache:<span class="number">10m</span></span><br><span class="line">                     max_size=<span class="number">1g</span> inactive=<span class="number">60m</span> use_temp_path=<span class="literal">off</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">upstream</span> backend &#123;</span><br><span class="line">        <span class="attribute">server</span> backend:<span class="number">8080</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">upstream</span> frontend &#123;</span><br><span class="line">        <span class="attribute">server</span> frontend:<span class="number">80</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span> blog.example.com;</span><br><span class="line">        <span class="attribute">return</span> <span class="number">301</span> https://<span class="variable">$server_name</span><span class="variable">$request_uri</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">443</span> ssl http2;</span><br><span class="line">        <span class="attribute">server_name</span> blog.example.com;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">ssl_certificate</span> /etc/nginx/ssl/blog.crt;</span><br><span class="line">        <span class="attribute">ssl_certificate_key</span> /etc/nginx/ssl/blog.key;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">ssl_protocols</span> TLSv1.<span class="number">2</span> TLSv1.<span class="number">3</span>;</span><br><span class="line">        <span class="attribute">ssl_ciphers</span> ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512;</span><br><span class="line">        <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">off</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="attribute">ssl_session_cache</span> shared:SSL:<span class="number">10m</span>;</span><br><span class="line">        <span class="attribute">ssl_session_timeout</span> <span class="number">10m</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># HSTS</span></span><br><span class="line">        <span class="attribute">add_header</span> Strict-Transport-Security <span class="string">&quot;max-age=31536000; includeSubDomains&quot;</span> always;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 静态文件</span></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://frontend;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 缓存静态文件</span></span><br><span class="line">            <span class="section">location</span> <span class="regexp">~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$</span> &#123;</span><br><span class="line">                <span class="attribute">expires</span> <span class="number">1y</span>;</span><br><span class="line">                <span class="attribute">add_header</span> Cache-Control <span class="string">&quot;public, immutable&quot;</span>;</span><br><span class="line">                <span class="attribute">proxy_pass</span> http://frontend;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># API接口</span></span><br><span class="line">        <span class="section">location</span> /api &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://backend;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 缓存API响应</span></span><br><span class="line">            <span class="attribute">proxy_cache</span> blog_cache;</span><br><span class="line">            <span class="attribute">proxy_cache_key</span> <span class="string">&quot;<span class="variable">$scheme</span><span class="variable">$request_method</span><span class="variable">$host</span><span class="variable">$request_uri</span>&quot;</span>;</span><br><span class="line">            <span class="attribute">proxy_cache_valid</span> <span class="number">200</span> <span class="number">302</span> <span class="number">10m</span>;</span><br><span class="line">            <span class="attribute">proxy_cache_valid</span> <span class="number">404</span> <span class="number">1m</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># WebSocket支持</span></span><br><span class="line">            <span class="section">location</span> /ws &#123;</span><br><span class="line">                <span class="attribute">proxy_pass</span> http://backend;</span><br><span class="line">                <span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line">                <span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">                <span class="attribute">proxy_set_header</span> Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">                <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">                <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">                <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">                <span class="attribute">proxy_set_header</span> X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 文件上传</span></span><br><span class="line">        <span class="section">location</span> /uploads &#123;</span><br><span class="line">            <span class="attribute">alias</span> /app/uploads;</span><br><span class="line">            <span class="attribute">expires</span> <span class="number">30d</span>;</span><br><span class="line">            <span class="attribute">add_header</span> Cache-Control <span class="string">&quot;public&quot;</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 防盗链</span></span><br><span class="line">            <span class="attribute">valid_referers</span> <span class="literal">none</span> <span class="literal">blocked</span> blog.example.com;</span><br><span class="line">            <span class="attribute">if</span> (<span class="variable">$invalid_referer</span>) &#123;</span><br><span class="line">                <span class="attribute">return</span> <span class="number">403</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 健康检查</span></span><br><span class="line">        <span class="section">location</span> /health &#123;</span><br><span class="line">            <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">            <span class="attribute">return</span> <span class="number">200</span> <span class="string">&quot;healthy\n&quot;</span>;</span><br><span class="line">            <span class="attribute">add_header</span> Content-Type text/plain;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 阻止敏感文件访问</span></span><br><span class="line">        <span class="section">location</span> <span class="regexp">~ /\.</span> &#123;</span><br><span class="line">            <span class="attribute">deny</span> all;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>prometheus.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">scrape_interval:</span> <span class="string">15s</span></span><br><span class="line">  <span class="attr">evaluation_interval:</span> <span class="string">15s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rule_files:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;alert.rules&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">alerting:</span></span><br><span class="line">  <span class="attr">alertmanagers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">static_configs:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">targets:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">alertmanager:9093</span></span><br><span class="line"></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;spring-boot&#x27;</span></span><br><span class="line">    <span class="attr">metrics_path:</span> <span class="string">&#x27;/actuator/prometheus&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;backend:8080&#x27;</span>]</span><br><span class="line">        <span class="attr">labels:</span></span><br><span class="line">          <span class="attr">application:</span> <span class="string">&#x27;blog-backend&#x27;</span></span><br><span class="line">  </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;node-exporter&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;node-exporter:9100&#x27;</span>]</span><br><span class="line">  </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;prometheus&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;localhost:9090&#x27;</span>]</span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;nginx&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&#x27;nginx-exporter:9113&#x27;</span>]</span><br></pre></td></tr></table></figure>



<h3 id="2-Kubernetes部署配置"><a href="#2-Kubernetes部署配置" class="headerlink" title="2. Kubernetes部署配置"></a>2. Kubernetes部署配置</h3><p><strong>blog-deployment.yaml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">blog-system</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">blog-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">blog-system</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">application-prod.yml:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    spring:</span></span><br><span class="line"><span class="string">      datasource:</span></span><br><span class="line"><span class="string">        url: jdbc:mysql://blog-mysql.blog-system.svc.cluster.local:3306/blog_db</span></span><br><span class="line"><span class="string">        username: $&#123;DB_USERNAME&#125;</span></span><br><span class="line"><span class="string">        password: $&#123;DB_PASSWORD&#125;</span></span><br><span class="line"><span class="string">      redis:</span></span><br><span class="line"><span class="string">        host: blog-redis</span></span><br><span class="line"><span class="string">        port: 6379</span></span><br><span class="line"><span class="string">        password: $&#123;REDIS_PASSWORD&#125;</span></span><br><span class="line"><span class="string">      elasticsearch:</span></span><br><span class="line"><span class="string">        uris: http://blog-elasticsearch:9200</span></span><br><span class="line"><span class="string">    app:</span></span><br><span class="line"><span class="string">      jwt:</span></span><br><span class="line"><span class="string">        secret: $&#123;JWT_SECRET&#125;</span></span><br><span class="line"><span class="string"></span><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">blog-secrets</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">blog-system</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">db-password:</span> <span class="string">&lt;base64-encoded-password&gt;</span></span><br><span class="line">  <span class="attr">redis-password:</span> <span class="string">&lt;base64-encoded-password&gt;</span></span><br><span class="line">  <span class="attr">jwt-secret:</span> <span class="string">&lt;base64-encoded-secret&gt;</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">blog-backend</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">blog-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">blog-backend</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">blog-backend</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">blog-backend</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">your-registry/blog-backend:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">DB_PASSWORD</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">secretKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">blog-secrets</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">db-password</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">REDIS_PASSWORD</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">secretKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">blog-secrets</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">redis-password</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">JWT_SECRET</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">secretKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">blog-secrets</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">jwt-secret</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;512Mi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;250m&quot;</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;1Gi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;500m&quot;</span></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/actuator/health/liveness</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">60</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/actuator/health/readiness</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">blog-frontend</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">blog-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">blog-frontend</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">blog-frontend</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">blog-frontend</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">your-registry/blog-frontend:latest</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;256Mi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;100m&quot;</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;512Mi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;200m&quot;</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">blog-backend-service</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">blog-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">blog-backend</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">blog-frontend-service</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">blog-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">blog-frontend</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">blog-ingress</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">blog-system</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/rewrite-target:</span> <span class="string">/</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/ssl-redirect:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="attr">cert-manager.io/cluster-issuer:</span> <span class="string">&quot;letsencrypt-prod&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">blog.example.com</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">blog-tls</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">blog.example.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">blog-frontend-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/api</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">blog-backend-service</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>



<h3 id="3-监控和日志配置"><a href="#3-监控和日志配置" class="headerlink" title="3. 监控和日志配置"></a>3. 监控和日志配置</h3><p><strong>application-monitoring.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">health,info,metrics,prometheus,loggers</span></span><br><span class="line">      <span class="attr">base-path:</span> <span class="string">/actuator</span></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="attr">health:</span></span><br><span class="line">      <span class="attr">show-details:</span> <span class="string">always</span></span><br><span class="line">      <span class="attr">probes:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">metrics:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">prometheus:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">metrics:</span></span><br><span class="line">    <span class="attr">export:</span></span><br><span class="line">      <span class="attr">prometheus:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">tags:</span></span><br><span class="line">      <span class="attr">application:</span> <span class="string">blog-system</span></span><br><span class="line">    <span class="attr">distribution:</span></span><br><span class="line">      <span class="attr">percentiles-histogram:</span></span><br><span class="line">        <span class="attr">http.server.requests:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">tracing:</span></span><br><span class="line">    <span class="attr">sampling:</span></span><br><span class="line">      <span class="attr">probability:</span> <span class="number">1.0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.blog:</span> <span class="string">INFO</span></span><br><span class="line">    <span class="attr">org.springframework.web:</span> <span class="string">INFO</span></span><br><span class="line">    <span class="attr">org.hibernate:</span> <span class="string">WARN</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&quot;</span></span><br><span class="line">    <span class="attr">file:</span> <span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&quot;</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">/var/log/blog/blog-system.log</span></span><br><span class="line">    <span class="attr">max-size:</span> <span class="string">10MB</span></span><br><span class="line">    <span class="attr">max-history:</span> <span class="number">30</span></span><br><span class="line">  <span class="attr">logstash:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5000</span></span><br></pre></td></tr></table></figure>



<h2 id="第六部分：安全增强"><a href="#第六部分：安全增强" class="headerlink" title="第六部分：安全增强"></a>第六部分：安全增强</h2><h3 id="1-安全配置增强"><a href="#1-安全配置增强" class="headerlink" title="1. 安全配置增强"></a>1. 安全配置增强</h3><p><strong>SecurityConfigEnhanced.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.http.SessionCreationPolicy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.SecurityFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.csrf.CookieCsrfTokenRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.CorsConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.CorsConfigurationSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.UrlBasedCorsConfigurationSource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity(</span></span><br><span class="line"><span class="meta">    prePostEnabled = true,</span></span><br><span class="line"><span class="meta">    securedEnabled = true,</span></span><br><span class="line"><span class="meta">    jsr250Enabled = true</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfigEnhanced</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> JwtAuthenticationFilter jwtAuthenticationFilter;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RateLimitFilter rateLimitFilter;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AuditFilter auditFilter;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SecurityConfigEnhanced</span><span class="params">(JwtAuthenticationFilter jwtAuthenticationFilter,</span></span><br><span class="line"><span class="params">                                 RateLimitFilter rateLimitFilter,</span></span><br><span class="line"><span class="params">                                 AuditFilter auditFilter)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.jwtAuthenticationFilter = jwtAuthenticationFilter;</span><br><span class="line">        <span class="built_in">this</span>.rateLimitFilter = rateLimitFilter;</span><br><span class="line">        <span class="built_in">this</span>.auditFilter = auditFilter;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>(<span class="number">12</span>); <span class="comment">// 增加强度</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SecurityFilterChain <span class="title function_">filterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http</span><br><span class="line">            <span class="comment">// CORS配置</span></span><br><span class="line">            .cors().configurationSource(corsConfigurationSource()).and()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// CSRF配置</span></span><br><span class="line">            .csrf()</span><br><span class="line">                .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())</span><br><span class="line">                .ignoringAntMatchers(<span class="string">&quot;/api/auth/**&quot;</span>, <span class="string">&quot;/api/webhook/**&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 会话管理</span></span><br><span class="line">            .sessionManagement()</span><br><span class="line">                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">                .and()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 异常处理</span></span><br><span class="line">            .exceptionHandling()</span><br><span class="line">                .authenticationEntryPoint((request, response, authException) -&gt; &#123;</span><br><span class="line">                    response.setContentType(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">                    response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);</span><br><span class="line">                    response.getWriter().write(<span class="string">&quot;&#123;\&quot;error\&quot;: \&quot;认证失败\&quot;&#125;&quot;</span>);</span><br><span class="line">                &#125;)</span><br><span class="line">                .accessDeniedHandler((request, response, accessDeniedException) -&gt; &#123;</span><br><span class="line">                    response.setContentType(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">                    response.setStatus(HttpServletResponse.SC_FORBIDDEN);</span><br><span class="line">                    response.getWriter().write(<span class="string">&quot;&#123;\&quot;error\&quot;: \&quot;权限不足\&quot;&#125;&quot;</span>);</span><br><span class="line">                &#125;)</span><br><span class="line">                .and()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 安全头配置</span></span><br><span class="line">            .headers()</span><br><span class="line">                .contentSecurityPolicy(<span class="string">&quot;default-src &#x27;self&#x27;; script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; &#x27;unsafe-eval&#x27;; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;;&quot;</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .xssProtection().block(<span class="literal">true</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .frameOptions().deny()</span><br><span class="line">                .and()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 请求授权</span></span><br><span class="line">            .authorizeRequests()</span><br><span class="line">                <span class="comment">// 公开接口</span></span><br><span class="line">                .antMatchers(</span><br><span class="line">                    <span class="string">&quot;/api/auth/**&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;/api/articles/public/**&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;/api/comments/public/**&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;/api/files/public/**&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;/actuator/health&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;/swagger-ui/**&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;/v3/api-docs/**&quot;</span></span><br><span class="line">                ).permitAll()</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 用户接口</span></span><br><span class="line">                .antMatchers(</span><br><span class="line">                    <span class="string">&quot;/api/articles/**&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;/api/comments/**&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;/api/users/profile/**&quot;</span></span><br><span class="line">                ).hasAnyRole(<span class="string">&quot;USER&quot;</span>, <span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 管理员接口</span></span><br><span class="line">                .antMatchers(</span><br><span class="line">                    <span class="string">&quot;/api/admin/**&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;/api/users/**&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;/api/system/**&quot;</span></span><br><span class="line">                ).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 其他请求需要认证</span></span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">                .and()</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 添加自定义过滤器</span></span><br><span class="line">            .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class)</span><br><span class="line">            .addFilterBefore(rateLimitFilter, JwtAuthenticationFilter.class)</span><br><span class="line">            .addFilterBefore(auditFilter, RateLimitFilter.class);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> http.build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CorsConfigurationSource <span class="title function_">corsConfigurationSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CorsConfiguration</span> <span class="variable">configuration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line">        configuration.setAllowedOrigins(List.of(</span><br><span class="line">            <span class="string">&quot;https://blog.example.com&quot;</span>,</span><br><span class="line">            <span class="string">&quot;http://localhost:3000&quot;</span></span><br><span class="line">        ));</span><br><span class="line">        configuration.setAllowedMethods(Arrays.asList(</span><br><span class="line">            <span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;PUT&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;OPTIONS&quot;</span>, <span class="string">&quot;PATCH&quot;</span></span><br><span class="line">        ));</span><br><span class="line">        configuration.setAllowedHeaders(Arrays.asList(</span><br><span class="line">            <span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;X-Requested-With&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Accept&quot;</span>, <span class="string">&quot;Origin&quot;</span>, <span class="string">&quot;X-CSRF-TOKEN&quot;</span>, <span class="string">&quot;Cache-Control&quot;</span></span><br><span class="line">        ));</span><br><span class="line">        configuration.setExposedHeaders(Arrays.asList(</span><br><span class="line">            <span class="string">&quot;Authorization&quot;</span>, <span class="string">&quot;X-CSRF-TOKEN&quot;</span>, <span class="string">&quot;X-Rate-Limit-Remaining&quot;</span></span><br><span class="line">        ));</span><br><span class="line">        configuration.setAllowCredentials(<span class="literal">true</span>);</span><br><span class="line">        configuration.setMaxAge(<span class="number">3600L</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">UrlBasedCorsConfigurationSource</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>();</span><br><span class="line">        source.registerCorsConfiguration(<span class="string">&quot;/api/**&quot;</span>, configuration);</span><br><span class="line">        <span class="keyword">return</span> source;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-限流过滤器"><a href="#2-限流过滤器" class="headerlink" title="2. 限流过滤器"></a>2. 限流过滤器</h3><p><strong>RateLimitFilter.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.blog.security;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.github.bucket4j.Bandwidth;</span><br><span class="line"><span class="keyword">import</span> io.github.bucket4j.Bucket;</span><br><span class="line"><span class="keyword">import</span> io.github.bucket4j.Refill;</span><br><span class="line"><span class="keyword">import</span> io.github.bucket4j.local.LocalBucketBuilder;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.OncePerRequestFilter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.time.Duration;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RateLimitFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Bucket&gt; buckets = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 不同API的限流配置</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, RateLimitConfig&gt; rateLimitConfigs = Map.of(</span><br><span class="line">        <span class="string">&quot;/api/auth/login&quot;</span>, <span class="keyword">new</span> <span class="title class_">RateLimitConfig</span>(<span class="number">5</span>, <span class="number">1</span>),      <span class="comment">// 5次/分钟</span></span><br><span class="line">        <span class="string">&quot;/api/auth/register&quot;</span>, <span class="keyword">new</span> <span class="title class_">RateLimitConfig</span>(<span class="number">2</span>, <span class="number">1</span>),   <span class="comment">// 2次/分钟</span></span><br><span class="line">        <span class="string">&quot;/api/comments&quot;</span>, <span class="keyword">new</span> <span class="title class_">RateLimitConfig</span>(<span class="number">20</span>, <span class="number">1</span>),       <span class="comment">// 20次/分钟</span></span><br><span class="line">        <span class="string">&quot;/api/articles&quot;</span>, <span class="keyword">new</span> <span class="title class_">RateLimitConfig</span>(<span class="number">30</span>, <span class="number">1</span>),       <span class="comment">// 30次/分钟</span></span><br><span class="line">        <span class="string">&quot;default&quot;</span>, <span class="keyword">new</span> <span class="title class_">RateLimitConfig</span>(<span class="number">60</span>, <span class="number">1</span>)              <span class="comment">// 60次/分钟</span></span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                                   HttpServletResponse response,</span></span><br><span class="line"><span class="params">                                   FilterChain filterChain)</span></span><br><span class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> request.getServletPath();</span><br><span class="line">        <span class="type">String</span> <span class="variable">ip</span> <span class="operator">=</span> getClientIP(request);</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> ip + <span class="string">&quot;:&quot;</span> + path;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取限流配置</span></span><br><span class="line">        <span class="type">RateLimitConfig</span> <span class="variable">config</span> <span class="operator">=</span> rateLimitConfigs.entrySet().stream()</span><br><span class="line">            .filter(entry -&gt; path.startsWith(entry.getKey()))</span><br><span class="line">            .map(Map.Entry::getValue)</span><br><span class="line">            .findFirst()</span><br><span class="line">            .orElse(rateLimitConfigs.get(<span class="string">&quot;default&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取或创建令牌桶</span></span><br><span class="line">        <span class="type">Bucket</span> <span class="variable">bucket</span> <span class="operator">=</span> buckets.computeIfAbsent(key, k -&gt; createBucket(config));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 尝试消费令牌</span></span><br><span class="line">        <span class="keyword">if</span> (bucket.tryConsume(<span class="number">1</span>)) &#123;</span><br><span class="line">            <span class="comment">// 添加限流头信息</span></span><br><span class="line">            response.addHeader(<span class="string">&quot;X-Rate-Limit-Remaining&quot;</span>,</span><br><span class="line">                String.valueOf(bucket.getAvailableTokens()));</span><br><span class="line">            filterChain.doFilter(request, response);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 限流响应</span></span><br><span class="line">            response.setStatus(<span class="number">429</span>); <span class="comment">// Too Many Requests</span></span><br><span class="line">            response.setContentType(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">            response.getWriter().write(<span class="string">&quot;&#123;\&quot;error\&quot;: \&quot;请求过于频繁，请稍后再试\&quot;&#125;&quot;</span>);</span><br><span class="line">            log.warn(<span class="string">&quot;请求被限流: IP=&#123;&#125;, Path=&#123;&#125;&quot;</span>, ip, path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Bucket <span class="title function_">createBucket</span><span class="params">(RateLimitConfig config)</span> &#123;</span><br><span class="line">        <span class="type">Refill</span> <span class="variable">refill</span> <span class="operator">=</span> Refill.intervally(config.capacity, Duration.ofMinutes(config.period));</span><br><span class="line">        <span class="type">Bandwidth</span> <span class="variable">limit</span> <span class="operator">=</span> Bandwidth.classic(config.capacity, refill);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LocalBucketBuilder</span>().addLimit(limit).build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getClientIP</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">xfHeader</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;X-Forwarded-For&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (xfHeader != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> xfHeader.split(<span class="string">&quot;,&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> request.getRemoteAddr();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">RateLimitConfig</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> capacity;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> period; <span class="comment">// 分钟</span></span><br><span class="line">        </span><br><span class="line">        RateLimitConfig(<span class="type">int</span> capacity, <span class="type">int</span> period) &#123;</span><br><span class="line">            <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">            <span class="built_in">this</span>.period = period;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>这个扩展版本提供了：</p>
<ol>
<li><strong>缓存优化</strong>：Redis缓存支持</li>
<li><strong>全文搜索</strong>：Elasticsearch集成</li>
<li><strong>实时通知</strong>：WebSocket支持</li>
<li><strong>文件处理</strong>：完整的文件上传服务</li>
<li><strong>邮件服务</strong>：用户通知和系统邮件</li>
<li><strong>定时任务</strong>：自动清理和统计</li>
<li><strong>API文档</strong>：Swagger集成</li>
<li><strong>状态管理</strong>：增强版前端状态管理</li>
<li><strong>富文本编辑器</strong>：完整的编辑器组件</li>
<li><strong>图表分析</strong>：数据可视化</li>
<li><strong>SEO优化</strong>：完整的SEO支持</li>
<li><strong>管理后台</strong>：完整的管理界面</li>
<li><strong>PDF导出</strong>：文章导出功能</li>
<li><strong>翻译服务</strong>：多语言支持</li>
<li><strong>推荐系统</strong>：个性化推荐算法</li>
<li><strong>容器化部署</strong>：Docker和Kubernetes配置</li>
<li><strong>监控系统</strong>：Prometheus + Grafana监控</li>
<li><strong>安全增强</strong>：完整的API安全防护</li>
<li><strong>限流保护</strong>：防止恶意请求</li>
</ol>
<p>这是一个企业级的完整博客系统，涵盖了现代Web开发的所有重要方面。</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/76a16698.html" rel="prev" title="Java实践:多人在线聊天室">
                  <i class="fa fa-angle-left"></i> Java实践:多人在线聊天室
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/31cf01ae.html" rel="next" title="Java实践:电商后台系统">
                  Java实践:电商后台系统 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa-regular fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder"></span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Word count total">421k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">25:30</span>
  </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.0/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>

  <script class="next-config" data-name="wavedrom" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.5.0/wavedrom.min.js","integrity":"sha256-INLAoJc6quTNfiMWkGZniYO2cxE8mHpddnLow1m6RFs="}}</script>
  <script class="next-config" data-name="wavedrom_skin" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.5.0/skins/default.js","integrity":"sha256-fduc/Zszk5ezWws2uInY/ALWVmIrmV6VTgXbsYSReFI="}}</script>
  <script src="/js/third-party/tags/wavedrom.js"></script>




  





</body>
</html>
