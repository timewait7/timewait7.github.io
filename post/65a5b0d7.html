<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"timewait7.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Javaæ–°ç‰¹æ€§Java 8ï¼ˆğŸ“ï¼‰Java 9Java 10Java 11Java 12 &amp; 13Java 14 &amp; 15Java 16Java 17ï¼ˆğŸ“ï¼‰Java 18Java 19Java 20Java 21ï¼ˆğŸ“ï¼‰Java 22 &amp; 23Java 24JavaåŸºç¡€è¯­æ³•åŸºç¡€&#x3D;&#x3D;å’Œequalsçš„åŒºåˆ«&#x3D;&#x3D; ç”¨äºæ¯”è¾ƒåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼æˆ–å¯¹è±¡å¼•ç”¨çš„å†…å­˜åœ°å€ï¼Œequals ç”¨æˆ·æ¯”">
<meta property="og:type" content="article">
<meta property="og:title" content="Javaå­¦ä¹ &amp;é¢è¯•">
<meta property="og:url" content="http://timewait7.github.io/post/65a5b0d7.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Javaæ–°ç‰¹æ€§Java 8ï¼ˆğŸ“ï¼‰Java 9Java 10Java 11Java 12 &amp; 13Java 14 &amp; 15Java 16Java 17ï¼ˆğŸ“ï¼‰Java 18Java 19Java 20Java 21ï¼ˆğŸ“ï¼‰Java 22 &amp; 23Java 24JavaåŸºç¡€è¯­æ³•åŸºç¡€&#x3D;&#x3D;å’Œequalsçš„åŒºåˆ«&#x3D;&#x3D; ç”¨äºæ¯”è¾ƒåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼æˆ–å¯¹è±¡å¼•ç”¨çš„å†…å­˜åœ°å€ï¼Œequals ç”¨æˆ·æ¯”">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://timewait7.github.io/post/65a5b0d7/1726212535664-4bb3f3ff-704a-4706-84c8-a046a8486657.webp">
<meta property="og:image" content="http://timewait7.github.io/post/65a5b0d7/image-20250302111116621.png">
<meta property="og:image" content="http://timewait7.github.io/post/65a5b0d7/image-20250302111551681.png">
<meta property="og:image" content="http://timewait7.github.io/post/65a5b0d7/image-20250302112330725.png">
<meta property="og:image" content="https://cdn.tobebetterjavaer.com/stutymore/redis-20240918114125.png">
<meta property="og:image" content="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-b7b24e25-d2dc-4457-994f-95bdb3674b8e.png">
<meta property="og:image" content="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-942a927a-86e4-4a01-8f52-9addd89642ff.png">
<meta property="og:image" content="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-df77ee15-2ff0-4ec7-8e65-e4ebb8ba88f1.png">
<meta property="og:image" content="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-e29a122b-db07-48b8-8289-7251032e87a1.png">
<meta property="og:image" content="http://timewait7.github.io/post/65a5b0d7/image-20250505093121422.png">
<meta property="article:published_time" content="2025-07-19T05:58:30.000Z">
<meta property="article:modified_time" content="2025-07-20T08:24:51.282Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://timewait7.github.io/post/65a5b0d7/1726212535664-4bb3f3ff-704a-4706-84c8-a046a8486657.webp">


<link rel="canonical" href="http://timewait7.github.io/post/65a5b0d7.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://timewait7.github.io/post/65a5b0d7.html","path":"post/65a5b0d7.html","title":"Javaå­¦ä¹ &é¢è¯•"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Javaå­¦ä¹ &é¢è¯• | Hexo</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Hexo</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-archives"><a href="/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="Searching..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Java"><span class="nav-number">1.</span> <span class="nav-text">Java</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B0%E7%89%B9%E6%80%A7"><span class="nav-number">1.1.</span> <span class="nav-text">æ–°ç‰¹æ€§</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-8%EF%BC%88%F0%9F%93%8D%EF%BC%89"><span class="nav-number">1.1.1.</span> <span class="nav-text">Java 8ï¼ˆğŸ“ï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-9"><span class="nav-number">1.1.2.</span> <span class="nav-text">Java 9</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-10"><span class="nav-number">1.1.3.</span> <span class="nav-text">Java 10</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-11"><span class="nav-number">1.1.4.</span> <span class="nav-text">Java 11</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-12-13"><span class="nav-number">1.1.5.</span> <span class="nav-text">Java 12 &amp; 13</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-14-15"><span class="nav-number">1.1.6.</span> <span class="nav-text">Java 14 &amp; 15</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-16"><span class="nav-number">1.1.7.</span> <span class="nav-text">Java 16</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-17%EF%BC%88%F0%9F%93%8D%EF%BC%89"><span class="nav-number">1.1.8.</span> <span class="nav-text">Java 17ï¼ˆğŸ“ï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-18"><span class="nav-number">1.1.9.</span> <span class="nav-text">Java 18</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-19"><span class="nav-number">1.1.10.</span> <span class="nav-text">Java 19</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-20"><span class="nav-number">1.1.11.</span> <span class="nav-text">Java 20</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-21%EF%BC%88%F0%9F%93%8D%EF%BC%89"><span class="nav-number">1.1.12.</span> <span class="nav-text">Java 21ï¼ˆğŸ“ï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-22-23"><span class="nav-number">1.1.13.</span> <span class="nav-text">Java 22 &amp; 23</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Java-24"><span class="nav-number">1.1.14.</span> <span class="nav-text">Java 24</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java%E5%9F%BA%E7%A1%80"><span class="nav-number">1.2.</span> <span class="nav-text">JavaåŸºç¡€</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80"><span class="nav-number">1.2.1.</span> <span class="nav-text">è¯­æ³•åŸºç¡€</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%92%8Cequals%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">&#x3D;&#x3D;å’Œequalsçš„åŒºåˆ«</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#equals%E5%92%8ChashCode%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%90%8C%E6%97%B6%E9%87%8D%E5%86%99"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">equalså’ŒhashCodeä¸ºä»€ä¹ˆè¦åŒæ—¶é‡å†™</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E7%9A%84%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">å¼‚å¸¸çš„å±‚æ¬¡ç»“æ„</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%9B%E5%9E%8B"><span class="nav-number">1.2.2.</span> <span class="nav-text">æ³›å‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%B3%9B%E5%9E%8B"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%B3%9B%E5%9E%8B%E6%93%A6%E9%99%A4"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯æ³›å‹æ“¦é™¤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%9B%E5%9E%8B%E7%9A%84%E4%B8%8A%E4%B8%8B%E9%99%90%E5%8F%8A%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">æ³›å‹çš„ä¸Šä¸‹é™åŠåº”ç”¨åœºæ™¯</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84"><span class="nav-number">1.2.3.</span> <span class="nav-text">åå°„</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%8F%8D%E5%B0%84"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯åå°„</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">åå°„çš„ä¼˜ç¼ºç‚¹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96%E4%B8%80%E4%B8%AA%E7%B1%BB%E7%9A%84-Class-%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">å¦‚ä½•è·å–ä¸€ä¸ªç±»çš„ Class å¯¹è±¡</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87%E5%8F%8D%E5%B0%84%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%B1%BB%E7%9A%84%E5%AE%9E%E4%BE%8B"><span class="nav-number">1.2.3.4.</span> <span class="nav-text">å¦‚ä½•é€šè¿‡åå°„åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E6%9C%89%E5%93%AA%E4%BA%9B%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">1.2.3.5.</span> <span class="nav-text">åå°„æœ‰å“ªäº›å®é™…åº”ç”¨åœºæ™¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Class-forName-%E5%92%8C-ClassLoader-loadClass-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB"><span class="nav-number">1.2.3.6.</span> <span class="nav-text">Class.forName() å’Œ ClassLoader.loadClass() æœ‰ä»€ä¹ˆåŒºåˆ«</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E5%8F%8D%E5%B0%84%E7%A0%B4%E5%9D%8F%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.2.3.7.</span> <span class="nav-text">å¦‚ä½•é˜²æ­¢åå°„ç ´åå•ä¾‹æ¨¡å¼</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3"><span class="nav-number">1.2.4.</span> <span class="nav-text">æ³¨è§£</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Java%E4%B8%AD%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B%E5%85%83%E6%B3%A8%E8%A7%A3"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">Javaä¸­éƒ½æœ‰å“ªäº›å…ƒæ³¨è§£</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SPI"><span class="nav-number">1.2.5.</span> <span class="nav-text">SPI</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java%E9%9B%86%E5%90%88"><span class="nav-number">1.3.</span> <span class="nav-text">Javaé›†åˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E5%90%88%E5%9F%BA%E7%A1%80"><span class="nav-number">1.3.1.</span> <span class="nav-text">é›†åˆåŸºç¡€</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Iterator-%E5%92%8C-ListIterator-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">Iterator å’Œ ListIterator çš„åŒºåˆ«</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-fail-fast-%E6%9C%BA%E5%88%B6"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯ fail-fast æœºåˆ¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fail-fast-%E5%92%8C-fail-safe-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">1.3.1.3.</span> <span class="nav-text">fail-fast å’Œ fail-safe çš„åŒºåˆ«</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#List"><span class="nav-number">1.3.2.</span> <span class="nav-text">List</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ArrayList%E7%9A%84%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">ArrayListçš„æ‰©å®¹æœºåˆ¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Vector-%E5%92%8C-ArrayList-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">Vector å’Œ ArrayList çš„åŒºåˆ«</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Set"><span class="nav-number">1.3.3.</span> <span class="nav-text">Set</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HashSet%E3%80%81LinkedHashSet-%E5%92%8C-TreeSet-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">HashSetã€LinkedHashSet å’Œ TreeSet çš„åŒºåˆ«</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Map"><span class="nav-number">1.3.4.</span> <span class="nav-text">Map</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HashMap-%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-number">1.3.4.1.</span> <span class="nav-text">HashMap çš„åº•å±‚å®ç°åŸç†</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HashMap-%E5%92%8C-HashTable-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">1.3.4.2.</span> <span class="nav-text">HashMap å’Œ HashTable çš„åŒºåˆ«</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java-IO"><span class="nav-number">1.4.</span> <span class="nav-text">Java IO</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E8%8A%82%E6%B5%81%E4%B8%8E%E5%AD%97%E7%AC%A6%E6%B5%81%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">1.4.1.</span> <span class="nav-text">å­—èŠ‚æµä¸å­—ç¬¦æµçš„åŒºåˆ«</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BIO%E3%80%81NIO%E3%80%81AIO%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">1.4.2.</span> <span class="nav-text">BIOã€NIOã€AIOçš„åŒºåˆ«</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NIO-%E4%B8%89%E5%A4%A7%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="nav-number">1.4.3.</span> <span class="nav-text">NIO ä¸‰å¤§æ ¸å¿ƒç»„ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E9%9B%B6%E6%8B%B7%E8%B4%9D"><span class="nav-number">1.4.4.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯é›¶æ‹·è´</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%E7%A7%8DIO%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.4.5.</span> <span class="nav-text">5ç§IOæ¨¡å‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFReactor%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.4.6.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯Reactoræ¨¡å‹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java%E5%B9%B6%E5%8F%91"><span class="nav-number">1.5.</span> <span class="nav-text">Javaå¹¶å‘</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JUC%E9%9B%86%E5%90%88"><span class="nav-number">1.5.1.</span> <span class="nav-text">JUCé›†åˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ConcurrentHashMap-%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">ConcurrentHashMap çš„å®ç°åŸç†</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-ConcurrentHashMap-%E6%AF%94-Hashtable-%E6%95%88%E7%8E%87%E9%AB%98"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">ä¸ºä»€ä¹ˆ ConcurrentHashMap æ¯” Hashtable æ•ˆç‡é«˜</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B"><span class="nav-number">1.6.</span> <span class="nav-text">å¼‚æ­¥ç¼–ç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CompletableFuture%E7%9A%84%E5%8E%9F%E7%90%86%E4%B8%8E%E5%BA%94%E7%94%A8"><span class="nav-number">1.6.1.</span> <span class="nav-text">CompletableFutureçš„åŸç†ä¸åº”ç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CompletableFuture-%E5%92%8C%E4%BC%A0%E7%BB%9F%E7%9A%84-Future-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB"><span class="nav-number">1.6.2.</span> <span class="nav-text">CompletableFuture å’Œä¼ ç»Ÿçš„ Future æœ‰ä»€ä¹ˆåŒºåˆ«</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JVM"><span class="nav-number">1.7.</span> <span class="nav-text">JVM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD"><span class="nav-number">1.7.1.</span> <span class="nav-text">ç±»åŠ è½½</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E7%9A%84%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84"><span class="nav-number">1.7.1.1.</span> <span class="nav-text">ç±»åŠ è½½å™¨çš„å±‚æ¬¡ç»“æ„</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Class-forName-%E5%92%8CClassLoader-loadClass-%E5%8C%BA%E5%88%AB"><span class="nav-number">1.7.1.2.</span> <span class="nav-text">Class.forName()å’ŒClassLoader.loadClass()åŒºåˆ«</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84"><span class="nav-number">1.7.2.</span> <span class="nav-text">å†…å­˜ç»“æ„</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#JVM%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84"><span class="nav-number">1.7.2.1.</span> <span class="nav-text">JVMå†…å­˜ç»“æ„</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E4%BC%9A%E8%A7%A6%E5%8F%91StackOverflowError%E5%92%8COutOfMemoryError"><span class="nav-number">1.7.2.2.</span> <span class="nav-text">ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè§¦å‘StackOverflowErrorå’ŒOutOfMemoryError</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B0%B8%E4%B9%85%E4%BB%A3%E5%92%8C%E5%85%83%E7%A9%BA%E9%97%B4%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">1.7.2.3.</span> <span class="nav-text">æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´çš„åŒºåˆ«</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A0%86%E5%86%85%E5%AD%98%E6%98%AF%E6%80%8E%E4%B9%88%E7%BB%86%E5%88%86%E7%9A%84"><span class="nav-number">1.7.2.4.</span> <span class="nav-text">å †å†…å­˜æ˜¯æ€ä¹ˆç»†åˆ†çš„</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6"><span class="nav-number">1.7.3.</span> <span class="nav-text">åƒåœ¾å›æ”¶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E6%98%AF%E5%90%A6%E5%8F%AF%E5%9B%9E%E6%94%B6"><span class="nav-number">1.7.3.1.</span> <span class="nav-text">å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%89%E5%93%AA%E4%BA%9B%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95"><span class="nav-number">1.7.3.2.</span> <span class="nav-text">æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CMS%E6%94%B6%E9%9B%86%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">1.7.3.3.</span> <span class="nav-text">CMSæ”¶é›†å™¨å·¥ä½œåŸç†</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#G1%E6%94%B6%E9%9B%86%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">1.7.3.4.</span> <span class="nav-text">G1æ”¶é›†å™¨å·¥ä½œåŸç†</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8"><span class="nav-number">2.</span> <span class="nav-text">æ•°æ®å­˜å‚¨</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL"><span class="nav-number">2.1.</span> <span class="nav-text">MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="nav-number">2.1.1.</span> <span class="nav-text">æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œé¡ºåº</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#InnoDB%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84"><span class="nav-number">2.1.2.</span> <span class="nav-text">InnoDBç´¢å¼•ç»“æ„</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88MongoDB%E4%BD%BF%E7%94%A8B%E6%A0%91%E8%80%8CMySQL%E7%94%A8B-%E6%A0%91"><span class="nav-number">2.1.3.</span> <span class="nav-text">ä¸ºä»€ä¹ˆMongoDBä½¿ç”¨Bæ ‘è€ŒMySQLç”¨B+æ ‘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#B-%E6%A0%91%E8%8A%82%E7%82%B9%E5%88%86%E8%A3%82%E7%9A%84%E5%85%B7%E4%BD%93%E8%BF%87%E7%A8%8B"><span class="nav-number">2.1.4.</span> <span class="nav-text">B+æ ‘èŠ‚ç‚¹åˆ†è£‚çš„å…·ä½“è¿‡ç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EXPLAIN-%E5%AD%97%E6%AE%B5%E8%AF%B4%E6%98%8E"><span class="nav-number">2.1.5.</span> <span class="nav-text">EXPLAIN å­—æ®µè¯´æ˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95%E4%B8%8E%E6%9C%80%E5%B7%A6%E5%89%8D%E7%BC%80%E5%8E%9F%E5%88%99%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B"><span class="nav-number">2.1.6.</span> <span class="nav-text">è¦†ç›–ç´¢å¼•ä¸æœ€å·¦å‰ç¼€åŸåˆ™å®æˆ˜æ¡ˆä¾‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="nav-number">2.1.7.</span> <span class="nav-text">æ…¢æŸ¥è¯¢ä¼˜åŒ–</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88InnoDB%E4%B8%8D%E4%BF%9D%E5%AD%98%E8%A1%A8%E7%9A%84%E6%80%BB%E8%A1%8C%E6%95%B0"><span class="nav-number">2.1.8.</span> <span class="nav-text">ä¸ºä»€ä¹ˆInnoDBä¸ä¿å­˜è¡¨çš„æ€»è¡Œæ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%87%8A%E4%B8%80%E4%B8%8B%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%89%B9%E6%80%A7%E5%92%8C%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="nav-number">2.1.9.</span> <span class="nav-text">è§£é‡Šä¸€ä¸‹äº‹åŠ¡çš„åŸºæœ¬ç‰¹æ€§å’Œéš”ç¦»çº§åˆ«</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#InnoDB%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%B9%BB%E8%AF%BB"><span class="nav-number">2.1.10.</span> <span class="nav-text">InnoDBå¦‚ä½•è§£å†³å¹»è¯»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#InnoDB%E5%92%8CMyISAM%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">2.1.11.</span> <span class="nav-text">InnoDBå’ŒMyISAMçš„åŒºåˆ«</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%89%E6%97%B6%E7%B4%A2%E5%BC%95%E4%BC%9A%E5%A4%B1%E6%95%88%E6%88%96%E9%80%89%E9%94%99%E7%B4%A2%E5%BC%95"><span class="nav-number">2.1.12.</span> <span class="nav-text">ä¸ºä»€ä¹ˆæœ‰æ—¶ç´¢å¼•ä¼šå¤±æ•ˆæˆ–é€‰é”™ç´¢å¼•</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BC%98%E5%8C%96%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.1.13.</span> <span class="nav-text">å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%89%E6%97%B6%E5%8F%AA%E6%9F%A5%E8%AF%A2%E4%B8%80%E8%A1%8C%E4%BD%86%E6%98%AF%E5%BE%88%E6%85%A2"><span class="nav-number">2.1.14.</span> <span class="nav-text">ä¸ºä»€ä¹ˆæœ‰æ—¶åªæŸ¥è¯¢ä¸€è¡Œä½†æ˜¯å¾ˆæ…¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%85%A2SQL%E4%BC%98%E5%8C%96%E5%85%A8%E6%B5%81%E7%A8%8B"><span class="nav-number">2.1.15.</span> <span class="nav-text">æ…¢SQLä¼˜åŒ–å…¨æµç¨‹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis"><span class="nav-number">2.2.</span> <span class="nav-text">Redis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%AB%EF%BC%9F%E5%8D%95%E7%BA%BF%E7%A8%8B%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E9%AB%98%E5%B9%B6%E5%8F%91%EF%BC%9F"><span class="nav-number">2.2.1.</span> <span class="nav-text">Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿå•çº¿ç¨‹å¦‚ä½•å¤„ç†é«˜å¹¶å‘ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%87%8A%E4%B8%80%E4%B8%8B%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F-%E9%9B%AA%E5%B4%A9-%E5%87%BB%E7%A9%BF%EF%BC%8C%E5%AF%B9%E5%BA%94%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">2.2.2.</span> <span class="nav-text">è§£é‡Šä¸€ä¸‹ç¼“å­˜ç©¿é€&#x2F;é›ªå´©&#x2F;å‡»ç©¿ï¼Œå¯¹åº”çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RDB%E5%92%8CAOF%E6%8C%81%E4%B9%85%E5%8C%96%E5%8E%9F%E7%90%86%E5%8F%8A%E4%BC%98%E5%8A%A3%E5%AF%B9%E6%AF%94"><span class="nav-number">2.2.3.</span> <span class="nav-text">RDBå’ŒAOFæŒä¹…åŒ–åŸç†åŠä¼˜åŠ£å¯¹æ¯”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%83%ADKey%E9%97%AE%E9%A2%98"><span class="nav-number">2.2.4.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯çƒ­Keyé—®é¢˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis%E4%BA%8B%E5%8A%A1%E4%B8%8EMySQL%E4%BA%8B%E5%8A%A1%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB"><span class="nav-number">2.2.5.</span> <span class="nav-text">Redisäº‹åŠ¡ä¸MySQLäº‹åŠ¡æœ‰ä»€ä¹ˆåŒºåˆ«</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Redis%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E7%9A%84%E6%BC%94%E8%BF%9B%E8%BF%87%E7%A8%8B"><span class="nav-number">2.2.6.</span> <span class="nav-text">ä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼é”çš„æ¼”è¿›è¿‡ç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A8%E9%87%8F%E5%90%8C%E6%AD%A5%E5%92%8C%E5%A2%9E%E9%87%8F%E5%90%8C%E6%AD%A5%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">2.2.7.</span> <span class="nav-text">å…¨é‡åŒæ­¥å’Œå¢é‡åŒæ­¥çš„åŒºåˆ«</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E5%AD%98%E6%B7%98%E6%B1%B0%E7%AD%96%E7%95%A5%E4%B8%8ELRU%E5%AE%9E%E7%8E%B0"><span class="nav-number">2.2.8.</span> <span class="nav-text">å†…å­˜æ·˜æ±°ç­–ç•¥ä¸LRUå®ç°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis%E5%92%8CMySQL%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">2.2.9.</span> <span class="nav-text">Rediså’ŒMySQLçš„åŒºåˆ«</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis%E5%92%8Cmemchahed%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">2.2.10.</span> <span class="nav-text">Rediså’Œmemchahedçš„åŒºåˆ«</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis-IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8"><span class="nav-number">2.2.11.</span> <span class="nav-text">Redis IOå¤šè·¯å¤ç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis-6-0-%E5%A4%9A%E7%BA%BF%E7%A8%8B"><span class="nav-number">2.2.12.</span> <span class="nav-text">Redis 6.0 å¤šçº¿ç¨‹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ElasticSearch"><span class="nav-number">2.3.</span> <span class="nav-text">ElasticSearch</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Elasticsearch-%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-number">2.3.1.</span> <span class="nav-text">Elasticsearch çš„æ ¸å¿ƒæ¦‚å¿µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95%EF%BC%9F%E4%B8%BA%E4%BB%80%E4%B9%88%E5%AE%83%E5%AF%B9%E6%90%9C%E7%B4%A2%E5%BE%88%E9%87%8D%E8%A6%81%EF%BC%9F"><span class="nav-number">2.3.2.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆå®ƒå¯¹æœç´¢å¾ˆé‡è¦ï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MongoDB"><span class="nav-number">2.4.</span> <span class="nav-text">MongoDB</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="nav-number">3.</span> <span class="nav-text">æ¶ˆæ¯é˜Ÿåˆ—</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Kafka"><span class="nav-number">3.1.</span> <span class="nav-text">Kafka</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Kafka-%E4%B8%BA%E4%BB%80%E4%B9%88%E8%83%BD%E5%AE%9E%E7%8E%B0%E9%AB%98%E5%90%9E%E5%90%90%E9%87%8F%EF%BC%9F"><span class="nav-number">3.1.1.</span> <span class="nav-text">Kafka ä¸ºä»€ä¹ˆèƒ½å®ç°é«˜ååé‡ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%87%8A-Kafka-%E4%B8%AD-Topic%E3%80%81Partition%E3%80%81Replica-%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-number">3.1.2.</span> <span class="nav-text">è§£é‡Š Kafka ä¸­ Topicã€Partitionã€Replica çš„å…³ç³»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Producer-%E7%9A%84-acks-%E5%8F%82%E6%95%B0%E6%9C%89%E5%93%AA%E5%87%A0%E7%A7%8D%EF%BC%9F%E5%88%86%E5%88%AB%E4%BB%A3%E8%A1%A8%E4%BB%80%E4%B9%88%E5%90%AB%E4%B9%89%EF%BC%9F"><span class="nav-number">3.1.3.</span> <span class="nav-text">Producer çš„ acks å‚æ•°æœ‰å“ªå‡ ç§ï¼Ÿåˆ†åˆ«ä»£è¡¨ä»€ä¹ˆå«ä¹‰ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%87%8A-Consumer-Group-%E5%92%8C-Rebalance-%E7%9A%84%E6%A6%82%E5%BF%B5%E3%80%82"><span class="nav-number">3.1.4.</span> <span class="nav-text">è§£é‡Š Consumer Group å’Œ Rebalance çš„æ¦‚å¿µã€‚</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kafka-%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E4%B8%8D%E4%B8%A2%E5%A4%B1%EF%BC%9F"><span class="nav-number">3.1.5.</span> <span class="nav-text">Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%87%8A-Kafka-%E7%9A%84-ISR-%E6%9C%BA%E5%88%B6%E5%8F%8A%E5%85%B6%E5%9C%A8-Leader-%E9%80%89%E4%B8%BE%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8%E3%80%82"><span class="nav-number">3.1.6.</span> <span class="nav-text">è§£é‡Š Kafka çš„ ISR æœºåˆ¶åŠå…¶åœ¨ Leader é€‰ä¸¾ä¸­çš„ä½œç”¨ã€‚</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kafka-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0-Exactly-Once-%E8%AF%AD%E4%B9%89%EF%BC%9F"><span class="nav-number">3.1.7.</span> <span class="nav-text">Kafka å¦‚ä½•å®ç° Exactly-Once è¯­ä¹‰ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kafka-%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E6%B6%88%E6%81%AF%E7%9A%84%E9%A1%BA%E5%BA%8F%E6%80%A7%EF%BC%9F"><span class="nav-number">3.1.8.</span> <span class="nav-text">Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Kafka-%E4%B8%AD-Zookeeper-%E5%92%8C-KRaft-%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F%E4%B8%BA%E4%BB%80%E4%B9%88-Kafka-%E8%A6%81%E5%8E%BB-Zookeeper-%E5%8C%96%EF%BC%9F"><span class="nav-number">3.1.9.</span> <span class="nav-text">Kafka ä¸­ Zookeeper å’Œ KRaft çš„åŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆ Kafka è¦å» Zookeeper åŒ–ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-Consumer-Lag%EF%BC%9F%E5%A6%82%E4%BD%95%E7%9B%91%E6%8E%A7%E5%92%8C%E5%A4%84%E7%90%86-Lag%EF%BC%9F"><span class="nav-number">3.1.10.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯ Consumer Lagï¼Ÿå¦‚ä½•ç›‘æ§å’Œå¤„ç† Lagï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#kafka%E4%B8%BB%E8%A6%81%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A%E5%BC%82%E6%AD%A5%E3%80%81%E5%89%8A%E5%B3%B0%E3%80%81%E8%A7%A3%E8%80%A6"><span class="nav-number">3.1.11.</span> <span class="nav-text">kafkaä¸»è¦åº”ç”¨åœºæ™¯ï¼šå¼‚æ­¥ã€å‰Šå³°ã€è§£è€¦</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RabbitMQ"><span class="nav-number">3.2.</span> <span class="nav-text">RabbitMQ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RocketMQ"><span class="nav-number">3.3.</span> <span class="nav-text">RocketMQ</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6"><span class="nav-number">4.</span> <span class="nav-text">å¼€å‘æ¡†æ¶</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring"><span class="nav-number">4.1.</span> <span class="nav-text">Spring</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96%E8%A7%A3%E5%86%B3%E5%8E%9F%E7%90%86"><span class="nav-number">4.1.1.</span> <span class="nav-text">å¾ªç¯ä¾èµ–è§£å†³åŸç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FactoryBean-%E7%9A%84%E4%BD%9C%E7%94%A8%E4%B8%8E%E5%BA%94%E7%94%A8"><span class="nav-number">4.1.2.</span> <span class="nav-text">FactoryBean çš„ä½œç”¨ä¸åº”ç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BeanFactoryPostProcessor-%E5%92%8C-BeanPostProcessor-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">4.1.3.</span> <span class="nav-text">BeanFactoryPostProcessor å’Œ BeanPostProcessor çš„åŒºåˆ«</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%89%A9%E5%B1%95%E7%82%B9%E5%AE%9E%E6%88%98"><span class="nav-number">4.1.4.</span> <span class="nav-text">Beanç”Ÿå‘½å‘¨æœŸæ‰©å±•ç‚¹å®æˆ˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SpringBoot%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="nav-number">4.1.5.</span> <span class="nav-text">SpringBootè‡ªåŠ¨é…ç½®åŸç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Starter%E5%BC%80%E5%8F%91%E8%A6%81%E7%82%B9"><span class="nav-number">4.1.6.</span> <span class="nav-text">è‡ªå®šä¹‰Starterå¼€å‘è¦ç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">4.1.7.</span> <span class="nav-text">ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%88%E5%91%BD%E4%BB%A4%E8%A1%8C-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%EF%BC%89"><span class="nav-number">4.1.8.</span> <span class="nav-text">é…ç½®åŠ è½½ä¼˜å…ˆçº§ï¼ˆå‘½ä»¤è¡Œ&gt;ç¯å¢ƒå˜é‡ï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-AOP-%E5%92%8C-AspectJ-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB"><span class="nav-number">4.1.9.</span> <span class="nav-text">Spring AOP å’Œ AspectJ æœ‰ä»€ä¹ˆåŒºåˆ«</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E3%80%81%E6%8B%A6%E6%88%AA%E5%99%A8%E3%80%81AOP%E7%9A%84%E5%8C%BA%E5%88%AB%E4%B8%8E%E5%AE%9E%E8%B7%B5"><span class="nav-number">4.1.10.</span> <span class="nav-text">è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨ã€AOPçš„åŒºåˆ«ä¸å®è·µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-number">4.1.11.</span> <span class="nav-text">æ³¨è§£çš„å®ç°åŸç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MapperScan-%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-number">4.1.12.</span> <span class="nav-text">@MapperScan çš„å®ç°åŸç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Autowired-%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-number">4.1.13.</span> <span class="nav-text">@Autowired çš„å®ç°åŸç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SpringMVC-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="nav-number">4.1.14.</span> <span class="nav-text">SpringMVC å·¥ä½œæµç¨‹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SpringBoot"><span class="nav-number">4.2.</span> <span class="nav-text">SpringBoot</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SpringBoot%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86"><span class="nav-number">4.2.1.</span> <span class="nav-text">SpringBootè‡ªåŠ¨è£…é…åŸç†</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Tomcat"><span class="nav-number">4.3.</span> <span class="nav-text">Tomcat</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MyBatis"><span class="nav-number">4.4.</span> <span class="nav-text">MyBatis</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JPA"><span class="nav-number">4.5.</span> <span class="nav-text">JPA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6"><span class="nav-number">4.6.</span> <span class="nav-text">æ—¥å¿—æ¡†æ¶</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F"><span class="nav-number">5.</span> <span class="nav-text">åˆ†å¸ƒå¼</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E7%90%86%E8%AE%BA"><span class="nav-number">5.1.</span> <span class="nav-text">åŸºæœ¬ç†è®º</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFCAP"><span class="nav-number">5.1.1.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯CAP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFBASE"><span class="nav-number">5.1.2.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯BASE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AE"><span class="nav-number">5.2.</span> <span class="nav-text">ä¸€è‡´æ€§åè®®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Paxos"><span class="nav-number">5.2.1.</span> <span class="nav-text">Paxos</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Raft"><span class="nav-number">5.2.2.</span> <span class="nav-text">Raft</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81"><span class="nav-number">5.3.</span> <span class="nav-text">åˆ†å¸ƒå¼é”</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8FID%E7%94%9F%E6%88%90"><span class="nav-number">5.4.</span> <span class="nav-text">åˆ†å¸ƒå¼IDç”Ÿæˆ</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1"><span class="nav-number">6.</span> <span class="nav-text">ç³»ç»Ÿè®¾è®¡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83"><span class="nav-number">6.1.</span> <span class="nav-text">è®¤è¯æˆæƒ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8"><span class="nav-number">6.2.</span> <span class="nav-text">æ•°æ®å®‰å…¨</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E6%80%A7%E8%83%BD"><span class="nav-number">6.3.</span> <span class="nav-text">é«˜æ€§èƒ½</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E5%8F%AF%E7%94%A8"><span class="nav-number">6.4.</span> <span class="nav-text">é«˜å¯ç”¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%99%90%E6%B5%81"><span class="nav-number">6.4.1.</span> <span class="nav-text">é™æµ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E9%99%90%E6%B5%81%E7%AE%97%E6%B3%95%E6%9C%89%E5%93%AA%E4%BA%9B"><span class="nav-number">6.4.1.1.</span> <span class="nav-text">å¸¸è§çš„é™æµç®—æ³•æœ‰å“ªäº›</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%99%8D%E7%BA%A7-%E7%86%94%E6%96%AD"><span class="nav-number">6.4.2.</span> <span class="nav-text">é™çº§&amp;ç†”æ–­</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#DevOps"><span class="nav-number">7.</span> <span class="nav-text">DevOps</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Linux"><span class="nav-number">7.1.</span> <span class="nav-text">Linux</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Docker"><span class="nav-number">7.2.</span> <span class="nav-text">Docker</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CI-CD"><span class="nav-number">7.3.</span> <span class="nav-text">CI&#x2F;CD</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%BA%93"><span class="nav-number">8.</span> <span class="nav-text">å·¥å…·ç±»åº“</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Git"><span class="nav-number">8.1.</span> <span class="nav-text">Git</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Maven"><span class="nav-number">8.2.</span> <span class="nav-text">Maven</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80"><span class="nav-number">9.</span> <span class="nav-text">è®¡ç®—æœºåŸºç¡€</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="nav-number">9.1.</span> <span class="nav-text">æ“ä½œç³»ç»Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C"><span class="nav-number">9.2.</span> <span class="nav-text">è®¡ç®—æœºç½‘ç»œ</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%9D%E7%BB%B4%E9%80%BB%E8%BE%91"><span class="nav-number">10.</span> <span class="nav-text">æ€ç»´é€»è¾‘</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%8F%E7%99%BD%E9%BC%A0%E8%AF%95%E6%AF%92%E8%8D%AF"><span class="nav-number">10.1.</span> <span class="nav-text">å°ç™½é¼ è¯•æ¯’è¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#100%E4%B8%AA%E4%BA%BA%E6%8C%89%E7%81%AF"><span class="nav-number">10.2.</span> <span class="nav-text">100ä¸ªäººæŒ‰ç¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#100%E7%9A%84%E9%98%B6%E4%B9%98%E6%9C%89%E5%87%A0%E4%B8%AA0"><span class="nav-number">10.3.</span> <span class="nav-text">100çš„é˜¶ä¹˜æœ‰å‡ ä¸ª0</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E5%A4%A9%E5%B9%B3%E6%89%BE%E6%9C%80%E8%BD%BB-%E9%87%8D%E7%9A%84%E7%90%83"><span class="nav-number">10.4.</span> <span class="nav-text">ç”¨å¤©å¹³æ‰¾æœ€è½»&#x2F;é‡çš„çƒ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2017%E7%9A%842017-%E6%AC%A1%E6%96%B9%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E4%BD%8D%E6%95%B0"><span class="nav-number">10.5.</span> <span class="nav-text">2017çš„2017 æ¬¡æ–¹çš„æœ€åä¸€ä½æ•°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#25%E5%8C%B9%E9%A9%AC%EF%BC%8C5%E4%B8%AA%E8%B7%91%E9%81%93%EF%BC%8C%E6%9C%80%E5%B0%91%E6%AF%94%E5%A4%9A%E5%B0%91%E6%AC%A1%E8%83%BD%E6%AF%94%E5%87%BA%E5%89%8D3%E5%90%8D"><span class="nav-number">10.6.</span> <span class="nav-text">25åŒ¹é©¬ï¼Œ5ä¸ªè·‘é“ï¼Œæœ€å°‘æ¯”å¤šå°‘æ¬¡èƒ½æ¯”å‡ºå‰3å</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/">
          <span class="site-state-item-count">35</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://timewait7.github.io/post/65a5b0d7.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Javaå­¦ä¹ &é¢è¯• | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Javaå­¦ä¹ &é¢è¯•
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-07-19 13:58:30" itemprop="dateCreated datePublished" datetime="2025-07-19T13:58:30+08:00">2025-07-19</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>34k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>2:05</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h1><h2 id="æ–°ç‰¹æ€§"><a href="#æ–°ç‰¹æ€§" class="headerlink" title="æ–°ç‰¹æ€§"></a>æ–°ç‰¹æ€§</h2><h3 id="Java-8ï¼ˆğŸ“ï¼‰"><a href="#Java-8ï¼ˆğŸ“ï¼‰" class="headerlink" title="Java 8ï¼ˆğŸ“ï¼‰"></a>Java 8ï¼ˆğŸ“ï¼‰</h3><h3 id="Java-9"><a href="#Java-9" class="headerlink" title="Java 9"></a>Java 9</h3><h3 id="Java-10"><a href="#Java-10" class="headerlink" title="Java 10"></a>Java 10</h3><h3 id="Java-11"><a href="#Java-11" class="headerlink" title="Java 11"></a>Java 11</h3><h3 id="Java-12-13"><a href="#Java-12-13" class="headerlink" title="Java 12 &amp; 13"></a>Java 12 &amp; 13</h3><h3 id="Java-14-15"><a href="#Java-14-15" class="headerlink" title="Java 14 &amp; 15"></a>Java 14 &amp; 15</h3><h3 id="Java-16"><a href="#Java-16" class="headerlink" title="Java 16"></a>Java 16</h3><h3 id="Java-17ï¼ˆğŸ“ï¼‰"><a href="#Java-17ï¼ˆğŸ“ï¼‰" class="headerlink" title="Java 17ï¼ˆğŸ“ï¼‰"></a>Java 17ï¼ˆğŸ“ï¼‰</h3><h3 id="Java-18"><a href="#Java-18" class="headerlink" title="Java 18"></a>Java 18</h3><h3 id="Java-19"><a href="#Java-19" class="headerlink" title="Java 19"></a>Java 19</h3><h3 id="Java-20"><a href="#Java-20" class="headerlink" title="Java 20"></a>Java 20</h3><h3 id="Java-21ï¼ˆğŸ“ï¼‰"><a href="#Java-21ï¼ˆğŸ“ï¼‰" class="headerlink" title="Java 21ï¼ˆğŸ“ï¼‰"></a>Java 21ï¼ˆğŸ“ï¼‰</h3><h3 id="Java-22-23"><a href="#Java-22-23" class="headerlink" title="Java 22 &amp; 23"></a>Java 22 &amp; 23</h3><h3 id="Java-24"><a href="#Java-24" class="headerlink" title="Java 24"></a>Java 24</h3><h2 id="JavaåŸºç¡€"><a href="#JavaåŸºç¡€" class="headerlink" title="JavaåŸºç¡€"></a>JavaåŸºç¡€</h2><h3 id="è¯­æ³•åŸºç¡€"><a href="#è¯­æ³•åŸºç¡€" class="headerlink" title="è¯­æ³•åŸºç¡€"></a>è¯­æ³•åŸºç¡€</h3><h4 id="å’Œequalsçš„åŒºåˆ«"><a href="#å’Œequalsçš„åŒºåˆ«" class="headerlink" title="==å’Œequalsçš„åŒºåˆ«"></a><code>==</code>å’Œ<code>equals</code>çš„åŒºåˆ«</h4><p><code>==</code> ç”¨äºæ¯”è¾ƒåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼æˆ–å¯¹è±¡å¼•ç”¨çš„å†…å­˜åœ°å€ï¼Œ<code>equals</code> ç”¨æˆ·æ¯”è¾ƒå¯¹è±¡å†…å®¹ã€‚</p>
<h4 id="equalså’ŒhashCodeä¸ºä»€ä¹ˆè¦åŒæ—¶é‡å†™"><a href="#equalså’ŒhashCodeä¸ºä»€ä¹ˆè¦åŒæ—¶é‡å†™" class="headerlink" title="equalså’ŒhashCodeä¸ºä»€ä¹ˆè¦åŒæ—¶é‡å†™"></a><code>equals</code>å’Œ<code>hashCode</code>ä¸ºä»€ä¹ˆè¦åŒæ—¶é‡å†™</h4><ol>
<li>å¥‘çº¦è¦æ±‚ï¼šå¯¹è±¡ç›¸ç­‰æ€§çš„ä¸€è‡´æ€§</li>
</ol>
<ul>
<li><p><strong><code>Object</code>ç±»çš„è§„èŒƒ</strong>æ˜ç¡®è§„å®šï¼š</p>
<blockquote>
<p>å¦‚æœä¸¤ä¸ªå¯¹è±¡é€šè¿‡<code>equals()</code>æ–¹æ³•æ¯”è¾ƒæ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆå®ƒä»¬çš„<code>hashCode()</code><strong>å¿…é¡»</strong>è¿”å›ç›¸åŒçš„å€¼ã€‚</p>
</blockquote>
</li>
<li><p>å¦‚æœè¿åæ­¤å¥‘çº¦ï¼Œå¯¹è±¡åœ¨åŸºäºå“ˆå¸Œçš„é›†åˆä¸­ä¼šå‡ºç°ä¸å¯é¢„æµ‹çš„è¡Œä¸ºï¼ˆå¦‚<code>HashMap</code>æ— æ³•æ­£ç¡®æŸ¥æ‰¾å¯¹è±¡ï¼‰ã€‚</p>
</li>
</ul>
<ol start="2">
<li>åŸºäºå“ˆå¸Œçš„é›†åˆï¼ˆå¦‚<code>HashMap</code>, <code>HashSet</code>ï¼‰ä¾èµ–<code>hashCode()</code>å’Œ<code>equals()</code>ååŒå·¥ä½œï¼š</li>
</ol>
<ul>
<li><p><strong><code>hashCode()</code>å®šä½æ¡¶ï¼ˆBucketï¼‰</strong>ï¼š<br>é›†åˆé¦–å…ˆè°ƒç”¨<code>hashCode()</code>ç¡®å®šå¯¹è±¡å­˜å‚¨åœ¨å“ªä¸ªå“ˆå¸Œæ¡¶ä¸­ã€‚</p>
</li>
<li><p><strong><code>equals()</code>ç¡®è®¤å”¯ä¸€æ€§</strong>ï¼š<br>åœ¨åŒä¸€ä¸ªæ¡¶å†…ï¼Œå†è°ƒç”¨<code>equals()</code>æ£€æŸ¥å¯¹è±¡æ˜¯å¦çœŸæ­£ç›¸ç­‰ï¼ˆè§£å†³å“ˆå¸Œå†²çªï¼‰ã€‚</p>
</li>
</ul>
<ol start="3">
<li><p>å‡è®¾åªé‡å†™äº†<code>equals()</code>ä½†æœªé‡å†™<code>hashCode()</code>ï¼š</p>
<ul>
<li><p><strong>åœºæ™¯</strong>ï¼šä¸¤ä¸ªå¯¹è±¡<code>a</code>å’Œ<code>b</code>æ»¡è¶³<code>a.equals(b) == true</code>ï¼Œä½†<code>a.hashCode() != b.hashCode()</code>ã€‚</p>
</li>
<li><p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>å®ƒä»¬ä¼šè¢«å­˜å…¥<code>HashMap</code>çš„<strong>ä¸åŒæ¡¶</strong>ä¸­ï¼ˆå› ä¸ºå“ˆå¸Œå€¼ä¸åŒï¼Œæœªé‡å†™çš„<code>hasoCode()</code>é»˜è®¤è¿”å›å†…å­˜åœ°å€ï¼‰ã€‚</li>
<li><code>map.put(a, val1)</code>å’Œ<code>map.put(b, val2)</code>ä¼šåŒæ—¶å­˜åœ¨ï¼Œè¿å<code>Map</code>çš„é”®å”¯ä¸€æ€§ã€‚</li>
</ul>
</li>
<li><p>ç¤ºä¾‹ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="comment">// é‡å†™equalsä½†æœªé‡å†™hashCode</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> (Person) o;</span><br><span class="line">        <span class="keyword">return</span> Objects.equals(name, person.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Person</span> <span class="variable">p1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">    <span class="type">Person</span> <span class="variable">p2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    Set&lt;Person&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    set.add(p1);</span><br><span class="line">    set.add(p2);  <span class="comment">// p1.equals(p2)=trueï¼Œä½†Setä¼šå­˜å‚¨ä¸¤ä¸ªå¯¹è±¡ï¼</span></span><br><span class="line">    System.out.println(set.size()); <span class="comment">// è¾“å‡º2ï¼ˆé”™è¯¯ï¼Œåº”ä¸º1ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>é‡å†™<code>hashCode()</code>éœ€æ»¡è¶³ï¼š</p>
<ul>
<li><strong>ä¸€è‡´æ€§</strong>ï¼šå¦‚æœ<code>a.equals(b)</code>ï¼Œåˆ™<code>a.hashCode() == b.hashCode()</code>ã€‚</li>
<li><strong>ç¨³å®šæ€§</strong>ï¼šåœ¨å¯¹è±¡çŠ¶æ€ä¸å˜æ—¶ï¼Œå¤šæ¬¡è°ƒç”¨<code>hashCode()</code>åº”è¿”å›ç›¸åŒå€¼ã€‚</li>
<li><strong>é«˜æ•ˆæ€§</strong>ï¼šå°½é‡å‡å°‘å“ˆå¸Œå†²çªï¼ˆä¸åŒå¯¹è±¡å°½é‡è¿”å›ä¸åŒå“ˆå¸Œå€¼ï¼‰ã€‚</li>
</ul>
<p><strong>æ¨èæ–¹æ³•</strong>ï¼ˆä½¿ç”¨<code>Objects.hash()</code>ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Objects.hash(name, age); <span class="comment">// åŒ…å«æ‰€æœ‰equalsä¸­ä½¿ç”¨çš„å­—æ®µ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="å¼‚å¸¸çš„å±‚æ¬¡ç»“æ„"><a href="#å¼‚å¸¸çš„å±‚æ¬¡ç»“æ„" class="headerlink" title="å¼‚å¸¸çš„å±‚æ¬¡ç»“æ„"></a>å¼‚å¸¸çš„å±‚æ¬¡ç»“æ„</h4><p><code>Throwable</code>ï¼šæ‰€æœ‰å¼‚å¸¸å’Œé”™è¯¯çš„çˆ¶ç±»</p>
<p><code>Error</code>ï¼š</p>
<ul>
<li><strong>ç³»ç»Ÿçº§ä¸¥é‡é—®é¢˜</strong>ï¼Œåº”ç”¨ç¨‹åºé€šå¸¸æ— æ³•æ¢å¤</li>
<li>ç¤ºä¾‹ï¼š<ul>
<li><code>OutOfMemoryError</code>ï¼šå†…å­˜è€—å°½</li>
<li><code>StackOverflowError</code>ï¼šæ ˆæº¢å‡º</li>
<li><code>VirtualMachineError</code>ï¼šJVMè‡´å‘½é”™è¯¯</li>
</ul>
</li>
<li>â— <strong>æ— éœ€æ•è·å¤„ç†</strong>ï¼ˆå³ä½¿æ•è·ä¹Ÿéš¾ä»¥æ¢å¤ï¼‰</li>
</ul>
<p><code>Exception</code>ï¼š</p>
<ol>
<li><ul>
<li><p><strong>ç¨‹åºå¯å¤„ç†çš„å¼‚å¸¸</strong>ï¼Œåˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li><p><strong>Checked Exceptionsï¼ˆå—æ£€å¼‚å¸¸ï¼‰</strong><br>ç¼–è¯‘å™¨å¼ºåˆ¶è¦æ±‚å¤„ç†ï¼ˆå¿…é¡»<code>try-catch</code>æˆ–<code>throws</code>ï¼‰<br>âœ… <strong>å…¸å‹ä»£è¡¨</strong>ï¼š<code>IOException</code>ã€<code>SQLException</code>ã€<code>ClassNotFoundException</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¿…é¡»å¤„ç†IOExceptionçš„ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  Files.readString(Path.of(<span class="string">&quot;file.txt&quot;</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123; <span class="comment">// å¿…é¡»æ•è·</span></span><br><span class="line">  e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong><code>RuntimeException</code>ï¼ˆè¿è¡Œæ—¶å¼‚å¸¸&#x2F;éå—æ£€å¼‚å¸¸ï¼‰</strong><br>ç¼–è¯‘å™¨ä¸å¼ºåˆ¶å¤„ç†ï¼Œé€šå¸¸ç”±<strong>ç¼–ç¨‹é€»è¾‘é”™è¯¯</strong>å¼•èµ·<br>âš ï¸ <strong>å…¸å‹ä»£è¡¨</strong>ï¼š<code>NullPointerException</code>ã€<code>IndexOutOfBoundsException</code>ã€<code>IllegalArgumentException</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯é€‰çš„è¿è¡Œæ—¶å¼‚å¸¸å¤„ç†</span></span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  System.out.println(str.length()); <span class="comment">// æŠ›å‡ºNullPointerException</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (RuntimeException e) &#123; <span class="comment">// éå¼ºåˆ¶æ•è·</span></span><br><span class="line">  System.out.println(<span class="string">&quot;é€»è¾‘é”™è¯¯ï¼&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ol>
<pre class="mermaid">classDiagram
  Throwable <|-- Error
  Throwable <|-- Exception
  Exception <|-- RuntimeException
  Exception <|-- å…¶ä»–Checked Exceptions
  RuntimeException <|-- Unchecked Exceptions

  class Throwable {
    +String getMessage()
    +void printStackTrace()
  }
  class Error {
    <<ç³»ç»Ÿçº§é”™è¯¯>>
    +OutOfMemoryError
    +StackOverflowError
    +VirtualMachineError
  }
  class Exception {
    <<ç¨‹åºå¯å¤„ç†çš„å¼‚å¸¸>>
  }
  class RuntimeException {
    <<è¿è¡Œæ—¶å¼‚å¸¸>>
    +NullPointerException
    +IndexOutOfBoundsException
    +IllegalArgumentException
  }</pre>



<h3 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h3><h4 id="ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹"><a href="#ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹"></a>ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹</h4><p>æ³›å‹ï¼ˆGenericsï¼‰æ˜¯ç°ä»£ç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚ Javaã€C#ã€C++ã€TypeScript ç­‰ï¼‰ä¸­ä¸€é¡¹æå…¶é‡è¦çš„ç‰¹æ€§ï¼Œå®ƒçš„å‡ºç°ä¸»è¦æ˜¯ä¸ºäº†è§£å†³<strong>ä»£ç å¤ç”¨</strong>ã€<strong>ç±»å‹å®‰å…¨</strong>å’Œ<strong>å¯è¯»æ€§</strong>è¿™ä¸‰å¤§æ ¸å¿ƒé—®é¢˜ã€‚</p>
<p>ğŸ“ 1. <strong>ç±»å‹å®‰å…¨ï¼ˆType Safetyï¼‰</strong></p>
<ul>
<li><strong>é—®é¢˜ï¼š</strong> åœ¨æ²¡æœ‰æ³›å‹ä¹‹å‰ï¼ˆä¾‹å¦‚ä½¿ç”¨ Java çš„ <code>Object</code> æˆ– C# çš„ <code>object</code>ï¼‰ï¼Œå®¹å™¨ç±»ï¼ˆå¦‚é›†åˆ <code>List</code>ã€<code>Array</code>ï¼‰å¯ä»¥å­˜æ”¾ä»»ä½•ç±»å‹çš„å¯¹è±¡ã€‚å½“ä½ ä»å®¹å™¨ä¸­å–å‡ºå¯¹è±¡æ—¶ï¼Œä½ éœ€è¦è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ (<code>(String) myList.get(0)</code>)ã€‚</li>
<li><strong>é£é™©ï¼š</strong> å¦‚æœå®¹å™¨é‡Œä¸å°å¿ƒæ”¾å…¥äº†é”™è¯¯çš„ç±»å‹ï¼ˆæ¯”å¦‚ä½ æœŸæœ›æ˜¯ <code>String</code>ï¼Œä½†å®é™…æ”¾å…¥äº† <code>Integer</code>ï¼‰ï¼Œè¿™ä¸ªé”™è¯¯åœ¨<strong>ç¼–è¯‘æ—¶ä¸ä¼šè¢«å‘ç°</strong>ï¼Œåªæœ‰åœ¨**è¿è¡Œæ—¶è¿›è¡Œå¼ºåˆ¶è½¬æ¢æ—¶æ‰ä¼šæŠ›å‡º <code>ClassCastException</code>**ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚</li>
<li><strong>æ³›å‹è§£å†³æ–¹æ¡ˆï¼š</strong> æ³›å‹å…è®¸ä½ åœ¨<strong>å£°æ˜</strong>å®¹å™¨æ—¶å°±æŒ‡å®šå®ƒåªèƒ½å­˜æ”¾ç‰¹å®šç±»å‹ï¼ˆå¦‚ <code>List&lt;String&gt;</code>ï¼‰ã€‚ç¼–è¯‘å™¨ä¼šåœ¨<strong>ç¼–è¯‘æ—¶</strong>ä¸¥æ ¼æ£€æŸ¥ä½ æ”¾å…¥å®¹å™¨çš„å¯¹è±¡ç±»å‹æ˜¯å¦åŒ¹é…ã€‚å¦‚æœå°è¯•æ”¾å…¥é”™è¯¯ç±»å‹ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥æŠ¥é”™ï¼Œé˜»æ­¢æ½œåœ¨çš„ç±»å‹é”™è¯¯è¿è¡Œåˆ°ç”Ÿäº§ç¯å¢ƒã€‚</li>
</ul>
<p>ğŸ” 2. <strong>æ¶ˆé™¤å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼ˆEliminating Castsï¼‰</strong></p>
<ul>
<li><strong>é—®é¢˜ï¼š</strong> ä½¿ç”¨åŸå§‹ç±»å‹ï¼ˆéæ³›å‹ï¼‰å®¹å™¨æ—¶ï¼Œæ¯æ¬¡å–å‡ºå…ƒç´ éƒ½éœ€è¦è¿›è¡Œæ˜¾å¼çš„ã€å†—é•¿çš„ã€å®¹æ˜“å‡ºé”™çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚ *   <strong>æ³›å‹è§£å†³æ–¹æ¡ˆï¼š</strong> ä½¿ç”¨æ³›å‹å®¹å™¨ï¼ˆå¦‚ <code>List&lt;String&gt;</code>ï¼‰åï¼Œå½“ä½ ä»å®¹å™¨ä¸­è·å–å…ƒç´ æ—¶ï¼ˆå¦‚ <code>String s = myList.get(0);</code>ï¼‰ï¼Œ<strong>ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨çŸ¥é“è¿”å›çš„æ˜¯ <code>String</code> ç±»å‹ï¼Œä¸éœ€è¦ä»»ä½•å¼ºåˆ¶è½¬æ¢</strong>ã€‚ä»£ç æ›´ç®€æ´ï¼Œæ›´å®‰å…¨ã€‚</li>
</ul>
<p>â™» 3. <strong>ä»£ç å¤ç”¨ï¼ˆCode Reuseï¼‰</strong></p>
<ul>
<li><strong>é—®é¢˜ï¼š</strong> ç¼–å†™ä¸€ä¸ªç®—æ³•ï¼ˆæ¯”å¦‚æ’åºã€æœç´¢ã€æ¯”è¾ƒï¼‰ï¼Œä½ å¸Œæœ›å®ƒèƒ½ä½œç”¨äºå¤šç§ä¸åŒç±»å‹çš„å¯¹è±¡ï¼ˆæ•´æ•°ã€å­—ç¬¦ä¸²ã€è‡ªå®šä¹‰å¯¹è±¡ç­‰ï¼‰ã€‚æ²¡æœ‰æ³›å‹æ—¶ï¼Œä½ éœ€è¦ä¸ºæ¯ç§ç±»å‹é‡å†™ç®—æ³•ï¼Œæˆ–è€…ä½¿ç”¨ <code>Object</code> å¹¶ä¼´éšç±»å‹æ£€æŸ¥å’Œè½¬æ¢ã€‚</li>
<li><strong>æ³›å‹è§£å†³æ–¹æ¡ˆï¼š</strong> æ³›å‹å…è®¸ä½ ç¼–å†™<strong>ç±»å‹æ— å…³çš„ç®—æ³•</strong>ã€‚ä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªæ“ä½œåœ¨ç±»å‹å‚æ•° <code>T</code> ä¸Šçš„æ–¹æ³•æˆ–ç±»ï¼ˆä¾‹å¦‚ <code>public static &lt;T&gt; void sort(List&lt;T&gt; list, Comparator&lt;? super T&gt; c)</code>ï¼‰ã€‚åªè¦ç±»å‹ <code>T</code> æ»¡è¶³ç®—æ³•æ‰€éœ€çš„åŸºæœ¬æ¡ä»¶ï¼ˆæ¯”å¦‚å®ç°äº† <code>Comparable</code> æ¥å£ï¼‰ï¼ŒåŒä¸€ä¸ªç®—æ³•ä»£ç å°±å¯ä»¥å®‰å…¨åœ°åº”ç”¨äºå„ç§ä¸åŒçš„æ•°æ®ç±»å‹ã€‚</li>
</ul>
<p>ğŸ“– 4. <strong>æé«˜ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼ˆImproved Readability &amp; Maintainabilityï¼‰</strong></p>
<ul>
<li><strong>é—®é¢˜ï¼š</strong> ä½¿ç”¨åŸå§‹ç±»å‹æˆ– <code>Object</code>ï¼Œä»£ç çš„æ„å›¾å˜å¾—æ¨¡ç³Šã€‚é˜…è¯»ä»£ç çš„äººéœ€è¦ä»”ç»†æŸ¥çœ‹ä¸Šä¸‹æ–‡ï¼ˆæˆ–è€…æ³¨é‡Šï¼‰æ‰èƒ½ç†è§£æŸä¸ªå®¹å™¨é¢„æœŸå­˜æ”¾ä»€ä¹ˆç±»å‹çš„æ•°æ®ã€‚</li>
<li><strong>æ³›å‹è§£å†³æ–¹æ¡ˆï¼š</strong> æ³›å‹å£°æ˜ï¼ˆå¦‚ <code>Map&lt;String, Customer&gt;</code>ï¼‰æœ¬èº«å°±æ˜¯<strong>æ¸…æ™°ã€è‡ªæ–‡æ¡£åŒ–çš„ä»£ç </strong>ã€‚å®ƒæ˜ç¡®åœ°å‘Šè¯‰å¼€å‘è€…å’Œç¼–è¯‘å™¨ï¼šè¿™ä¸ªå®¹å™¨æ˜¯åšä»€ä¹ˆç”¨çš„ï¼ˆå­˜å‚¨é”®ä¸º <code>String</code>ã€å€¼ä¸º <code>Customer</code> çš„æ˜ å°„ï¼‰ã€‚è¿™ä½¿å¾—ä»£ç æ›´å®¹æ˜“ç†è§£ã€ç»´æŠ¤å’Œè°ƒè¯•ã€‚</li>
</ul>
<h4 id="ä»€ä¹ˆæ˜¯æ³›å‹æ“¦é™¤"><a href="#ä»€ä¹ˆæ˜¯æ³›å‹æ“¦é™¤" class="headerlink" title="ä»€ä¹ˆæ˜¯æ³›å‹æ“¦é™¤"></a>ä»€ä¹ˆæ˜¯æ³›å‹æ“¦é™¤</h4><p>æ³›å‹æ“¦é™¤ï¼ˆType Erasureï¼‰æ˜¯ <strong>Java æ³›å‹å®ç°çš„æ ¸å¿ƒæœºåˆ¶</strong>ï¼Œå®ƒæŒ‡ç¼–è¯‘å™¨åœ¨ç¼–è¯‘é˜¶æ®µ<strong>ç§»é™¤æ‰€æœ‰æ³›å‹ç±»å‹ä¿¡æ¯</strong>ï¼Œå°†å…¶æ›¿æ¢ä¸ºåŸå§‹ç±»å‹ï¼ˆRaw Typeï¼‰æˆ–è¾¹ç•Œç±»å‹ï¼ˆBound Typeï¼‰ï¼Œå¹¶åœ¨å¿…è¦æ—¶æ’å…¥å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚è¿™ä¸€è®¾è®¡ä¸»è¦æ˜¯ä¸ºäº†<strong>å…¼å®¹æ—§ç‰ˆæœ¬çš„ Javaï¼ˆJDK 5 ä¹‹å‰ï¼‰</strong>ï¼Œç¡®ä¿æ³›å‹ä»£ç èƒ½ä¸éæ³›å‹é—ç•™ä»£ç äº’æ“ä½œã€‚</p>
<p><strong>ä¸€ã€æ³›å‹æ“¦é™¤çš„æ ¸å¿ƒè§„åˆ™</strong></p>
<ol>
<li><p><strong>ç±»å‹å‚æ•°æ›¿æ¢ä¸ºè¾¹ç•Œç±»å‹</strong></p>
<ul>
<li>è‹¥ç±»å‹å‚æ•°æœ‰ä¸Šé™ï¼ˆå¦‚ <code>&lt;T extends Number&gt;</code>ï¼‰ï¼Œ<code>T</code> è¢«æ›¿æ¢ä¸º<strong>è¾¹ç•Œç±»å‹</strong>ï¼ˆ<code>Number</code>ï¼‰ã€‚</li>
<li>è‹¥æ— æ˜ç¡®ä¸Šé™ï¼ˆå¦‚ <code>&lt;T&gt;</code>ï¼‰ï¼Œ<code>T</code> è¢«æ›¿æ¢ä¸º **<code>Object</code>**ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¼–è¯‘å‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Box</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> T value;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T value)</span> &#123; <span class="built_in">this</span>.value = value; &#125;</span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–è¯‘åï¼ˆæ“¦é™¤åï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Box</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Object value;         <span class="comment">// T â†’ Object</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(Object value)</span> &#123; <span class="built_in">this</span>.value = value; &#125;</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">()</span> &#123; <span class="keyword">return</span> value; &#125; <span class="comment">// è¿”å› Object</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>åœ¨è°ƒç”¨å¤„æ’å…¥å¼ºåˆ¶ç±»å‹è½¬æ¢</strong><br>ç¼–è¯‘å™¨åœ¨<strong>ä½¿ç”¨æ³›å‹çš„åœ°æ–¹</strong>è‡ªåŠ¨æ·»åŠ ç±»å‹è½¬æ¢ä»£ç ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¼–è¯‘å‰</span></span><br><span class="line">Box&lt;String&gt; box = <span class="keyword">new</span> <span class="title class_">Box</span>&lt;&gt;();</span><br><span class="line">box.set(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> box.get(); <span class="comment">// æ— éœ€æ˜¾å¼è½¬æ¢</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–è¯‘åï¼ˆæ“¦é™¤åï¼‰</span></span><br><span class="line"><span class="type">Box</span> <span class="variable">box</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Box</span>();</span><br><span class="line">box.set(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> (String) box.get(); <span class="comment">// ç¼–è¯‘å™¨æ’å…¥ (String) å¼ºåˆ¶è½¬æ¢</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ä¿è¯ç±»å‹å®‰å…¨çš„æ¡¥æ¥æ–¹æ³•ï¼ˆBridge Methodsï¼‰</strong><br>å½“æ³›å‹ç±»ç»§æ‰¿æˆ–å®ç°æ¥å£æ—¶ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆ<strong>åˆæˆæ–¹æ³•</strong>ç¡®ä¿å¤šæ€æ€§ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¼–è¯‘å‰</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Comparable</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(T other)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">String</span> <span class="keyword">implements</span> <span class="title class_">Comparable</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(String other)</span> &#123; ... &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–è¯‘åï¼ˆæ“¦é™¤åï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">String</span> <span class="keyword">implements</span> <span class="title class_">Comparable</span> &#123;</span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„æ¡¥æ¥æ–¹æ³•ï¼ˆä¿æŒå¤šæ€ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Object other)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> compareTo((String) other); <span class="comment">// è°ƒç”¨å®é™…æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®é™…ç¼–å†™çš„æ³›å‹æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(String other)</span> &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>äºŒã€æ³›å‹æ“¦é™¤å¯¼è‡´çš„å…³é”®é™åˆ¶</strong></p>
<ol>
<li><p><strong>æ— æ³•ä½¿ç”¨åŸºæœ¬ç±»å‹ä½œä¸ºç±»å‹å‚æ•°</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼ä¸èƒ½ä½¿ç”¨ int</span></span><br><span class="line">List&lt;<span class="type">int</span>&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(); </span><br><span class="line"><span class="comment">// å¿…é¡»ä½¿ç”¨åŒ…è£…ç±»</span></span><br><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(); </span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æ— æ³•è·å–æ³›å‹å…·ä½“ç±»å‹çš„ <code>Class</code> å¯¹è±¡</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼List&lt;String&gt;.class ä¸å­˜åœ¨</span></span><br><span class="line">Class&lt;?&gt; clazz = list.getClass(); </span><br><span class="line"><span class="comment">// è¾“å‡ºï¼šjava.util.ArrayListï¼ˆæ— æ³•å¾—çŸ¥æ˜¯ List&lt;String&gt;ï¼‰</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æ— æ³•ä½¿ç”¨ <code>instanceof</code> æ£€æŸ¥æ³›å‹ç±»å‹</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (list <span class="keyword">instanceof</span> List&lt;String&gt;) &#123; ... &#125; <span class="comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼</span></span><br><span class="line"><span class="keyword">if</span> (list <span class="keyword">instanceof</span> List&lt;?&gt;) &#123; ... &#125;      <span class="comment">// âœ… å…è®¸ï¼ˆä½†æ— å…·ä½“ç±»å‹ä¿¡æ¯ï¼‰</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æ— æ³•åˆ›å»ºæ³›å‹æ•°ç»„</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼</span></span><br><span class="line">T[] array = <span class="keyword">new</span> <span class="title class_">T</span>[<span class="number">10</span>]; </span><br><span class="line"><span class="comment">// æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨åå°„æˆ– ArrayList</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æ–¹æ³•ç­¾åå†²çªï¼ˆé‡è½½å¤±æ•ˆï¼‰</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼æ“¦é™¤åéƒ½æ˜¯ void print(List list)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">print</span><span class="params">(List&lt;String&gt; list)</span> &#123; ... &#125;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">print</span><span class="params">(List&lt;Integer&gt; list)</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>ä¸‰ã€ä¸ºä»€ä¹ˆ Java é€‰æ‹©æ³›å‹æ“¦é™¤ï¼Ÿ</strong></p>
<ol>
<li><strong>å‘åå…¼å®¹æ€§ï¼ˆBackward Compatibilityï¼‰</strong><ul>
<li>ç¡®ä¿ JDK 5+ çš„æ³›å‹ä»£ç èƒ½è¿è¡Œåœ¨æ—§ JVMï¼ˆ1.4 æˆ–æ›´æ—©ï¼‰ä¸Šã€‚</li>
<li>éæ³›å‹é›†åˆï¼ˆå¦‚ <code>ArrayList</code>ï¼‰å’Œæ³›å‹é›†åˆï¼ˆ<code>ArrayList&lt;String&gt;</code>ï¼‰åœ¨ JVM å±‚é¢éƒ½æ˜¯åŒä¸€ä¸ªç±»ã€‚</li>
</ul>
</li>
<li><strong>è¿è¡Œæ—¶æ•ˆç‡ï¼ˆRuntime Efficiencyï¼‰</strong><ul>
<li>ä¸éœ€è¦ä¸ºæ¯ç§æ³›å‹ç»„åˆç”Ÿæˆæ–°çš„ç±»ï¼ˆå¦‚ C# çš„æ³›å‹å®ç°ï¼‰ï¼ŒèŠ‚çœå†…å­˜ã€‚</li>
<li>JVM æ— éœ€ä¿®æ”¹å³å¯æ”¯æŒæ³›å‹ï¼ˆä»…ç¼–è¯‘å™¨å±‚å¤„ç†ï¼‰ã€‚</li>
</ul>
</li>
</ol>
<p><strong>å››ã€å¦‚ä½•ç»•è¿‡æ“¦é™¤çš„é™åˆ¶ï¼Ÿ</strong></p>
<ol>
<li><p><strong>ç±»å‹ä»¤ç‰Œï¼ˆType Tokenï¼‰</strong><br>é€šè¿‡ä¼ é€’ <code>Class&lt;T&gt;</code> å¯¹è±¡ä¿ç•™ç±»å‹ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Box</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Class&lt;T&gt; type;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Box</span><span class="params">(Class&lt;T&gt; type)</span> &#123; <span class="built_in">this</span>.type = type; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isInstance</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> type.isInstance(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>åå°„ APIï¼ˆReflectionï¼‰</strong><br>è¿è¡Œæ—¶è·å–æ³›å‹å‚æ•°ï¼ˆéœ€æ¥å£&#x2F;çˆ¶ç±»ä¿ç•™ä¿¡æ¯ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Type</span> <span class="variable">type</span> <span class="operator">=</span> myList.getClass().getGenericSuperclass();</span><br><span class="line"><span class="keyword">if</span> (type <span class="keyword">instanceof</span> ParameterizedType) &#123;</span><br><span class="line">    <span class="type">Type</span> <span class="variable">actualType</span> <span class="operator">=</span> ((ParameterizedType)type).getActualTypeArguments()[<span class="number">0</span>];</span><br><span class="line">    System.out.println(actualType); <span class="comment">// è¾“å‡ºå¦‚ String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>äº”ã€ä¸å…¶ä»–è¯­è¨€æ³›å‹å®ç°çš„å¯¹æ¯”</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>è¯­è¨€</strong></th>
<th align="left"><strong>æ³›å‹å®ç°</strong></th>
<th align="left"><strong>è¿è¡Œæ—¶ç±»å‹ä¿ç•™</strong></th>
<th align="left"><strong>ç‰¹ç‚¹</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Java</td>
<td align="left">ç±»å‹æ“¦é™¤</td>
<td align="left">âŒ</td>
<td align="left">å…¼å®¹æ—§ç‰ˆï¼Œæ•ˆç‡é«˜</td>
</tr>
<tr>
<td align="left">C#</td>
<td align="left">å…·ç°åŒ–ï¼ˆReifiedï¼‰</td>
<td align="left">âœ…</td>
<td align="left">è¿è¡Œæ—¶ä¿ç•™ç±»å‹ï¼Œæ”¯æŒæ³›å‹æ•°ç»„</td>
</tr>
<tr>
<td align="left">Kotlin</td>
<td align="left">æ“¦é™¤ï¼ˆJVMä¸Šï¼‰</td>
<td align="left">âŒ</td>
<td align="left">é€šè¿‡ <code>inline</code> + <code>reified</code> ç»•è¿‡é™åˆ¶</td>
</tr>
<tr>
<td align="left">TypeScript</td>
<td align="left">ç¼–è¯‘æ—¶æ“¦é™¤</td>
<td align="left">âŒ</td>
<td align="left">ä»…é™æ€ç±»å‹æ£€æŸ¥</td>
</tr>
</tbody></table>
<p><strong>æ€»ç»“</strong></p>
<ul>
<li><strong>æ³›å‹æ“¦é™¤çš„æœ¬è´¨</strong>ï¼šç¼–è¯‘å™¨ç§»é™¤æ³›å‹ç±»å‹ä¿¡æ¯ï¼Œæ›¿æ¢ä¸ºåŸå§‹ç±»å‹ï¼ˆ<code>Object</code> æˆ–è¾¹ç•Œç±»å‹ï¼‰ï¼Œå¹¶åœ¨ä½¿ç”¨ç‚¹æ’å…¥å¼ºåˆ¶è½¬æ¢ã€‚</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šæ— ç¼å…¼å®¹æ—§ä»£ç ï¼Œè¿è¡Œæ—¶æ•ˆç‡é«˜ã€‚</li>
<li><strong>ä»£ä»·</strong>ï¼šè¿è¡Œæ—¶æ— æ³•è·å–æ³›å‹ç±»å‹ä¿¡æ¯ï¼Œå¯¼è‡´éƒ¨åˆ†æ“ä½œå—é™ï¼ˆå¦‚ <code>instanceof</code>ã€æ³›å‹æ•°ç»„ï¼‰ã€‚</li>
<li><strong>åº”å¯¹</strong>ï¼šé€šè¿‡ç±»å‹ä»¤ç‰Œã€åå°„æˆ–è®¾è®¡æ¨¡å¼ï¼ˆå¦‚å·¥å‚ï¼‰ç»•è¿‡é™åˆ¶ã€‚</li>
</ul>
<p>æ³›å‹æ“¦é™¤æ˜¯ Java åœ¨å…¼å®¹æ€§ä¸ç±»å‹å®‰å…¨ä¹‹é—´çš„æŠ˜è¡·æ–¹æ¡ˆï¼Œç†è§£å…¶åŸç†èƒ½å¸®åŠ©ä½ å†™å‡ºæ›´å¥å£®çš„æ³›å‹ä»£ç ï¼</p>
<h4 id="æ³›å‹çš„ä¸Šä¸‹é™åŠåº”ç”¨åœºæ™¯"><a href="#æ³›å‹çš„ä¸Šä¸‹é™åŠåº”ç”¨åœºæ™¯" class="headerlink" title="æ³›å‹çš„ä¸Šä¸‹é™åŠåº”ç”¨åœºæ™¯"></a>æ³›å‹çš„ä¸Šä¸‹é™åŠåº”ç”¨åœºæ™¯</h4><p>æ³›å‹çš„<strong>ä¸Šé™ï¼ˆUpper Boundï¼‰</strong> å’Œ<strong>ä¸‹é™ï¼ˆLower Boundï¼‰</strong> æ˜¯ç”¨äº<strong>çº¦æŸç±»å‹å‚æ•°èŒƒå›´</strong>çš„å…³é”®æœºåˆ¶ï¼Œä¸»è¦è§£å†³æ³›å‹ä»£ç éœ€è¦<strong>é™åˆ¶å¯æ¥å—çš„ç±»å‹</strong>æˆ–<strong>æ”¯æŒæ›´çµæ´»çš„å­ç±»å‹å…³ç³»</strong>çš„é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£é‡Šï¼š</p>
<p><strong>ä¸€ã€æ³›å‹çš„ä¸Šé™ï¼ˆUpper Boundï¼‰</strong></p>
<p>å®šä¹‰ï¼šé™åˆ¶ç±»å‹å‚æ•°å¿…é¡»æ˜¯<strong>æŸä¸ªç±»&#x2F;æ¥å£æœ¬èº«æˆ–å…¶å­ç±»</strong>ã€‚<br>è¯­æ³•ï¼š<code>&lt;T extends ç±»/æ¥å£&gt;</code> æˆ– <code>&lt;? extends ç±»/æ¥å£&gt;</code>ï¼ˆé€šé…ç¬¦å½¢å¼ï¼‰ã€‚</p>
<p><strong>æ ¸å¿ƒä½œç”¨</strong></p>
<ol>
<li><p><strong>ç¡®ä¿ç±»å‹å…·å¤‡æŸäº›èƒ½åŠ›</strong><br>è¦æ±‚ç±»å‹ <code>T</code> å¿…é¡»å®ç°ç‰¹å®šæ¥å£ï¼ˆå¦‚ <code>Comparable</code>ï¼‰æˆ–ç»§æ‰¿ç‰¹å®šç±»ï¼Œä»è€Œåœ¨æ³›å‹ä»£ç ä¸­å®‰å…¨è°ƒç”¨å…¶æ–¹æ³•ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼šè¦æ±‚ç±»å‹å¿…é¡»å¯æ¯”è¾ƒ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// T å¿…é¡»æ˜¯å®ç°äº† Comparable æ¥å£çš„ç±»å‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T <span class="keyword">extends</span> <span class="title class_">Comparable</span>&lt;T&gt;&gt; T <span class="title function_">max</span><span class="params">(T a, T b)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a.compareTo(b) &gt; <span class="number">0</span> ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¯å®‰å…¨è°ƒç”¨ a.compareTo(b)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å®‰å…¨è®¿é—®æ•°æ®ï¼ˆåªè¯»ä¸å†™ï¼‰</strong><br>åœ¨é€šé…ç¬¦ <code>? extends T</code> ä¸­ï¼Œè¡¨ç¤ºâ€œæŸä¸ª <code>T</code> çš„å­ç±»å‹â€ï¼Œæ­¤æ—¶å®¹å™¨<strong>åªèƒ½è¯»å–æ•°æ®</strong>ï¼ˆè¿”å› <code>T</code> ç±»å‹ï¼‰ï¼Œ<strong>ä¸èƒ½å†™å…¥æ•°æ®</strong>ï¼ˆé™¤ <code>null</code> å¤–ï¼‰ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼šå®‰å…¨è¯»å–æ•°å­—é›†åˆ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">printNumbers</span><span class="params">(List&lt;? extends Number&gt; list)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (Number n : list) &#123;</span><br><span class="line">        System.out.println(n);  <span class="comment">// âœ… å¯è¯»</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// list.add(10); âŒ ç¼–è¯‘é”™è¯¯ï¼æ— æ³•å†™å…¥ï¼ˆé™¤ null å¤–ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>å…¸å‹åœºæ™¯</strong></p>
<ul>
<li>å®šä¹‰æ³›å‹ç±»&#x2F;æ–¹æ³•æ—¶ï¼Œçº¦æŸç±»å‹å‚æ•°çš„èƒ½åŠ›ï¼ˆå¦‚ <code>T extends Runnable</code>ï¼‰ã€‚</li>
<li>ä½œä¸ºæ–¹æ³•å‚æ•°æ—¶ï¼Œå®‰å…¨æ¥æ”¶<strong>æŸç§å­ç±»å‹çš„é›†åˆ</strong>ï¼ˆç”Ÿäº§è€…åœºæ™¯ï¼‰ã€‚</li>
</ul>
<p><strong>äºŒã€æ³›å‹çš„ä¸‹é™ï¼ˆLower Boundï¼‰</strong></p>
<p>å®šä¹‰ï¼šé™åˆ¶ç±»å‹å‚æ•°å¿…é¡»æ˜¯<strong>æŸä¸ªç±»&#x2F;æ¥å£æœ¬èº«æˆ–å…¶çˆ¶ç±»</strong>ã€‚<br>è¯­æ³•ï¼š<code>&lt;? super ç±»/æ¥å£&gt;</code>ï¼ˆä»…é€šé…ç¬¦å½¢å¼ï¼‰ã€‚</p>
<p><strong>æ ¸å¿ƒä½œç”¨</strong></p>
<ol>
<li><p><strong>æ”¯æŒå®‰å…¨å†™å…¥æ•°æ®</strong><br>è¡¨ç¤ºâ€œæŸä¸ª <code>T</code> çš„çˆ¶ç±»å‹â€ï¼Œæ­¤æ—¶å®¹å™¨<strong>å¯ä»¥å†™å…¥ <code>T</code> åŠå…¶å­ç±»å‹å¯¹è±¡</strong>ï¼Œä½†è¯»å–æ—¶åªèƒ½è§†ä¸º <code>Object</code>ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼šå‘é›†åˆæ·»åŠ å…ƒç´ </p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">void addNumbers(List&lt;? super Integer&gt; list) &#123;</span><br><span class="line">    list.add(10);     // âœ… å¯å†™å…¥ Integer</span><br><span class="line">    list.add(1000L);  // âŒ é”™è¯¯ï¼Long ä¸æ˜¯ Integer çš„å­ç±»</span><br><span class="line">    // Object obj = list.get(0);  // è¯»å–æ—¶åªèƒ½è§†ä¸º Object</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å®ç°çµæ´»çš„å­ç±»å‹å…¼å®¹</strong><br>å…è®¸æ–¹æ³•æ¥æ”¶æ¯”é¢„æœŸæ›´å®½æ³›çš„å®¹å™¨ï¼ˆå¦‚éœ€è¦ <code>List&lt;Number&gt;</code> æ—¶ï¼Œä¹Ÿå¯ä¼ å…¥ <code>List&lt;Object&gt;</code>ï¼‰ã€‚</p>
</li>
</ol>
<p><strong>å…¸å‹åœºæ™¯</strong></p>
<ul>
<li><p>å‘æ³›å‹å®¹å™¨<strong>å†™å…¥æ•°æ®</strong>ï¼ˆæ¶ˆè´¹è€…åœºæ™¯ï¼‰ã€‚</p>
</li>
<li><p>é…åˆ <code>Comparator</code> ç­‰æ¥å£å®ç°ç±»å‹çµæ´»çš„APIï¼š</p>
<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// å¯æ¥æ”¶ Person æˆ–å…¶çˆ¶ç±»çš„ Comparator</span><br><span class="line">void sort(List&lt;Person&gt; list, Comparator&lt;? super Person&gt; comparator) &#123;</span><br><span class="line">    Collections.sort(list, comparator);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>ä¸‰ã€å…³é”®å¯¹æ¯”ï¼š<code>extends</code> vs <code>super</code></strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>ç‰¹æ€§</strong></th>
<th align="left"><strong>ä¸Šé™ (<code>? extends T</code>)</strong></th>
<th align="left"><strong>ä¸‹é™ (<code>? super T</code>)</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>ç±»å‹èŒƒå›´</strong></td>
<td align="left"><code>T</code> æˆ–å…¶<strong>å­ç±»å‹</strong></td>
<td align="left"><code>T</code> æˆ–å…¶<strong>çˆ¶ç±»å‹</strong></td>
</tr>
<tr>
<td align="left"><strong>æ•°æ®è¯»å–</strong></td>
<td align="left">âœ… è¿”å› <code>T</code> ç±»å‹</td>
<td align="left">âŒ åªèƒ½è§†ä¸º <code>Object</code></td>
</tr>
<tr>
<td align="left"><strong>æ•°æ®å†™å…¥</strong></td>
<td align="left">âŒ ç¦æ­¢ï¼ˆé™¤ <code>null</code>ï¼‰</td>
<td align="left">âœ… å¯å†™å…¥ <code>T</code> <strong>åŠå…¶å­ç±»</strong></td>
</tr>
<tr>
<td align="left"><strong>è®¾è®¡æ„å›¾</strong></td>
<td align="left"><strong>ç”Ÿäº§è€…</strong>ï¼ˆProducerï¼‰åªæä¾›æ•°æ®</td>
<td align="left"><strong>æ¶ˆè´¹è€…</strong>ï¼ˆConsumerï¼‰åªæ¶ˆè´¹æ•°æ®</td>
</tr>
<tr>
<td align="left"><strong>ç»å…¸å£è¯€</strong></td>
<td align="left"><strong>PECS</strong> (Producer-Extends, Consumer-Super)</td>
<td align="left"></td>
</tr>
</tbody></table>
<p><strong>å››ã€å®é™…åº”ç”¨ï¼šPECS åŸåˆ™</strong></p>
<p>åœ¨æ³›å‹ç¼–ç¨‹ä¸­ï¼Œéµå¾ª <strong>PECSï¼ˆProducer-Extends, Consumer-Superï¼‰</strong> åŸåˆ™ï¼š</p>
<ul>
<li><strong>ç”Ÿäº§è€…ï¼ˆProducerï¼‰</strong>ï¼šäº§ç”Ÿ <code>T</code> çš„å¯¹è±¡ â†’ ç”¨ <code>&lt;? extends T&gt;</code></li>
<li><strong>æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰</strong>ï¼šæ¶ˆè´¹ <code>T</code> çš„å¯¹è±¡ â†’ ç”¨ <code>&lt;? super T&gt;</code></li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼šJava é›†åˆå·¥å…·ç±» <code>Collections.copy()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">copy</span><span class="params">(</span></span><br><span class="line"><span class="params">    List&lt;? <span class="built_in">super</span> T&gt; dest,    // æ¶ˆè´¹è€…ï¼šå†™å…¥ç›®æ ‡é›†åˆ</span></span><br><span class="line"><span class="params">    List&lt;? extends T&gt; src    // ç”Ÿäº§è€…ï¼šè¯»å–æºé›†åˆ</span></span><br><span class="line"><span class="params">)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; src.size(); i++) &#123;</span><br><span class="line">        dest.set(i, src.get(i));  <span class="comment">// âœ… å®‰å…¨è¯»å†™</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>äº”ã€ä½¿ç”¨åœºæ™¯æ€»ç»“</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>åœºæ™¯</strong></th>
<th align="left"><strong>æ¨èè¯­æ³•</strong></th>
<th align="left"><strong>ç¤ºä¾‹</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">éœ€è¦è°ƒç”¨ç±»å‹ç‰¹å®šæ–¹æ³•</td>
<td align="left"><code>&lt;T extends Interface&gt;</code></td>
<td align="left"><code>T</code> å¿…é¡»å®ç°æŸä¸ªæ¥å£</td>
</tr>
<tr>
<td align="left">å®‰å…¨è¯»å–æ³›å‹é›†åˆå†…å®¹</td>
<td align="left"><code>&lt;? extends T&gt;</code></td>
<td align="left">éå† <code>List&lt;? extends Number&gt;</code></td>
</tr>
<tr>
<td align="left">å®‰å…¨å†™å…¥æ³›å‹é›†åˆ</td>
<td align="left"><code>&lt;? super T&gt;</code></td>
<td align="left">å‘ <code>List&lt;? super Integer&gt;</code> æ·»åŠ å€¼</td>
</tr>
<tr>
<td align="left">åŒæ—¶æ”¯æŒè¯»å†™</td>
<td align="left">ä½¿ç”¨ç¡®å®šçš„ç±»å‹å‚æ•° <code>T</code></td>
<td align="left"><code>List&lt;T&gt;</code></td>
</tr>
</tbody></table>
<h3 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h3><h4 id="ä»€ä¹ˆæ˜¯åå°„"><a href="#ä»€ä¹ˆæ˜¯åå°„" class="headerlink" title="ä»€ä¹ˆæ˜¯åå°„"></a>ä»€ä¹ˆæ˜¯åå°„</h4><p>åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ï¼›è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸º Java çš„åå°„æœºåˆ¶ã€‚</p>
<h4 id="åå°„çš„ä¼˜ç¼ºç‚¹"><a href="#åå°„çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="åå°„çš„ä¼˜ç¼ºç‚¹"></a>åå°„çš„ä¼˜ç¼ºç‚¹</h4><ul>
<li><strong>ä¼˜ç‚¹ï¼š</strong><ul>
<li><strong>åŠ¨æ€æ€§ï¼š</strong> è¿è¡Œæ—¶æ‰ç¡®å®šç±»å‹ã€ç»‘å®šå¯¹è±¡ï¼Œæå¤§æé«˜äº†ç¨‹åºçš„çµæ´»æ€§å’Œæ‰©å±•æ€§ã€‚æ˜¯æ¡†æ¶è®¾è®¡çš„åŸºçŸ³ï¼ˆå¦‚ Spring çš„ IOCï¼‰ã€‚</li>
<li><strong>çµæ´»æ€§ï¼š</strong> å¯ä»¥è®¿é—®å’Œæ“ä½œç§æœ‰æˆå‘˜ï¼ˆé€šè¿‡ <code>setAccessible(true)</code>ï¼‰ï¼Œçªç ´å°è£…é™åˆ¶ï¼ˆéœ€è°¨æ…ï¼‰ã€‚</li>
<li><strong>é€šç”¨æ€§ï¼š</strong> å¯ä»¥ç¼–å†™éå¸¸é€šç”¨çš„ä»£ç ï¼ˆå¦‚é€šç”¨åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–å·¥å…·ã€å¯¹è±¡æ¯”è¾ƒå·¥å…·ã€åŠ¨æ€ä»£ç†ç­‰ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>ç¼ºç‚¹ï¼š</strong><ul>
<li><strong>æ€§èƒ½å¼€é”€ï¼š</strong> åå°„æ“ä½œæ¯”ç›´æ¥è°ƒç”¨æ…¢å¾ˆå¤šã€‚å› ä¸ºæ¶‰åŠåŠ¨æ€ç±»å‹è§£æã€æ–¹æ³•æŸ¥æ‰¾ã€å®‰å…¨æ£€æŸ¥ç­‰ã€‚JVM éš¾ä»¥å¯¹å…¶ä¼˜åŒ–ã€‚</li>
<li><strong>å®‰å…¨éšæ‚£ï¼š</strong> å¯ä»¥ç ´åå°è£…æ€§ï¼ˆè®¿é—® private æˆå‘˜ï¼‰ï¼Œå¯èƒ½å¼•å‘å®‰å…¨é—®é¢˜ã€‚éœ€è¦é¢å¤–çš„å®‰å…¨ç®¡ç†ç­–ç•¥ã€‚</li>
<li><strong>ä»£ç å¤æ‚æ€§ï¼š</strong> åå°„ä»£ç é€šå¸¸æ¯”ç›´æ¥ä»£ç æ›´å¤æ‚ã€å¯è¯»æ€§æ›´å·®ã€æ›´éš¾ç»´æŠ¤ã€‚</li>
<li><strong>å†…éƒ¨æš´éœ²ï¼š</strong> å¯èƒ½æš´éœ²ç±»çš„å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œç ´åæŠ½è±¡ã€‚</li>
</ul>
</li>
</ul>
<h4 id="å¦‚ä½•è·å–ä¸€ä¸ªç±»çš„-Class-å¯¹è±¡"><a href="#å¦‚ä½•è·å–ä¸€ä¸ªç±»çš„-Class-å¯¹è±¡" class="headerlink" title="å¦‚ä½•è·å–ä¸€ä¸ªç±»çš„ Class å¯¹è±¡"></a>å¦‚ä½•è·å–ä¸€ä¸ªç±»çš„ <code>Class</code> å¯¹è±¡</h4><ol>
<li><code>Class clazz = Object.getClass();</code> (é€šè¿‡å¯¹è±¡å®ä¾‹è·å–)</li>
<li><code>Class clazz = ClassName.class;</code> (é€šè¿‡ç±»å­—é¢å¸¸é‡ <code>.class</code> è·å–)</li>
<li><code>Class clazz = Class.forName(&quot;fully.qualified.ClassName&quot;);</code> (é€šè¿‡å®Œæ•´ç±»åå­—ç¬¦ä¸²è·å–ï¼Œå¸¸ç”¨ï¼Œå¯èƒ½æŠ›å‡º <code>ClassNotFoundException</code>)</li>
<li>(å¯¹äºåŸºæœ¬ç±»å‹å’Œæ•°ç»„) <code>Class clazz = int.class;</code> &#x2F; <code>Class clazz = String[].class;</code></li>
</ol>
<h4 id="å¦‚ä½•é€šè¿‡åå°„åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹"><a href="#å¦‚ä½•é€šè¿‡åå°„åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹" class="headerlink" title="å¦‚ä½•é€šè¿‡åå°„åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹"></a>å¦‚ä½•é€šè¿‡åå°„åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹</h4><ol>
<li><p><strong>ä½¿ç”¨ <code>Class.newInstance()</code>ï¼ˆå·²è¿‡æ—¶ï¼‰ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.example.MyClass&quot;</span>);</span><br><span class="line"><span class="type">MyClass</span> <span class="variable">obj</span> <span class="operator">=</span> (MyClass) clazz.newInstance(); <span class="comment">// è°ƒç”¨æ— å‚æ„é€ å™¨</span></span><br></pre></td></tr></table></figure>

<p>åªèƒ½è°ƒç”¨æ— å‚æ„é€ å™¨ï¼›åœ¨ Java 9 å¼€å§‹è¢«æ ‡è®°ä¸º <code>@Deprecated(since=&quot;9&quot;)</code>ï¼Œæ¨èä½¿ç”¨ <code>Constructor.newInstance()</code>ã€‚</p>
</li>
<li><p><strong>ä½¿ç”¨ <code>Constructor.newInstance()</code> (æ¨è)ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.example.MyClass&quot;</span>);</span><br><span class="line"><span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> clazz.getConstructor(String.class, <span class="type">int</span>.class); <span class="comment">// è·å–ç‰¹å®šå‚æ•°ç±»å‹çš„æ„é€ å™¨</span></span><br><span class="line"><span class="type">MyClass</span> <span class="variable">obj</span> <span class="operator">=</span> (MyClass) constructor.newInstance(<span class="string">&quot;arg1&quot;</span>, <span class="number">42</span>); <span class="comment">// ä¼ å…¥å‚æ•°åˆ›å»ºå®ä¾‹</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="åå°„æœ‰å“ªäº›å®é™…åº”ç”¨åœºæ™¯"><a href="#åå°„æœ‰å“ªäº›å®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="åå°„æœ‰å“ªäº›å®é™…åº”ç”¨åœºæ™¯"></a>åå°„æœ‰å“ªäº›å®é™…åº”ç”¨åœºæ™¯</h4><ul>
<li><strong>æ¡†æ¶å¼€å‘ï¼š</strong> æ˜¯å‡ ä¹æ‰€æœ‰ Java æ¡†æ¶çš„æ ¸å¿ƒï¼ˆå¦‚ Spring, Hibernate, MyBatis, JUnitï¼‰ã€‚<ul>
<li><strong>Spring IOCï¼š</strong> é€šè¿‡åå°„è¯»å–é…ç½®ï¼ˆXML æˆ–æ³¨è§£ï¼‰ï¼ŒåŠ¨æ€åˆ›å»º Bean å®ä¾‹ï¼Œæ³¨å…¥ä¾èµ–ã€‚</li>
<li><strong>Spring AOPï¼š</strong> åŠ¨æ€ä»£ç†ï¼ˆJDK Proxy æˆ– CGLIBï¼‰åº•å±‚ä¾èµ–åå°„è°ƒç”¨ç›®æ ‡æ–¹æ³•ã€‚</li>
<li><strong>Hibernate&#x2F;MyBatisï¼š</strong> å°†æ•°æ®åº“ç»“æœé›†æ˜ å°„åˆ° Java å¯¹è±¡æ—¶ï¼Œé€šè¿‡åå°„è®¾ç½®å¯¹è±¡çš„å±æ€§å€¼ã€‚</li>
</ul>
</li>
<li><strong>æ³¨è§£å¤„ç†ï¼š</strong> åœ¨è¿è¡Œæ—¶é€šè¿‡åå°„è¯»å–ç±»ã€æ–¹æ³•ã€å­—æ®µä¸Šçš„æ³¨è§£ä¿¡æ¯ï¼Œå¹¶æ ¹æ®æ³¨è§£æ‰§è¡Œç‰¹å®šé€»è¾‘ï¼ˆå¦‚ JUnit æŸ¥æ‰¾ <code>@Test</code> æ–¹æ³•ï¼‰ã€‚</li>
<li><strong>åŠ¨æ€ä»£ç†ï¼š</strong> JDK åŠ¨æ€ä»£ç† (<code>java.lang.reflect.Proxy</code>) çš„æ ¸å¿ƒå°±æ˜¯åˆ©ç”¨åå°„è°ƒç”¨è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•ã€‚</li>
<li><strong>é€šç”¨å·¥å…·åº“ï¼š</strong> å¦‚ Apache Commons BeanUtils, Jackson&#x2F;Gson (JSON åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–)ï¼Œé€šè¿‡åå°„æ“ä½œå¯¹è±¡çš„å±æ€§ã€‚</li>
<li><strong>IDE å’Œå¼€å‘å·¥å…·ï¼š</strong> ä»£ç æç¤ºã€è°ƒè¯•å™¨ã€åç¼–è¯‘å·¥å…·ç­‰åˆ©ç”¨åå°„è·å–ç±»çš„ç»“æ„ä¿¡æ¯ã€‚</li>
</ul>
<h4 id="Class-forName-å’Œ-ClassLoader-loadClass-æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#Class-forName-å’Œ-ClassLoader-loadClass-æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="Class.forName() å’Œ ClassLoader.loadClass() æœ‰ä»€ä¹ˆåŒºåˆ«"></a><strong><code>Class.forName()</code> å’Œ <code>ClassLoader.loadClass()</code> æœ‰ä»€ä¹ˆåŒºåˆ«</strong></h4><ul>
<li>**<code>Class.forName(String name)</code>**ï¼š<ul>
<li>é»˜è®¤ä¼šè§¦å‘ç±»çš„<strong>åŠ è½½ã€é“¾æ¥ï¼ˆéªŒè¯ã€å‡†å¤‡ï¼‰ã€åˆå§‹åŒ–</strong>ï¼ˆæ‰§è¡Œ <code>&lt;clinit&gt;</code> é™æ€åˆå§‹åŒ–å—ï¼‰ã€‚</li>
<li>æœ‰ä¸€ä¸ªé‡è½½æ–¹æ³• <code>Class.forName(String name, boolean initialize, ClassLoader loader)</code> å¯ä»¥æ§åˆ¶æ˜¯å¦åˆå§‹åŒ– (<code>initialize</code>) å’ŒæŒ‡å®šç±»åŠ è½½å™¨ (<code>loader</code>)ã€‚</li>
</ul>
</li>
<li>**<code>ClassLoader.loadClass(String name)</code>**ï¼š<ul>
<li>åªè§¦å‘ç±»çš„<strong>åŠ è½½</strong>å’Œ<strong>é“¾æ¥ï¼ˆéªŒè¯ã€å‡†å¤‡ï¼‰</strong> é˜¶æ®µï¼Œ<strong>ä¸ä¼šæ‰§è¡Œåˆå§‹åŒ–</strong> (<code>&lt;clinit&gt;</code>)ã€‚åªæœ‰é¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨æ—¶ï¼ˆå¦‚åˆ›å»ºå®ä¾‹ã€è®¿é—®é™æ€å­—æ®µ&#x2F;æ–¹æ³•ï¼‰æ‰ä¼šåˆå§‹åŒ–ã€‚</li>
</ul>
</li>
<li><strong>è€ƒå¯Ÿç‚¹ï¼š</strong> ç†è§£ç±»åŠ è½½è¿‡ç¨‹çš„é˜¶æ®µï¼ˆåŠ è½½ -&gt; é“¾æ¥ï¼ˆéªŒè¯ã€å‡†å¤‡ã€è§£æï¼‰ -&gt; åˆå§‹åŒ–ï¼‰ï¼Œä»¥åŠè¿™ä¸¤ä¸ªå…³é”®æ–¹æ³•åœ¨è§¦å‘ç±»åŠ è½½è¡Œä¸ºä¸Šçš„å·®å¼‚ã€‚çŸ¥é“ <code>forName</code> é»˜è®¤ä¼šåˆå§‹åŒ–ç±»ï¼Œè€Œ <code>loadClass</code> ä¸ä¼šã€‚</li>
</ul>
<h4 id="å¦‚ä½•é˜²æ­¢åå°„ç ´åå•ä¾‹æ¨¡å¼"><a href="#å¦‚ä½•é˜²æ­¢åå°„ç ´åå•ä¾‹æ¨¡å¼" class="headerlink" title="å¦‚ä½•é˜²æ­¢åå°„ç ´åå•ä¾‹æ¨¡å¼"></a><strong>å¦‚ä½•é˜²æ­¢åå°„ç ´åå•ä¾‹æ¨¡å¼</strong></h4><ul>
<li><p><strong>é—®é¢˜ï¼š</strong> æ ‡å‡†çš„é¥¿æ±‰å¼æˆ–æ‡’æ±‰å¼ï¼ˆéæšä¸¾ï¼‰å•ä¾‹ï¼Œå…¶ç§æœ‰æ„é€ å™¨å¯ä»¥é€šè¿‡åå°„çš„ <code>setAccessible(true)</code> è¢«è®¿é—®ï¼Œä»è€Œåˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚</p>
</li>
<li><p><strong>é˜²å¾¡æ–¹æ³•ï¼š</strong></p>
<ul>
<li><p><strong>åœ¨æ„é€ å™¨ä¸­æ£€æŸ¥ï¼š</strong> å¦‚æœå®ä¾‹å·²å­˜åœ¨ï¼Œåˆ™åœ¨ç§æœ‰æ„é€ å™¨ä¸­æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (INSTANCE != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Singleton instance already created&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ä½¿ç”¨æšä¸¾å®ç°å•ä¾‹ (æ¨è)ï¼š</strong> æšä¸¾çš„å•ä¾‹å®ç°æ˜¯ã€ŠEffective Javaã€‹ä½œè€… Josh Bloch å¼ºçƒˆæ¨èçš„æ–¹å¼ã€‚JVM ä»æ ¹æœ¬ä¸Šä¿è¯äº†æšä¸¾ç±»å‹çš„æ„é€ å™¨åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œä¸”åå°„ API è¢«è®¾è®¡ä¸º<strong>ä¸èƒ½é€šè¿‡åå°„åˆ›å»ºæšä¸¾å®ä¾‹</strong>ï¼ˆ<code>Constructor.newInstance()</code> æ–¹æ³•å†…éƒ¨ä¼šæ£€æŸ¥å¹¶é˜»æ­¢ï¼‰ã€‚è¿™æ˜¯æœ€å®‰å…¨ã€ç®€æ´çš„æ–¹å¼ã€‚</p>
</li>
</ul>
</li>
</ul>
<h3 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h3><h4 id="Javaä¸­éƒ½æœ‰å“ªäº›å…ƒæ³¨è§£"><a href="#Javaä¸­éƒ½æœ‰å“ªäº›å…ƒæ³¨è§£" class="headerlink" title="Javaä¸­éƒ½æœ‰å“ªäº›å…ƒæ³¨è§£"></a>Javaä¸­éƒ½æœ‰å“ªäº›å…ƒæ³¨è§£</h4><table>
<thead>
<tr>
<th align="left">å…ƒæ³¨è§£</th>
<th align="left">ä½œç”¨åŸŸ</th>
<th align="left">ä¸»è¦ç”¨é€”</th>
<th align="left">Java ç‰ˆæœ¬</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong><code>@Target</code></strong></td>
<td align="left">æ³¨è§£</td>
<td align="left">æŒ‡å®šæ³¨è§£å¯åº”ç”¨çš„ç¨‹åºå…ƒç´ ï¼ˆç±»ã€æ–¹æ³•ã€å­—æ®µç­‰ï¼‰</td>
<td align="left">5</td>
</tr>
<tr>
<td align="left"><strong><code>@Retention</code></strong></td>
<td align="left">æ³¨è§£</td>
<td align="left">æŒ‡å®šæ³¨è§£çš„ä¿ç•™ç­–ç•¥ï¼ˆæºç ã€ç±»æ–‡ä»¶ã€è¿è¡Œæ—¶ï¼‰</td>
<td align="left">5</td>
</tr>
<tr>
<td align="left"><strong><code>@Documented</code></strong></td>
<td align="left">æ³¨è§£</td>
<td align="left">æŒ‡ç¤ºæ³¨è§£åº”åŒ…å«åœ¨ Javadoc ä¸­</td>
<td align="left">5</td>
</tr>
<tr>
<td align="left"><strong><code>@Inherited</code></strong></td>
<td align="left">æ³¨è§£</td>
<td align="left">æŒ‡ç¤ºæ³¨è§£å…·æœ‰ç»§æ‰¿æ€§ï¼ˆä»…å¯¹ç±»æ³¨è§£æœ‰æ•ˆï¼‰</td>
<td align="left">5</td>
</tr>
<tr>
<td align="left"><strong><code>@Repeatable</code></strong></td>
<td align="left">æ³¨è§£</td>
<td align="left">å…è®¸åŒä¸€æ³¨è§£åœ¨å•ä¸ªå…ƒç´ ä¸Šé‡å¤ä½¿ç”¨ï¼ˆéœ€é…åˆå®¹å™¨æ³¨è§£ï¼‰</td>
<td align="left"><strong>8</strong></td>
</tr>
<tr>
<td align="left"><strong><code>@Native</code></strong></td>
<td align="left">å­—æ®µ</td>
<td align="left">æ ‡è®°å¯èƒ½è¢«æœ¬æœºä»£ç å¼•ç”¨çš„å¸¸é‡å­—æ®µï¼ˆä¸»è¦åœ¨ JDK å†…éƒ¨ä½¿ç”¨ï¼‰</td>
<td align="left"><strong>8</strong></td>
</tr>
</tbody></table>
<h3 id="SPI"><a href="#SPI" class="headerlink" title="SPI"></a>SPI</h3><p><strong>SPI</strong> æ˜¯ Java æä¾›çš„ä¸€ç§<strong>æœåŠ¡å‘ç°æœºåˆ¶</strong>ï¼Œé€šè¿‡<strong>æ¥å£ä¸å®ç°è§£è€¦</strong>å®ç°åŠ¨æ€æ‰©å±•ã€‚æ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>å®šä¹‰æœåŠ¡æ¥å£</strong>ï¼ˆå¦‚ <code>PaymentService</code>ï¼‰</li>
<li><strong>æä¾›å®ç°ç±»</strong>ï¼ˆå¦‚ <code>AlipayService</code>, <code>WechatPayService</code>ï¼‰</li>
<li><strong>æ³¨å†Œå®ç°</strong>ï¼šåœ¨ <code>META-INF/services/</code> ä¸‹åˆ›å»ºä»¥æ¥å£å…¨é™å®šåå‘½åçš„æ–‡ä»¶ï¼Œå†™å…¥å®ç°ç±»å…¨é™å®šå</li>
<li><strong>åŠ¨æ€åŠ è½½</strong>ï¼šé€šè¿‡ <code>ServiceLoader</code> åŠ è½½æ‰€æœ‰æ³¨å†Œçš„å®ç°</li>
</ol>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>å¼€é—­åŸåˆ™</strong>ï¼šæ–°å¢å®ç°æ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç </li>
<li><strong>è§£è€¦</strong>ï¼šæ¥å£ä¸å®ç°åˆ†ç¦»</li>
<li><strong>å¯æ’æ‹”</strong>ï¼šé€šè¿‡é…ç½®æ–‡ä»¶åŠ¨æ€æ›¿æ¢å®ç°</li>
</ul>
<p><strong>Java SPI å®Œæ•´ Demo</strong></p>
<ol>
<li>å®šä¹‰æœåŠ¡æ¥å£</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PaymentService.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å®ç°æœåŠ¡æ¥å£</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AlipayService.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlipayService</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[æ”¯ä»˜å®] æ”¯ä»˜: Â¥&quot;</span> + amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// WechatPayService.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatPayService</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[å¾®ä¿¡æ”¯ä»˜] æ”¯ä»˜: Â¥&quot;</span> + amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æ³¨å†ŒæœåŠ¡å®ç°</li>
</ol>
<p>åˆ›å»ºèµ„æºæ–‡ä»¶ï¼š<br><code>src/main/resources/META-INF/services/com.example.PaymentService</code><br>å†…å®¹ï¼š</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">com.example.AlipayService</span><br><span class="line">com.example.WechatPayService</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ä½¿ç”¨ SPI åŠ è½½æœåŠ¡</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPIDemo.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.ServiceLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SPIDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åŠ è½½æ‰€æœ‰ PaymentService å®ç°</span></span><br><span class="line">        ServiceLoader&lt;PaymentService&gt; services = </span><br><span class="line">            ServiceLoader.load(PaymentService.class);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;=== å‘ç° &quot;</span> + getServiceCount(services) + <span class="string">&quot; ä¸ªæ”¯ä»˜æœåŠ¡ ===&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è°ƒç”¨æ‰€æœ‰å®ç°</span></span><br><span class="line">        <span class="keyword">for</span> (PaymentService service : services) &#123;</span><br><span class="line">            service.pay(<span class="number">100.0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getServiceCount</span><span class="params">(ServiceLoader&lt;PaymentService&gt; services)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (PaymentService ignored : services) &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>é¡¹ç›®ç»“æ„</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">src/</span><br><span class="line">â”œâ”€â”€ main/</span><br><span class="line">â”‚   â”œâ”€â”€ java/</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ com/example/</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ PaymentService.java</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ AlipayService.java</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ WechatPayService.java</span><br><span class="line">â”‚   â”‚   â”‚   â””â”€â”€ SPIDemo.java</span><br><span class="line">â”‚   â”‚</span><br><span class="line">â”‚   â””â”€â”€ resources/</span><br><span class="line">â”‚       â””â”€â”€ META-INF/services/</span><br><span class="line">â”‚           â””â”€â”€ com.example.PaymentService  &lt;-- å…³é”®é…ç½®æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>è¿è¡Œç»“æœ</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">=== å‘ç° 2 ä¸ªæ”¯ä»˜æœåŠ¡ ===</span><br><span class="line">[æ”¯ä»˜å®] æ”¯ä»˜: Â¥100.0</span><br><span class="line">[å¾®ä¿¡æ”¯ä»˜] æ”¯ä»˜: Â¥100.0</span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®ç‚¹è§£æï¼š</strong></p>
<ol>
<li><strong>é…ç½®æ–‡ä»¶è·¯å¾„</strong>ï¼š<code>META-INF/services/æ¥å£å…¨é™å®šå</code></li>
<li><strong>æ–‡ä»¶å†…å®¹</strong>ï¼šå®ç°ç±»çš„å…¨é™å®šåï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</li>
<li><strong>ServiceLoader</strong>ï¼šæ ¸å¿ƒåŠ è½½å·¥å…·ï¼Œå®ç°æ‡’åŠ è½½</li>
<li><strong>è¿­ä»£é¡ºåº</strong>ï¼šæŒ‰é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„é¡ºåºåŠ è½½</li>
</ol>
<p><strong>å®é™…åº”ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>JDBC é©±åŠ¨åŠ è½½ï¼ˆ<code>DriverManager</code>ï¼‰</li>
<li>æ—¥å¿—é—¨é¢ï¼ˆSLF4Jï¼‰</li>
<li>åºåˆ—åŒ–æ¡†æ¶ï¼ˆJacksonï¼‰</li>
<li>Spring Boot è‡ªåŠ¨é…ç½®</li>
</ul>
<blockquote>
<p>é€šè¿‡ SPI æœºåˆ¶ï¼ŒJava å®ç°äº†çœŸæ­£çš„é¢å‘æ¥å£ç¼–ç¨‹ï¼Œä½¿ç³»ç»Ÿå…·å¤‡é«˜åº¦å¯æ‰©å±•æ€§ï¼Œç¬¦åˆã€Œå¼€é—­åŸåˆ™ã€ã€‚</p>
</blockquote>
<h2 id="Javaé›†åˆ"><a href="#Javaé›†åˆ" class="headerlink" title="Javaé›†åˆ"></a>Javaé›†åˆ</h2><h3 id="é›†åˆåŸºç¡€"><a href="#é›†åˆåŸºç¡€" class="headerlink" title="é›†åˆåŸºç¡€"></a>é›†åˆåŸºç¡€</h3><p>Java é›†åˆæ¡†æ¶ä¸»è¦åŒ…æ‹¬ <code>Collection</code> å’Œ <code>Map</code> ä¸¤å¤§æ¥å£ä½“ç³»ã€‚<code>Collection</code> ä¸»è¦æœ‰ <code>List</code>ã€<code>Set</code>ã€<code>Queue</code> å‡ ä¸ªæ ¸å¿ƒå­æ¥å£ã€‚</p>
<h4 id="Iterator-å’Œ-ListIterator-çš„åŒºåˆ«"><a href="#Iterator-å’Œ-ListIterator-çš„åŒºåˆ«" class="headerlink" title="Iterator å’Œ ListIterator çš„åŒºåˆ«"></a><strong><code>Iterator</code> å’Œ <code>ListIterator</code> çš„åŒºåˆ«</strong></h4><ul>
<li><code>Iterator</code>ï¼šé€šç”¨è¿­ä»£å™¨æ¥å£ã€‚æä¾› <code>hasNext()</code>, <code>next()</code>, <code>remove()</code> æ–¹æ³•ã€‚åªèƒ½<strong>å•å‘</strong>éå† (<code>Collection</code> æ¥å£ä½¿ç”¨)ã€‚</li>
<li><code>ListIterator</code>ï¼šç»§æ‰¿ <code>Iterator</code>ã€‚ä¸“é—¨ç”¨äº <code>List</code>ã€‚é¢å¤–æä¾›ï¼š<ul>
<li><strong>åŒå‘éå†</strong>ï¼š<code>hasPrevious()</code>, <code>previous()</code>ã€‚</li>
<li><strong>è·å–ç´¢å¼•</strong>ï¼š<code>nextIndex()</code>, <code>previousIndex()</code>ã€‚</li>
<li><strong>ä¿®æ”¹å…ƒç´ </strong>ï¼š<code>set(E e)</code> (æ›¿æ¢ä¸Šæ¬¡è°ƒç”¨ <code>next()</code> æˆ– <code>previous()</code> è¿”å›çš„å…ƒç´ )ã€‚</li>
<li><strong>æ·»åŠ å…ƒç´ </strong>ï¼š<code>add(E e)</code> (åœ¨å½“å‰æ¸¸æ ‡ä½ç½®æ’å…¥å…ƒç´ )ã€‚</li>
</ul>
</li>
<li><code>ListIterator</code> åŠŸèƒ½æ›´å¼ºå¤§ï¼Œä½†åªèƒ½ç”¨äº <code>List</code> åŠå…¶å®ç°ç±»ã€‚</li>
</ul>
<h4 id="ä»€ä¹ˆæ˜¯-fail-fast-æœºåˆ¶"><a href="#ä»€ä¹ˆæ˜¯-fail-fast-æœºåˆ¶" class="headerlink" title="ä»€ä¹ˆæ˜¯ fail-fast æœºåˆ¶"></a><strong>ä»€ä¹ˆæ˜¯ <code>fail-fast</code> æœºåˆ¶</strong></h4><ul>
<li>ä¸€ç§<strong>é”™è¯¯æ£€æµ‹æœºåˆ¶</strong>ã€‚å½“ä½¿ç”¨è¿­ä»£å™¨ (<code>Iterator</code>) éå†é›†åˆæ—¶ï¼Œå¦‚æœ<strong>åœ¨éå†è¿‡ç¨‹ä¸­ï¼ˆé™¤äº†é€šè¿‡è¿­ä»£å™¨è‡ªèº«çš„ <code>remove()</code> æ–¹æ³•å¤–ï¼‰å¯¹é›†åˆç»“æ„è¿›è¡Œäº†ä¿®æ”¹</strong>ï¼ˆæ·»åŠ ã€åˆ é™¤å…ƒç´ ï¼‰ï¼Œåˆ™ä¼šç«‹å³æŠ›å‡º <code>ConcurrentModificationException</code>ã€‚</li>
<li><strong>å®ç°åŸç†</strong>ï¼šé›†åˆå†…éƒ¨ç»´æŠ¤ä¸€ä¸ª <code>modCount</code> (ä¿®æ”¹è®¡æ•°å™¨)ã€‚åˆ›å»ºè¿­ä»£å™¨æ—¶ï¼Œä¼šå°†å½“å‰çš„ <code>modCount</code> è®°å½•ä¸º <code>expectedModCount</code>ã€‚åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡è°ƒç”¨ <code>next()</code>ã€<code>remove()</code> ç­‰æ–¹æ³•å‰éƒ½ä¼šæ£€æŸ¥ <code>modCount == expectedModCount</code>ã€‚å¦‚æœä¸ç›¸ç­‰ï¼Œè¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹æˆ–æœ¬çº¿ç¨‹å…¶ä»–æ“ä½œä¿®æ”¹äº†é›†åˆç»“æ„ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚</li>
<li><strong>ç›®çš„</strong>ï¼šå¿«é€Ÿå¤±è´¥ï¼Œé¿å…åœ¨ä¸ç¡®å®šçŠ¶æ€ä¸‹ç»§ç»­æ“ä½œå¯¼è‡´æ›´éš¾ä»¥é¢„æ–™çš„ç»“æœã€‚<strong>å®ƒä¸èƒ½ä¿è¯å¹¶å‘ä¿®æ”¹ä¸€å®šè¢«æ£€æµ‹åˆ°ï¼Œä¸»è¦ç”¨äºå•çº¿ç¨‹ç¯å¢ƒä¸‹çš„é”™è¯¯æ£€æµ‹</strong>ã€‚</li>
</ul>
<h4 id="fail-fast-å’Œ-fail-safe-çš„åŒºåˆ«"><a href="#fail-fast-å’Œ-fail-safe-çš„åŒºåˆ«" class="headerlink" title="fail-fast å’Œ fail-safe çš„åŒºåˆ«"></a><strong><code>fail-fast</code> å’Œ <code>fail-safe</code> çš„åŒºåˆ«</strong></h4><ul>
<li><strong><code>fail-fast</code><strong>ï¼šç›´æ¥åœ¨åŸé›†åˆä¸Šæ“ä½œã€‚è¿­ä»£æ—¶æ£€æµ‹åˆ°å¹¶å‘ä¿®æ”¹å°±</strong>ç«‹å³æŠ›å¼‚å¸¸</strong>ã€‚ä»£è¡¨ï¼š<code>ArrayList</code>, <code>HashMap</code> ç­‰éå¹¶å‘é›†åˆçš„è¿­ä»£å™¨ã€‚</li>
<li><strong><code>fail-safe</code> (Concurrent Modification Tolerance)<strong>ï¼š</strong>ä¸åœ¨åŸé›†åˆä¸Šæ“ä½œ</strong>ï¼Œè€Œæ˜¯åŸºäºåŸé›†åˆçš„<strong>å¿«ç…§ (snapshot)</strong> æˆ– <strong>åªè¯»è§†å›¾</strong> è¿›è¡Œè¿­ä»£ã€‚è¿­ä»£è¿‡ç¨‹ä¸­åŸé›†åˆçš„ä¿®æ”¹ä¸ä¼šå½±å“è¿­ä»£å™¨ï¼Œä¸ä¼šæŠ›å¼‚å¸¸ã€‚ä»£è¡¨ï¼š<code>ConcurrentHashMap</code>, <code>CopyOnWriteArrayList</code> çš„è¿­ä»£å™¨ã€‚</li>
<li><strong>æ³¨æ„</strong>ï¼š<code>java.util.concurrent</code> åŒ…ä¸‹çš„é›†åˆé€šå¸¸é‡‡ç”¨ <strong>å¼±ä¸€è‡´æ€§ (Weakly Consistent)</strong> è¿­ä»£å™¨ï¼Œå®ƒæä¾› <code>fail-safe</code> è¡Œä¸ºï¼Œä½†ä¸ä¿è¯è¿­ä»£å™¨çœ‹åˆ°æ‰€æœ‰ä¿®æ”¹ã€‚</li>
</ul>
<h3 id="List"><a href="#List" class="headerlink" title="List"></a><code>List</code></h3><h4 id="ArrayListçš„æ‰©å®¹æœºåˆ¶"><a href="#ArrayListçš„æ‰©å®¹æœºåˆ¶" class="headerlink" title="ArrayListçš„æ‰©å®¹æœºåˆ¶"></a><code>ArrayList</code>çš„æ‰©å®¹æœºåˆ¶</h4><ul>
<li>ä½¿ç”¨ <code>Object[] elementData</code> å­˜å‚¨å…ƒç´ ã€‚</li>
<li>åˆ›å»ºæ—¶å¦‚æœæœªæŒ‡å®šå¤§å°ï¼Œåˆå§‹å®¹é‡ä¸º <strong>0</strong> (JDK 1.8+) æˆ– <strong>10</strong> (æ—§ç‰ˆæœ¬ï¼Œéœ€ç¡®è®¤å…·ä½“ç‰ˆæœ¬)ï¼Œç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ æ—¶æ‰©å®¹åˆ° <strong>10</strong>ã€‚</li>
<li>å½“æ·»åŠ å…ƒç´ æ—¶å‘ç°å®¹é‡ä¸è¶³ï¼ˆ<code>size + 1 &gt; elementData.length</code>ï¼‰ï¼Œè§¦å‘æ‰©å®¹ã€‚</li>
<li>æ–°å®¹é‡ &#x3D; <code>ArraysSupport.newLength(oldCapacity, minCapacity - oldCapacity, oldCapacity &gt;&gt; 1)</code>ï¼Œå³è®¡ç®—æ–°å®¹é‡ä¸º <code>oldCapacity + max(éœ€è¦çš„æœ€å°å¢é‡, oldCapacity / 2)</code>ï¼Œç®€å•ç†è§£é€šå¸¸æ˜¯ <strong>åŸå®¹é‡çš„1.5å€</strong>ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„æ›´å¤§çš„æ•°ç»„ï¼Œå°†æ—§æ•°ç»„å…ƒç´ <strong>å¤åˆ¶</strong>åˆ°æ–°æ•°ç»„ã€‚</li>
</ul>
<h4 id="Vector-å’Œ-ArrayList-çš„åŒºåˆ«"><a href="#Vector-å’Œ-ArrayList-çš„åŒºåˆ«" class="headerlink" title="Vector å’Œ ArrayList çš„åŒºåˆ«"></a><code>Vector</code> å’Œ <code>ArrayList</code> çš„åŒºåˆ«</h4><ul>
<li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼š<ul>
<li><code>Vector</code>ï¼š<strong>çº¿ç¨‹å®‰å…¨</strong>ã€‚å…³é”®æ–¹æ³•ä½¿ç”¨ <code>synchronized</code> ä¿®é¥°ï¼Œæ€§èƒ½è¾ƒä½ã€‚</li>
<li><code>ArrayList</code>ï¼š<strong>éçº¿ç¨‹å®‰å…¨</strong>ã€‚æ€§èƒ½æ›´é«˜ã€‚</li>
</ul>
</li>
<li><strong>æ‰©å®¹æœºåˆ¶</strong>ï¼š<ul>
<li><code>Vector</code>ï¼šé»˜è®¤æ‰©å®¹ä¸ºåŸæ¥çš„ <strong>2å€</strong>ï¼Œå¯é€šè¿‡æ„é€ å‡½æ•°æŒ‡å®šæ‰©å®¹å¢é‡ã€‚</li>
<li><code>ArrayList</code>ï¼šé»˜è®¤æ‰©å®¹ä¸ºåŸæ¥çš„ <strong>1.5å€</strong> (<code>(oldCapacity * 3)/2 + 1</code>)ã€‚</li>
</ul>
</li>
</ul>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a><code>Set</code></h3><h4 id="HashSetã€LinkedHashSet-å’Œ-TreeSet-çš„åŒºåˆ«"><a href="#HashSetã€LinkedHashSet-å’Œ-TreeSet-çš„åŒºåˆ«" class="headerlink" title="HashSetã€LinkedHashSet å’Œ TreeSet çš„åŒºåˆ«"></a><strong><code>HashSet</code>ã€<code>LinkedHashSet</code> å’Œ <code>TreeSet</code> çš„åŒºåˆ«</strong></h4><ul>
<li><strong>åº•å±‚å®ç°</strong>ï¼š<ul>
<li><code>HashSet</code>ï¼šåŸºäº <strong><code>HashMap</code></strong> (åªéœ€ Keyï¼ŒValue ç”¨å¸¸é‡ <code>PRESENT</code> å¡«å……)ã€‚</li>
<li><code>LinkedHashSet</code>ï¼šç»§æ‰¿è‡ª <code>HashSet</code>ï¼ŒåŸºäº **<code>LinkedHashMap</code>**ã€‚</li>
<li><code>TreeSet</code>ï¼šåŸºäº <strong><code>TreeMap</code></strong> (çº¢é»‘æ ‘)ã€‚</li>
</ul>
</li>
<li><strong>å…ƒç´ é¡ºåº</strong>ï¼š<ul>
<li><code>HashSet</code>ï¼š<strong>æ— åº</strong> (ä¸ä¿è¯æ’å…¥é¡ºåºæˆ–æ’ä¹…ä¸å˜)ã€‚</li>
<li><code>LinkedHashSet</code>ï¼š<strong>æŒ‰å…ƒç´ æ’å…¥é¡ºåºæ’åº</strong> (åŒå‘é“¾è¡¨ç»´æŠ¤æ’å…¥æ¬¡åº)ã€‚</li>
<li><code>TreeSet</code>ï¼š<strong>æŒ‰å…ƒç´ çš„è‡ªç„¶é¡ºåº (<code>Comparable</code>) æˆ–æŒ‡å®šçš„ <code>Comparator</code> æ’åº</strong>ã€‚</li>
</ul>
</li>
<li><strong>æ€§èƒ½</strong>ï¼š<ul>
<li><code>HashSet</code>&#x2F;<code>LinkedHashSet</code>ï¼šæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾ <strong>O(1)</strong> (å¹³å‡æƒ…å†µ)ã€‚</li>
<li><code>TreeSet</code>ï¼šæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾ **O(log n)**ã€‚</li>
</ul>
</li>
<li><strong>å…ƒç´ è¦æ±‚</strong>ï¼š<ul>
<li><code>HashSet</code>&#x2F;<code>LinkedHashSet</code>ï¼šå…ƒç´ å¿…é¡»æ­£ç¡®å®ç° <code>equals()</code> å’Œ <code>hashCode()</code>ã€‚</li>
<li><code>TreeSet</code>ï¼šå…ƒç´ å¿…é¡»å®ç° <code>Comparable</code> æ¥å£æˆ–åœ¨æ„é€ æ—¶ä¼ å…¥ <code>Comparator</code>ã€‚</li>
</ul>
</li>
<li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šä¸‰è€…éƒ½<strong>éçº¿ç¨‹å®‰å…¨</strong>ã€‚</li>
</ul>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a><code>Map</code></h3><h4 id="HashMap-çš„åº•å±‚å®ç°åŸç†"><a href="#HashMap-çš„åº•å±‚å®ç°åŸç†" class="headerlink" title="HashMap çš„åº•å±‚å®ç°åŸç†"></a><strong><code>HashMap</code> çš„åº•å±‚å®ç°åŸç†</strong></h4><p><strong>JDK7ï¼šæ•°ç»„ + é“¾è¡¨</strong></p>
<ul>
<li><strong>æ‰©å®¹</strong>ï¼šåˆ›å»ºæ–°æ•°ç»„ (é€šå¸¸æ˜¯åŸæ•°ç»„é•¿åº¦çš„ <strong>2å€</strong>)ï¼Œéå†æ‰€æœ‰å…ƒç´ ï¼Œ<strong>é‡æ–°è®¡ç®—æ¯ä¸ªå…ƒç´ åœ¨æ–°æ•°ç»„ä¸­çš„ä½ç½®</strong> (<code>rehash</code>)ï¼Œå°†å…ƒç´ è½¬ç§»åˆ°æ–°æ•°ç»„ã€‚<strong>å¤´æ’æ³•ä¼šå¯¼è‡´æ‰©å®¹æ—¶é“¾è¡¨å…ƒç´ é¡ºåºåè½¬</strong>ã€‚</li>
</ul>
<p><strong>JDK8ï¼šæ•°ç»„ + é“¾è¡¨ &#x2F; çº¢é»‘æ ‘</strong></p>
<p><strong>ä¸»è¦æ”¹è¿›</strong>ï¼š</p>
<ul>
<li><strong>å°¾æ’æ³•</strong>ï¼šè§£å†³ JDK7 å¤´æ’æ³•å¤šçº¿ç¨‹ä¸‹å¯èƒ½å¯¼è‡´æ­»å¾ªç¯çš„é—®é¢˜ï¼ˆæœªè§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼‰ã€‚</li>
<li><strong>é“¾è¡¨è½¬çº¢é»‘æ ‘</strong>ï¼šå½“é“¾è¡¨é•¿åº¦ <strong>&gt;&#x3D; 8 (TREEIFY_THRESHOLD)</strong> ä¸” <strong>æ•°ç»„é•¿åº¦ &gt;&#x3D; 64 (MIN_TREEIFY_CAPACITY)</strong> æ—¶ï¼Œé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œæé«˜é•¿é“¾è¡¨çš„æŸ¥æ‰¾æ•ˆç‡ (O(n) -&gt; O(log n))ã€‚</li>
<li><strong>ä¼˜åŒ–å“ˆå¸Œç®—æ³•</strong>ï¼š<code>(key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16)</code>ï¼Œé«˜ä½å‚ä¸è¿ç®—ï¼Œå‡å°‘å“ˆå¸Œå†²çªã€‚</li>
<li><strong>æ‰©å®¹</strong>ï¼šæ ¹æ® <code>(e.hash &amp; oldCap) == 0</code> å°†é“¾è¡¨æ‹†åˆ†æˆä¸¤ä¸ªå­é“¾è¡¨ï¼Œç»“æœä¸º 0 çš„èŠ‚ç‚¹ä¿æŒåŸç´¢å¼•ä½ç½® <code>i</code>ï¼Œç»“æœä¸ä¸º 0 çš„èŠ‚ç‚¹æ”¾åˆ°æ–°ä½ç½® <code>i + oldCap</code>ï¼Œé¿å…å…¨é‡ <code>rehash</code>ï¼Œæå‡äº†æ•ˆç‡ã€‚</li>
</ul>
<h4 id="HashMap-å’Œ-HashTable-çš„åŒºåˆ«"><a href="#HashMap-å’Œ-HashTable-çš„åŒºåˆ«" class="headerlink" title="HashMap å’Œ HashTable çš„åŒºåˆ«"></a><strong><code>HashMap</code> å’Œ <code>HashTable</code> çš„åŒºåˆ«</strong></h4><ul>
<li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼š<ul>
<li><code>HashMap</code>ï¼š<strong>éçº¿ç¨‹å®‰å…¨</strong>ã€‚æ€§èƒ½æ›´é«˜ã€‚</li>
<li><code>Hashtable</code>ï¼š<strong>çº¿ç¨‹å®‰å…¨</strong>ã€‚å‡ ä¹æ‰€æœ‰å…¬å…±æ–¹æ³•éƒ½ç”¨ <code>synchronized</code> ä¿®é¥°ï¼Œæ€§èƒ½è¾ƒä½ã€‚</li>
</ul>
</li>
<li><strong><code>null</code> å€¼</strong>ï¼š<ul>
<li><code>HashMap</code>ï¼šå…è®¸ <code>key</code> å’Œ <code>value</code> ä¸º <code>null</code>ã€‚</li>
<li><code>Hashtable</code>ï¼šä¸å…è®¸ <code>key</code> æˆ– <code>value</code> ä¸º <code>null</code>ã€‚</li>
</ul>
</li>
<li><strong>ç»§æ‰¿ä½“ç³»</strong>ï¼š<ul>
<li><code>HashMap</code>ï¼šç»§æ‰¿ <code>AbstractMap</code>ã€‚</li>
<li><code>Hashtable</code>ï¼šç»§æ‰¿ <code>Dictionary</code> (ä¸€ä¸ªå¤è€çš„ç±»)ã€‚</li>
</ul>
</li>
<li><strong>è¿­ä»£å™¨</strong>ï¼š<ul>
<li><code>HashMap</code> çš„ <code>Iterator</code> æ˜¯ <strong>fail-fast</strong> çš„ã€‚</li>
<li><code>Hashtable</code> çš„ <code>Enumerator</code> ä¸æ˜¯ fail-fast çš„ã€‚</li>
</ul>
</li>
<li><strong>åˆå§‹å®¹é‡ä¸æ‰©å®¹</strong>ï¼š<ul>
<li><code>HashMap</code>ï¼šé»˜è®¤ 16ï¼Œæ‰©å®¹ä¸º 2 å€ã€‚</li>
<li><code>Hashtable</code>ï¼šé»˜è®¤ 11ï¼Œæ‰©å®¹ä¸º 2 å€ + 1 (<code>oldCapacity * 2 + 1</code>)ã€‚</li>
</ul>
</li>
<li><strong>å“ˆå¸Œè®¡ç®—</strong>ï¼š<ul>
<li><code>HashMap</code>ï¼šä¼˜åŒ–äº†å“ˆå¸Œå‡½æ•° (<code>(h = key.hashCode()) ^ (h &gt;&gt;&gt; 16)</code>)ã€‚</li>
<li><code>Hashtable</code>ï¼šç›´æ¥ä½¿ç”¨ <code>key.hashCode()</code>ã€‚</li>
</ul>
</li>
<li><strong>æ¨èä½¿ç”¨</strong>ï¼š**<code>HashMap</code> + <code>ConcurrentHashMap</code> æˆ– <code>Collections.synchronizedMap()</code> ä»£æ›¿ <code>Hashtable</code>**ã€‚</li>
</ul>
<h2 id="Java-IO"><a href="#Java-IO" class="headerlink" title="Java IO"></a>Java IO</h2><h3 id="å­—èŠ‚æµä¸å­—ç¬¦æµçš„åŒºåˆ«"><a href="#å­—èŠ‚æµä¸å­—ç¬¦æµçš„åŒºåˆ«" class="headerlink" title="å­—èŠ‚æµä¸å­—ç¬¦æµçš„åŒºåˆ«"></a>å­—èŠ‚æµä¸å­—ç¬¦æµçš„åŒºåˆ«</h3><ul>
<li><strong>å­—èŠ‚æµ</strong>ï¼š<code>InputStream</code>&#x2F;<code>OutputStream</code>ï¼Œå¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼ˆå¦‚å›¾ç‰‡ã€è§†é¢‘ï¼‰ï¼Œæ ¸å¿ƒç±»å¦‚ <code>FileInputStream</code>ã€‚</li>
<li><strong>å­—ç¬¦æµ</strong>ï¼š<code>Reader</code>&#x2F;<code>Writer</code>ï¼Œå¤„ç†æ–‡æœ¬æ•°æ®ï¼ˆè‡ªåŠ¨å¤„ç†ç¼–ç ï¼‰ï¼Œæ ¸å¿ƒç±»å¦‚ <code>FileReader</code>ã€<code>InputStreamReader</code>ã€‚</li>
<li><strong>å…³é”®ç‚¹</strong>ï¼šå­—ç¬¦æµåº•å±‚ä¾èµ–å­—èŠ‚æµ + ç¼–ç è½¬æ¢ï¼ˆå¦‚ <code>InputStreamReader</code> æ˜¯å­—èŠ‚åˆ°å­—ç¬¦çš„æ¡¥æ¢ï¼‰ã€‚</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆè¦æœ‰å­—ç¬¦æµï¼Ÿ</strong></p>
<ul>
<li>ç›´æ¥æ“ä½œå­—ç¬¦æ›´é«˜æ•ˆï¼Œé¿å…æ‰‹åŠ¨å¤„ç†ç¼–ç ï¼ˆå¦‚ UTF-8 è½¬ç ï¼‰ï¼Œè§£å†³ä¹±ç é—®é¢˜ã€‚</li>
</ul>
<h3 id="BIOã€NIOã€AIOçš„åŒºåˆ«"><a href="#BIOã€NIOã€AIOçš„åŒºåˆ«" class="headerlink" title="BIOã€NIOã€AIOçš„åŒºåˆ«"></a>BIOã€NIOã€AIOçš„åŒºåˆ«</h3><table>
<thead>
<tr>
<th align="left"><strong>ç‰¹æ€§</strong></th>
<th align="left">ä¼ ç»Ÿ IO</th>
<th align="left">NIO</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>æ¨¡å‹</strong></td>
<td align="left">é˜»å¡å¼ï¼ˆBlockingï¼‰</td>
<td align="left">éé˜»å¡å¼ï¼ˆNon-blockingï¼‰</td>
</tr>
<tr>
<td align="left"><strong>æ•°æ®å•ä½</strong></td>
<td align="left">æµï¼ˆStreamï¼‰</td>
<td align="left">ç¼“å†²åŒºï¼ˆBufferï¼‰ + é€šé“ï¼ˆChannelï¼‰</td>
</tr>
<tr>
<td align="left"><strong>å¤šè·¯å¤ç”¨</strong></td>
<td align="left">ä¸æ”¯æŒ</td>
<td align="left">Selector è½®è¯¢æœºåˆ¶</td>
</tr>
</tbody></table>
<h3 id="NIO-ä¸‰å¤§æ ¸å¿ƒç»„ä»¶"><a href="#NIO-ä¸‰å¤§æ ¸å¿ƒç»„ä»¶" class="headerlink" title="NIO ä¸‰å¤§æ ¸å¿ƒç»„ä»¶"></a>NIO ä¸‰å¤§æ ¸å¿ƒç»„ä»¶</h3><ul>
<li><strong>Buffer</strong>ï¼šæ•°æ®å®¹å™¨ï¼ˆå¦‚ <code>ByteBuffer</code>ï¼‰ï¼Œæ”¯æŒ <code>flip()</code>ã€<code>clear()</code> ç­‰æ“ä½œã€‚</li>
<li><strong>Channel</strong>ï¼šåŒå‘æ•°æ®ä¼ è¾“é€šé“ï¼ˆå¦‚ <code>FileChannel</code>ã€<code>SocketChannel</code>ï¼‰ã€‚</li>
<li><strong>Selector</strong>ï¼šå•çº¿ç¨‹ç›‘å¬å¤šä¸ª Channel äº‹ä»¶ï¼ˆOP_READ&#x2F;OP_WRITEï¼‰ã€‚</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯é›¶æ‹·è´"><a href="#ä»€ä¹ˆæ˜¯é›¶æ‹·è´" class="headerlink" title="ä»€ä¹ˆæ˜¯é›¶æ‹·è´"></a>ä»€ä¹ˆæ˜¯é›¶æ‹·è´</h3><h3 id="5ç§IOæ¨¡å‹"><a href="#5ç§IOæ¨¡å‹" class="headerlink" title="5ç§IOæ¨¡å‹"></a>5ç§IOæ¨¡å‹</h3><h3 id="ä»€ä¹ˆæ˜¯Reactoræ¨¡å‹"><a href="#ä»€ä¹ˆæ˜¯Reactoræ¨¡å‹" class="headerlink" title="ä»€ä¹ˆæ˜¯Reactoræ¨¡å‹"></a>ä»€ä¹ˆæ˜¯Reactoræ¨¡å‹</h3><h2 id="Javaå¹¶å‘"><a href="#Javaå¹¶å‘" class="headerlink" title="Javaå¹¶å‘"></a>Javaå¹¶å‘</h2><h3 id="JUCé›†åˆ"><a href="#JUCé›†åˆ" class="headerlink" title="JUCé›†åˆ"></a>JUCé›†åˆ</h3><h4 id="ConcurrentHashMap-çš„å®ç°åŸç†"><a href="#ConcurrentHashMap-çš„å®ç°åŸç†" class="headerlink" title="ConcurrentHashMap çš„å®ç°åŸç†"></a><code>ConcurrentHashMap</code> çš„å®ç°åŸç†</h4><ul>
<li><strong>JDK7ï¼šåˆ†æ®µé” (Segment Locking)</strong><ul>
<li>å°†æ•°æ®åˆ†æˆå¤šä¸ªæ®µ (<code>Segment</code> æ•°ç»„ï¼Œé»˜è®¤ 16 ä¸ªæ®µ)ã€‚</li>
<li>æ¯ä¸ª <code>Segment</code> æœ¬èº«æ˜¯ä¸€ä¸ªç±»ä¼¼ <code>ReentrantLock</code> çš„é”ï¼Œå¹¶ç®¡ç†ä¸€ä¸ªç‹¬ç«‹çš„ <code>HashEntry</code> æ•°ç»„ (ç›¸å½“äºä¸€ä¸ªå°å‹çš„ <code>HashMap</code>)ã€‚</li>
<li><strong>é”ç²’åº¦</strong>ï¼šé”ä½çš„æ˜¯<strong>æ•´ä¸ªæ®µ</strong>ã€‚ä¸åŒæ®µä¸Šçš„æ“ä½œå¯ä»¥å¹¶å‘è¿›è¡Œã€‚å¹¶å‘åº¦ç­‰äº <code>Segment</code> çš„æ•°é‡ã€‚</li>
<li><strong>PUT</strong>ï¼šå…ˆå®šä½åˆ°å“ªä¸ª <code>Segment</code>ï¼Œç„¶åå¯¹è¯¥ <code>Segment</code> <strong>åŠ é”</strong>ï¼Œå†åœ¨è¯¥ <code>Segment</code> å†…éƒ¨çš„å“ˆå¸Œè¡¨ä¸Šè¿›è¡Œæ“ä½œï¼ˆç±»ä¼¼ <code>HashMap</code> JDK7ï¼‰ã€‚</li>
<li><strong>GET</strong>ï¼š<strong>æ— é”</strong> (volatile è¯»)ã€‚å®šä½åˆ° <code>Segment</code> å’Œ <code>HashEntry</code> åç›´æ¥è¯»å– <code>value</code> (value æ˜¯ volatile çš„)ã€‚</li>
</ul>
</li>
<li><strong>JDK8ï¼š<code>synchronized</code> + <code>CAS</code> + çº¢é»‘æ ‘</strong><ul>
<li>æ‘’å¼ƒåˆ†æ®µé”ï¼Œé‡‡ç”¨ <code>Node</code> æ•°ç»„ + é“¾è¡¨ &#x2F; çº¢é»‘æ ‘ (ç»“æ„ç±»ä¼¼ <code>HashMap</code> JDK8)ã€‚</li>
<li><strong>é”ç²’åº¦</strong>ï¼š<strong>é”å•ä¸ªé“¾è¡¨å¤´èŠ‚ç‚¹æˆ–æ ‘æ ¹èŠ‚ç‚¹</strong> (æ¡¶çº§åˆ«)ã€‚å¹¶å‘åº¦å¤§å¤§æé«˜ã€‚</li>
<li><strong>å…³é”®æœºåˆ¶</strong>ï¼š<ul>
<li>**<code>CAS</code> (Compare-And-Swap)**ï¼šç”¨äºæ— é”åŒ–çš„åˆå§‹åŒ–æ•°ç»„ã€æ’å…¥æ–°èŠ‚ç‚¹ (<code>tabAt</code>, <code>casTabAt</code>, <code>setTabAt</code> ä½¿ç”¨ <code>Unsafe</code> æ“ä½œ)ã€‚</li>
<li><strong><code>synchronized</code><strong>ï¼šå½“å‘ç”Ÿå“ˆå¸Œå†²çªï¼ˆæ¡¶ä¸ä¸ºç©ºï¼‰æ—¶ï¼Œå¯¹é“¾è¡¨çš„å¤´èŠ‚ç‚¹æˆ–æ ‘çš„æ ¹èŠ‚ç‚¹</strong>åŠ  <code>synchronized</code> é”</strong>ã€‚é”å¯¹è±¡æ˜¯å¤´èŠ‚ç‚¹æœ¬èº«ã€‚</li>
<li>**<code>volatile</code>**ï¼š<code>Node</code> çš„ <code>val</code> å’Œ <code>next</code> å­—æ®µç”¨ <code>volatile</code> ä¿®é¥°ï¼Œä¿è¯å¯è§æ€§ã€‚</li>
</ul>
</li>
<li><strong>PUT</strong>ï¼š<ol>
<li>è®¡ç®—å“ˆå¸Œå€¼ï¼Œå®šä½æ¡¶ä½ç½®ã€‚</li>
<li>å¦‚æœæ¡¶ä¸ºç©ºï¼Œå°è¯•ç”¨ <code>CAS</code> æ’å…¥æ–°èŠ‚ç‚¹ã€‚</li>
<li>å¦‚æœæ¡¶ä¸ä¸ºç©ºï¼ˆå¯èƒ½æœ‰é”ç«äº‰ï¼‰ï¼š<ul>
<li>å¦‚æœè¯¥æ¡¶èŠ‚ç‚¹æ­£åœ¨æ‰©å®¹ (<code>MOVED</code>)ï¼Œå½“å‰çº¿ç¨‹ååŠ©æ‰©å®¹ (<code>helpTransfer</code>)ã€‚</li>
<li>å¦åˆ™ï¼Œ<strong>å¯¹æ¡¶çš„å¤´èŠ‚ç‚¹åŠ  <code>synchronized</code> é”</strong>ã€‚</li>
<li>åœ¨é”å†…ï¼Œæ ¹æ®æ˜¯é“¾è¡¨è¿˜æ˜¯æ ‘ï¼Œæ‰§è¡Œç±»ä¼¼ <code>HashMap</code> JDK8 çš„æ’å…¥é€»è¾‘ï¼ˆå°¾æ’æ³•ï¼Œæ ‘åŒ–ï¼‰ã€‚</li>
</ul>
</li>
<li>æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ï¼ˆé“¾è¡¨é•¿åº¦è¾¾åˆ° 8 ä¸”æ•°ç»„é•¿åº¦ &lt; 64 æ—¶ä¼˜å…ˆæ‰©å®¹ï¼‰ã€‚</li>
</ol>
</li>
<li><strong>GET</strong>ï¼š<strong>å®Œå…¨æ— é”</strong>ã€‚å®šä½åˆ°æ¡¶åï¼Œæ ¹æ®é“¾è¡¨æˆ–æ ‘éå†æŸ¥æ‰¾ã€‚ä¾èµ– <code>volatile</code> è¯»ä¿è¯å¯è§æ€§ã€‚</li>
<li><strong>æ‰©å®¹</strong>ï¼šæ”¯æŒ<strong>å¤šçº¿ç¨‹ååŒæ‰©å®¹</strong> (<code>transfer</code>)ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è§¦å‘æ‰©å®¹æ—¶ï¼Œå®ƒè´Ÿè´£åˆ†é…è¿ç§»ä»»åŠ¡åŒºé—´ã€‚å…¶ä»–çº¿ç¨‹åœ¨ PUT æ“ä½œæ—¶å¦‚æœå‘ç°æ­£åœ¨æ‰©å®¹ï¼Œä¼šååŠ©è¿ç§»ä¸€éƒ¨åˆ†æ•°æ®ã€‚ä½¿ç”¨ <code>ForwardingNode</code> èŠ‚ç‚¹æ ‡è®°è¿ç§»å®Œæˆçš„æ¡¶ã€‚</li>
</ul>
</li>
</ul>
<h4 id="ä¸ºä»€ä¹ˆ-ConcurrentHashMap-æ¯”-Hashtable-æ•ˆç‡é«˜"><a href="#ä¸ºä»€ä¹ˆ-ConcurrentHashMap-æ¯”-Hashtable-æ•ˆç‡é«˜" class="headerlink" title="ä¸ºä»€ä¹ˆ ConcurrentHashMap æ¯” Hashtable æ•ˆç‡é«˜"></a><strong>ä¸ºä»€ä¹ˆ <code>ConcurrentHashMap</code> æ¯” <code>Hashtable</code> æ•ˆç‡é«˜</strong></h4><ul>
<li><strong>é”ç²’åº¦</strong>ï¼š<ul>
<li><code>Hashtable</code>ï¼š<strong>å…¨å±€é”</strong>ã€‚é”ä½æ•´ä¸ªè¡¨ï¼Œä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ“ä½œã€‚</li>
<li><code>ConcurrentHashMap</code> (JDK7)ï¼š<strong>åˆ†æ®µé”</strong>ã€‚é”ä½ä¸€ä¸ªæ®µï¼Œä¸åŒæ®µæ“ä½œå¯å¹¶å‘ã€‚</li>
<li><code>ConcurrentHashMap</code> (JDK8)ï¼š**æ¡¶é” (å¤´èŠ‚ç‚¹é”)**ã€‚é”ç²’åº¦æ›´ç»†ï¼Œå†²çªæ¦‚ç‡æ›´ä½ï¼Œå¹¶å‘åº¦æ›´é«˜ã€‚</li>
</ul>
</li>
<li><strong>æ— é”è¯»</strong>ï¼š<ul>
<li><code>Hashtable</code>ï¼šè¯»æ“ä½œä¹Ÿéœ€è¦è·å–é”ã€‚</li>
<li><code>ConcurrentHashMap</code> (JDK7 &amp; JDK8)ï¼š<strong>è¯»æ“ä½œå®Œå…¨æ— é”</strong> (JDK7 åˆ©ç”¨ volatile valueï¼ŒJDK8 åˆ©ç”¨ volatile val&#x2F;next å’Œ Unsafe çš„åŸå­è¯»)ï¼Œæå¤§æå‡è¯»æ€§èƒ½ã€‚</li>
</ul>
</li>
</ul>
<h2 id="å¼‚æ­¥ç¼–ç¨‹"><a href="#å¼‚æ­¥ç¼–ç¨‹" class="headerlink" title="å¼‚æ­¥ç¼–ç¨‹"></a>å¼‚æ­¥ç¼–ç¨‹</h2><h3 id="CompletableFutureçš„åŸç†ä¸åº”ç”¨"><a href="#CompletableFutureçš„åŸç†ä¸åº”ç”¨" class="headerlink" title="CompletableFutureçš„åŸç†ä¸åº”ç”¨"></a><code>CompletableFuture</code>çš„åŸç†ä¸åº”ç”¨</h3><p><code>CompletableFuture</code> æ˜¯ Java 8 å¼•å…¥çš„æ ¸å¿ƒå¹¶å‘å·¥å…·ç±»ï¼ˆä½äº <code>java.util.concurrent</code> åŒ…ï¼‰ï¼Œå®ƒä»£è¡¨ä¸€ä¸ª<strong>å¼‚æ­¥è®¡ç®—çš„ç»“æœ</strong>ã€‚å®ƒä¸ä»…æ˜¯å¯¹ä¼ ç»Ÿ <code>Future</code> æ¥å£çš„å¢å¼ºï¼Œæ›´æ˜¯ä¸€ä¸ªå¼ºå¤§çš„<strong>å¼‚æ­¥ç¼–ç¨‹æ¡†æ¶</strong>ï¼Œæ”¯æŒæ˜¾å¼åœ°å®Œæˆè®¡ç®—ã€é“¾å¼ç»„åˆå¤šä¸ªå¼‚æ­¥ä»»åŠ¡ã€å¤„ç†ç»“æœå’Œå¼‚å¸¸ï¼Œæ˜¯å®ç°å“åº”å¼ã€éé˜»å¡ç¼–ç¨‹çš„å…³é”®ç»„ä»¶ã€‚</p>
<p><strong>ä¸€ã€æ ¸å¿ƒåŸç†</strong></p>
<ol>
<li><strong>å¼‚æ­¥æ‰§è¡Œä¸ç»“æœå®¹å™¨ï¼š</strong><ul>
<li>å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<strong>å®¹å™¨</strong>ï¼Œç”¨äºæ‰¿è½½å°†æ¥æŸä¸ªæ—¶åˆ»è®¡ç®—å®Œæˆçš„ç»“æœï¼ˆæˆ–å¼‚å¸¸ï¼‰ã€‚</li>
<li>è®¡ç®—ä»»åŠ¡é€šå¸¸è¢«æäº¤ç»™ <code>Executor</code>ï¼ˆçº¿ç¨‹æ± ï¼‰åœ¨åå°çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œé¿å…é˜»å¡è°ƒç”¨çº¿ç¨‹ã€‚</li>
<li>åˆ›å»ºæ—¶ç»“æœæœªçŸ¥ï¼Œè®¡ç®—å®Œæˆåç»“æœè¢«è®¾ç½®ï¼ˆ<code>complete(result)</code> æˆ– <code>completeExceptionally(throwable)</code>ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>æ˜¾å¼å®Œæˆï¼š</strong><ul>
<li>ä¸ä¼ ç»Ÿ <code>Future</code> åªèƒ½è¢«åŠ¨ç­‰å¾…ä¸åŒï¼Œ<code>CompletableFuture</code> å¯ä»¥è¢«<strong>ä¸»åŠ¨å®Œæˆ</strong>ã€‚</li>
<li>ä»»ä½•æ‹¥æœ‰è¯¥å¯¹è±¡å¼•ç”¨çš„çº¿ç¨‹éƒ½å¯ä»¥è°ƒç”¨ <code>complete()</code> æˆ– <code>completeExceptionally()</code> æ‰‹åŠ¨è®¾ç½®ç»“æœæˆ–å¼‚å¸¸ã€‚è¿™æ˜¯å®ç°è¶…æ—¶æ§åˆ¶ã€å¤–éƒ¨äº‹ä»¶è§¦å‘å®Œæˆç­‰åœºæ™¯çš„åŸºç¡€ã€‚</li>
</ul>
</li>
<li><strong>é“¾å¼ç»„åˆä¸å›è°ƒ (CompletionStage)ï¼š</strong><ul>
<li><code>CompletableFuture</code> å®ç°äº† <code>CompletionStage</code> æ¥å£ï¼Œè¿™æ˜¯å…¶å¼ºå¤§èƒ½åŠ›çš„æ ¸å¿ƒã€‚</li>
<li><code>CompletionStage</code> å®šä¹‰äº†ä¸°å¯Œçš„é“¾å¼æ–¹æ³•ï¼ˆ<code>thenApply</code>, <code>thenAccept</code>, <code>thenRun</code>, <code>thenCompose</code>, <code>thenCombine</code>, <code>handle</code>, <code>whenComplete</code>, <code>exceptionally</code> ç­‰ï¼‰ã€‚</li>
<li>è¿™äº›æ–¹æ³•å…è®¸ä½ <strong>å£°æ˜å¼åœ°</strong>æè¿°ï¼šâ€œ<strong>å½“å½“å‰é˜¶æ®µå®Œæˆæ—¶ï¼Œæ¥ä¸‹æ¥åº”è¯¥åšä»€ä¹ˆ</strong>â€ã€‚å›è°ƒå‡½æ•°ï¼ˆlambda è¡¨è¾¾å¼æˆ–æ–¹æ³•å¼•ç”¨ï¼‰ä¼šè¢«æŒ‚æ¥åˆ°å½“å‰é˜¶æ®µçš„å®Œæˆäº‹ä»¶ä¸Šã€‚</li>
<li>æ¯ä¸ªé“¾å¼è°ƒç”¨éƒ½ä¼šè¿”å›ä¸€ä¸ª<strong>æ–°çš„ <code>CompletionStage</code>ï¼ˆé€šå¸¸æ˜¯å¦ä¸€ä¸ª <code>CompletableFuture</code>ï¼‰</strong>ï¼Œä»£è¡¨ä¸‹ä¸€ä¸ªå¼‚æ­¥æ­¥éª¤ã€‚è¿™å½¢æˆäº†<strong>å¼‚æ­¥ä»»åŠ¡æµæ°´çº¿</strong>ã€‚</li>
</ul>
</li>
<li><strong>ä¾èµ–å…³ç³»ä¸å†…éƒ¨çŠ¶æ€æœºï¼š</strong><ul>
<li>å½“å¤šä¸ª <code>CompletableFuture</code> é€šè¿‡ <code>thenXxx</code> æ–¹æ³•é“¾æ¥èµ·æ¥æ—¶ï¼Œåç»­é˜¶æ®µä¾èµ–äºå‰é©±é˜¶æ®µçš„å®Œæˆã€‚</li>
<li><code>CompletableFuture</code> å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª<strong>çŠ¶æ€æœº</strong>ï¼ˆå¦‚ <code>NEW</code>, <code>COMPLETING</code>, <code>NORMAL</code>, <code>EXCEPTIONAL</code>, <code>CANCELLED</code>ï¼‰å’Œä¸€ä¸ª<strong>ä¾èµ–æ ˆ</strong>ï¼ˆæŒ‡å‘æ‰€æœ‰ä¾èµ–äºå®ƒå®Œæˆçš„åç»­é˜¶æ®µï¼‰ã€‚</li>
<li>å½“ä¸€ä¸ªé˜¶æ®µå®Œæˆæ—¶ï¼Œå®ƒä¼šéå†å…¶ä¾èµ–æ ˆï¼Œ<strong>å°è¯•è§¦å‘æ‰€æœ‰åç»­é˜¶æ®µ</strong>çš„æ‰§è¡Œï¼ˆå¯èƒ½ç«‹å³æ‰§è¡Œï¼Œä¹Ÿå¯èƒ½æäº¤åˆ°çº¿ç¨‹æ± ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>éé˜»å¡ä¸äº‹ä»¶é©±åŠ¨ï¼š</strong><ul>
<li>æ•´ä¸ªæµç¨‹æ˜¯<strong>éé˜»å¡</strong>çš„ã€‚è°ƒç”¨ <code>thenXxx</code> åªæ˜¯æ³¨å†Œå›è°ƒï¼Œå¹¶ä¸ç­‰å¾…å‰é©±å®Œæˆã€‚ä¸»çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚</li>
<li>æ‰§è¡Œç”±<strong>å®Œæˆäº‹ä»¶é©±åŠ¨</strong>ï¼šå‰é©±å®Œæˆ -&gt; è§¦å‘å›è°ƒ -&gt; æ‰§è¡Œå›è°ƒé€»è¾‘ -&gt; å®Œæˆåç»§ -&gt; è§¦å‘åç»§çš„å›è°ƒâ€¦ã€‚</li>
</ul>
</li>
<li><strong>ç»„åˆå¤šä¸ª Futureï¼š</strong><ul>
<li>æä¾› <code>allOf()</code>, <code>anyOf()</code> ç­‰é™æ€æ–¹æ³•ï¼Œç”¨äºç»„åˆå¤šä¸ªç‹¬ç«‹çš„ <code>CompletableFuture</code>ï¼š<ul>
<li><code>allOf(futures...)</code>: åˆ›å»ºä¸€ä¸ªæ–°çš„ Futureï¼Œå½“<strong>æ‰€æœ‰</strong>è¾“å…¥ Future å®Œæˆæ—¶ï¼ˆæ— è®ºæˆåŠŸå¤±è´¥ï¼‰ï¼Œå®ƒæ‰å®Œæˆï¼ˆæœ¬èº«æ— ç»“æœï¼Œéœ€æ‰‹åŠ¨è·å–å„Futureç»“æœï¼‰ã€‚</li>
<li><code>anyOf(futures...)</code>: åˆ›å»ºä¸€ä¸ªæ–°çš„ Futureï¼Œå½“<strong>ä»»æ„ä¸€ä¸ª</strong>è¾“å…¥ Future å®Œæˆæ—¶ï¼ˆæ— è®ºæˆåŠŸå¤±è´¥ï¼‰ï¼Œå®ƒå°±å®Œæˆï¼ˆç»“æœæ˜¯æœ€å…ˆå®Œæˆçš„é‚£ä¸ªFutureçš„ç»“æœï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><strong>çº¿ç¨‹æ± æ§åˆ¶ï¼š</strong><ul>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œé“¾å¼è°ƒç”¨ä¸­åç»­ä»»åŠ¡çš„æ‰§è¡Œçº¿ç¨‹ç”±å‰é©±ä»»åŠ¡çš„å®Œæˆçº¿ç¨‹æ‰§è¡Œï¼ˆé€šå¸¸æ˜¯æ‰§è¡Œå‰é©±ä»»åŠ¡çš„çº¿ç¨‹æˆ–è°ƒç”¨ <code>complete</code> çš„çº¿ç¨‹ï¼‰ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨å¸¦æœ‰ <code>Executor</code> å‚æ•°çš„å˜ä½“æ–¹æ³•ï¼ˆå¦‚ <code>thenApplyAsync(func, executor)</code>ï¼‰<strong>æ˜¾å¼æŒ‡å®š</strong>åç»­ä»»åŠ¡åœ¨ç‰¹å®šçš„çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œé¿å…çº¿ç¨‹é¥¥é¥¿æˆ–æ§åˆ¶èµ„æºã€‚</li>
</ul>
</li>
</ol>
<p><strong>äºŒã€ä¸»è¦åº”ç”¨åœºæ™¯</strong></p>
<ol>
<li><p><strong>å¼‚æ­¥ä»»åŠ¡ç¼–æ’ä¸æµæ°´çº¿ï¼š</strong> å°†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘æ‹†åˆ†æˆå¤šä¸ªå¼‚æ­¥æ­¥éª¤ï¼ŒæŒ‰é¡ºåºæˆ–æ¡ä»¶é“¾å¼æ‰§è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture.supplyAsync(() -&gt; fetchUserData(userId), ioPool) <span class="comment">// æ­¥éª¤1ï¼šIOæ“ä½œ</span></span><br><span class="line">    .thenApply(userData -&gt; processData(userData))              <span class="comment">// æ­¥éª¤2ï¼šCPUå¯†é›†å‹å¤„ç†ï¼ˆé»˜è®¤åŒçº¿ç¨‹æˆ–ForkJoinPoolï¼‰</span></span><br><span class="line">    .thenApplyAsync(processedData -&gt; saveToDB(processedData), dbPool) <span class="comment">// æ­¥éª¤3ï¼šå¦ä¸€ä¸ªIOæ“ä½œï¼ŒæŒ‡å®šDBçº¿ç¨‹æ± </span></span><br><span class="line">    .thenAccept(savedResult -&gt; sendNotification(savedResult))  <span class="comment">// æ­¥éª¤4ï¼šæœ€ç»ˆå¤„ç†</span></span><br><span class="line">    .exceptionally(ex -&gt; &#123;                                     <span class="comment">// ç»Ÿä¸€å¼‚å¸¸å¤„ç†</span></span><br><span class="line">        log.error(<span class="string">&quot;Pipeline failed&quot;</span>, ex);</span><br><span class="line">        <span class="keyword">return</span> handleFailure(ex);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å¹¶è¡Œæ‰§è¡Œä¸ç»“æœèšåˆï¼š</strong> åŒæ—¶å‘èµ·å¤šä¸ªç‹¬ç«‹ä»»åŠ¡ï¼Œç­‰æ‰€æœ‰&#x2F;ä»»æ„ä¸€ä¸ªå®Œæˆåå†å¤„ç†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;ResultA&gt; futureA = CompletableFuture.supplyAsync(() -&gt; serviceA.call());</span><br><span class="line">CompletableFuture&lt;ResultB&gt; futureB = CompletableFuture.supplyAsync(() -&gt; serviceB.call());</span><br><span class="line">CompletableFuture&lt;ResultC&gt; futureC = CompletableFuture.supplyAsync(() -&gt; serviceC.call());</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰æ‰€æœ‰ä»»åŠ¡å®Œæˆ</span></span><br><span class="line">CompletableFuture&lt;Void&gt; allFutures = CompletableFuture.allOf(futureA, futureB, futureC);</span><br><span class="line">allFutures.thenRun(() -&gt; &#123;</span><br><span class="line">    <span class="comment">// æ‰‹åŠ¨è·å–å„ä¸ªç»“æœï¼ˆæ­¤æ—¶è‚¯å®šå·²å®Œæˆï¼‰</span></span><br><span class="line">    <span class="type">ResultA</span> <span class="variable">a</span> <span class="operator">=</span> futureA.join(); <span class="comment">// æˆ– get() (éœ€å¤„ç†å¼‚å¸¸)</span></span><br><span class="line">    <span class="type">ResultB</span> <span class="variable">b</span> <span class="operator">=</span> futureB.join();</span><br><span class="line">    <span class="type">ResultC</span> <span class="variable">c</span> <span class="operator">=</span> futureC.join();</span><br><span class="line">    aggregateResults(a, b, c);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰ä»»æ„ä¸€ä¸ªä»»åŠ¡å®Œæˆ</span></span><br><span class="line">CompletableFuture&lt;Object&gt; anyFuture = CompletableFuture.anyOf(futureA, futureB, futureC);</span><br><span class="line">anyFuture.thenAccept(result -&gt; handleFirstResult(result));</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ç»“æœè½¬æ¢ä¸å¤„ç†ï¼š</strong> ä½¿ç”¨ <code>thenApply</code> å°†ä¸Šä¸€æ­¥çš„ç»“æœè½¬æ¢æˆå¦ä¸€ç§å½¢å¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; <span class="string">&quot;123&quot;</span>);</span><br><span class="line">CompletableFuture&lt;Integer&gt; intFuture = future.thenApply(Integer::parseInt);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å‰¯ä½œç”¨æ“ä½œï¼š</strong> ä½¿ç”¨ <code>thenAccept</code> æ¶ˆè´¹ç»“æœä½†ä¸äº§ç”Ÿæ–°ç»“æœï¼ˆå¦‚æ—¥å¿—ã€å‘é€æ¶ˆæ¯ï¼‰ï¼Œæˆ–ä½¿ç”¨ <code>thenRun</code> æ‰§è¡Œä¸ä¾èµ–ç»“æœçš„åŠ¨ä½œã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">future.thenAccept(result -&gt; System.out.println(<span class="string">&quot;Result: &quot;</span> + result));</span><br><span class="line">future.thenRun(() -&gt; cleanupResources());</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>ç»„åˆå¼‚æ­¥ä»»åŠ¡ï¼š</strong></p>
<ul>
<li><code>thenCompose(Function&lt;T, CompletionStage&lt;U&gt;&gt;)</code>: <strong>æ‰å¹³åŒ–</strong>ç»„åˆã€‚å½“å‰ Future å®Œæˆåï¼Œç”¨å…¶ç»“æœä½œä¸ºè¾“å…¥ï¼Œ<strong>å¯åŠ¨å¹¶è¿”å›å¦ä¸€ä¸ª Future</strong> (é¿å…åµŒå¥— <code>CompletableFuture&lt;CompletableFuture&lt;U&gt;&gt;</code>)ã€‚</li>
<li><code>thenCombine(CompletionStage&lt;U&gt;, BiFunction&lt;T, U, V&gt;)</code>: ç­‰å¾…<strong>å½“å‰ Future å’Œå¦ä¸€ä¸ª Future</strong> éƒ½å®Œæˆï¼Œç„¶åç”¨ä¸¤è€…çš„ç»“æœæ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›æ–°çš„ Futureã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// thenCompose ç¤ºä¾‹ (è·å–ç”¨æˆ·åè·å–è®¢å•)</span></span><br><span class="line">CompletableFuture&lt;User&gt; userFuture = getUserAsync(userId);</span><br><span class="line">CompletableFuture&lt;Order&gt; orderFuture = userFuture.thenCompose(user -&gt; getOrdersAsync(user));</span><br><span class="line"></span><br><span class="line"><span class="comment">// thenCombine ç¤ºä¾‹ (å¹¶è¡Œè®¡ç®—ä»·æ ¼å’Œåº“å­˜ï¼Œç„¶åç»„åˆ)</span></span><br><span class="line">CompletableFuture&lt;Price&gt; priceFuture = getPriceAsync(productId);</span><br><span class="line">CompletableFuture&lt;Inventory&gt; inventoryFuture = getInventoryAsync(productId);</span><br><span class="line">CompletableFuture&lt;ProductInfo&gt; productInfoFuture = priceFuture.thenCombine(inventoryFuture,</span><br><span class="line">    (price, inventory) -&gt; <span class="keyword">new</span> <span class="title class_">ProductInfo</span>(price, inventory));</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>å¼‚å¸¸å¤„ç†ï¼š</strong></p>
<ul>
<li><code>exceptionally(Function&lt;Throwable, T&gt;)</code>: æ•è·å¼‚å¸¸å¹¶æä¾›ä¸€ä¸ª<strong>æ¢å¤å€¼</strong>ï¼Œè¿”å›ä¸€ä¸ªæ­£å¸¸å®Œæˆçš„ Futureã€‚</li>
<li><code>handle(BiFunction&lt;T, Throwable, U&gt;)</code>: æ— è®ºæ­£å¸¸å®Œæˆè¿˜æ˜¯å¼‚å¸¸ï¼Œéƒ½ä¼šè¢«è°ƒç”¨ã€‚å¯ä»¥æ£€æŸ¥ç»“æœæˆ–å¼‚å¸¸ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°ç»“æœï¼ˆæˆ–æŠ›å‡ºæ–°å¼‚å¸¸ï¼‰ã€‚</li>
<li><code>whenComplete(BiConsumer&lt;T, Throwable&gt;)</code>: ç±»ä¼¼ <code>handle</code>ï¼Œä½†å®ƒæ˜¯æ¶ˆè´¹è€…ï¼ˆä¸æ”¹å˜ç»“æœï¼‰ï¼Œç”¨äºè®°å½•æ—¥å¿—ã€æ¸…ç†ç­‰ï¼Œè¿”å›ä¸€ä¸ªç»“æœç±»å‹ç›¸åŒçš„ Futureï¼ˆå¼‚å¸¸ä¼šä¼ æ’­ï¼‰ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">future.exceptionally(ex -&gt; defaultValue) <span class="comment">// å¼‚å¸¸æ—¶æä¾›é»˜è®¤å€¼</span></span><br><span class="line">     .handle((result, ex) -&gt; &#123;</span><br><span class="line">         <span class="keyword">if</span> (ex != <span class="literal">null</span>) &#123; <span class="keyword">return</span> fallback; &#125;</span><br><span class="line">         <span class="keyword">else</span> &#123; <span class="keyword">return</span> transform(result); &#125;</span><br><span class="line">     &#125;)</span><br><span class="line">     .whenComplete((result, ex) -&gt; &#123;</span><br><span class="line">         <span class="keyword">if</span> (ex != <span class="literal">null</span>) log.error(<span class="string">&quot;Oops&quot;</span>, ex);</span><br><span class="line">         <span class="keyword">else</span> metrics.recordSuccess();</span><br><span class="line">     &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>è¶…æ—¶æ§åˆ¶ (Java 9+):</strong> ä½¿ç”¨ <code>orTimeout(timeout, timeUnit)</code> æˆ– <code>completeOnTimeout(value, timeout, timeUnit)</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;String&gt; future = someLongRunningTask()</span><br><span class="line">    .orTimeout(<span class="number">5</span>, TimeUnit.SECONDS) <span class="comment">// è¶…æ—¶æŠ›å‡º TimeoutException</span></span><br><span class="line">    .exceptionally(ex -&gt; (ex <span class="keyword">instanceof</span> TimeoutException) ? <span class="string">&quot;Timed out&quot;</span> : <span class="string">&quot;Other error&quot;</span>);</span><br><span class="line"></span><br><span class="line">CompletableFuture&lt;String&gt; future = someLongRunningTask()</span><br><span class="line">    .completeOnTimeout(<span class="string">&quot;Fallback Value&quot;</span>, <span class="number">5</span>, TimeUnit.SECONDS); <span class="comment">// è¶…æ—¶æä¾›é»˜è®¤å€¼</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>ä¸‰ã€å…³é”®ä¼˜åŠ¿</strong></p>
<ol>
<li><strong>éé˜»å¡å¼‚æ­¥ï¼š</strong> æé«˜ç³»ç»Ÿååé‡å’Œå“åº”æ€§ã€‚</li>
<li><strong>å£°æ˜å¼ &amp; é“¾å¼ç¼–ç¨‹ï¼š</strong> ä»£ç æ›´ç®€æ´ã€æ˜“è¯»ã€æ˜“ç»´æŠ¤ï¼Œæ¥è¿‘åŒæ­¥ä»£ç çš„é£æ ¼ï¼ˆé¿å…å›è°ƒåœ°ç‹±ï¼‰ã€‚</li>
<li><strong>å¼ºå¤§çš„ç»„åˆèƒ½åŠ›ï¼š</strong> è½»æ¾ç¼–æ’å¤æ‚å¼‚æ­¥å·¥ä½œæµï¼ˆé¡ºåºã€å¹¶è¡Œã€èšåˆã€æ¡ä»¶ï¼‰ã€‚</li>
<li><strong>çµæ´»çš„å¼‚å¸¸å¤„ç†ï¼š</strong> æä¾›å¤šç§æ–¹å¼å¤„ç†å¼‚æ­¥ç®¡é“ä¸­çš„é”™è¯¯ã€‚</li>
<li><strong>æ˜¾å¼å®Œæˆæ§åˆ¶ï¼š</strong> æ”¯æŒæ‰‹åŠ¨è®¾ç½®ç»“æœï¼Œé€‚åº”æ›´å¤šåœºæ™¯ï¼ˆå¦‚è¶…æ—¶ã€å¤–éƒ¨äº‹ä»¶ï¼‰ã€‚</li>
<li><strong>çº¿ç¨‹æ± é›†æˆï¼š</strong> å¯ç²¾ç»†æ§åˆ¶ä»»åŠ¡æ‰§è¡Œä½ç½®ã€‚</li>
</ol>
<p><strong>å››ã€æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ</strong></p>
<ol>
<li><strong>é¿å…é˜»å¡ï¼š</strong> ä¸è¦åœ¨ <code>CompletableFuture</code> çš„å›è°ƒæ–¹æ³•ï¼ˆå¦‚ <code>thenApply</code>, <code>thenAccept</code> å†…éƒ¨ï¼‰æ‰§è¡Œé•¿æ—¶é—´é˜»å¡æ“ä½œï¼Œè¿™ä¼šå¡ä½æ‰§è¡Œçº¿ç¨‹ï¼ˆå¯èƒ½æ˜¯å…¬å…±çš„ ForkJoinPool çº¿ç¨‹ï¼‰ã€‚ä½¿ç”¨ <code>thenApplyAsync</code> ç­‰å¸¦ <code>Executor</code> çš„æ–¹æ³•å°†é˜»å¡æ“ä½œæäº¤åˆ°ä¸“ç”¨çº¿ç¨‹æ± ã€‚</li>
<li><strong>çº¿ç¨‹æ± é€‰æ‹©ï¼š</strong><ul>
<li>CPU å¯†é›†å‹ä»»åŠ¡ï¼šè€ƒè™‘ä½¿ç”¨ <code>ForkJoinPool.commonPool()</code> (é»˜è®¤) æˆ–å›ºå®šå¤§å°çº¿ç¨‹æ± ï¼ˆçº¿ç¨‹æ•° â‰ˆ CPU æ ¸å¿ƒæ•°ï¼‰ã€‚</li>
<li>IO å¯†é›†å‹ä»»åŠ¡ï¼š<strong>åŠ¡å¿…ä½¿ç”¨</strong> è¶³å¤Ÿå¤§çš„ç¼“å­˜çº¿ç¨‹æ± ï¼ˆå¦‚ <code>Executors.newCachedThreadPool()</code>ï¼‰æˆ–ä¸“é—¨é…ç½®çš„çº¿ç¨‹æ± ï¼Œé¿å…çº¿ç¨‹é¥¥é¥¿ã€‚<strong>å¼ºçƒˆæ¨èä¸ºä¸åŒèµ„æºï¼ˆå¦‚DBã€HTTPï¼‰ä½¿ç”¨ç‹¬ç«‹çº¿ç¨‹æ± ã€‚</strong></li>
</ul>
</li>
<li><strong>å¼‚å¸¸ä¼ æ’­ï¼š</strong> ç†è§£å¼‚å¸¸åœ¨é“¾å¼è°ƒç”¨ä¸­çš„ä¼ æ’­æœºåˆ¶ã€‚å¦‚æœæŸä¸ªé˜¶æ®µæŠ›å‡ºå¼‚å¸¸ä¸”æœªè¢«æ•è·ï¼ˆå¦‚ <code>exceptionally</code>ï¼‰ï¼Œåç»­ä¾èµ–å®ƒçš„ <code>thenApply</code>&#x2F;<code>thenAccept</code> ç­‰<strong>ä¸ä¼šè¢«æ‰§è¡Œ</strong>ï¼Œå¼‚å¸¸ä¼šä¼ é€’åˆ°é“¾çš„æœ«ç«¯æˆ–ç­‰å¾… <code>get()</code>&#x2F;<code>join()</code> æ—¶æŠ›å‡ºã€‚ä½¿ç”¨ <code>handle</code>&#x2F;<code>whenComplete</code>&#x2F;<code>exceptionally</code> å¦¥å–„å¤„ç†ã€‚</li>
<li><strong>ç»“æœè·å–ï¼š</strong><ul>
<li><code>get()</code>: é˜»å¡ç­‰å¾…ç»“æœï¼Œéœ€å¤„ç† <code>InterruptedException</code> å’Œ <code>ExecutionException</code>ï¼ˆå°è£…äº†åŸå§‹å¼‚å¸¸ï¼‰ã€‚</li>
<li><code>join()</code>: ç±»ä¼¼ <code>get()</code>ï¼Œä½†æŠ›å‡ºæœªç»æ£€æŸ¥çš„ <code>CompletionException</code>ï¼ˆå…¶ <code>getCause()</code> æ˜¯åŸå§‹å¼‚å¸¸ï¼‰ã€‚é€šå¸¸åœ¨é“¾çš„æœ«ç«¯æˆ–æ˜ç¡®çŸ¥é“ä¼šå¾ˆå¿«å®Œæˆæ—¶ä½¿ç”¨ã€‚</li>
<li><strong>å°½é‡ä½¿ç”¨å›è°ƒ</strong>ï¼ˆ<code>thenAccept</code>, <code>thenApply</code>, <code>whenComplete</code>ï¼‰è€Œéé˜»å¡è·å–ï¼Œä»¥ä¿æŒéé˜»å¡æ€§ã€‚</li>
</ul>
</li>
<li><strong>èµ„æºæ¸…ç†ï¼š</strong> ä½¿ç”¨ <code>whenComplete</code> æˆ– <code>handle</code> ç¡®ä¿èµ„æºï¼ˆå¦‚æ–‡ä»¶å¥æŸ„ã€ç½‘ç»œè¿æ¥ï¼‰åœ¨ä»»åŠ¡å®Œæˆï¼ˆæ— è®ºæˆåŠŸå¤±è´¥ï¼‰åè¢«æ­£ç¡®å…³é—­ã€‚</li>
<li><strong>é¿å…è¿‡åº¦åµŒå¥—ï¼š</strong> è™½ç„¶é“¾å¼è°ƒç”¨é¿å…å›è°ƒåœ°ç‹±ï¼Œä½†æ·±åº¦åµŒå¥—ä»å¯èƒ½é™ä½å¯è¯»æ€§ã€‚è€ƒè™‘å°†å¤æ‚æ­¥éª¤æŠ½å–æˆç‹¬ç«‹æ–¹æ³•ã€‚</li>
<li><strong>å–æ¶ˆä¼ æ’­ï¼š</strong> <code>CompletableFuture.cancel(true)</code> ä¼šå°è¯•ä¸­æ–­å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä½†<strong>ä¸ä¼šè‡ªåŠ¨å–æ¶ˆå®ƒä¾èµ–çš„æˆ–ä¾èµ–å®ƒçš„å…¶ä»– Future</strong>ã€‚éœ€è¦æ‰‹åŠ¨è®¾è®¡å–æ¶ˆé€»è¾‘ã€‚</li>
</ol>
<p><strong>æ€»ç»“</strong></p>
<p><code>CompletableFuture</code> æ˜¯ Java ç°ä»£å¼‚æ­¥ç¼–ç¨‹çš„åŸºçŸ³ã€‚å®ƒé€šè¿‡<strong>é“¾å¼ç»„åˆ</strong>ã€<strong>éé˜»å¡å›è°ƒ</strong>å’Œ<strong>æ˜¾å¼å®Œæˆ</strong>æœºåˆ¶ï¼Œæä¾›äº†å¼ºå¤§è€Œä¼˜é›…çš„æ–¹å¼æ¥æ„å»ºå¤æ‚ã€é«˜æ•ˆçš„å¼‚æ­¥åº”ç”¨ç¨‹åºã€‚æ·±å…¥ç†è§£å…¶åŸç†ï¼ˆçŠ¶æ€æœºã€ä¾èµ–ç®¡ç†ï¼‰å’Œç†Ÿç»ƒæŒæ¡å…¶ APIï¼ˆ<code>supplyAsync</code>, <code>thenXxx</code>, <code>handle</code>, <code>allOf</code>, <code>anyOf</code>, <code>thenCompose</code>, <code>thenCombine</code>, å¼‚å¸¸å¤„ç†ï¼‰æ˜¯ç¼–å†™é«˜æ€§èƒ½ã€é«˜å“åº”æ€§ Java æœåŠ¡çš„å…³é”®ã€‚åˆç†ä½¿ç”¨çº¿ç¨‹æ± å’Œéµå¾ªæœ€ä½³å®è·µï¼ˆé¿å…é˜»å¡å›è°ƒã€å¦¥å–„å¤„ç†å¼‚å¸¸ã€ç®¡ç†èµ„æºï¼‰è‡³å…³é‡è¦ã€‚</p>
<h3 id="CompletableFuture-å’Œä¼ ç»Ÿçš„-Future-æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#CompletableFuture-å’Œä¼ ç»Ÿçš„-Future-æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="CompletableFuture å’Œä¼ ç»Ÿçš„ Future æœ‰ä»€ä¹ˆåŒºåˆ«"></a><strong><code>CompletableFuture</code> å’Œä¼ ç»Ÿçš„ <code>Future</code> æœ‰ä»€ä¹ˆåŒºåˆ«</strong></h3><ul>
<li>è€ƒå¯Ÿç‚¹ï¼šç†è§£å…¶æ ¸å¿ƒä¼˜åŠ¿ï¼ˆé“¾å¼ç¼–ç¨‹ã€ç»„åˆèƒ½åŠ›ã€æ‰‹åŠ¨å®Œæˆã€å¼‚å¸¸å¤„ç†ï¼‰ã€‚</li>
<li>æœŸæœ›å›ç­”ï¼š<code>Future</code> ä»…æ”¯æŒé˜»å¡è·å–ç»“æœæˆ–è½®è¯¢ï¼Œæ— æ³•ç»„åˆï¼›<code>CompletableFuture</code> å®ç°äº† <code>CompletionStage</code>ï¼Œæ”¯æŒéé˜»å¡å›è°ƒã€ä»»åŠ¡é“¾å¼ç»„åˆã€æ‰‹åŠ¨è®¾ç½®ç»“æœ&#x2F;å¼‚å¸¸ã€æ›´å¼ºå¤§çš„å¼‚å¸¸å¤„ç†ã€‚</li>
</ul>
<h2 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h2><h3 id="ç±»åŠ è½½"><a href="#ç±»åŠ è½½" class="headerlink" title="ç±»åŠ è½½"></a>ç±»åŠ è½½</h3><p>ç±»åŠ è½½çš„è¿‡ç¨‹åŒ…æ‹¬äº†<strong>åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–</strong>äº”ä¸ªé˜¶æ®µã€‚</p>
<h4 id="ç±»åŠ è½½å™¨çš„å±‚æ¬¡ç»“æ„"><a href="#ç±»åŠ è½½å™¨çš„å±‚æ¬¡ç»“æ„" class="headerlink" title="ç±»åŠ è½½å™¨çš„å±‚æ¬¡ç»“æ„"></a>ç±»åŠ è½½å™¨çš„å±‚æ¬¡ç»“æ„</h4><p>ç±»åŠ è½½å™¨å±‚çº§ç»“æ„ï¼š</p>
<table>
<thead>
<tr>
<th><strong>ç±»åŠ è½½å™¨</strong></th>
<th><strong>åŠ è½½è·¯å¾„</strong></th>
<th><strong>çˆ¶åŠ è½½å™¨</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>Bootstrap ClassLoader</strong></td>
<td><code>JRE/lib/rt.jar</code>ç­‰æ ¸å¿ƒåº“</td>
<td>æ— ï¼ˆé¡¶çº§åŠ è½½å™¨ï¼‰</td>
</tr>
<tr>
<td><strong>Extension ClassLoader</strong></td>
<td><code>JRE/lib/ext</code>ç›®å½•ä¸‹æ‰©å±•åº“</td>
<td>Bootstrap</td>
</tr>
<tr>
<td><strong>Application ClassLoader</strong></td>
<td>åº”ç”¨ç±»è·¯å¾„ï¼ˆClassPathï¼‰</td>
<td>Extension</td>
</tr>
<tr>
<td><strong>è‡ªå®šä¹‰ClassLoader</strong></td>
<td>ç”¨æˆ·è‡ªå®šä¹‰è·¯å¾„</td>
<td>Application</td>
</tr>
</tbody></table>
<h4 id="Class-forName-å’ŒClassLoader-loadClass-åŒºåˆ«"><a href="#Class-forName-å’ŒClassLoader-loadClass-åŒºåˆ«" class="headerlink" title="Class.forName()å’ŒClassLoader.loadClass()åŒºåˆ«"></a>Class.forName()å’ŒClassLoader.loadClass()åŒºåˆ«</h4><ul>
<li><code>Class.forName()</code>: å°†ç±»çš„.classæ–‡ä»¶åŠ è½½åˆ°jvmä¸­ä¹‹å¤–ï¼Œè¿˜ä¼šå¯¹ç±»è¿›è¡Œè§£é‡Šï¼Œæ‰§è¡Œç±»ä¸­çš„staticå—ï¼›</li>
<li><code>ClassLoader.loadClass()</code>: åªå¹²ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯å°†.classæ–‡ä»¶åŠ è½½åˆ°jvmä¸­ï¼Œä¸ä¼šæ‰§è¡Œstaticä¸­çš„å†…å®¹,åªæœ‰åœ¨newInstanceæ‰ä¼šå»æ‰§è¡Œstaticå—ã€‚</li>
<li><code>Class.forName(name, initialize, loader)</code>å¸¦å‚å‡½æ•°ä¹Ÿå¯æ§åˆ¶æ˜¯å¦åŠ è½½staticå—ã€‚å¹¶ä¸”åªæœ‰è°ƒç”¨äº†newInstance()æ–¹æ³•é‡‡ç”¨è°ƒç”¨æ„é€ å‡½æ•°ï¼Œåˆ›å»ºç±»çš„å¯¹è±¡ ã€‚</li>
</ul>
<h3 id="å†…å­˜ç»“æ„"><a href="#å†…å­˜ç»“æ„" class="headerlink" title="å†…å­˜ç»“æ„"></a>å†…å­˜ç»“æ„</h3><h4 id="JVMå†…å­˜ç»“æ„"><a href="#JVMå†…å­˜ç»“æ„" class="headerlink" title="JVMå†…å­˜ç»“æ„"></a>JVMå†…å­˜ç»“æ„</h4><table>
<thead>
<tr>
<th><strong>å†…å­˜åŒºåŸŸ</strong></th>
<th><strong>æè¿°</strong></th>
<th><strong>çº¿ç¨‹å…±äº«æ€§</strong></th>
<th><strong>å¼‚å¸¸è§¦å‘æ¡ä»¶</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰</strong></td>
<td>è®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€ï¼Œçº¿ç¨‹ç§æœ‰ï¼Œå”¯ä¸€æ— OOMçš„åŒºåŸŸã€‚</td>
<td>çº¿ç¨‹ç§æœ‰</td>
<td>æ— ï¼ˆä¸ä¼šæŠ›å‡ºå†…å­˜ç›¸å…³å¼‚å¸¸ï¼‰</td>
</tr>
<tr>
<td><strong>è™šæ‹Ÿæœºæ ˆï¼ˆJava Stackï¼‰</strong></td>
<td>å­˜å‚¨æ–¹æ³•è°ƒç”¨çš„æ ˆå¸§ï¼ˆå±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ï¼‰ï¼Œçº¿ç¨‹ç§æœ‰ã€‚</td>
<td>çº¿ç¨‹ç§æœ‰</td>
<td><code>StackOverflowError</code>ï¼ˆæ ˆæ·±åº¦æº¢å‡ºï¼‰ <code>OutOfMemoryError</code>ï¼ˆæ— æ³•æ‰©å±•æ ˆç©ºé—´ï¼‰</td>
</tr>
<tr>
<td><strong>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Stackï¼‰</strong></td>
<td>ä¸ºNativeæ–¹æ³•ï¼ˆå¦‚C&#x2F;C++å®ç°çš„æ–¹æ³•ï¼‰æä¾›æ ˆç©ºé—´ï¼Œçº¿ç¨‹ç§æœ‰ã€‚</td>
<td>çº¿ç¨‹ç§æœ‰</td>
<td>åŒè™šæ‹Ÿæœºæ ˆ</td>
</tr>
<tr>
<td><strong>å †ï¼ˆHeapï¼‰</strong></td>
<td>å­˜æ”¾å¯¹è±¡å®ä¾‹å’Œæ•°ç»„ï¼Œæ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œæ˜¯åƒåœ¾å›æ”¶çš„ä¸»è¦åŒºåŸŸã€‚</td>
<td>çº¿ç¨‹å…±äº«</td>
<td><code>OutOfMemoryError</code>ï¼ˆå †å†…å­˜ä¸è¶³ï¼‰</td>
</tr>
<tr>
<td><strong>æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰</strong></td>
<td>å­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ä»£ç ç­‰æ•°æ®ã€‚JDK 8åç”±å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰å®ç°ã€‚</td>
<td>çº¿ç¨‹å…±äº«</td>
<td><code>OutOfMemoryError</code>ï¼ˆå…ƒç©ºé—´&#x2F;æ–¹æ³•åŒºå†…å­˜ä¸è¶³ï¼‰</td>
</tr>
</tbody></table>
<h4 id="ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè§¦å‘StackOverflowErrorå’ŒOutOfMemoryError"><a href="#ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè§¦å‘StackOverflowErrorå’ŒOutOfMemoryError" class="headerlink" title="ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè§¦å‘StackOverflowErrorå’ŒOutOfMemoryError"></a>ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè§¦å‘StackOverflowErrorå’ŒOutOfMemoryError</h4><p><strong>è§¦å‘StackOverflowError</strong></p>
<ul>
<li><p><strong>æ— é™é€’å½’</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class StackOverflowExample &#123;</span><br><span class="line">    public static void recursiveMethod() &#123;</span><br><span class="line">        recursiveMethod(); // æ— é™é€’å½’è°ƒç”¨</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        recursiveMethod(); // è§¦å‘StackOverflowError</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯æ¬¡æ–¹æ³•è°ƒç”¨éƒ½ä¼šåœ¨è™šæ‹Ÿæœºæ ˆä¸­å‹å…¥æ–°æ ˆå¸§ï¼Œè¶…å‡ºæ ˆçš„æœ€å¤§æ·±åº¦é™åˆ¶ï¼ˆé»˜è®¤1MBï¼Œå¯é€šè¿‡<code>-Xss</code>è°ƒæ•´ï¼‰ã€‚</p>
</li>
<li><p>æ ˆå¸§è¿‡å¤§ï¼ˆå±€éƒ¨å˜é‡è¿‡å¤šæˆ–æ–¹æ³•æ“ä½œæ•°æ ˆè¿‡æ·±ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public void largeMethod() &#123;</span><br><span class="line">    int a1, a2, a3, ..., a10000; // å¤§é‡å±€éƒ¨å˜é‡å ç”¨æ ˆç©ºé—´</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å•ä¸ªæ ˆå¸§å ç”¨çš„å†…å­˜è¶…è¿‡æ ˆå®¹é‡ã€‚</p>
</li>
</ul>
<p><strong>è§¦å‘OutOfMemoryError</strong></p>
<ul>
<li><p><strong>å †å†…å­˜æº¢å‡º</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// ä¸æ–­åˆ›å»ºå¤§å¯¹è±¡ï¼Œè€—å°½å †å†…å­˜</span><br><span class="line">List&lt;byte[]&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">while (true) &#123;</span><br><span class="line">    list.add(new byte[1024 * 1024]); // æ¯æ¬¡åˆ†é…1MB</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>åŸå› </strong>ï¼šå¯¹è±¡æ•°é‡è¶…è¿‡å †å®¹é‡ï¼ˆå¯é€šè¿‡<code>-Xmx</code>å’Œ<code>-Xms</code>è°ƒæ•´å †å¤§å°ï¼‰ã€‚</p>
<p><strong>å…¸å‹åœºæ™¯</strong>ï¼šå†…å­˜æ³„æ¼ï¼ˆå¦‚é™æ€é›†åˆæœªé‡Šæ”¾å¯¹è±¡ï¼‰æˆ–åˆç†å†…å­˜ä¸è¶³ã€‚</p>
</li>
<li><p><strong>æ–¹æ³•åŒº&#x2F;å…ƒç©ºé—´æº¢å‡º</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// åŠ¨æ€ç”Ÿæˆå¤§é‡ç±»ï¼ˆå¦‚ä½¿ç”¨CGLIBï¼‰</span><br><span class="line">public class MetaspaceOOM &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Enhancer enhancer = new Enhancer();</span><br><span class="line">        enhancer.setSuperclass(OOMObject.class);</span><br><span class="line">        enhancer.setCallback((MethodInterceptor) (obj, method, args1, proxy) -&gt; proxy.invokeSuper(obj, args1));</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            enhancer.create(); // æŒç»­ç”Ÿæˆä»£ç†ç±»</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    static class OOMObject &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>åŸå› </strong>ï¼šåŠ è½½çš„ç±»æ•°é‡æˆ–å…ƒæ•°æ®é‡è¶…è¿‡å…ƒç©ºé—´å®¹é‡ï¼ˆé€šè¿‡<code>-XX:MaxMetaspaceSize</code>è®¾ç½®ä¸Šé™ï¼‰ã€‚</p>
<p><strong>å…¸å‹åœºæ™¯</strong>ï¼šåŠ¨æ€ä»£ç†æ¡†æ¶ï¼ˆå¦‚Spring AOPï¼‰ã€åå°„æ»¥ç”¨ã€‚</p>
</li>
<li><p><strong>è™šæ‹Ÿæœºæ ˆæˆ–æœ¬åœ°æ–¹æ³•æ ˆæ— æ³•æ‰©å±•</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// å¯åŠ¨å¤§é‡çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹çš„æ ˆç©ºé—´æ— æ³•åˆ†é…</span><br><span class="line">public class ThreadOOM &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            new Thread(() -&gt; &#123;</span><br><span class="line">                try &#123; Thread.sleep(1000000); &#125; catch (InterruptedException e) &#123;&#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>åŸå› </strong>ï¼šçº¿ç¨‹æ•°é‡è¿‡å¤šå¯¼è‡´æ ˆæ€»å†…å­˜è¶…è¿‡ç³»ç»Ÿé™åˆ¶ï¼ˆé€šè¿‡<code>-Xss</code>å‡å°‘å•ä¸ªçº¿ç¨‹æ ˆå¤§å°ï¼‰ã€‚</p>
</li>
</ul>
<p><strong>æ€»ç»“</strong></p>
<table>
<thead>
<tr>
<th><strong>é”™è¯¯ç±»å‹</strong></th>
<th><strong>è§¦å‘åœºæ™¯</strong></th>
<th><strong>å…¸å‹åŸå› </strong></th>
<th><strong>è§£å†³æ–¹æ¡ˆ</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>StackOverflowError</strong></td>
<td>é€’å½’è°ƒç”¨æœªç»ˆæ­¢ã€æ ˆå¸§è¿‡å¤§</td>
<td>ä»£ç é€»è¾‘é”™è¯¯</td>
<td>ä¿®å¤é€’å½’ç»ˆæ­¢æ¡ä»¶ï¼Œå‡å°‘å±€éƒ¨å˜é‡æ•°é‡</td>
</tr>
<tr>
<td><strong>OutOfMemoryError</strong></td>
<td>å †å†…å­˜ä¸è¶³ã€å…ƒç©ºé—´æº¢å‡ºã€çº¿ç¨‹æ•°è¿‡å¤š</td>
<td>å†…å­˜æ³„æ¼ã€é…ç½®ä¸å½“ã€èµ„æºè€—å°½</td>
<td>è°ƒæ•´JVMå‚æ•°ï¼Œä¼˜åŒ–ä»£ç ï¼Œå¢åŠ ç‰©ç†å†…å­˜</td>
</tr>
</tbody></table>
<h4 id="æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´çš„åŒºåˆ«"><a href="#æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´çš„åŒºåˆ«" class="headerlink" title="æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´çš„åŒºåˆ«"></a>æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´çš„åŒºåˆ«</h4><h4 id="å †å†…å­˜æ˜¯æ€ä¹ˆç»†åˆ†çš„"><a href="#å †å†…å­˜æ˜¯æ€ä¹ˆç»†åˆ†çš„" class="headerlink" title="å †å†…å­˜æ˜¯æ€ä¹ˆç»†åˆ†çš„"></a>å †å†…å­˜æ˜¯æ€ä¹ˆç»†åˆ†çš„</h4><h3 id="åƒåœ¾å›æ”¶"><a href="#åƒåœ¾å›æ”¶" class="headerlink" title="åƒåœ¾å›æ”¶"></a>åƒåœ¾å›æ”¶</h3><h4 id="å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶"><a href="#å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶" class="headerlink" title="å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶"></a>å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶</h4><p><strong>å¼•ç”¨è®¡æ•°æ³•</strong></p>
<p><strong>å¯è¾¾æ€§åˆ†ææ³•</strong></p>
<p>åœ¨ Java ä¸­ ä»¥ä¸‹å¯¹è±¡å¯ä½œä¸º GC Rootsï¼š</p>
<ul>
<li>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</li>
<li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li>
<li>æ–¹æ³•åŒºä¸­çš„å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li>
</ul>
<h4 id="æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•"><a href="#æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•"></a>æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•</h4><table>
<thead>
<tr>
<th>ç®—æ³•</th>
<th>æ­¥éª¤</th>
<th>ç‰¹ç‚¹</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td><strong>æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰</strong></td>
<td>1. <strong>æ ‡è®°</strong>ï¼šéå†æ‰€æœ‰å¯¹è±¡ï¼Œæ ‡è®°å­˜æ´»å¯¹è±¡ã€‚ 2. <strong>æ¸…é™¤</strong>ï¼šå›æ”¶æœªè¢«æ ‡è®°çš„å¯¹è±¡ï¼ˆåƒåœ¾ï¼‰ã€‚</td>
<td><strong>ä¼˜ç‚¹</strong>ï¼šå®ç°ç®€å•ï¼Œä¸éœ€è¦ç§»åŠ¨å¯¹è±¡ã€‚ <strong>ç¼ºç‚¹</strong>ï¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œå¯èƒ½è§¦å‘é¢‘ç¹çš„ Full GCã€‚</td>
<td>1. è€å¹´ä»£å›æ”¶ï¼ˆå¦‚ CMS æ”¶é›†å™¨çš„åˆå§‹é˜¶æ®µï¼‰ã€‚ 2. å¯¹å†…å­˜ç¢ç‰‡ä¸æ•æ„Ÿçš„åœºæ™¯ï¼Œæˆ–çŸ­æœŸè¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚</td>
</tr>
<tr>
<td><strong>å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰</strong></td>
<td>1. å°†å†…å­˜åˆ†ä¸ºä¸¤å—ï¼ˆFrom å’Œ Toï¼‰ï¼Œå¯¹è±¡åˆ†é…åœ¨ From åŒºã€‚ 2. æ ‡è®°å­˜æ´»å¯¹è±¡ï¼Œå°†å…¶å¤åˆ¶åˆ° To åŒºã€‚ 3. æ¸…ç©º From åŒºï¼Œäº¤æ¢ From å’Œ To çš„è§’è‰²ã€‚</td>
<td><strong>ä¼˜ç‚¹</strong>ï¼šæ— å†…å­˜ç¢ç‰‡ï¼Œå›æ”¶é«˜æ•ˆã€‚ <strong>ç¼ºç‚¹</strong>ï¼šå†…å­˜åˆ©ç”¨ç‡ä½ï¼ˆéœ€é¢„ç•™ä¸€åŠç©ºé—´ï¼‰ã€‚</td>
<td>1. æ–°ç”Ÿä»£å›æ”¶ï¼ˆå¦‚ Serialã€ParNewã€Parallel Scavenge ç­‰æ”¶é›†å™¨ï¼‰ã€‚ 2. é€‚ç”¨äºå¯¹è±¡å­˜æ´»ç‡ä½çš„åœºæ™¯ï¼ˆå¦‚æ–°ç”Ÿä»£ Eden åŒºï¼‰ã€‚</td>
</tr>
<tr>
<td><strong>æ ‡è®°-æ•´ç†ï¼ˆMark-Compactï¼‰</strong></td>
<td><strong>æ ‡è®°</strong>ï¼šéå†æ‰€æœ‰å¯¹è±¡ï¼Œæ ‡è®°å­˜æ´»å¯¹è±¡ã€‚ <strong>æ•´ç†</strong>ï¼šå°†å­˜æ´»å¯¹è±¡å‘å†…å­˜ä¸€ç«¯ç§»åŠ¨ï¼Œæ¸…ç†è¾¹ç•Œå¤–çš„ç©ºé—´ã€‚</td>
<td><strong>ä¼˜ç‚¹</strong>ï¼šé¿å…å†…å­˜ç¢ç‰‡ï¼Œé€‚åˆé•¿æœŸè¿è¡Œçš„ç³»ç»Ÿã€‚ <strong>ç¼ºç‚¹</strong>ï¼šç§»åŠ¨å¯¹è±¡éœ€è¦æ—¶é—´ï¼Œå¯¼è‡´åœé¡¿è¾ƒé•¿ï¼ˆSTWï¼‰ã€‚</td>
<td>1. è€å¹´ä»£å›æ”¶ï¼ˆå¦‚ Serial Oldã€Parallel Old æ”¶é›†å™¨ï¼‰ã€‚ 2. å¯¹å†…å­˜æ•æ„Ÿä¸”éœ€è¦é¿å…ç¢ç‰‡çš„åœºæ™¯ï¼ˆå¦‚å¤§æ•°æ®åº”ç”¨ï¼‰ã€‚</td>
</tr>
</tbody></table>
<h4 id="CMSæ”¶é›†å™¨å·¥ä½œåŸç†"><a href="#CMSæ”¶é›†å™¨å·¥ä½œåŸç†" class="headerlink" title="CMSæ”¶é›†å™¨å·¥ä½œåŸç†"></a>CMSæ”¶é›†å™¨å·¥ä½œåŸç†</h4><h4 id="G1æ”¶é›†å™¨å·¥ä½œåŸç†"><a href="#G1æ”¶é›†å™¨å·¥ä½œåŸç†" class="headerlink" title="G1æ”¶é›†å™¨å·¥ä½œåŸç†"></a>G1æ”¶é›†å™¨å·¥ä½œåŸç†</h4><h1 id="æ•°æ®å­˜å‚¨"><a href="#æ•°æ®å­˜å‚¨" class="headerlink" title="æ•°æ®å­˜å‚¨"></a>æ•°æ®å­˜å‚¨</h1><h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><h3 id="æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œé¡ºåº"><a href="#æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œé¡ºåº" class="headerlink" title="æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œé¡ºåº"></a>æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œé¡ºåº</h3><p>MySQL åˆ†ä¸º server å±‚å’Œå­˜å‚¨å¼•æ“å±‚ã€‚</p>
<p>server å±‚æ¶µç›– MySQL å¤§å¤šæ•°æ ¸å¿ƒåŠŸèƒ½ï¼ˆå¦‚å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ç­‰ï¼‰å’Œæ‰€æœ‰å†…ç½®å‡½æ•°ï¼ˆå¦‚æ—¥æœŸã€æ—¶é—´ã€æ•°å­¦å‡½æ•°ç­‰ï¼‰ã€‚</p>
<p>å­˜å‚¨å¼•æ“å±‚è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œæå–ã€‚</p>
<p><code>from</code> -&gt; <code>where</code> -&gt; <code>group by</code> -&gt; <code>having</code> -&gt; <code>select</code> -&gt; <code>distinct</code> -&gt; <code>order by</code> -&gt; <code>limit</code></p>
<img src="/post/65a5b0d7/1726212535664-4bb3f3ff-704a-4706-84c8-a046a8486657.webp" class="" title="img">

<h3 id="InnoDBç´¢å¼•ç»“æ„"><a href="#InnoDBç´¢å¼•ç»“æ„" class="headerlink" title="InnoDBç´¢å¼•ç»“æ„"></a>InnoDBç´¢å¼•ç»“æ„</h3><p>Bæ ‘ç»“æ„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">       [10 | 20]</span><br><span class="line">      /    |     \</span><br><span class="line">[5|8]  [12|15|18]  [25|30]</span><br></pre></td></tr></table></figure>

<p>ç‰¹å¾ï¼š</p>
<ul>
<li>æ‰€æœ‰èŠ‚ç‚¹éƒ½å­˜å‚¨å®Œæ•´æ•°æ®</li>
<li>æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåŒ…æ¶µ m-1 ä¸ªé”®å€¼å’Œ m ä¸ªå­èŠ‚ç‚¹</li>
</ul>
<p>B+æ ‘ç»“æ„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">               [15]</span><br><span class="line">              /    \</span><br><span class="line">     [10|15]          [20|25]</span><br><span class="line">     /     \          /     \ </span><br><span class="line">[10|...]â†’[15|...]â†’[20|...]â†’[25|...]ï¼ˆå¶å­èŠ‚ç‚¹é“¾è¡¨ï¼‰</span><br></pre></td></tr></table></figure>

<p>ç‰¹å¾ï¼š</p>
<ul>
<li>åªæœ‰å¶å­èŠ‚ç‚¹å­˜å‚¨å®Œæ•´æ•°æ®ï¼Œå†…éƒ¨èŠ‚ç‚¹åªå­˜å‚¨ç´¢å¼•</li>
<li>å¶å­èŠ‚ç‚¹é€šè¿‡åŒå‘é“¾è¡¨è¿æ¥ï¼Œæ”¯æŒé«˜æ•ˆèŒƒå›´æŸ¥è¯¢</li>
<li>ç›¸åŒç£ç›˜é¡µå¯ä»¥å­˜å‚¨æ›´å¤šç´¢å¼•ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡</li>
</ul>
<p><strong>InnoDBé€‰æ‹©B+æ ‘çš„7å¤§å…³é”®åŸå› </strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>å¯¹æ¯”ç»´åº¦</strong></th>
<th align="left"><strong>Bæ ‘</strong></th>
<th align="left"><strong>B+æ ‘</strong></th>
<th align="left"><strong>InnoDBä¼˜åŠ¿ä½“ç°</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>æ•°æ®å­˜å‚¨ä½ç½®</strong></td>
<td align="left">æ‰€æœ‰èŠ‚ç‚¹å­˜å‚¨æ•°æ®</td>
<td align="left">ä»…å¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®</td>
<td align="left">å‡å°‘ç£ç›˜IOæ¬¡æ•°</td>
</tr>
<tr>
<td align="left"><strong>æ ‘é«˜åº¦</strong></td>
<td align="left">è¾ƒé«˜ï¼ˆæ•°æ®åˆ†æ•£å­˜å‚¨ï¼‰</td>
<td align="left">è¾ƒä½ï¼ˆå†…éƒ¨èŠ‚ç‚¹çº¯ç´¢å¼•ï¼‰</td>
<td align="left">3å±‚B+æ ‘å¯æ”¯æ’‘åƒä¸‡çº§æ•°æ®</td>
</tr>
<tr>
<td align="left"><strong>èŒƒå›´æŸ¥è¯¢</strong></td>
<td align="left">éœ€è¦å›æº¯çˆ¶èŠ‚ç‚¹</td>
<td align="left">é€šè¿‡å¶å­é“¾è¡¨é¡ºåºæ‰«æ</td>
<td align="left"><code>WHERE id &gt; 100</code> æ•ˆç‡æå‡10å€+</td>
</tr>
<tr>
<td align="left"><strong>å…¨è¡¨æ‰«æ</strong></td>
<td align="left">éœ€éå†æ•´æ£µæ ‘</td>
<td align="left">ç›´æ¥é¡ºåºéå†å¶å­èŠ‚ç‚¹é“¾è¡¨</td>
<td align="left">å…¨è¡¨æ‰«æé€Ÿåº¦æ¥è¿‘é¡ºåºè¯»</td>
</tr>
<tr>
<td align="left"><strong>ç£ç›˜åˆ©ç”¨ç‡</strong></td>
<td align="left">èŠ‚ç‚¹åŒ…å«æ•°æ®å¯¼è‡´å­˜å‚¨é”®å€¼æ•°å°‘</td>
<td align="left">å•é¡µå¯å­˜å‚¨æ›´å¤šé”®å€¼ï¼ˆé«˜åˆ†æ”¯å› å­ï¼‰</td>
<td align="left">ç›¸åŒæ•°æ®é‡å‡å°‘30%-50%æ ‘é«˜åº¦</td>
</tr>
<tr>
<td align="left"><strong>æ•°æ®æ›´æ–°ä»£ä»·</strong></td>
<td align="left">å¯èƒ½å¼•èµ·å¤æ‚ç»“æ„è°ƒæ•´</td>
<td align="left">æ’å…¥åˆ é™¤å¤šæ•°æƒ…å†µåªéœ€å±€éƒ¨è°ƒæ•´</td>
<td align="left">æ”¯æŒæ›´é«˜å¹¶å‘å†™å…¥</td>
</tr>
<tr>
<td align="left"><strong>ç¼“å­˜å‘½ä¸­ç‡</strong></td>
<td align="left">çƒ­ç‚¹æ•°æ®åˆ†æ•£åœ¨ä¸åŒå±‚çº§</td>
<td align="left">å¶å­èŠ‚ç‚¹é›†ä¸­å­˜å‚¨æ‰€æœ‰æ•°æ®</td>
<td align="left">Buffer Poolåˆ©ç”¨ç‡æå‡40%+</td>
</tr>
</tbody></table>
<h3 id="ä¸ºä»€ä¹ˆMongoDBä½¿ç”¨Bæ ‘è€ŒMySQLç”¨B-æ ‘"><a href="#ä¸ºä»€ä¹ˆMongoDBä½¿ç”¨Bæ ‘è€ŒMySQLç”¨B-æ ‘" class="headerlink" title="ä¸ºä»€ä¹ˆMongoDBä½¿ç”¨Bæ ‘è€ŒMySQLç”¨B+æ ‘"></a>ä¸ºä»€ä¹ˆMongoDBä½¿ç”¨Bæ ‘è€ŒMySQLç”¨B+æ ‘</h3><p>MongoDBé¢å‘æ–‡æ¡£å­˜å‚¨ï¼Œéœ€å¿«é€Ÿè·å–æ•´ä¸ªæ–‡æ¡£ï¼ˆBæ ‘çš„å†…éƒ¨èŠ‚ç‚¹å­˜å‚¨å®Œæ•´æ•°æ®ï¼Œå¯ä»¥å‡å°‘å¯»å€æ¬¡æ•°ï¼‰</p>
<p>MySQLä¾§é‡èŒƒå›´æŸ¥è¯¢å’Œäº‹åŠ¡å¤„ç†ï¼ˆB+æ ‘çš„é¡ºåºè®¿é—®ç‰¹æ€§æ›´ä¼˜ç§€ï¼‰</p>
<h3 id="B-æ ‘èŠ‚ç‚¹åˆ†è£‚çš„å…·ä½“è¿‡ç¨‹"><a href="#B-æ ‘èŠ‚ç‚¹åˆ†è£‚çš„å…·ä½“è¿‡ç¨‹" class="headerlink" title="B+æ ‘èŠ‚ç‚¹åˆ†è£‚çš„å…·ä½“è¿‡ç¨‹"></a>B+æ ‘èŠ‚ç‚¹åˆ†è£‚çš„å…·ä½“è¿‡ç¨‹</h3><p>InnoDBä¼˜åŒ–ï¼šé¢„ç•™1&#x2F;16é¡µç©ºé—´é¿å…é¢‘ç¹åˆ†è£‚</p>
<p><strong>ç´¢å¼•è®¾è®¡åŸåˆ™</strong></p>
<ul>
<li>å‰ç¼€ç´¢å¼•ä¼˜åŒ–</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ADD</span> INDEX (name(<span class="number">10</span>));</span><br></pre></td></tr></table></figure>

<ul>
<li>è¦†ç›–ç´¢å¼•ä¼˜åŒ–</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºåŒ…å«æ‰€æœ‰æŸ¥è¯¢å­—æ®µçš„ç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_cover <span class="keyword">ON</span> orders(user_id, status, create_time);</span><br></pre></td></tr></table></figure>



<p><strong>ç›‘æ§å·¥å…·ä½¿ç”¨</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sys.schema_index_statistics;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ†æç´¢å¼•æ•ˆç‡</span></span><br><span class="line">EXPLAIN ANALYZE <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> category_id<span class="operator">=</span><span class="number">5</span>;</span><br></pre></td></tr></table></figure>



<p><strong>ç»´æŠ¤ç­–ç•¥</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å®šæœŸä¼˜åŒ–è¡¨ï¼ˆé‡å»ºç´¢å¼•ï¼‰</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> orders ENGINE<span class="operator">=</span>InnoDB;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç›‘æ§é¡µåˆ†è£‚æ¬¡æ•°</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Innodb_page_splits%&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h3 id="EXPLAIN-å­—æ®µè¯´æ˜"><a href="#EXPLAIN-å­—æ®µè¯´æ˜" class="headerlink" title="EXPLAIN å­—æ®µè¯´æ˜"></a><code>EXPLAIN</code> å­—æ®µè¯´æ˜</h3><p>é€šå¸¸<code>EXPALIN</code>æŸ¥è¯¢è¯­å¥çš„è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="comment">// æ¯ä¸ªselectè¯­å¥å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„id</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢ç±»å‹ï¼š</span></span><br><span class="line"><span class="comment">     * SIMPLEï¼šä¸åŒ…å«UNIONæˆ–å­æŸ¥è¯¢çš„selectï¼ˆè¿æ¥æŸ¥è¯¢çš„æ¯ä¸ªæŸ¥è¯¢éƒ½æ˜¯simpleæŸ¥è¯¢ï¼‰</span></span><br><span class="line"><span class="comment">     * PRIMARYï¼šæœ€å¤–å±‚æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * UNION</span></span><br><span class="line"><span class="comment">     * ...</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">&quot;select_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SIMPLE&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;table&quot;</span><span class="punctuation">:</span> <span class="string">&quot;users&quot;</span><span class="punctuation">,</span> <span class="comment">// è¦æŸ¥è¯¢çš„è¡¨</span></span><br><span class="line">    <span class="attr">&quot;partitions&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// åˆ†åŒºä¿¡æ¯</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é’ˆå¯¹å•è¡¨çš„è®¿é—®æ–¹æ³•ï¼š</span></span><br><span class="line"><span class="comment">     * systemï¼šå½“è¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•ï¼Œå¹¶ä¸”è¯¥è¡¨ä½¿ç”¨çš„å­˜å‚¨å¼•æ“çš„ç»Ÿè®¡æ•°æ®æ˜¯ç²¾ç¡®çš„ï¼Œè®¿é—®æ–¹æ³•å°±æ˜¯system</span></span><br><span class="line"><span class="comment">     * constantï¼šæ ¹æ®ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•åˆ—ä¸å¸¸æ•°è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ï¼Œè®¿é—®æ–¹æ³•å°±æ˜¯const</span></span><br><span class="line"><span class="comment">     * eq_refï¼šè¿æ¥æŸ¥è¯¢ä¸­å¯¹è¢«é©±åŠ¨è¡¨çš„ä¸»é”®æˆ–ä¸å…è®¸ä¸ºNULLçš„å”¯ä¸€ç´¢å¼•è¿›è¡Œç­‰å€¼æŸ¥è¯¢æ—¶ï¼Œè®¿é—®æ–¹æ³•å°±æ˜¯eq_ref</span></span><br><span class="line"><span class="comment">     * refï¼šé€šè¿‡æ™®é€šäºŒçº§ç´¢å¼•åˆ—ä¸å¸¸é‡è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ï¼Œå¯¹è¯¥è¡¨çš„è®¿é—®æ–¹æ³•å°±æ˜¯ ref</span></span><br><span class="line"><span class="comment">     * ref_or_nullï¼šselect * from single_table where key1 = &#x27;abc&#x27; or key1 is NULL;</span></span><br><span class="line"><span class="comment">     * index_mergeï¼šä½¿ç”¨å¤šä¸ªç´¢å¼•è¿›è¡Œç­‰å€¼åŒ¹é…</span></span><br><span class="line"><span class="comment">     * unique_subqueryï¼šåœ¨å­æŸ¥è¯¢ä¸­ä½¿ç”¨ä¸»é”®æˆ–ä¸å…è®¸å­˜å‚¨NULLå€¼çš„å”¯ä¸€äºŒçº§ç´¢å¼•è¿›è¡Œç­‰å€¼åŒ¹é…</span></span><br><span class="line"><span class="comment">     * index_subqueryï¼šåœ¨å­æŸ¥è¯¢ä¸­ä½¿ç”¨æ™®é€šäºŒçº§ç´¢å¼•è¿›è¡Œç­‰å€¼åŒ¹</span></span><br><span class="line"><span class="comment">     * rangeï¼šåˆ©ç”¨ç´¢å¼•è¿›è¡ŒèŒƒå›´æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * indexï¼šå½“å¯ä»¥ä½¿ç”¨ç´¢å¼•è¦†ç›–ï¼Œä½†éœ€è¦æ‰«æå…¨éƒ¨ç´¢å¼•è®°å½•</span></span><br><span class="line"><span class="comment">     * allï¼šå…¨è¡¨æ‰«æ</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ref&quot;</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;possible_keys&quot;</span><span class="punctuation">:</span> <span class="string">&quot;idx_composite&quot;</span><span class="punctuation">,</span> <span class="comment">// å¯èƒ½ä½¿ç”¨çš„ç´¢å¼•</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;idx_composite&quot;</span><span class="punctuation">,</span> <span class="comment">// å®é™…ä½¿ç”¨çš„ç´¢å¼•</span></span><br><span class="line">    <span class="attr">&quot;key_len&quot;</span><span class="punctuation">:</span> <span class="string">&quot;208&quot;</span><span class="punctuation">,</span> <span class="comment">// å®é™…ä½¿ç”¨çš„ç´¢å¼•é•¿åº¦</span></span><br><span class="line">    <span class="attr">&quot;ref&quot;</span><span class="punctuation">:</span> <span class="string">&quot;const&quot;</span><span class="punctuation">,</span> <span class="comment">// ä½¿ç”¨ç´¢å¼•åˆ—ç­‰å€¼æŸ¥è¯¢æ—¶ï¼Œä¸ç´¢å¼•åˆ—è¿›è¡Œç­‰å€¼åŒ¹é…çš„å¯¹è±¡ä¿¡æ¯</span></span><br><span class="line">    <span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="comment">// é¢„ä¼°éœ€è¦è¯»å–çš„è®°å½•è¡Œæ•°</span></span><br><span class="line">    <span class="attr">&quot;filtered&quot;</span><span class="punctuation">:</span> <span class="number">100.0</span><span class="punctuation">,</span> <span class="comment">// è¿‡æ»¤åå‰©ä½™è®°å½•è¡Œæ•°ç™¾åˆ†æ¯”</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é¢å¤–ä¿¡æ¯ï¼š</span></span><br><span class="line"><span class="comment">     * Using indexï¼šä½¿ç”¨è¦†ç›–ç´¢å¼•</span></span><br><span class="line"><span class="comment">     * Using index conditionï¼šä½¿ç”¨ç´¢å¼•æ¡ä»¶ä¸‹æ¨</span></span><br><span class="line"><span class="comment">     * Using whereï¼šéœ€è¦åœ¨serverå±‚åˆ¤æ–­æ¡ä»¶æ˜¯å¦æˆç«‹</span></span><br><span class="line"><span class="comment">     * Using join bufferï¼šæ‰§è¡Œè¿æ¥æŸ¥è¯¢æ—¶ï¼Œè¢«é©±åŠ¨è¡¨ä¸èƒ½æœ‰æ•ˆåˆ©ç”¨ç´¢å¼•åŠ å¿«è®¿é—®é€Ÿåº¦æ—¶ï¼Œä¼šåˆ†é…ä¸€å—å†…å­˜ç”¨æ¥ä¿å­˜è¢«é©±åŠ¨è¡¨çš„æŸ¥è¯¢ç»“æœï¼Œ</span></span><br><span class="line"><span class="comment">     					  åˆ©ç”¨join bufferå¯ä»¥å‡å°‘è®¿é—®è¢«é©±åŠ¨è¡¨çš„æ¬¡æ•°</span></span><br><span class="line"><span class="comment">     * Using filesortï¼š</span></span><br><span class="line"><span class="comment">     * Using temporary</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">&quot;Extra&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Using index&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<h3 id="è¦†ç›–ç´¢å¼•ä¸æœ€å·¦å‰ç¼€åŸåˆ™å®æˆ˜æ¡ˆä¾‹"><a href="#è¦†ç›–ç´¢å¼•ä¸æœ€å·¦å‰ç¼€åŸåˆ™å®æˆ˜æ¡ˆä¾‹" class="headerlink" title="è¦†ç›–ç´¢å¼•ä¸æœ€å·¦å‰ç¼€åŸåˆ™å®æˆ˜æ¡ˆä¾‹"></a>è¦†ç›–ç´¢å¼•ä¸æœ€å·¦å‰ç¼€åŸåˆ™å®æˆ˜æ¡ˆä¾‹</h3><p><strong>å›è¡¨</strong>ï¼šæŸ¥è¯¢éœ€è¦çš„å­—æ®µæ²¡æœ‰å…¨éƒ¨åŒ…å«åœ¨ç´¢å¼•ä¸­ï¼Œéœ€è¦æ ¹æ®ç´¢å¼•æ‰¾åˆ°ä¸»é”®ï¼Œå†ä»ä¸»é”®ç´¢å¼•ä¸­æ‰¾åˆ°å®Œæ•´æ•°æ®æ‰èƒ½è·å–æ‰€éœ€å­—æ®µã€‚</p>
<p><strong>è¦†ç›–ç´¢å¼•</strong>ï¼šæŸ¥è¯¢æ‰€éœ€çš„å­—æ®µéƒ½åŒ…å«åœ¨ç´¢å¼•ä¸­ï¼Œæ— éœ€å›è¡¨æ“ä½œã€‚</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>å‡å°‘IOæ“ä½œ</li>
<li>é¿å…å›è¡¨ï¼ˆå‡å°‘éšæœºè¯»ï¼‰</li>
</ul>
<p><strong>æœ€å·¦å‰ç¼€åŸåˆ™</strong>ï¼šå¤åˆç´¢å¼• <code>(a, b, c)</code> çš„æŸ¥è¯¢æ¡ä»¶å¿…é¡»ä»æœ€å·¦åˆ—å¼€å§‹ï¼Œä¸”ä¸èƒ½è·³è¿‡ä¸­é—´åˆ—æ‰èƒ½å‘½ä¸­ç´¢å¼•ã€‚</p>
<p>å…·ä½“è§„åˆ™ï¼š</p>
<ul>
<li>ç­‰å€¼æŸ¥è¯¢ï¼š<code>WHERE a = 1 and b = 2</code> â†’ å‘½ä¸­ç´¢å¼•</li>
<li>èŒƒå›´æŸ¥è¯¢ï¼š<code>WHERE a &gt; 1 and b = 2</code> â†’ ä»…èƒ½å‘½ä¸­ <code>a</code> åˆ—</li>
<li>è·³è·ƒæŸ¥è¯¢ï¼š<code>WHERE b = 2 and c = 3</code> â†’ ä¸èƒ½èƒ½å‘½ä¸­ç´¢å¼•</li>
</ul>
<p>è¦†ç›–ç´¢å¼•ä¼˜åŒ–ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `users` (</span><br><span class="line">	`id` <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">	`name` <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">	`age` <span class="type">INT</span>,</span><br><span class="line">	`city` <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">	`created_at` DATETIME,</span><br><span class="line">	KEY `idx_composite` (`city`, `age`, `created_at`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢éœ€æ±‚ï¼šç»Ÿè®¡åŒ—äº¬25å²ç”¨æˆ·çš„æ•°é‡</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> city<span class="operator">=</span><span class="string">&#x27;åŒ—äº¬&#x27;</span> <span class="keyword">AND</span> age<span class="operator">=</span><span class="number">25</span>;</span><br></pre></td></tr></table></figure>

<img src="/post/65a5b0d7/image-20250302111116621.png" class="" title="image-20250302111116621">

<p>ä¹‹å‰çš„ç‰ˆæœ¬<code>Extra</code>ä¸­åº”è¯¥æ˜¯<code>Using where</code>ï¼Œå› ä¸ºéœ€è¦å›è¡¨ç¡®è®¤æ•°æ®æ˜¯å¦å­˜åœ¨ã€‚</p>
<p>ä¼˜åŒ–æ–¹æ¡ˆï¼šæ·»åŠ è¦†ç›–ç´¢å¼•è¦†ç›–ç»Ÿè®¡éœ€è¦çš„æ‰€æœ‰å­—æ®µ</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> users <span class="keyword">ADD</span> INDEX idx_covering(city, age, id);</span><br></pre></td></tr></table></figure>

<p>æœ€å·¦å‰ç¼€ç´¢å¼•ä¼˜åŒ–</p>
<p>æŸ¥è¯¢éœ€æ±‚ï¼šæŸ¥è¯¢åŒ—äº¬åœ°åŒºå¹´é¾„å¤§äº 30 å²çš„ç”¨æˆ·ï¼Œå¹¶æŒ‰æ³¨å†Œæ—¶é—´æ’åº</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> city<span class="operator">=</span><span class="string">&#x27;åŒ—äº¬&#x27;</span> <span class="keyword">AND</span> age<span class="operator">&gt;</span> <span class="number">30</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> created_at LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<img src="/post/65a5b0d7/image-20250302111551681.png" class="" title="image-20250302111551681">

<p>ä»<code>EXPLAIN</code>ç»“æœå¯ä»¥çœ‹å‡ºï¼Œè¿™æ¡æŸ¥è¯¢è¯­å¥éœ€è¦ç”¨åˆ°è€—æ—¶çš„æ–‡ä»¶æ’åºï¼Œè¿™æ˜¯å› ä¸ºæŸ¥è¯¢æ¡ä»¶ä¸­å­˜åœ¨èŒƒå›´æŸ¥è¯¢ï¼Œå¯¼è‡´ä¸èƒ½å®Œå…¨åˆ©ç”¨ä¸Šç»„åˆç´¢å¼•ã€‚</p>
<p>ä¼˜åŒ–æ–¹æ¡ˆï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> users <span class="keyword">ADD</span> INDEX idx_city_created_age(city, created_at, age);</span><br></pre></td></tr></table></figure>

<img src="/post/65a5b0d7/image-20250302112330725.png" class="" title="image-20250302112330725">



<p>ç´¢å¼•è®¾è®¡è§„èŒƒï¼š</p>
<ul>
<li>ç»„åˆç´¢å¼•å­—æ®µæŒ‰åŒºåˆ†åº¦ä»é«˜åˆ°ä½æ’åº</li>
<li>ç´¢å¼•åˆ—æ•°â‰¤5åˆ—ï¼Œé¿å…æ›´æ–°å¼€é”€å¤ªå¤§</li>
<li>ç¦æ­¢<code>SELECT *</code>ï¼Œå°½é‡æŸ¥è¯¢ç´¢å¼•èƒ½è¦†ç›–çš„å­—æ®µ</li>
</ul>
<h3 id="æ…¢æŸ¥è¯¢ä¼˜åŒ–"><a href="#æ…¢æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="æ…¢æŸ¥è¯¢ä¼˜åŒ–"></a>æ…¢æŸ¥è¯¢ä¼˜åŒ–</h3><p>æ…¢æŸ¥è¯¢ä¼˜åŒ–æµç¨‹ï¼š</p>
<ol>
<li>æŠ“å–æ…¢æ—¥å¿—ï¼š<code>long_query_time=1s</code></li>
<li><code>EXPLAIN</code> åˆ†ææ‰§è¡Œè®¡åˆ’</li>
<li>æ£€æŸ¥ç´¢å¼•ä½¿ç”¨æƒ…å†µ<ul>
<li>æ˜¯å¦è§¦å‘è¦†ç›–ç´¢å¼•</li>
<li>æ˜¯å¦è¿åæœ€å·¦å‰ç¼€åŸåˆ™</li>
</ul>
</li>
<li>ä½¿ç”¨<code>force index</code>éªŒè¯ç´¢å¼•æœ‰æ•ˆæ€§</li>
<li>è°ƒæ•´ç´¢å¼•æˆ–SQLå†™æ³•</li>
</ol>
<ul>
<li>ç´¢å¼•ä¼˜åŒ–</li>
<li>ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œé¿å…å›è¡¨</li>
<li>æœ€å·¦å‰ç¼€åŒ¹é…ï¼Œ</li>
</ul>
<p>ç›‘æ§æŒ‡æ ‡</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨é¢‘ç‡</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sys.schema_index_statistics <span class="keyword">WHERE</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ£€æŸ¥å†—ä½™ç´¢å¼•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sys.schema_redundant_indexes;</span><br></pre></td></tr></table></figure>



<h3 id="ä¸ºä»€ä¹ˆInnoDBä¸ä¿å­˜è¡¨çš„æ€»è¡Œæ•°"><a href="#ä¸ºä»€ä¹ˆInnoDBä¸ä¿å­˜è¡¨çš„æ€»è¡Œæ•°" class="headerlink" title="ä¸ºä»€ä¹ˆInnoDBä¸ä¿å­˜è¡¨çš„æ€»è¡Œæ•°"></a>ä¸ºä»€ä¹ˆInnoDBä¸ä¿å­˜è¡¨çš„æ€»è¡Œæ•°</h3><p>ä¸MyISAMä¿å­˜è¡¨çš„æ€»è¡Œæ•°ä¸åŒï¼ŒInnoDBç»Ÿè®¡è¡Œæ•°éœ€è¦æ‰«æå…¨è¡¨ï¼Œå› ä¸ºMVCCï¼ŒåŒä¸€æ—¶åˆ»å¤šä¸ªæŸ¥è¯¢è¿”å›çš„è¡Œæ•°å¯èƒ½ä¸ä¸€è‡´ã€‚</p>
<p>å¯¹äºéœ€è¦ç»å¸¸ç»Ÿè®¡è¡¨çš„è¡Œæ•°çš„è§£å†³åŠæ³•ï¼š</p>
<ul>
<li>åœ¨ç¼“å­˜ï¼ˆå¦‚ Redisï¼‰ä¸­ä¿å­˜è®¡æ•°</li>
<li>åœ¨ MySQL ä¸­ä¿å­˜è®¡æ•°</li>
</ul>
<table>
<thead>
<tr>
<th><strong>è¯­æ³•</strong></th>
<th><strong>ç»Ÿè®¡é€»è¾‘</strong></th>
<th><strong>æ˜¯å¦åŒ…å« NULL</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>COUNT(*)</code></td>
<td>ç»Ÿè®¡æ‰€æœ‰è¡Œï¼ˆåŒ…æ‹¬æ‰€æœ‰åˆ—ï¼‰ï¼Œå³ä½¿æ‰€æœ‰å­—æ®µéƒ½ä¸º <code>NULL</code> ä¹Ÿä¼šè®¡æ•°</td>
<td><strong>åŒ…å«</strong></td>
</tr>
<tr>
<td><code>COUNT(1)</code></td>
<td>ç»Ÿè®¡æ‰€æœ‰è¡Œï¼ˆ<code>1</code> æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œä¸åˆ—æ— å…³ï¼‰</td>
<td><strong>åŒ…å«</strong></td>
</tr>
<tr>
<td><code>COUNT(id)</code></td>
<td>ç»Ÿè®¡ <code>id</code> åˆ—ä¸­ <strong>é NULL</strong> çš„è¡Œæ•°ï¼ˆ<code>id</code> æ˜¯ä¸»é”®æˆ–æ™®é€šåˆ—ï¼‰</td>
<td><strong>ä¸åŒ…å« NULL</strong></td>
</tr>
<tr>
<td><code>COUNT(æŸä¸ªå­—æ®µ)</code></td>
<td>ç»Ÿè®¡è¯¥å­—æ®µä¸­ <strong>é NULL</strong> çš„è¡Œæ•°ï¼ˆå¦‚æœå­—æ®µå…è®¸ <code>NULL</code>ï¼‰</td>
<td><strong>ä¸åŒ…å« NULL</strong></td>
</tr>
</tbody></table>
<p>æ€§èƒ½ï¼š<code>count(å­—æ®µ)</code> &lt; <code>count(ä¸»é”®)</code> &lt; <code>count(1)</code> â‰ˆ <code>count(*)</code></p>
<p><code>count(ä¸»é”®/å­—æ®µ)</code> çš„æ•ˆç‡æ›´ä½çš„åŸå› æ˜¯éœ€è¦è§£ææ•°æ®è¡Œï¼Œå¹¶æ‹·è´è¦è¿”å›çš„å­—æ®µå€¼ã€‚</p>
<h3 id="è§£é‡Šä¸€ä¸‹äº‹åŠ¡çš„åŸºæœ¬ç‰¹æ€§å’Œéš”ç¦»çº§åˆ«"><a href="#è§£é‡Šä¸€ä¸‹äº‹åŠ¡çš„åŸºæœ¬ç‰¹æ€§å’Œéš”ç¦»çº§åˆ«" class="headerlink" title="è§£é‡Šä¸€ä¸‹äº‹åŠ¡çš„åŸºæœ¬ç‰¹æ€§å’Œéš”ç¦»çº§åˆ«"></a>è§£é‡Šä¸€ä¸‹äº‹åŠ¡çš„åŸºæœ¬ç‰¹æ€§å’Œéš”ç¦»çº§åˆ«</h3><p>äº‹åŠ¡ä¿è¯ä¸€ç»„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚åœ¨ MySQL ä¸­ï¼Œäº‹åŠ¡æ”¯æŒæ˜¯åœ¨å¼•æ“å±‚å®ç°çš„ã€‚</p>
<table>
<thead>
<tr>
<th>åŸºæœ¬ç‰¹æ€§</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>åŸå­æ€§ï¼ˆ<code>atomicity</code>ï¼‰</td>
<td>äº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆå…¨éƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ</td>
</tr>
<tr>
<td>ä¸€è‡´æ€§ï¼ˆ<code>consistency</code>ï¼‰</td>
<td>äº‹åŠ¡çš„æ‰§è¡Œè¦ä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§</td>
</tr>
<tr>
<td>éš”ç¦»æ€§ï¼ˆ<code>isolation</code>ï¼‰</td>
<td>äº‹åŠ¡çš„æ‰§è¡Œäº’ä¸å¹²æ‰°</td>
</tr>
<tr>
<td>æŒä¹…æ€§ï¼ˆ<code>durability</code>ï¼‰</td>
<td>äº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ°¸ä¹…ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œä¸å¯æ’¤é”€</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>äº‹åŠ¡å¯èƒ½å¼•å‘çš„é—®é¢˜</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>è„è¯»</td>
<td>A äº‹åŠ¡è¯»å– B äº‹åŠ¡å°šæœªæäº¤çš„ä¿®æ”¹</td>
</tr>
<tr>
<td>ä¸å¯é‡å¤è¯»</td>
<td>A äº‹åŠ¡å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®ï¼Œç»“æœå‰åä¸ä¸€è‡´</td>
</tr>
<tr>
<td>å¹»è¯»</td>
<td>A äº‹åŠ¡å¤šæ¬¡è¯»å–ï¼Œæ•°æ®æ€»é‡å‰åä¸ä¸€è‡´</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>éš”ç¦»çº§åˆ«</th>
<th>è¯´æ˜</th>
<th>è„è¯»</th>
<th>ä¸å¯é‡å¤è¯»</th>
<th>å¹»è¯»</th>
</tr>
</thead>
<tbody><tr>
<td><code>read uncommitted</code></td>
<td>ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œèƒ½çœ‹åˆ°å…¶ä»–æœªæäº¤äº‹åŠ¡åšçš„å˜æ›´</td>
<td>âœ“</td>
<td>âœ“</td>
<td>âœ“</td>
</tr>
<tr>
<td><code>read committed</code></td>
<td>ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œèƒ½çœ‹åˆ°å…¶ä»–å·²æäº¤äº‹åŠ¡åšçš„å˜æ›´ï¼ˆMySQL ä¼šåœ¨æ¯ä¸ª SQL è¯­å¥å¼€å§‹æ‰§è¡Œæ—¶åˆ›å»ºä¸€ä¸ªè§†å›¾ï¼‰</td>
<td></td>
<td>âœ“</td>
<td>âœ“</td>
</tr>
<tr>
<td><code>repeatable read</code></td>
<td>ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…¶ä»–äº‹åŠ¡çš„å˜æ›´å¯¹å®ƒä¸å¯è§ï¼ˆMySQL ä¼šåœ¨äº‹åŠ¡å¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ªè§†å›¾ï¼Œæ•´ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´éƒ½ä½¿ç”¨è¿™ä¸ªè§†å›¾ï¼‰</td>
<td></td>
<td></td>
<td>âœ“</td>
</tr>
<tr>
<td><code>serializable</code></td>
<td>äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œéš”ç¦»çº§åˆ«æœ€é«˜ï¼Œä¸ä¼šå‡ºç°ä¸Šé¢æ‰€è¯´çš„é—®é¢˜ï¼Œä½†ç›¸åº”çš„æ•ˆç‡ä¹Ÿæœ€ä½</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="InnoDBå¦‚ä½•è§£å†³å¹»è¯»"><a href="#InnoDBå¦‚ä½•è§£å†³å¹»è¯»" class="headerlink" title="InnoDBå¦‚ä½•è§£å†³å¹»è¯»"></a>InnoDBå¦‚ä½•è§£å†³å¹»è¯»</h3><p>InnoDBè§£å†³å¹»è¯»ä¸»è¦é ä»¥ä¸‹ä¸‰å¤§æ ¸å¿ƒæœºåˆ¶ï¼š</p>
<ul>
<li>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆ<code>MVCC</code>ï¼‰</li>
<li>é—´éš™é”ï¼ˆ<code>Gap Lock</code>ï¼‰</li>
<li>ä¸´é”®é”ï¼ˆ<code>Next-Key Lock</code>ï¼‰</li>
</ul>
<p><strong><code>MVCC</code>å®ç°åŸç†ï¼š</strong></p>
<ul>
<li><code>Undo log</code>ï¼šæ¯æ¡æ•°æ®ç»´æŠ¤å¤šä¸ªå†å²ç‰ˆæœ¬</li>
<li><code>ReadView</code>ï¼šå¿«ç…§</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ReadViewç»“æ„ï¼š</span><br><span class="line">&#123;</span><br><span class="line">  creator_trx_id: 150,      -- å½“å‰äº‹åŠ¡ID</span><br><span class="line">  m_ids: [100, 120, 140],   -- æ´»è·ƒäº‹åŠ¡IDåˆ—è¡¨</span><br><span class="line">  min_trx_id: 100,          -- æœ€å°æ´»è·ƒäº‹åŠ¡ID</span><br><span class="line">  max_trx_id: 150           -- é¢„åˆ†é…æœ€å¤§äº‹åŠ¡ID</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å¯è§æ€§åˆ¤æ–­è§„åˆ™</strong>ï¼š</p>
<ol>
<li>æ•°æ®ç‰ˆæœ¬<code>trx_id</code> &lt; <code>min_trx_id</code> â†’ å¯è§</li>
<li><code>trx_id</code>åœ¨<code>m_ids</code>ä¸­ â†’ ä¸å¯è§</li>
<li><code>trx_id</code> &gt;&#x3D; <code>max_trx_id</code> â†’ ä¸å¯è§</li>
</ol>
<p>InnoDBé»˜è®¤ä¼šä¸ºæ¯è¡Œæ•°æ®ç”Ÿæˆä¸¤ä¸ªéšè—åˆ—ï¼š</p>
<ul>
<li><code>DB_TRX_ID</code>ï¼šæœ€åä¿®æ”¹è¯¥è¡Œçš„äº‹åŠ¡ID</li>
<li><code>DB_ROLL_PTR</code>ï¼šæŒ‡å‘<code>Undo Log</code>çš„å›æ»šæŒ‡é’ˆ</li>
</ul>
<p>ä¸åŒéš”ç¦»çº§åˆ«ä¸‹<code>ReadView</code>çš„ç”Ÿæˆæ—¶æœºï¼š</p>
<ul>
<li><code>READ COMMITTED(RC)</code>ï¼šæ¯æ¬¡<code>SELECT</code>éƒ½ä¼šåˆ›å»ºæ–°çš„<code>ReadView</code></li>
<li><code>REPEATABLE READ(RR)</code>ï¼šäº‹åŠ¡ä¸­ç¬¬ä¸€æ¬¡<code>SELECT</code>æ—¶åˆ›å»º<code>ReadView</code></li>
</ul>
<p><strong>é—´éš™é”ï¼ˆ<code>Gap Lock</code>ï¼‰</strong></p>
<p>é”å®šè®°å½•ä¹‹é—´çš„é—´éš™ï¼Œä¸é”å®šè®°å½•æœ¬èº«ã€‚é˜²æ­¢å¹»è¯»ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è¡¨æ•°æ®ï¼š5, 10, 15</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">10</span> <span class="keyword">AND</span> id <span class="operator">&lt;</span> <span class="number">20</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure>

<p>è¿™æ¡è¯­å¥ä¼šé”å®šåŒºé—´ <code>(10,15)</code>ã€<code>(15,+âˆ)</code>ï¼Œåœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œå…¶ä»–äº‹åŠ¡æ— æ³•åœ¨è¿™ä¸¤ä¸ªåŒºé—´æ’å…¥æ•°æ®</p>
<p><strong>ä¸´é”®é”ï¼ˆ<code>Next-Key Lock</code>ï¼‰</strong></p>
<p>é”å®šè®°å½•æœ¬èº«åŠä¹‹å‰çš„é—´éš™ã€‚åŒæ—¶é˜²æ­¢å¹»è¯»å’Œä¸å¯é‡å¤è¯»ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- äº‹åŠ¡Aæ‰§è¡Œï¼š</span><br><span class="line">SELECT * FROM users WHERE id &gt; 15 AND id &lt; 25 FOR UPDATE;</span><br><span class="line">-- å‡è®¾å­˜åœ¨id=20çš„è®°å½•ï¼Œä¸´é”®é”ä¼šé”å®šï¼š(15,20],(20,+âˆ)</span><br></pre></td></tr></table></figure>



<p><strong>Q1ï¼šRRéš”ç¦»çº§åˆ«å¦‚ä½•æ—¢ä½¿ç”¨MVCCåˆç”¨é”ï¼Ÿ</strong></p>
<ul>
<li><strong>å¿«ç…§è¯»</strong>ï¼ˆæ™®é€šSELECTï¼‰ï¼šä¾èµ–MVCCä¿è¯ä¸€è‡´æ€§</li>
<li><strong>å½“å‰è¯»</strong>ï¼ˆSELECT FOR UPDATEï¼‰ï¼šä½¿ç”¨ä¸´é”®é”ä¿è¯ç‰©ç†æ•°æ®ä¸€è‡´</li>
</ul>
<p><strong>Q2ï¼šGap Lockæ˜¯å¦ä¼šå¯¼è‡´æ­»é”ï¼Ÿ</strong></p>
<p>é—´éš™é”æ˜¯æœ‰å¯èƒ½å¯¼è‡´æ­»é”çš„ï¼Œå¦‚ï¼šäº‹åŠ¡Aé”(5,10)ï¼Œäº‹åŠ¡Bé”(10,15)ï¼Œä¸¤è€…åŒæ—¶è¯·æ±‚å¯¹æ–¹åŒºé—´çš„æ’å…¥</p>
<p>è§£å†³æ–¹æ¡ˆï¼šè®¾ç½®<code>innodb_deadlock_detect=ON</code>ï¼ˆé»˜è®¤å¼€å¯æ£€æµ‹ï¼‰</p>
<p><strong>Q3ï¼šPurgeçº¿ç¨‹çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p>æ¸…ç†ä¸å†è¢«ä»»ä½•äº‹åŠ¡éœ€è¦çš„<code>Undo Log</code>ï¼Œå›æ”¶ç‰ˆæœ¬é“¾ä¸­çš„è¿‡æœŸæ•°æ®ç‰ˆæœ¬</p>
<h3 id="InnoDBå’ŒMyISAMçš„åŒºåˆ«"><a href="#InnoDBå’ŒMyISAMçš„åŒºåˆ«" class="headerlink" title="InnoDBå’ŒMyISAMçš„åŒºåˆ«"></a>InnoDBå’ŒMyISAMçš„åŒºåˆ«</h3><table>
<thead>
<tr>
<th></th>
<th>MyISAM</th>
<th>InnoDB</th>
</tr>
</thead>
<tbody><tr>
<td>é”</td>
<td>è¡¨çº§é”</td>
<td>è¡Œçº§é”</td>
</tr>
<tr>
<td>äº‹åŠ¡æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
<tr>
<td>ç´¢å¼•ç»“æ„</td>
<td>Bæ ‘</td>
<td>B+æ ‘</td>
</tr>
<tr>
<td>å…¨æ–‡æ£€ç´¢</td>
<td>æ”¯æŒ</td>
<td>5.5ç‰ˆæœ¬åæ”¯æŒ</td>
</tr>
</tbody></table>
<p>æ€»ä½“æ¥è¯´ï¼Œå¦‚æœéœ€è¦æ”¯æŒäº‹åŠ¡ã€å¤–é”®çº¦æŸå’Œé«˜å¹¶å‘è®¿é—®ï¼Œé‚£ä¹ˆInnoDBæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚å¦‚æœéœ€è¦è¿›è¡Œå…¨æ–‡æ£€ç´¢ï¼Œé‚£ä¹ˆMyISAMæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMySQL 5.5ç‰ˆæœ¬ä¹‹åï¼ŒInnoDBå·²ç»æ”¯æŒäº†å…¨æ–‡æ£€ç´¢ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆæœ‰æ—¶ç´¢å¼•ä¼šå¤±æ•ˆæˆ–é€‰é”™ç´¢å¼•"><a href="#ä¸ºä»€ä¹ˆæœ‰æ—¶ç´¢å¼•ä¼šå¤±æ•ˆæˆ–é€‰é”™ç´¢å¼•" class="headerlink" title="ä¸ºä»€ä¹ˆæœ‰æ—¶ç´¢å¼•ä¼šå¤±æ•ˆæˆ–é€‰é”™ç´¢å¼•"></a>ä¸ºä»€ä¹ˆæœ‰æ—¶ç´¢å¼•ä¼šå¤±æ•ˆæˆ–é€‰é”™ç´¢å¼•</h3><p>ç´¢å¼•å¤±æ•ˆçš„å¸¸è§åœºæ™¯ï¼š</p>
<ul>
<li>è¿åæœ€å·¦å‰ç¼€åŸåˆ™</li>
<li>å¯¹ç´¢å¼•åˆ—è¿›è¡Œè¿ç®—æˆ–å‡½æ•°æ“ä½œ</li>
<li>ä½¿ç”¨ <code>or</code> è¿æ¥éç´¢å¼•åˆ—</li>
<li>ç´¢å¼•åˆ—å­˜åœ¨å¤§é‡é‡å¤å€¼ï¼Œå¦‚æ€§åˆ«</li>
<li>ä½¿ç”¨ <code>like &#39;%åœ°å€&#39;</code></li>
</ul>
<p>é€‰é”™ç´¢å¼•çš„å¸¸è§åŸå› ï¼š</p>
<ul>
<li><p>ç»Ÿè®¡ä¿¡æ¯ä¸å‡†ç¡®ï¼šä¼˜åŒ–å™¨ä¾èµ–çš„ç»Ÿè®¡ä¿¡æ¯ï¼ˆå¦‚ <code>cardinality</code>ï¼‰è¿‡æ—¶ï¼Œè¯¯åˆ¤ç´¢å¼•æ•ˆç‡ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- è¡¨æ•°æ®åˆ†å¸ƒå·²å˜åŒ–ï¼Œä½†ç»Ÿè®¡ä¿¡æ¯æœªæ›´æ–°</span><br><span class="line">ANALYZE TABLE users; -- æ‰‹åŠ¨æ›´æ–°ç»Ÿè®¡ä¿¡æ¯</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç´¢å¼•è¦†ç›–ä¸è¶³ï¼šç´¢å¼•æœªè¦†ç›–æŸ¥è¯¢æ‰€éœ€å­—æ®µï¼Œå¯¼è‡´å›è¡¨æˆæœ¬è¿‡é«˜ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç´¢å¼• (a) æ— æ³•è¦†ç›– SELECT *</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> <span class="number">1</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä½¿ç”¨è¦†ç›–ç´¢å¼•</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">table</span> <span class="keyword">ADD</span> INDEX idx_a_b_c (a, b, c);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢"><a href="#å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢" class="headerlink" title="å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢"></a>å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢</h3><ol>
<li>ç¼–å†™é«˜æ•ˆçš„æŸ¥è¯¢è¯­å¥ï¼šåˆç†ç¼–å†™æŸ¥è¯¢è¯­å¥æ˜¯æŸ¥è¯¢ä¼˜åŒ–çš„åŸºç¡€ã€‚é¿å…ä½¿ç”¨å¤æ‚çš„åµŒå¥—æŸ¥è¯¢å’Œå­æŸ¥è¯¢ï¼Œå°½é‡ä½¿ç”¨ç®€å•çš„æŸ¥è¯¢è¯­å¥ï¼›é¿å…ä½¿ç”¨è¿‡å¤šçš„é€šé…ç¬¦ï¼Œå°½é‡æŒ‡å®šå…·ä½“çš„æŸ¥è¯¢æ¡ä»¶ï¼›ä½¿ç”¨åˆé€‚çš„è¿æ¥æ–¹å¼ï¼Œå¦‚INNER JOINã€LEFT JOINã€RIGHT JOINç­‰ï¼›é¿å…ä½¿ç”¨ä¸å¿…è¦çš„æ’åºå’Œåˆ†ç»„ã€‚</li>
<li>ä½¿ç”¨ç´¢å¼•ï¼šåˆç†ä½¿ç”¨ç´¢å¼•å¯ä»¥æ˜¾è‘—æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­é¢‘ç¹ä½¿ç”¨çš„åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œé¿å…åœ¨å¤§è¡¨ä¸Šè¿›è¡Œå…¨è¡¨æ‰«æã€‚</li>
<li>é¿å…ä½¿ç”¨SELECT *ï¼šåœ¨æŸ¥è¯¢æ—¶ï¼Œé¿å…ä½¿ç”¨SELECT *ï¼Œè€Œæ˜¯åªé€‰æ‹©éœ€è¦çš„åˆ—ã€‚è¿™æ ·å¯ä»¥å‡å°‘æ•°æ®åº“ä¼ è¾“å’Œå¤„ç†çš„æ•°æ®é‡ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li>
<li>ä¼˜åŒ–å­æŸ¥è¯¢å’ŒåµŒå¥—æŸ¥è¯¢ï¼šå­æŸ¥è¯¢å’ŒåµŒå¥—æŸ¥è¯¢å¯èƒ½å¯¼è‡´æŸ¥è¯¢æ€§èƒ½ä¸‹é™ï¼Œå°½é‡é¿å…åœ¨æŸ¥è¯¢ä¸­å¤šæ¬¡åµŒå¥—å­æŸ¥è¯¢ã€‚å¯ä»¥è€ƒè™‘ä½¿ç”¨è¿æ¥ï¼ˆJOINï¼‰æ“ä½œã€ä¸´æ—¶è¡¨ç­‰æ›¿ä»£å­æŸ¥è¯¢ï¼Œä»è€Œä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ã€‚</li>
<li>ä½¿ç”¨åˆé€‚çš„æ•°æ®ç±»å‹ï¼šåœ¨æ•°æ®åº“è®¾è®¡å’ŒæŸ¥è¯¢ä¸­ï¼Œä½¿ç”¨åˆé€‚çš„æ•°æ®ç±»å‹å¯ä»¥é¿å…æ•°æ®ç±»å‹è½¬æ¢å’Œéšå¼è½¬æ¢ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæ•´æ•°ç±»å‹çš„åˆ—ï¼Œä½¿ç”¨æ•´æ•°ç±»å‹çš„æ•°æ®è€Œä¸æ˜¯å­—ç¬¦ç±»å‹çš„æ•°æ®ï¼Œå¯ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li>
</ol>
<h3 id="ä¸ºä»€ä¹ˆæœ‰æ—¶åªæŸ¥è¯¢ä¸€è¡Œä½†æ˜¯å¾ˆæ…¢"><a href="#ä¸ºä»€ä¹ˆæœ‰æ—¶åªæŸ¥è¯¢ä¸€è¡Œä½†æ˜¯å¾ˆæ…¢" class="headerlink" title="ä¸ºä»€ä¹ˆæœ‰æ—¶åªæŸ¥è¯¢ä¸€è¡Œä½†æ˜¯å¾ˆæ…¢"></a>ä¸ºä»€ä¹ˆæœ‰æ—¶åªæŸ¥è¯¢ä¸€è¡Œä½†æ˜¯å¾ˆæ…¢</h3><ol>
<li>æ•°æ®åº“è¡¨ä¸­æ•°æ®é‡å¢åŠ ï¼šéšç€è¡¨ä¸­æ•°æ®é‡çš„å¢åŠ ï¼ŒæŸ¥è¯¢ä¸€è¡Œçš„æ—¶é—´å¯èƒ½ä¼šå˜å¾—æ›´é•¿ã€‚</li>
<li>ç´¢å¼•å¤±æ•ˆï¼šå¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­ä½¿ç”¨çš„åˆ—æ²¡æœ‰ç´¢å¼•ï¼Œæˆ–è€…ç´¢å¼•å¤±æ•ˆï¼ˆä¾‹å¦‚ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯è¿‡æœŸæˆ–è€…ç´¢å¼•æŸåï¼‰ï¼Œæ•°æ®åº“å¯èƒ½ä¼šæ‰§è¡Œå…¨è¡¨æ‰«ææˆ–è€…å…¶ä»–ä½æ•ˆçš„æŸ¥è¯¢æ–¹æ³•ï¼Œä»è€Œå¯¼è‡´æŸ¥è¯¢ä¸€è¡Œçš„æ€§èƒ½ä¸‹é™ã€‚</li>
<li>æŸ¥è¯¢å¤æ‚åº¦å¢åŠ ï¼šå¦‚æœæŸ¥è¯¢çš„å¤æ‚åº¦å¢åŠ ï¼Œä¾‹å¦‚æ¶‰åŠåˆ°å¤šä¸ªè¡¨çš„è”æ¥ã€å­æŸ¥è¯¢ã€èšåˆå‡½æ•°ç­‰ï¼ŒæŸ¥è¯¢ä¸€è¡Œçš„æ€§èƒ½å¯èƒ½ä¼šå—åˆ°å½±å“ã€‚</li>
<li>æ•°æ®åº“æœåŠ¡å™¨è´Ÿè½½å¢åŠ ï¼šå¦‚æœæ•°æ®åº“æœåŠ¡å™¨è´Ÿè½½å¢åŠ ï¼Œä¾‹å¦‚åŒæ—¶æœ‰å¤§é‡çš„æŸ¥è¯¢å’Œå†™å…¥æ“ä½œï¼Œæ•°æ®åº“çš„æ€§èƒ½å¯èƒ½ä¼šä¸‹é™ï¼Œä»è€Œå¯¼è‡´æŸ¥è¯¢ä¸€è¡Œå˜å¾—å¾ˆæ…¢ã€‚</li>
</ol>
<h3 id="æ…¢SQLä¼˜åŒ–å…¨æµç¨‹"><a href="#æ…¢SQLä¼˜åŒ–å…¨æµç¨‹" class="headerlink" title="æ…¢SQLä¼˜åŒ–å…¨æµç¨‹"></a>æ…¢SQLä¼˜åŒ–å…¨æµç¨‹</h3><p><strong>é˜¶æ®µ1ï¼šé—®é¢˜å®šä½ä¸æ•°æ®é‡‡é›†</strong></p>
<ul>
<li>å¼€å¯æ…¢æ—¥å¿—æŸ¥è¯¢</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åŠ¨æ€å¼€å¯ï¼ˆé‡å¯å¤±æ•ˆï¼‰</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> long_query_time <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- é˜ˆå€¼è®¾ä¸º1ç§’</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log_file <span class="operator">=</span> <span class="string">&#x27;/var/log/mysql/slow.log&#x27;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- æ°¸ä¹…é…ç½®ï¼ˆmy.cnfï¼‰</span><br><span class="line">[mysqld]</span><br><span class="line">slow_query_log = 1</span><br><span class="line">long_query_time = 1</span><br><span class="line">log_queries_not_using_indexes = 1  -- è®°å½•æœªèµ°ç´¢å¼•çš„æŸ¥è¯¢</span><br></pre></td></tr></table></figure>

<ul>
<li>å®æ—¶ç›‘æµ‹å·¥å…·</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„æ…¢æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.PROCESSLIST </span><br><span class="line"><span class="keyword">WHERE</span> <span class="type">TIME</span> <span class="operator">&gt;</span> <span class="number">2</span> <span class="keyword">AND</span> COMMAND <span class="operator">=</span> <span class="string">&#x27;Query&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä½¿ç”¨Percona ToolkitæŠ“å–é—®é¢˜SQL</span></span><br><span class="line">pt<span class="operator">-</span>query<span class="operator">-</span>digest <span class="operator">/</span>var<span class="operator">/</span>log<span class="operator">/</span>mysql<span class="operator">/</span>slow.log</span><br></pre></td></tr></table></figure>

<ul>
<li>å…³é”®æ€§èƒ½æŒ‡æ ‡</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">é‡ç‚¹ç›‘æ§é¡¹ï¼š</span><br><span class="line">- QPS/TPSæ³¢åŠ¨</span><br><span class="line">- CPUä½¿ç”¨ç‡ï¼ˆç‰¹åˆ«æ˜¯%sysï¼‰</span><br><span class="line">- é”ç­‰å¾…æ—¶é—´(Innodb_row_lock_time_avg)</span><br><span class="line">- ç¼“å†²æ± å‘½ä¸­ç‡(Innodb_buffer_pool_reads)</span><br></pre></td></tr></table></figure>



<p>Qï¼š<code>IN</code> å’Œ <code>EXISTS</code> çš„åŒºåˆ«</p>
<p>å½“ä½¿ç”¨ <code>IN</code> æ—¶ï¼ŒMySQL ä¼šé¦–å…ˆæ‰§è¡Œå­æŸ¥è¯¢ï¼Œç„¶åå°†å­æŸ¥è¯¢çš„ç»“æœé›†ç”¨äºå¤–éƒ¨æŸ¥è¯¢çš„æ¡ä»¶ã€‚è¿™æ„å‘³ç€å­æŸ¥è¯¢çš„ç»“æœé›†éœ€è¦å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p>
<p>è€Œ <code>EXISTS</code> ä¼šå¯¹å¤–éƒ¨æŸ¥è¯¢çš„æ¯ä¸€è¡Œï¼Œæ‰§è¡Œä¸€æ¬¡å­æŸ¥è¯¢ã€‚å¦‚æœå­æŸ¥è¯¢è¿”å›ä»»ä½•è¡Œï¼Œåˆ™ <code>EXISTS</code> æ¡ä»¶ä¸ºçœŸã€‚<code>EXISTS</code> å…³æ³¨çš„æ˜¯å­æŸ¥è¯¢æ˜¯å¦è¿”å›è¡Œï¼Œè€Œä¸æ˜¯è¿”å›çš„å…·ä½“å€¼ã€‚</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- IN çš„ä¸´æ—¶è¡¨å¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆ</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users </span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> user_id <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> amount <span class="operator">&gt;</span> <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- EXISTS å¯ä»¥åˆ©ç”¨å…³è”ç´¢å¼•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users u</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> orders o </span><br><span class="line">            <span class="keyword">WHERE</span> o.user_id <span class="operator">=</span> u.id <span class="keyword">AND</span> o.amount <span class="operator">&gt;</span> <span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<p><code>IN</code> é€‚ç”¨äºå­æŸ¥è¯¢ç»“æœé›†è¾ƒå°çš„æƒ…å†µã€‚å¦‚æœå­æŸ¥è¯¢è¿”å›å¤§é‡æ•°æ®ï¼Œ<code>IN</code> çš„æ€§èƒ½å¯èƒ½ä¼šä¸‹é™ï¼Œå› ä¸ºå®ƒéœ€è¦å°†æ•´ä¸ªç»“æœé›†åŠ è½½åˆ°å†…å­˜ã€‚</p>
<p>è€Œ EXISTS é€‚ç”¨äºå­æŸ¥è¯¢ç»“æœé›†å¯èƒ½å¾ˆå¤§çš„æƒ…å†µã€‚ç”±äº <code>EXISTS</code> åªéœ€è¦åˆ¤æ–­å­æŸ¥è¯¢æ˜¯å¦è¿”å›è¡Œï¼Œè€Œä¸éœ€è¦åŠ è½½æ•´ä¸ªç»“æœé›†ï¼Œå› æ­¤åœ¨æŸäº›æƒ…å†µä¸‹æ€§èƒ½æ›´å¥½ï¼Œç‰¹åˆ«æ˜¯å½“å­æŸ¥è¯¢å¯ä»¥ä½¿ç”¨ç´¢å¼•æ—¶ã€‚</p>
<p><strong>NULLå€¼é™·</strong></p>
<p><code>IN</code>: å¦‚æœå­æŸ¥è¯¢çš„ç»“æœé›†ä¸­åŒ…å« <code>NULL</code> å€¼ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„ç»“æœã€‚ä¾‹å¦‚ï¼Œ<code>WHERE column IN (subquery)</code>ï¼Œå¦‚æœ <code>subquery</code> è¿”å› <code>NULL</code>ï¼Œåˆ™ <code>column IN (subquery)</code> æ°¸è¿œä¸ä¼šä¸ºçœŸï¼Œé™¤é <code>column</code> æœ¬èº«ä¹Ÿä¸º <code>NULL</code>ã€‚</p>
<p><code>EXISTS</code>: å¯¹ <code>NULL</code> å€¼çš„å¤„ç†æ›´åŠ ç›´æ¥ã€‚<code>EXISTS</code> åªæ˜¯æ£€æŸ¥å­æŸ¥è¯¢æ˜¯å¦è¿”å›è¡Œï¼Œä¸å…³å¿ƒè¡Œçš„å…·ä½“å€¼ï¼Œå› æ­¤ä¸å— <code>NULL</code> å€¼çš„å½±å“ã€‚</p>
<h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><h3 id="Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿå•çº¿ç¨‹å¦‚ä½•å¤„ç†é«˜å¹¶å‘ï¼Ÿ"><a href="#Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿå•çº¿ç¨‹å¦‚ä½•å¤„ç†é«˜å¹¶å‘ï¼Ÿ" class="headerlink" title="Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿå•çº¿ç¨‹å¦‚ä½•å¤„ç†é«˜å¹¶å‘ï¼Ÿ"></a>Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿå•çº¿ç¨‹å¦‚ä½•å¤„ç†é«˜å¹¶å‘ï¼Ÿ</h3><p>å¯¹äºRedisçš„é«˜æ€§èƒ½è®¾è®¡ï¼Œæˆ‘çš„ç†è§£ä¸»è¦å¾—ç›Šäºä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li>å†…å­˜æ“ä½œï¼šRedisæ•°æ®å­˜å‚¨åœ¨å†…å­˜ï¼Œç›¸æ¯”äºç£ç›˜æ•°æ®åº“ï¼Œå‡å°‘äº†IOå¼€é”€</li>
<li>é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼šRedisé’ˆå¯¹ä¸åŒåœºæ™¯è®¾è®¡äº†ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œä¼˜åŒ–äº†ç©ºé—´å’Œè®¿é—®æ•ˆç‡</li>
<li>å•çº¿ç¨‹ï¼šRedisä½¿ç”¨å•çº¿ç¨‹å¤„ç†å‘½ä»¤ï¼Œé¿å…äº†å¤šçº¿ç¨‹ä¹‹é—´çš„ç«äº‰å’Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€</li>
<li>IOå¤šè·¯å¤ç”¨ï¼šRedisåŸºäºepoll&#x2F;kqueueå®ç°äº†éé˜»å¡çš„ç½‘ç»œæ¨¡å‹ï¼Œé€šè¿‡äº‹ä»¶æœºåˆ¶å¾ªç¯å¤„ç†è¯·æ±‚</li>
</ul>
<p><strong>è¿½é—®1ï¼šå•çº¿ç¨‹å¦‚ä½•åˆ©ç”¨å¤šæ ¸CPU</strong></p>
<p>å¯ä»¥éƒ¨ç½²åˆ†ç‰‡é›†ç¾¤ï¼Œæ¯ä¸ªRediså®ä¾‹ç»‘å®šä¸€ä¸ªCPUæ ¸ï¼ˆå¦‚ä½•éƒ¨ç½²å’Œç»‘å®šï¼Ÿï¼‰</p>
<p><strong>è¿½é—®2ï¼šä¸ºä»€ä¹ˆé€‰ç”¨å•çº¿ç¨‹è€Œä¸æ˜¯å¤šçº¿ç¨‹</strong></p>
<ul>
<li>é¿å…é”ç«äº‰</li>
<li>é¿å…ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€</li>
<li>å¤šçº¿ç¨‹å†…å­˜ç®¡ç†å¤æ‚</li>
</ul>
<p><strong>è¿½é—®3ï¼š ä»€ä¹ˆåœºæ™¯ä¸‹å•çº¿ç¨‹ä¼šæˆä¸ºç“¶é¢ˆ</strong></p>
<ul>
<li>è¶…å¤§ Value æ“ä½œï¼ˆå¦‚10MBçš„stringï¼‰ï¼ˆä»€ä¹ˆæ“ä½œï¼Œæ™®é€šè¯»å†™å°±ä¼šé˜»å¡å—ï¼‰</li>
<li>å¤æ‚ Lua è„šæœ¬æ‰§è¡Œï¼ˆé˜»å¡å…¶ä»–å‘½ä»¤ï¼‰</li>
</ul>
<p><strong>Qï¼šRedisæœ‰å“ªäº›æ•°æ®ç»“æ„ï¼Œåˆ†åˆ«æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯åœºæ™¯ï¼Ÿ</strong></p>
<p>Redisçš„åŸºç¡€æ•°æ®ç»“æ„åŒ…æ‹¬stringã€hashã€listã€setã€zsetï¼Œé«˜çº§æ•°æ®ç»“æ„åŒ…æ‹¬hyperloglogã€geoã€bitmapã€stream</p>
<h3 id="è§£é‡Šä¸€ä¸‹ç¼“å­˜ç©¿é€-é›ªå´©-å‡»ç©¿ï¼Œå¯¹åº”çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ"><a href="#è§£é‡Šä¸€ä¸‹ç¼“å­˜ç©¿é€-é›ªå´©-å‡»ç©¿ï¼Œå¯¹åº”çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ" class="headerlink" title="è§£é‡Šä¸€ä¸‹ç¼“å­˜ç©¿é€&#x2F;é›ªå´©&#x2F;å‡»ç©¿ï¼Œå¯¹åº”çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ"></a>è§£é‡Šä¸€ä¸‹ç¼“å­˜ç©¿é€&#x2F;é›ªå´©&#x2F;å‡»ç©¿ï¼Œå¯¹åº”çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ</h3><p><strong>ç¼“å­˜ç©¿é€</strong>æ˜¯æŒ‡æŸ¥è¯¢æ•°æ®åº“ä¸­ä¸å­˜åœ¨çš„æ•°æ®ï¼Œå¯¼è‡´è¯·æ±‚æ¯æ¬¡éƒ½ç©¿è¿‡ç¼“å­˜æŸ¥è¯¢æ•°æ®åº“ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰</strong></li>
</ul>
<p>æœåŠ¡å¯åŠ¨æ—¶åŠ è½½å…¨é‡æœ‰æ•ˆkeyï¼Œæ ‡è®°æ•°æ®æ˜¯å¦å­˜åœ¨ï¼›æ–°å¢æ•°æ®æ—¶åŒæ­¥æ›´æ–°è¿‡æ»¤å™¨</p>
<p>ç¼ºç‚¹ï¼šå­˜åœ¨ä¸€å®šçš„è¯¯åˆ¤ç‡</p>
<ul>
<li><strong>ç¼“å­˜ç©ºå€¼</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getData</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> redis.get(key);</span><br><span class="line">    <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (value <span class="keyword">instanceof</span> NullValue) &#123; <span class="comment">// ç©ºå€¼æ ‡è®°</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    value = db.query(key);</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">        redis.setex(key, <span class="number">300</span>, <span class="keyword">new</span> <span class="title class_">NullValue</span>()); <span class="comment">// ç¼“å­˜ç©ºå€¼5åˆ†é’Ÿ</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        redis.setex(key, <span class="number">3600</span>, value); <span class="comment">// æ­£å¸¸ç¼“å­˜1å°æ—¶</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å¢å¼ºè¯·æ±‚å‚æ•°çš„å¤æ‚åº¦ï¼Œé¿å…è¢«çŒœæµ‹ï¼ŒåŒæ—¶åšå¥½æ•°æ®çš„åŸºç¡€æ ¼å¼æ ¡éªŒ</li>
</ul>
<p><strong>ç¼“å­˜é›ªå´©</strong>æ˜¯æŒ‡<strong>å¤§é‡key</strong>åŒæ—¶å¤±æ•ˆï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚éƒ½å»æŸ¥è¯¢æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“å‹åŠ›éª¤å¢ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>å·®å¼‚åŒ–è¿‡æœŸæ—¶é—´</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸºç¡€è¿‡æœŸæ—¶é—´ï¼Œ1å°æ—¶</span></span><br><span class="line"><span class="type">int</span> <span class="variable">baseExpire</span> <span class="operator">=</span> <span class="number">3600</span>;</span><br><span class="line"><span class="comment">// éšæœº0-5åˆ†é’Ÿ</span></span><br><span class="line"><span class="type">int</span> <span class="variable">randomExpire</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">300</span>);</span><br><span class="line">redis.setex(key, baseExpire + randomExpire, value);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>æ°¸ä¸è¿‡æœŸ+å¼‚æ­¥æ›´æ–°</strong></li>
<li><strong>æ·»åŠ é™çº§é™æµç­–ç•¥</strong></li>
<li><strong>æ·»åŠ å¤šçº§ç¼“å­˜</strong></li>
</ul>
<p><strong>ç¼“å­˜å‡»ç©¿</strong>æ˜¯æŒ‡æŸä¸ª<strong>çƒ­ç‚¹key</strong>å¤±æ•ˆçš„ç¬é—´ï¼Œæœ‰å¤§é‡è¯·æ±‚åŒæ—¶è®¿é—®è¿™ä¸ªkeyï¼Œå¯¼è‡´æ‰€æœ‰è¯·æ±‚éƒ½å»æŸ¥è¯¢æ•°æ®åº“ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>äº’æ–¥é”</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> Redission.getLock(<span class="string">&quot;PREFIX:&quot;</span> + key);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (lock.tryLock(<span class="number">3</span>, <span class="number">30</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">        <span class="comment">// æŸ¥åº“å¹¶é‡å»ºç¼“å­˜</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>é€»è¾‘è¿‡æœŸ</strong></li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;çœŸå®æ•°æ®&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;expire_ts&quot;</span><span class="punctuation">:</span> <span class="number">1672502400</span> <span class="comment">// é€»è¾‘è¿‡æœŸæ—¶é—´æˆ³</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>å¤„ç†æµç¨‹ï¼š</p>
<ol>
<li>åˆ¤æ–­é€»è¾‘è¿‡æœŸæ—¶é—´<ol>
<li>æœªè¿‡æœŸï¼Œç›´æ¥è¿”å›æ•°æ®</li>
<li>å·²è¿‡æœŸï¼Œåˆ›å»ºå­çº¿ç¨‹ï¼Œå¼‚æ­¥é‡å»ºç¼“å­˜</li>
</ol>
</li>
</ol>
<table>
<thead>
<tr>
<th>è§£å†³æ–¹æ¡ˆ</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td>äº’æ–¥é”</td>
<td>å®ç°ç®€å•ï¼›ä¿è¯ä¸€è‡´æ€§ï¼›æ— éœ€æ¶ˆè€—é¢å¤–å†…å­˜</td>
<td>çº¿ç¨‹éœ€ç­‰å¾…ï¼Œå½±å“æ€§èƒ½</td>
</tr>
<tr>
<td>é€»è¾‘è¿‡æœŸ</td>
<td>çº¿ç¨‹æ— éœ€ç­‰å¾…ï¼Œæ€§èƒ½è¾ƒå¥½</td>
<td>å­˜åœ¨ä¸ä¸€è‡´æ€§ï¼›æ¶ˆè€—é¢å¤–å†…å­˜ï¼›å®ç°å¤æ‚</td>
</tr>
</tbody></table>
<h3 id="RDBå’ŒAOFæŒä¹…åŒ–åŸç†åŠä¼˜åŠ£å¯¹æ¯”"><a href="#RDBå’ŒAOFæŒä¹…åŒ–åŸç†åŠä¼˜åŠ£å¯¹æ¯”" class="headerlink" title="RDBå’ŒAOFæŒä¹…åŒ–åŸç†åŠä¼˜åŠ£å¯¹æ¯”"></a>RDBå’ŒAOFæŒä¹…åŒ–åŸç†åŠä¼˜åŠ£å¯¹æ¯”</h3><p>RDBï¼Œå­˜å‚¨æŸä¸€æ—¶åˆ»å†…å­˜ä¸­æ‰€æœ‰çš„æ•°æ®ï¼Œè§¦å‘å‘½ä»¤<code>save</code>ã€<code>bgsave</code>ï¼Œä¸»è¿›ç¨‹<code>fork</code>å­è¿›ç¨‹ï¼Œé˜»å¡ã€‚</p>
<p>è§¦å‘æ¡ä»¶ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯å‘é€<code>shutdown</code></li>
<li>ä»èŠ‚ç‚¹è¦è¿›è¡Œå…¨é‡å¤åˆ¶</li>
<li>è¾¾åˆ°<code>redis.conf</code>æ–‡ä»¶ä¸­é…ç½®çš„æ¡ä»¶</li>
<li>å®¢æˆ·ç«¯æ‰§è¡Œ<code>flushall</code>ï¼ˆç”Ÿæˆç©ºçš„<code>dump.rdb</code>ï¼Œæ…ç”¨ï¼‰</li>
</ol>
<p>ä¸èƒ½é¢‘ç¹ç”Ÿæˆ RBD å¿«ç…§ï¼ŒåŸå› ï¼š</p>
<ul>
<li>å¤šæ¬¡ RDB ä¼šç«äº‰ç£ç›˜å¸¦å®½</li>
<li><code>fork</code> å­è¿›ç¨‹ä¼šé˜»å¡ä¸»è¿›ç¨‹</li>
</ul>
<p>å†™æ—¶å¤åˆ¶<code>copy-on-write</code>ï¼š</p>
<ul>
<li><strong>å…±äº«å†…å­˜åˆå§‹åŒ–</strong>ï¼šå­è¿›ç¨‹åˆšåˆ›å»ºæ—¶ï¼Œ<strong>ä¸çˆ¶è¿›ç¨‹å…±äº«å…¨éƒ¨å†…å­˜é¡µ</strong>ï¼Œæ­¤æ—¶å†…å­˜å ç”¨å‡ ä¹æ— é¢å¤–å¼€é”€ã€‚</li>
<li><strong>å†™æ“ä½œè§¦å‘å¤åˆ¶</strong>ï¼šè‹¥çˆ¶è¿›ç¨‹æ”¶åˆ°å†™è¯·æ±‚ï¼ˆä¿®æ”¹æ•°æ®ï¼‰ï¼Œæ“ä½œç³»ç»Ÿä¼š<strong>å°†è¢«ä¿®æ”¹çš„å†…å­˜é¡µå¤åˆ¶ä¸€ä»½</strong>ï¼Œçˆ¶è¿›ç¨‹åœ¨å‰¯æœ¬ä¸Šä¿®æ”¹ï¼Œå­è¿›ç¨‹ä»è¯»å–åŸå§‹é¡µã€‚</li>
<li><strong>å­è¿›ç¨‹è§†è§’å›ºå®š</strong>ï¼šå­è¿›ç¨‹çœ‹åˆ°çš„æ•°æ®å§‹ç»ˆæ˜¯ <code>fork()</code> ç¬é—´çš„çŠ¶æ€ï¼Œç¡®ä¿å¿«ç…§ä¸€è‡´æ€§ã€‚</li>
</ul>
<p>AOFï¼Œæ‰€æœ‰å†™å‘½ä»¤è¿½åŠ åˆ° <code>aof_buf</code>ï¼Œåˆ·ç›˜ç­–ç•¥ç”± <code>appendfsync</code> å†³å®šã€‚</p>
<p>å¦‚æœæœ‰ AOF æ–‡ä»¶ï¼ŒåŠ è½½ AOFï¼›å¦åˆ™ï¼ŒåŠ è½½ RDB æ–‡ä»¶ã€‚AOF æœ€å¤šä¸¢å¤± 1s æ•°æ®ã€‚</p>
<p>AOFé‡å†™æ˜¯ç›´æ¥ä¸ºå½“å‰å†…å­˜çš„æ•°æ®ç”Ÿæˆå¯¹åº”å‘½ä»¤ï¼Œå¹¶ä¸æ˜¯è¯»å–æ—§AOFæ–‡ä»¶è¿›è¡Œå‘½ä»¤åˆå¹¶</p>
<ul>
<li>çˆ¶å­è¿›ç¨‹å†™åŒä¸€ä¸ªæ–‡ä»¶ä¼šäº§ç”Ÿç«äº‰é—®é¢˜ï¼Œå½±å“çˆ¶è¿›ç¨‹çš„æ€§èƒ½ã€‚</li>
<li>å¦‚æœAOFé‡å†™è¿‡ç¨‹ä¸­å¤±è´¥äº†ï¼Œç›¸å½“äºæ±¡æŸ“äº†åŸæœ¬çš„AOFæ–‡ä»¶ï¼Œæ— æ³•åšæ¢å¤æ•°æ®ä½¿ç”¨</li>
</ul>
<p>ä¿®å¤å·²æŸå®³çš„AOFæ–‡ä»¶ï¼š<code>redis-check-aof --fix appendonly.aof</code></p>
<table>
<thead>
<tr>
<th></th>
<th>RDB</th>
<th>AOF</th>
</tr>
</thead>
<tbody><tr>
<td>å¯åŠ¨åŠ è½½ä¼˜å…ˆçº§</td>
<td>ä½</td>
<td>é«˜</td>
</tr>
<tr>
<td>ä½“ç§¯</td>
<td>å°</td>
<td>å¤§</td>
</tr>
<tr>
<td>æ¢å¤é€Ÿåº¦</td>
<td>æ…¢</td>
<td>å¿«</td>
</tr>
</tbody></table>
<p>æ€»ç»“ï¼šRDBé€‚åˆç”¨ä½œæ•°æ®å¤‡ä»½ï¼ŒAOFé€‚åˆç”¨ä½œæ•°æ®æ¢å¤ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯çƒ­Keyé—®é¢˜"><a href="#ä»€ä¹ˆæ˜¯çƒ­Keyé—®é¢˜" class="headerlink" title="ä»€ä¹ˆæ˜¯çƒ­Keyé—®é¢˜"></a>ä»€ä¹ˆæ˜¯çƒ­Keyé—®é¢˜</h3><h3 id="Redisäº‹åŠ¡ä¸MySQLäº‹åŠ¡æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#Redisäº‹åŠ¡ä¸MySQLäº‹åŠ¡æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="Redisäº‹åŠ¡ä¸MySQLäº‹åŠ¡æœ‰ä»€ä¹ˆåŒºåˆ«"></a>Redisäº‹åŠ¡ä¸MySQLäº‹åŠ¡æœ‰ä»€ä¹ˆåŒºåˆ«</h3><h3 id="ä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼é”çš„æ¼”è¿›è¿‡ç¨‹"><a href="#ä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼é”çš„æ¼”è¿›è¿‡ç¨‹" class="headerlink" title="ä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼é”çš„æ¼”è¿›è¿‡ç¨‹"></a>ä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼é”çš„æ¼”è¿›è¿‡ç¨‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.ValueOperations;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisDistributedLock</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LOCK_KEY</span> <span class="operator">=</span> <span class="string">&quot;myLock&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">LOCK_EXPIRE_TIME</span> <span class="operator">=</span> <span class="number">5000</span>; <span class="comment">// é”è¿‡æœŸæ—¶é—´ï¼Œå•ä½æ¯«ç§’</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedisDistributedLock</span><span class="params">(RedisTemplate&lt;String, String&gt; redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">acquireLock</span><span class="params">()</span> &#123;</span><br><span class="line">        ValueOperations&lt;String, String&gt; valueOperations = redisTemplate.opsForValue();</span><br><span class="line">        <span class="comment">// å°è¯•è·å–åˆ†å¸ƒå¼é”</span></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">result</span> <span class="operator">=</span> valueOperations.setIfAbsent(LOCK_KEY, <span class="string">&quot;locked&quot;</span>); <span class="comment">// RedisTemplate çš„ setIfAbsent æ–¹æ³•ï¼Œå¦‚æœé”®ä¸å­˜åœ¨åˆ™è®¾ç½®é”®å€¼å¯¹å¹¶è¿”å› trueï¼Œå¦åˆ™è¿”å› false</span></span><br><span class="line">        <span class="keyword">if</span> (result != <span class="literal">null</span> &amp;&amp; result) &#123;</span><br><span class="line">            <span class="comment">// æˆåŠŸè·å–åˆ°é”ï¼Œè®¾ç½®é”çš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line">            redisTemplate.expire(LOCK_KEY, LOCK_EXPIRE_TIME, TimeUnit.MILLISECONDS); <span class="comment">// è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ï¼Œå•ä½æ¯«ç§’</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">releaseLock</span><span class="params">()</span> &#123;</span><br><span class="line">        redisTemplate.delete(LOCK_KEY); <span class="comment">// åˆ é™¤é”®</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨åˆ†å¸ƒå¼é”çš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doBusinessWithLock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acquireLock()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// è·å¾—åˆ†å¸ƒå¼é”åæ‰§è¡Œä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">                System.out.println(<span class="string">&quot;Acquired lock, do business logic...&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>); <span class="comment">// æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†æ—¶é—´</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                releaseLock(); <span class="comment">// ä¸šåŠ¡å¤„ç†å®Œæˆåé‡Šæ”¾é”</span></span><br><span class="line">                System.out.println(<span class="string">&quot;Released lock.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æœªè·å¾—åˆ†å¸ƒå¼é”ï¼Œæ‰§è¡Œå…¶ä»–é€»è¾‘</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Failed to acquire lock, do other logic...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º RedisTemplate å®ä¾‹å¹¶è®¾ç½®è¿æ¥ä¿¡æ¯</span></span><br><span class="line">        RedisTemplate&lt;String, String&gt; redisTemplate = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// è®¾ç½® Redis è¿æ¥å·¥å‚ã€åºåˆ—åŒ–æ–¹å¼ç­‰</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="type">RedisDistributedLock</span> <span class="variable">distributedLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisDistributedLock</span>(redisTemplate);</span><br><span class="line">        distributedLock.doBusinessWithLock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>ç«äº‰æ¡ä»¶ï¼ˆRace Conditionï¼‰ï¼šåœ¨å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶å°è¯•è·å–é”æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°ç«äº‰æ¡ä»¶ï¼Œå¯¼è‡´å¤šä¸ªå®¢æˆ·ç«¯éƒ½æˆåŠŸè·å¾—é”ï¼Œä»è€Œå¼•å‘å¹¶å‘è®¿é—®èµ„æºçš„é—®é¢˜ã€‚</li>
<li>æ­»é”ï¼ˆDeadlockï¼‰ï¼šå¦‚æœæŸä¸ªæŒæœ‰é”çš„å®¢æˆ·ç«¯åœ¨ä¸šåŠ¡å¤„ç†æœŸé—´å‘ç”Ÿå¼‚å¸¸æˆ–å´©æºƒï¼Œå¯¼è‡´æ²¡æœ‰é‡Šæ”¾é”çš„æ“ä½œï¼Œå¯èƒ½ä¼šå‡ºç°æ­»é”çš„æƒ…å†µï¼Œå¯¼è‡´å…¶ä»–å®¢æˆ·ç«¯æ— æ³•è·å¾—é”ã€‚</li>
<li>é”è¿‡æœŸï¼ˆLock Expirationï¼‰ï¼šä¸ºäº†é¿å…æ­»é”ï¼Œé€šå¸¸ä¼šç»™é”è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä½†å¦‚æœä¸šåŠ¡å¤„ç†æ—¶é—´è¾ƒé•¿ï¼Œè¶…è¿‡äº†é”çš„è¿‡æœŸæ—¶é—´ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¶ä»–å®¢æˆ·ç«¯è¯¯è®¤ä¸ºé”å·²ç»é‡Šæ”¾ï¼Œä»è€Œå¼•å‘å¹¶å‘è®¿é—®èµ„æºçš„é—®é¢˜ã€‚</li>
<li>é”çš„é‡å…¥æ€§ï¼ˆLock Reentrancyï¼‰ï¼šåœ¨æŸäº›åœºæ™¯ä¸‹ï¼ŒåŒä¸€ä¸ªå®¢æˆ·ç«¯å¯èƒ½éœ€è¦å¤šæ¬¡è·å–åŒä¸€ä¸ªé”ï¼Œä¾‹å¦‚åµŒå¥—çš„ä¸šåŠ¡å¤„ç†é€»è¾‘ã€‚å¦‚æœåˆ†å¸ƒå¼é”æ²¡æœ‰æ”¯æŒé”çš„é‡å…¥æ€§ï¼Œå¯èƒ½ä¼šå¯¼è‡´åŒä¸€ä¸ªå®¢æˆ·ç«¯æ— æ³•åœ¨ä¸šåŠ¡å¤„ç†æœŸé—´é‡æ–°è·å–é”ï¼Œä»è€Œå¼•å‘æ­»é”æˆ–å¹¶å‘è®¿é—®èµ„æºçš„é—®é¢˜ã€‚</li>
<li>æ€§èƒ½å¼€é”€ï¼ˆPerformance Overheadï¼‰ï¼šä½¿ç”¨åˆ†å¸ƒå¼é”å¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿçš„æ€§èƒ½å¼€é”€ï¼Œä¾‹å¦‚é¢‘ç¹çš„é”è·å–å’Œé”é‡Šæ”¾æ“ä½œï¼Œä»¥åŠé”çš„ç®¡ç†å’Œç»´æŠ¤ã€‚å¦‚æœé”çš„ä½¿ç”¨ä¸å½“ï¼Œå¯èƒ½ä¼šå½±å“ç³»ç»Ÿçš„æ€§èƒ½å’Œå“åº”æ—¶é—´ã€‚</li>
</ol>
<h3 id="å…¨é‡åŒæ­¥å’Œå¢é‡åŒæ­¥çš„åŒºåˆ«"><a href="#å…¨é‡åŒæ­¥å’Œå¢é‡åŒæ­¥çš„åŒºåˆ«" class="headerlink" title="å…¨é‡åŒæ­¥å’Œå¢é‡åŒæ­¥çš„åŒºåˆ«"></a>å…¨é‡åŒæ­¥å’Œå¢é‡åŒæ­¥çš„åŒºåˆ«</h3><p>å…¨é‡åŒæ­¥ï¼šmasterç”Ÿæˆå½“å‰å†…å­˜ä¸­æ‰€æœ‰æ•°æ®çš„RDBæ–‡ä»¶ï¼Œå°†RDBå‘é€ç»™slaveã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œmasterå°†æ–°çš„å‘½ä»¤è®°å½•åœ¨<code>repl_backlog</code>ä¸­ï¼Œåç»­å†å‘é€ç»™slaveã€‚</p>
<p>æ‰§è¡Œæ—¶æœºï¼š</p>
<ol>
<li>slaveç¬¬ä¸€æ¬¡è¿æ¥åˆ°master</li>
<li>slaveå®•æœºå¤ªä¹…ï¼Œå¯¼è‡´å®ƒåœ¨<code>repl_backlog</code>ä¸­çš„<code>offset</code>å·²ç»è¢«è¦†ç›–æ‰äº†</li>
</ol>
<p>å¢é‡åŒæ­¥ï¼šsalveå°†è‡ªå·±çš„<code>offset</code>å‘é€åˆ°masterï¼Œmasterå°†<code>repl_backlog</code>ä¸­<code>offset</code>ä¹‹åçš„å‘½ä»¤å‘é€ç»™slave</p>
<p>æ‰§è¡Œæ—¶æœºï¼š</p>
<ol>
<li>slaveæ–­å¼€é‡è¿ä¹‹åï¼Œ<code>repl_backlog</code>ä¸­çš„<code>offset</code>å°šæœªè¢«è¦†ç›–</li>
</ol>
<h3 id="å†…å­˜æ·˜æ±°ç­–ç•¥ä¸LRUå®ç°"><a href="#å†…å­˜æ·˜æ±°ç­–ç•¥ä¸LRUå®ç°" class="headerlink" title="å†…å­˜æ·˜æ±°ç­–ç•¥ä¸LRUå®ç°"></a>å†…å­˜æ·˜æ±°ç­–ç•¥ä¸LRUå®ç°</h3><table>
<thead>
<tr>
<th align="left"><strong>æ•°æ®èŒƒå›´</strong></th>
<th align="left"><strong>ç­–ç•¥</strong></th>
<th align="left"><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>æ‰€æœ‰Key</strong></td>
<td align="left"><code>allkeys-lru</code></td>
<td align="left">ä»æ‰€æœ‰Keyä¸­æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>allkeys-lfu</code></td>
<td align="left">ä»æ‰€æœ‰Keyä¸­æ·˜æ±°æœ€ä¸ç»å¸¸ä½¿ç”¨çš„ï¼ˆRedis 4.0+ï¼‰</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>allkeys-random</code></td>
<td align="left">ä»æ‰€æœ‰Keyä¸­éšæœºæ·˜æ±°</td>
</tr>
<tr>
<td align="left"><strong>è¿‡æœŸKey</strong></td>
<td align="left"><code>volatile-lru</code></td>
<td align="left">ä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„Keyä¸­æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>volatile-lfu</code></td>
<td align="left">ä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„Keyä¸­æ·˜æ±°æœ€ä¸ç»å¸¸ä½¿ç”¨çš„</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>volatile-random</code></td>
<td align="left">ä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„Keyä¸­éšæœºæ·˜æ±°</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>volatile-ttl</code></td>
<td align="left">æ·˜æ±°å‰©ä½™å­˜æ´»æ—¶é—´ï¼ˆTTLï¼‰æœ€çŸ­çš„Key</td>
</tr>
<tr>
<td align="left"><strong>ä¸æ·˜æ±°</strong></td>
<td align="left"><code>noeviction</code>ï¼ˆé»˜è®¤ï¼‰</td>
<td align="left">å†…å­˜ä¸è¶³æ—¶æ‹’ç»å†™å…¥ï¼Œè¿”å›é”™è¯¯</td>
</tr>
</tbody></table>
<h3 id="Rediså’ŒMySQLçš„åŒºåˆ«"><a href="#Rediså’ŒMySQLçš„åŒºåˆ«" class="headerlink" title="Rediså’ŒMySQLçš„åŒºåˆ«"></a>Rediså’ŒMySQLçš„åŒºåˆ«</h3><table>
<thead>
<tr>
<th></th>
<th>Redis</th>
<th>MySQL</th>
</tr>
</thead>
<tbody><tr>
<td>æ•°æ®ç»“æ„</td>
<td>éç»“æ„åŒ–</td>
<td>ç»“æ„åŒ–</td>
</tr>
<tr>
<td>æŒä¹…åŒ–</td>
<td>å¯é€‰æŒä¹…åŒ–</td>
<td>é»˜è®¤æŒä¹…åŒ–</td>
</tr>
<tr>
<td>äº‹åŠ¡æ”¯æŒ</td>
<td>ç®€å•æ”¯æŒ</td>
<td>æ”¯æŒå®Œæ•´çš„ACID</td>
</tr>
<tr>
<td>æ‰©å±•æ€§</td>
<td>é€šè¿‡åˆ†ç‰‡æ°´å¹³æ‰©å±•</td>
<td>å¤æ‚ï¼Œéœ€åˆ†åº“åˆ†è¡¨æˆ–ä¸­é—´ä»¶</td>
</tr>
<tr>
<td>æ•°æ®ä¸€è‡´æ€§</td>
<td>æœ€ç»ˆä¸€è‡´æ€§</td>
<td>å¼ºä¸€è‡´æ€§</td>
</tr>
</tbody></table>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>å½“éœ€è¦å¤æ‚æŸ¥è¯¢å’Œäº‹åŠ¡æ”¯æŒï¼Œå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚è¾ƒé«˜ï¼Œéœ€è¦é•¿æœŸæŒä¹…åŒ–å­˜å‚¨çš„åœºæ™¯ï¼Œé€‰æ‹©MySQL</li>
<li>å½“éœ€è¦è¶…é«˜æ€§èƒ½å’Œçµæ´»æ•°æ®ç±»å‹ï¼Œå¯¹æ•°æ®çš„ä¸€è‡´æ€§è¦æ±‚ä¸é‚£ä¹ˆé«˜ï¼Œä¸”å®¹å¿ä¸€å®šçš„æ•°æ®ä¸¢å¤±çš„æƒ…å†µä¸‹ï¼Œé€‰æ‹©Redis</li>
</ul>
<h3 id="Rediså’Œmemchahedçš„åŒºåˆ«"><a href="#Rediså’Œmemchahedçš„åŒºåˆ«" class="headerlink" title="Rediså’Œmemchahedçš„åŒºåˆ«"></a>Rediså’Œmemchahedçš„åŒºåˆ«</h3><table>
<thead>
<tr>
<th></th>
<th>Redis</th>
<th>Memcached</th>
</tr>
</thead>
<tbody><tr>
<td>æ•°æ®ç±»å‹</td>
<td>ä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼šstringã€hashã€listç­‰</td>
<td>åªæ”¯æŒstring</td>
</tr>
<tr>
<td>æŒä¹…åŒ–</td>
<td>æ”¯æŒï¼ˆRDBã€AOFï¼‰</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>äº‹åŠ¡</td>
<td>ç®€å•æ”¯æŒï¼ˆMULTI&#x2F;EXECï¼‰</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>åˆ†å¸ƒå¼</td>
<td>æ”¯æŒï¼Œé›†ç¾¤è‡ªåŠ¨åˆ†ç‰‡</td>
<td>ä¾èµ–å®¢æˆ·ç«¯ä¸€è‡´æ€§å“ˆå¸Œæˆ–ç¬¬ä¸‰æ–¹å·¥å…·å®ç°åˆ†å¸ƒå¼</td>
</tr>
<tr>
<td>å‘½ä»¤</td>
<td>æ”¯æŒä¸°å¯Œçš„å‘½ä»¤</td>
<td>ä»…æ”¯æŒSETã€GETã€ADDã€DELTEç­‰åŸºç¡€æ“ä½œ</td>
</tr>
<tr>
<td>å†…å­˜å ç”¨</td>
<td>å¤æ‚æ•°æ®ç»“æ„å¯èƒ½å¯¼è‡´å†…å­˜æ¶ˆè€—è¾ƒé«˜</td>
<td>å†…å­˜åˆ©ç”¨ç‡é«˜ï¼Œä½†çµæ´»æ€§è¾ƒä½</td>
</tr>
</tbody></table>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>éœ€è¦å¤æ‚æ•°æ®ç»“æ„ã€æŒä¹…åŒ–ã€äº‹åŠ¡æ”¯æŒå’Œé«˜å¯ç”¨æ€§çš„åœºæ™¯ï¼Œé€‰æ‹©Redis</li>
<li>è¿½æ±‚æè‡´çš„æ€§èƒ½å’Œç®€å•æ€§ï¼Œæ•°æ®ç»“æ„ç®€å•ä¸”æ— éœ€æŒä¹…åŒ–çš„åœºæ™¯ï¼Œå¯ä»¥é€‰æ‹©Memcached</li>
</ul>
<h3 id="Redis-IOå¤šè·¯å¤ç”¨"><a href="#Redis-IOå¤šè·¯å¤ç”¨" class="headerlink" title="Redis IOå¤šè·¯å¤ç”¨"></a>Redis IOå¤šè·¯å¤ç”¨</h3><p>å¸¸è§çš„ I&#x2F;O å¤šè·¯å¤ç”¨æœºåˆ¶åŒ…æ‹¬ selectã€poll å’Œ epoll ç­‰ã€‚</p>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th><code>select</code></th>
<th><code>poll</code></th>
<th><code>epoll</code></th>
</tr>
</thead>
<tbody><tr>
<td>æ–‡ä»¶æè¿°ç¬¦é™åˆ¶</td>
<td>å— <code>FD_SETSIZE</code> é™åˆ¶</td>
<td>æ— é™åˆ¶</td>
<td>æ— é™åˆ¶</td>
</tr>
<tr>
<td>æ—¶é—´å¤æ‚åº¦</td>
<td>O(n)</td>
<td>O(n)</td>
<td>O(1)</td>
</tr>
<tr>
<td>æ•°æ®å¤åˆ¶</td>
<td>éœ€è¦</td>
<td>éœ€è¦</td>
<td>ä¸éœ€è¦</td>
</tr>
<tr>
<td>å·¥ä½œæ–¹å¼</td>
<td>çº¿æ€§æ‰«æ</td>
<td>çº¿æ€§æ‰«æ</td>
<td>äº‹ä»¶é€šçŸ¥</td>
</tr>
<tr>
<td>å†…æ ¸æ”¯æŒ</td>
<td>æ‰€æœ‰ UNIX ç³»ç»Ÿ</td>
<td>æ‰€æœ‰ UNIX ç³»ç»Ÿ</td>
<td>Linux 2.6 åŠä»¥ä¸Šç‰ˆæœ¬</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>å°‘é‡è¿æ¥</td>
<td>ä¸­ç­‰è¿æ¥</td>
<td>å¤§é‡å¹¶å‘è¿æ¥</td>
</tr>
</tbody></table>
<p><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240918114125.png" alt="æœ‰ç›å…ˆç”Ÿï¼šIO å¤šè·¯å¤ç”¨"></p>
<h3 id="Redis-6-0-å¤šçº¿ç¨‹"><a href="#Redis-6-0-å¤šçº¿ç¨‹" class="headerlink" title="Redis 6.0 å¤šçº¿ç¨‹"></a>Redis 6.0 å¤šçº¿ç¨‹</h3><p>åœ¨ Redis 6.0 ä¸­ï¼Œå¤šçº¿ç¨‹ä¸»è¦ç”¨æ¥å¤„ç†ç½‘ç»œ IO æ“ä½œï¼Œå‘½ä»¤è§£æå’Œæ‰§è¡Œä»ç„¶æ˜¯å•çº¿ç¨‹å®Œæˆï¼Œè¿™æ ·æ—¢å¯ä»¥å‘æŒ¥å¤šæ ¸ CPU çš„ä¼˜åŠ¿ï¼Œåˆèƒ½é¿å…é”å’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-b7b24e25-d2dc-4457-994f-95bdb3674b8e.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedis6.0å¤šçº¿ç¨‹"></p>
<h2 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h2><h3 id="Elasticsearch-çš„æ ¸å¿ƒæ¦‚å¿µ"><a href="#Elasticsearch-çš„æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="Elasticsearch çš„æ ¸å¿ƒæ¦‚å¿µ"></a><strong>Elasticsearch çš„æ ¸å¿ƒæ¦‚å¿µ</strong></h3><ul>
<li><strong>æ–‡æ¡£ï¼š</strong> æ•°æ®çš„åŸºæœ¬å•ä½ï¼Œé€šå¸¸æ˜¯ JSON æ ¼å¼ã€‚ç›¸å½“äºæ•°æ®åº“ä¸­çš„ä¸€è¡Œè®°å½•ã€‚</li>
<li><strong>ç´¢å¼•ï¼š</strong> å…·æœ‰ç›¸ä¼¼ç‰¹å¾çš„æ–‡æ¡£é›†åˆã€‚ç›¸å½“äºæ•°æ®åº“ä¸­çš„ä¸€ä¸ªè¡¨ã€‚ä¸€ä¸ªç´¢å¼•å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç‰‡ã€‚</li>
<li><strong>ç±»å‹ï¼š</strong> (7.x ä¹‹å‰) ç´¢å¼•å†…éƒ¨çš„é€»è¾‘åˆ†åŒºï¼Œå…è®¸åœ¨åŒä¸€ç´¢å¼•ä¸­å­˜å‚¨ä¸åŒç±»å‹çš„æ–‡æ¡£ï¼ˆå¦‚ <code>user</code>, <code>product</code>ï¼‰ã€‚(<strong>æ³¨æ„ï¼š</strong> åœ¨ 7.x ä¸­ç±»å‹è¢«åºŸå¼ƒï¼Œ8.x ä¸­å®Œå…¨ç§»é™¤ã€‚ç°åœ¨ä¸€ä¸ªç´¢å¼•é€šå¸¸åªåŒ…å«ä¸€ç§æ–‡æ¡£ç±»å‹)ã€‚</li>
<li><strong>åˆ†ç‰‡ï¼š</strong> ç´¢å¼•è¢«æ°´å¹³åˆ†å‰²æˆçš„å­é›†ã€‚æ¯ä¸ªåˆ†ç‰‡æœ¬èº«å°±æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ä¸”ç‹¬ç«‹çš„â€œç´¢å¼•â€ã€‚<ul>
<li><strong>ä¸»åˆ†ç‰‡ï¼š</strong> å­˜å‚¨æ–‡æ¡£æ•°æ®å’Œå¤„ç†ç´¢å¼•&#x2F;æ›´æ–°æ“ä½œã€‚ç´¢å¼•åˆ›å»ºæ—¶æŒ‡å®šæ•°é‡ï¼Œåç»­ä¸å¯æ›´æ”¹ï¼ˆé™¤é Reindexï¼‰ã€‚</li>
<li><strong>å‰¯æœ¬åˆ†ç‰‡ï¼š</strong> ä¸»åˆ†ç‰‡çš„æ‹·è´ã€‚æä¾›é«˜å¯ç”¨æ€§ï¼ˆä¸»åˆ†ç‰‡æ•…éšœæ—¶å‰¯æœ¬å¯æå‡ä¸ºä¸»ï¼‰å’Œè¯»å–ååé‡ï¼ˆæŸ¥è¯¢å¯è´Ÿè½½å‡è¡¡åˆ°æ‰€æœ‰å‰¯æœ¬ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>èŠ‚ç‚¹ï¼š</strong> è¿è¡Œä¸­çš„ Elasticsearch å®ä¾‹ã€‚</li>
<li><strong>é›†ç¾¤ï¼š</strong> ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ååŒå·¥ä½œçš„é›†åˆï¼Œå…±åŒæŒæœ‰æ•´ä¸ªæ•°æ®å¹¶æä¾›è”åˆç´¢å¼•å’Œæœç´¢èƒ½åŠ›ã€‚</li>
<li><strong>å€’æ’ç´¢å¼•ï¼š</strong> ES å®ç°å¿«é€Ÿå…¨æ–‡æœç´¢çš„æ ¸å¿ƒæ•°æ®ç»“æ„ã€‚å®ƒå­˜å‚¨äº†è¯é¡¹ï¼ˆTokenï¼‰åˆ°åŒ…å«è¯¥è¯é¡¹çš„æ–‡æ¡£ ID åˆ—è¡¨çš„æ˜ å°„ã€‚ç›¸æ¯”ä¼ ç»Ÿæ•°æ®åº“çš„æ­£æ’ç´¢å¼•ï¼ˆæ–‡æ¡£ ID åˆ°å­—æ®µå€¼ï¼‰ï¼Œå®ƒæ›´æ“…é•¿å›ç­”â€œå“ªäº›æ–‡æ¡£åŒ…å«æŸä¸ªè¯ï¼Ÿâ€çš„é—®é¢˜ã€‚</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆå®ƒå¯¹æœç´¢å¾ˆé‡è¦ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆå®ƒå¯¹æœç´¢å¾ˆé‡è¦ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆå®ƒå¯¹æœç´¢å¾ˆé‡è¦ï¼Ÿ"></a><strong>ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆå®ƒå¯¹æœç´¢å¾ˆé‡è¦ï¼Ÿ</strong></h3><ul>
<li><strong>å®šä¹‰ï¼š</strong> å€’æ’ç´¢å¼•æ˜¯ä¸€ç§å°†æ–‡æ¡£ä¸­çš„è¯é¡¹ï¼ˆTokenï¼‰æ˜ å°„åˆ°åŒ…å«è¯¥è¯é¡¹çš„æ–‡æ¡£åˆ—è¡¨çš„æ•°æ®ç»“æ„ã€‚å®ƒåŒ…å«ä¸¤ä¸ªæ ¸å¿ƒéƒ¨åˆ†ï¼š<ul>
<li><strong>è¯é¡¹å­—å…¸ï¼š</strong> åŒ…å«æ‰€æœ‰ä¸é‡å¤çš„è¯é¡¹ï¼ˆTokenï¼‰ï¼Œé€šå¸¸æŒ‰å­—å…¸åºæ’åºã€‚</li>
<li><strong>å€’æ’åˆ—è¡¨ï¼š</strong> å¯¹äºæ¯ä¸ªè¯é¡¹ï¼Œè®°å½•åŒ…å«è¯¥è¯é¡¹çš„æ‰€æœ‰æ–‡æ¡£ ID åˆ—è¡¨ï¼ˆPostings Listï¼‰ï¼Œä»¥åŠè¯é¡¹åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„ä½ç½®ï¼ˆPositionï¼‰ã€é¢‘ç‡ï¼ˆTerm Frequencyï¼‰ç­‰ä¿¡æ¯ï¼ˆç”¨äºç›¸å…³æ€§è¯„åˆ†ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>é‡è¦æ€§ï¼š</strong><ul>
<li><strong>å¿«é€Ÿå®šä½ï¼š</strong> ç›´æ¥é€šè¿‡è¯é¡¹æ‰¾åˆ°åŒ…å«å®ƒçš„æ–‡æ¡£ï¼Œé¿å…äº†æ‰«ææ‰€æœ‰æ–‡æ¡£ã€‚</li>
<li><strong>é«˜æ•ˆå¸ƒå°”æŸ¥è¯¢ï¼š</strong> AND&#x2F;OR&#x2F;NOT æ“ä½œå¯ä»¥é€šè¿‡å¯¹å€’æ’åˆ—è¡¨è¿›è¡Œäº¤&#x2F;å¹¶&#x2F;å·®é›†è¿ç®—é«˜æ•ˆå®Œæˆã€‚</li>
<li><strong>ç›¸å…³æ€§è¯„åˆ†åŸºç¡€ï¼š</strong> TF-IDFã€BM25 ç­‰ç»å…¸è¯„åˆ†æ¨¡å‹ä¸¥é‡ä¾èµ–å€’æ’ç´¢å¼•ä¸­å­˜å‚¨çš„è¯é¢‘ï¼ˆTFï¼‰ã€æ–‡æ¡£é¢‘ç‡ï¼ˆDF&#x2F;IDFï¼‰ä¿¡æ¯ã€‚</li>
<li><strong>æ”¯æŒçŸ­è¯­æŸ¥è¯¢ï¼š</strong> åˆ©ç”¨å­˜å‚¨çš„ä½ç½®ä¿¡æ¯ï¼Œå¯ä»¥ç²¾ç¡®æŸ¥æ‰¾ç›¸é‚»å‡ºç°çš„è¯ç»„ã€‚</li>
</ul>
</li>
</ul>
<h2 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h2><h1 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h1><h2 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h2><ol>
<li>Kafkaé«˜ååé‡å®ç°åŸç†</li>
<li>æ¶ˆæ¯ä¸¢å¤±ä¸é‡å¤æ¶ˆè´¹è§£å†³æ–¹æ¡ˆ</li>
<li>é¡ºåºæ¶ˆæ¯å®ç°æ–¹æ¡ˆ</li>
<li>å»¶è¿Ÿæ¶ˆæ¯å®ç°åŸç†</li>
<li>æ­»ä¿¡é˜Ÿåˆ—åº”ç”¨åœºæ™¯</li>
<li>æ¶ˆæ¯å †ç§¯å¤„ç†ç­–ç•¥</li>
<li>RocketMQäº‹åŠ¡æ¶ˆæ¯æµç¨‹</li>
<li>Pulsaråˆ†å±‚å­˜å‚¨æ¶æ„ä¼˜åŠ¿</li>
<li>å¦‚ä½•è®¾è®¡æ¶ˆæ¯è½¨è¿¹ç³»ç»Ÿï¼Ÿ</li>
<li>Brokeré€‰ä¸¾æœºåˆ¶å¯¹æ¯”ï¼ˆKafka vs RocketMQï¼‰</li>
</ol>
<h3 id="Kafka-ä¸ºä»€ä¹ˆèƒ½å®ç°é«˜ååé‡ï¼Ÿ"><a href="#Kafka-ä¸ºä»€ä¹ˆèƒ½å®ç°é«˜ååé‡ï¼Ÿ" class="headerlink" title="Kafka ä¸ºä»€ä¹ˆèƒ½å®ç°é«˜ååé‡ï¼Ÿ"></a>Kafka ä¸ºä»€ä¹ˆèƒ½å®ç°é«˜ååé‡ï¼Ÿ</h3><ul>
<li><strong>é¡ºåºè¯»å†™ç£ç›˜:</strong> æ¶ˆæ¯æŒ‰é¡ºåºè¿½åŠ åˆ° Partition æ–‡ä»¶æœ«å°¾ï¼Œå……åˆ†åˆ©ç”¨ç£ç›˜é¡ºåº I&#x2F;O çš„é«˜æ€§èƒ½ï¼ˆè¿œé«˜äºéšæœº I&#x2F;Oï¼‰ã€‚</li>
<li><strong>Page Cache:</strong> åˆ©ç”¨æ“ä½œç³»ç»Ÿ Page Cache ç¼“å­˜æ•°æ®ï¼Œå‡å°‘ç›´æ¥ç£ç›˜è®¿é—®ã€‚</li>
<li><strong>é›¶æ‹·è´ (Zero-Copy):</strong> ä½¿ç”¨ <code>**sendfile**</code> å’Œ <code>**mmap**</code> ç­‰æŠ€æœ¯ï¼Œå‡å°‘æ•°æ®åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´çš„æ‹·è´æ¬¡æ•°ï¼Œé™ä½ CPU å¼€é”€å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</li>
<li><strong>æ‰¹é‡å¤„ç† (Batching):</strong> Producer æ‰¹é‡å‘é€æ¶ˆæ¯ï¼ŒBroker æ‰¹é‡å†™å…¥ç£ç›˜å’Œæ‰¹é‡å‘é€ç»™ Consumerï¼Œå‡å°‘ç½‘ç»œå’Œ I&#x2F;O å¼€é”€ã€‚</li>
<li><strong>æ¶ˆæ¯å‹ç¼©:</strong> Producer ç«¯å¯é…ç½®å‹ç¼©ç®—æ³• (Snappy, LZ4, Gzip, Zstd)ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“å’Œç£ç›˜å­˜å‚¨å¼€é”€ã€‚</li>
<li><strong>Partition å¹¶è¡Œ:</strong> Topic è¢«åˆ†æˆå¤šä¸ª Partitionï¼Œåˆ†å¸ƒåœ¨å¤šä¸ª Broker ä¸Šï¼Œè¯»å†™æ“ä½œå¯ä»¥å¹¶è¡Œå‘ç”Ÿåœ¨ä¸åŒ Partitionï¼Œå……åˆ†åˆ©ç”¨å¤š Brokerã€å¤šç£ç›˜ã€å¤šæ ¸ CPUã€‚</li>
</ul>
<h3 id="è§£é‡Š-Kafka-ä¸­-Topicã€Partitionã€Replica-çš„å…³ç³»"><a href="#è§£é‡Š-Kafka-ä¸­-Topicã€Partitionã€Replica-çš„å…³ç³»" class="headerlink" title="è§£é‡Š Kafka ä¸­ Topicã€Partitionã€Replica çš„å…³ç³»"></a>è§£é‡Š Kafka ä¸­ Topicã€Partitionã€Replica çš„å…³ç³»</h3><ul>
<li><strong>Topic</strong> æ˜¯æ¶ˆæ¯å‘å¸ƒçš„ç±»åˆ«æˆ–ä¸»é¢˜ã€‚</li>
<li>ä¸€ä¸ª <strong>Topic</strong> è¢«åˆ’åˆ†ä¸ºä¸€ä¸ªæˆ–å¤šä¸ª <strong>Partition</strong>ã€‚Partition æ˜¯ç‰©ç†å­˜å‚¨å•å…ƒï¼Œåˆ†å¸ƒåœ¨ä¸åŒçš„ Broker ä¸Šã€‚</li>
<li>æ¯ä¸ª <strong>Partition</strong> å¯ä»¥æœ‰å¤šä¸ª <strong>Replica</strong> (å‰¯æœ¬)ã€‚å…¶ä¸­ä¸€ä¸ª Replica æ˜¯ <strong>Leader</strong>ï¼Œè´Ÿè´£è¯»å†™ï¼›å…¶ä»–æ˜¯ <strong>Follower</strong>ï¼Œåªè´Ÿè´£ä» Leader åŒæ­¥æ•°æ®ã€‚Replica ä¹Ÿåˆ†å¸ƒåœ¨ä¸åŒçš„ Broker ä¸Šï¼Œæä¾›å®¹é”™èƒ½åŠ›ã€‚</li>
</ul>
<h3 id="Producer-çš„-acks-å‚æ•°æœ‰å“ªå‡ ç§ï¼Ÿåˆ†åˆ«ä»£è¡¨ä»€ä¹ˆå«ä¹‰ï¼Ÿ"><a href="#Producer-çš„-acks-å‚æ•°æœ‰å“ªå‡ ç§ï¼Ÿåˆ†åˆ«ä»£è¡¨ä»€ä¹ˆå«ä¹‰ï¼Ÿ" class="headerlink" title="Producer çš„ acks å‚æ•°æœ‰å“ªå‡ ç§ï¼Ÿåˆ†åˆ«ä»£è¡¨ä»€ä¹ˆå«ä¹‰ï¼Ÿ"></a>Producer çš„ <code>acks</code> <strong>å‚æ•°æœ‰å“ªå‡ ç§ï¼Ÿåˆ†åˆ«ä»£è¡¨ä»€ä¹ˆå«ä¹‰ï¼Ÿ</strong></h3><ul>
<li><code>**acks=0**</code>: Producer å‘é€æ¶ˆæ¯å<strong>ä¸ç­‰å¾…</strong> Broker çš„ä»»ä½•ç¡®è®¤ã€‚<strong>æœ€é«˜ååï¼Œæœ€ä½å»¶è¿Ÿï¼Œæœ€ä½å¯é æ€§</strong> (å¯èƒ½ä¸¢å¤±æ•°æ®)ã€‚</li>
<li><code>**acks=1**</code>: Producer å‘é€æ¶ˆæ¯åï¼Œç­‰å¾… <strong>Leader å‰¯æœ¬æˆåŠŸå†™å…¥æœ¬åœ°æ—¥å¿—</strong> çš„ç¡®è®¤ã€‚<strong>æŠ˜ä¸­æ–¹æ¡ˆ</strong>ã€‚Leader æ•…éšœä½†æ•°æ®æœªåŒæ­¥åˆ° Follower æ—¶å¯èƒ½ä¸¢å¤±æ•°æ®ã€‚</li>
<li><code>**acks=all**</code> <strong>(æˆ–</strong> <code>**acks=-1**</code><strong>)</strong>: Producer å‘é€æ¶ˆæ¯åï¼Œç­‰å¾… <strong>Leader æ”¶åˆ°æ¶ˆæ¯å¹¶ç¡®è®¤è¯¥æ¶ˆæ¯å·²è¢«å½“å‰ ISR é›†åˆä¸­çš„æ‰€æœ‰å‰¯æœ¬æˆåŠŸå†™å…¥æœ¬åœ°æ—¥å¿—</strong>ã€‚<strong>æœ€é«˜å¯é æ€§</strong>ï¼Œæœ€ä½ä¸¢å¤±é£é™©ï¼Œä½†å»¶è¿Ÿæœ€é«˜ï¼Œååå¯èƒ½æœ€ä½ã€‚éœ€è¦é…åˆ <code>**min.insync.replicas**</code> å‚æ•°ä½¿ç”¨ã€‚</li>
</ul>
<h3 id="è§£é‡Š-Consumer-Group-å’Œ-Rebalance-çš„æ¦‚å¿µã€‚"><a href="#è§£é‡Š-Consumer-Group-å’Œ-Rebalance-çš„æ¦‚å¿µã€‚" class="headerlink" title="è§£é‡Š Consumer Group å’Œ Rebalance çš„æ¦‚å¿µã€‚"></a>è§£é‡Š Consumer Group å’Œ Rebalance çš„æ¦‚å¿µã€‚</h3><ul>
<li><strong>Consumer Group (CG):</strong> ä¸€ç»„ Consumer å®ä¾‹çš„é›†åˆï¼Œå®ƒä»¬å…±åŒæ¶ˆè´¹ä¸€ä¸ªæˆ–å¤šä¸ª Topicã€‚ç»„å†…æ¶ˆè´¹å®ä¾‹<strong>åä½œæ¶ˆè´¹</strong>è®¢é˜… Topic çš„æ‰€æœ‰ Partitionã€‚ä¸€ä¸ª Partition åªèƒ½è¢«ç»„å†…<strong>ä¸€ä¸ª</strong> Consumer å®ä¾‹æ¶ˆè´¹ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</li>
<li><strong>Rebalance (é‡å¹³è¡¡):</strong> å½“ä»¥ä¸‹æƒ…å†µå‘ç”Ÿæ—¶ï¼ŒKafka ä¼šé‡æ–°åˆ†é… CG å†… Consumer è´Ÿè´£çš„ Partitionï¼š</li>
<li>ç»„å†… Consumer æ•°é‡å˜åŒ– (æ–° Consumer åŠ å…¥ã€Consumer å´©æºƒæˆ–ä¸»åŠ¨ç¦»å¼€)ã€‚</li>
<li>è®¢é˜…çš„ Topic Partition æ•°é‡å˜åŒ– (å¦‚ Topic è¢«ä¿®æ”¹å¢åŠ äº† Partition)ã€‚</li>
<li>è®¢é˜…çš„ Topic æœ¬èº«å˜åŒ–ã€‚</li>
<li><strong>å½±å“:</strong> Rebalance æœŸé—´ï¼Œæ•´ä¸ª CG ä¼š<strong>çŸ­æš‚åœæ­¢æ¶ˆè´¹</strong>ï¼Œç›´åˆ°åˆ†é…å®Œæˆã€‚é¢‘ç¹æˆ–é•¿æ—¶é—´çš„ Rebalance ä¼šå½±å“æ¶ˆè´¹è¿›åº¦å’Œç³»ç»Ÿç¨³å®šæ€§ã€‚</li>
</ul>
<h3 id="Kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ"><a href="#Kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ" class="headerlink" title="Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ"></a>Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ</h3><ul>
<li><strong>Producer ç«¯:</strong></li>
<li>è®¾ç½® <code>**acks=all**</code>ï¼Œç¡®ä¿æ¶ˆæ¯è¢« ISR æ‰€æœ‰å‰¯æœ¬ç¡®è®¤ã€‚</li>
<li>ä½¿ç”¨å¸¦å›è°ƒçš„å¼‚æ­¥å‘é€æˆ–åŒæ­¥å‘é€ï¼Œæ­£ç¡®å¤„ç†å‘é€å¤±è´¥ï¼ˆé‡è¯• + ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼‰ã€‚</li>
<li>è®¾ç½® <code>**retries**</code> &gt; 0 å’Œåˆç†çš„ <code>**retry.backoff.ms**</code>ã€‚</li>
<li><strong>Broker ç«¯:</strong></li>
<li>è®¾ç½® <code>**unclean.leader.election.enable=false**</code>ï¼Œé˜²æ­¢è½åå¤ªå¤šçš„é ISR å‰¯æœ¬æˆä¸º Leaderï¼ˆå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼‰ã€‚</li>
<li>è®¾ç½® <code>**replication.factor &gt;= 3**</code>ï¼Œä¿è¯è¶³å¤Ÿçš„å‰¯æœ¬æ•°ã€‚</li>
<li>è®¾ç½® <code>**min.insync.replicas &gt; 1**</code> (é€šå¸¸ &#x3D; <code>**replication.factor - 1**</code>)ï¼Œç¡®ä¿ ISR æœ€å°å­˜æ´»å‰¯æœ¬æ•°ã€‚å½“ ISR æ•°é‡ä¸è¶³ <code>**min.insync.replicas**</code> æ—¶ï¼ŒProducer <code>**acks=all**</code> çš„è¯·æ±‚ä¼šå¤±è´¥ã€‚</li>
<li>ç¡®ä¿ Broker ç£ç›˜å¯é  (RAIDï¼Œç›‘æ§)ã€‚</li>
<li><strong>Consumer ç«¯:</strong></li>
<li>å…³é—­è‡ªåŠ¨æäº¤ (<code>**enable.auto.commit=false**</code>)ï¼Œåœ¨æ¶ˆæ¯<strong>ä¸šåŠ¡é€»è¾‘å¤„ç†å®Œæˆå¹¶ç¡®è®¤æˆåŠŸå</strong>å†<strong>æ‰‹åŠ¨æäº¤ Offset</strong>ã€‚</li>
<li>å¤„ç†å¥½æ¶ˆè´¹é€»è¾‘å¼‚å¸¸ï¼Œé¿å…å› å¼‚å¸¸å¯¼è‡´æ¶ˆæ¯æœªå¤„ç†ä½† Offset å·²æäº¤ã€‚</li>
</ul>
<h3 id="è§£é‡Š-Kafka-çš„-ISR-æœºåˆ¶åŠå…¶åœ¨-Leader-é€‰ä¸¾ä¸­çš„ä½œç”¨ã€‚"><a href="#è§£é‡Š-Kafka-çš„-ISR-æœºåˆ¶åŠå…¶åœ¨-Leader-é€‰ä¸¾ä¸­çš„ä½œç”¨ã€‚" class="headerlink" title="è§£é‡Š Kafka çš„ ISR æœºåˆ¶åŠå…¶åœ¨ Leader é€‰ä¸¾ä¸­çš„ä½œç”¨ã€‚"></a>è§£é‡Š Kafka çš„ ISR æœºåˆ¶åŠå…¶åœ¨ Leader é€‰ä¸¾ä¸­çš„ä½œç”¨ã€‚</h3><ul>
<li><strong>ISR (In-Sync Replicas):</strong> æŒ‡ä¸ Partition Leader å‰¯æœ¬<strong>ä¿æŒåŒæ­¥</strong>çš„ Follower å‰¯æœ¬é›†åˆã€‚Leader ç»´æŠ¤ ISR åˆ—è¡¨ã€‚</li>
<li><strong>åŒæ­¥æ ‡å‡†:</strong> Follower å‰¯æœ¬åœ¨ <code>**replica.lag.time.max.ms**</code> æ—¶é—´å†…æˆåŠŸä» Leader æ‹‰å–åˆ°æœ€æ–°æ•°æ®ã€‚</li>
<li><strong>Leader é€‰ä¸¾:</strong> å½“ Leader å‰¯æœ¬æ‰€åœ¨ Broker å®•æœºæ—¶ï¼ŒController ä¼š<strong>ä»å½“å‰ ISR é›†åˆä¸­é€‰æ‹©ä¸€ä¸ªå‰¯æœ¬</strong>ä½œä¸ºæ–°çš„ Leaderã€‚è¿™æ˜¯ä¸ºäº†ä¿è¯æ–° Leader æ‹¥æœ‰æœ€æ–°çš„å·²æäº¤æ•°æ®ï¼Œé¿å…æ•°æ®ä¸¢å¤±æˆ–ä¸ä¸€è‡´ã€‚</li>
<li><code>**unclean.leader.election.enable**</code><strong>:</strong></li>
<li><code>**false**</code> (é»˜è®¤æ¨è): å¿…é¡»ä» ISR ä¸­é€‰ä¸¾ Leaderã€‚å¦‚æœ ISR ä¸ºç©ºï¼Œåˆ™åˆ†åŒºä¸å¯ç”¨ï¼ˆç‰ºç‰²å¯ç”¨æ€§ä¿ä¸€è‡´æ€§ï¼‰ã€‚</li>
<li><code>**true**</code>: å…è®¸ä»é ISR (ä¸åŒæ­¥) çš„å‰¯æœ¬ä¸­é€‰ä¸¾ Leaderã€‚å¯èƒ½ä¸¢å¤±æ•°æ®æˆ–å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼ˆç‰ºç‰²ä¸€è‡´æ€§ä¿å¯ç”¨æ€§ï¼‰ã€‚</li>
</ul>
<h3 id="Kafka-å¦‚ä½•å®ç°-Exactly-Once-è¯­ä¹‰ï¼Ÿ"><a href="#Kafka-å¦‚ä½•å®ç°-Exactly-Once-è¯­ä¹‰ï¼Ÿ" class="headerlink" title="Kafka å¦‚ä½•å®ç° Exactly-Once è¯­ä¹‰ï¼Ÿ"></a>Kafka å¦‚ä½•å®ç° Exactly-Once è¯­ä¹‰ï¼Ÿ</h3><ul>
<li><strong>å¹‚ç­‰æ€§ (Idempotence -</strong> <code>**enable.idempotence=true**</code><strong>)ï¼š</strong></li>
<li>è§£å†³å•ä¸ª Producer ä¼šè¯å†…å‘é€<strong>å•åˆ†åŒº</strong>çš„<strong>é‡å¤</strong>é—®é¢˜ (at-least-once å¼•èµ·çš„é‡å¤)ã€‚</li>
<li>åŸç†ï¼šProducer ä¸ºæ¯ä¸ªå‘é€æ‰¹æ¬¡åˆ†é…å”¯ä¸€ PID (Producer ID) å’Œåºåˆ—å· (Sequence Number)ã€‚Broker æ ¹æ® PID+Partition+SeqNum å»é‡ï¼Œä¸¢å¼ƒé‡å¤çš„æ‰¹æ¬¡ã€‚</li>
<li><strong>äº‹åŠ¡ (Transactions)ï¼š</strong></li>
<li>è§£å†³è·¨åˆ†åŒºã€è·¨ä¼šè¯çš„â€œè¯»-å¤„ç†-å†™â€æ¨¡å¼ä¸‹çš„<strong>ç²¾ç¡®ä¸€æ¬¡</strong>è¯­ä¹‰ (ä¾‹å¦‚ Kafka Streams åº”ç”¨)ã€‚</li>
<li>åŸç†ï¼š</li>
<li>Producer å¼€å¯äº‹åŠ¡ (<code>**initTransactions()**</code>)ã€‚</li>
<li>å‘é€çš„æ¶ˆæ¯æ ‡è®°ä¸ºäº‹åŠ¡æ€§æ¶ˆæ¯ã€‚</li>
<li>å°†æ¶ˆè´¹å’Œç”Ÿäº§çš„ Offset æäº¤éƒ½åŒ…å«åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ (<code>**sendOffsetsToTransaction()**</code> + <code>**commitTransaction()**</code>)ã€‚</li>
<li>Broker ä½¿ç”¨äº‹åŠ¡åè°ƒå™¨ (Transaction Coordinator) ç®¡ç†äº‹åŠ¡çŠ¶æ€ (PREPARE_COMMIT, COMMITTED, ABORTED)ã€‚</li>
<li>æ¶ˆè´¹è€…é…ç½® <code>**isolation.level=read_committed**</code> åªè¯»å–å·²æäº¤çš„äº‹åŠ¡æ¶ˆæ¯ã€‚</li>
<li><strong>æ³¨æ„:</strong> ä¸¥æ ¼æ„ä¹‰çš„ç«¯åˆ°ç«¯ EOS è¿˜éœ€è¦ Consumer çš„è¾“å‡ºæ“ä½œæ˜¯å¹‚ç­‰çš„ã€‚</li>
</ul>
<h3 id="Kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ"><a href="#Kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ" class="headerlink" title="Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ"></a>Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ</h3><ul>
<li><strong>Kafka ä»…ä¿è¯å•ä¸ª Partition å†…æ¶ˆæ¯çš„ä¸¥æ ¼é¡ºåº (FIFO)ã€‚</strong> è¿™æ˜¯ç”±å…¶è¿½åŠ å†™å…¥å’Œå•çº¿ç¨‹æ¶ˆè´¹åˆ†åŒºçš„ç‰¹æ€§ä¿è¯çš„ã€‚</li>
<li><strong>æ— æ³•ä¿è¯è·¨ Partition çš„æ¶ˆæ¯å…¨å±€é¡ºåºã€‚</strong></li>
<li><strong>éœ€è¦å…¨å±€é¡ºåºæ€ä¹ˆåŠï¼Ÿ</strong> å°†æ‰€æœ‰éœ€è¦ä¿è¯é¡ºåºçš„æ¶ˆæ¯å‘é€åˆ°<strong>åŒä¸€ä¸ª Partition</strong>ã€‚é€šå¸¸é€šè¿‡ä¸ºè¿™äº›æ¶ˆæ¯æŒ‡å®š<strong>ç›¸åŒçš„ Key</strong> æ¥å®ç° (Producer æ ¹æ® Key çš„å“ˆå¸Œå€¼å†³å®š Partition)ã€‚</li>
<li><strong>éœ€è¦åˆ†åŒºé¡ºåºæ€ä¹ˆåŠï¼Ÿ</strong> ç¡®ä¿åŒä¸€ä¸ª Key çš„æ¶ˆæ¯æ€»æ˜¯å‘åˆ°åŒä¸€ä¸ª Partition (åŒæ ·é€šè¿‡ Key å“ˆå¸Œ)ï¼Œåˆ™è¯¥ Key ç›¸å…³çš„æ¶ˆæ¯åœ¨è¯¥ Partition å†…æ˜¯é¡ºåºçš„ã€‚</li>
</ul>
<h3 id="Kafka-ä¸­-Zookeeper-å’Œ-KRaft-çš„åŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆ-Kafka-è¦å»-Zookeeper-åŒ–ï¼Ÿ"><a href="#Kafka-ä¸­-Zookeeper-å’Œ-KRaft-çš„åŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆ-Kafka-è¦å»-Zookeeper-åŒ–ï¼Ÿ" class="headerlink" title="Kafka ä¸­ Zookeeper å’Œ KRaft çš„åŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆ Kafka è¦å» Zookeeper åŒ–ï¼Ÿ"></a>Kafka ä¸­ Zookeeper å’Œ KRaft çš„åŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆ Kafka è¦å» Zookeeper åŒ–ï¼Ÿ</h3><ul>
<li><strong>Zookeeper (ZK)ï¼š</strong> æ˜¯ Kafka 2.7 åŠä¹‹å‰ç‰ˆæœ¬çš„æ ¸å¿ƒå¤–éƒ¨ä¾èµ–ã€‚è´Ÿè´£ï¼š<ul>
<li>Broker æ³¨å†Œä¸å‘ç°</li>
<li>Controller é€‰ä¸¾</li>
<li>Topic é…ç½®å­˜å‚¨</li>
<li>ACL æƒé™å­˜å‚¨</li>
<li>(æ—§ç‰ˆ) Consumer Offset å­˜å‚¨</li>
</ul>
</li>
<li><strong>KRaftï¼š</strong> æ˜¯ Kafka å†…éƒ¨å®ç°çš„åŸºäº Raft å…±è¯†åè®®çš„å…ƒæ•°æ®ç®¡ç†ç³»ç»Ÿï¼Œä» Kafka 2.8 (é¢„è§ˆ) &#x2F; 3.0+ (ç”Ÿäº§å¯ç”¨) å¼€å§‹å¼•å…¥ï¼Œæ—¨åœ¨å®Œå…¨å–ä»£ Zookeeperã€‚</li>
<li><strong>å» ZK åŒ–åŸå›  (KRaft ä¼˜åŠ¿)ï¼š</strong><ul>
<li><strong>ç®€åŒ–æ¶æ„ä¸éƒ¨ç½²ï¼š</strong> ç§»é™¤å¤–éƒ¨ä¾èµ–ï¼ŒKafka è‡ªåŒ…å«ï¼Œéƒ¨ç½²ã€é…ç½®ã€ç›‘æ§æ›´ç®€å•ã€‚</li>
<li><strong>æå‡æ€§èƒ½ä¸å¯ä¼¸ç¼©æ€§ï¼š</strong> å…ƒæ•°æ®æ“ä½œç›´æ¥åœ¨ Kafka åè®®ä¸Šå¤„ç†ï¼Œå‡å°‘ä¸€æ¬¡ç½‘ç»œè·³è½¬å’Œåºåˆ—åŒ–å¼€é”€ã€‚KRaft è®¾è®¡ä¸Šèƒ½æ›´å¥½åœ°æ”¯æŒå¤§è§„æ¨¡é›†ç¾¤ï¼ˆæ•°ä¸‡ä¸ª Partitionï¼‰ã€‚</li>
<li><strong>æ›´å¼ºçš„å…ƒæ•°æ®ä¸€è‡´æ€§æ¨¡å‹ï¼š</strong> KRaft ä½¿ç”¨ Raft å¼ºä¸€è‡´æ€§åè®®ç®¡ç†å…ƒæ•°æ®çŠ¶æ€æœºã€‚</li>
<li><strong>æ›´ç›´æ¥çš„è¿ç»´ï¼š</strong> æ‰€æœ‰æ“ä½œé€šè¿‡ Kafka API æˆ– <code>**kafka-metadata-shell**</code> å®Œæˆï¼Œæ— éœ€å•ç‹¬ç®¡ç† ZKã€‚</li>
<li><strong>ç»Ÿä¸€å®‰å…¨æ¨¡å‹ï¼š</strong> å…ƒæ•°æ®é€šä¿¡å¤ç”¨ Kafka çš„å®‰å…¨æœºåˆ¶ (SSL&#x2F;SASL)ï¼Œæ— éœ€å•ç‹¬é…ç½® ZK å®‰å…¨ã€‚</li>
<li><strong>ç°çŠ¶ï¼š</strong> KRaft å·²æˆä¸ºç”Ÿäº§æ¨èæ¨¡å¼ï¼Œæ–°é›†ç¾¤åº”ä¼˜å…ˆä½¿ç”¨ KRaftã€‚Zookeeper æ¨¡å¼åœ¨é€æ­¥æ·˜æ±°ã€‚</li>
</ul>
</li>
</ul>
<h3 id="ä»€ä¹ˆæ˜¯-Consumer-Lagï¼Ÿå¦‚ä½•ç›‘æ§å’Œå¤„ç†-Lagï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Consumer-Lagï¼Ÿå¦‚ä½•ç›‘æ§å’Œå¤„ç†-Lagï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Consumer Lagï¼Ÿå¦‚ä½•ç›‘æ§å’Œå¤„ç† Lagï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Consumer Lagï¼Ÿå¦‚ä½•ç›‘æ§å’Œå¤„ç† Lagï¼Ÿ</h3><ul>
<li><strong>å®šä¹‰ï¼š</strong> Consumer Lag æŒ‡ Consumer Group åœ¨æŸä¸ª Partition ä¸Š<strong>æœ€æ–°æäº¤çš„ Offset</strong> ä¸ <strong>Partition å½“å‰æœ€æ–°æ¶ˆæ¯çš„ Offset (LEO)</strong> ä¹‹é—´çš„å·®å€¼ã€‚å³ <strong>æœªæ¶ˆè´¹çš„æ¶ˆæ¯æ•°é‡</strong>ã€‚</li>
<li><strong>ç›‘æ§é‡è¦æ€§ï¼š</strong> Lag æ˜¯è¡¡é‡æ¶ˆè´¹å¥åº·çŠ¶å†µçš„å…³é”®æŒ‡æ ‡ã€‚æŒç»­å¢é•¿çš„ Lag æ„å‘³ç€æ¶ˆè´¹é€Ÿåº¦è·Ÿä¸ä¸Šç”Ÿäº§é€Ÿåº¦ï¼Œå¯èƒ½å¯¼è‡´å»¶è¿Ÿå’Œæ•°æ®ç§¯å‹</li>
<li><strong>åŸå› ï¼š</strong><ul>
<li>æ¶ˆè´¹è€…å¤„ç†èƒ½åŠ›ä¸è¶³ (CPU, å†…å­˜, é€»è¾‘å¤æ‚, I&#x2F;O æ…¢)ã€‚</li>
<li>æ¶ˆè´¹è€…å®ä¾‹æ•°é‡ä¸è¶³ (Partition æ•° &gt; Consumer å®ä¾‹æ•°)ã€‚</li>
<li>ä¸‹æ¸¸ç³»ç»Ÿæ•…éšœæˆ–æ…¢ã€‚</li>
<li>æ¶ˆè´¹è€…ä»£ç  Bug æˆ–é…ç½®é—®é¢˜ (å¦‚ <code>**max.poll.records**</code> å¤ªå¤§å¯¼è‡´å•æ¬¡å¤„ç†æ—¶é—´è¿‡é•¿)ã€‚</li>
<li>ç½‘ç»œé—®é¢˜ã€‚</li>
</ul>
</li>
<li><strong>å¤„ç†ï¼š</strong><ul>
<li><strong>ç›‘æ§:</strong> ä½¿ç”¨ Kafka è‡ªå¸¦å·¥å…· (<code>**kafka-consumer-groups.sh**</code>)ï¼ŒJMX æŒ‡æ ‡ (&#96;&#96;&#96;, <code>**,** </code>, &#96;&#96;)ï¼Œæˆ–ç¬¬ä¸‰æ–¹ç›‘æ§ç³»ç»Ÿ (Prometheus+Grafana, Confluent Control Center)ã€‚</li>
<li><strong>æ‰©å®¹ï¼š</strong> å¢åŠ  Consumer Group å†…çš„ Consumer å®ä¾‹æ•° (ç¡®ä¿ &lt;&#x3D; Partition æ•°)ã€‚</li>
<li><strong>ä¼˜åŒ–æ¶ˆè´¹è€…ï¼š</strong> æå‡å• Consumer å¤„ç†èƒ½åŠ› (ä¼˜åŒ–ä»£ç é€»è¾‘ã€å¼‚æ­¥å¤„ç†ã€æ‰¹å¤„ç†ã€è°ƒä¼˜ JVM)ã€‚</li>
<li><strong>è°ƒæ•´å‚æ•°ï¼š</strong> é€‚å½“å¢åŠ  <code>**fetch.min.bytes**</code>, <code>**fetch.max.wait.ms**</code> æé«˜æ‹‰å–æ•ˆç‡ï¼›è°ƒæ•´ <code>**max.poll.records**</code> é¿å…å•æ¬¡å¤„ç†è¿‡å¤šæ¶ˆæ¯è¶…æ—¶ï¼›æ£€æŸ¥ <code>**session.timeout.ms**</code> å’Œ <code>**max.poll.interval.ms**</code> é¿å…è¯¯åˆ¤ç¦»çº¿è§¦å‘ Rebalanceã€‚</li>
<li><strong>æ’æŸ¥ä¸‹æ¸¸ä¾èµ–ã€‚</strong></li>
</ul>
</li>
</ul>
<h3 id="kafkaä¸»è¦åº”ç”¨åœºæ™¯ï¼šå¼‚æ­¥ã€å‰Šå³°ã€è§£è€¦"><a href="#kafkaä¸»è¦åº”ç”¨åœºæ™¯ï¼šå¼‚æ­¥ã€å‰Šå³°ã€è§£è€¦" class="headerlink" title="kafkaä¸»è¦åº”ç”¨åœºæ™¯ï¼šå¼‚æ­¥ã€å‰Šå³°ã€è§£è€¦"></a>kafkaä¸»è¦åº”ç”¨åœºæ™¯ï¼šå¼‚æ­¥ã€å‰Šå³°ã€è§£è€¦</h3><p>å¼‚æ­¥ï¼šç¼©çŸ­å“åº”æ—¶é—´</p>
<p>å®é™…åº”ç”¨</p>
<p>å‰Šå³°ï¼š</p>
<p>è§£è€¦ï¼š</p>
<h2 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h2><h2 id="RocketMQ"><a href="#RocketMQ" class="headerlink" title="RocketMQ"></a>RocketMQ</h2><h1 id="å¼€å‘æ¡†æ¶"><a href="#å¼€å‘æ¡†æ¶" class="headerlink" title="å¼€å‘æ¡†æ¶"></a>å¼€å‘æ¡†æ¶</h1><h2 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h2><h3 id="å¾ªç¯ä¾èµ–è§£å†³åŸç†"><a href="#å¾ªç¯ä¾èµ–è§£å†³åŸç†" class="headerlink" title="å¾ªç¯ä¾èµ–è§£å†³åŸç†"></a>å¾ªç¯ä¾èµ–è§£å†³åŸç†</h3><p>Spring é€šè¿‡<strong>ä¸‰çº§ç¼“å­˜ï¼ˆä¸‰çº§ Map ç»“æ„ï¼‰</strong>è§£å†³å•ä¾‹ Bean çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå…¶æ ¸å¿ƒåŸç†æ˜¯<strong>æå‰æš´éœ²æœªå®Œæˆåˆå§‹åŒ–çš„ Bean å¼•ç”¨</strong>ï¼Œä»è€Œæ‰“ç ´å¾ªç¯ä¾èµ–çš„åƒµå±€ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åŸç†å’Œæµç¨‹ï¼š</p>
<p><strong>ä¸‰çº§ç¼“å­˜çš„å®šä¹‰ä¸ä½œç”¨</strong></p>
<ol>
<li><strong>ä¸€çº§ç¼“å­˜ï¼ˆsingletonObjectsï¼‰</strong><br>å­˜æ”¾<strong>å®Œå…¨åˆå§‹åŒ–å¥½çš„ Bean</strong>ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</li>
<li><strong>äºŒçº§ç¼“å­˜ï¼ˆearlySingletonObjectsï¼‰</strong><br>å­˜æ”¾<strong>æå‰æš´éœ²çš„ Bean çš„æ—©æœŸå¼•ç”¨</strong>ï¼ˆä»…å®ä¾‹åŒ–ï¼Œå°šæœªå¡«å……å±æ€§å’Œåˆå§‹åŒ–ï¼‰ã€‚</li>
<li><strong>ä¸‰çº§ç¼“å­˜ï¼ˆsingletonFactoriesï¼‰</strong><br>å­˜æ”¾ Bean çš„ <strong>ObjectFactory</strong>ï¼Œç”¨äºç”Ÿæˆ Bean çš„æ—©æœŸå¼•ç”¨ï¼ˆå¯èƒ½ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œç”¨äºæ”¯æŒ AOPï¼‰ã€‚</li>
</ol>
<p><strong>è§£å†³å¾ªç¯ä¾èµ–çš„æµç¨‹</strong></p>
<p>ä»¥ <code>A â†’ B â†’ A</code> çš„å¾ªç¯ä¾èµ–ä¸ºä¾‹ï¼š</p>
<ol>
<li><strong>åˆ›å»º Bean A</strong></li>
</ol>
<ul>
<li><strong>å®ä¾‹åŒ– A</strong>ï¼šè°ƒç”¨æ„é€ å‡½æ•°åˆ›å»º A å¯¹è±¡ï¼ˆæ­¤æ—¶å±æ€§æœªå¡«å……ï¼Œç§°ä¸ºâ€œæ—©æœŸå¯¹è±¡â€ï¼‰ã€‚</li>
<li><strong>å°† A çš„ ObjectFactory æ”¾å…¥ä¸‰çº§ç¼“å­˜</strong>ï¼š<br><code>addSingletonFactory(A_name, () -&gt; getEarlyBeanReference(A))</code><br>ï¼ˆè¿™ä¸€æ­¥æ˜¯å…³é”®ï¼Œå…è®¸åç»­ä¾èµ–é€šè¿‡ ObjectFactory è·å– A çš„æ—©æœŸå¼•ç”¨ï¼‰</li>
</ul>
<ol start="2">
<li><strong>å¡«å…… A çš„å±æ€§</strong></li>
</ol>
<ul>
<li>å‘ç° A ä¾èµ– Bï¼Œè§¦å‘ <code>getBean(B)</code>ã€‚</li>
</ul>
<ol start="3">
<li><strong>åˆ›å»º Bean B</strong></li>
</ol>
<ul>
<li><strong>å®ä¾‹åŒ– B</strong>ï¼šæ„é€ å‡½æ•°åˆ›å»º B å¯¹è±¡ã€‚</li>
<li><strong>å°† B çš„ ObjectFactory æ”¾å…¥ä¸‰çº§ç¼“å­˜</strong>ï¼š<br><code>addSingletonFactory(B_name, () -&gt; getEarlyBeanReference(B))</code></li>
</ul>
<ol start="4">
<li><strong>å¡«å…… B çš„å±æ€§</strong></li>
</ol>
<ul>
<li>å‘ç° B ä¾èµ– Aï¼Œè§¦å‘ <code>getBean(A)</code>ã€‚</li>
<li><strong>ä»ä¸‰çº§ç¼“å­˜è·å– A çš„ ObjectFactory</strong>ï¼Œç”Ÿæˆ A çš„æ—©æœŸå¼•ç”¨ï¼ˆå¯èƒ½æ˜¯åŸå§‹å¯¹è±¡æˆ–ä»£ç†å¯¹è±¡ï¼‰ã€‚</li>
<li>å°† A çš„æ—©æœŸå¼•ç”¨æ”¾å…¥äºŒçº§ç¼“å­˜ï¼Œ<strong>åŒæ—¶åˆ é™¤ä¸‰çº§ç¼“å­˜ä¸­çš„ A</strong>ã€‚</li>
</ul>
<ol start="5">
<li><strong>å®Œæˆ B çš„åˆå§‹åŒ–</strong></li>
</ol>
<ul>
<li>B çš„æ—©æœŸå¼•ç”¨æ³¨å…¥ A åï¼Œç»§ç»­å®Œæˆå…¶ä»–åˆå§‹åŒ–å’Œåç½®å¤„ç†ã€‚</li>
<li>å°† B æ”¾å…¥ä¸€çº§ç¼“å­˜ï¼Œ<strong>åˆ é™¤äºŒçº§å’Œä¸‰çº§ç¼“å­˜ä¸­çš„ B</strong>ã€‚</li>
</ul>
<ol start="6">
<li><strong>å®Œæˆ A çš„åˆå§‹åŒ–</strong></li>
</ol>
<ul>
<li>B å·²å°±ç»ªï¼ŒA æ³¨å…¥ B åå®Œæˆå±æ€§å¡«å……å’Œåˆå§‹åŒ–ã€‚</li>
<li>å°† A æ”¾å…¥ä¸€çº§ç¼“å­˜ï¼Œ<strong>åˆ é™¤äºŒçº§ç¼“å­˜ä¸­çš„ A</strong>ã€‚</li>
</ul>
<p><strong>å…³é”®è®¾è®¡ç‚¹</strong></p>
<ol>
<li><strong>ä¸ºä»€ä¹ˆéœ€è¦ä¸‰çº§ç¼“å­˜ï¼Ÿ</strong><ul>
<li><strong>æ”¯æŒ AOP ä»£ç†</strong>ï¼š<br>å¦‚æœ Bean éœ€è¦è¢«ä»£ç†ï¼Œä¸‰çº§ç¼“å­˜çš„ ObjectFactory å¯ä»¥å»¶è¿Ÿç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œç¡®ä¿ä¾èµ–æ³¨å…¥çš„æ˜¯æœ€ç»ˆä»£ç†å¯¹è±¡ï¼Œè€ŒéåŸå§‹å¯¹è±¡ã€‚</li>
<li><strong>é¿å…é‡å¤åˆ›å»ºä»£ç†</strong>ï¼š<br>äºŒçº§ç¼“å­˜ï¼ˆ<code>earlySingletonObjects</code>ï¼‰ä¿å­˜å·²ç”Ÿæˆçš„æ—©æœŸå¯¹è±¡ï¼ˆå¯èƒ½æ˜¯ä»£ç†ï¼‰ï¼Œé¿å…å¤šæ¬¡è°ƒç”¨ ObjectFactoryã€‚</li>
</ul>
</li>
<li><strong>åªèƒ½è§£å†³å•ä¾‹ Bean çš„å¾ªç¯ä¾èµ–</strong><br>åŸå‹ï¼ˆPrototypeï¼‰Bean æ¯æ¬¡éƒ½ä¼šæ–°å»ºå®ä¾‹ï¼Œæ— æ³•é€šè¿‡ç¼“å­˜æå‰æš´éœ²å¼•ç”¨ã€‚</li>
<li><strong>æ„é€ å‡½æ•°å¾ªç¯ä¾èµ–æ— æ³•è§£å†³</strong><br>è‹¥å¾ªç¯ä¾èµ–é€šè¿‡æ„é€ å‡½æ•°å‘ç”Ÿï¼ŒBean å°šæœªå®ä¾‹åŒ–ï¼Œæ— æ³•æå‰æš´éœ²å¼•ç”¨ï¼ŒSpring ä¼šæŠ›å‡º <code>BeanCurrentlyInCreationException</code>ã€‚</li>
</ol>
<p><strong>æ€»ç»“</strong></p>
<p>Spring é€šè¿‡ä¸‰çº§ç¼“å­˜å®ç°ï¼š</p>
<ol>
<li><strong>æå‰æš´éœ²æœªåˆå§‹åŒ–çš„ Bean å¼•ç”¨</strong>ï¼ˆé€šè¿‡ ObjectFactoryï¼‰ã€‚</li>
<li><strong>å»¶è¿Ÿä»£ç†å¯¹è±¡çš„ç”Ÿæˆ</strong>ï¼Œç¡®ä¿ä¾èµ–æ³¨å…¥æ­£ç¡®çš„å¯¹è±¡ã€‚</li>
<li><strong>ç¼“å­˜å±‚çº§éš”ç¦»</strong>ï¼Œå¹³è¡¡æ€§èƒ½ä¸æ­£ç¡®æ€§ã€‚</li>
</ol>
<p>è¿™ä¸€æœºåˆ¶ä½¿å¾—å¤§å¤šæ•°å•ä¾‹ Bean çš„å¾ªç¯ä¾èµ–é—®é¢˜å¾—ä»¥è§£å†³ï¼ŒåŒæ—¶ä¿æŒäº†æ¡†æ¶çš„çµæ´»æ€§å’Œæ‰©å±•æ€§ã€‚</p>
<h3 id="FactoryBean-çš„ä½œç”¨ä¸åº”ç”¨"><a href="#FactoryBean-çš„ä½œç”¨ä¸åº”ç”¨" class="headerlink" title="FactoryBean çš„ä½œç”¨ä¸åº”ç”¨"></a><code>FactoryBean</code> çš„ä½œç”¨ä¸åº”ç”¨</h3><p><strong>1. FactoryBean çš„æ ¸å¿ƒä½œç”¨</strong><br>FactoryBean æ˜¯ Spring æ¡†æ¶ä¸­ç”¨äº <strong>å°è£…å¤æ‚å¯¹è±¡åˆ›å»ºé€»è¾‘</strong> çš„ç‰¹æ®Šæ¥å£ï¼Œå…¶æ ¸å¿ƒä½œç”¨å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>éšè—å¤æ‚æ„é€ è¿‡ç¨‹</strong>ï¼šå°†åˆå§‹åŒ–ç¹ççš„å¯¹è±¡ï¼ˆå¦‚ç¬¬ä¸‰æ–¹åº“ç»„ä»¶ï¼‰çš„åˆ›å»ºç»†èŠ‚å°è£…åœ¨ FactoryBean ä¸­ã€‚</li>
<li><strong>åŠ¨æ€å†³å®šå¯¹è±¡ç±»å‹</strong>ï¼šæ ¹æ®æ¡ä»¶è¿”å›ä¸åŒç±»å‹çš„ Bean å®ä¾‹ã€‚</li>
<li><strong>å»¶è¿Ÿåˆå§‹åŒ–</strong>ï¼šæ§åˆ¶å¯¹è±¡çš„åˆ›å»ºæ—¶æœºï¼Œå®ç°æŒ‰éœ€åŠ è½½ã€‚</li>
<li><strong>ç»Ÿä¸€ç®¡ç†ä¾èµ–</strong>ï¼šé›†ä¸­å¤„ç†å¯¹è±¡åˆ›å»ºæ—¶çš„ä¾èµ–æ³¨å…¥åŠé…ç½®ã€‚</li>
</ul>
<p><strong>2. FactoryBean æ¥å£æ–¹æ³•è§£æ</strong><br>å®ç° <code>FactoryBean</code> æ¥å£éœ€é‡å†™ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<table>
<thead>
<tr>
<th align="left">æ–¹æ³•å</th>
<th align="left">ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>T getObject()</code></td>
<td align="left">è¿”å›ç”± FactoryBean åˆ›å»ºçš„å®é™…å¯¹è±¡å®ä¾‹ã€‚</td>
</tr>
<tr>
<td align="left"><code>Class&lt;?&gt; getObjectType()</code></td>
<td align="left">è¿”å›åˆ›å»ºçš„å¯¹è±¡ç±»å‹ï¼Œç”¨äº Spring å®¹å™¨ç±»å‹æ£€æŸ¥ã€‚</td>
</tr>
<tr>
<td align="left"><code>boolean isSingleton()</code></td>
<td align="left">å†³å®šå¯¹è±¡æ˜¯å¦ä¸ºå•ä¾‹ã€‚é»˜è®¤ <code>true</code>ï¼Œè‹¥è¿”å› <code>false</code> åˆ™æ¯æ¬¡è¯·æ±‚åˆ›å»ºæ–°å®ä¾‹ã€‚</td>
</tr>
</tbody></table>
<p><strong>3. å®é™…åº”ç”¨ç¤ºä¾‹ï¼šè‡ªå®šä¹‰åŠ å¯†å·¥å…· FactoryBean</strong><br>å‡è®¾éœ€åˆ›å»ºä¸€ä¸ªæ ¹æ®é…ç½®åŠ¨æ€é€‰æ‹©åŠ å¯†ç®—æ³•çš„å·¥å…·ç±»ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p><strong>æ­¥éª¤ 1ï¼šå®šä¹‰åŠ å¯†æ¥å£åŠå®ç°ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EncryptionTool</span> &#123;</span><br><span class="line">    String <span class="title function_">encrypt</span><span class="params">(String text)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AES åŠ å¯†å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AesEncryptionTool</span> <span class="keyword">implements</span> <span class="title class_">EncryptionTool</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encrypt</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;AESåŠ å¯†åçš„æ•°æ®: &quot;</span> + text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// RSA åŠ å¯†å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RsaEncryptionTool</span> <span class="keyword">implements</span> <span class="title class_">EncryptionTool</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encrypt</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;RSAåŠ å¯†åçš„æ•°æ®: &quot;</span> + text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ­¥éª¤ 2ï¼šå®ç° EncryptionToolFactoryBean</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.FactoryBean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EncryptionToolFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;EncryptionTool&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> String algorithm; <span class="comment">// é…ç½®å±æ€§ï¼Œå†³å®šåŠ å¯†ç®—æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®ç®—æ³•ç±»å‹ï¼ˆé€šè¿‡Springå±æ€§æ³¨å…¥ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAlgorithm</span><span class="params">(String algorithm)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.algorithm = algorithm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> EncryptionTool <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;AES&quot;</span>.equalsIgnoreCase(algorithm)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AesEncryptionTool</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;RSA&quot;</span>.equalsIgnoreCase(algorithm)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RsaEncryptionTool</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;ä¸æ”¯æŒçš„åŠ å¯†ç®—æ³•: &quot;</span> + algorithm);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> EncryptionTool.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// å•ä¾‹æ¨¡å¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ­¥éª¤ 3ï¼šé…ç½® Spring Bean</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- XML é…ç½®æ–¹å¼ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;encryptionTool&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.EncryptionToolFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;algorithm&quot;</span> <span class="attr">value</span>=<span class="string">&quot;AES&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ–ä½¿ç”¨ Java é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FactoryBean&lt;EncryptionTool&gt; <span class="title function_">encryptionTool</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">EncryptionToolFactoryBean</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EncryptionToolFactoryBean</span>();</span><br><span class="line">        factory.setAlgorithm(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ­¥éª¤ 4ï¼šåœ¨ä¸šåŠ¡ç±»ä¸­æ³¨å…¥ä½¿ç”¨</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EncryptionTool encryptionTool;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">encrypted</span> <span class="operator">=</span> encryptionTool.encrypt(password);</span><br><span class="line">        System.out.println(<span class="string">&quot;åŠ å¯†åçš„å¯†ç : &quot;</span> + encrypted);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ‰§è¡Œç»“æœ</strong>ï¼š<br>æ ¹æ®é…ç½®çš„ <code>algorithm</code> å€¼ï¼ˆAES æˆ– RSAï¼‰ï¼Œ<code>UserService</code> å°†è‡ªåŠ¨ä½¿ç”¨å¯¹åº”çš„åŠ å¯†å·¥å…·ã€‚</p>
<p><strong>4. è·å– FactoryBean å®ä¾‹æœ¬èº«</strong><br>è‹¥éœ€ç›´æ¥è·å– <code>FactoryBean</code> è€Œéå…¶åˆ›å»ºçš„å¯¹è±¡ï¼Œå¯åœ¨ Bean åç§°å‰åŠ  <code>&amp;</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FactoryBean&lt;?&gt; factory = context.getBean(<span class="string">&quot;&amp;encryptionTool&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>5. å®é™…åº”ç”¨åœºæ™¯æ€»ç»“</strong></p>
<ul>
<li><strong>MyBatis çš„ SqlSessionFactoryBean</strong>ï¼šå°è£… <code>SqlSessionFactory</code> çš„åˆ›å»ºï¼Œå¤„ç†æ•°æ®æºã€Mapper æ‰«æç­‰å¤æ‚é…ç½®ã€‚</li>
<li><strong>Spring çš„ ScheduledTaskFactoryBean</strong>ï¼šç”¨äºåŠ¨æ€åˆ›å»ºå®šæ—¶ä»»åŠ¡ Beanã€‚</li>
<li><strong>è¿æ¥æ± é…ç½®</strong>ï¼šå¦‚è‡ªå®šä¹‰ Druid æ•°æ®æºçš„è¯¦ç»†å‚æ•°åˆå§‹åŒ–ã€‚</li>
<li><strong>åŠ¨æ€ä»£ç†ç”Ÿæˆ</strong>ï¼šç»“åˆ AOPï¼Œä¸ºç‰¹å®šæ¥å£ç”Ÿæˆä»£ç†å®ä¾‹ã€‚</li>
</ul>
<p><strong>6. å¯¹æ¯”æ™®é€š @Bean æ–¹æ³•</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>ç‰¹æ€§</strong></th>
<th align="left"><strong>FactoryBean</strong></th>
<th align="left"><strong>@Bean æ–¹æ³•</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>çµæ´»æ€§</strong></td>
<td align="left">é«˜ï¼ˆå¯åŠ¨æ€å†³å®šå¯¹è±¡ç±»å‹ï¼Œå®ç°å¤æ‚åˆå§‹åŒ–é€»è¾‘ï¼‰</td>
<td align="left">ä¸­ï¼ˆé€‚åˆç®€å•å¯¹è±¡åˆ›å»ºï¼‰</td>
</tr>
<tr>
<td align="left"><strong>ä»£ç å¤ç”¨</strong></td>
<td align="left">å¯é€šè¿‡ç»§æ‰¿å¤ç”¨é€»è¾‘</td>
<td align="left">éœ€é‡å¤ç¼–å†™ç›¸ä¼¼ä»£ç </td>
</tr>
<tr>
<td align="left"><strong>ç”Ÿå‘½å‘¨æœŸæ§åˆ¶</strong></td>
<td align="left">æ”¯æŒå»¶è¿Ÿåˆå§‹åŒ–åŠå•ä¾‹æ§åˆ¶</td>
<td align="left">ä¾èµ– <code>@Lazy</code> å’Œ <code>@Scope</code> æ³¨è§£</td>
</tr>
<tr>
<td align="left"><strong>é€‚ç”¨åœºæ™¯</strong></td>
<td align="left">å¤æ‚å¯¹è±¡åˆ›å»ºã€æ¡†æ¶é›†æˆ</td>
<td align="left">ç®€å• Bean å®šä¹‰ã€å¿«é€Ÿé…ç½®</td>
</tr>
</tbody></table>
<p><strong>æ€»ç»“</strong><br>FactoryBean æ˜¯ Spring ä¸­å¤„ç†å¤æ‚å¯¹è±¡åˆ›å»ºçš„å¼ºå¤§å·¥å…·ï¼Œç‰¹åˆ«é€‚ç”¨äºå°è£…åˆå§‹åŒ–é€»è¾‘ã€åŠ¨æ€ç”Ÿæˆå®ä¾‹åŠæ¡†æ¶é›†æˆã€‚åˆç†ä½¿ç”¨ FactoryBean èƒ½æ˜¾è‘—æå‡ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼Œå°¤å…¶åœ¨éœ€è¦ç²¾ç»†æ§åˆ¶ Bean åˆ›å»ºè¿‡ç¨‹æ—¶ï¼Œå…¶ä¼˜åŠ¿æ›´ä¸ºæ˜æ˜¾ã€‚</p>
<h3 id="BeanFactoryPostProcessor-å’Œ-BeanPostProcessor-çš„åŒºåˆ«"><a href="#BeanFactoryPostProcessor-å’Œ-BeanPostProcessor-çš„åŒºåˆ«" class="headerlink" title="BeanFactoryPostProcessor å’Œ BeanPostProcessor çš„åŒºåˆ«"></a><code>BeanFactoryPostProcessor</code> å’Œ <code>BeanPostProcessor</code> çš„åŒºåˆ«</h3><table>
<thead>
<tr>
<th align="left"><strong>ç‰¹æ€§</strong></th>
<th align="left"><strong>BeanFactoryPostProcessor</strong></th>
<th align="left"><strong>BeanPostProcessor</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>ä½œç”¨é˜¶æ®µ</strong></td>
<td align="left">Bean å®šä¹‰åŠ è½½åã€Bean å®ä¾‹åŒ–<strong>ä¹‹å‰</strong></td>
<td align="left">Bean å®ä¾‹åŒ–åã€åˆå§‹åŒ–ï¼ˆ<code>init-method</code>ï¼‰<strong>å‰å</strong></td>
</tr>
<tr>
<td align="left"><strong>æ“ä½œå¯¹è±¡</strong></td>
<td align="left">ä¿®æ”¹ Bean çš„<strong>å®šä¹‰</strong>ï¼ˆ<code>BeanDefinition</code>ï¼‰</td>
<td align="left">ä¿®æ”¹æˆ–å¢å¼º Bean çš„<strong>å®ä¾‹</strong></td>
</tr>
<tr>
<td align="left"><strong>è§¦å‘æ¬¡æ•°</strong></td>
<td align="left">æ¯ä¸ªå®¹å™¨å¯åŠ¨æ—¶<strong>æ‰§è¡Œä¸€æ¬¡</strong></td>
<td align="left"><strong>æ¯ä¸ª Bean åˆå§‹åŒ–æ—¶éƒ½ä¼šè§¦å‘</strong></td>
</tr>
<tr>
<td align="left"><strong>ä¸»è¦ç”¨é€”</strong></td>
<td align="left">åŠ¨æ€ä¿®æ”¹ Bean é…ç½®ï¼ˆå¦‚å±æ€§å ä½ç¬¦æ›¿æ¢ï¼‰</td>
<td align="left">Bean å®ä¾‹çš„ä»£ç†å¢å¼ºï¼ˆå¦‚ AOPï¼‰ã€å±æ€§æ³¨å…¥</td>
</tr>
<tr>
<td align="left"><strong>æ¥å£æ–¹æ³•</strong></td>
<td align="left"><code>postProcessBeanFactory(ConfigurableListableBeanFactory)</code></td>
<td align="left"><code>postProcessBeforeInitialization(Object, String)</code> <code>postProcessAfterInitialization(Object, String)</code></td>
</tr>
<tr>
<td align="left"><strong>å…¸å‹å®ç°ç±»</strong></td>
<td align="left"><code>PropertySourcesPlaceholderConfigurer</code> <code>ConfigurationClassPostProcessor</code></td>
<td align="left"><code>AutowiredAnnotationBeanPostProcessor</code> <code>AnnotationAwareAspectJAutoProxyCreator</code></td>
</tr>
</tbody></table>
<p><strong>æ€»ç»“</strong></p>
<ul>
<li><strong>BeanFactoryPostProcessor</strong>ï¼šå¹²é¢„ Bean çš„<strong>å®šä¹‰é˜¶æ®µ</strong>ï¼Œç”¨äºå®¹å™¨çº§é…ç½®è°ƒæ•´ã€‚</li>
<li><strong>BeanPostProcessor</strong>ï¼šå¹²é¢„ Bean çš„<strong>å®ä¾‹åŒ–é˜¶æ®µ</strong>ï¼Œç”¨äº Bean çº§åŠŸèƒ½å¢å¼ºã€‚</li>
</ul>
<h3 id="Beanç”Ÿå‘½å‘¨æœŸæ‰©å±•ç‚¹å®æˆ˜"><a href="#Beanç”Ÿå‘½å‘¨æœŸæ‰©å±•ç‚¹å®æˆ˜" class="headerlink" title="Beanç”Ÿå‘½å‘¨æœŸæ‰©å±•ç‚¹å®æˆ˜"></a>Beanç”Ÿå‘½å‘¨æœŸæ‰©å±•ç‚¹å®æˆ˜</h3><p>Spring Bean ç”Ÿå‘½å‘¨æœŸçš„æ ¸å¿ƒé˜¶æ®µå’Œæ‰©å±•ç‚¹é¡ºåºï¼š</p>
<ol>
<li><strong>å®ä¾‹åŒ–</strong>ï¼ˆè°ƒç”¨æ„é€ å‡½æ•°ï¼‰</li>
<li><strong>å±æ€§èµ‹å€¼</strong>ï¼ˆä¾èµ–æ³¨å…¥ï¼‰</li>
<li><strong>BeanPostProcessor å‰ç½®å¤„ç†</strong>ï¼ˆ<code>postProcessBeforeInitialization</code>ï¼‰</li>
<li><strong>åˆå§‹åŒ–æ–¹æ³•</strong>ï¼ˆ<code>@PostConstruct</code> â†’ <code>InitializingBean</code> â†’ <code>init-method</code>ï¼‰</li>
<li><strong>BeanPostProcessor åç½®å¤„ç†</strong>ï¼ˆ<code>postProcessAfterInitialization</code>ï¼‰</li>
<li><strong>Bean å°±ç»ªï¼Œè¿›å…¥è¿è¡ŒæœŸ</strong></li>
<li><strong>é”€æ¯æ–¹æ³•</strong>ï¼ˆ<code>@PreDestroy</code> â†’ <code>DisposableBean</code> â†’ <code>destroy-method</code>ï¼‰</li>
</ol>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-942a927a-86e4-4a01-8f52-9addd89642ff.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring Beanç”Ÿå‘½å‘¨æœŸ"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AbstractAutowireCapableBeanFactory</span></span><br><span class="line"><span class="keyword">protected</span> Object <span class="title function_">doCreateBean</span><span class="params">(String beanName, RootBeanDefinition mbd, <span class="meta">@Nullable</span> Object[] args)</span></span><br><span class="line">        <span class="keyword">throws</span> BeanCreationException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Instantiate the bean.</span></span><br><span class="line">    <span class="type">BeanWrapper</span> <span class="variable">instanceWrapper</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (mbd.isSingleton()) &#123;</span><br><span class="line">        instanceWrapper = <span class="built_in">this</span>.factoryBeanInstanceCache.remove(beanName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (instanceWrapper == <span class="literal">null</span>) &#123;</span><br><span class="line">        instanceWrapper = createBeanInstance(beanName, mbd, args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> instanceWrapper.getWrappedInstance();</span><br><span class="line">    Class&lt;?&gt; beanType = instanceWrapper.getWrappedClass();</span><br><span class="line">    <span class="keyword">if</span> (beanType != NullBean.class) &#123;</span><br><span class="line">        mbd.resolvedTargetType = beanType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Allow post-processors to modify the merged bean definition.</span></span><br><span class="line">    <span class="keyword">synchronized</span> (mbd.postProcessingLock) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!mbd.postProcessed) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(mbd.getResourceDescription(), beanName,</span><br><span class="line">                        <span class="string">&quot;Post-processing of merged bean definition failed&quot;</span>, ex);</span><br><span class="line">            &#125;</span><br><span class="line">            mbd.postProcessed = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Eagerly cache singletons to be able to resolve circular references</span></span><br><span class="line">    <span class="comment">// even when triggered by lifecycle interfaces like BeanFactoryAware.</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">earlySingletonExposure</span> <span class="operator">=</span> (mbd.isSingleton() &amp;&amp; <span class="built_in">this</span>.allowCircularReferences &amp;&amp;</span><br><span class="line">            isSingletonCurrentlyInCreation(beanName));</span><br><span class="line">    <span class="keyword">if</span> (earlySingletonExposure) &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">            logger.trace(<span class="string">&quot;Eagerly caching bean &#x27;&quot;</span> + beanName +</span><br><span class="line">                    <span class="string">&quot;&#x27; to allow for resolving potential circular references&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize the bean instance.</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">exposedObject</span> <span class="operator">=</span> bean;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        populateBean(beanName, mbd, instanceWrapper);</span><br><span class="line">        exposedObject = initializeBean(beanName, exposedObject, mbd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> BeanCreationException &amp;&amp; beanName.equals(((BeanCreationException) ex).getBeanName())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> (BeanCreationException) ex;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(</span><br><span class="line">                    mbd.getResourceDescription(), beanName, <span class="string">&quot;Initialization of bean failed&quot;</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (earlySingletonExposure) &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">earlySingletonReference</span> <span class="operator">=</span> getSingleton(beanName, <span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (earlySingletonReference != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (exposedObject == bean) &#123;</span><br><span class="line">                exposedObject = earlySingletonReference;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">this</span>.allowRawInjectionDespiteWrapping &amp;&amp; hasDependentBean(beanName)) &#123;</span><br><span class="line">                String[] dependentBeans = getDependentBeans(beanName);</span><br><span class="line">                Set&lt;String&gt; actualDependentBeans = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;(dependentBeans.length);</span><br><span class="line">                <span class="keyword">for</span> (String dependentBean : dependentBeans) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!removeSingletonIfCreatedForTypeCheckOnly(dependentBean)) &#123;</span><br><span class="line">                        actualDependentBeans.add(dependentBean);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!actualDependentBeans.isEmpty()) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCurrentlyInCreationException</span>(beanName,</span><br><span class="line">                            <span class="string">&quot;Bean with name &#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27; has been injected into other beans [&quot;</span> +</span><br><span class="line">                            StringUtils.collectionToCommaDelimitedString(actualDependentBeans) +</span><br><span class="line">                            <span class="string">&quot;] in its raw version as part of a circular reference, but has eventually been &quot;</span> +</span><br><span class="line">                            <span class="string">&quot;wrapped. This means that said other beans do not use the final version of the &quot;</span> +</span><br><span class="line">                            <span class="string">&quot;bean. This is often the result of over-eager type matching - consider using &quot;</span> +</span><br><span class="line">                            <span class="string">&quot;&#x27;getBeanNamesForType&#x27; with the &#x27;allowEagerInit&#x27; flag turned off, for example.&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Register bean as disposable.</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        registerDisposableBeanIfNecessary(beanName, bean, mbd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (BeanDefinitionValidationException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(</span><br><span class="line">                mbd.getResourceDescription(), beanName, <span class="string">&quot;Invalid destruction signature&quot;</span>, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> exposedObject;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SpringBootè‡ªåŠ¨é…ç½®åŸç†"><a href="#SpringBootè‡ªåŠ¨é…ç½®åŸç†" class="headerlink" title="SpringBootè‡ªåŠ¨é…ç½®åŸç†"></a>SpringBootè‡ªåŠ¨é…ç½®åŸç†</h3><p>Spring Bootçš„è‡ªåŠ¨é…ç½®æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼Œæ—¨åœ¨ç®€åŒ–åº”ç”¨çš„é…ç½®è¿‡ç¨‹ã€‚ä»¥ä¸‹æ˜¯å…¶å®ç°æœºåˆ¶çš„è¯¦ç»†æ­¥éª¤è§£æï¼š</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-df77ee15-2ff0-4ec7-8e65-e4ebb8ba88f1.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringBootè‡ªåŠ¨é…ç½®åŸç†"></p>
<ol>
<li><strong>å¯ç”¨è‡ªåŠ¨é…ç½®</strong></li>
</ol>
<p>é€šè¿‡ä¸»ç±»ä¸Šçš„<code>@SpringBootApplication</code>æ³¨è§£ï¼Œè¯¥æ³¨è§£ç»„åˆäº†<code>@EnableAutoConfiguration</code>ï¼Œä»è€Œè§¦å‘è‡ªåŠ¨é…ç½®æœºåˆ¶ã€‚</p>
<ol start="2">
<li><strong>åŠ è½½è‡ªåŠ¨é…ç½®ç±»</strong></li>
</ol>
<p>Spring Bootä¼šæ‰«ææ‰€æœ‰jaråŒ…ä¸­çš„<code>META-INF/spring.factories</code>æ–‡ä»¶ï¼Œè¯»å–<code>org.springframework.boot.autoconfigure.EnableAutoConfiguration</code>é”®ä¸‹çš„é…ç½®ç±»åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="string">\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>æ¡ä»¶åŒ–ç­›é€‰é…ç½®ç±»</strong></li>
</ol>
<p>æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»ä½¿ç”¨æ¡ä»¶æ³¨è§£å†³å®šæ˜¯å¦ç”Ÿæ•ˆï¼Œå¸¸è§æ¡ä»¶åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>@ConditionalOnClass</strong>ï¼šç±»è·¯å¾„å­˜åœ¨æŒ‡å®šç±»æ—¶ç”Ÿæ•ˆã€‚</li>
<li><strong>@ConditionalOnMissingBean</strong>ï¼šå®¹å™¨ä¸­æ— æŒ‡å®šBeanæ—¶ç”Ÿæ•ˆã€‚</li>
<li><strong>@ConditionalOnProperty</strong>ï¼šé…ç½®æ–‡ä»¶ä¸­å­˜åœ¨ç‰¹å®šå±æ€§æ—¶ç”Ÿæ•ˆã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼šDataSourceAutoConfiguration</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;DataSource.class, EmbeddedDatabaseType.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(DataSourceProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">(DataSourceProperties properties)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> properties.initializeDataSourceBuilder().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>@ConditionalOnClass</strong>ç¡®ä¿å­˜åœ¨æ•°æ®åº“ç›¸å…³ç±»ã€‚</li>
<li><strong>@ConditionalOnMissingBean</strong>ä»…åœ¨ç”¨æˆ·æœªè‡ªå®šä¹‰DataSourceæ—¶åˆ›å»ºBeanã€‚</li>
</ul>
<ol start="4">
<li><strong>ç»‘å®šé…ç½®å±æ€§</strong></li>
</ol>
<p>ä½¿ç”¨<code>@EnableConfigurationProperties</code>å°†é…ç½®å±æ€§ç±»ï¼ˆå¦‚<code>DataSourceProperties</code>ï¼‰ä¸é…ç½®æ–‡ä»¶ï¼ˆå¦‚<code>application.yml</code>ï¼‰ç»‘å®šï¼Œå…è®¸é€šè¿‡å±æ€§åŠ¨æ€é…ç½®Beanã€‚</p>
<p><strong>application.ymlç¤ºä¾‹</strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mydb</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">secret</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li><strong>è‡ªåŠ¨é…ç½®Beançš„æ³¨å†Œ</strong></li>
</ol>
<p>æ»¡è¶³æ¡ä»¶çš„é…ç½®ç±»ä¸­çš„Beanå®šä¹‰è¢«æ³¨å†Œåˆ°Springåº”ç”¨ä¸Šä¸‹æ–‡ï¼Œä¾›å…¶ä»–ç»„ä»¶æ³¨å…¥ä½¿ç”¨ã€‚</p>
<h3 id="è‡ªå®šä¹‰Starterå¼€å‘è¦ç‚¹"><a href="#è‡ªå®šä¹‰Starterå¼€å‘è¦ç‚¹" class="headerlink" title="è‡ªå®šä¹‰Starterå¼€å‘è¦ç‚¹"></a>è‡ªå®šä¹‰Starterå¼€å‘è¦ç‚¹</h3><p><strong>1. Starter çš„æ ¸å¿ƒç»„æˆ</strong></p>
<p>ä¸€ä¸ªå®Œæ•´çš„ Starter åŒ…å«ä¸¤ä¸ªæ¨¡å—ï¼ˆå¯åˆå¹¶ï¼‰ï¼š</p>
<ol>
<li><strong><code>xxx-spring-boot-starter</code></strong><br>ç©ºæ¨¡å—ï¼Œä»…å£°æ˜ä¾èµ–ï¼ˆå¦‚è‡ªåŠ¨é…ç½®æ¨¡å—å’Œå…¶ä»–å¿…è¦ä¾èµ–ï¼‰ï¼Œä¾›ç”¨æˆ·ç›´æ¥å¼•å…¥ã€‚</li>
<li><strong><code>xxx-spring-boot-autoconfigure</code></strong><br>æ ¸å¿ƒå®ç°æ¨¡å—ï¼ŒåŒ…å«è‡ªåŠ¨é…ç½®ç±»ã€æ¡ä»¶æ³¨è§£ã€é…ç½®å±æ€§ç»‘å®šç­‰ã€‚</li>
</ol>
<p><strong>2. å¼€å‘æ­¥éª¤ä¸å…³é”®ä»£ç </strong></p>
<p><strong>æ­¥éª¤ 1ï¼šåˆ›å»ºé¡¹ç›®ç»“æ„</strong></p>
<p>ä½¿ç”¨ Maven æˆ– Gradle åˆ›å»ºæ¨¡å—ï¼Œå»ºè®®ç»“æ„ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">my-starter/</span><br><span class="line">  â”œâ”€â”€ my-starter-spring-boot-autoconfigure/  # è‡ªåŠ¨é…ç½®æ¨¡å—</span><br><span class="line">  â”‚   â”œâ”€â”€ src/main/java</span><br><span class="line">  â”‚   â”‚   â””â”€â”€ com/example/autoconfigure</span><br><span class="line">  â”‚   â”‚       â”œâ”€â”€ MyServiceAutoConfiguration.java  # è‡ªåŠ¨é…ç½®ç±»</span><br><span class="line">  â”‚   â”‚       â””â”€â”€ MyServiceProperties.java         # é…ç½®å±æ€§ç±»</span><br><span class="line">  â”‚   â””â”€â”€ src/main/resources/META-INF</span><br><span class="line">  â”‚       â”œâ”€â”€ spring.factories                    # è‡ªåŠ¨é…ç½®æ³¨å†Œ</span><br><span class="line">  â”‚       â””â”€â”€ additional-spring-configuration-metadata.json  # é…ç½®æç¤ºï¼ˆå¯é€‰ï¼‰</span><br><span class="line">  â”‚</span><br><span class="line">  â””â”€â”€ my-starter-spring-boot-starter/         # Starter å…¥å£æ¨¡å—</span><br><span class="line">      â””â”€â”€ pom.xml                             # ä»…ä¾èµ–è‡ªåŠ¨é…ç½®æ¨¡å—</span><br></pre></td></tr></table></figure>

<p><strong>æ­¥éª¤ 2ï¼šç¼–å†™è‡ªåŠ¨é…ç½®ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(MyServiceProperties.class)</span>  <span class="comment">// å¯ç”¨é…ç½®å±æ€§ç»‘å®š</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(MyService.class)</span>  <span class="comment">// ç±»è·¯å¾„å­˜åœ¨ MyService æ—¶ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServiceAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span>  <span class="comment">// ç”¨æˆ·æœªè‡ªå®šä¹‰æ—¶æ³¨å†Œ Bean</span></span><br><span class="line">    <span class="keyword">public</span> MyService <span class="title function_">myService</span><span class="params">(MyServiceProperties properties)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyService</span>(properties.getUrl(), properties.getTimeout());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ­¥éª¤ 3ï¼šå®šä¹‰é…ç½®å±æ€§ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;my.service&quot;)</span>  <span class="comment">// é…ç½®å‰ç¼€</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServiceProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://default-url&quot;</span>;  <span class="comment">// é»˜è®¤å€¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">timeout</span> <span class="operator">=</span> <span class="number">5000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getter å’Œ Setter å¿…é¡»æä¾›</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUrl</span><span class="params">()</span> &#123; <span class="keyword">return</span> url; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUrl</span><span class="params">(String url)</span> &#123; <span class="built_in">this</span>.url = url; &#125;</span><br><span class="line">    <span class="comment">// ... å…¶ä»–å±æ€§</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ­¥éª¤ 4ï¼šæ³¨å†Œè‡ªåŠ¨é…ç½®ç±»</strong></p>
<p>åœ¨ <code>resources/META-INF/spring.factories</code> ä¸­å£°æ˜ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="string">\</span></span><br><span class="line"><span class="string">com.example.autoconfigure.MyServiceAutoConfiguration</span></span><br></pre></td></tr></table></figure>

<p><strong>æ­¥éª¤ 5ï¼šé…ç½®æç¤ºï¼ˆå¯é€‰ï¼‰</strong></p>
<p>åœ¨ <code>resources/META-INF/additional-spring-configuration-metadata.json</code> ä¸­ä¸ºé…ç½®é¡¹æ·»åŠ æè¿°ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my.service.url&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java.lang.String&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æœåŠ¡ URL åœ°å€&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;defaultValue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://default-url&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my.service.timeout&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java.lang.Integer&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;defaultValue&quot;</span><span class="punctuation">:</span> <span class="number">5000</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>æ­¥éª¤ 6ï¼šæ‰“åŒ…å¹¶å‘å¸ƒ</strong></p>
<ul>
<li><strong>Maven</strong>ï¼šé€šè¿‡ <code>mvn clean install</code> å®‰è£…åˆ°æœ¬åœ°ä»“åº“ï¼Œæˆ–éƒ¨ç½²åˆ° Nexus ç§æœã€‚</li>
<li><strong>Gradle</strong>ï¼šä½¿ç”¨ <code>publishToMavenLocal</code> æˆ–é…ç½®å‘å¸ƒä»»åŠ¡ã€‚</li>
</ul>
<p><strong>3. ä½¿ç”¨è‡ªå®šä¹‰ Starter</strong></p>
<p>ç”¨æˆ·å¼•å…¥ä¾èµ–åï¼Œå¯ç›´æ¥é€šè¿‡é…ç½®æ–‡ä»¶ï¼ˆå¦‚ <code>application.yml</code>ï¼‰é…ç½®å‚æ•°ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">my:</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://custom-url</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure>

<p><strong>4. å…³é”®æ³¨æ„äº‹é¡¹</strong></p>
<ol>
<li><p><strong>æ¡ä»¶åŒ–é…ç½®</strong><br>ä½¿ç”¨ <code>@ConditionalOnClass</code>, <code>@ConditionalOnProperty</code> ç­‰æ³¨è§£ï¼Œç¡®ä¿ Starter çµæ´»é€‚é…ä¸åŒåœºæ™¯ã€‚</p>
</li>
<li><p><strong>é¿å… Bean å†²çª</strong></p>
<ul>
<li>æ ¸å¿ƒ Bean ä½¿ç”¨ <code>@ConditionalOnMissingBean</code>ï¼Œå…è®¸ç”¨æˆ·è¦†ç›–ã€‚</li>
<li>é¿å…ä¸å…¶ä»– Starter çš„ Bean åç§°é‡å¤ã€‚</li>
</ul>
</li>
<li><p><strong>ç‰ˆæœ¬å…¼å®¹æ€§</strong></p>
<ul>
<li>Starter çš„ Spring Boot ç‰ˆæœ¬éœ€ä¸ç”¨æˆ·é¡¹ç›®åŒ¹é…ã€‚</li>
<li>ä½¿ç”¨ <code>spring-boot-dependencies</code> ç®¡ç†ä¾èµ–ç‰ˆæœ¬ã€‚</li>
</ul>
</li>
<li><p><strong>ä¾èµ–èŒƒå›´æ§åˆ¶</strong></p>
<ul>
<li>éå¿…è¦ä¾èµ–æ ‡è®°ä¸º <code>optional</code>ï¼ˆMavenï¼‰æˆ– <code>optional = true</code>ï¼ˆGradleï¼‰ï¼Œé¿å…ä¼ é€’ä¾èµ–æ±¡æŸ“ç”¨æˆ·é¡¹ç›®ã€‚</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Maven ç¤ºä¾‹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>some-library<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æ—¥å¿—ä¸æ–‡æ¡£</strong></p>
<ul>
<li>åœ¨ Starter ä¸­æä¾›æ¸…æ™°çš„æ—¥å¿—è¾“å‡ºï¼Œå¸®åŠ©ç”¨æˆ·è°ƒè¯•ã€‚</li>
<li>ç¼–å†™ README è¯´æ˜é…ç½®é¡¹å’Œä½¿ç”¨ç¤ºä¾‹ã€‚</li>
</ul>
</li>
</ol>
<p><strong>5. æµ‹è¯• Starter</strong></p>
<p>ç¼–å†™æµ‹è¯•ç±»éªŒè¯è‡ªåŠ¨é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServiceAutoConfigurationTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="keyword">private</span> MyService myService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAutoConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">        assertNotNull(myService);</span><br><span class="line">        assertEquals(<span class="string">&quot;http://custom-url&quot;</span>, myService.getUrl());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>6. æœ€ä½³å®è·µ</strong></p>
<ul>
<li><strong>æ¨¡å—åŒ–è®¾è®¡</strong>ï¼šå°†è‡ªåŠ¨é…ç½®ä¸ Starter åˆ†ç¦»ï¼Œæ–¹ä¾¿å…¶ä»–æ¨¡å—å¤ç”¨ã€‚</li>
<li><strong>é˜²å¾¡æ€§ç¼–ç¨‹</strong>ï¼šåœ¨è‡ªåŠ¨é…ç½®ç±»ä¸­æ£€æŸ¥ä¾èµ–æ˜¯å¦å­˜åœ¨ï¼ˆå¦‚é€šè¿‡ <code>@ConditionalOnClass</code>ï¼‰ã€‚</li>
<li><strong>é»˜è®¤é…ç½®åˆç†</strong>ï¼šæä¾›å®‰å…¨ã€é€šç”¨çš„é»˜è®¤å€¼ï¼Œå‡å°‘ç”¨æˆ·é…ç½®è´Ÿæ‹…ã€‚</li>
</ul>
<h3 id="ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µ"><a href="#ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µ" class="headerlink" title="ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µ"></a>ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µ</h3><p>ä»¥ä¸‹æ˜¯ <strong>Spring Boot ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µ</strong>ï¼Œæ¶µç›–å¼‚å¸¸åˆ†ç±»ã€å…¨å±€å¤„ç†ã€æ—¥å¿—è®°å½•ã€é”™è¯¯å“åº”è§„èŒƒç­‰å…³é”®ç¯èŠ‚ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºå¥å£®ä¸”æ˜“ç»´æŠ¤çš„åº”ç”¨ç¨‹åºï¼š</p>
<p><strong>æ ¸å¿ƒåŸåˆ™</strong></p>
<ol>
<li><strong>ç»Ÿä¸€å…¥å£</strong>ï¼šæ‰€æœ‰å¼‚å¸¸ç”±å…¨å±€å¤„ç†å™¨æ•è·ï¼Œé¿å…åˆ†æ•£åœ¨å„å¤„ã€‚</li>
<li><strong>å‹å¥½å“åº”</strong>ï¼šå‰ç«¯æ¥æ”¶ç»“æ„åŒ–é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚JSONï¼‰ï¼ŒåŒ…å«é”™è¯¯ç ã€æç¤ºæ¶ˆæ¯ç­‰ã€‚</li>
<li><strong>åˆ†ç±»å¤„ç†</strong>ï¼šåŒºåˆ†ä¸šåŠ¡å¼‚å¸¸ã€ç³»ç»Ÿå¼‚å¸¸ã€å‚æ•°æ ¡éªŒå¼‚å¸¸ç­‰ï¼Œé’ˆå¯¹æ€§å¤„ç†ã€‚</li>
<li><strong>å®‰å…¨æ—¥å¿—</strong>ï¼šæ•æ„Ÿä¿¡æ¯è„±æ•ï¼Œå¼‚å¸¸æ—¥å¿—è¯¦ç»†è®°å½•ï¼Œä½†é¿å…æš´éœ²ç»™å®¢æˆ·ç«¯ã€‚</li>
</ol>
<p><strong>å®ç°æ­¥éª¤ä¸ä»£ç ç¤ºä¾‹</strong></p>
<ol>
<li><strong>å®šä¹‰ç»Ÿä¸€å“åº”æ ¼å¼</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;    <span class="comment">// çŠ¶æ€ç ï¼ˆå¦‚200æˆåŠŸï¼Œ500ç³»ç»Ÿé”™è¯¯ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> String msg;  <span class="comment">// æç¤ºä¿¡æ¯ï¼ˆç”¨æˆ·å‹å¥½ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> T data;      <span class="comment">// å“åº”æ•°æ®</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æˆåŠŸå“åº”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">success</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;æ“ä½œæˆåŠŸ&quot;</span>, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤±è´¥å“åº”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">error</span><span class="params">(<span class="type">int</span> code, String msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>&lt;&gt;(code, msg, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ æ–¹æ³•ã€Getter/Setterçœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>åˆ›å»ºå…¨å±€å¼‚å¸¸å¤„ç†å™¨</strong></li>
</ol>
<p>ä½¿ç”¨ <code>@ControllerAdvice</code> + <code>@ExceptionHandler</code> æ•è·å…¨å±€å¼‚å¸¸ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(BusinessException.class)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Void&gt; <span class="title function_">handleBusinessException</span><span class="params">(BusinessException e)</span> &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;ä¸šåŠ¡å¼‚å¸¸: &#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> Result.error(e.getCode(), e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†å‚æ•°æ ¡éªŒå¼‚å¸¸ï¼ˆJSR-303ï¼‰</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Void&gt; <span class="title function_">handleValidationException</span><span class="params">(MethodArgumentNotValidException e)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> e.getBindingResult().getFieldErrors().stream()</span><br><span class="line">                .map(fieldError -&gt; fieldError.getField() + <span class="string">&quot;: &quot;</span> + fieldError.getDefaultMessage())</span><br><span class="line">                .collect(Collectors.joining(<span class="string">&quot;; &quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="number">400</span>, <span class="string">&quot;å‚æ•°æ ¡éªŒå¤±è´¥: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†å…¶ä»–æœªæ•è·å¼‚å¸¸</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Void&gt; <span class="title function_">handleException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;ç³»ç»Ÿå¼‚å¸¸: &quot;</span>, e);  <span class="comment">// è®°å½•å®Œæ•´å †æ ˆ</span></span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="number">500</span>, <span class="string">&quot;ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BusinessException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(<span class="type">int</span> code, String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¿«é€Ÿåˆ›å»ºå¸¸ç”¨å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> BusinessException <span class="title function_">of</span><span class="params">(<span class="type">int</span> code, String msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(code, msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123; <span class="keyword">return</span> code; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>å‚æ•°æ ¡éªŒè§„èŒƒåŒ–</strong></li>
</ol>
<p>åœ¨ DTO ä¸­ä½¿ç”¨æ ¡éªŒæ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDTO</span> &#123;</span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;ç”¨æˆ·åä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Email(message = &quot;é‚®ç®±æ ¼å¼ä¸æ­£ç¡®&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getter/Setterçœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li><strong>HTTPçŠ¶æ€ç ä¸é”™è¯¯ç æ˜ å°„</strong></li>
</ol>
<table>
<thead>
<tr>
<th align="left">å¼‚å¸¸ç±»å‹</th>
<th align="left">HTTPçŠ¶æ€ç </th>
<th align="left">é”™è¯¯ç </th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>BusinessException</code></td>
<td align="left">200</td>
<td align="left">è‡ªå®šä¹‰</td>
<td align="left">ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼ˆå¦‚è®¢å•çŠ¶æ€å¼‚å¸¸ï¼‰</td>
</tr>
<tr>
<td align="left"><code>MethodArgumentNotValid</code></td>
<td align="left">400</td>
<td align="left">400</td>
<td align="left">å‚æ•°æ ¡éªŒå¤±è´¥</td>
</tr>
<tr>
<td align="left"><code>AuthenticationException</code></td>
<td align="left">401</td>
<td align="left">401</td>
<td align="left">æœªç™»å½•æˆ–Tokenè¿‡æœŸ</td>
</tr>
<tr>
<td align="left"><code>AccessDeniedException</code></td>
<td align="left">403</td>
<td align="left">403</td>
<td align="left">æ— æƒé™è®¿é—®</td>
</tr>
<tr>
<td align="left"><code>å…¶ä»–æœªæ•è·å¼‚å¸¸</code></td>
<td align="left">500</td>
<td align="left">500</td>
<td align="left">ç³»ç»Ÿå†…éƒ¨é”™è¯¯</td>
</tr>
</tbody></table>
<p><strong>ä¸‰ã€æœ€ä½³å®è·µ</strong></p>
<ol>
<li><strong>å¼‚å¸¸åˆ†ç±»åˆ†å±‚å¤„ç†</strong></li>
</ol>
<ul>
<li><strong>ä¸šåŠ¡å¼‚å¸¸</strong>ï¼šç”±å¼€å‘è€…ä¸»åŠ¨æŠ›å‡ºï¼ˆå¦‚åº“å­˜ä¸è¶³ï¼‰ï¼Œæ˜ç¡®æç¤ºç”¨æˆ·ã€‚</li>
<li><strong>ç³»ç»Ÿå¼‚å¸¸</strong>ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥ç­‰ï¼Œæç¤ºå‹å¥½ä¿¡æ¯ï¼Œè®°å½•è¯¦ç»†æ—¥å¿—ã€‚</li>
<li><strong>ç¬¬ä¸‰æ–¹æœåŠ¡å¼‚å¸¸</strong>ï¼šå°è£…ä¸ºç‰¹å®šå¼‚å¸¸ï¼ˆå¦‚ <code>ThirdPartyException</code>ï¼‰ï¼Œé¿å…æ±¡æŸ“æ ¸å¿ƒé€»è¾‘ã€‚</li>
</ul>
<ol start="2">
<li><strong>æ—¥å¿—è®°å½•è§„èŒƒ</strong></li>
</ol>
<ul>
<li><strong>ä¸šåŠ¡å¼‚å¸¸</strong>ï¼šè®°å½• <code>WARN</code> çº§åˆ«ï¼ŒåŒ…å«å…³é”®å‚æ•°ã€‚</li>
<li><strong>ç³»ç»Ÿå¼‚å¸¸</strong>ï¼šè®°å½• <code>ERROR</code> çº§åˆ«ï¼Œè¾“å‡ºå®Œæ•´å †æ ˆã€‚</li>
<li><strong>æ•æ„Ÿä¿¡æ¯è„±æ•</strong>ï¼šå¦‚èº«ä»½è¯å·ã€æ‰‹æœºå·åœ¨æ—¥å¿—ä¸­æ©ç å¤„ç†ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(PaymentException.class)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;Void&gt; <span class="title function_">handlePaymentException</span><span class="params">(PaymentException e)</span> &#123;</span><br><span class="line">    log.warn(<span class="string">&quot;æ”¯ä»˜å¤±è´¥, è®¢å•å·: &#123;&#125;, åŸå› : &#123;&#125;&quot;</span>, e.getOrderId(), e.getMessage());</span><br><span class="line">    <span class="keyword">return</span> Result.error(<span class="number">1001</span>, <span class="string">&quot;æ”¯ä»˜å¤±è´¥ï¼Œè¯·é‡è¯•&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>é”™è¯¯ç è§„èŒƒ</strong></li>
</ol>
<ul>
<li><strong>æ¨¡å—åˆ’åˆ†</strong>ï¼šæŒ‰æ¨¡å—å®šä¹‰é”™è¯¯ç èŒƒå›´ï¼ˆå¦‚ç”¨æˆ·æ¨¡å—1000-1999ï¼‰ã€‚</li>
<li><strong>æ–‡æ¡£ç»´æŠ¤</strong>ï¼šæä¾›é”™è¯¯ç å¯¹ç…§è¡¨ï¼Œæ–¹ä¾¿å‰åç«¯åä½œã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯ç å¸¸é‡ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ErrorCode</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">USER_NOT_FOUND</span> <span class="operator">=</span> <span class="number">1001</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ORDER_EXPIRED</span> <span class="operator">=</span> <span class="number">2001</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>å‰ç«¯å‹å¥½æç¤º</strong></li>
</ol>
<ul>
<li><strong>ç”¨æˆ·å¯è§æ¶ˆæ¯</strong>ï¼šç®€æ´æ˜ç¡®ï¼Œå¦‚â€œå¯†ç å¼ºåº¦ä¸è¶³ï¼Œè‡³å°‘åŒ…å«å¤§å°å†™å­—æ¯â€ã€‚</li>
<li><strong>æŠ€æœ¯ç»†èŠ‚éš”ç¦»</strong>ï¼šä¸è¿”å›Javaå¼‚å¸¸ç±»åã€å †æ ˆä¿¡æ¯ã€‚</li>
</ul>
<ol start="5">
<li><strong>æµ‹è¯•è¦†ç›–</strong></li>
</ol>
<p>éªŒè¯å¼‚å¸¸å¤„ç†é€»è¾‘ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionHandlerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBusinessException</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        mockMvc.perform(get(<span class="string">&quot;/api/order/123&quot;</span>))</span><br><span class="line">               .andExpect(status().isOk())</span><br><span class="line">               .andExpect(jsonPath(<span class="string">&quot;$.code&quot;</span>).value(<span class="number">1001</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å››ã€å¸¸è§é—®é¢˜ä¸è§£å†³</strong></p>
<ol>
<li><strong>å¼‚å¸¸æœªè¢«æ•è·</strong><ul>
<li>æ£€æŸ¥ <code>@ControllerAdvice</code> æ˜¯å¦åœ¨ç»„ä»¶æ‰«æè·¯å¾„å†…ã€‚</li>
<li>ç¡®è®¤æ²¡æœ‰å…¶ä»–å¼‚å¸¸å¤„ç†å™¨å†²çªã€‚</li>
</ul>
</li>
<li><strong>å¾ªç¯ä¾èµ–å¯¼è‡´å¤„ç†å™¨å¤±æ•ˆ</strong><ul>
<li>ç¡®ä¿å…¨å±€å¤„ç†å™¨ä¸ä¾èµ–å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„Beanã€‚</li>
</ul>
</li>
<li><strong>å¼‚æ­¥çº¿ç¨‹å¼‚å¸¸ä¸¢å¤±</strong><ul>
<li>ä½¿ç”¨ <code>AsyncUncaughtExceptionHandler</code> å¤„ç†å¼‚æ­¥ä»»åŠ¡å¼‚å¸¸ã€‚</li>
</ul>
</li>
</ol>
<p><strong>äº”ã€æ€»ç»“</strong></p>
<p>é€šè¿‡ç»Ÿä¸€å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œå¯ä»¥å®ç°ï¼š</p>
<ul>
<li><strong>ä»£ç ç®€æ´æ€§</strong>ï¼šæ¶ˆé™¤é‡å¤çš„ <code>try-catch</code> å—ã€‚</li>
<li><strong>ç»´æŠ¤ä¾¿æ·æ€§</strong>ï¼šé›†ä¸­ç®¡ç†é”™è¯¯å“åº”é€»è¾‘ã€‚</li>
<li><strong>æ¥å£è§„èŒƒæ€§</strong>ï¼šå‰åç«¯éµå¾ªç»Ÿä¸€çš„é”™è¯¯åè®®ã€‚</li>
<li><strong>ç³»ç»Ÿå¥å£®æ€§</strong>ï¼šå…³é”®å¼‚å¸¸ä¸æ¼å¤„ç†ï¼Œæ—¥å¿—å¯è¿½æº¯ã€‚</li>
</ul>
<h3 id="é…ç½®åŠ è½½ä¼˜å…ˆçº§ï¼ˆå‘½ä»¤è¡Œ-ç¯å¢ƒå˜é‡ï¼‰"><a href="#é…ç½®åŠ è½½ä¼˜å…ˆçº§ï¼ˆå‘½ä»¤è¡Œ-ç¯å¢ƒå˜é‡ï¼‰" class="headerlink" title="é…ç½®åŠ è½½ä¼˜å…ˆçº§ï¼ˆå‘½ä»¤è¡Œ&gt;ç¯å¢ƒå˜é‡ï¼‰"></a>é…ç½®åŠ è½½ä¼˜å…ˆçº§ï¼ˆå‘½ä»¤è¡Œ&gt;ç¯å¢ƒå˜é‡ï¼‰</h3><table>
<thead>
<tr>
<th align="left">ä¼˜å…ˆçº§</th>
<th align="left">é…ç½®æº</th>
<th align="left">ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>1</strong></td>
<td align="left"><strong>å‘½ä»¤è¡Œå‚æ•°</strong></td>
<td align="left"><code>--server.port=8081</code></td>
</tr>
<tr>
<td align="left"><strong>2</strong></td>
<td align="left">Java ç³»ç»Ÿå±æ€§ (<code>-D</code>)</td>
<td align="left"><code>-Dspring.datasource.url=jdbc:mysql://...</code></td>
</tr>
<tr>
<td align="left"><strong>3</strong></td>
<td align="left"><strong>æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡</strong></td>
<td align="left"><code>export SERVER_PORT=8081</code> (Linux)</td>
</tr>
<tr>
<td align="left"><strong>4</strong></td>
<td align="left">é…ç½®æ–‡ä»¶ï¼ˆå¦‚ <code>application.yml</code>ï¼‰</td>
<td align="left"><code>server.port: 8080</code></td>
</tr>
</tbody></table>
<h3 id="Spring-AOP-å’Œ-AspectJ-æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#Spring-AOP-å’Œ-AspectJ-æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="Spring AOP å’Œ AspectJ æœ‰ä»€ä¹ˆåŒºåˆ«"></a><code>Spring AOP</code> å’Œ <code>AspectJ</code> æœ‰ä»€ä¹ˆåŒºåˆ«</h3><h3 id="è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨ã€AOPçš„åŒºåˆ«ä¸å®è·µ"><a href="#è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨ã€AOPçš„åŒºåˆ«ä¸å®è·µ" class="headerlink" title="è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨ã€AOPçš„åŒºåˆ«ä¸å®è·µ"></a>è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨ã€AOPçš„åŒºåˆ«ä¸å®è·µ</h3><table>
<thead>
<tr>
<th align="left"><strong>ç»´åº¦</strong></th>
<th align="left"><strong>è¿‡æ»¤å™¨ï¼ˆFilterï¼‰</strong></th>
<th align="left"><strong>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰</strong></th>
<th align="left"><strong>AOPï¼ˆAspectï¼‰</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>è§„èŒƒ&#x2F;æ¡†æ¶</strong></td>
<td align="left">Servlet è§„èŒƒï¼ˆJava EEï¼‰</td>
<td align="left">Spring MVC æ¡†æ¶</td>
<td align="left">Spring AOP &#x2F; AspectJ</td>
</tr>
<tr>
<td align="left"><strong>ä½œç”¨é˜¶æ®µ</strong></td>
<td align="left">è¯·æ±‚è¿›å…¥ Servlet å‰&#x2F;å“åº”è¿”å›å®¢æˆ·ç«¯å‰</td>
<td align="left">Controller æ–¹æ³•æ‰§è¡Œå‰å</td>
<td align="left">ä»»æ„ Bean æ–¹æ³•æ‰§è¡Œå‰å</td>
</tr>
<tr>
<td align="left"><strong>ä½œç”¨èŒƒå›´</strong></td>
<td align="left">æ‰€æœ‰ HTTP è¯·æ±‚ï¼ˆåŒ…æ‹¬é™æ€èµ„æºï¼‰</td>
<td align="left">Spring MVC å¤„ç†çš„è¯·æ±‚ï¼ˆåŠ¨æ€èµ„æºï¼‰</td>
<td align="left">Spring ç®¡ç†çš„ Bean æ–¹æ³•</td>
</tr>
<tr>
<td align="left"><strong>ä¾èµ–å…³ç³»</strong></td>
<td align="left">ä¾èµ– Servlet å®¹å™¨ï¼ˆTomcat&#x2F;Jettyï¼‰</td>
<td align="left">ä¾èµ– Spring å®¹å™¨</td>
<td align="left">ä¾èµ– Spring å®¹å™¨</td>
</tr>
<tr>
<td align="left"><strong>å¯è®¿é—®å¯¹è±¡</strong></td>
<td align="left">ServletRequest&#x2F;ServletResponse</td>
<td align="left">HttpServletRequest&#x2F;ModelAndView</td>
<td align="left">æ–¹æ³•å‚æ•°ã€æ³¨è§£ã€è¿”å›å€¼</td>
</tr>
<tr>
<td align="left"><strong>æ‰§è¡Œé¡ºåº</strong></td>
<td align="left">è¿‡æ»¤å™¨é“¾é¡ºåºï¼ˆweb.xml æˆ–æ³¨è§£é¡ºåºï¼‰</td>
<td align="left">æ‹¦æˆªå™¨æ³¨å†Œé¡ºåº</td>
<td align="left">åˆ‡é¢ä¼˜å…ˆçº§ï¼ˆ<code>@Order</code> æ³¨è§£ï¼‰</td>
</tr>
<tr>
<td align="left"><strong>å…¸å‹åœºæ™¯</strong></td>
<td align="left">å­—ç¬¦ç¼–ç ã€è·¨åŸŸå¤„ç†ã€è¯·æ±‚æ—¥å¿—</td>
<td align="left">æƒé™æ ¡éªŒã€å‚æ•°é¢„å¤„ç†ã€æ—¥å¿—è®°å½•</td>
<td align="left">äº‹åŠ¡ç®¡ç†ã€æ€§èƒ½ç›‘æ§ã€ç¼“å­˜æ§åˆ¶</td>
</tr>
</tbody></table>
<p><strong>æ‰§è¡Œæµç¨‹ä¸é¡ºåº</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// HTTP è¯·æ±‚å¤„ç†æµç¨‹</span><br><span class="line">HTTP Request â†’ Filter Chain â†’ DispatcherServlet â†’ Interceptor Chain â†’ Controller â†’ AOP Advice â†’ Response</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>è¿‡æ»¤å™¨ï¼ˆFilterï¼‰</strong>ï¼šæœ€å…ˆæ‰§è¡Œï¼Œå¯æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼ˆå¦‚é™æ€èµ„æºï¼‰ã€‚</li>
<li><strong>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰</strong>ï¼šåœ¨ <code>DispatcherServlet</code> ä¹‹åã€Controller æ–¹æ³•ä¹‹å‰æ‰§è¡Œã€‚</li>
<li><strong>AOP åˆ‡é¢ï¼ˆAspectï¼‰</strong>ï¼šåœ¨ Controller æˆ– Service æ–¹æ³•æ‰§è¡Œå‰åè§¦å‘ã€‚</li>
</ol>
<p><strong>å®è·µåœºæ™¯ä¸ä»£ç ç¤ºä¾‹</strong></p>
<p><strong>åœºæ™¯ 1ï¼šå…¨å±€è¯·æ±‚æ—¥å¿—ï¼ˆè·¨æ‰€æœ‰è¯·æ±‚ï¼‰</strong></p>
<ul>
<li><p><strong>é€‰æ‹©æ–¹æ¡ˆ</strong>ï¼š<strong>è¿‡æ»¤å™¨ï¼ˆFilterï¼‰</strong><br><strong>åŸå› </strong>ï¼šéœ€è®°å½•æ‰€æœ‰è¯·æ±‚ï¼ˆåŒ…æ‹¬é™æ€èµ„æºï¼‰çš„åŸå§‹ä¿¡æ¯ï¼ˆå¦‚ IPã€URLï¼‰ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter(urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest req, ServletResponse res, FilterChain chain)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        chain.doFilter(req, res); <span class="comment">// æ”¾è¡Œè¯·æ±‚</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">cost</span> <span class="operator">=</span> System.currentTimeMillis() - start;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¯·æ±‚è€—æ—¶: &quot;</span> + cost + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>åœºæ™¯ 2ï¼šç”¨æˆ·ç™»å½•æ ¡éªŒï¼ˆä»…åŠ¨æ€è¯·æ±‚ï¼‰</strong></p>
<ul>
<li><p><strong>é€‰æ‹©æ–¹æ¡ˆ</strong>ï¼š<strong>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰</strong><br><strong>åŸå› </strong>ï¼šéœ€è®¿é—® Spring ä¸Šä¸‹æ–‡ï¼ˆå¦‚è·å–ç”¨æˆ· Sessionï¼‰ï¼Œä¸”ä»…éœ€æ‹¦æˆªåŠ¨æ€è¯·æ±‚ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest req, HttpServletResponse res, Object handler)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (req.getSession().getAttribute(<span class="string">&quot;user&quot;</span>) == <span class="literal">null</span>) &#123;</span><br><span class="line">            res.sendRedirect(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// ä¸­æ–­è¯·æ±‚</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œæ‹¦æˆªå™¨</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">AuthInterceptor</span>()).addPathPatterns(<span class="string">&quot;/api/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>åœºæ™¯ 3ï¼šæ–¹æ³•çº§äº‹åŠ¡ç®¡ç†</strong></p>
<ul>
<li><p><strong>é€‰æ‹©æ–¹æ¡ˆ</strong>ï¼š<strong>AOPï¼ˆå£°æ˜å¼äº‹åŠ¡ï¼‰</strong><br><strong>åŸå› </strong>ï¼šéœ€åœ¨æ–¹æ³•æ‰§è¡Œå‰åç®¡ç†äº‹åŠ¡ï¼Œä¸ä¸šåŠ¡é€»è¾‘è§£è€¦ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionAspect</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PlatformTransactionManager txManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;@annotation(org.springframework.transaction.annotation.Transactional)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">manageTransaction</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">TransactionStatus</span> <span class="variable">status</span> <span class="operator">=</span> txManager.getTransaction(<span class="keyword">new</span> <span class="title class_">DefaultTransactionDefinition</span>());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">            txManager.commit(status);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            txManager.rollback(status);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>åœºæ™¯ 4ï¼šæ¥å£è€—æ—¶ç»Ÿè®¡</strong></p>
<ul>
<li><p><strong>é€‰æ‹©æ–¹æ¡ˆ</strong>ï¼š<strong>AOPï¼ˆç¯ç»•é€šçŸ¥ï¼‰</strong><br><strong>åŸå› </strong>ï¼šéœ€ç»Ÿè®¡ä»»æ„æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´ï¼Œçµæ´»ä½œç”¨äº Service å±‚æˆ– Controller å±‚ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PerformanceAspect</span> &#123;</span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.example.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">logTime</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œè€—æ—¶: &quot;</span> + (System.currentTimeMillis() - start) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>å¦‚ä½•é€‰æ‹©ï¼Ÿ</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>æŠ€æœ¯</strong></th>
<th align="left"><strong>ä¼˜å…ˆä½¿ç”¨åœºæ™¯</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>è¿‡æ»¤å™¨</strong></td>
<td align="left">å¤„ç†åŸå§‹è¯·æ±‚&#x2F;å“åº”ï¼ˆå¦‚è·¨åŸŸã€å‹ç¼©ï¼‰ã€å…¨å±€æ—¥å¿—ã€å®‰å…¨è¿‡æ»¤ï¼ˆXSS&#x2F;SQL æ³¨å…¥é˜²å¾¡ï¼‰</td>
</tr>
<tr>
<td align="left"><strong>æ‹¦æˆªå™¨</strong></td>
<td align="left">éœ€è¦ Spring ä¸Šä¸‹æ–‡æ”¯æŒã€åŠ¨æ€è¯·æ±‚æ‹¦æˆªï¼ˆå¦‚æƒé™æ ¡éªŒã€å‚æ•°é¢„å¤„ç†ï¼‰</td>
</tr>
<tr>
<td align="left"><strong>AOP</strong></td>
<td align="left">ä¸ä¸šåŠ¡é€»è¾‘è§£è€¦çš„æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚äº‹åŠ¡ã€æ—¥å¿—ã€ç¼“å­˜ã€æ€§èƒ½ç›‘æ§ï¼‰</td>
</tr>
</tbody></table>
<p><strong>æœ€ä½³å®è·µ</strong></p>
<ol>
<li><strong>é¿å…åŠŸèƒ½é‡å </strong>ï¼š<ul>
<li>è‹¥è¿‡æ»¤å™¨ä¸æ‹¦æˆªå™¨å®ç°ç›¸ä¼¼åŠŸèƒ½ï¼ˆå¦‚æ—¥å¿—ï¼‰ï¼Œé€‰æ‹©æ›´é è¿‘è¯·æ±‚å…¥å£çš„ç»„ä»¶ï¼ˆè¿‡æ»¤å™¨ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>æ…ç”¨ AOP æ‹¦æˆª Controller</strong>ï¼š<ul>
<li>Controller æ–¹æ³•é€šå¸¸å·²ç”±æ‹¦æˆªå™¨å¤„ç†ï¼ŒAOP æ›´é€‚åˆ Service å±‚ã€‚</li>
</ul>
</li>
<li><strong>æ³¨æ„æ‰§è¡Œé¡ºåº</strong>ï¼š<ul>
<li>å¤šä¸ªè¿‡æ»¤å™¨&#x2F;æ‹¦æˆªå™¨éœ€æ˜ç¡®é¡ºåºï¼Œé¿å…ä¾èµ–é—®é¢˜ã€‚</li>
</ul>
</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼š<ul>
<li>è¿‡æ»¤å™¨é“¾å’Œæ‹¦æˆªå™¨é“¾è¾ƒé•¿æ—¶ï¼Œå¯èƒ½å½±å“ååé‡ï¼Œéœ€åˆç†è®¾è®¡ã€‚</li>
</ul>
</li>
</ol>
<p>é€šè¿‡åˆç†é€‰æ‹©è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨å’Œ AOPï¼Œå¼€å‘è€…å¯ä»¥é«˜æ•ˆç®¡ç†æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œæå‡ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œç³»ç»Ÿæ€§èƒ½ã€‚</p>
<h3 id="æ³¨è§£çš„å®ç°åŸç†"><a href="#æ³¨è§£çš„å®ç°åŸç†" class="headerlink" title="æ³¨è§£çš„å®ç°åŸç†"></a>æ³¨è§£çš„å®ç°åŸç†</h3><p>åœ¨ Java ä¸­ï¼Œ<strong>æ³¨è§£ï¼ˆAnnotationï¼‰</strong> æ˜¯ä¸€ç§å…ƒæ•°æ®æœºåˆ¶ï¼Œå…¶æœ¬è´¨æ˜¯ä»£ç ä¸­çš„ç‰¹æ®Šæ ‡è®°ï¼Œéœ€é…åˆ <strong>æ³¨è§£å¤„ç†å™¨</strong> å®ç°å…·ä½“åŠŸèƒ½ã€‚æ³¨è§£æœ¬èº«ä¸åŒ…å«é€»è¾‘ï¼Œå…¶ä½œç”¨ç”±å¤„ç†å™¨å†³å®šã€‚ä»¥ä¸‹æ˜¯æ³¨è§£çš„å®ç°åŸç†è¯¦è§£ï¼š</p>
<p><strong>ä¸€ã€æ³¨è§£çš„æœ¬è´¨</strong></p>
<ol>
<li><strong>æ³¨è§£çš„åº•å±‚ç»“æ„</strong></li>
</ol>
<ul>
<li><p>æ³¨è§£æœ¬è´¨æ˜¯ç»§æ‰¿ <code>java.lang.annotation.Annotation</code> çš„ <strong>æ¥å£</strong>ã€‚</p>
</li>
<li><p>é€šè¿‡ JDK åŠ¨æ€ä»£ç†ç”Ÿæˆæ³¨è§£çš„å®ä¾‹ã€‚</p>
</li>
<li><p><strong>ç¤ºä¾‹</strong>ï¼šåç¼–è¯‘ <code>@Override</code> æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Override</span> <span class="keyword">extends</span> <span class="title class_">Annotation</span> &#123;</span><br><span class="line">    <span class="comment">// ç©ºæ¥å£ï¼Œä»…ä½œæ ‡è®°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li><strong>å…ƒæ³¨è§£ï¼ˆMeta-Annotationï¼‰</strong></li>
</ol>
<p>ç”¨äºå®šä¹‰æ³¨è§£çš„è¡Œä¸ºï¼Œå¸¸è§å…ƒæ³¨è§£ï¼š</p>
<table>
<thead>
<tr>
<th align="left">å…ƒæ³¨è§£</th>
<th align="left">ä½œç”¨</th>
<th align="left">ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>@Target</code></td>
<td align="left">æŒ‡å®šæ³¨è§£å¯åº”ç”¨çš„ç›®æ ‡ï¼ˆç±»ã€æ–¹æ³•ã€å­—æ®µç­‰ï¼‰</td>
<td align="left"><code>@Target(ElementType.METHOD)</code></td>
</tr>
<tr>
<td align="left"><code>@Retention</code></td>
<td align="left">æŒ‡å®šæ³¨è§£çš„ä¿ç•™ç­–ç•¥ï¼ˆæºç ã€ç±»æ–‡ä»¶ã€è¿è¡Œæ—¶ï¼‰</td>
<td align="left"><code>@Retention(RetentionPolicy.RUNTIME)</code></td>
</tr>
<tr>
<td align="left"><code>@Documented</code></td>
<td align="left">æ³¨è§£æ˜¯å¦åŒ…å«åœ¨ Javadoc ä¸­</td>
<td align="left"><code>@Documented</code></td>
</tr>
<tr>
<td align="left"><code>@Inherited</code></td>
<td align="left">å­ç±»æ˜¯å¦ç»§æ‰¿çˆ¶ç±»çš„æ³¨è§£</td>
<td align="left"><code>@Inherited</code></td>
</tr>
</tbody></table>
<p><strong>äºŒã€æ³¨è§£çš„å¤„ç†æœºåˆ¶</strong></p>
<ol>
<li><strong>ç¼–è¯‘æ—¶å¤„ç†ï¼ˆAnnotation Processing Tool, APTï¼‰</strong></li>
</ol>
<ul>
<li><p><strong>åŸç†</strong>ï¼šåœ¨ç¼–è¯‘é˜¶æ®µï¼Œé€šè¿‡æ³¨è§£å¤„ç†å™¨ï¼ˆç»§æ‰¿ <code>AbstractProcessor</code>ï¼‰æ‰«æå’Œå¤„ç†æ³¨è§£ã€‚</p>
</li>
<li><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>ç”Ÿæˆä»£ç ï¼ˆå¦‚ Lombok ç”Ÿæˆ Getter&#x2F;Setterï¼‰ã€‚</li>
<li>è¯­æ³•æ£€æŸ¥ï¼ˆå¦‚ <code>@Override</code> éªŒè¯æ–¹æ³•é‡å†™ï¼‰ã€‚</li>
</ul>
</li>
<li><p><strong>ç¤ºä¾‹</strong>ï¼šè‡ªå®šä¹‰ç¼–è¯‘æ—¶æ³¨è§£å¤„ç†å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SupportedAnnotationTypes(&quot;com.example.MyAnnotation&quot;)</span></span><br><span class="line"><span class="meta">@SupportedSourceVersion(SourceVersion.RELEASE_8)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProcessor</span> <span class="keyword">extends</span> <span class="title class_">AbstractProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment env)</span> &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†æ³¨è§£é€»è¾‘ï¼Œå¦‚ç”Ÿæˆä»£ç </span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li><strong>è¿è¡Œæ—¶å¤„ç†ï¼ˆåå°„æœºåˆ¶ï¼‰</strong></li>
</ol>
<ul>
<li><p><strong>åŸç†</strong>ï¼šé€šè¿‡åå°„ APIï¼ˆå¦‚ <code>Class.getAnnotation()</code>ï¼‰åœ¨è¿è¡Œæ—¶è¯»å–æ³¨è§£ä¿¡æ¯ã€‚</p>
</li>
<li><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>åŠ¨æ€é…ç½®ï¼ˆå¦‚ Spring çš„ <code>@Autowired</code> ä¾èµ–æ³¨å…¥ï¼‰ã€‚</li>
<li>è‡ªå®šä¹‰é€»è¾‘ï¼ˆå¦‚æƒé™æ ¡éªŒã€æ—¥å¿—è®°å½•ï¼‰ã€‚</li>
</ul>
</li>
<li><p><strong>ç¤ºä¾‹</strong>ï¼šè¯»å–æ–¹æ³•ä¸Šçš„æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> obj.getClass().getMethod(<span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (method.isAnnotationPresent(MyAnnotation.class)) &#123;</span><br><span class="line">    <span class="type">MyAnnotation</span> <span class="variable">anno</span> <span class="operator">=</span> method.getAnnotation(MyAnnotation.class);</span><br><span class="line">    System.out.println(anno.value());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li><strong>å­—èŠ‚ç å¢å¼ºå¤„ç†ï¼ˆAOP æ¡†æ¶ï¼‰</strong></li>
</ol>
<ul>
<li><strong>åŸç†</strong>ï¼šåœ¨ç±»åŠ è½½æ—¶ä¿®æ”¹å­—èŠ‚ç ï¼Œæ¤å…¥ä¸æ³¨è§£ç›¸å…³çš„é€»è¾‘ã€‚</li>
<li><strong>å·¥å…·</strong>ï¼šAspectJã€ASMã€Byte Buddyã€‚</li>
<li><strong>åº”ç”¨åœºæ™¯</strong>ï¼š<ul>
<li>å®ç° AOP åˆ‡é¢ï¼ˆå¦‚ <code>@Transactional</code> äº‹åŠ¡ç®¡ç†ï¼‰ã€‚</li>
<li>åŠ¨æ€ä»£ç†ï¼ˆå¦‚ Spring AOPï¼‰ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ä¸‰ã€æ³¨è§£å¤„ç†çš„æ ¸å¿ƒæµç¨‹</strong></p>
<ol>
<li><strong>å®šä¹‰æ³¨è§£</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> LogExecution &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;default log&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>ä½¿ç”¨æ³¨è§£</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@LogExecution(&quot;ç”¨æˆ·æŸ¥è¯¢æ–¹æ³•&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>å¤„ç†æ³¨è§£ï¼ˆä»¥è¿è¡Œæ—¶ä¸ºä¾‹ï¼‰</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">logIfNeeded</span><span class="params">(Method method)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (method.isAnnotationPresent(LogExecution.class)) &#123;</span><br><span class="line">            <span class="type">LogExecution</span> <span class="variable">log</span> <span class="operator">=</span> method.getAnnotation(LogExecution.class);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ‰§è¡Œæ—¥å¿—: &quot;</span> + log.value());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException &#123;</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> UserService.class.getMethod(<span class="string">&quot;getUser&quot;</span>);</span><br><span class="line">        logIfNeeded(method); <span class="comment">// è¾“å‡ºï¼šæ‰§è¡Œæ—¥å¿—: ç”¨æˆ·æŸ¥è¯¢æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å››ã€æ³¨è§£çš„åº•å±‚å®ç°ï¼ˆåå°„åŠ¨æ€ä»£ç†ï¼‰</strong></p>
<p>å½“ä½¿ç”¨ <code>@LogExecution</code> æ—¶ï¼ŒJVM ä¼šé€šè¿‡åŠ¨æ€ä»£ç†ç”Ÿæˆæ³¨è§£å®ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿæˆçš„ä»£ç†ç±»ï¼ˆç®€åŒ–ç‰ˆï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogExecutionProxy</span> <span class="keyword">implements</span> <span class="title class_">LogExecution</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">value</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ç”¨æˆ·æŸ¥è¯¢æ–¹æ³•&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; annotationType() &#123;</span><br><span class="line">        <span class="keyword">return</span> LogExecution.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>äº”ã€å¸¸è§æ¡†æ¶ä¸­çš„æ³¨è§£åº”ç”¨</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>æ¡†æ¶</strong></th>
<th align="left"><strong>æ³¨è§£ç¤ºä¾‹</strong></th>
<th align="left"><strong>å¤„ç†æœºåˆ¶</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>Spring</strong></td>
<td align="left"><code>@Autowired</code></td>
<td align="left">è¿è¡Œæ—¶åå°„ + ä¾èµ–æ³¨å…¥</td>
</tr>
<tr>
<td align="left"><strong>Lombok</strong></td>
<td align="left"><code>@Data</code></td>
<td align="left">ç¼–è¯‘æ—¶ APT ç”Ÿæˆä»£ç </td>
</tr>
<tr>
<td align="left"><strong>JUnit</strong></td>
<td align="left"><code>@Test</code></td>
<td align="left">è¿è¡Œæ—¶åå°„æ‰§è¡Œæµ‹è¯•æ–¹æ³•</td>
</tr>
<tr>
<td align="left"><strong>Hibernate</strong></td>
<td align="left"><code>@Entity</code></td>
<td align="left">è¿è¡Œæ—¶åå°„æ˜ å°„æ•°æ®åº“è¡¨</td>
</tr>
<tr>
<td align="left"><strong>AspectJ</strong></td>
<td align="left"><code>@Around</code></td>
<td align="left">ç¼–è¯‘æ—¶&#x2F;ç±»åŠ è½½æ—¶å­—èŠ‚ç å¢å¼º</td>
</tr>
</tbody></table>
<p><strong>å…­ã€æ³¨è§£çš„å±€é™æ€§</strong></p>
<ol>
<li><strong>æ— æ³•ç‹¬ç«‹å·¥ä½œ</strong>ï¼šå¿…é¡»ä¾èµ–å¤„ç†å™¨ï¼ˆAPTã€åå°„ã€AOP ç­‰ï¼‰ã€‚</li>
<li><strong>æ€§èƒ½å¼€é”€</strong>ï¼šè¿è¡Œæ—¶åå°„å¤„ç†å¯èƒ½å½±å“æ€§èƒ½ã€‚</li>
<li><strong>å¤æ‚åº¦é«˜</strong>ï¼šå­—èŠ‚ç å¢å¼ºéœ€æŒæ¡ ASM ç­‰å·¥å…·ã€‚</li>
</ol>
<p><strong>ä¸ƒã€æœ€ä½³å®è·µ</strong></p>
<ol>
<li><strong>æ˜ç¡®ä¿ç•™ç­–ç•¥</strong>ï¼š<ul>
<li>è‹¥åªéœ€ç¼–è¯‘æ—¶æ£€æŸ¥ï¼ˆå¦‚ <code>@Override</code>ï¼‰ï¼Œä½¿ç”¨ <code>RetentionPolicy.SOURCE</code>ã€‚</li>
<li>è‹¥éœ€è¿è¡Œæ—¶å¤„ç†ï¼ˆå¦‚ Spring æ³¨è§£ï¼‰ï¼Œä½¿ç”¨ <code>RetentionPolicy.RUNTIME</code>ã€‚</li>
</ul>
</li>
<li><strong>é¿å…è¿‡åº¦ä½¿ç”¨</strong>ï¼šæ³¨è§£æ»¥ç”¨ä¼šå¯¼è‡´ä»£ç å¯è¯»æ€§ä¸‹é™ã€‚</li>
<li><strong>ç»“åˆå·¥å…·é“¾</strong>ï¼šä½¿ç”¨ Lombokã€MapStruct ç­‰å·¥å…·ç®€åŒ–å¼€å‘ã€‚</li>
</ol>
<p>é€šè¿‡ç†è§£æ³¨è§£çš„å®ç°åŸç†ï¼Œå¼€å‘è€…å¯ä»¥æ›´é«˜æ•ˆåœ°åˆ©ç”¨å…¶å®ç°ä»£ç è§£è€¦ã€åŠ¨æ€é…ç½®å’Œè‡ªåŠ¨åŒ–å¤„ç†ï¼Œæå‡æ¡†æ¶çš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<h3 id="MapperScan-çš„å®ç°åŸç†"><a href="#MapperScan-çš„å®ç°åŸç†" class="headerlink" title="@MapperScan çš„å®ç°åŸç†"></a><code>@MapperScan</code> çš„å®ç°åŸç†</h3><p><code>@MapperScan</code> æ˜¯ MyBatis-Spring æ•´åˆä¸­çš„æ ¸å¿ƒæ³¨è§£ï¼Œç”¨äºè‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œ Mapper æ¥å£ä¸º Spring Beanã€‚å…¶å®ç°åŸç†åŸºäº Spring çš„æ‰©å±•æœºåˆ¶å’Œ MyBatis çš„åŠ¨æ€ä»£ç†ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†æ­¥éª¤å’Œæ ¸å¿ƒé€»è¾‘ï¼š</p>
<p><strong>1. æ³¨è§£å®šä¹‰ä¸å…¥å£</strong></p>
<p><code>@MapperScan</code> é€šè¿‡ <code>@Import</code> å¼•å…¥ <code>MapperScannerRegistrar</code>ï¼Œè§¦å‘æ‰«æå’Œæ³¨å†Œé€»è¾‘ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Import(MapperScannerRegistrar.class)</span> <span class="comment">// å…³é”®ï¼šå¼•å…¥æ³¨å†Œå™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MapperScan &#123;</span><br><span class="line">    String[] value() <span class="keyword">default</span> &#123;&#125;; <span class="comment">// æ‰«æçš„åŒ…è·¯å¾„</span></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; annotationClass() <span class="keyword">default</span> Annotation.class;</span><br><span class="line">    <span class="comment">// å…¶ä»–é…ç½®å±æ€§...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2. MapperScannerRegistrar æ³¨å†Œ Bean å®šä¹‰</strong></p>
<p><code>MapperScannerRegistrar</code> å®ç° <code>ImportBeanDefinitionRegistrar</code> æ¥å£ï¼Œåœ¨ Spring å®¹å™¨å¯åŠ¨æ—¶åŠ¨æ€æ³¨å†Œ Beanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperScannerRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// è§£æ @MapperScan æ³¨è§£çš„å±æ€§ï¼ˆå¦‚åŒ…è·¯å¾„ï¼‰</span></span><br><span class="line">        <span class="type">AnnotationAttributes</span> <span class="variable">attrs</span> <span class="operator">=</span> AnnotationAttributes.fromMap(metadata.getAnnotationAttributes(MapperScan.class.getName()));</span><br><span class="line">        <span class="comment">// åˆ›å»ºå¹¶é…ç½® ClassPathMapperScanner</span></span><br><span class="line">        <span class="type">ClassPathMapperScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathMapperScanner</span>(registry);</span><br><span class="line">        scanner.scan(attrs.getStringArray(<span class="string">&quot;value&quot;</span>)); <span class="comment">// æ‰§è¡Œæ‰«æ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3. ClassPathMapperScanner æ‰«ææ¥å£</strong></p>
<p><code>ClassPathMapperScanner</code> ç»§æ‰¿è‡ª Spring çš„ <code>ClassPathBeanDefinitionScanner</code>ï¼Œè‡ªå®šä¹‰æ‰«æè§„åˆ™ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassPathMapperScanner</span> <span class="keyword">extends</span> <span class="title class_">ClassPathBeanDefinitionScanner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Set&lt;BeanDefinitionHolder&gt; <span class="title function_">doScan</span><span class="params">(String... basePackages)</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨çˆ¶ç±»æ‰«ææ–¹æ³•ï¼Œç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„æ¥å£</span></span><br><span class="line">        Set&lt;BeanDefinitionHolder&gt; beanDefinitions = <span class="built_in">super</span>.doScan(basePackages);</span><br><span class="line">        <span class="comment">// ä¸ºæ¯ä¸ªæ¥å£ç”Ÿæˆ BeanDefinitionï¼Œç»‘å®šåˆ° MapperFactoryBean</span></span><br><span class="line">        <span class="keyword">for</span> (BeanDefinitionHolder holder : beanDefinitions) &#123;</span><br><span class="line">            <span class="type">GenericBeanDefinition</span> <span class="variable">definition</span> <span class="operator">=</span> (GenericBeanDefinition) holder.getBeanDefinition();</span><br><span class="line">            <span class="comment">// è®¾ç½® Bean çš„å·¥å‚ç±»ä¸º MapperFactoryBean</span></span><br><span class="line">            definition.getConstructorArgumentValues().addGenericArgumentValue(definition.getBeanClassName());</span><br><span class="line">            definition.setBeanClass(MapperFactoryBean.class); <span class="comment">// å…³é”®ï¼šä»£ç†å·¥å‚</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> beanDefinitions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isCandidateComponent</span><span class="params">(AnnotatedBeanDefinition beanDefinition)</span> &#123;</span><br><span class="line">        <span class="comment">// ä»…é€‰æ‹©æ¥å£ä½œä¸ºå€™é€‰ç»„ä»¶ï¼ˆæ’é™¤ç±»ï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> beanDefinition.getMetadata().isInterface();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4. MapperFactoryBean åˆ›å»ºä»£ç†å¯¹è±¡</strong></p>
<p><code>MapperFactoryBean</code> æ˜¯ Spring çš„ <code>FactoryBean</code> å®ç°ï¼Œè´Ÿè´£ç”Ÿæˆ Mapper æ¥å£çš„ä»£ç†å®ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperFactoryBean</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">SqlSessionDaoSupport</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Class&lt;T&gt; mapperInterface;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// é€šè¿‡ SqlSession è·å– Mapper åŠ¨æ€ä»£ç†</span></span><br><span class="line">        <span class="keyword">return</span> getSqlSession().getMapper(<span class="built_in">this</span>.mapperInterface);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;T&gt; <span class="title function_">getObjectType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.mapperInterface;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>5. åŠ¨æ€ä»£ç†ä¸ SQL æ‰§è¡Œ</strong></p>
<p>MyBatis é€šè¿‡ <code>MapperProxy</code> ç”Ÿæˆæ¥å£çš„ JDK åŠ¨æ€ä»£ç†å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperProxy</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span>, Serializable &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// å°†æ–¹æ³•è°ƒç”¨è½¬æ¢ä¸º MappedStatement æ‰§è¡Œ</span></span><br><span class="line">        <span class="type">MapperMethod</span> <span class="variable">mapperMethod</span> <span class="operator">=</span> cachedMapperMethod(method);</span><br><span class="line">        <span class="keyword">return</span> mapperMethod.execute(sqlSession, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>6. æ•´åˆ Spring å®¹å™¨</strong></p>
<ul>
<li><strong>SqlSessionTemplate æ³¨å…¥</strong>ï¼š<br>MyBatis-Spring é…ç½® <code>SqlSessionTemplate</code>ï¼ˆçº¿ç¨‹å®‰å…¨çš„ SqlSession å®ç°ï¼‰ï¼Œç”± Spring ç®¡ç†æ•°æ®åº“è¿æ¥å’Œäº‹åŠ¡ã€‚</li>
<li><strong>ä¾èµ–å…³ç³»</strong>ï¼š<br><code>MapperFactoryBean</code> ä¾èµ– <code>SqlSessionTemplate</code>ï¼Œç¡®ä¿æ‰€æœ‰ Mapper ä»£ç†ä½¿ç”¨åŒä¸€äº‹åŠ¡ä¸Šä¸‹æ–‡ã€‚</li>
</ul>
<p><strong>7. è‡ªåŠ¨é…ç½®ä¸ Spring Boot é›†æˆ</strong></p>
<p>åœ¨ Spring Boot ä¸­ï¼Œ<code>@MapperScan</code> é€šå¸¸ä¸è‡ªåŠ¨é…ç½®ç±» <code>MyBatisAutoConfiguration</code> é…åˆï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; SqlSessionFactory.class, SqlSessionFactoryBean.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactory</span><span class="params">(DataSource dataSource)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º SqlSessionFactory</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ€»ç»“æµç¨‹</strong></p>
<ol>
<li><strong>æ³¨è§£è§¦å‘</strong>ï¼š<code>@MapperScan</code> å¼•å…¥ <code>MapperScannerRegistrar</code>ã€‚</li>
<li><strong>åŠ¨æ€æ³¨å†Œ</strong>ï¼š<code>MapperScannerRegistrar</code> ä½¿ç”¨ <code>ClassPathMapperScanner</code> æ‰«ææŒ‡å®šåŒ…ä¸‹çš„æ¥å£ã€‚</li>
<li><strong>Bean å®šä¹‰ç”Ÿæˆ</strong>ï¼šä¸ºæ¯ä¸ª Mapper æ¥å£åˆ›å»ºç»‘å®šåˆ° <code>MapperFactoryBean</code> çš„ Bean å®šä¹‰ã€‚</li>
<li><strong>ä»£ç†å®ä¾‹åŒ–</strong>ï¼šSpring å®¹å™¨å®ä¾‹åŒ–æ—¶ï¼Œ<code>MapperFactoryBean</code> é€šè¿‡ <code>SqlSessionTemplate</code> åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡ã€‚</li>
<li><strong>æ–¹æ³•æ‹¦æˆª</strong>ï¼šè°ƒç”¨ Mapper æ–¹æ³•æ—¶ï¼Œä»£ç†å¯¹è±¡å°†è¯·æ±‚è½¬å‘ç»™ MyBatis æ‰§è¡Œ SQLã€‚</li>
</ol>
<p><strong>å…³é”®è®¾è®¡ç‚¹</strong></p>
<ul>
<li><strong>è§£è€¦ä¸æ‰©å±•</strong>ï¼šé€šè¿‡ Spring çš„ <code>FactoryBean</code> å’Œ <code>ImportBeanDefinitionRegistrar</code> å®ç°æ— ç¼æ•´åˆã€‚</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šåŠ¨æ€ä»£ç†å’Œç¼“å­˜æœºåˆ¶ï¼ˆå¦‚ <code>MapperMethod</code> ç¼“å­˜ï¼‰å‡å°‘åå°„å¼€é”€ã€‚</li>
<li><strong>äº‹åŠ¡ä¸€è‡´æ€§</strong>ï¼šä¾èµ– Spring ç®¡ç†çš„äº‹åŠ¡ï¼Œç¡®ä¿ Mapper æ“ä½œåœ¨åŒä¸€ä¸ª <code>SqlSession</code> ä¸­æ‰§è¡Œã€‚</li>
</ul>
<p>é€šè¿‡ <code>@MapperScan</code>ï¼Œå¼€å‘è€…æ— éœ€æ‰‹åŠ¨é…ç½®æ¯ä¸ª Mapperï¼Œæ¡†æ¶è‡ªåŠ¨å®Œæˆæ¥å£åˆ° Bean çš„æ˜ å°„åŠä»£ç†ç”Ÿæˆï¼Œæå¤§ç®€åŒ–äº† MyBatis åœ¨ Spring ä¸­çš„ä½¿ç”¨ã€‚</p>
<h3 id="Autowired-çš„å®ç°åŸç†"><a href="#Autowired-çš„å®ç°åŸç†" class="headerlink" title="@Autowired çš„å®ç°åŸç†"></a><code>@Autowired</code> çš„å®ç°åŸç†</h3><p><code>@Autowired</code> æ˜¯ Spring æ¡†æ¶ä¸­å®ç°ä¾èµ–æ³¨å…¥çš„æ ¸å¿ƒæ³¨è§£ï¼Œå…¶åº•å±‚åŸç†åŸºäº <strong>Bean ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ã€<strong>åå°„æœºåˆ¶</strong> å’Œ <strong>BeanPostProcessor</strong> çš„åä½œã€‚ä»¥ä¸‹æ˜¯å…¶å®ç°åŸç†çš„è¯¦ç»†åˆ†æï¼š</p>
<p><strong>1. æ ¸å¿ƒæµç¨‹</strong></p>
<p><code>@Autowired</code> çš„ä¾èµ–æ³¨å…¥å‘ç”Ÿåœ¨ Bean çš„å®ä¾‹åŒ–é˜¶æ®µï¼ˆå±æ€§å¡«å……é˜¶æ®µï¼‰ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p><strong>1.1 Bean å®ä¾‹åŒ–</strong></p>
<p>Spring å®¹å™¨é€šè¿‡åå°„è°ƒç”¨æ„é€ å‡½æ•°åˆ›å»º Bean å®ä¾‹ï¼ˆè‹¥å­˜åœ¨å¤šä¸ªæ„é€ å‡½æ•°ï¼Œä¼˜å…ˆé€‰æ‹©æ— å‚æ„é€ å‡½æ•°ï¼Œæˆ–æ ‡è®° <code>@Autowired</code> çš„æ„é€ å‡½æ•°ï¼‰ã€‚</p>
<p><strong>1.2 å±æ€§å¡«å……ï¼ˆä¾èµ–æ³¨å…¥ï¼‰</strong></p>
<ul>
<li><strong>è§¦å‘æ—¶æœº</strong>ï¼šåœ¨ <code>AbstractAutowireCapableBeanFactory</code> çš„ <code>populateBean()</code> æ–¹æ³•ä¸­ã€‚</li>
<li><strong>å¤„ç†ç»„ä»¶</strong>ï¼š<code>AutowiredAnnotationBeanPostProcessor</code>ï¼ˆç»§æ‰¿è‡ª <code>BeanPostProcessor</code>ï¼‰ã€‚</li>
</ul>
<p><strong>1.3 ä¾èµ–è§£æä¸æ³¨å…¥</strong></p>
<ol>
<li><strong>æ‰«ææ³¨è§£</strong>ï¼š<br>é€šè¿‡åå°„æ£€æŸ¥ Bean çš„å­—æ®µã€æ–¹æ³•å’Œæ„é€ å‡½æ•°ä¸Šçš„ <code>@Autowired</code> æ³¨è§£ã€‚</li>
<li><strong>è§£æä¾èµ–</strong>ï¼š<ul>
<li><strong>æŒ‰ç±»å‹åŒ¹é…</strong>ï¼šæŸ¥æ‰¾ä¸ä¾èµ–ç±»å‹åŒ¹é…çš„å€™é€‰ Beanã€‚</li>
<li><strong>æŒ‰åç§°åŒ¹é…</strong>ï¼šè‹¥å­˜åœ¨å¤šä¸ªåŒç±»å‹ Beanï¼ŒæŒ‰å­—æ®µ&#x2F;æ–¹æ³•å‚æ•°åç§°åŒ¹é…ï¼ˆéœ€ç»“åˆ <code>@Qualifier</code> æˆ– <code>@Primary</code> è§£å†³æ­§ä¹‰ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>æ³¨å…¥ä¾èµ–</strong>ï¼š<ul>
<li><strong>å­—æ®µæ³¨å…¥</strong>ï¼šé€šè¿‡åå°„ <code>Field.setAccessible(true)</code> è®¾ç½®ç§æœ‰å­—æ®µå€¼ã€‚</li>
<li><strong>æ–¹æ³•æ³¨å…¥</strong>ï¼šåå°„è°ƒç”¨ Setter æ–¹æ³•ã€‚</li>
<li><strong>æ„é€ å‡½æ•°æ³¨å…¥</strong>ï¼šåœ¨å®ä¾‹åŒ–æ—¶é€šè¿‡æ„é€ å‡½æ•°å‚æ•°æ³¨å…¥ã€‚</li>
</ul>
</li>
</ol>
<p><strong>2. å…³é”®ç»„ä»¶è§£æ</strong></p>
<p><strong>2.1 AutowiredAnnotationBeanPostProcessor</strong></p>
<p>Spring å†…ç½®çš„ <code>BeanPostProcessor</code>ï¼Œè´Ÿè´£å¤„ç† <code>@Autowired</code> å’Œ <code>@Value</code> æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutowiredAnnotationBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span>, MergedBeanDefinitionPostProcessor &#123;</span><br><span class="line">    <span class="comment">// å­˜å‚¨å¾…æ³¨å…¥çš„å…ƒæ•°æ®ï¼ˆå­—æ®µã€æ–¹æ³•ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InjectionMetadata metadata;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PropertyValues <span class="title function_">postProcessProperties</span><span class="params">(PropertyValues pvs, Object bean, String beanName)</span> &#123;</span><br><span class="line">        <span class="comment">// æŸ¥æ‰¾å¹¶æ³¨å…¥ä¾èµ–</span></span><br><span class="line">        <span class="type">InjectionMetadata</span> <span class="variable">metadata</span> <span class="operator">=</span> findAutowiringMetadata(bean.getClass());</span><br><span class="line">        metadata.inject(bean, beanName, pvs);</span><br><span class="line">        <span class="keyword">return</span> pvs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2.2 ä¾èµ–è§£ææµç¨‹</strong></p>
<p>åœ¨ <code>DefaultListableBeanFactory</code> ä¸­è§£æä¾èµ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">resolveDependency</span><span class="params">(DependencyDescriptor descriptor, String beanName, Set&lt;String&gt; autowiredBeanNames, TypeConverter typeConverter)</span> &#123;</span><br><span class="line">    <span class="comment">// æŒ‰ç±»å‹è·å–å€™é€‰ Bean åç§°</span></span><br><span class="line">    String[] candidateNames = findAutowireCandidates(beanName, type, descriptor);</span><br><span class="line">    <span class="comment">// ç­›é€‰å”¯ä¸€å€™é€‰ Bean</span></span><br><span class="line">    <span class="keyword">if</span> (candidateNames.length == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> getBean(candidateNames[<span class="number">0</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (candidateNames.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// æŒ‰åç§°æˆ– @Primary/@Priority è§£å†³å†²çª</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">primaryCandidate</span> <span class="operator">=</span> determinePrimaryCandidate(candidateNames);</span><br><span class="line">        <span class="keyword">return</span> primaryCandidate != <span class="literal">null</span> ? primaryCandidate : determineHighestPriorityCandidate(candidateNames);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æŠ›å‡º NoUniqueBeanDefinitionException å¼‚å¸¸</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3. æ³¨å…¥æ–¹å¼ä¸ä¼˜å…ˆçº§</strong></p>
<p><strong>3.1 æ„é€ å‡½æ•°æ³¨å…¥</strong></p>
<ul>
<li><p><strong>è§¦å‘æ¡ä»¶</strong>ï¼šè‹¥ç±»ä¸­å­˜åœ¨å”¯ä¸€æ„é€ å‡½æ•°ï¼Œæˆ–æ„é€ å‡½æ•°æ ‡è®°äº† <code>@Autowired</code>ã€‚</p>
</li>
<li><p><strong>ä¼˜åŠ¿</strong>ï¼šä¿è¯ä¾èµ–ä¸å¯å˜ï¼Œç¬¦åˆä¸å¯å˜å¯¹è±¡è®¾è®¡ã€‚</p>
</li>
<li><p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(UserRepository userRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userRepository = userRepository;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>3.2 Setter æ–¹æ³•æ³¨å…¥</strong></p>
<ul>
<li><p><strong>è§¦å‘æ¡ä»¶</strong>ï¼šSetter æ–¹æ³•æ ‡è®° <code>@Autowired</code>ã€‚</p>
</li>
<li><p><strong>ä¼˜åŠ¿</strong>ï¼šå…è®¸å¯é€‰ä¾èµ–æˆ–åŠ¨æ€æ›´æ–°ä¾èµ–ã€‚</p>
</li>
<li><p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPaymentService</span><span class="params">(PaymentService paymentService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.paymentService = paymentService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>3.3 å­—æ®µæ³¨å…¥</strong></p>
<ul>
<li><p><strong>è§¦å‘æ¡ä»¶</strong>ï¼šå­—æ®µç›´æ¥æ ‡è®° <code>@Autowired</code>ã€‚</p>
</li>
<li><p><strong>åŠ£åŠ¿</strong>ï¼šéš¾ä»¥å®ç°ä¸å¯å˜æ€§ï¼Œæµ‹è¯•æ—¶éœ€é€šè¿‡åå°„æ³¨å…¥ã€‚</p>
</li>
<li><p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> InventoryService inventoryService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>4. è§£å†³ä¾èµ–å†²çª</strong></p>
<p><strong>4.1 @Qualifier</strong></p>
<p>é€šè¿‡åç§°æŒ‡å®šæ³¨å…¥çš„ Beanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;mysqlDataSource&quot;)</span></span><br><span class="line"><span class="keyword">private</span> DataSource dataSource;</span><br></pre></td></tr></table></figure>

<p><strong>4.2 @Primary</strong></p>
<p>æ ‡è®°ä¼˜å…ˆé€‰æ‹©çš„ Beanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> DataSource <span class="title function_">primaryDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HikariDataSource</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4.3 è‡ªå®šä¹‰é™å®šç¬¦</strong></p>
<p>ç»“åˆè‡ªå®šä¹‰æ³¨è§£ä¸ <code>@Qualifier</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.PARAMETER&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Qualifier</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MysqlDatabase &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@MysqlDatabase</span></span><br><span class="line"><span class="keyword">private</span> DataSource dataSource;</span><br></pre></td></tr></table></figure>

<p><strong>5. æºç çº§å…³é”®é€»è¾‘</strong></p>
<p><strong>5.1 å­—æ®µæ³¨å…¥å®ç°</strong></p>
<p>åå°„è®¾ç½®å­—æ®µå€¼ï¼ˆç®€åŒ–ä»£ç ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> bean.getClass().getDeclaredField(<span class="string">&quot;userRepository&quot;</span>);</span><br><span class="line">field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">field.set(bean, userRepository);</span><br></pre></td></tr></table></figure>

<p><strong>5.2 æ–¹æ³•æ³¨å…¥å®ç°</strong></p>
<p>åå°„è°ƒç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> bean.getClass().getMethod(<span class="string">&quot;setUserRepository&quot;</span>, UserRepository.class);</span><br><span class="line">method.invoke(bean, userRepository);</span><br></pre></td></tr></table></figure>

<p><strong>6. æ€»ç»“ä¸æœ€ä½³å®è·µ</strong></p>
<ul>
<li><strong>åŸç†æœ¬è´¨</strong>ï¼š<code>@Autowired</code> é€šè¿‡ <code>BeanPostProcessor</code> åœ¨ Bean ç”Ÿå‘½å‘¨æœŸä¸­åŠ¨æ€è§£æå¹¶æ³¨å…¥ä¾èµ–ã€‚</li>
<li><strong>æ¨èæ–¹å¼</strong>ï¼šä¼˜å…ˆä½¿ç”¨ <strong>æ„é€ å‡½æ•°æ³¨å…¥</strong> ä¿è¯ä¾èµ–ä¸å¯å˜ã€‚</li>
<li><strong>é¿å…é™·é˜±</strong>ï¼š<ul>
<li><strong>å¾ªç¯ä¾èµ–</strong>ï¼šé¿å… A ä¾èµ– Bï¼ŒB åˆä¾èµ– Aï¼Œå¯é€šè¿‡ <code>@Lazy</code> å»¶è¿ŸåŠ è½½è§£å†³ã€‚</li>
<li><strong>å¤šå®ä¾‹å†²çª</strong>ï¼šä½¿ç”¨ <code>@Qualifier</code> æˆ– <code>@Primary</code> æ˜ç¡®æŒ‡å®š Beanã€‚</li>
</ul>
</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šåå°„æ“ä½œæœ‰ä¸€å®šå¼€é”€ï¼Œä½† Spring é€šè¿‡ç¼“å­˜å…ƒæ•°æ®ï¼ˆå¦‚ <code>InjectionMetadata</code>ï¼‰å‡å°‘é‡å¤è§£æã€‚</li>
</ul>
<h3 id="SpringMVC-å·¥ä½œæµç¨‹"><a href="#SpringMVC-å·¥ä½œæµç¨‹" class="headerlink" title="SpringMVC å·¥ä½œæµç¨‹"></a>SpringMVC å·¥ä½œæµç¨‹</h3><p><strong>æ ¸å¿ƒç»„ä»¶</strong></p>
<ol>
<li><strong>DispatcherServlet</strong>ï¼šå‰ç½®æ§åˆ¶å™¨ï¼Œæ˜¯æ•´ä¸ªæµç¨‹æ§åˆ¶çš„<strong>æ ¸å¿ƒ</strong>ï¼Œæ§åˆ¶å…¶ä»–ç»„ä»¶çš„æ‰§è¡Œï¼Œè¿›è¡Œç»Ÿä¸€è°ƒåº¦ï¼Œé™ä½ç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ï¼Œç›¸å½“äºæ€»æŒ‡æŒ¥ã€‚</li>
<li><strong>Handler</strong>ï¼šå¤„ç†å™¨ï¼Œå®Œæˆå…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼Œç›¸å½“äº Servlet æˆ– Actionã€‚</li>
<li><strong>HandlerMapping</strong>ï¼šDispatcherServlet æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œé€šè¿‡ HandlerMapping å°†ä¸åŒçš„è¯·æ±‚æ˜ å°„åˆ°ä¸åŒçš„ Handlerã€‚</li>
<li><strong>HandlerInterceptor</strong>ï¼šå¤„ç†å™¨æ‹¦æˆªå™¨ï¼Œæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¦‚æœéœ€è¦å®Œæˆä¸€äº›æ‹¦æˆªå¤„ç†ï¼Œå¯ä»¥å®ç°è¯¥æ¥å£ã€‚</li>
<li><strong>HandlerExecutionChain</strong>ï¼šå¤„ç†å™¨æ‰§è¡Œé“¾ï¼ŒåŒ…æ‹¬ä¸¤éƒ¨åˆ†å†…å®¹ï¼šHandler å’Œ HandlerInterceptorï¼ˆç³»ç»Ÿä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ HandlerInterceptorï¼Œå¦‚æœéœ€è¦é¢å¤–è®¾ç½®æ‹¦æˆªï¼Œå¯ä»¥æ·»åŠ æ‹¦æˆªå™¨ï¼‰ã€‚</li>
<li><strong>HandlerAdapter</strong>ï¼šå¤„ç†å™¨é€‚é…å™¨ï¼ŒHandler æ‰§è¡Œä¸šåŠ¡æ–¹æ³•ä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼ŒåŒ…æ‹¬è¡¨å•æ•°æ®çš„éªŒè¯ã€æ•°æ®ç±»å‹çš„è½¬æ¢ã€å°†è¡¨å•æ•°æ®å°è£…åˆ° JavaBean ç­‰ï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯ç”± HandlerApater æ¥å®Œæˆï¼Œå¼€å‘è€…åªéœ€å°†æ³¨æ„åŠ›é›†ä¸­ä¸šåŠ¡é€»è¾‘çš„å¤„ç†ä¸Šï¼ŒDispatcherServlet é€šè¿‡ HandlerAdapter æ‰§è¡Œä¸åŒçš„ Handlerã€‚</li>
<li><strong>ModelAndView</strong>ï¼šè£…è½½äº†æ¨¡å‹æ•°æ®å’Œè§†å›¾ä¿¡æ¯ï¼Œä½œä¸º Handler çš„å¤„ç†ç»“æœï¼Œè¿”å›ç»™ DispatcherServletã€‚</li>
<li><strong>ViewResolver</strong>ï¼šè§†å›¾è§£æå™¨ï¼ŒDispatcheServlet é€šè¿‡å®ƒå°†é€»è¾‘è§†å›¾è§£æä¸ºç‰©ç†è§†å›¾ï¼Œæœ€ç»ˆå°†æ¸²æŸ“ç»“æœå“åº”ç»™å®¢æˆ·ç«¯ã€‚</li>
</ol>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-e29a122b-db07-48b8-8289-7251032e87a1.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring MVCçš„å·¥ä½œæµç¨‹"></p>
<h2 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h2><h3 id="SpringBootè‡ªåŠ¨è£…é…åŸç†"><a href="#SpringBootè‡ªåŠ¨è£…é…åŸç†" class="headerlink" title="SpringBootè‡ªåŠ¨è£…é…åŸç†"></a>SpringBootè‡ªåŠ¨è£…é…åŸç†</h3><p>Spring Boot çš„è‡ªåŠ¨è£…é…æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼Œå®ƒæå¤§åœ°ç®€åŒ–äº† Spring åº”ç”¨çš„é…ç½®è¿‡ç¨‹ï¼Œéµå¾ªâ€œ<strong>çº¦å®šå¤§äºé…ç½®</strong>â€çš„ç†å¿µã€‚å…¶æ ¸å¿ƒåŸç†å¯ä»¥åˆ†è§£ä¸ºä»¥ä¸‹å‡ ä¸ªå…³é”®ç‚¹ï¼š</p>
<ol>
<li><strong><code>@SpringBootApplication</code> æ³¨è§£ï¼š</strong><ul>
<li>è¿™æ˜¯ Spring Boot åº”ç”¨çš„å…¥å£æ³¨è§£ï¼Œæ ‡æ³¨åœ¨ä¸»å¯åŠ¨ç±»ä¸Šã€‚</li>
<li>å®ƒæ˜¯ä¸€ä¸ª<strong>ç»„åˆæ³¨è§£</strong>ï¼ŒåŒ…å«äº†ä¸‰ä¸ªæ ¸å¿ƒæ³¨è§£ï¼š<ul>
<li><code>@SpringBootConfiguration</code>: è¡¨æ˜è¯¥ç±»æ˜¯ä¸€ä¸ª Spring Boot çš„é…ç½®ç±»ï¼ˆæœ¬è´¨ä¸Šæ˜¯ <code>@Configuration</code>ï¼‰ã€‚</li>
<li><code>@EnableAutoConfiguration</code>: <strong>å¼€å¯è‡ªåŠ¨è£…é…çš„æ ¸å¿ƒæ³¨è§£</strong>ã€‚</li>
<li><code>@ComponentScan</code>: å¼€å¯ç»„ä»¶æ‰«æï¼Œé»˜è®¤æ‰«æä¸»é…ç½®ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ä¸‹çš„ <code>@Component</code>, <code>@Service</code>, <code>@Repository</code>, <code>@Controller</code> ç­‰æ³¨è§£çš„ç±»ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><strong><code>@EnableAutoConfiguration</code> çš„æ ¸å¿ƒä½œç”¨ï¼š</strong><ul>
<li>è¿™ä¸ªæ³¨è§£é€šè¿‡ <code>@Import(AutoConfigurationImportSelector.class)</code> å¯¼å…¥äº† <code>AutoConfigurationImportSelector</code>ã€‚</li>
<li><strong><code>AutoConfigurationImportSelector</code> æ˜¯è‡ªåŠ¨è£…é…çš„å…³é”®å¼•æ“ï¼š</strong><ul>
<li>å®ƒå®ç°äº† <code>DeferredImportSelector</code> æ¥å£ï¼Œåœ¨ Spring å®¹å™¨å¤„ç†å®Œæ‰€æœ‰å¸¸è§„çš„ <code>@Configuration</code> ç±»ä¹‹åæ‰ä¼šæ‰§è¡Œã€‚</li>
<li>å®ƒçš„æ ¸å¿ƒæ–¹æ³•æ˜¯ <code>selectImports()</code>ã€‚è¿™ä¸ªæ–¹æ³•è´Ÿè´£<strong>å†³å®šéœ€è¦å¯¼å…¥å“ªäº›è‡ªåŠ¨é…ç½®ç±»</strong>ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><strong><code>spring.factories</code> &#x2F; <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>ï¼ˆæ–°æ–¹å¼ï¼‰ï¼š</strong><ul>
<li><code>AutoConfigurationImportSelector</code> ä¼šå»<strong>ç±»è·¯å¾„ä¸‹æŸ¥æ‰¾ä¸€ä¸ªç‰¹å®šçš„æ–‡ä»¶</strong>æ¥è·å–æ‰€æœ‰å€™é€‰çš„è‡ªåŠ¨é…ç½®ç±»å…¨é™å®šåã€‚</li>
<li><strong>Spring Boot 2.7 ä¹‹å‰ï¼š</strong> æŸ¥æ‰¾ <code>META-INF/spring.factories</code> æ–‡ä»¶ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæœ‰ä¸€ä¸ªé”®ä¸º <code>org.springframework.boot.autoconfigure.EnableAutoConfiguration</code> çš„å±æ€§ï¼Œå…¶å€¼æ˜¯ä¸€ä¸ª<strong>é€—å·åˆ†éš”</strong>çš„è‡ªåŠ¨é…ç½®ç±»å…¨é™å®šååˆ—è¡¨ã€‚</li>
<li><strong>Spring Boot 2.7 åŠä¹‹åï¼š</strong> æ¨èä½¿ç”¨ <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code> æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶<strong>æ¯è¡Œå†™ä¸€ä¸ª</strong>è‡ªåŠ¨é…ç½®ç±»çš„å…¨é™å®šåã€‚è¿™æ˜¯ä¸ºäº†æ›´å¥½çš„ IDE æ”¯æŒå’Œå·¥å…·é“¾å…¼å®¹æ€§ï¼ˆå¦‚ GraalVM Native Imageï¼‰ã€‚Spring Boot ä»ç„¶å…¼å®¹ <code>spring.factories</code>ï¼Œä½†æ–°é¡¹ç›®å»ºè®®ä½¿ç”¨æ–°æ–¹å¼ã€‚</li>
<li><strong>æ¥æºï¼š</strong> è¿™äº›æ–‡ä»¶é€šå¸¸å­˜åœ¨äº <code>spring-boot-autoconfigure</code> jar åŒ…ä»¥åŠä½ å¼•å…¥çš„å„ç§ <code>starter</code> jar åŒ…ï¼ˆå¦‚ <code>spring-boot-starter-web</code>, <code>spring-boot-starter-data-jpa</code>ï¼‰ä¸­ã€‚æ¯ä¸ª <code>starter</code> é€šè¿‡æä¾›è‡ªå·±çš„ <code>spring.factories</code> æˆ– <code>AutoConfiguration.imports</code> æ–‡ä»¶æ¥å£°æ˜å®ƒéœ€è¦å“ªäº›è‡ªåŠ¨é…ç½®ã€‚</li>
</ul>
</li>
<li><strong>è‡ªåŠ¨é…ç½®ç±» (<code>@Configuration</code>)ï¼š</strong><ul>
<li>é€šè¿‡ä¸Šè¿°æœºåˆ¶æ‰¾åˆ°çš„å€™é€‰ç±»éƒ½æ˜¯æ ‡æœ‰ <code>@Configuration</code> æ³¨è§£çš„ Spring é…ç½®ç±»ã€‚</li>
<li>è¿™äº›é…ç½®ç±»å†…éƒ¨ä½¿ç”¨ <code>@Bean</code> æ³¨è§£å®šä¹‰äº†å¤§é‡<strong>æ¡ä»¶åŒ–</strong>çš„ Beanã€‚è¿™äº› Bean é€šå¸¸æ˜¯æ¡†æ¶æˆ–åº“çš„æ ¸å¿ƒç»„ä»¶ï¼ˆå¦‚ <code>DataSource</code>, <code>EntityManagerFactory</code>, <code>RestTemplate</code>, <code>DispatcherServlet</code> ç­‰ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>æ¡ä»¶æ³¨è§£ (<code>@Conditional</code> åŠå…¶è¡ç”Ÿæ³¨è§£)ï¼š</strong><ul>
<li>è¿™æ˜¯è‡ªåŠ¨è£…é…<strong>æ™ºèƒ½æ€§</strong>çš„å…³é”®ï¼è‡ªåŠ¨é…ç½®ç±»åŠå…¶å†…éƒ¨çš„ <code>@Bean</code> æ–¹æ³•ä¸Šä¼šå¤§é‡ä½¿ç”¨æ¡ä»¶æ³¨è§£ã€‚</li>
<li>è¿™äº›æ³¨è§£æ§åˆ¶ç€é…ç½®ç±»å’Œ Bean <strong>æ˜¯å¦ä¼šè¢«çœŸæ­£åŠ è½½å’Œåˆ›å»º</strong>ã€‚å¸¸è§çš„æ¡ä»¶æ³¨è§£æœ‰ï¼š<ul>
<li><code>@ConditionalOnClass</code>: å½“ç±»è·¯å¾„ä¸­å­˜åœ¨æŒ‡å®šçš„ç±»æ—¶æ‰ç”Ÿæ•ˆã€‚</li>
<li><code>@ConditionalOnMissingClass</code>: å½“ç±»è·¯å¾„ä¸­ä¸å­˜åœ¨æŒ‡å®šçš„ç±»æ—¶æ‰ç”Ÿæ•ˆã€‚</li>
<li><code>@ConditionalOnBean</code>: å½“å®¹å™¨ä¸­å­˜åœ¨æŒ‡å®šçš„ Bean æ—¶æ‰ç”Ÿæ•ˆã€‚</li>
<li><code>@ConditionalOnMissingBean</code>: å½“å®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šçš„ Bean æ—¶æ‰ç”Ÿæ•ˆã€‚<strong>è¿™æ˜¯å…è®¸ç”¨æˆ·è‡ªå®šä¹‰ Bean è¦†ç›–é»˜è®¤é…ç½®çš„å…³é”®ï¼</strong></li>
<li><code>@ConditionalOnProperty</code>: å½“æŒ‡å®šçš„é…ç½®å±æ€§æ»¡è¶³ç‰¹å®šæ¡ä»¶ï¼ˆå¦‚å­˜åœ¨ã€ç­‰äºæŸä¸ªå€¼ï¼‰æ—¶æ‰ç”Ÿæ•ˆã€‚</li>
<li><code>@ConditionalOnWebApplication</code> &#x2F; <code>@ConditionalOnNotWebApplication</code>: æ ¹æ®åº”ç”¨æ˜¯å¦æ˜¯ Web åº”ç”¨æ¥å†³å®šã€‚</li>
<li><code>@ConditionalOnResource</code>: å½“æŒ‡å®šçš„èµ„æºæ–‡ä»¶å­˜åœ¨æ—¶æ‰ç”Ÿæ•ˆã€‚</li>
<li><code>@ConditionalOnJava</code>: å½“è¿è¡Œåœ¨æŒ‡å®šçš„ Java ç‰ˆæœ¬ä¸Šæ—¶æ‰ç”Ÿæ•ˆã€‚</li>
</ul>
</li>
<li><strong>è¿‡ç¨‹ï¼š</strong> Spring Boot åœ¨å¯åŠ¨æ—¶ï¼Œä¼š<strong>æŒ‰é¡ºåºåŠ è½½</strong>æ‰€æœ‰å€™é€‰çš„è‡ªåŠ¨é…ç½®ç±»ã€‚å¯¹äºæ¯ä¸ªé…ç½®ç±»å’Œå…¶ä¸­çš„æ¯ä¸ª <code>@Bean</code> æ–¹æ³•ï¼ŒSpring Boot ä¼š<strong>è¯„ä¼°å…¶ä¸Šçš„æ¡ä»¶æ³¨è§£</strong>ã€‚åªæœ‰å½“æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³æ—¶ï¼Œè¿™ä¸ªé…ç½®ç±»æˆ– Bean å®šä¹‰æ‰ä¼šè¢«çœŸæ­£å¤„ç†å¹¶åŠ å…¥åˆ° Spring å®¹å™¨ä¸­ã€‚</li>
</ul>
</li>
<li><strong>è‡ªåŠ¨é…ç½®å…ƒæ•°æ® (<code>spring-autoconfigure-metadata.properties</code>)ï¼š</strong><ul>
<li>ä¸ºäº†<strong>æé«˜å¯åŠ¨æ€§èƒ½</strong>ï¼ˆé¿å…é€šè¿‡åå°„åŠ è½½å’Œè§£æå¤§é‡ä¸æ»¡è¶³æ¡ä»¶çš„é…ç½®ç±»ï¼‰ï¼ŒSpring Boot åœ¨ç¼–è¯‘æ—¶ä¼šä¸ºè‡ªåŠ¨é…ç½®æ¨¡å—ç”Ÿæˆä¸€ä¸ª <code>META-INF/spring-autoconfigure-metadata.properties</code> æ–‡ä»¶ã€‚</li>
<li>è¿™ä¸ªæ–‡ä»¶é¢„å…ˆå­˜å‚¨äº†æ‰€æœ‰è‡ªåŠ¨é…ç½®ç±»ä¸Šçš„<strong>æ¡ä»¶ä¿¡æ¯</strong>ï¼ˆå¦‚ <code>@ConditionalOnClass</code> è¦æ±‚çš„ç±»ï¼‰ã€‚</li>
<li>åœ¨å¯åŠ¨çš„æ—©æœŸé˜¶æ®µï¼Œ<code>AutoConfigurationImportSelector</code> ä¼šé¦–å…ˆè¯»å–è¿™ä¸ªå…ƒæ•°æ®æ–‡ä»¶ï¼Œ<strong>å¿«é€Ÿè¿‡æ»¤æ‰ä¸€å¤§æ‰¹æ˜æ˜¾ä¸æ»¡è¶³æ¡ä»¶</strong>ï¼ˆä¾‹å¦‚ï¼Œç±»è·¯å¾„ä¸Šæ ¹æœ¬æ²¡æœ‰æ‰€éœ€ä¾èµ–çš„ç±»ï¼‰çš„è‡ªåŠ¨é…ç½®ç±»ã€‚åªæœ‰é€šè¿‡å…ƒæ•°æ®åˆæ­¥ç­›é€‰çš„é…ç½®ç±»æ‰ä¼šè¢«çœŸæ­£åŠ è½½å’Œè§£æï¼Œå¤§å¤§å‡å°‘äº†ç±»åŠ è½½å’Œæ¡ä»¶è¯„ä¼°çš„å¼€é”€ã€‚</li>
</ul>
</li>
</ol>
<p><strong>æ€»ç»“æµç¨‹ï¼š</strong></p>
<ol>
<li>å¯åŠ¨ <code>main</code> æ–¹æ³•ï¼ŒåŠ è½½æ ‡æ³¨äº† <code>@SpringBootApplication</code> çš„ä¸»ç±»ã€‚</li>
<li><code>@SpringBootApplication</code> ä¸­çš„ <code>@EnableAutoConfiguration</code> æ¿€æ´»è‡ªåŠ¨è£…é…ã€‚</li>
<li><code>@EnableAutoConfiguration</code> é€šè¿‡ <code>@Import</code> å¼•å…¥ <code>AutoConfigurationImportSelector</code>ã€‚</li>
<li><code>AutoConfigurationImportSelector</code> åœ¨é€‚å½“çš„æ—¶å€™æ‰§è¡Œï¼š<ul>
<li>è¯»å– <code>spring-autoconfigure-metadata.properties</code> è¿›è¡Œ<strong>å¿«é€Ÿè¿‡æ»¤</strong>ã€‚</li>
<li>è¯»å– <code>META-INF/spring.factories</code> æˆ– <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code> æ–‡ä»¶ï¼Œè·å–<strong>æ‰€æœ‰å€™é€‰è‡ªåŠ¨é…ç½®ç±»</strong>çš„å…¨ååˆ—è¡¨ã€‚</li>
<li><strong>åº”ç”¨è‡ªåŠ¨é…ç½®å…ƒæ•°æ®è¿‡æ»¤å™¨</strong>ï¼Œå‰”é™¤æ˜æ˜¾ä¸æ»¡è¶³æ¡ä»¶çš„å€™é€‰ç±»ã€‚</li>
</ul>
</li>
<li>éå†å‰©ä¸‹çš„å€™é€‰è‡ªåŠ¨é…ç½®ç±»ï¼š<ul>
<li>ä½¿ç”¨åå°„åŠ è½½ç±»ã€‚</li>
<li><strong>è¯¦ç»†è¯„ä¼°ç±»ä¸Šçš„ <code>@Conditional</code> åŠå…¶è¡ç”Ÿæ³¨è§£</strong>ã€‚</li>
<li>å¦‚æœç±»çº§åˆ«çš„æ¡ä»¶æ»¡è¶³ï¼Œåˆ™å°†è¯¥é…ç½®ç±»ä½œä¸ºä¸€ä¸ª <code>@Configuration</code> ç±»å¤„ç†ã€‚</li>
<li>å¤„ç†é…ç½®ç±»å†…éƒ¨çš„ <code>@Bean</code> æ–¹æ³•ï¼ŒåŒæ ·è¯„ä¼°æ–¹æ³•ä¸Šçš„æ¡ä»¶æ³¨è§£ï¼Œæ»¡è¶³æ¡ä»¶çš„æ‰æ³¨å†Œä¸º Beanã€‚</li>
</ul>
</li>
<li>æœ€ç»ˆï¼Œæ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è‡ªåŠ¨é…ç½®ç±»ä¸­å®šä¹‰çš„ Bean è¢«æ³¨å†Œåˆ° Spring IoC å®¹å™¨ä¸­ï¼Œåº”ç”¨å°±æ‹¥æœ‰äº†æ‰€éœ€çš„åŸºç¡€è®¾æ–½ Beanã€‚</li>
</ol>
<p><strong>å…³é”®ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>ç®€åŒ–é…ç½®ï¼š</strong> å¼€å‘è€…åªéœ€å¼•å…¥ Starter ä¾èµ–ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®å¤§é‡ Beanã€‚</li>
<li><strong>å¼€ç®±å³ç”¨ï¼š</strong> æä¾›åˆç†çš„é»˜è®¤é…ç½®ï¼Œæ»¡è¶³å¤§éƒ¨åˆ†åœºæ™¯ã€‚</li>
<li><strong>æ˜“äºå®šåˆ¶ï¼š</strong> é€šè¿‡å®šä¹‰è‡ªå·±çš„ <code>@Bean</code> (åˆ©ç”¨ <code>@ConditionalOnMissingBean</code> è¦†ç›–) æˆ–ä¿®æ”¹ <code>application.properties</code>&#x2F;<code>application.yml</code> å³å¯è½»æ¾è¦†ç›–é»˜è®¤é…ç½®ã€‚</li>
<li><strong>æŒ‰éœ€åŠ è½½ï¼š</strong> åŸºäºæ¡ä»¶æ³¨è§£ï¼ŒåªåŠ è½½å½“å‰åº”ç”¨å®é™…éœ€è¦çš„é…ç½®å’Œ Beanï¼Œé¿å…èµ„æºæµªè´¹ã€‚</li>
</ul>
<p><strong>ç†è§£è¦ç‚¹ï¼š</strong></p>
<ul>
<li>è‡ªåŠ¨è£…é…ä¸æ˜¯é»‘é­”æ³•ï¼Œæœ¬è´¨ä¸Šæ˜¯ Spring <code>@Configuration</code> å’Œ <code>@Bean</code> çš„<strong>æ¡ä»¶åŒ–ã€æ‰¹é‡åŒ–ä½¿ç”¨</strong>ã€‚</li>
<li><code>spring.factories</code> &#x2F; <code>AutoConfiguration.imports</code> æ–‡ä»¶æ˜¯<strong>è‡ªåŠ¨é…ç½®ç±»çš„æ³¨å†Œä¸­å¿ƒ</strong>ã€‚</li>
<li>æ¡ä»¶æ³¨è§£ (<code>@ConditionalXXX</code>) æ˜¯<strong>å†³å®šå“ªäº›é…ç½®ç”Ÿæ•ˆçš„è§„åˆ™å¼•æ“</strong>ã€‚</li>
<li>è‡ªåŠ¨é…ç½®å…ƒæ•°æ® (<code>spring-autoconfigure-metadata.properties</code>) æ˜¯<strong>ä¼˜åŒ–å¯åŠ¨é€Ÿåº¦çš„å…³é”®</strong>ã€‚</li>
</ul>
<h2 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h2><h2 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h2><h2 id="JPA"><a href="#JPA" class="headerlink" title="JPA"></a>JPA</h2><h2 id="æ—¥å¿—æ¡†æ¶"><a href="#æ—¥å¿—æ¡†æ¶" class="headerlink" title="æ—¥å¿—æ¡†æ¶"></a>æ—¥å¿—æ¡†æ¶</h2><h1 id="åˆ†å¸ƒå¼"><a href="#åˆ†å¸ƒå¼" class="headerlink" title="åˆ†å¸ƒå¼"></a>åˆ†å¸ƒå¼</h1><h2 id="åŸºæœ¬ç†è®º"><a href="#åŸºæœ¬ç†è®º" class="headerlink" title="åŸºæœ¬ç†è®º"></a>åŸºæœ¬ç†è®º</h2><h3 id="ä»€ä¹ˆæ˜¯CAP"><a href="#ä»€ä¹ˆæ˜¯CAP" class="headerlink" title="ä»€ä¹ˆæ˜¯CAP"></a>ä»€ä¹ˆæ˜¯CAP</h3><p>CAPå®šç†æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒåŸåˆ™ï¼Œç”±è®¡ç®—æœºç§‘å­¦å®¶Eric Breweråœ¨2000å¹´æå‡ºï¼Œåäº2002å¹´è¢«è¯æ˜ã€‚å®ƒæŒ‡å‡ºï¼Œåœ¨å­˜åœ¨<strong>ç½‘ç»œåˆ†åŒºï¼ˆPartition Toleranceï¼‰</strong>çš„æƒ…å†µä¸‹ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿæ— æ³•åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªç‰¹æ€§ï¼š</p>
<ol>
<li><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong><br>æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶åˆ»çœ‹åˆ°çš„æ•°æ®å®Œå…¨ç›¸åŒã€‚å†™å…¥æ“ä½œåï¼Œæ‰€æœ‰è¯»å–è¯·æ±‚éƒ½ä¼šç«‹å³è·å¾—æœ€æ–°æ•°æ®ï¼Œä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚</li>
<li><strong>å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰</strong><br>æ¯ä¸ªè¯·æ±‚ï¼ˆæ— è®ºè¯»å†™ï¼‰éƒ½èƒ½åœ¨åˆç†æ—¶é—´å†…è·å¾—éé”™è¯¯å“åº”ï¼Œä½†ä¸ä¿è¯è¿”å›çš„æ•°æ®æ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚å³ä½¿éƒ¨åˆ†èŠ‚ç‚¹æ•…éšœï¼Œç³»ç»Ÿä»èƒ½æ­£å¸¸å“åº”ã€‚</li>
<li><strong>åˆ†åŒºå®¹å¿æ€§ï¼ˆPartition Toleranceï¼‰</strong><br>ç³»ç»Ÿåœ¨ç½‘ç»œåˆ†åŒºï¼ˆèŠ‚ç‚¹é—´é€šä¿¡ä¸­æ–­ï¼Œå½¢æˆå­¤å²›ï¼‰æ—¶ä»èƒ½ç»§ç»­è¿è¡Œã€‚ç½‘ç»œåˆ†åŒºæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®¢è§‚ç°å®ï¼Œå› æ­¤è¿™ä¸€ç‰¹æ€§é€šå¸¸è¢«è§†ä¸ºå¿…é¡»æ”¯æŒçš„åŸºç¡€ã€‚</li>
</ol>
<img src="/post/65a5b0d7/image-20250505093121422.png" class="" title="image-20250505093121422">

<h3 id="ä»€ä¹ˆæ˜¯BASE"><a href="#ä»€ä¹ˆæ˜¯BASE" class="headerlink" title="ä»€ä¹ˆæ˜¯BASE"></a>ä»€ä¹ˆæ˜¯BASE</h3><p>BASE æ˜¯åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰ã€è½¯çŠ¶æ€ï¼ˆSoft Stateï¼‰å’Œæœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventually Consistentï¼‰ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™ã€‚</p>
<p>BASE ç†è®ºæ˜¯å¯¹ CAP ä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æœï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚</p>
<p><strong>åŸºæœ¬å¯ç”¨</strong></p>
<p>æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œä¿è¯æ ¸å¿ƒå¯ç”¨ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ã€‚</p>
<p>ä¾‹å¦‚ï¼Œç”µå•†åœ¨åšä¿ƒé”€æ—¶ï¼Œä¸ºäº†ä¿è¯è´­ç‰©ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…å¯èƒ½ä¼šè¢«å¼•å¯¼åˆ°ä¸€ä¸ªé™çº§çš„é¡µé¢ã€‚</p>
<p><strong>è½¯çŠ¶æ€</strong></p>
<p>æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡ŒåŒæ­¥çš„è¿‡ç¨‹å­˜åœ¨æ—¶å»¶ã€‚</p>
<p><strong>æœ€ç»ˆä¸€è‡´æ€§</strong></p>
<p>æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½è¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚</p>
<p>ACID è¦æ±‚å¼ºä¸€è‡´æ€§ï¼Œé€šå¸¸è¿ç”¨åœ¨ä¼ ç»Ÿçš„æ•°æ®åº“ç³»ç»Ÿä¸Šã€‚è€Œ BASE è¦æ±‚æœ€ç»ˆä¸€è‡´æ€§ï¼Œé€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è¾¾åˆ°å¯ç”¨æ€§ï¼Œé€šå¸¸è¿ç”¨åœ¨å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ã€‚</p>
<p>åœ¨å®é™…çš„åˆ†å¸ƒå¼åœºæ™¯ä¸­ï¼Œä¸åŒä¸šåŠ¡å•å…ƒå’Œç»„ä»¶å¯¹ä¸€è‡´æ€§çš„è¦æ±‚æ˜¯ä¸åŒçš„ï¼Œå› æ­¤ ACID å’Œ BASE å¾€å¾€ä¼šç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ã€‚</p>
<ol>
<li>åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆï¼ˆé›ªèŠ±ç®—æ³•ä¼˜åŒ–ï¼‰</li>
<li>ä¸€è‡´æ€§Hashç®—æ³•è™šæ‹ŸèŠ‚ç‚¹è®¾è®¡</li>
<li>åˆ†å¸ƒå¼é”çš„ä¸‰ç§å®ç°æ–¹å¼å¯¹æ¯”</li>
<li>åˆ†å¸ƒå¼Sessionè§£å†³æ–¹æ¡ˆ</li>
<li>å¦‚ä½•å®ç°æœ€ç»ˆä¸€è‡´æ€§ï¼ˆæ¶ˆæ¯è¡¨+é‡è¯•ï¼‰</li>
<li>åˆ†åº“åˆ†è¡¨ååˆ†é¡µæŸ¥è¯¢æ–¹æ¡ˆ</li>
<li>åˆ†å¸ƒå¼äº‹åŠ¡æœ€å¤§åŠªåŠ›é€šçŸ¥å‹å®ç°</li>
<li>æ•°æ®åŒæ­¥æ–¹æ¡ˆï¼ˆcanal+MQï¼‰</li>
<li>é«˜å¹¶å‘ä¸‹å•ç³»ç»Ÿè®¾è®¡ï¼ˆåº“å­˜æ‰£å‡ï¼‰</li>
<li>åˆ†å¸ƒå¼ç¼“å­˜æ›´æ–°ç­–ç•¥ï¼ˆCache Asideï¼‰</li>
<li>åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶é’ŸåŒæ­¥é—®é¢˜</li>
<li>è„‘è£‚é—®é¢˜è§£å†³æ–¹æ¡ˆ</li>
</ol>
<h2 id="ä¸€è‡´æ€§åè®®"><a href="#ä¸€è‡´æ€§åè®®" class="headerlink" title="ä¸€è‡´æ€§åè®®"></a>ä¸€è‡´æ€§åè®®</h2><h3 id="Paxos"><a href="#Paxos" class="headerlink" title="Paxos"></a>Paxos</h3><h3 id="Raft"><a href="#Raft" class="headerlink" title="Raft"></a>Raft</h3><h2 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h2><h2 id="åˆ†å¸ƒå¼IDç”Ÿæˆ"><a href="#åˆ†å¸ƒå¼IDç”Ÿæˆ" class="headerlink" title="åˆ†å¸ƒå¼IDç”Ÿæˆ"></a>åˆ†å¸ƒå¼IDç”Ÿæˆ</h2><h1 id="ç³»ç»Ÿè®¾è®¡"><a href="#ç³»ç»Ÿè®¾è®¡" class="headerlink" title="ç³»ç»Ÿè®¾è®¡"></a>ç³»ç»Ÿè®¾è®¡</h1><ol>
<li>æœåŠ¡æ³¨å†Œå‘ç°APä¸CPæ¶æ„å¯¹æ¯”</li>
<li>ç†”æ–­é™çº§ç­–ç•¥ï¼ˆæ»‘åŠ¨çª—å£å®ç°ï¼‰</li>
<li>åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒæ¨æ‹‰æ¨¡å¼å¯¹æ¯”</li>
<li>ç°åº¦å‘å¸ƒå®ç°æ–¹æ¡ˆ</li>
<li>åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªåŸç†ï¼ˆSpanæ ‘ï¼‰</li>
<li>Seata ATæ¨¡å¼å®ç°åŸç†</li>
<li>æ¥å£æ€§èƒ½çªå¢çš„é™æµç­–ç•¥</li>
<li>å¦‚ä½•è®¾è®¡æœåŠ¡æ²»ç†å¹³å°ï¼Ÿ</li>
<li>è®¾è®¡å¾®ä¿¡æœ‹å‹åœˆçš„å­˜å‚¨æ¶æ„</li>
<li>çŸ­é“¾ç³»ç»Ÿå¦‚ä½•å®ç°é«˜å¹¶å‘å†™å…¥ï¼Ÿ</li>
<li>åˆ†å¸ƒå¼å”¯ä¸€IDç”Ÿæˆæ–¹æ¡ˆï¼ˆSnowflakeä¼˜åŒ–ï¼‰</li>
<li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªåˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ç³»ç»Ÿï¼Ÿ</li>
<li>å®ç°è·¨æ•°æ®ä¸­å¿ƒçš„æ•°æ®åŒæ­¥æ–¹æ¡ˆ</li>
<li>è®¾è®¡æ”¯æŒåƒä¸‡çº§ç”¨æˆ·çš„æ¨é€ç³»ç»Ÿ</li>
<li>å¾®åšçƒ­æœæ¦œå®æ—¶è®¡ç®—æ¶æ„è®¾è®¡</li>
<li>ç”µå•†åº“å­˜æ‰£å‡çš„é˜²è¶…å–æ–¹æ¡ˆ</li>
<li>å¤šçº§ç¼“å­˜æ¶æ„è®¾è®¡ï¼ˆæœ¬åœ°ç¼“å­˜+Redis+JVMï¼‰</li>
<li>è®¾è®¡æ”¯æŒPBçº§æ•°æ®çš„æ—¥å¿—åˆ†æç³»ç»Ÿ</li>
<li>å®ç°ä¸€ä¸ªåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ</li>
<li>è®¾è®¡æ”¯æŒåŠ¨æ€æ‰©å®¹çš„åˆ†åº“åˆ†è¡¨æ–¹æ¡ˆ</li>
<li>å¦‚ä½•è®¾è®¡APIç½‘å…³çš„é™æµç†”æ–­åŠŸèƒ½ï¼Ÿ</li>
<li>å®æ—¶èŠå¤©ç³»ç»Ÿçš„æ¶ˆæ¯å¯é æŠ•é€’æ–¹æ¡ˆ</li>
<li>è®¾è®¡æ”¯æŒç‰ˆæœ¬å›æ»šçš„é…ç½®ç®¡ç†ç³»ç»Ÿ</li>
<li>å®ç°è·¨è¯­è¨€æœåŠ¡è°ƒç”¨ï¼ˆThrift&#x2F;gRPCé€‰å‹ï¼‰</li>
<li>è®¾è®¡æ”¯æŒå¼¹æ€§ä¼¸ç¼©çš„å¾®æœåŠ¡æ¶æ„</li>
<li>å®ç°åˆ†å¸ƒå¼Sessionä¸€è‡´æ€§æ–¹æ¡ˆ</li>
<li>è®¾è®¡ä¸€ä¸ªé«˜æ€§èƒ½çš„æ—¥å¿—é‡‡é›†ç³»ç»Ÿ</li>
<li>å¦‚ä½•è®¾è®¡å¯è¿½æº¯çš„æ“ä½œæ—¥å¿—ç³»ç»Ÿï¼Ÿ</li>
<li>å¦‚ä½•å®ç°ç†”æ–­å™¨æ¨¡å¼ï¼ˆCircuit Breakerï¼‰ï¼Ÿ</li>
<li>CQRSæ¨¡å¼åœ¨ç”µå•†ç³»ç»Ÿä¸­çš„åº”ç”¨</li>
<li>äº‹ä»¶æº¯æºï¼ˆEvent Sourcingï¼‰çš„ä¼˜ç¼ºç‚¹åˆ†æ</li>
<li>Sidecaræ¨¡å¼åœ¨æœåŠ¡æ²»ç†ä¸­çš„åº”ç”¨</li>
<li>ç½‘å…³æ¨¡å¼ä¸­çš„è·¯ç”±ç­–ç•¥è®¾è®¡</li>
<li>é˜²è…å±‚ï¼ˆAnti-Corruption Layerï¼‰è®¾è®¡å®è·µ</li>
<li>é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰ä¸­çš„èšåˆæ ¹è®¾è®¡</li>
<li>é‡è¯•æ¨¡å¼ä¸­çš„æŒ‡æ•°é€€é¿ç®—æ³•å®ç°</li>
<li>å‰ç«¯çš„åç«¯æ¨¡å¼ï¼ˆBFFï¼‰é€‚ç”¨åœºæ™¯</li>
<li>åˆ†ç‰‡æ¨¡å¼ï¼ˆShardingï¼‰çš„æ•°æ®è¿ç§»æ–¹æ¡ˆ</li>
<li>ç®¡é“è¿‡æ»¤å™¨æ¨¡å¼åœ¨ETLä¸­çš„åº”ç”¨</li>
<li>ç‰©åŒ–è§†å›¾æ¨¡å¼ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½æ¡ˆä¾‹</li>
<li>ç­–ç•¥æ¨¡å¼åœ¨æ”¯ä»˜æ¸ é“é€‰æ‹©ä¸­çš„åº”ç”¨</li>
<li>è§‚å¯Ÿè€…æ¨¡å¼å®ç°é…ç½®åŠ¨æ€æ›´æ–°</li>
<li>ä»£ç†æ¨¡å¼åœ¨ç¼“å­˜ç©¿é€é˜²æŠ¤ä¸­çš„åº”ç”¨</li>
<li>å·¥å‚æ–¹æ³•æ¨¡å¼åœ¨è¿æ¥æ± åˆ›å»ºä¸­çš„åº”ç”¨</li>
<li>è£…é¥°å™¨æ¨¡å¼å®ç°APIé™æµåŠŸèƒ½</li>
<li>çŠ¶æ€æ¨¡å¼åœ¨è®¢å•çŠ¶æ€æµè½¬ä¸­çš„åº”ç”¨</li>
<li>ç»„åˆæ¨¡å¼å®ç°æƒé™æ ‘ç»“æ„è®¾è®¡</li>
<li>æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨äº‹åŠ¡ç®¡ç†ä¸­çš„åº”ç”¨</li>
<li>HTTPSæ¡æ‰‹è¿‡ç¨‹ä¼˜åŒ–ç­–ç•¥</li>
<li>é›¶æ‹·è´æŠ€æœ¯å®ç°åŸç†</li>
<li>ç™¾ä¸‡è¿æ¥æœåŠ¡å™¨æ¶æ„è®¾è®¡</li>
<li>çº¿ä¸ŠCPUé£™é«˜æ’æŸ¥æµç¨‹</li>
<li>è®¾è®¡ä¸€ä¸ªçŸ­é“¾ç³»ç»Ÿ</li>
<li>æ¥å£æ€§èƒ½ä¼˜åŒ–å…¨é“¾è·¯æ–¹æ¡ˆ</li>
<li>æµ·é‡æ•°æ®åˆ¤é‡æ–¹æ¡ˆï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰</li>
<li>å¦‚ä½•è®¾è®¡ç§’æ€ç³»ç»Ÿï¼Ÿ</li>
<li>å¤§å‹é¡¹ç›®ä»£ç è§„èŒƒè½åœ°å®è·µ</li>
<li>çº¿ä¸Šé—®é¢˜æ’æŸ¥å·¥å…·ç®±ï¼ˆarthas+prometheusï¼‰</li>
</ol>
<h2 id="è®¤è¯æˆæƒ"><a href="#è®¤è¯æˆæƒ" class="headerlink" title="è®¤è¯æˆæƒ"></a>è®¤è¯æˆæƒ</h2><h2 id="æ•°æ®å®‰å…¨"><a href="#æ•°æ®å®‰å…¨" class="headerlink" title="æ•°æ®å®‰å…¨"></a>æ•°æ®å®‰å…¨</h2><h2 id="é«˜æ€§èƒ½"><a href="#é«˜æ€§èƒ½" class="headerlink" title="é«˜æ€§èƒ½"></a>é«˜æ€§èƒ½</h2><h2 id="é«˜å¯ç”¨"><a href="#é«˜å¯ç”¨" class="headerlink" title="é«˜å¯ç”¨"></a>é«˜å¯ç”¨</h2><h3 id="é™æµ"><a href="#é™æµ" class="headerlink" title="é™æµ"></a>é™æµ</h3><p>æ ¸å¿ƒæ€æƒ³ï¼š<strong>åœ¨å•ä½æ—¶é—´å†…ï¼Œåªå…è®¸ç‰¹å®šæ•°é‡çš„è¯·æ±‚é€šè¿‡ï¼Œè¶…è¿‡é˜ˆå€¼çš„è¯·æ±‚å°†è¢«æ‹’ç»ã€æ’é˜Ÿç­‰å¾…æˆ–é™çº§å¤„ç†ã€‚</strong> ç›®çš„æ˜¯ä¿æŠ¤ç³»ç»Ÿä¸è¢«çªå‘æµé‡å‹å®ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨æœ€å¤§æ‰¿å—èƒ½åŠ›å†…ç¨³å®šè¿è¡Œã€‚</p>
<h4 id="å¸¸è§çš„é™æµç®—æ³•æœ‰å“ªäº›"><a href="#å¸¸è§çš„é™æµç®—æ³•æœ‰å“ªäº›" class="headerlink" title="å¸¸è§çš„é™æµç®—æ³•æœ‰å“ªäº›"></a>å¸¸è§çš„é™æµç®—æ³•æœ‰å“ªäº›</h4><p><strong>å›ºå®šçª—å£è®¡ç®—å™¨ç®—æ³•</strong></p>
<p><strong>æ»‘åŠ¨çª—å£è®¡æ•°å™¨ç®—æ³•</strong></p>
<p><strong>æ¼æ¡¶ç®—æ³•</strong></p>
<p><strong>ä»¤ç‰Œæ¡¶ç®—æ³•</strong></p>
<h3 id="é™çº§-ç†”æ–­"><a href="#é™çº§-ç†”æ–­" class="headerlink" title="é™çº§&amp;ç†”æ–­"></a>é™çº§&amp;ç†”æ–­</h3><h1 id="DevOps"><a href="#DevOps" class="headerlink" title="DevOps"></a>DevOps</h1><h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><h2 id="CI-CD"><a href="#CI-CD" class="headerlink" title="CI&#x2F;CD"></a>CI&#x2F;CD</h2><h1 id="å·¥å…·ç±»åº“"><a href="#å·¥å…·ç±»åº“" class="headerlink" title="å·¥å…·ç±»åº“"></a>å·¥å…·ç±»åº“</h1><h2 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h2><h2 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h2><h1 id="è®¡ç®—æœºåŸºç¡€"><a href="#è®¡ç®—æœºåŸºç¡€" class="headerlink" title="è®¡ç®—æœºåŸºç¡€"></a>è®¡ç®—æœºåŸºç¡€</h1><h2 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h2><ol>
<li>ç”¨æˆ·æ€ä¸å†…æ ¸æ€åˆ‡æ¢çš„å¼€é”€æ¥æºï¼Ÿ</li>
<li>è¿›ç¨‹é—´é€šä¿¡IPCçš„5ç§æ–¹å¼å¯¹æ¯”</li>
<li>è™šæ‹Ÿå†…å­˜ä¸ç‰©ç†å†…å­˜æ˜ å°„åŸç†ï¼ˆé¡µè¡¨å¯»å€ï¼‰</li>
<li>æ­»é”çš„å¿…è¦æ¡ä»¶åŠé“¶è¡Œå®¶ç®—æ³•å®ç°</li>
<li>è‡ªæ—‹é”ä¸äº’æ–¥é”çš„ä½¿ç”¨åœºæ™¯å·®å¼‚</li>
<li>é›¶æ‹·è´æŠ€æœ¯å®ç°åŸç†ï¼ˆsendfile&#x2F;mmapï¼‰</li>
<li>å­¤å„¿è¿›ç¨‹ä¸åƒµå°¸è¿›ç¨‹çš„åŒºåˆ«åŠå¤„ç†</li>
<li>CPUè½¯ä¸­æ–­ä¸ç¡¬ä¸­æ–­å¤„ç†æœºåˆ¶</li>
<li>å¦‚ä½•ç”¨topå‘½ä»¤åˆ†æCPUè´Ÿè½½å¼‚å¸¸ï¼Ÿ</li>
<li>å†…å­˜æ³„æ¼ä¸å†…å­˜æº¢å‡ºçš„å®šä½æ–¹æ³•</li>
<li>å¤§é¡µå†…å­˜ï¼ˆHugePageï¼‰ä¼˜åŒ–åŸç†</li>
<li>åç¨‹ä¸çº¿ç¨‹çš„è°ƒåº¦æ•ˆç‡å·®å¼‚</li>
<li>æ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰è€—å°½å¦‚ä½•å¤„ç†ï¼Ÿ</li>
<li>CPUç¼“å­˜è¡Œä¼ªå…±äº«é—®é¢˜è§£å†³æ–¹æ¡ˆ</li>
<li>NUMAæ¶æ„ä¸‹çš„æ€§èƒ½è°ƒä¼˜è¦ç‚¹</li>
<li>ç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹è¯¦è§£ï¼ˆint 0x80&#x2F;syscallï¼‰</li>
<li>å®æ—¶æ“ä½œç³»ç»Ÿä¸éå®æ—¶ç³»ç»Ÿçš„è°ƒåº¦å·®å¼‚</li>
<li>å®¹å™¨ä¸è™šæ‹Ÿæœºçš„èµ„æºéš”ç¦»åŸç†å¯¹æ¯”</li>
<li>å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„çº¿ç¨‹æ± ï¼Ÿ</li>
<li>ç³»ç»Ÿå¹³å‡è´Ÿè½½ï¼ˆLoad Averageï¼‰çš„æ·±å±‚å«ä¹‰</li>
</ol>
<h2 id="è®¡ç®—æœºç½‘ç»œ"><a href="#è®¡ç®—æœºç½‘ç»œ" class="headerlink" title="è®¡ç®—æœºç½‘ç»œ"></a>è®¡ç®—æœºç½‘ç»œ</h2><ol>
<li>TCPä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹çš„çŠ¶æ€å˜è¿å›¾</li>
<li>TIME_WAITçŠ¶æ€è¿‡å¤šå¦‚ä½•ä¼˜åŒ–ï¼Ÿ</li>
<li>HTTPSåŒå‘è®¤è¯æµç¨‹ä¸ä¸­é—´äººæ”»å‡»é˜²èŒƒ</li>
<li>QUICåè®®å¦‚ä½•è§£å†³é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼Ÿ</li>
<li>TCPæ‹¥å¡æ§åˆ¶ç®—æ³•ï¼ˆCUBIC&#x2F;BBRï¼‰</li>
<li>HTTP&#x2F;2å¤šè·¯å¤ç”¨ä¸é˜Ÿå¤´é˜»å¡è§£å†³æ–¹æ¡ˆ</li>
<li>Websocketæ¡æ‰‹åè®®ä¸å¿ƒè·³æœºåˆ¶å®ç°</li>
<li>DNSè§£æè¿‡ç¨‹ï¼ˆé€’å½’æŸ¥è¯¢ä¸è¿­ä»£æŸ¥è¯¢ï¼‰</li>
<li>CDNåŠ¨æ€åŠ é€Ÿä¸é™æ€åŠ é€ŸæŠ€æœ¯åŸç†</li>
<li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘è¿æ¥çš„æœåŠ¡ç«¯ï¼Ÿ</li>
<li>é•¿è¿æ¥ä¿æ´»ç­–ç•¥ï¼ˆTCP Keepalive vs åº”ç”¨å±‚å¿ƒè·³ï¼‰</li>
<li>ç½‘ç»œæŠ“åŒ…åˆ†æå®æˆ˜ï¼ˆWiresharkè¿‡æ»¤æŠ€å·§ï¼‰</li>
<li>å•æœºç™¾ä¸‡è¿æ¥çš„å®ç°ä¸ä¼˜åŒ–</li>
<li>HTTP Rangeè¯·æ±‚ä¸æ–­ç‚¹ç»­ä¼ å®ç°</li>
<li>5å±‚åè®®æ ˆä¸­æ¯å±‚çš„å…¸å‹è®¾å¤‡</li>
<li>VLANä¸VXLANçš„åŒºåˆ«åŠä½¿ç”¨åœºæ™¯</li>
<li>å¦‚ä½•å®ç°UDPå¯é ä¼ è¾“ï¼Ÿ</li>
<li>MTUä¸MSSçš„å…³ç³»åŠåˆ†ç‰‡é—®é¢˜</li>
<li>SYN Floodæ”»å‡»åŸç†ä¸é˜²å¾¡æ–¹æ¡ˆ</li>
<li>TLS1.3ç›¸æ¯”1.2çš„æ ¸å¿ƒæ”¹è¿›ç‚¹</li>
</ol>
<h1 id="æ€ç»´é€»è¾‘"><a href="#æ€ç»´é€»è¾‘" class="headerlink" title="æ€ç»´é€»è¾‘"></a>æ€ç»´é€»è¾‘</h1><h2 id="å°ç™½é¼ è¯•æ¯’è¯"><a href="#å°ç™½é¼ è¯•æ¯’è¯" class="headerlink" title="å°ç™½é¼ è¯•æ¯’è¯"></a>å°ç™½é¼ è¯•æ¯’è¯</h2><h2 id="100ä¸ªäººæŒ‰ç¯"><a href="#100ä¸ªäººæŒ‰ç¯" class="headerlink" title="100ä¸ªäººæŒ‰ç¯"></a>100ä¸ªäººæŒ‰ç¯</h2><blockquote>
<p>æœ‰100ç›ç¯,ç¼–å·ä¾æ¬¡ä¸º1,2,3â€¦100,ç”µç¯å…¨éƒ¨å…³ç€ã€‚ç°åœ¨æ¥äº†100ä¸ªäºº,ç¬¬ä¸€ä¸ªäººæŠŠæ‰€æœ‰çš„ç¯å¼€å…³æŒ‰ä¸‹ï¼›ç¬¬äºŒä¸ªäººéš”ä¸€ä¸ªç¯æŒ‰ä¸‹ï¼ˆ2,4,6â€¦ï¼‰ï¼›ç¬¬ä¸‰ä¸ªäººæ¯éš”ä¸¤ä¸ªç¯æŒ‰ä¸‹ï¼ˆ3,6,9â€¦ï¼‰.ç¬¬100ä¸ªäººéš”99ä¸ªç¯æŒ‰ä¸‹ï¼ˆ100ï¼‰,æœ€åè¿˜æœ‰å‡ ç›ç¯ï¼Œé‚£å‡ ç›ç¯äº®ç€ï¼Ÿ</p>
</blockquote>
<h2 id="100çš„é˜¶ä¹˜æœ‰å‡ ä¸ª0"><a href="#100çš„é˜¶ä¹˜æœ‰å‡ ä¸ª0" class="headerlink" title="100çš„é˜¶ä¹˜æœ‰å‡ ä¸ª0"></a>100çš„é˜¶ä¹˜æœ‰å‡ ä¸ª0</h2><p>100çš„é˜¶ä¹˜ï¼ˆ100!ï¼‰æœ‰å¤šå°‘ä¸ªæœ«å°¾çš„é›¶ï¼Œå¯ä»¥é€šè¿‡è®¡ç®—å…¶å› å¼åˆ†è§£ä¸­10çš„å› å­ä¸ªæ•°æ¥ç¡®å®šï¼Œå› ä¸ºæœ«å°¾çš„é›¶æ˜¯ç”±2å’Œ5ç›¸ä¹˜å¾—åˆ°çš„ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†100!è¿›è¡Œå› å¼åˆ†è§£ã€‚100!è¡¨ç¤ºä»1ä¹˜åˆ°100çš„è¿ç»­æ•´æ•°çš„ä¹˜ç§¯ï¼Œå¯ä»¥å†™æˆï¼š</p>
<p>100! &#x3D; 1 Ã— 2 Ã— 3 Ã— 4 Ã— â€¦ Ã— 99 Ã— 100</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è§‚å¯Ÿä¹˜æ³•ä¸­æ¯ä¸€é¡¹çš„å› å­ä¸­2å’Œ5çš„ä¸ªæ•°ã€‚</p>
<p>åœ¨100!ä¸­ï¼Œå¶æ•°çš„å› å­2çš„ä¸ªæ•°æ˜æ˜¾æ¯”5å¤šï¼Œå› ä¸ºæ¯éš”ä¸€ä¸ªæ•°å°±ä¼šæœ‰ä¸€ä¸ªå¶æ•°å‡ºç°ï¼Œè€Œå¶æ•°éƒ½åŒ…å«å› å­2ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨100!ä¸­5çš„å› å­ä¸ªæ•°ã€‚</p>
<p>åœ¨100!ä¸­ï¼Œ5ã€10ã€15ã€20ã€â€¦ã€95ã€100è¿™äº›æ•°éƒ½åŒ…å«å› å­5ï¼Œå…±æœ‰20ä¸ªæ•°ã€‚è€Œ25ã€50ã€75ã€100è¿™äº›æ•°åŒ…å«ä¸¤ä¸ªå› å­5ï¼Œæ‰€ä»¥éœ€è¦å°†å…¶è®¡ç®—åœ¨å†…ã€‚</p>
<p>å› æ­¤ï¼Œ100!ä¸­æ€»å…±æœ‰20 + 4 &#x3D; 24ä¸ªå› å­5ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œ100!æœ«å°¾å…±æœ‰24ä¸ªé›¶ã€‚</p>
<h2 id="ç”¨å¤©å¹³æ‰¾æœ€è½»-é‡çš„çƒ"><a href="#ç”¨å¤©å¹³æ‰¾æœ€è½»-é‡çš„çƒ" class="headerlink" title="ç”¨å¤©å¹³æ‰¾æœ€è½»&#x2F;é‡çš„çƒ"></a>ç”¨å¤©å¹³æ‰¾æœ€è½»&#x2F;é‡çš„çƒ</h2><blockquote>
<p>8ä¸ªçƒï¼Œä¸€ä¸ªè½»ï¼Œå¤©å¹³2æ¬¡æ‰¾å‡ºæ¥</p>
</blockquote>
<p>ç¬¬ä¸€æ¬¡ç§°é‡ï¼šå°†ä»»æ„ä¸‰ä¸ªçƒæ”¾åœ¨å¤©å¹³çš„ä¸€è¾¹ï¼Œå†å°†å¦å¤–ä¸‰ä¸ªçƒæ”¾åœ¨å¦ä¸€è¾¹ï¼Œå‰©ä¸‹çš„ä¸¤ä¸ªçƒä¸æ”¾åœ¨å¤©å¹³ä¸Šã€‚å¦‚æœå¤©å¹³å¹³è¡¡ï¼Œåˆ™è½»çš„çƒåœ¨å‰©ä¸‹çš„ä¸¤ä¸ªçƒä¸­ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ç›®æµ‹æˆ–è€…æ‰‹æ„Ÿæ¥æ‰¾å‡ºè½»çš„çƒã€‚å¦‚æœå¤©å¹³ä¸å¹³è¡¡ï¼Œé‚£ä¹ˆè½»çš„çƒä¸€å®šåœ¨è½»çš„é‚£ä¸€è¾¹ã€‚</p>
<p>ç¬¬äºŒæ¬¡ç§°é‡ï¼šå°†è½»çš„é‚£ä¸€è¾¹çš„ä¸‰ä¸ªçƒä¸­çš„ä¸¤ä¸ªçƒæ”¾åœ¨å¤©å¹³çš„ä¸€è¾¹ï¼Œå°†å‰©ä¸‹çš„ä¸€ä¸ªçƒæ”¾åœ¨å¦ä¸€è¾¹ã€‚å¦‚æœå¤©å¹³å¹³è¡¡ï¼Œåˆ™å‰©ä¸‹çš„é‚£ä¸ªçƒå°±æ˜¯è½»çš„çƒï¼›å¦‚æœå¤©å¹³ä¸å¹³è¡¡ï¼Œé‚£ä¹ˆè½»çš„çƒå°±æ˜¯è½»çš„é‚£ä¸€è¾¹çš„çƒã€‚</p>
<h2 id="2017çš„2017-æ¬¡æ–¹çš„æœ€åä¸€ä½æ•°"><a href="#2017çš„2017-æ¬¡æ–¹çš„æœ€åä¸€ä½æ•°" class="headerlink" title="2017çš„2017 æ¬¡æ–¹çš„æœ€åä¸€ä½æ•°"></a>2017çš„2017 æ¬¡æ–¹çš„æœ€åä¸€ä½æ•°</h2><p>è®¡ç®—2017çš„2017æ¬¡æ–¹çš„æœ€åä¸€ä½æ•°ï¼Œå¯ä»¥ä½¿ç”¨æ•°è®ºä¸­çš„æ•°å­¦æ€§è´¨æ¥ç®€åŒ–è®¡ç®—ã€‚æ ¹æ®æ•°å­¦æ€§è´¨ï¼Œä¸€ä¸ªæ•´æ•°çš„æœ«ä½æ•°åªå’Œè¯¥æ•´æ•°çš„ä¸ªä½æ•°æœ‰å…³ï¼Œè€Œä¸å…¶ä»–ä½æ•°æ— å…³ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è§‚å¯Ÿ2017çš„ä¸ªä½æ•°æ˜¯ä»€ä¹ˆã€‚2017é™¤ä»¥10çš„ä½™æ•°æ˜¯7ï¼Œå› æ­¤2017çš„ä¸ªä½æ•°æ˜¯7ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è§‚å¯Ÿ7çš„å¹‚çš„ä¸ªä½æ•°çš„è§„å¾‹ã€‚æˆ‘ä»¬å¯ä»¥åˆ—ä¸¾ä¸€äº›7çš„å¹‚ï¼Œçœ‹çœ‹ä¸ªä½æ•°çš„å˜åŒ–ï¼š</p>
<p>7^1 &#x3D; 7 7^2 &#x3D; 49 7^3 &#x3D; 343 7^4 &#x3D; 2401 7^5 &#x3D; 16807 â€¦</p>
<p>å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œ7çš„å¹‚çš„ä¸ªä½æ•°ä¼šåœ¨7ã€9ã€3ã€1è¿™å››ä¸ªæ•°å­—ä¹‹é—´å¾ªç¯ã€‚å…·ä½“åœ°ï¼Œ7^1çš„ä¸ªä½æ•°æ˜¯7ï¼Œ7^2çš„ä¸ªä½æ•°æ˜¯9ï¼Œ7^3çš„ä¸ªä½æ•°æ˜¯3ï¼Œ7^4çš„ä¸ªä½æ•°æ˜¯1ï¼Œ7^5çš„ä¸ªä½æ•°åˆæ˜¯7ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªè§„å¾‹æ¥ç®€åŒ–è®¡ç®—2017çš„2017æ¬¡æ–¹çš„ä¸ªä½æ•°ã€‚2017é™¤ä»¥4çš„ä½™æ•°æ˜¯1ï¼Œæ‰€ä»¥2017çš„2017æ¬¡æ–¹çš„ä¸ªä½æ•°ä¹Ÿæ˜¯1ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œ2017çš„2017æ¬¡æ–¹çš„æœ€åä¸€ä½æ•°æ˜¯1ã€‚</p>
<h2 id="25åŒ¹é©¬ï¼Œ5ä¸ªè·‘é“ï¼Œæœ€å°‘æ¯”å¤šå°‘æ¬¡èƒ½æ¯”å‡ºå‰3å"><a href="#25åŒ¹é©¬ï¼Œ5ä¸ªè·‘é“ï¼Œæœ€å°‘æ¯”å¤šå°‘æ¬¡èƒ½æ¯”å‡ºå‰3å" class="headerlink" title="25åŒ¹é©¬ï¼Œ5ä¸ªè·‘é“ï¼Œæœ€å°‘æ¯”å¤šå°‘æ¬¡èƒ½æ¯”å‡ºå‰3å"></a>25åŒ¹é©¬ï¼Œ5ä¸ªè·‘é“ï¼Œæœ€å°‘æ¯”å¤šå°‘æ¬¡èƒ½æ¯”å‡ºå‰3å</h2><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/d6b72329.html" rel="prev" title="Spring/SpringBootå¸¸ç”¨æ‰©å±•ç‚¹">
                  <i class="fa fa-angle-left"></i> Spring/SpringBootå¸¸ç”¨æ‰©å±•ç‚¹
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa-regular fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder"></span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Word count total">119k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">7:13</span>
  </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.0/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>

  <script class="next-config" data-name="wavedrom" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.5.0/wavedrom.min.js","integrity":"sha256-INLAoJc6quTNfiMWkGZniYO2cxE8mHpddnLow1m6RFs="}}</script>
  <script class="next-config" data-name="wavedrom_skin" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.5.0/skins/default.js","integrity":"sha256-fduc/Zszk5ezWws2uInY/ALWVmIrmV6VTgXbsYSReFI="}}</script>
  <script src="/js/third-party/tags/wavedrom.js"></script>




  





</body>
</html>
