<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"timewait7.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="æˆ‘æ¥è®¾è®¡å¹¶å®ç°ä¸€ä¸ªã€ŒRPGæ¸¸æˆåˆ¶ä½œå·¥å…·ã€ï¼Œè¿™ä¸ªé¡¹ç›®å°†æ¶µç›–Pythonçš„å¤§éƒ¨åˆ†æ ¸å¿ƒæŠ€æœ¯æ ˆï¼š ğŸ“¦ PyRPG Maker - Python RPGæ¸¸æˆåˆ¶ä½œå·¥å…·ğŸ¯ é¡¹ç›®ç‰¹ç‚¹ å®Œæ•´æŠ€æœ¯æ ˆè¦†ç›–ï¼šGUIã€æ•°æ®åº“ã€ç½‘ç»œã€å¤šçº¿ç¨‹ã€ç®—æ³•ã€è®¾è®¡æ¨¡å¼ æ¨¡å—åŒ–è®¾è®¡ï¼šå„ç»„ä»¶å¯ç‹¬ç«‹å­¦ä¹  å®ç”¨æ€§å¼ºï¼šå¯å®é™…åˆ¶ä½œå’Œè¿è¡ŒRPGæ¸¸æˆ å¯æ‰©å±•æ€§å¥½ï¼šæ˜“äºæ·»åŠ æ–°åŠŸèƒ½  ğŸ—ï¸ æ¶æ„è®¾è®¡12345678910111213141516171">
<meta property="og:type" content="article">
<meta property="og:title" content="Pythonå®è·µ:RPGæ¸¸æˆåˆ¶ä½œå·¥å…·">
<meta property="og:url" content="http://timewait7.github.io/post/e1bb7308.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="æˆ‘æ¥è®¾è®¡å¹¶å®ç°ä¸€ä¸ªã€ŒRPGæ¸¸æˆåˆ¶ä½œå·¥å…·ã€ï¼Œè¿™ä¸ªé¡¹ç›®å°†æ¶µç›–Pythonçš„å¤§éƒ¨åˆ†æ ¸å¿ƒæŠ€æœ¯æ ˆï¼š ğŸ“¦ PyRPG Maker - Python RPGæ¸¸æˆåˆ¶ä½œå·¥å…·ğŸ¯ é¡¹ç›®ç‰¹ç‚¹ å®Œæ•´æŠ€æœ¯æ ˆè¦†ç›–ï¼šGUIã€æ•°æ®åº“ã€ç½‘ç»œã€å¤šçº¿ç¨‹ã€ç®—æ³•ã€è®¾è®¡æ¨¡å¼ æ¨¡å—åŒ–è®¾è®¡ï¼šå„ç»„ä»¶å¯ç‹¬ç«‹å­¦ä¹  å®ç”¨æ€§å¼ºï¼šå¯å®é™…åˆ¶ä½œå’Œè¿è¡ŒRPGæ¸¸æˆ å¯æ‰©å±•æ€§å¥½ï¼šæ˜“äºæ·»åŠ æ–°åŠŸèƒ½  ğŸ—ï¸ æ¶æ„è®¾è®¡12345678910111213141516171">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-12-17T10:11:36.000Z">
<meta property="article:modified_time" content="2025-12-17T16:07:10.130Z">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://timewait7.github.io/post/e1bb7308.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://timewait7.github.io/post/e1bb7308.html","path":"post/e1bb7308.html","title":"Pythonå®è·µ:RPGæ¸¸æˆåˆ¶ä½œå·¥å…·"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Pythonå®è·µ:RPGæ¸¸æˆåˆ¶ä½œå·¥å…· | Hexo</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Hexo</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-archives"><a href="/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="Searching..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%93%A6-PyRPG-Maker-Python-RPG%E6%B8%B8%E6%88%8F%E5%88%B6%E4%BD%9C%E5%B7%A5%E5%85%B7"><span class="nav-number">1.</span> <span class="nav-text">ğŸ“¦ PyRPG Maker - Python RPGæ¸¸æˆåˆ¶ä½œå·¥å…·</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%F0%9F%8E%AF-%E9%A1%B9%E7%9B%AE%E7%89%B9%E7%82%B9"><span class="nav-number">1.1.</span> <span class="nav-text">ğŸ¯ é¡¹ç›®ç‰¹ç‚¹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%8F%97%EF%B8%8F-%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="nav-number">2.</span> <span class="nav-text">ğŸ—ï¸ æ¶æ„è®¾è®¡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%9A%80-%E5%AE%8C%E6%95%B4%E5%AE%9E%E7%8E%B0%EF%BC%88%E7%AE%80%E5%8C%96%E7%89%88%EF%BC%89"><span class="nav-number">3.</span> <span class="nav-text">ğŸš€ å®Œæ•´å®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84%E5%92%8C%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86"><span class="nav-number">3.1.</span> <span class="nav-text">1. åŸºç¡€æ¶æ„å’Œé…ç½®ç®¡ç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">3.2.</span> <span class="nav-text">2. æ•°æ®æ¨¡å‹å’Œæ•°æ®åº“</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E6%A0%B8%E5%BF%83"><span class="nav-number">3.3.</span> <span class="nav-text">3. æ¸¸æˆå¼•æ“æ ¸å¿ƒ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-GUI%E7%95%8C%E9%9D%A2%EF%BC%88%E4%BD%BF%E7%94%A8PyQt5%EF%BC%89"><span class="nav-number">3.4.</span> <span class="nav-text">4. GUIç•Œé¢ï¼ˆä½¿ç”¨PyQt5ï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%9C%B0%E5%9B%BE%E7%BC%96%E8%BE%91%E5%99%A8%E7%BB%84%E4%BB%B6"><span class="nav-number">3.5.</span> <span class="nav-text">5. åœ°å›¾ç¼–è¾‘å™¨ç»„ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E8%84%9A%E6%9C%AC%E7%B3%BB%E7%BB%9F%E5%92%8C%E4%BA%8B%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="nav-number">3.6.</span> <span class="nav-text">6. è„šæœ¬ç³»ç»Ÿå’Œäº‹ä»¶ç³»ç»Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E7%BD%91%E7%BB%9C%E5%8A%9F%E8%83%BD%EF%BC%88%E5%A4%9A%E4%BA%BA%E6%B8%B8%E6%88%8F%EF%BC%89"><span class="nav-number">3.7.</span> <span class="nav-text">7. ç½‘ç»œåŠŸèƒ½ï¼ˆå¤šäººæ¸¸æˆï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-%E4%B8%BB%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3"><span class="nav-number">3.8.</span> <span class="nav-text">8. ä¸»ç¨‹åºå…¥å£</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%93%8B-%E8%BF%90%E8%A1%8C%E5%92%8C%E5%AE%89%E8%A3%85%E8%AF%B4%E6%98%8E"><span class="nav-number">4.</span> <span class="nav-text">ğŸ“‹ è¿è¡Œå’Œå®‰è£…è¯´æ˜</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="nav-number">4.1.</span> <span class="nav-text">1. å®‰è£…ä¾èµ–</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-number">4.2.</span> <span class="nav-text">2. é¡¹ç›®ç»“æ„</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%BF%90%E8%A1%8C%E9%A1%B9%E7%9B%AE"><span class="nav-number">4.3.</span> <span class="nav-text">3. è¿è¡Œé¡¹ç›®</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%8E%AF-%E6%B6%B5%E7%9B%96%E7%9A%84%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="nav-number">5.</span> <span class="nav-text">ğŸ¯ æ¶µç›–çš„æŠ€æœ¯æ ˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%9C%85-%E5%9F%BA%E7%A1%80%E6%A0%B8%E5%BF%83"><span class="nav-number">5.1.</span> <span class="nav-text">âœ… åŸºç¡€æ ¸å¿ƒ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%9C%85-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7"><span class="nav-number">5.2.</span> <span class="nav-text">âœ… é«˜çº§ç‰¹æ€§</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%9C%85-GUI%E5%BC%80%E5%8F%91"><span class="nav-number">5.3.</span> <span class="nav-text">âœ… GUIå¼€å‘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%9C%85-%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="nav-number">5.4.</span> <span class="nav-text">âœ… æ•°æ®å¤„ç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%9C%85-%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91"><span class="nav-number">5.5.</span> <span class="nav-text">âœ… æ¸¸æˆå¼€å‘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%9C%85-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B"><span class="nav-number">5.6.</span> <span class="nav-text">âœ… ç½‘ç»œç¼–ç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%9C%85-%E5%B7%A5%E7%A8%8B%E5%8C%96"><span class="nav-number">5.7.</span> <span class="nav-text">âœ… å·¥ç¨‹åŒ–</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%F0%9F%9A%80-%E5%A6%82%E4%BD%95%E6%89%A9%E5%B1%95%E9%A1%B9%E7%9B%AE"><span class="nav-number">6.</span> <span class="nav-text">ğŸš€ å¦‚ä½•æ‰©å±•é¡¹ç›®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%B7%BB%E5%8A%A0%E6%96%B0%E5%8A%9F%E8%83%BD"><span class="nav-number">6.1.</span> <span class="nav-text">1. æ·»åŠ æ–°åŠŸèƒ½</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">6.2.</span> <span class="nav-text">2. æ€§èƒ½ä¼˜åŒ–</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%83%A8%E7%BD%B2%E5%8F%91%E5%B8%83"><span class="nav-number">6.3.</span> <span class="nav-text">3. éƒ¨ç½²å‘å¸ƒ</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/">
          <span class="site-state-item-count">56</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://timewait7.github.io/post/e1bb7308.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Pythonå®è·µ:RPGæ¸¸æˆåˆ¶ä½œå·¥å…· | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Pythonå®è·µ:RPGæ¸¸æˆåˆ¶ä½œå·¥å…·
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-12-17 18:11:36" itemprop="dateCreated datePublished" datetime="2025-12-17T18:11:36+08:00">2025-12-17</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>4.7k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>17 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>æˆ‘æ¥è®¾è®¡å¹¶å®ç°ä¸€ä¸ª<strong>ã€ŒRPGæ¸¸æˆåˆ¶ä½œå·¥å…·ã€</strong>ï¼Œè¿™ä¸ªé¡¹ç›®å°†æ¶µç›–Pythonçš„å¤§éƒ¨åˆ†æ ¸å¿ƒæŠ€æœ¯æ ˆï¼š</p>
<h2 id="ğŸ“¦-PyRPG-Maker-Python-RPGæ¸¸æˆåˆ¶ä½œå·¥å…·"><a href="#ğŸ“¦-PyRPG-Maker-Python-RPGæ¸¸æˆåˆ¶ä½œå·¥å…·" class="headerlink" title="ğŸ“¦ PyRPG Maker - Python RPGæ¸¸æˆåˆ¶ä½œå·¥å…·"></a>ğŸ“¦ PyRPG Maker - Python RPGæ¸¸æˆåˆ¶ä½œå·¥å…·</h2><h3 id="ğŸ¯-é¡¹ç›®ç‰¹ç‚¹"><a href="#ğŸ¯-é¡¹ç›®ç‰¹ç‚¹" class="headerlink" title="ğŸ¯ é¡¹ç›®ç‰¹ç‚¹"></a>ğŸ¯ é¡¹ç›®ç‰¹ç‚¹</h3><ul>
<li><strong>å®Œæ•´æŠ€æœ¯æ ˆè¦†ç›–</strong>ï¼šGUIã€æ•°æ®åº“ã€ç½‘ç»œã€å¤šçº¿ç¨‹ã€ç®—æ³•ã€è®¾è®¡æ¨¡å¼</li>
<li><strong>æ¨¡å—åŒ–è®¾è®¡</strong>ï¼šå„ç»„ä»¶å¯ç‹¬ç«‹å­¦ä¹ </li>
<li><strong>å®ç”¨æ€§å¼º</strong>ï¼šå¯å®é™…åˆ¶ä½œå’Œè¿è¡ŒRPGæ¸¸æˆ</li>
<li><strong>å¯æ‰©å±•æ€§å¥½</strong>ï¼šæ˜“äºæ·»åŠ æ–°åŠŸèƒ½</li>
</ul>
<h2 id="ğŸ—ï¸-æ¶æ„è®¾è®¡"><a href="#ğŸ—ï¸-æ¶æ„è®¾è®¡" class="headerlink" title="ğŸ—ï¸ æ¶æ„è®¾è®¡"></a>ğŸ—ï¸ æ¶æ„è®¾è®¡</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">PyRPG-Maker/</span><br><span class="line">â”œâ”€â”€ core/                 # æ ¸å¿ƒå¼•æ“</span><br><span class="line">â”‚   â”œâ”€â”€ game_engine.py   # æ¸¸æˆå¼•æ“</span><br><span class="line">â”‚   â”œâ”€â”€ map_editor.py    # åœ°å›¾ç¼–è¾‘å™¨</span><br><span class="line">â”‚   â”œâ”€â”€ script_editor.py # è„šæœ¬ç¼–è¾‘å™¨</span><br><span class="line">â”‚   â””â”€â”€ resource_manager.py # èµ„æºç®¡ç†</span><br><span class="line">â”œâ”€â”€ gui/                 # ç”¨æˆ·ç•Œé¢</span><br><span class="line">â”‚   â”œâ”€â”€ main_window.py   # ä¸»çª—å£</span><br><span class="line">â”‚   â”œâ”€â”€ toolbar.py       # å·¥å…·æ </span><br><span class="line">â”‚   â””â”€â”€ dialogs/         # å¯¹è¯æ¡†</span><br><span class="line">â”œâ”€â”€ game/                # æ¸¸æˆè¿è¡Œæ—¶</span><br><span class="line">â”‚   â”œâ”€â”€ entities/        # æ¸¸æˆå®ä½“</span><br><span class="line">â”‚   â”œâ”€â”€ systems/         # æ¸¸æˆç³»ç»Ÿ</span><br><span class="line">â”‚   â””â”€â”€ scripts/         # æ¸¸æˆè„šæœ¬</span><br><span class="line">â”œâ”€â”€ data/                # æ•°æ®å­˜å‚¨</span><br><span class="line">â”‚   â”œâ”€â”€ models.py        # æ•°æ®æ¨¡å‹</span><br><span class="line">â”‚   â”œâ”€â”€ database.py      # æ•°æ®åº“æ“ä½œ</span><br><span class="line">â”‚   â””â”€â”€ serialization.py # åºåˆ—åŒ–</span><br><span class="line">â”œâ”€â”€ utils/               # å·¥å…·ç±»</span><br><span class="line">â”‚   â”œâ”€â”€ logger.py        # æ—¥å¿—ç³»ç»Ÿ</span><br><span class="line">â”‚   â”œâ”€â”€ config.py        # é…ç½®ç®¡ç†</span><br><span class="line">â”‚   â””â”€â”€ helpers.py       # è¾…åŠ©å‡½æ•°</span><br><span class="line">â”œâ”€â”€ assets/              # èµ„æºæ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ tests/               # å•å…ƒæµ‹è¯•</span><br><span class="line">â””â”€â”€ docs/                # æ–‡æ¡£</span><br></pre></td></tr></table></figure>



<h2 id="ğŸš€-å®Œæ•´å®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰"><a href="#ğŸš€-å®Œæ•´å®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰" class="headerlink" title="ğŸš€ å®Œæ•´å®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰"></a>ğŸš€ å®Œæ•´å®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰</h2><h3 id="1-åŸºç¡€æ¶æ„å’Œé…ç½®ç®¡ç†"><a href="#1-åŸºç¡€æ¶æ„å’Œé…ç½®ç®¡ç†" class="headerlink" title="1. åŸºç¡€æ¶æ„å’Œé…ç½®ç®¡ç†"></a>1. åŸºç¡€æ¶æ„å’Œé…ç½®ç®¡ç†</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># utils/config.py - é…ç½®ç®¡ç†ï¼ˆå­¦ä¹ ï¼šå•ä¾‹æ¨¡å¼ã€JSONé…ç½®ï¼‰</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span>, <span class="type">Dict</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConfigManager</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;é…ç½®ç®¡ç†å™¨ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    _instance = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__new__</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="keyword">if</span> cls._instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            cls._instance = <span class="built_in">super</span>().__new__(cls)</span><br><span class="line">            cls._instance._initialized = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._initialized:</span><br><span class="line">            self.config_path = Path.home() / <span class="string">&quot;.pyrpg_maker&quot;</span> / <span class="string">&quot;config.json&quot;</span></span><br><span class="line">            self.config_path.parent.mkdir(parents=<span class="literal">True</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line">            self.config = self._load_config()</span><br><span class="line">            self._initialized = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_load_config</span>(<span class="params">self</span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åŠ è½½é…ç½®æ–‡ä»¶&quot;&quot;&quot;</span></span><br><span class="line">        default_config = &#123;</span><br><span class="line">            <span class="string">&quot;window&quot;</span>: &#123;<span class="string">&quot;width&quot;</span>: <span class="number">1024</span>, <span class="string">&quot;height&quot;</span>: <span class="number">768</span>&#125;,</span><br><span class="line">            <span class="string">&quot;editor&quot;</span>: &#123;<span class="string">&quot;grid_size&quot;</span>: <span class="number">32</span>, <span class="string">&quot;autosave&quot;</span>: <span class="literal">True</span>&#125;,</span><br><span class="line">            <span class="string">&quot;recent_projects&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;theme&quot;</span>: <span class="string">&quot;dark&quot;</span>,</span><br><span class="line">            <span class="string">&quot;database&quot;</span>: &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;sqlite&quot;</span>, <span class="string">&quot;path&quot;</span>: <span class="string">&quot;games.db&quot;</span>&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> self.config_path.exists():</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(self.config_path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    <span class="keyword">return</span> &#123;**default_config, **json.load(f)&#125;</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">return</span> default_config</span><br><span class="line">        <span class="keyword">return</span> default_config</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ä¿å­˜é…ç½®&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(self.config_path, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            json.dump(self.config, f, indent=<span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self, key: <span class="built_in">str</span>, default=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è·å–é…ç½®å€¼&quot;&quot;&quot;</span></span><br><span class="line">        keys = key.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        value = self.config</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> keys:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(value, <span class="built_in">dict</span>):</span><br><span class="line">                value = value.get(k, &#123;&#125;)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> default</span><br><span class="line">        <span class="keyword">return</span> value <span class="keyword">if</span> value != &#123;&#125; <span class="keyword">else</span> default</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">set</span>(<span class="params">self, key: <span class="built_in">str</span>, value: <span class="type">Any</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è®¾ç½®é…ç½®å€¼&quot;&quot;&quot;</span></span><br><span class="line">        keys = key.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        config = self.config</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> i, k <span class="keyword">in</span> <span class="built_in">enumerate</span>(keys[:-<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">if</span> k <span class="keyword">not</span> <span class="keyword">in</span> config:</span><br><span class="line">                config[k] = &#123;&#125;</span><br><span class="line">            config = config[k]</span><br><span class="line">        </span><br><span class="line">        config[keys[-<span class="number">1</span>]] = value</span><br><span class="line">        self.save()</span><br><span class="line"></span><br><span class="line"><span class="comment"># utils/logger.py - æ—¥å¿—ç³»ç»Ÿï¼ˆå­¦ä¹ ï¼šè£…é¥°å™¨ã€å¤šçº§æ—¥å¿—ï¼‰</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameLogger</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ¸¸æˆæ—¥å¿—ç³»ç»Ÿ&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name=<span class="string">&quot;PyRPG_Maker&quot;</span></span>):</span><br><span class="line">        self.logger = logging.getLogger(name)</span><br><span class="line">        self.logger.setLevel(logging.DEBUG)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ–‡ä»¶å¤„ç†å™¨</span></span><br><span class="line">        log_dir = Path.home() / <span class="string">&quot;.pyrpg_maker&quot;</span> / <span class="string">&quot;logs&quot;</span></span><br><span class="line">        log_dir.mkdir(parents=<span class="literal">True</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line">        file_handler = logging.FileHandler(</span><br><span class="line">            log_dir / <span class="string">f&quot;<span class="subst">&#123;datetime.now().strftime(<span class="string">&#x27;%Y%m%d&#x27;</span>)&#125;</span>.log&quot;</span></span><br><span class="line">        )</span><br><span class="line">        file_handler.setLevel(logging.DEBUG)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ§åˆ¶å°å¤„ç†å™¨</span></span><br><span class="line">        console_handler = logging.StreamHandler()</span><br><span class="line">        console_handler.setLevel(logging.INFO)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ ¼å¼å™¨</span></span><br><span class="line">        formatter = logging.Formatter(</span><br><span class="line">            <span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span></span><br><span class="line">        )</span><br><span class="line">        file_handler.setFormatter(formatter)</span><br><span class="line">        console_handler.setFormatter(formatter)</span><br><span class="line">        </span><br><span class="line">        self.logger.addHandler(file_handler)</span><br><span class="line">        self.logger.addHandler(console_handler)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">log_function_call</span>(<span class="params">self, func</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è®°å½•å‡½æ•°è°ƒç”¨çš„è£…é¥°å™¨&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">        @wraps(<span class="params">func</span>)</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">            self.logger.debug(<span class="string">f&quot;è°ƒç”¨ <span class="subst">&#123;func.__name__&#125;</span>ï¼Œå‚æ•°: <span class="subst">&#123;args&#125;</span>, <span class="subst">&#123;kwargs&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                result = func(*args, **kwargs)</span><br><span class="line">                self.logger.debug(<span class="string">f&quot;<span class="subst">&#123;func.__name__&#125;</span> æ‰§è¡ŒæˆåŠŸ&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> result</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                self.logger.error(<span class="string">f&quot;<span class="subst">&#123;func.__name__&#125;</span> æ‰§è¡Œå¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>



<h3 id="2-æ•°æ®æ¨¡å‹å’Œæ•°æ®åº“"><a href="#2-æ•°æ®æ¨¡å‹å’Œæ•°æ®åº“" class="headerlink" title="2. æ•°æ®æ¨¡å‹å’Œæ•°æ®åº“"></a>2. æ•°æ®æ¨¡å‹å’Œæ•°æ®åº“</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># data/models.py - æ•°æ®æ¨¡å‹ï¼ˆå­¦ä¹ ï¼šSQLAlchemy ORMï¼‰</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Optional</span></span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine, Column, Integer, String, Text, Float, Boolean, DateTime, ForeignKey</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker, relationship, Session</span><br><span class="line"></span><br><span class="line">Base = declarative_base()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Project</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;é¡¹ç›®æ¨¡å‹&quot;&quot;&quot;</span></span><br><span class="line">    __tablename__ = <span class="string">&#x27;projects&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">id</span> = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">100</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    description = Column(Text)</span><br><span class="line">    created_at = Column(DateTime, default=datetime.utcnow)</span><br><span class="line">    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å…³è”å…³ç³»</span></span><br><span class="line">    maps = relationship(<span class="string">&quot;GameMap&quot;</span>, back_populates=<span class="string">&quot;project&quot;</span>, cascade=<span class="string">&quot;all, delete-orphan&quot;</span>)</span><br><span class="line">    characters = relationship(<span class="string">&quot;Character&quot;</span>, back_populates=<span class="string">&quot;project&quot;</span>, cascade=<span class="string">&quot;all, delete-orphan&quot;</span>)</span><br><span class="line">    items = relationship(<span class="string">&quot;Item&quot;</span>, back_populates=<span class="string">&quot;project&quot;</span>, cascade=<span class="string">&quot;all, delete-orphan&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameMap</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ¸¸æˆåœ°å›¾æ¨¡å‹&quot;&quot;&quot;</span></span><br><span class="line">    __tablename__ = <span class="string">&#x27;maps&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">id</span> = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    project_id = Column(Integer, ForeignKey(<span class="string">&#x27;projects.id&#x27;</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    name = Column(String(<span class="number">100</span>))</span><br><span class="line">    width = Column(Integer, default=<span class="number">20</span>)</span><br><span class="line">    height = Column(Integer, default=<span class="number">15</span>)</span><br><span class="line">    tiles = Column(Text)  <span class="comment"># JSONæ ¼å¼çš„ç“¦ç‰‡æ•°æ®</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å…³è”å…³ç³»</span></span><br><span class="line">    project = relationship(<span class="string">&quot;Project&quot;</span>, back_populates=<span class="string">&quot;maps&quot;</span>)</span><br><span class="line">    events = relationship(<span class="string">&quot;MapEvent&quot;</span>, back_populates=<span class="string">&quot;game_map&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Character</span>(<span class="title class_ inherited__">Base</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è§’è‰²æ¨¡å‹&quot;&quot;&quot;</span></span><br><span class="line">    __tablename__ = <span class="string">&#x27;characters&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">id</span> = Column(Integer, primary_key=<span class="literal">True</span>)</span><br><span class="line">    project_id = Column(Integer, ForeignKey(<span class="string">&#x27;projects.id&#x27;</span>), nullable=<span class="literal">False</span>)</span><br><span class="line">    name = Column(String(<span class="number">100</span>))</span><br><span class="line">    level = Column(Integer, default=<span class="number">1</span>)</span><br><span class="line">    hp = Column(Integer, default=<span class="number">100</span>)</span><br><span class="line">    max_hp = Column(Integer, default=<span class="number">100</span>)</span><br><span class="line">    attack = Column(Integer, default=<span class="number">10</span>)</span><br><span class="line">    defense = Column(Integer, default=<span class="number">5</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å…³è”å…³ç³»</span></span><br><span class="line">    project = relationship(<span class="string">&quot;Project&quot;</span>, back_populates=<span class="string">&quot;characters&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># data/database.py - æ•°æ®åº“æ“ä½œï¼ˆå­¦ä¹ ï¼šä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€è¿æ¥æ± ï¼‰</span></span><br><span class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> contextmanager</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.pool <span class="keyword">import</span> QueuePool</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DatabaseManager</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ•°æ®åº“ç®¡ç†å™¨&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, db_url=<span class="string">&quot;sqlite:///games.db&quot;</span></span>):</span><br><span class="line">        self.engine = create_engine(</span><br><span class="line">            db_url,</span><br><span class="line">            poolclass=QueuePool,</span><br><span class="line">            pool_size=<span class="number">5</span>,</span><br><span class="line">            max_overflow=<span class="number">10</span>,</span><br><span class="line">            pool_timeout=<span class="number">30</span>,</span><br><span class="line">            pool_recycle=<span class="number">3600</span>,</span><br><span class="line">            echo=<span class="literal">False</span></span><br><span class="line">        )</span><br><span class="line">        Base.metadata.create_all(self.engine)</span><br><span class="line">        self.SessionLocal = sessionmaker(bind=self.engine)</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @contextmanager</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_session</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è·å–æ•°æ®åº“ä¼šè¯ï¼ˆä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">        session = self.SessionLocal()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">yield</span> session</span><br><span class="line">            session.commit()</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            session.rollback()</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            session.close()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_project</span>(<span class="params">self, name: <span class="built_in">str</span>, description: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span>) -&gt; Project:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ·»åŠ é¡¹ç›®&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">with</span> self.get_session() <span class="keyword">as</span> session:</span><br><span class="line">            project = Project(name=name, description=description)</span><br><span class="line">            session.add(project)</span><br><span class="line">            session.flush()</span><br><span class="line">            <span class="keyword">return</span> project</span><br></pre></td></tr></table></figure>



<h3 id="3-æ¸¸æˆå¼•æ“æ ¸å¿ƒ"><a href="#3-æ¸¸æˆå¼•æ“æ ¸å¿ƒ" class="headerlink" title="3. æ¸¸æˆå¼•æ“æ ¸å¿ƒ"></a>3. æ¸¸æˆå¼•æ“æ ¸å¿ƒ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># core/game_engine.py - æ¸¸æˆå¼•æ“ï¼ˆå­¦ä¹ ï¼šçŠ¶æ€æœºã€äº‹ä»¶ç³»ç»Ÿï¼‰</span></span><br><span class="line"><span class="keyword">import</span> pygame</span><br><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span>, <span class="type">List</span>, <span class="type">Callable</span>, <span class="type">Any</span></span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass, field</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameState</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ¸¸æˆçŠ¶æ€æšä¸¾&quot;&quot;&quot;</span></span><br><span class="line">    MENU = <span class="string">&quot;menu&quot;</span></span><br><span class="line">    PLAYING = <span class="string">&quot;playing&quot;</span></span><br><span class="line">    PAUSED = <span class="string">&quot;paused&quot;</span></span><br><span class="line">    DIALOG = <span class="string">&quot;dialog&quot;</span></span><br><span class="line">    BATTLE = <span class="string">&quot;battle&quot;</span></span><br><span class="line">    GAME_OVER = <span class="string">&quot;game_over&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameEvent</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ¸¸æˆäº‹ä»¶&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">type</span>: <span class="built_in">str</span></span><br><span class="line">    data: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] = field(default_factory=<span class="built_in">dict</span>)</span><br><span class="line">    timestamp: <span class="built_in">float</span> = field(default_factory=pygame.time.get_ticks)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EventSystem</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;äº‹ä»¶ç³»ç»Ÿï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self._listeners: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">List</span>[<span class="type">Callable</span>]] = &#123;&#125;</span><br><span class="line">        self._event_queue = queue.Queue()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">subscribe</span>(<span class="params">self, event_type: <span class="built_in">str</span>, callback: <span class="type">Callable</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è®¢é˜…äº‹ä»¶&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> event_type <span class="keyword">not</span> <span class="keyword">in</span> self._listeners:</span><br><span class="line">            self._listeners[event_type] = []</span><br><span class="line">        self._listeners[event_type].append(callback)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">unsubscribe</span>(<span class="params">self, event_type: <span class="built_in">str</span>, callback: <span class="type">Callable</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å–æ¶ˆè®¢é˜…&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> event_type <span class="keyword">in</span> self._listeners:</span><br><span class="line">            self._listeners[event_type].remove(callback)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">emit</span>(<span class="params">self, event: GameEvent</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å‘å¸ƒäº‹ä»¶&quot;&quot;&quot;</span></span><br><span class="line">        self._event_queue.put(event)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_events</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†äº‹ä»¶é˜Ÿåˆ—&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> self._event_queue.empty():</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                event = self._event_queue.get_nowait()</span><br><span class="line">                <span class="keyword">if</span> event.<span class="built_in">type</span> <span class="keyword">in</span> self._listeners:</span><br><span class="line">                    <span class="keyword">for</span> callback <span class="keyword">in</span> self._listeners[event.<span class="built_in">type</span>]:</span><br><span class="line">                        <span class="keyword">try</span>:</span><br><span class="line">                            callback(event)</span><br><span class="line">                        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">f&quot;äº‹ä»¶å¤„ç†é”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span> queue.Empty:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameEngine</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æ¸¸æˆå¼•æ“ï¼ˆçŠ¶æ€æ¨¡å¼ + äº‹ä»¶é©±åŠ¨ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, width: <span class="built_in">int</span> = <span class="number">800</span>, height: <span class="built_in">int</span> = <span class="number">600</span></span>):</span><br><span class="line">        pygame.init()</span><br><span class="line">        self.screen = pygame.display.set_mode((width, height))</span><br><span class="line">        self.clock = pygame.time.Clock()</span><br><span class="line">        self.running = <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># çŠ¶æ€ç®¡ç†</span></span><br><span class="line">        self.state: GameState = GameState.MENU</span><br><span class="line">        self.state_handlers: <span class="type">Dict</span>[GameState, <span class="type">Callable</span>] = &#123;</span><br><span class="line">            GameState.MENU: self._handle_menu_state,</span><br><span class="line">            GameState.PLAYING: self._handle_playing_state,</span><br><span class="line">            GameState.PAUSED: self._handle_paused_state,</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># äº‹ä»¶ç³»ç»Ÿ</span></span><br><span class="line">        self.event_system = EventSystem()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ¸¸æˆå¯¹è±¡</span></span><br><span class="line">        self.player = <span class="literal">None</span></span><br><span class="line">        self.current_map = <span class="literal">None</span></span><br><span class="line">        self.npcs: <span class="type">List</span> = []</span><br><span class="line">        self.battle_system = BattleSystem(self)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># èµ„æºç®¡ç†</span></span><br><span class="line">        self.resources: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å¤šçº¿ç¨‹ä»»åŠ¡</span></span><br><span class="line">        self.task_queue = queue.Queue()</span><br><span class="line">        self.result_queue = queue.Queue()</span><br><span class="line">        self.worker_thread = threading.Thread(target=self._worker, daemon=<span class="literal">True</span>)</span><br><span class="line">        self.worker_thread.start()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_worker</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å·¥ä½œçº¿ç¨‹ï¼Œå¤„ç†è€—æ—¶ä»»åŠ¡&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                task = self.task_queue.get()</span><br><span class="line">                <span class="keyword">if</span> task <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># ç»ˆæ­¢ä¿¡å·</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                func, args, kwargs = task</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    result = func(*args, **kwargs)</span><br><span class="line">                    self.result_queue.put((<span class="string">&#x27;success&#x27;</span>, result))</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    self.result_queue.put((<span class="string">&#x27;error&#x27;</span>, <span class="built_in">str</span>(e)))</span><br><span class="line">            <span class="keyword">except</span> queue.Empty:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">submit_task</span>(<span class="params">self, func: <span class="type">Callable</span>, *args, **kwargs</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æäº¤å¼‚æ­¥ä»»åŠ¡&quot;&quot;&quot;</span></span><br><span class="line">        self.task_queue.put((func, args, kwargs))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">load_resources_async</span>(<span class="params">self, resource_paths: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span>]</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¼‚æ­¥åŠ è½½èµ„æº&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">load_task</span>():</span><br><span class="line">            resources = &#123;&#125;</span><br><span class="line">            <span class="keyword">for</span> name, path <span class="keyword">in</span> resource_paths.items():</span><br><span class="line">                <span class="keyword">if</span> path.endswith(<span class="string">&#x27;.png&#x27;</span>):</span><br><span class="line">                    resources[name] = pygame.image.load(path).convert_alpha()</span><br><span class="line">                <span class="keyword">elif</span> path.endswith(<span class="string">&#x27;.wav&#x27;</span>):</span><br><span class="line">                    resources[name] = pygame.mixer.Sound(path)</span><br><span class="line">            <span class="keyword">return</span> resources</span><br><span class="line">        </span><br><span class="line">        self.submit_task(load_task)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_handle_menu_state</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†èœå•çŠ¶æ€&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">            <span class="keyword">if</span> event.<span class="built_in">type</span> == pygame.QUIT:</span><br><span class="line">                self.running = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">elif</span> event.<span class="built_in">type</span> == pygame.KEYDOWN:</span><br><span class="line">                <span class="keyword">if</span> event.key == pygame.K_RETURN:</span><br><span class="line">                    self.state = GameState.PLAYING</span><br><span class="line">                    self.event_system.emit(GameEvent(<span class="string">&quot;game_start&quot;</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_handle_playing_state</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†æ¸¸æˆçŠ¶æ€&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># å¤„ç†äº‹ä»¶</span></span><br><span class="line">        <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">            <span class="keyword">if</span> event.<span class="built_in">type</span> == pygame.QUIT:</span><br><span class="line">                self.running = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">elif</span> event.<span class="built_in">type</span> == pygame.KEYDOWN:</span><br><span class="line">                <span class="keyword">if</span> event.key == pygame.K_ESCAPE:</span><br><span class="line">                    self.state = GameState.PAUSED</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># å¤„ç†ç©å®¶è¾“å…¥</span></span><br><span class="line">                    self.event_system.emit(GameEvent(<span class="string">&quot;player_input&quot;</span>, &#123;<span class="string">&quot;key&quot;</span>: event.key&#125;))</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ›´æ–°æ¸¸æˆé€»è¾‘</span></span><br><span class="line">        <span class="keyword">if</span> self.player:</span><br><span class="line">            self.player.update()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ¸²æŸ“æ¸¸æˆ</span></span><br><span class="line">        self.screen.fill((<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">        <span class="keyword">if</span> self.current_map:</span><br><span class="line">            self.current_map.render(self.screen)</span><br><span class="line">        </span><br><span class="line">        pygame.display.flip()</span><br><span class="line">        self.clock.tick(<span class="number">60</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_handle_paused_state</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†æš‚åœçŠ¶æ€&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">            <span class="keyword">if</span> event.<span class="built_in">type</span> == pygame.QUIT:</span><br><span class="line">                self.running = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">elif</span> event.<span class="built_in">type</span> == pygame.KEYDOWN:</span><br><span class="line">                <span class="keyword">if</span> event.key == pygame.K_ESCAPE:</span><br><span class="line">                    self.state = GameState.PLAYING</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è¿è¡Œæ¸¸æˆä¸»å¾ªç¯&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">while</span> self.running:</span><br><span class="line">            <span class="comment"># å¤„ç†äº‹ä»¶é˜Ÿåˆ—</span></span><br><span class="line">            self.event_system.process_events()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># å¤„ç†å¼‚æ­¥ä»»åŠ¡ç»“æœ</span></span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span> self.result_queue.empty():</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    status, result = self.result_queue.get_nowait()</span><br><span class="line">                    <span class="keyword">if</span> status == <span class="string">&#x27;success&#x27;</span>:</span><br><span class="line">                        <span class="keyword">if</span> <span class="built_in">isinstance</span>(result, <span class="built_in">dict</span>):</span><br><span class="line">                            self.resources.update(result)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;å¼‚æ­¥ä»»åŠ¡é”™è¯¯: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">except</span> queue.Empty:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># æ ¹æ®çŠ¶æ€æ‰§è¡Œå¯¹åº”çš„å¤„ç†å‡½æ•°</span></span><br><span class="line">            <span class="keyword">if</span> self.state <span class="keyword">in</span> self.state_handlers:</span><br><span class="line">                self.state_handlers[self.state]()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.running = <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        self.cleanup()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cleanup</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ¸…ç†èµ„æº&quot;&quot;&quot;</span></span><br><span class="line">        self.task_queue.put(<span class="literal">None</span>)  <span class="comment"># å‘é€ç»ˆæ­¢ä¿¡å·</span></span><br><span class="line">        self.worker_thread.join()</span><br><span class="line">        pygame.quit()</span><br></pre></td></tr></table></figure>



<h3 id="4-GUIç•Œé¢ï¼ˆä½¿ç”¨PyQt5ï¼‰"><a href="#4-GUIç•Œé¢ï¼ˆä½¿ç”¨PyQt5ï¼‰" class="headerlink" title="4. GUIç•Œé¢ï¼ˆä½¿ç”¨PyQt5ï¼‰"></a>4. GUIç•Œé¢ï¼ˆä½¿ç”¨PyQt5ï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gui/main_window.py - ä¸»çª—å£ï¼ˆå­¦ä¹ ï¼šPyQt5ã€MVCæ¶æ„ï¼‰</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> PyQt5.QtWidgets <span class="keyword">import</span> (QApplication, QMainWindow, QWidget, QVBoxLayout, </span><br><span class="line">                             QHBoxLayout, QSplitter, QTabWidget, QTreeWidget,</span><br><span class="line">                             QTreeWidgetItem, QTextEdit, QListWidget, QToolBar,</span><br><span class="line">                             QAction, QFileDialog, QMessageBox)</span><br><span class="line"><span class="keyword">from</span> PyQt5.QtCore <span class="keyword">import</span> Qt, QTimer</span><br><span class="line"><span class="keyword">from</span> PyQt5.QtGui <span class="keyword">import</span> QIcon, QKeySequence</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MainWindow</span>(<span class="title class_ inherited__">QMainWindow</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä¸»çª—å£ï¼ˆMVCæ¶æ„ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.setWindowTitle(<span class="string">&quot;PyRPG Maker&quot;</span>)</span><br><span class="line">        self.setGeometry(<span class="number">100</span>, <span class="number">100</span>, <span class="number">1400</span>, <span class="number">800</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–æ ¸å¿ƒç»„ä»¶</span></span><br><span class="line">        self.config = ConfigManager()</span><br><span class="line">        self.db_manager = DatabaseManager()</span><br><span class="line">        self.game_engine = GameEngine()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è®¾ç½®UI</span></span><br><span class="line">        self._setup_ui()</span><br><span class="line">        self._setup_menu()</span><br><span class="line">        self._setup_toolbar()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è¿æ¥ä¿¡å·æ§½</span></span><br><span class="line">        self._connect_signals()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åŠ è½½æœ€è¿‘çš„é¡¹ç›®</span></span><br><span class="line">        self._load_recent_projects()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_setup_ui</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è®¾ç½®ç”¨æˆ·ç•Œé¢&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># ä¸­å¿ƒéƒ¨ä»¶</span></span><br><span class="line">        central_widget = QWidget()</span><br><span class="line">        self.setCentralWidget(central_widget)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ä¸»å¸ƒå±€</span></span><br><span class="line">        main_layout = QHBoxLayout(central_widget)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å·¦ä¾§é¢æ¿ï¼ˆé¡¹ç›®èµ„æºæ ‘ï¼‰</span></span><br><span class="line">        self.left_panel = self._create_left_panel()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ä¸­å¿ƒåŒºåŸŸï¼ˆç¼–è¾‘å™¨ï¼‰</span></span><br><span class="line">        self.center_area = self._create_center_area()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å³ä¾§é¢æ¿ï¼ˆå±æ€§ç¼–è¾‘ï¼‰</span></span><br><span class="line">        self.right_panel = self._create_right_panel()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ä½¿ç”¨åˆ†å‰²å™¨</span></span><br><span class="line">        splitter = QSplitter(Qt.Horizontal)</span><br><span class="line">        splitter.addWidget(self.left_panel)</span><br><span class="line">        splitter.addWidget(self.center_area)</span><br><span class="line">        splitter.addWidget(self.right_panel)</span><br><span class="line">        splitter.setSizes([<span class="number">200</span>, <span class="number">600</span>, <span class="number">200</span>])</span><br><span class="line">        </span><br><span class="line">        main_layout.addWidget(splitter)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_create_left_panel</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åˆ›å»ºå·¦ä¾§é¡¹ç›®é¢æ¿&quot;&quot;&quot;</span></span><br><span class="line">        panel = QWidget()</span><br><span class="line">        layout = QVBoxLayout(panel)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># é¡¹ç›®æ ‘</span></span><br><span class="line">        self.project_tree = QTreeWidget()</span><br><span class="line">        self.project_tree.setHeaderLabel(<span class="string">&quot;é¡¹ç›®èµ„æº&quot;</span>)</span><br><span class="line">        self.project_tree.itemClicked.connect(self.on_tree_item_clicked)</span><br><span class="line">        </span><br><span class="line">        layout.addWidget(self.project_tree)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># èµ„æºåˆ—è¡¨</span></span><br><span class="line">        self.resource_list = QListWidget()</span><br><span class="line">        layout.addWidget(self.resource_list)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> panel</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_create_center_area</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åˆ›å»ºä¸­å¿ƒç¼–è¾‘åŒºåŸŸ&quot;&quot;&quot;</span></span><br><span class="line">        tabs = QTabWidget()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åœ°å›¾ç¼–è¾‘å™¨æ ‡ç­¾é¡µ</span></span><br><span class="line">        self.map_editor_tab = MapEditorWidget(self.game_engine)</span><br><span class="line">        tabs.addTab(self.map_editor_tab, <span class="string">&quot;åœ°å›¾ç¼–è¾‘å™¨&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è„šæœ¬ç¼–è¾‘å™¨æ ‡ç­¾é¡µ</span></span><br><span class="line">        self.script_editor_tab = ScriptEditorWidget()</span><br><span class="line">        tabs.addTab(self.script_editor_tab, <span class="string">&quot;è„šæœ¬ç¼–è¾‘å™¨&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># äº‹ä»¶ç¼–è¾‘å™¨æ ‡ç­¾é¡µ</span></span><br><span class="line">        self.event_editor_tab = EventEditorWidget()</span><br><span class="line">        tabs.addTab(self.event_editor_tab, <span class="string">&quot;äº‹ä»¶ç¼–è¾‘å™¨&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        tabs.currentChanged.connect(self.on_tab_changed)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> tabs</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_create_right_panel</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åˆ›å»ºå³ä¾§å±æ€§é¢æ¿&quot;&quot;&quot;</span></span><br><span class="line">        panel = QWidget()</span><br><span class="line">        layout = QVBoxLayout(panel)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å±æ€§ç¼–è¾‘å™¨</span></span><br><span class="line">        self.property_editor = PropertyEditor()</span><br><span class="line">        layout.addWidget(self.property_editor)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ§åˆ¶å°è¾“å‡º</span></span><br><span class="line">        self.console_output = QTextEdit()</span><br><span class="line">        self.console_output.setReadOnly(<span class="literal">True</span>)</span><br><span class="line">        layout.addWidget(self.console_output)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> panel</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_setup_menu</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è®¾ç½®èœå•æ &quot;&quot;&quot;</span></span><br><span class="line">        menubar = self.menuBar()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ–‡ä»¶èœå•</span></span><br><span class="line">        file_menu = menubar.addMenu(<span class="string">&quot;æ–‡ä»¶&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        new_project_action = QAction(<span class="string">&quot;æ–°å»ºé¡¹ç›®&quot;</span>, self)</span><br><span class="line">        new_project_action.triggered.connect(self.new_project)</span><br><span class="line">        file_menu.addAction(new_project_action)</span><br><span class="line">        </span><br><span class="line">        open_project_action = QAction(<span class="string">&quot;æ‰“å¼€é¡¹ç›®&quot;</span>, self)</span><br><span class="line">        open_project_action.triggered.connect(self.open_project)</span><br><span class="line">        file_menu.addAction(open_project_action)</span><br><span class="line">        </span><br><span class="line">        file_menu.addSeparator()</span><br><span class="line">        </span><br><span class="line">        save_action = QAction(<span class="string">&quot;ä¿å­˜&quot;</span>, self)</span><br><span class="line">        save_action.setShortcut(QKeySequence.Save)</span><br><span class="line">        save_action.triggered.connect(self.save_project)</span><br><span class="line">        file_menu.addAction(save_action)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ç¼–è¾‘èœå•</span></span><br><span class="line">        edit_menu = menubar.addMenu(<span class="string">&quot;ç¼–è¾‘&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        undo_action = QAction(<span class="string">&quot;æ’¤é”€&quot;</span>, self)</span><br><span class="line">        undo_action.setShortcut(QKeySequence.Undo)</span><br><span class="line">        edit_menu.addAction(undo_action)</span><br><span class="line">        </span><br><span class="line">        redo_action = QAction(<span class="string">&quot;é‡åš&quot;</span>, self)</span><br><span class="line">        redo_action.setShortcut(QKeySequence.Redo)</span><br><span class="line">        edit_menu.addAction(redo_action)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è¿è¡Œèœå•</span></span><br><span class="line">        run_menu = menubar.addMenu(<span class="string">&quot;è¿è¡Œ&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        test_run_action = QAction(<span class="string">&quot;æµ‹è¯•è¿è¡Œ&quot;</span>, self)</span><br><span class="line">        test_run_action.triggered.connect(self.test_run_game)</span><br><span class="line">        run_menu.addAction(test_run_action)</span><br><span class="line">        </span><br><span class="line">        export_action = QAction(<span class="string">&quot;å¯¼å‡ºæ¸¸æˆ&quot;</span>, self)</span><br><span class="line">        export_action.triggered.connect(self.export_game)</span><br><span class="line">        run_menu.addAction(export_action)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_setup_toolbar</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è®¾ç½®å·¥å…·æ &quot;&quot;&quot;</span></span><br><span class="line">        toolbar = QToolBar(<span class="string">&quot;ä¸»å·¥å…·æ &quot;</span>)</span><br><span class="line">        self.addToolBar(toolbar)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ·»åŠ å·¥å…·æ æŒ‰é’®</span></span><br><span class="line">        toolbar.addAction(QIcon(<span class="string">&quot;icons/new.png&quot;</span>), <span class="string">&quot;æ–°å»º&quot;</span>)</span><br><span class="line">        toolbar.addAction(QIcon(<span class="string">&quot;icons/open.png&quot;</span>), <span class="string">&quot;æ‰“å¼€&quot;</span>)</span><br><span class="line">        toolbar.addSeparator()</span><br><span class="line">        toolbar.addAction(QIcon(<span class="string">&quot;icons/save.png&quot;</span>), <span class="string">&quot;ä¿å­˜&quot;</span>)</span><br><span class="line">        toolbar.addSeparator()</span><br><span class="line">        toolbar.addAction(QIcon(<span class="string">&quot;icons/run.png&quot;</span>), <span class="string">&quot;è¿è¡Œ&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_connect_signals</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è¿æ¥ä¿¡å·å’Œæ§½&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># æ¸¸æˆå¼•æ“äº‹ä»¶è¿æ¥åˆ°UIæ›´æ–°</span></span><br><span class="line">        self.game_engine.event_system.subscribe(<span class="string">&quot;game_start&quot;</span>, </span><br><span class="line">                                              self.on_game_start)</span><br><span class="line">        self.game_engine.event_system.subscribe(<span class="string">&quot;game_pause&quot;</span>,</span><br><span class="line">                                              self.on_game_pause)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">new_project</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ–°å»ºé¡¹ç›®&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">from</span> gui.dialogs.new_project <span class="keyword">import</span> NewProjectDialog</span><br><span class="line">        </span><br><span class="line">        dialog = NewProjectDialog(self)</span><br><span class="line">        <span class="keyword">if</span> dialog.exec_():</span><br><span class="line">            project_name, project_path = dialog.get_project_info()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> self.db_manager.get_session() <span class="keyword">as</span> session:</span><br><span class="line">                    project = Project(name=project_name)</span><br><span class="line">                    session.add(project)</span><br><span class="line">                </span><br><span class="line">                self.current_project = project</span><br><span class="line">                self._update_project_tree()</span><br><span class="line">                self.statusBar().showMessage(<span class="string">f&quot;å·²åˆ›å»ºé¡¹ç›®: <span class="subst">&#123;project_name&#125;</span>&quot;</span>, <span class="number">3000</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># æ·»åŠ åˆ°æœ€è¿‘é¡¹ç›®</span></span><br><span class="line">                recent = self.config.get(<span class="string">&quot;recent_projects&quot;</span>, [])</span><br><span class="line">                recent.insert(<span class="number">0</span>, <span class="built_in">str</span>(project_path))</span><br><span class="line">                self.config.<span class="built_in">set</span>(<span class="string">&quot;recent_projects&quot;</span>, recent[:<span class="number">10</span>])</span><br><span class="line">                </span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                QMessageBox.critical(self, <span class="string">&quot;é”™è¯¯&quot;</span>, <span class="string">f&quot;åˆ›å»ºé¡¹ç›®å¤±è´¥: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_run_game</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æµ‹è¯•è¿è¡Œæ¸¸æˆ&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.current_project:</span><br><span class="line">            QMessageBox.warning(self, <span class="string">&quot;è­¦å‘Š&quot;</span>, <span class="string">&quot;è¯·å…ˆåˆ›å»ºæˆ–æ‰“å¼€ä¸€ä¸ªé¡¹ç›®&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åœ¨æ–°çº¿ç¨‹ä¸­è¿è¡Œæ¸¸æˆ</span></span><br><span class="line">        <span class="keyword">import</span> threading</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">run_game</span>():</span><br><span class="line">            self.game_engine.run()</span><br><span class="line">        </span><br><span class="line">        game_thread = threading.Thread(target=run_game, daemon=<span class="literal">True</span>)</span><br><span class="line">        game_thread.start()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_update_project_tree</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ›´æ–°é¡¹ç›®æ ‘&quot;&quot;&quot;</span></span><br><span class="line">        self.project_tree.clear()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.current_project:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        root = QTreeWidgetItem(self.project_tree, [self.current_project.name])</span><br><span class="line">        root.setData(<span class="number">0</span>, Qt.UserRole, (<span class="string">&quot;project&quot;</span>, self.current_project.<span class="built_in">id</span>))</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ·»åŠ å­é¡¹</span></span><br><span class="line">        maps_item = QTreeWidgetItem(root, [<span class="string">&quot;åœ°å›¾&quot;</span>])</span><br><span class="line">        characters_item = QTreeWidgetItem(root, [<span class="string">&quot;è§’è‰²&quot;</span>])</span><br><span class="line">        items_item = QTreeWidgetItem(root, [<span class="string">&quot;ç‰©å“&quot;</span>])</span><br><span class="line">        events_item = QTreeWidgetItem(root, [<span class="string">&quot;äº‹ä»¶&quot;</span>])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å±•å¼€æ ¹èŠ‚ç‚¹</span></span><br><span class="line">        root.setExpanded(<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_tree_item_clicked</span>(<span class="params">self, item, column</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†æ ‘å½¢æ§ä»¶é¡¹ç‚¹å‡»&quot;&quot;&quot;</span></span><br><span class="line">        data = item.data(<span class="number">0</span>, Qt.UserRole)</span><br><span class="line">        <span class="keyword">if</span> data:</span><br><span class="line">            item_type, item_id = data</span><br><span class="line">            self._load_item_details(item_type, item_id)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">closeEvent</span>(<span class="params">self, event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å…³é—­äº‹ä»¶&quot;&quot;&quot;</span></span><br><span class="line">        reply = QMessageBox.question(</span><br><span class="line">            self, <span class="string">&quot;ç¡®è®¤é€€å‡º&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ç¡®å®šè¦é€€å‡ºå—ï¼Ÿæœªä¿å­˜çš„æ›´æ”¹å°†ä¼šä¸¢å¤±ã€‚&quot;</span>,</span><br><span class="line">            QMessageBox.Yes | QMessageBox.No,</span><br><span class="line">            QMessageBox.No</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> reply == QMessageBox.Yes:</span><br><span class="line">            <span class="comment"># ä¿å­˜é…ç½®</span></span><br><span class="line">            self.config.save()</span><br><span class="line">            event.accept()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            event.ignore()</span><br></pre></td></tr></table></figure>



<h3 id="5-åœ°å›¾ç¼–è¾‘å™¨ç»„ä»¶"><a href="#5-åœ°å›¾ç¼–è¾‘å™¨ç»„ä»¶" class="headerlink" title="5. åœ°å›¾ç¼–è¾‘å™¨ç»„ä»¶"></a>5. åœ°å›¾ç¼–è¾‘å™¨ç»„ä»¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gui/map_editor.py - åœ°å›¾ç¼–è¾‘å™¨ï¼ˆå­¦ä¹ ï¼šCanvasç»˜åˆ¶ã€äº‹ä»¶å¤„ç†ï¼‰</span></span><br><span class="line"><span class="keyword">from</span> PyQt5.QtWidgets <span class="keyword">import</span> QWidget, QGraphicsView, QGraphicsScene</span><br><span class="line"><span class="keyword">from</span> PyQt5.QtGui <span class="keyword">import</span> QPainter, QPen, QBrush, QColor</span><br><span class="line"><span class="keyword">from</span> PyQt5.QtCore <span class="keyword">import</span> Qt, QPoint, QRect</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MapEditorWidget</span>(<span class="title class_ inherited__">QWidget</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;åœ°å›¾ç¼–è¾‘å™¨ç»„ä»¶&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, game_engine</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.game_engine = game_engine</span><br><span class="line">        self.current_map = <span class="literal">None</span></span><br><span class="line">        self.tile_size = <span class="number">32</span></span><br><span class="line">        self.grid_enabled = <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ç»˜å›¾ç›¸å…³</span></span><br><span class="line">        self.drawing = <span class="literal">False</span></span><br><span class="line">        self.current_tool = <span class="string">&quot;select&quot;</span></span><br><span class="line">        self.selected_tile = <span class="literal">None</span></span><br><span class="line">        self.brush_color = QColor(<span class="number">100</span>, <span class="number">150</span>, <span class="number">200</span>, <span class="number">200</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–UI</span></span><br><span class="line">        self._init_ui()</span><br><span class="line">        self._setup_shortcuts()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_init_ui</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åˆå§‹åŒ–UI&quot;&quot;&quot;</span></span><br><span class="line">        self.scene = QGraphicsScene()</span><br><span class="line">        self.view = MapGraphicsView(self.scene, self)</span><br><span class="line">        self.view.setRenderHint(QPainter.Antialiasing)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è®¾ç½®è§†å£</span></span><br><span class="line">        self.view.setHorizontalScrollBarPolicy(Qt.ScrollBarAlwaysOn)</span><br><span class="line">        self.view.setVerticalScrollBarPolicy(Qt.ScrollBarAlwaysOn)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å¸ƒå±€</span></span><br><span class="line">        <span class="keyword">from</span> PyQt5.QtWidgets <span class="keyword">import</span> QVBoxLayout</span><br><span class="line">        layout = QVBoxLayout()</span><br><span class="line">        layout.addWidget(self.view)</span><br><span class="line">        self.setLayout(layout)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åˆå§‹ç»˜åˆ¶</span></span><br><span class="line">        self.draw_grid()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">draw_grid</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ç»˜åˆ¶ç½‘æ ¼&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.grid_enabled <span class="keyword">or</span> <span class="keyword">not</span> self.current_map:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        pen = QPen(QColor(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>), <span class="number">1</span>, Qt.DashLine)</span><br><span class="line">        brush = QBrush(Qt.NoBrush)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, self.current_map.width * self.tile_size, self.tile_size):</span><br><span class="line">            self.scene.addLine(x, <span class="number">0</span>, x, self.current_map.height * self.tile_size, pen)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, self.current_map.height * self.tile_size, self.tile_size):</span><br><span class="line">            self.scene.addLine(<span class="number">0</span>, y, self.current_map.width * self.tile_size, y, pen)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mousePressEvent</span>(<span class="params">self, event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> event.button() == Qt.LeftButton:</span><br><span class="line">            pos = self.view.mapToScene(event.pos())</span><br><span class="line">            grid_x = <span class="built_in">int</span>(pos.x() // self.tile_size)</span><br><span class="line">            grid_y = <span class="built_in">int</span>(pos.y() // self.tile_size)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> self.current_tool == <span class="string">&quot;pencil&quot;</span>:</span><br><span class="line">                self.draw_tile(grid_x, grid_y)</span><br><span class="line">            <span class="keyword">elif</span> self.current_tool == <span class="string">&quot;fill&quot;</span>:</span><br><span class="line">                self.fill_area(grid_x, grid_y)</span><br><span class="line">            </span><br><span class="line">            self.drawing = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">draw_tile</span>(<span class="params">self, x, y</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;ç»˜åˆ¶å•ä¸ªç“¦ç‰‡&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">0</span> &lt;= x &lt; self.current_map.width <span class="keyword">and</span> </span><br><span class="line">                <span class="number">0</span> &lt;= y &lt; self.current_map.height):</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ›´æ–°åœ°å›¾æ•°æ®</span></span><br><span class="line">        self.current_map.tiles[y][x] = self.selected_tile</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ›´æ–°æ˜¾ç¤º</span></span><br><span class="line">        rect = QRect(x * self.tile_size, y * self.tile_size, </span><br><span class="line">                    self.tile_size, self.tile_size)</span><br><span class="line">        brush = QBrush(self.brush_color)</span><br><span class="line">        self.scene.addRect(rect, QPen(Qt.NoPen), brush)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fill_area</span>(<span class="params">self, start_x, start_y</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åŒºåŸŸå¡«å……ï¼ˆæ´ªæ°´å¡«å……ç®—æ³•ï¼‰&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.selected_tile:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        target_tile = self.current_map.tiles[start_y][start_x]</span><br><span class="line">        <span class="keyword">if</span> target_tile == self.selected_tile:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ä½¿ç”¨æ ˆå®ç°æ´ªæ°´å¡«å……</span></span><br><span class="line">        stack = [(start_x, start_y)]</span><br><span class="line">        visited = <span class="built_in">set</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> stack:</span><br><span class="line">            x, y = stack.pop()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (x, y) <span class="keyword">in</span> visited:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            visited.add((x, y))</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">0</span> &lt;= x &lt; self.current_map.width <span class="keyword">and</span> </span><br><span class="line">                    <span class="number">0</span> &lt;= y &lt; self.current_map.height):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> self.current_map.tiles[y][x] != target_tile:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            self.draw_tile(x, y)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># æ·»åŠ ç›¸é‚»ä½ç½®</span></span><br><span class="line">            stack.append((x + <span class="number">1</span>, y))</span><br><span class="line">            stack.append((x - <span class="number">1</span>, y))</span><br><span class="line">            stack.append((x, y + <span class="number">1</span>))</span><br><span class="line">            stack.append((x, y - <span class="number">1</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_setup_shortcuts</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è®¾ç½®å¿«æ·é”®&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">from</span> PyQt5.QtWidgets <span class="keyword">import</span> QShortcut</span><br><span class="line">        <span class="keyword">from</span> PyQt5.QtGui <span class="keyword">import</span> QKeySequence</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åˆ‡æ¢å·¥å…·</span></span><br><span class="line">        QShortcut(QKeySequence(<span class="string">&quot;P&quot;</span>), self, <span class="keyword">lambda</span>: self.set_tool(<span class="string">&quot;pencil&quot;</span>))</span><br><span class="line">        QShortcut(QKeySequence(<span class="string">&quot;E&quot;</span>), self, <span class="keyword">lambda</span>: self.set_tool(<span class="string">&quot;eraser&quot;</span>))</span><br><span class="line">        QShortcut(QKeySequence(<span class="string">&quot;F&quot;</span>), self, <span class="keyword">lambda</span>: self.set_tool(<span class="string">&quot;fill&quot;</span>))</span><br><span class="line">        QShortcut(QKeySequence(<span class="string">&quot;G&quot;</span>), self, self.toggle_grid)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MapGraphicsView</span>(<span class="title class_ inherited__">QGraphicsView</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è‡ªå®šä¹‰åœ°å›¾è§†å›¾ï¼Œæ”¯æŒç¼©æ”¾å’Œæ‹–æ‹½&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, scene, parent=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(scene, parent)</span><br><span class="line">        self.setDragMode(QGraphicsView.ScrollHandDrag)</span><br><span class="line">        self.setTransformationAnchor(QGraphicsView.AnchorUnderMouse)</span><br><span class="line">        self.setResizeAnchor(QGraphicsView.AnchorUnderMouse)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wheelEvent</span>(<span class="params">self, event</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ»šè½®ç¼©æ”¾&quot;&quot;&quot;</span></span><br><span class="line">        factor = <span class="number">1.2</span></span><br><span class="line">        <span class="keyword">if</span> event.angleDelta().y() &gt; <span class="number">0</span>:</span><br><span class="line">            self.scale(factor, factor)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.scale(<span class="number">1</span>/factor, <span class="number">1</span>/factor)</span><br></pre></td></tr></table></figure>



<h3 id="6-è„šæœ¬ç³»ç»Ÿå’Œäº‹ä»¶ç³»ç»Ÿ"><a href="#6-è„šæœ¬ç³»ç»Ÿå’Œäº‹ä»¶ç³»ç»Ÿ" class="headerlink" title="6. è„šæœ¬ç³»ç»Ÿå’Œäº‹ä»¶ç³»ç»Ÿ"></a>6. è„šæœ¬ç³»ç»Ÿå’Œäº‹ä»¶ç³»ç»Ÿ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># game/scripts/script_system.py - è„šæœ¬ç³»ç»Ÿï¼ˆå­¦ä¹ ï¼šè§£é‡Šå™¨æ¨¡å¼ã€ASTï¼‰</span></span><br><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"><span class="keyword">import</span> types</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span>, <span class="type">Any</span>, <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ScriptInterpreter</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;è„šæœ¬è§£é‡Šå™¨&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.<span class="built_in">globals</span>: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] = &#123;</span><br><span class="line">            <span class="string">&#x27;print&#x27;</span>: self._script_print,</span><br><span class="line">            <span class="string">&#x27;set_variable&#x27;</span>: self._set_variable,</span><br><span class="line">            <span class="string">&#x27;get_variable&#x27;</span>: self._get_variable,</span><br><span class="line">            <span class="string">&#x27;show_message&#x27;</span>: self._show_message,</span><br><span class="line">            <span class="string">&#x27;start_battle&#x27;</span>: self._start_battle,</span><br><span class="line">        &#125;</span><br><span class="line">        self.<span class="built_in">locals</span>: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_script_print</span>(<span class="params">self, *args</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è„šæœ¬ä¸­çš„printå‡½æ•°&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[è„šæœ¬]&quot;</span>, *args)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, script: <span class="built_in">str</span>, context: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>] = <span class="literal">None</span></span>) -&gt; <span class="type">Any</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;æ‰§è¡Œè„šæœ¬&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> context:</span><br><span class="line">            self.<span class="built_in">locals</span>.update(context)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># è§£æå’Œæ‰§è¡Œè„šæœ¬</span></span><br><span class="line">            tree = ast.parse(script, mode=<span class="string">&#x27;exec&#x27;</span>)</span><br><span class="line">            code = <span class="built_in">compile</span>(tree, <span class="string">&#x27;&lt;string&gt;&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>)</span><br><span class="line">            <span class="built_in">exec</span>(code, self.<span class="built_in">globals</span>, self.<span class="built_in">locals</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># è·å–æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼ˆå¦‚æœæœ‰ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> tree.body <span class="keyword">and</span> <span class="built_in">isinstance</span>(tree.body[-<span class="number">1</span>], ast.Expr):</span><br><span class="line">                expr_tree = ast.Expression(tree.body[-<span class="number">1</span>].value)</span><br><span class="line">                expr_code = <span class="built_in">compile</span>(expr_tree, <span class="string">&#x27;&lt;string&gt;&#x27;</span>, <span class="string">&#x27;eval&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">eval</span>(expr_code, self.<span class="built_in">globals</span>, self.<span class="built_in">locals</span>)</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;è„šæœ¬æ‰§è¡Œé”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># game/systems/battle_system.py - æˆ˜æ–—ç³»ç»Ÿï¼ˆå­¦ä¹ ï¼šå›åˆåˆ¶ç®—æ³•ã€çŠ¶æ€æ•ˆæœï¼‰</span></span><br><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BattleAction</span>(<span class="title class_ inherited__">Enum</span>):</span><br><span class="line">    ATTACK = <span class="string">&quot;attack&quot;</span></span><br><span class="line">    DEFEND = <span class="string">&quot;defend&quot;</span></span><br><span class="line">    SKILL = <span class="string">&quot;skill&quot;</span></span><br><span class="line">    ITEM = <span class="string">&quot;item&quot;</span></span><br><span class="line">    ESCAPE = <span class="string">&quot;escape&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BattleSystem</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å›åˆåˆ¶æˆ˜æ–—ç³»ç»Ÿ&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, game_engine</span>):</span><br><span class="line">        self.game_engine = game_engine</span><br><span class="line">        self.in_battle = <span class="literal">False</span></span><br><span class="line">        self.player_party: <span class="type">List</span> = []</span><br><span class="line">        self.enemies: <span class="type">List</span> = []</span><br><span class="line">        self.turn_order: <span class="type">List</span> = []</span><br><span class="line">        self.current_turn = <span class="number">0</span></span><br><span class="line">        self.battle_log: <span class="type">List</span>[<span class="built_in">str</span>] = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start_battle</span>(<span class="params">self, player_party: <span class="type">List</span>, enemies: <span class="type">List</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¼€å§‹æˆ˜æ–—&quot;&quot;&quot;</span></span><br><span class="line">        self.in_battle = <span class="literal">True</span></span><br><span class="line">        self.player_party = player_party</span><br><span class="line">        self.enemies = enemies</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è®¡ç®—è¡ŒåŠ¨é¡ºåºï¼ˆåŸºäºé€Ÿåº¦ï¼‰</span></span><br><span class="line">        self._calculate_turn_order()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å‘å¸ƒæˆ˜æ–—å¼€å§‹äº‹ä»¶</span></span><br><span class="line">        self.game_engine.event_system.emit(</span><br><span class="line">            GameEvent(<span class="string">&quot;battle_start&quot;</span>, &#123;</span><br><span class="line">                <span class="string">&quot;player_party&quot;</span>: player_party,</span><br><span class="line">                <span class="string">&quot;enemies&quot;</span>: enemies</span><br><span class="line">            &#125;)</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">        self.battle_log.append(<span class="string">&quot;æˆ˜æ–—å¼€å§‹ï¼&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_calculate_turn_order</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;è®¡ç®—è¡ŒåŠ¨é¡ºåº&quot;&quot;&quot;</span></span><br><span class="line">        all_combatants = self.player_party + self.enemies</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æŒ‰é€Ÿåº¦æ’åºï¼Œé€Ÿåº¦ç›¸åŒåˆ™éšæœº</span></span><br><span class="line">        self.turn_order = <span class="built_in">sorted</span>(</span><br><span class="line">            all_combatants,</span><br><span class="line">            key=<span class="keyword">lambda</span> c: (c.speed, random.random()),</span><br><span class="line">            reverse=<span class="literal">True</span></span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_turn</span>(<span class="params">self, combatant, action: BattleAction, target=<span class="literal">None</span>, **kwargs</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†ä¸€ä¸ªå›åˆ&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.in_battle:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        result = <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> action == BattleAction.ATTACK:</span><br><span class="line">            result = self._process_attack(combatant, target)</span><br><span class="line">        <span class="keyword">elif</span> action == BattleAction.DEFEND:</span><br><span class="line">            result = self._process_defend(combatant)</span><br><span class="line">        <span class="keyword">elif</span> action == BattleAction.SKILL:</span><br><span class="line">            result = self._process_skill(combatant, target, kwargs.get(<span class="string">&#x27;skill&#x27;</span>))</span><br><span class="line">        <span class="keyword">elif</span> action == BattleAction.ESCAPE:</span><br><span class="line">            result = self._process_escape(combatant)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ£€æŸ¥æˆ˜æ–—æ˜¯å¦ç»“æŸ</span></span><br><span class="line">        <span class="keyword">if</span> self._check_battle_end():</span><br><span class="line">            self.end_battle()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_process_attack</span>(<span class="params">self, attacker, target</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†æ”»å‡»&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> target:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;success&quot;</span>: <span class="literal">False</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;æ²¡æœ‰é€‰æ‹©ç›®æ ‡&quot;</span>&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è®¡ç®—å‘½ä¸­ç‡</span></span><br><span class="line">        hit_chance = <span class="number">0.8</span> + (attacker.dexterity - target.dexterity) * <span class="number">0.01</span></span><br><span class="line">        hit_chance = <span class="built_in">max</span>(<span class="number">0.2</span>, <span class="built_in">min</span>(<span class="number">0.95</span>, hit_chance))</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ˜¯å¦å‘½ä¸­</span></span><br><span class="line">        <span class="keyword">if</span> random.random() &gt; hit_chance:</span><br><span class="line">            message = <span class="string">f&quot;<span class="subst">&#123;attacker.name&#125;</span> çš„æ”»å‡»è¢« <span class="subst">&#123;target.name&#125;</span> é—ªé¿äº†ï¼&quot;</span></span><br><span class="line">            self.battle_log.append(message)</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;success&quot;</span>: <span class="literal">False</span>, <span class="string">&quot;message&quot;</span>: message&#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># è®¡ç®—ä¼¤å®³</span></span><br><span class="line">        damage = attacker.attack - target.defense // <span class="number">2</span></span><br><span class="line">        damage = <span class="built_in">max</span>(<span class="number">1</span>, damage)  <span class="comment"># è‡³å°‘é€ æˆ1ç‚¹ä¼¤å®³</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æš´å‡»åˆ¤æ–­</span></span><br><span class="line">        crit_chance = attacker.crit_rate</span><br><span class="line">        is_critical = random.random() &lt; crit_chance</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> is_critical:</span><br><span class="line">            damage = <span class="built_in">int</span>(damage * <span class="number">1.5</span>)</span><br><span class="line">            message = <span class="string">f&quot;æš´å‡»ï¼<span class="subst">&#123;attacker.name&#125;</span> å¯¹ <span class="subst">&#123;target.name&#125;</span> é€ æˆäº† <span class="subst">&#123;damage&#125;</span> ç‚¹ä¼¤å®³ï¼&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            message = <span class="string">f&quot;<span class="subst">&#123;attacker.name&#125;</span> å¯¹ <span class="subst">&#123;target.name&#125;</span> é€ æˆäº† <span class="subst">&#123;damage&#125;</span> ç‚¹ä¼¤å®³ï¼&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># åº”ç”¨ä¼¤å®³</span></span><br><span class="line">        target.hp -= damage</span><br><span class="line">        </span><br><span class="line">        self.battle_log.append(message)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;success&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">&quot;damage&quot;</span>: damage,</span><br><span class="line">            <span class="string">&quot;is_critical&quot;</span>: is_critical,</span><br><span class="line">            <span class="string">&quot;message&quot;</span>: message</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>



<h3 id="7-ç½‘ç»œåŠŸèƒ½ï¼ˆå¤šäººæ¸¸æˆï¼‰"><a href="#7-ç½‘ç»œåŠŸèƒ½ï¼ˆå¤šäººæ¸¸æˆï¼‰" class="headerlink" title="7. ç½‘ç»œåŠŸèƒ½ï¼ˆå¤šäººæ¸¸æˆï¼‰"></a>7. ç½‘ç»œåŠŸèƒ½ï¼ˆå¤šäººæ¸¸æˆï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># network/game_server.py - æ¸¸æˆæœåŠ¡å™¨ï¼ˆå­¦ä¹ ï¼šSocketç¼–ç¨‹ã€å¤šçº¿ç¨‹æœåŠ¡å™¨ï¼‰</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span>, <span class="type">List</span></span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Client</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å®¢æˆ·ç«¯è¿æ¥&quot;&quot;&quot;</span></span><br><span class="line">    conn: socket.socket</span><br><span class="line">    addr: <span class="built_in">str</span></span><br><span class="line">    player_id: <span class="built_in">str</span></span><br><span class="line">    last_heartbeat: <span class="built_in">float</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameServer</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å¤šäººæ¸¸æˆæœåŠ¡å™¨&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, host=<span class="string">&#x27;127.0.0.1&#x27;</span>, port=<span class="number">8888</span></span>):</span><br><span class="line">        self.host = host</span><br><span class="line">        self.port = port</span><br><span class="line">        self.server_socket = <span class="literal">None</span></span><br><span class="line">        self.running = <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å®¢æˆ·ç«¯ç®¡ç†</span></span><br><span class="line">        self.clients: <span class="type">Dict</span>[<span class="built_in">str</span>, Client] = &#123;&#125;</span><br><span class="line">        self.client_lock = threading.Lock()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># æ¸¸æˆçŠ¶æ€</span></span><br><span class="line">        self.game_state = &#123;&#125;</span><br><span class="line">        self.game_lock = threading.Lock()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># çº¿ç¨‹æ± </span></span><br><span class="line">        self.threads: <span class="type">List</span>[threading.Thread] = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¯åŠ¨æœåŠ¡å™¨&quot;&quot;&quot;</span></span><br><span class="line">        self.server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        self.server_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.server_socket.bind((self.host, self.port))</span><br><span class="line">            self.server_socket.listen(<span class="number">5</span>)</span><br><span class="line">            self.running = <span class="literal">True</span></span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;æœåŠ¡å™¨å¯åŠ¨åœ¨ <span class="subst">&#123;self.host&#125;</span>:<span class="subst">&#123;self.port&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># å¯åŠ¨å¿ƒè·³çº¿ç¨‹</span></span><br><span class="line">            heartbeat_thread = threading.Thread(target=self._heartbeat_checker, daemon=<span class="literal">True</span>)</span><br><span class="line">            heartbeat_thread.start()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># æ¥å—è¿æ¥</span></span><br><span class="line">            <span class="keyword">while</span> self.running:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    conn, addr = self.server_socket.accept()</span><br><span class="line">                    client_thread = threading.Thread(</span><br><span class="line">                        target=self._handle_client,</span><br><span class="line">                        args=(conn, addr)</span><br><span class="line">                    )</span><br><span class="line">                    client_thread.start()</span><br><span class="line">                    self.threads.append(client_thread)</span><br><span class="line">                    </span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    <span class="keyword">if</span> self.running:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;æ¥å—è¿æ¥é”™è¯¯: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                    </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;æœåŠ¡å™¨å¯åŠ¨å¤±è´¥: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            self.stop()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_handle_client</span>(<span class="params">self, conn: socket.socket, addr: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†å®¢æˆ·ç«¯è¿æ¥&quot;&quot;&quot;</span></span><br><span class="line">        client_id = <span class="literal">None</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># æ¥æ”¶å®¢æˆ·ç«¯è®¤è¯</span></span><br><span class="line">            data = conn.recv(<span class="number">1024</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> data:</span><br><span class="line">                message = json.loads(data)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> message.get(<span class="string">&#x27;type&#x27;</span>) == <span class="string">&#x27;auth&#x27;</span>:</span><br><span class="line">                    client_id = message.get(<span class="string">&#x27;player_id&#x27;</span>, <span class="built_in">str</span>(addr))</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">with</span> self.client_lock:</span><br><span class="line">                        self.clients[client_id] = Client(</span><br><span class="line">                            conn=conn,</span><br><span class="line">                            addr=addr,</span><br><span class="line">                            player_id=client_id,</span><br><span class="line">                            last_heartbeat=time.time()</span><br><span class="line">                        )</span><br><span class="line">                    </span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span> å·²è¿æ¥&quot;</span>)</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># å‘é€æ¬¢è¿æ¶ˆæ¯</span></span><br><span class="line">                    welcome_msg = &#123;</span><br><span class="line">                        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;welcome&#x27;</span>,</span><br><span class="line">                        <span class="string">&#x27;player_id&#x27;</span>: client_id,</span><br><span class="line">                        <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;è¿æ¥æˆåŠŸ&#x27;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    conn.send(json.dumps(welcome_msg).encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># å¤„ç†å®¢æˆ·ç«¯æ¶ˆæ¯</span></span><br><span class="line">                    <span class="keyword">while</span> self.running:</span><br><span class="line">                        <span class="keyword">try</span>:</span><br><span class="line">                            data = conn.recv(<span class="number">1024</span>)</span><br><span class="line">                            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                                <span class="keyword">break</span></span><br><span class="line">                            </span><br><span class="line">                            message = json.loads(data.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">                            self._process_message(client_id, message)</span><br><span class="line">                            </span><br><span class="line">                        <span class="keyword">except</span> json.JSONDecodeError:</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">f&quot;æ— æ•ˆçš„JSONæ•°æ®æ¥è‡ª <span class="subst">&#123;client_id&#125;</span>&quot;</span>)</span><br><span class="line">                            <span class="keyword">continue</span></span><br><span class="line">                        <span class="keyword">except</span> ConnectionError:</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                        </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;å¤„ç†å®¢æˆ·ç«¯ <span class="subst">&#123;addr&#125;</span> æ—¶å‡ºé”™: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="keyword">if</span> client_id:</span><br><span class="line">                <span class="keyword">with</span> self.client_lock:</span><br><span class="line">                    <span class="keyword">if</span> client_id <span class="keyword">in</span> self.clients:</span><br><span class="line">                        <span class="keyword">del</span> self.clients[client_id]</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span> å·²æ–­å¼€è¿æ¥&quot;</span>)</span><br><span class="line">            conn.close()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_process_message</span>(<span class="params">self, client_id: <span class="built_in">str</span>, message: <span class="type">Dict</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¤„ç†å®¢æˆ·ç«¯æ¶ˆæ¯&quot;&quot;&quot;</span></span><br><span class="line">        msg_type = message.get(<span class="string">&#x27;type&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> msg_type == <span class="string">&#x27;heartbeat&#x27;</span>:</span><br><span class="line">            <span class="keyword">with</span> self.client_lock:</span><br><span class="line">                <span class="keyword">if</span> client_id <span class="keyword">in</span> self.clients:</span><br><span class="line">                    self.clients[client_id].last_heartbeat = time.time()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">elif</span> msg_type == <span class="string">&#x27;game_action&#x27;</span>:</span><br><span class="line">            <span class="comment"># å¤„ç†æ¸¸æˆåŠ¨ä½œ</span></span><br><span class="line">            action = message.get(<span class="string">&#x27;action&#x27;</span>)</span><br><span class="line">            data = message.get(<span class="string">&#x27;data&#x27;</span>, &#123;&#125;)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># æ›´æ–°æ¸¸æˆçŠ¶æ€</span></span><br><span class="line">            <span class="keyword">with</span> self.game_lock:</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;player_move&#x27;</span> <span class="keyword">in</span> action:</span><br><span class="line">                    <span class="comment"># å¤„ç†ç©å®¶ç§»åŠ¨</span></span><br><span class="line">                    self.game_state.setdefault(<span class="string">&#x27;players&#x27;</span>, &#123;&#125;)</span><br><span class="line">                    self.game_state[<span class="string">&#x27;players&#x27;</span>][client_id] = data</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># å¹¿æ’­ç»™å…¶ä»–ç©å®¶</span></span><br><span class="line">            self._broadcast(&#123;</span><br><span class="line">                <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;player_update&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;player_id&#x27;</span>: client_id,</span><br><span class="line">                <span class="string">&#x27;data&#x27;</span>: data</span><br><span class="line">            &#125;, exclude=client_id)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_broadcast</span>(<span class="params">self, message: <span class="type">Dict</span>, exclude: <span class="built_in">str</span> = <span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¹¿æ’­æ¶ˆæ¯ç»™æ‰€æœ‰å®¢æˆ·ç«¯&quot;&quot;&quot;</span></span><br><span class="line">        message_json = json.dumps(message)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> self.client_lock:</span><br><span class="line">            <span class="keyword">for</span> client_id, client <span class="keyword">in</span> self.clients.items():</span><br><span class="line">                <span class="keyword">if</span> client_id != exclude:</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        client.conn.send(message_json.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">                    <span class="keyword">except</span>:</span><br><span class="line">                        <span class="keyword">pass</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_heartbeat_checker</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;å¿ƒè·³æ£€æŸ¥ï¼Œæ£€æµ‹æ–­å¼€çš„è¿æ¥&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">while</span> self.running:</span><br><span class="line">            time.sleep(<span class="number">30</span>)  <span class="comment"># æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡</span></span><br><span class="line">            </span><br><span class="line">            current_time = time.time()</span><br><span class="line">            disconnected = []</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">with</span> self.client_lock:</span><br><span class="line">                <span class="keyword">for</span> client_id, client <span class="keyword">in</span> self.clients.items():</span><br><span class="line">                    <span class="keyword">if</span> current_time - client.last_heartbeat &gt; <span class="number">60</span>:  <span class="comment"># 60ç§’æ— å¿ƒè·³</span></span><br><span class="line">                        disconnected.append(client_id)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> client_id <span class="keyword">in</span> disconnected:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;å®¢æˆ·ç«¯ <span class="subst">&#123;client_id&#125;</span> å¿ƒè·³è¶…æ—¶ï¼Œæ–­å¼€è¿æ¥&quot;</span>)</span><br><span class="line">                <span class="keyword">with</span> self.client_lock:</span><br><span class="line">                    <span class="keyword">if</span> client_id <span class="keyword">in</span> self.clients:</span><br><span class="line">                        <span class="keyword">try</span>:</span><br><span class="line">                            self.clients[client_id].conn.close()</span><br><span class="line">                        <span class="keyword">except</span>:</span><br><span class="line">                            <span class="keyword">pass</span></span><br><span class="line">                        <span class="keyword">del</span> self.clients[client_id]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">stop</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;åœæ­¢æœåŠ¡å™¨&quot;&quot;&quot;</span></span><br><span class="line">        self.running = <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å…³é—­æ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">        <span class="keyword">with</span> self.client_lock:</span><br><span class="line">            <span class="keyword">for</span> client <span class="keyword">in</span> self.clients.values():</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    client.conn.close()</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">            self.clients.clear()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># å…³é—­æœåŠ¡å™¨socket</span></span><br><span class="line">        <span class="keyword">if</span> self.server_socket:</span><br><span class="line">            self.server_socket.close()</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æœåŠ¡å™¨å·²åœæ­¢&quot;</span>)</span><br></pre></td></tr></table></figure>



<h3 id="8-ä¸»ç¨‹åºå…¥å£"><a href="#8-ä¸»ç¨‹åºå…¥å£" class="headerlink" title="8. ä¸»ç¨‹åºå…¥å£"></a>8. ä¸»ç¨‹åºå…¥å£</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py - ä¸»ç¨‹åºå…¥å£</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> PyQt5.QtWidgets <span class="keyword">import</span> QApplication</span><br><span class="line"><span class="keyword">from</span> gui.main_window <span class="keyword">import</span> MainWindow</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;ä¸»å‡½æ•°&quot;&quot;&quot;</span></span><br><span class="line">    app = QApplication(sys.argv)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è®¾ç½®åº”ç”¨ç¨‹åºæ ·å¼</span></span><br><span class="line">    app.setStyle(<span class="string">&#x27;Fusion&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸»çª—å£</span></span><br><span class="line">    window = MainWindow()</span><br><span class="line">    window.show()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è¿è¡Œåº”ç”¨ç¨‹åº</span></span><br><span class="line">    sys.exit(app.exec_())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>



<h2 id="ğŸ“‹-è¿è¡Œå’Œå®‰è£…è¯´æ˜"><a href="#ğŸ“‹-è¿è¡Œå’Œå®‰è£…è¯´æ˜" class="headerlink" title="ğŸ“‹ è¿è¡Œå’Œå®‰è£…è¯´æ˜"></a>ğŸ“‹ è¿è¡Œå’Œå®‰è£…è¯´æ˜</h2><h3 id="1-å®‰è£…ä¾èµ–"><a href="#1-å®‰è£…ä¾èµ–" class="headerlink" title="1. å®‰è£…ä¾èµ–"></a>1. å®‰è£…ä¾èµ–</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">python -m venv venv</span><br><span class="line"><span class="built_in">source</span> venv/bin/activate  <span class="comment"># Linux/Mac</span></span><br><span class="line"><span class="comment"># venv\Scripts\activate  # Windows</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…ä¾èµ–</span></span><br><span class="line">pip install pygame PyQt5 sqlalchemy numpy pillow</span><br></pre></td></tr></table></figure>



<h3 id="2-é¡¹ç›®ç»“æ„"><a href="#2-é¡¹ç›®ç»“æ„" class="headerlink" title="2. é¡¹ç›®ç»“æ„"></a>2. é¡¹ç›®ç»“æ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PyRPG-Maker/</span><br><span class="line">â”œâ”€â”€ requirements.txt</span><br><span class="line">â”œâ”€â”€ main.py</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â””â”€â”€ docs/</span><br><span class="line">    â””â”€â”€ tutorial.md</span><br></pre></td></tr></table></figure>



<h3 id="3-è¿è¡Œé¡¹ç›®"><a href="#3-è¿è¡Œé¡¹ç›®" class="headerlink" title="3. è¿è¡Œé¡¹ç›®"></a>3. è¿è¡Œé¡¹ç›®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python main.py</span><br></pre></td></tr></table></figure>



<h2 id="ğŸ¯-æ¶µç›–çš„æŠ€æœ¯æ ˆ"><a href="#ğŸ¯-æ¶µç›–çš„æŠ€æœ¯æ ˆ" class="headerlink" title="ğŸ¯ æ¶µç›–çš„æŠ€æœ¯æ ˆ"></a>ğŸ¯ æ¶µç›–çš„æŠ€æœ¯æ ˆ</h2><p>è¿™ä¸ªé¡¹ç›®æ¶µç›–äº†Pythonçš„<strong>å®Œæ•´æŠ€æœ¯æ ˆ</strong>ï¼š</p>
<h3 id="âœ…-åŸºç¡€æ ¸å¿ƒ"><a href="#âœ…-åŸºç¡€æ ¸å¿ƒ" class="headerlink" title="âœ… åŸºç¡€æ ¸å¿ƒ"></a>âœ… åŸºç¡€æ ¸å¿ƒ</h3><ul>
<li><strong>é¢å‘å¯¹è±¡ç¼–ç¨‹</strong>ï¼šç±»ã€ç»§æ‰¿ã€å¤šæ€ã€å°è£…</li>
<li><strong>è®¾è®¡æ¨¡å¼</strong>ï¼šå•ä¾‹ã€å·¥å‚ã€è§‚å¯Ÿè€…ã€çŠ¶æ€ã€è£…é¥°å™¨</li>
<li><strong>æ•°æ®ç»“æ„</strong>ï¼šåˆ—è¡¨ã€å­—å…¸ã€é›†åˆã€é˜Ÿåˆ—ã€æ ˆ</li>
<li><strong>ç®—æ³•</strong>ï¼šæ´ªæ°´å¡«å……ã€æ’åºã€è·¯å¾„æŸ¥æ‰¾</li>
</ul>
<h3 id="âœ…-é«˜çº§ç‰¹æ€§"><a href="#âœ…-é«˜çº§ç‰¹æ€§" class="headerlink" title="âœ… é«˜çº§ç‰¹æ€§"></a>âœ… é«˜çº§ç‰¹æ€§</h3><ul>
<li><strong>å¹¶å‘ç¼–ç¨‹</strong>ï¼šå¤šçº¿ç¨‹ã€çº¿ç¨‹æ± ã€é˜Ÿåˆ—</li>
<li><strong>å¼‚æ­¥ç¼–ç¨‹</strong>ï¼šä»»åŠ¡é˜Ÿåˆ—ã€äº‹ä»¶å¾ªç¯</li>
<li><strong>å…ƒç¼–ç¨‹</strong>ï¼šè£…é¥°å™¨ã€åŠ¨æ€å±æ€§</li>
</ul>
<h3 id="âœ…-GUIå¼€å‘"><a href="#âœ…-GUIå¼€å‘" class="headerlink" title="âœ… GUIå¼€å‘"></a>âœ… GUIå¼€å‘</h3><ul>
<li><strong>PyQt5</strong>ï¼šçª—å£ã€å¸ƒå±€ã€ä¿¡å·æ§½ã€è‡ªå®šä¹‰ç»„ä»¶</li>
<li><strong>å›¾å½¢ç»˜åˆ¶</strong>ï¼šCanvasã€QPainterã€QGraphics</li>
<li><strong>äº‹ä»¶å¤„ç†</strong>ï¼šé”®ç›˜ã€é¼ æ ‡ã€è‡ªå®šä¹‰äº‹ä»¶</li>
</ul>
<h3 id="âœ…-æ•°æ®å¤„ç†"><a href="#âœ…-æ•°æ®å¤„ç†" class="headerlink" title="âœ… æ•°æ®å¤„ç†"></a>âœ… æ•°æ®å¤„ç†</h3><ul>
<li><strong>SQLAlchemy</strong>ï¼šORMã€æ•°æ®åº“è®¾è®¡ã€äº‹åŠ¡</li>
<li><strong>åºåˆ—åŒ–</strong>ï¼šJSONã€Pickle</li>
<li><strong>æ–‡ä»¶æ“ä½œ</strong>ï¼šPathã€æ–‡ä»¶è¯»å†™</li>
</ul>
<h3 id="âœ…-æ¸¸æˆå¼€å‘"><a href="#âœ…-æ¸¸æˆå¼€å‘" class="headerlink" title="âœ… æ¸¸æˆå¼€å‘"></a>âœ… æ¸¸æˆå¼€å‘</h3><ul>
<li><strong>Pygame</strong>ï¼šæ¸¸æˆå¾ªç¯ã€ç²¾çµã€ç¢°æ’æ£€æµ‹</li>
<li><strong>æ¸¸æˆå¼•æ“</strong>ï¼šçŠ¶æ€æœºã€äº‹ä»¶ç³»ç»Ÿã€èµ„æºç®¡ç†</li>
<li><strong>æ¸¸æˆç®—æ³•</strong>ï¼šAIã€å¯»è·¯ã€æˆ˜æ–—ç³»ç»Ÿ</li>
</ul>
<h3 id="âœ…-ç½‘ç»œç¼–ç¨‹"><a href="#âœ…-ç½‘ç»œç¼–ç¨‹" class="headerlink" title="âœ… ç½‘ç»œç¼–ç¨‹"></a>âœ… ç½‘ç»œç¼–ç¨‹</h3><ul>
<li><strong>Socketç¼–ç¨‹</strong>ï¼šTCPæœåŠ¡å™¨ã€å®¢æˆ·ç«¯</li>
<li><strong>å¤šçº¿ç¨‹æœåŠ¡å™¨</strong>ï¼šè¿æ¥ç®¡ç†ã€å¿ƒè·³æ£€æµ‹</li>
<li><strong>åè®®è®¾è®¡</strong>ï¼šJSONæ¶ˆæ¯æ ¼å¼</li>
</ul>
<h3 id="âœ…-å·¥ç¨‹åŒ–"><a href="#âœ…-å·¥ç¨‹åŒ–" class="headerlink" title="âœ… å·¥ç¨‹åŒ–"></a>âœ… å·¥ç¨‹åŒ–</h3><ul>
<li><strong>æ¨¡å—åŒ–è®¾è®¡</strong>ï¼šåŒ…ç®¡ç†ã€å¯¼å…¥ç³»ç»Ÿ</li>
<li><strong>é…ç½®ç®¡ç†</strong>ï¼šé…ç½®æ–‡ä»¶ã€ç¯å¢ƒå˜é‡</li>
<li><strong>æ—¥å¿—ç³»ç»Ÿ</strong>ï¼šå¤šçº§æ—¥å¿—ã€æ—¥å¿—æ–‡ä»¶</li>
<li><strong>æµ‹è¯•</strong>ï¼šå•å…ƒæµ‹è¯•ï¼ˆæœªå±•ç¤ºä½†å¯æ·»åŠ ï¼‰</li>
<li><strong>æ–‡æ¡£</strong>ï¼šä»£ç æ³¨é‡Šã€README</li>
</ul>
<h2 id="ğŸš€-å¦‚ä½•æ‰©å±•é¡¹ç›®"><a href="#ğŸš€-å¦‚ä½•æ‰©å±•é¡¹ç›®" class="headerlink" title="ğŸš€ å¦‚ä½•æ‰©å±•é¡¹ç›®"></a>ğŸš€ å¦‚ä½•æ‰©å±•é¡¹ç›®</h2><h3 id="1-æ·»åŠ æ–°åŠŸèƒ½"><a href="#1-æ·»åŠ æ–°åŠŸèƒ½" class="headerlink" title="1. æ·»åŠ æ–°åŠŸèƒ½"></a>1. æ·»åŠ æ–°åŠŸèƒ½</h3><ul>
<li>æ·»åŠ <strong>ç²’å­ç³»ç»Ÿ</strong>ç”¨äºç‰¹æ•ˆ</li>
<li>å®ç°<strong>å¯»è·¯ç®—æ³•</strong>ï¼ˆA*ç®—æ³•ï¼‰</li>
<li>æ·»åŠ <strong>å£°éŸ³ç®¡ç†ç³»ç»Ÿ</strong></li>
<li>å®ç°<strong>ç½‘ç»œå¯¹æˆ˜</strong>åŠŸèƒ½</li>
</ul>
<h3 id="2-æ€§èƒ½ä¼˜åŒ–"><a href="#2-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="2. æ€§èƒ½ä¼˜åŒ–"></a>2. æ€§èƒ½ä¼˜åŒ–</h3><ul>
<li>ä½¿ç”¨<strong>Cython</strong>ä¼˜åŒ–æ€§èƒ½å…³é”®éƒ¨åˆ†</li>
<li>æ·»åŠ <strong>ç¼“å­˜æœºåˆ¶</strong>å‡å°‘èµ„æºåŠ è½½</li>
<li>å®ç°<strong>LODç³»ç»Ÿ</strong>ä¼˜åŒ–æ¸²æŸ“</li>
</ul>
<h3 id="3-éƒ¨ç½²å‘å¸ƒ"><a href="#3-éƒ¨ç½²å‘å¸ƒ" class="headerlink" title="3. éƒ¨ç½²å‘å¸ƒ"></a>3. éƒ¨ç½²å‘å¸ƒ</h3><ul>
<li>ä½¿ç”¨<strong>PyInstaller</strong>æ‰“åŒ…ä¸ºå¯æ‰§è¡Œæ–‡ä»¶</li>
<li>æ·»åŠ <strong>è‡ªåŠ¨æ›´æ–°</strong>åŠŸèƒ½</li>
<li>åˆ›å»º<strong>å®‰è£…ç¨‹åº</strong></li>
</ul>
<p>è¿™ä¸ªé¡¹ç›®æ˜¯ä¸€ä¸ª<strong>å®Œæ•´çš„æ¸¸æˆå¼€å‘å·¥å…·</strong>ï¼Œä¸ä»…å¯ä»¥å­¦ä¹ Pythonçš„å„ç§æŠ€æœ¯ï¼Œè¿˜èƒ½å®é™…åˆ¶ä½œå¯ç©çš„RPGæ¸¸æˆã€‚å»ºè®®<strong>åˆ†æ¨¡å—å­¦ä¹ </strong>ï¼Œå…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½ï¼Œå†é€æ­¥æ·»åŠ é«˜çº§ç‰¹æ€§ã€‚</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/43289129.html" rel="prev" title="Shellè„šæœ¬å®æˆ˜">
                  <i class="fa fa-angle-left"></i> Shellè„šæœ¬å®æˆ˜
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/ae6dd9bc.html" rel="next" title="Pythonå®è·µ:å®è—çŒäºº">
                  Pythonå®è·µ:å®è—çŒäºº <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa-regular fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder"></span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Word count total">420k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">25:28</span>
  </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.0/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>

  <script class="next-config" data-name="wavedrom" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.5.0/wavedrom.min.js","integrity":"sha256-INLAoJc6quTNfiMWkGZniYO2cxE8mHpddnLow1m6RFs="}}</script>
  <script class="next-config" data-name="wavedrom_skin" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.5.0/skins/default.js","integrity":"sha256-fduc/Zszk5ezWws2uInY/ALWVmIrmV6VTgXbsYSReFI="}}</script>
  <script src="/js/third-party/tags/wavedrom.js"></script>




  





</body>
</html>
