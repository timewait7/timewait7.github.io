<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"timewait7.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Spring IoC&#x2F;DI: æ·±å…¥ç†è§£å…¶å®ç°åŸç†ï¼ˆåå°„ã€å·¥å‚æ¨¡å¼ï¼‰ã€Bean ç”Ÿå‘½å‘¨æœŸã€ä½œç”¨åŸŸã€å¾ªç¯ä¾èµ–è§£å†³æœºåˆ¶ï¼ˆä¸‰çº§ç¼“å­˜ï¼‰ã€AOP åº•å±‚ï¼ˆåŠ¨æ€ä»£ç† - JDK vs CGLIBï¼‰ã€äº‹åŠ¡ç®¡ç†åŸç†ï¼ˆä¼ æ’­è¡Œä¸ºã€éš”ç¦»çº§åˆ«ã€å®ç°æœºåˆ¶ï¼‰ã€‚ Spring MVC: æ·±å…¥ç†è§£è¯·æ±‚å¤„ç†æµç¨‹ï¼ˆDispatcherServlet, HandlerMapping, HandlerAdapter, ViewRe">
<meta property="og:type" content="article">
<meta property="og:title" content="å­¦ä¹ &amp;é¢è¯•-å¼€å‘æ¡†æ¶">
<meta property="og:url" content="http://timewait7.github.io/post/18f2748c.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Spring IoC&#x2F;DI: æ·±å…¥ç†è§£å…¶å®ç°åŸç†ï¼ˆåå°„ã€å·¥å‚æ¨¡å¼ï¼‰ã€Bean ç”Ÿå‘½å‘¨æœŸã€ä½œç”¨åŸŸã€å¾ªç¯ä¾èµ–è§£å†³æœºåˆ¶ï¼ˆä¸‰çº§ç¼“å­˜ï¼‰ã€AOP åº•å±‚ï¼ˆåŠ¨æ€ä»£ç† - JDK vs CGLIBï¼‰ã€äº‹åŠ¡ç®¡ç†åŸç†ï¼ˆä¼ æ’­è¡Œä¸ºã€éš”ç¦»çº§åˆ«ã€å®ç°æœºåˆ¶ï¼‰ã€‚ Spring MVC: æ·±å…¥ç†è§£è¯·æ±‚å¤„ç†æµç¨‹ï¼ˆDispatcherServlet, HandlerMapping, HandlerAdapter, ViewRe">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-942a927a-86e4-4a01-8f52-9addd89642ff.png">
<meta property="og:image" content="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-df77ee15-2ff0-4ec7-8e65-e4ebb8ba88f1.png">
<meta property="og:image" content="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-e29a122b-db07-48b8-8289-7251032e87a1.png">
<meta property="og:image" content="http://timewait7.github.io/post/18f2748c/image-20241207213730855.png">
<meta property="og:image" content="http://timewait7.github.io/post/18f2748c/image-20241207221646340.png">
<meta property="og:image" content="http://timewait7.github.io/post/18f2748c/image-20241207221743415.png">
<meta property="article:published_time" content="2025-07-26T12:20:46.000Z">
<meta property="article:modified_time" content="2025-08-26T00:15:30.466Z">
<meta property="article:tag" content="MyBatis">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="SpringBoot">
<meta property="article:tag" content="JPA">
<meta property="article:tag" content="æ—¥å¿—æ¡†æ¶">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-942a927a-86e4-4a01-8f52-9addd89642ff.png">


<link rel="canonical" href="http://timewait7.github.io/post/18f2748c.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://timewait7.github.io/post/18f2748c.html","path":"post/18f2748c.html","title":"å­¦ä¹ &é¢è¯•-å¼€å‘æ¡†æ¶"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>å­¦ä¹ &é¢è¯•-å¼€å‘æ¡†æ¶ | Hexo</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Hexo</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-archives"><a href="/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="Searching..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring"><span class="nav-number">1.</span> <span class="nav-text">Spring</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96%E8%A7%A3%E5%86%B3%E5%8E%9F%E7%90%86"><span class="nav-number">1.0.1.</span> <span class="nav-text">å¾ªç¯ä¾èµ–è§£å†³åŸç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FactoryBean-%E7%9A%84%E4%BD%9C%E7%94%A8%E4%B8%8E%E5%BA%94%E7%94%A8"><span class="nav-number">1.0.2.</span> <span class="nav-text">FactoryBean çš„ä½œç”¨ä¸åº”ç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BeanFactoryPostProcessor-%E5%92%8C-BeanPostProcessor-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">1.0.3.</span> <span class="nav-text">BeanFactoryPostProcessor å’Œ BeanPostProcessor çš„åŒºåˆ«</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bean%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%89%A9%E5%B1%95%E7%82%B9%E5%AE%9E%E6%88%98"><span class="nav-number">1.0.4.</span> <span class="nav-text">Beanç”Ÿå‘½å‘¨æœŸæ‰©å±•ç‚¹å®æˆ˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SpringBoot%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="nav-number">1.0.5.</span> <span class="nav-text">SpringBootè‡ªåŠ¨é…ç½®åŸç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Starter%E5%BC%80%E5%8F%91%E8%A6%81%E7%82%B9"><span class="nav-number">1.0.6.</span> <span class="nav-text">è‡ªå®šä¹‰Starterå¼€å‘è¦ç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">1.0.7.</span> <span class="nav-text">ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%88%E5%91%BD%E4%BB%A4%E8%A1%8C-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%EF%BC%89"><span class="nav-number">1.0.8.</span> <span class="nav-text">é…ç½®åŠ è½½ä¼˜å…ˆçº§ï¼ˆå‘½ä»¤è¡Œ&gt;ç¯å¢ƒå˜é‡ï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-AOP-%E5%92%8C-AspectJ-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB"><span class="nav-number">1.0.9.</span> <span class="nav-text">Spring AOP å’Œ AspectJ æœ‰ä»€ä¹ˆåŒºåˆ«</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E3%80%81%E6%8B%A6%E6%88%AA%E5%99%A8%E3%80%81AOP%E7%9A%84%E5%8C%BA%E5%88%AB%E4%B8%8E%E5%AE%9E%E8%B7%B5"><span class="nav-number">1.0.10.</span> <span class="nav-text">è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨ã€AOPçš„åŒºåˆ«ä¸å®è·µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-number">1.0.11.</span> <span class="nav-text">æ³¨è§£çš„å®ç°åŸç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MapperScan-%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-number">1.0.12.</span> <span class="nav-text">@MapperScan çš„å®ç°åŸç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Autowired-%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-number">1.0.13.</span> <span class="nav-text">@Autowired çš„å®ç°åŸç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SpringMVC-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="nav-number">1.0.14.</span> <span class="nav-text">SpringMVC å·¥ä½œæµç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AOP-%E5%93%AA%E4%BA%9B%E6%83%85%E5%86%B5%E4%B8%8B%E4%BC%9A%E5%A4%B1%E6%95%88"><span class="nav-number">1.0.15.</span> <span class="nav-text">AOP å“ªäº›æƒ…å†µä¸‹ä¼šå¤±æ•ˆ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SpringBoot%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86"><span class="nav-number">1.0.16.</span> <span class="nav-text">SpringBootè‡ªåŠ¨è£…é…åŸç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AAstarter"><span class="nav-number">1.0.17.</span> <span class="nav-text">è‡ªå®šä¹‰ä¸€ä¸ªstarter</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#spring-bean%E6%98%AF%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E5%90%97"><span class="nav-number">1.1.</span> <span class="nav-text">spring beanæ˜¯çº¿ç¨‹å®‰å…¨çš„å—</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Dubbo"><span class="nav-number">2.</span> <span class="nav-text">Dubbo</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFSPI%E6%9C%BA%E5%88%B6"><span class="nav-number">2.1.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯SPIæœºåˆ¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java%E7%9A%84SPI%E6%9C%BA%E5%88%B6%E6%9C%89%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98"><span class="nav-number">2.2.</span> <span class="nav-text">Javaçš„SPIæœºåˆ¶æœ‰ä»€ä¹ˆé—®é¢˜</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dubbo-SPI"><span class="nav-number">2.3.</span> <span class="nav-text">Dubbo SPI</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/">
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://timewait7.github.io/post/18f2748c.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="å­¦ä¹ &é¢è¯•-å¼€å‘æ¡†æ¶ | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          å­¦ä¹ &é¢è¯•-å¼€å‘æ¡†æ¶
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-07-26 19:20:46" itemprop="dateCreated datePublished" datetime="2025-07-26T19:20:46+07:00">2025-07-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%9D%A2%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">é¢è¯•</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="Word count in article">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">Word count in article: </span>
      <span>14k</span>
    </span>
    <span class="post-meta-item" title="Reading time">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">Reading time &asymp;</span>
      <span>51 mins.</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><ul>
<li><strong>IoC&#x2F;DI:</strong> æ·±å…¥ç†è§£å…¶å®ç°åŸç†ï¼ˆåå°„ã€å·¥å‚æ¨¡å¼ï¼‰ã€Bean ç”Ÿå‘½å‘¨æœŸã€ä½œç”¨åŸŸã€å¾ªç¯ä¾èµ–è§£å†³æœºåˆ¶ï¼ˆä¸‰çº§ç¼“å­˜ï¼‰ã€AOP åº•å±‚ï¼ˆåŠ¨æ€ä»£ç† - JDK vs CGLIBï¼‰ã€äº‹åŠ¡ç®¡ç†åŸç†ï¼ˆä¼ æ’­è¡Œä¸ºã€éš”ç¦»çº§åˆ«ã€å®ç°æœºåˆ¶ï¼‰ã€‚</li>
<li><strong>Spring MVC:</strong> æ·±å…¥ç†è§£è¯·æ±‚å¤„ç†æµç¨‹ï¼ˆDispatcherServlet, HandlerMapping, HandlerAdapter, ViewResolverï¼‰ã€å¸¸ç”¨æ³¨è§£åŸç†ã€RESTful è®¾è®¡æœ€ä½³å®è·µã€‚</li>
<li><strong>Spring Boot:</strong> è‡ªåŠ¨é…ç½®åŸç†ï¼ˆ<code>spring.factories</code>, <code>@Conditional</code>ï¼‰ã€å¯åŠ¨è¿‡ç¨‹ã€å¤–éƒ¨åŒ–é…ç½®ã€Actuator æ·±åº¦ä½¿ç”¨ä¸å®šåˆ¶ã€‚</li>
<li><strong>Spring Data:</strong> JPA&#x2F;Hibernate åŸç†ï¼ˆä¸€çº§&#x2F;äºŒçº§ç¼“å­˜ã€è„æ£€æŸ¥ã€å»¶è¿ŸåŠ è½½ã€N+1é—®é¢˜ï¼‰ã€Spring Data JPA æŠ½è±¡ä¸å®ç°ã€‚MyBatis æ ¸å¿ƒåŸç†ï¼ˆSqlSession, Mapper ä»£ç†ã€æ’ä»¶æœºåˆ¶ï¼‰ã€‚</li>
<li><strong>Spring Security&#x2F;OAuth2:</strong> è®¤è¯æˆæƒæµç¨‹ã€è¿‡æ»¤å™¨é“¾ã€RBAC&#x2F;ABACã€OAuth2 æˆæƒæ¨¡å¼ã€JWT æ·±åº¦åº”ç”¨ä¸å®‰å…¨è€ƒé‡ã€‚</li>
<li><strong>æºç é˜…è¯»:</strong> è¿™æ˜¯è¿›é˜¶çš„å…³é”®ï¼é€‰æ‹©å¸¸ç”¨æ¨¡å—ï¼ˆå¦‚ <code>BeanFactory</code>, <code>AOP</code>, <code>Transaction</code>ï¼‰é˜…è¯»æºç ï¼Œç†è§£è®¾è®¡æ¨¡å¼çš„åº”ç”¨å’Œæ ¸å¿ƒå®ç°é€»è¾‘ã€‚ğŸ“š</li>
</ul>
<h3 id="å¾ªç¯ä¾èµ–è§£å†³åŸç†"><a href="#å¾ªç¯ä¾èµ–è§£å†³åŸç†" class="headerlink" title="å¾ªç¯ä¾èµ–è§£å†³åŸç†"></a>å¾ªç¯ä¾èµ–è§£å†³åŸç†</h3><p>Spring é€šè¿‡<strong>ä¸‰çº§ç¼“å­˜ï¼ˆä¸‰çº§ Map ç»“æ„ï¼‰</strong>è§£å†³å•ä¾‹ Bean çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå…¶æ ¸å¿ƒåŸç†æ˜¯<strong>æå‰æš´éœ²æœªå®Œæˆåˆå§‹åŒ–çš„ Bean å¼•ç”¨</strong>ï¼Œä»è€Œæ‰“ç ´å¾ªç¯ä¾èµ–çš„åƒµå±€ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åŸç†å’Œæµç¨‹ï¼š</p>
<p><strong>ä¸‰çº§ç¼“å­˜çš„å®šä¹‰ä¸ä½œç”¨</strong></p>
<ol>
<li><strong>ä¸€çº§ç¼“å­˜ï¼ˆsingletonObjectsï¼‰</strong><br>å­˜æ”¾<strong>å®Œå…¨åˆå§‹åŒ–å¥½çš„ Bean</strong>ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</li>
<li><strong>äºŒçº§ç¼“å­˜ï¼ˆearlySingletonObjectsï¼‰</strong><br>å­˜æ”¾<strong>æå‰æš´éœ²çš„ Bean çš„æ—©æœŸå¼•ç”¨</strong>ï¼ˆä»…å®ä¾‹åŒ–ï¼Œå°šæœªå¡«å……å±æ€§å’Œåˆå§‹åŒ–ï¼‰ã€‚</li>
<li><strong>ä¸‰çº§ç¼“å­˜ï¼ˆsingletonFactoriesï¼‰</strong><br>å­˜æ”¾ Bean çš„ <strong>ObjectFactory</strong>ï¼Œç”¨äºç”Ÿæˆ Bean çš„æ—©æœŸå¼•ç”¨ï¼ˆå¯èƒ½ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œç”¨äºæ”¯æŒ AOPï¼‰ã€‚</li>
</ol>
<p><strong>è§£å†³å¾ªç¯ä¾èµ–çš„æµç¨‹</strong></p>
<p>ä»¥ <code>A â†’ B â†’ A</code> çš„å¾ªç¯ä¾èµ–ä¸ºä¾‹ï¼š</p>
<ol>
<li><strong>åˆ›å»º Bean A</strong></li>
</ol>
<ul>
<li><strong>å®ä¾‹åŒ– A</strong>ï¼šè°ƒç”¨æ„é€ å‡½æ•°åˆ›å»º A å¯¹è±¡ï¼ˆæ­¤æ—¶å±æ€§æœªå¡«å……ï¼Œç§°ä¸ºâ€œæ—©æœŸå¯¹è±¡â€ï¼‰ã€‚</li>
<li><strong>å°† A çš„ ObjectFactory æ”¾å…¥ä¸‰çº§ç¼“å­˜</strong>ï¼š<br><code>addSingletonFactory(A_name, () -&gt; getEarlyBeanReference(A))</code><br>ï¼ˆè¿™ä¸€æ­¥æ˜¯å…³é”®ï¼Œå…è®¸åç»­ä¾èµ–é€šè¿‡ ObjectFactory è·å– A çš„æ—©æœŸå¼•ç”¨ï¼‰</li>
</ul>
<ol start="2">
<li><strong>å¡«å…… A çš„å±æ€§</strong></li>
</ol>
<ul>
<li>å‘ç° A ä¾èµ– Bï¼Œè§¦å‘ <code>getBean(B)</code>ã€‚</li>
</ul>
<ol start="3">
<li><strong>åˆ›å»º Bean B</strong></li>
</ol>
<ul>
<li><strong>å®ä¾‹åŒ– B</strong>ï¼šæ„é€ å‡½æ•°åˆ›å»º B å¯¹è±¡ã€‚</li>
<li><strong>å°† B çš„ ObjectFactory æ”¾å…¥ä¸‰çº§ç¼“å­˜</strong>ï¼š<br><code>addSingletonFactory(B_name, () -&gt; getEarlyBeanReference(B))</code></li>
</ul>
<ol start="4">
<li><strong>å¡«å…… B çš„å±æ€§</strong></li>
</ol>
<ul>
<li>å‘ç° B ä¾èµ– Aï¼Œè§¦å‘ <code>getBean(A)</code>ã€‚</li>
<li><strong>ä»ä¸‰çº§ç¼“å­˜è·å– A çš„ ObjectFactory</strong>ï¼Œç”Ÿæˆ A çš„æ—©æœŸå¼•ç”¨ï¼ˆå¯èƒ½æ˜¯åŸå§‹å¯¹è±¡æˆ–ä»£ç†å¯¹è±¡ï¼‰ã€‚</li>
<li>å°† A çš„æ—©æœŸå¼•ç”¨æ”¾å…¥äºŒçº§ç¼“å­˜ï¼Œ<strong>åŒæ—¶åˆ é™¤ä¸‰çº§ç¼“å­˜ä¸­çš„ A</strong>ã€‚</li>
</ul>
<ol start="5">
<li><strong>å®Œæˆ B çš„åˆå§‹åŒ–</strong></li>
</ol>
<ul>
<li>B çš„æ—©æœŸå¼•ç”¨æ³¨å…¥ A åï¼Œç»§ç»­å®Œæˆå…¶ä»–åˆå§‹åŒ–å’Œåç½®å¤„ç†ã€‚</li>
<li>å°† B æ”¾å…¥ä¸€çº§ç¼“å­˜ï¼Œ<strong>åˆ é™¤äºŒçº§å’Œä¸‰çº§ç¼“å­˜ä¸­çš„ B</strong>ã€‚</li>
</ul>
<ol start="6">
<li><strong>å®Œæˆ A çš„åˆå§‹åŒ–</strong></li>
</ol>
<ul>
<li>B å·²å°±ç»ªï¼ŒA æ³¨å…¥ B åå®Œæˆå±æ€§å¡«å……å’Œåˆå§‹åŒ–ã€‚</li>
<li>å°† A æ”¾å…¥ä¸€çº§ç¼“å­˜ï¼Œ<strong>åˆ é™¤äºŒçº§ç¼“å­˜ä¸­çš„ A</strong>ã€‚</li>
</ul>
<p><strong>å…³é”®è®¾è®¡ç‚¹</strong></p>
<ol>
<li><strong>ä¸ºä»€ä¹ˆéœ€è¦ä¸‰çº§ç¼“å­˜ï¼Ÿ</strong><ul>
<li><strong>æ”¯æŒ AOP ä»£ç†</strong>ï¼š<br>å¦‚æœ Bean éœ€è¦è¢«ä»£ç†ï¼Œä¸‰çº§ç¼“å­˜çš„ ObjectFactory å¯ä»¥å»¶è¿Ÿç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œç¡®ä¿ä¾èµ–æ³¨å…¥çš„æ˜¯æœ€ç»ˆä»£ç†å¯¹è±¡ï¼Œè€ŒéåŸå§‹å¯¹è±¡ã€‚</li>
<li><strong>é¿å…é‡å¤åˆ›å»ºä»£ç†</strong>ï¼š<br>äºŒçº§ç¼“å­˜ï¼ˆ<code>earlySingletonObjects</code>ï¼‰ä¿å­˜å·²ç”Ÿæˆçš„æ—©æœŸå¯¹è±¡ï¼ˆå¯èƒ½æ˜¯ä»£ç†ï¼‰ï¼Œé¿å…å¤šæ¬¡è°ƒç”¨ ObjectFactoryã€‚</li>
</ul>
</li>
<li><strong>åªèƒ½è§£å†³å•ä¾‹ Bean çš„å¾ªç¯ä¾èµ–</strong><br>åŸå‹ï¼ˆPrototypeï¼‰Bean æ¯æ¬¡éƒ½ä¼šæ–°å»ºå®ä¾‹ï¼Œæ— æ³•é€šè¿‡ç¼“å­˜æå‰æš´éœ²å¼•ç”¨ã€‚</li>
<li><strong>æ„é€ å‡½æ•°å¾ªç¯ä¾èµ–æ— æ³•è§£å†³</strong><br>è‹¥å¾ªç¯ä¾èµ–é€šè¿‡æ„é€ å‡½æ•°å‘ç”Ÿï¼ŒBean å°šæœªå®ä¾‹åŒ–ï¼Œæ— æ³•æå‰æš´éœ²å¼•ç”¨ï¼ŒSpring ä¼šæŠ›å‡º <code>BeanCurrentlyInCreationException</code>ã€‚</li>
</ol>
<p><strong>æ€»ç»“</strong></p>
<p>Spring é€šè¿‡ä¸‰çº§ç¼“å­˜å®ç°ï¼š</p>
<ol>
<li><strong>æå‰æš´éœ²æœªåˆå§‹åŒ–çš„ Bean å¼•ç”¨</strong>ï¼ˆé€šè¿‡ ObjectFactoryï¼‰ã€‚</li>
<li><strong>å»¶è¿Ÿä»£ç†å¯¹è±¡çš„ç”Ÿæˆ</strong>ï¼Œç¡®ä¿ä¾èµ–æ³¨å…¥æ­£ç¡®çš„å¯¹è±¡ã€‚</li>
<li><strong>ç¼“å­˜å±‚çº§éš”ç¦»</strong>ï¼Œå¹³è¡¡æ€§èƒ½ä¸æ­£ç¡®æ€§ã€‚</li>
</ol>
<p>è¿™ä¸€æœºåˆ¶ä½¿å¾—å¤§å¤šæ•°å•ä¾‹ Bean çš„å¾ªç¯ä¾èµ–é—®é¢˜å¾—ä»¥è§£å†³ï¼ŒåŒæ—¶ä¿æŒäº†æ¡†æ¶çš„çµæ´»æ€§å’Œæ‰©å±•æ€§ã€‚</p>
<h3 id="FactoryBean-çš„ä½œç”¨ä¸åº”ç”¨"><a href="#FactoryBean-çš„ä½œç”¨ä¸åº”ç”¨" class="headerlink" title="FactoryBean çš„ä½œç”¨ä¸åº”ç”¨"></a><code>FactoryBean</code> çš„ä½œç”¨ä¸åº”ç”¨</h3><p><strong>1. FactoryBean çš„æ ¸å¿ƒä½œç”¨</strong><br>FactoryBean æ˜¯ Spring æ¡†æ¶ä¸­ç”¨äº <strong>å°è£…å¤æ‚å¯¹è±¡åˆ›å»ºé€»è¾‘</strong> çš„ç‰¹æ®Šæ¥å£ï¼Œå…¶æ ¸å¿ƒä½œç”¨å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>éšè—å¤æ‚æ„é€ è¿‡ç¨‹</strong>ï¼šå°†åˆå§‹åŒ–ç¹ççš„å¯¹è±¡ï¼ˆå¦‚ç¬¬ä¸‰æ–¹åº“ç»„ä»¶ï¼‰çš„åˆ›å»ºç»†èŠ‚å°è£…åœ¨ FactoryBean ä¸­ã€‚</li>
<li><strong>åŠ¨æ€å†³å®šå¯¹è±¡ç±»å‹</strong>ï¼šæ ¹æ®æ¡ä»¶è¿”å›ä¸åŒç±»å‹çš„ Bean å®ä¾‹ã€‚</li>
<li><strong>å»¶è¿Ÿåˆå§‹åŒ–</strong>ï¼šæ§åˆ¶å¯¹è±¡çš„åˆ›å»ºæ—¶æœºï¼Œå®ç°æŒ‰éœ€åŠ è½½ã€‚</li>
<li><strong>ç»Ÿä¸€ç®¡ç†ä¾èµ–</strong>ï¼šé›†ä¸­å¤„ç†å¯¹è±¡åˆ›å»ºæ—¶çš„ä¾èµ–æ³¨å…¥åŠé…ç½®ã€‚</li>
</ul>
<p><strong>2. FactoryBean æ¥å£æ–¹æ³•è§£æ</strong><br>å®ç° <code>FactoryBean</code> æ¥å£éœ€é‡å†™ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<table>
<thead>
<tr>
<th align="left">æ–¹æ³•å</th>
<th align="left">ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>T getObject()</code></td>
<td align="left">è¿”å›ç”± FactoryBean åˆ›å»ºçš„å®é™…å¯¹è±¡å®ä¾‹ã€‚</td>
</tr>
<tr>
<td align="left"><code>Class&lt;?&gt; getObjectType()</code></td>
<td align="left">è¿”å›åˆ›å»ºçš„å¯¹è±¡ç±»å‹ï¼Œç”¨äº Spring å®¹å™¨ç±»å‹æ£€æŸ¥ã€‚</td>
</tr>
<tr>
<td align="left"><code>boolean isSingleton()</code></td>
<td align="left">å†³å®šå¯¹è±¡æ˜¯å¦ä¸ºå•ä¾‹ã€‚é»˜è®¤ <code>true</code>ï¼Œè‹¥è¿”å› <code>false</code> åˆ™æ¯æ¬¡è¯·æ±‚åˆ›å»ºæ–°å®ä¾‹ã€‚</td>
</tr>
</tbody></table>
<p><strong>3. å®é™…åº”ç”¨ç¤ºä¾‹ï¼šè‡ªå®šä¹‰åŠ å¯†å·¥å…· FactoryBean</strong><br>å‡è®¾éœ€åˆ›å»ºä¸€ä¸ªæ ¹æ®é…ç½®åŠ¨æ€é€‰æ‹©åŠ å¯†ç®—æ³•çš„å·¥å…·ç±»ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p><strong>æ­¥éª¤ 1ï¼šå®šä¹‰åŠ å¯†æ¥å£åŠå®ç°ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EncryptionTool</span> &#123;</span><br><span class="line">    String <span class="title function_">encrypt</span><span class="params">(String text)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AES åŠ å¯†å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AesEncryptionTool</span> <span class="keyword">implements</span> <span class="title class_">EncryptionTool</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encrypt</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;AESåŠ å¯†åçš„æ•°æ®: &quot;</span> + text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// RSA åŠ å¯†å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RsaEncryptionTool</span> <span class="keyword">implements</span> <span class="title class_">EncryptionTool</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encrypt</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;RSAåŠ å¯†åçš„æ•°æ®: &quot;</span> + text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ­¥éª¤ 2ï¼šå®ç° EncryptionToolFactoryBean</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.FactoryBean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EncryptionToolFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;EncryptionTool&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> String algorithm; <span class="comment">// é…ç½®å±æ€§ï¼Œå†³å®šåŠ å¯†ç®—æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®ç®—æ³•ç±»å‹ï¼ˆé€šè¿‡Springå±æ€§æ³¨å…¥ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAlgorithm</span><span class="params">(String algorithm)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.algorithm = algorithm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> EncryptionTool <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;AES&quot;</span>.equalsIgnoreCase(algorithm)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AesEncryptionTool</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;RSA&quot;</span>.equalsIgnoreCase(algorithm)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RsaEncryptionTool</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;ä¸æ”¯æŒçš„åŠ å¯†ç®—æ³•: &quot;</span> + algorithm);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> EncryptionTool.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// å•ä¾‹æ¨¡å¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ­¥éª¤ 3ï¼šé…ç½® Spring Bean</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- XML é…ç½®æ–¹å¼ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;encryptionTool&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.EncryptionToolFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;algorithm&quot;</span> <span class="attr">value</span>=<span class="string">&quot;AES&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æˆ–ä½¿ç”¨ Java é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FactoryBean&lt;EncryptionTool&gt; <span class="title function_">encryptionTool</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">EncryptionToolFactoryBean</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EncryptionToolFactoryBean</span>();</span><br><span class="line">        factory.setAlgorithm(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ­¥éª¤ 4ï¼šåœ¨ä¸šåŠ¡ç±»ä¸­æ³¨å…¥ä½¿ç”¨</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EncryptionTool encryptionTool;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">encrypted</span> <span class="operator">=</span> encryptionTool.encrypt(password);</span><br><span class="line">        System.out.println(<span class="string">&quot;åŠ å¯†åçš„å¯†ç : &quot;</span> + encrypted);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ‰§è¡Œç»“æœ</strong>ï¼š<br>æ ¹æ®é…ç½®çš„ <code>algorithm</code> å€¼ï¼ˆAES æˆ– RSAï¼‰ï¼Œ<code>UserService</code> å°†è‡ªåŠ¨ä½¿ç”¨å¯¹åº”çš„åŠ å¯†å·¥å…·ã€‚</p>
<p><strong>4. è·å– FactoryBean å®ä¾‹æœ¬èº«</strong><br>è‹¥éœ€ç›´æ¥è·å– <code>FactoryBean</code> è€Œéå…¶åˆ›å»ºçš„å¯¹è±¡ï¼Œå¯åœ¨ Bean åç§°å‰åŠ  <code>&amp;</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FactoryBean&lt;?&gt; factory = context.getBean(<span class="string">&quot;&amp;encryptionTool&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>5. å®é™…åº”ç”¨åœºæ™¯æ€»ç»“</strong></p>
<ul>
<li><strong>MyBatis çš„ SqlSessionFactoryBean</strong>ï¼šå°è£… <code>SqlSessionFactory</code> çš„åˆ›å»ºï¼Œå¤„ç†æ•°æ®æºã€Mapper æ‰«æç­‰å¤æ‚é…ç½®ã€‚</li>
<li><strong>Spring çš„ ScheduledTaskFactoryBean</strong>ï¼šç”¨äºåŠ¨æ€åˆ›å»ºå®šæ—¶ä»»åŠ¡ Beanã€‚</li>
<li><strong>è¿æ¥æ± é…ç½®</strong>ï¼šå¦‚è‡ªå®šä¹‰ Druid æ•°æ®æºçš„è¯¦ç»†å‚æ•°åˆå§‹åŒ–ã€‚</li>
<li><strong>åŠ¨æ€ä»£ç†ç”Ÿæˆ</strong>ï¼šç»“åˆ AOPï¼Œä¸ºç‰¹å®šæ¥å£ç”Ÿæˆä»£ç†å®ä¾‹ã€‚</li>
</ul>
<p><strong>6. å¯¹æ¯”æ™®é€š @Bean æ–¹æ³•</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>ç‰¹æ€§</strong></th>
<th align="left"><strong>FactoryBean</strong></th>
<th align="left"><strong>@Bean æ–¹æ³•</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>çµæ´»æ€§</strong></td>
<td align="left">é«˜ï¼ˆå¯åŠ¨æ€å†³å®šå¯¹è±¡ç±»å‹ï¼Œå®ç°å¤æ‚åˆå§‹åŒ–é€»è¾‘ï¼‰</td>
<td align="left">ä¸­ï¼ˆé€‚åˆç®€å•å¯¹è±¡åˆ›å»ºï¼‰</td>
</tr>
<tr>
<td align="left"><strong>ä»£ç å¤ç”¨</strong></td>
<td align="left">å¯é€šè¿‡ç»§æ‰¿å¤ç”¨é€»è¾‘</td>
<td align="left">éœ€é‡å¤ç¼–å†™ç›¸ä¼¼ä»£ç </td>
</tr>
<tr>
<td align="left"><strong>ç”Ÿå‘½å‘¨æœŸæ§åˆ¶</strong></td>
<td align="left">æ”¯æŒå»¶è¿Ÿåˆå§‹åŒ–åŠå•ä¾‹æ§åˆ¶</td>
<td align="left">ä¾èµ– <code>@Lazy</code> å’Œ <code>@Scope</code> æ³¨è§£</td>
</tr>
<tr>
<td align="left"><strong>é€‚ç”¨åœºæ™¯</strong></td>
<td align="left">å¤æ‚å¯¹è±¡åˆ›å»ºã€æ¡†æ¶é›†æˆ</td>
<td align="left">ç®€å• Bean å®šä¹‰ã€å¿«é€Ÿé…ç½®</td>
</tr>
</tbody></table>
<p><strong>æ€»ç»“</strong><br>FactoryBean æ˜¯ Spring ä¸­å¤„ç†å¤æ‚å¯¹è±¡åˆ›å»ºçš„å¼ºå¤§å·¥å…·ï¼Œç‰¹åˆ«é€‚ç”¨äºå°è£…åˆå§‹åŒ–é€»è¾‘ã€åŠ¨æ€ç”Ÿæˆå®ä¾‹åŠæ¡†æ¶é›†æˆã€‚åˆç†ä½¿ç”¨ FactoryBean èƒ½æ˜¾è‘—æå‡ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼Œå°¤å…¶åœ¨éœ€è¦ç²¾ç»†æ§åˆ¶ Bean åˆ›å»ºè¿‡ç¨‹æ—¶ï¼Œå…¶ä¼˜åŠ¿æ›´ä¸ºæ˜æ˜¾ã€‚</p>
<h3 id="BeanFactoryPostProcessor-å’Œ-BeanPostProcessor-çš„åŒºåˆ«"><a href="#BeanFactoryPostProcessor-å’Œ-BeanPostProcessor-çš„åŒºåˆ«" class="headerlink" title="BeanFactoryPostProcessor å’Œ BeanPostProcessor çš„åŒºåˆ«"></a><code>BeanFactoryPostProcessor</code> å’Œ <code>BeanPostProcessor</code> çš„åŒºåˆ«</h3><table>
<thead>
<tr>
<th align="left"><strong>ç‰¹æ€§</strong></th>
<th align="left"><strong>BeanFactoryPostProcessor</strong></th>
<th align="left"><strong>BeanPostProcessor</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>ä½œç”¨é˜¶æ®µ</strong></td>
<td align="left">Bean å®šä¹‰åŠ è½½åã€Bean å®ä¾‹åŒ–<strong>ä¹‹å‰</strong></td>
<td align="left">Bean å®ä¾‹åŒ–åã€åˆå§‹åŒ–ï¼ˆ<code>init-method</code>ï¼‰<strong>å‰å</strong></td>
</tr>
<tr>
<td align="left"><strong>æ“ä½œå¯¹è±¡</strong></td>
<td align="left">ä¿®æ”¹ Bean çš„<strong>å®šä¹‰</strong>ï¼ˆ<code>BeanDefinition</code>ï¼‰</td>
<td align="left">ä¿®æ”¹æˆ–å¢å¼º Bean çš„<strong>å®ä¾‹</strong></td>
</tr>
<tr>
<td align="left"><strong>è§¦å‘æ¬¡æ•°</strong></td>
<td align="left">æ¯ä¸ªå®¹å™¨å¯åŠ¨æ—¶<strong>æ‰§è¡Œä¸€æ¬¡</strong></td>
<td align="left"><strong>æ¯ä¸ª Bean åˆå§‹åŒ–æ—¶éƒ½ä¼šè§¦å‘</strong></td>
</tr>
<tr>
<td align="left"><strong>ä¸»è¦ç”¨é€”</strong></td>
<td align="left">åŠ¨æ€ä¿®æ”¹ Bean é…ç½®ï¼ˆå¦‚å±æ€§å ä½ç¬¦æ›¿æ¢ï¼‰</td>
<td align="left">Bean å®ä¾‹çš„ä»£ç†å¢å¼ºï¼ˆå¦‚ AOPï¼‰ã€å±æ€§æ³¨å…¥</td>
</tr>
<tr>
<td align="left"><strong>æ¥å£æ–¹æ³•</strong></td>
<td align="left"><code>postProcessBeanFactory(ConfigurableListableBeanFactory)</code></td>
<td align="left"><code>postProcessBeforeInitialization(Object, String)</code> <code>postProcessAfterInitialization(Object, String)</code></td>
</tr>
<tr>
<td align="left"><strong>å…¸å‹å®ç°ç±»</strong></td>
<td align="left"><code>PropertySourcesPlaceholderConfigurer</code> <code>ConfigurationClassPostProcessor</code></td>
<td align="left"><code>AutowiredAnnotationBeanPostProcessor</code> <code>AnnotationAwareAspectJAutoProxyCreator</code></td>
</tr>
</tbody></table>
<p><strong>æ€»ç»“</strong></p>
<ul>
<li><strong>BeanFactoryPostProcessor</strong>ï¼šå¹²é¢„ Bean çš„<strong>å®šä¹‰é˜¶æ®µ</strong>ï¼Œç”¨äºå®¹å™¨çº§é…ç½®è°ƒæ•´ã€‚</li>
<li><strong>BeanPostProcessor</strong>ï¼šå¹²é¢„ Bean çš„<strong>å®ä¾‹åŒ–é˜¶æ®µ</strong>ï¼Œç”¨äº Bean çº§åŠŸèƒ½å¢å¼ºã€‚</li>
</ul>
<h3 id="Beanç”Ÿå‘½å‘¨æœŸæ‰©å±•ç‚¹å®æˆ˜"><a href="#Beanç”Ÿå‘½å‘¨æœŸæ‰©å±•ç‚¹å®æˆ˜" class="headerlink" title="Beanç”Ÿå‘½å‘¨æœŸæ‰©å±•ç‚¹å®æˆ˜"></a>Beanç”Ÿå‘½å‘¨æœŸæ‰©å±•ç‚¹å®æˆ˜</h3><p>Spring Bean ç”Ÿå‘½å‘¨æœŸçš„æ ¸å¿ƒé˜¶æ®µå’Œæ‰©å±•ç‚¹é¡ºåºï¼š</p>
<ol>
<li><strong>å®ä¾‹åŒ–</strong>ï¼ˆè°ƒç”¨æ„é€ å‡½æ•°ï¼‰</li>
<li><strong>å±æ€§èµ‹å€¼</strong>ï¼ˆä¾èµ–æ³¨å…¥ï¼‰</li>
<li><strong>BeanPostProcessor å‰ç½®å¤„ç†</strong>ï¼ˆ<code>postProcessBeforeInitialization</code>ï¼‰</li>
<li><strong>åˆå§‹åŒ–æ–¹æ³•</strong>ï¼ˆ<code>@PostConstruct</code> â†’ <code>InitializingBean</code> â†’ <code>init-method</code>ï¼‰</li>
<li><strong>BeanPostProcessor åç½®å¤„ç†</strong>ï¼ˆ<code>postProcessAfterInitialization</code>ï¼‰</li>
<li><strong>Bean å°±ç»ªï¼Œè¿›å…¥è¿è¡ŒæœŸ</strong></li>
<li><strong>é”€æ¯æ–¹æ³•</strong>ï¼ˆ<code>@PreDestroy</code> â†’ <code>DisposableBean</code> â†’ <code>destroy-method</code>ï¼‰</li>
</ol>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-942a927a-86e4-4a01-8f52-9addd89642ff.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring Beanç”Ÿå‘½å‘¨æœŸ"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AbstractAutowireCapableBeanFactory</span></span><br><span class="line"><span class="keyword">protected</span> Object <span class="title function_">doCreateBean</span><span class="params">(String beanName, RootBeanDefinition mbd, <span class="meta">@Nullable</span> Object[] args)</span></span><br><span class="line">        <span class="keyword">throws</span> BeanCreationException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Instantiate the bean.</span></span><br><span class="line">    <span class="type">BeanWrapper</span> <span class="variable">instanceWrapper</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (mbd.isSingleton()) &#123;</span><br><span class="line">        instanceWrapper = <span class="built_in">this</span>.factoryBeanInstanceCache.remove(beanName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (instanceWrapper == <span class="literal">null</span>) &#123;</span><br><span class="line">        instanceWrapper = createBeanInstance(beanName, mbd, args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> instanceWrapper.getWrappedInstance();</span><br><span class="line">    Class&lt;?&gt; beanType = instanceWrapper.getWrappedClass();</span><br><span class="line">    <span class="keyword">if</span> (beanType != NullBean.class) &#123;</span><br><span class="line">        mbd.resolvedTargetType = beanType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Allow post-processors to modify the merged bean definition.</span></span><br><span class="line">    <span class="keyword">synchronized</span> (mbd.postProcessingLock) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!mbd.postProcessed) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(mbd.getResourceDescription(), beanName,</span><br><span class="line">                        <span class="string">&quot;Post-processing of merged bean definition failed&quot;</span>, ex);</span><br><span class="line">            &#125;</span><br><span class="line">            mbd.postProcessed = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Eagerly cache singletons to be able to resolve circular references</span></span><br><span class="line">    <span class="comment">// even when triggered by lifecycle interfaces like BeanFactoryAware.</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">earlySingletonExposure</span> <span class="operator">=</span> (mbd.isSingleton() &amp;&amp; <span class="built_in">this</span>.allowCircularReferences &amp;&amp;</span><br><span class="line">            isSingletonCurrentlyInCreation(beanName));</span><br><span class="line">    <span class="keyword">if</span> (earlySingletonExposure) &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">            logger.trace(<span class="string">&quot;Eagerly caching bean &#x27;&quot;</span> + beanName +</span><br><span class="line">                    <span class="string">&quot;&#x27; to allow for resolving potential circular references&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize the bean instance.</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">exposedObject</span> <span class="operator">=</span> bean;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        populateBean(beanName, mbd, instanceWrapper);</span><br><span class="line">        exposedObject = initializeBean(beanName, exposedObject, mbd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> BeanCreationException &amp;&amp; beanName.equals(((BeanCreationException) ex).getBeanName())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> (BeanCreationException) ex;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(</span><br><span class="line">                    mbd.getResourceDescription(), beanName, <span class="string">&quot;Initialization of bean failed&quot;</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (earlySingletonExposure) &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">earlySingletonReference</span> <span class="operator">=</span> getSingleton(beanName, <span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (earlySingletonReference != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (exposedObject == bean) &#123;</span><br><span class="line">                exposedObject = earlySingletonReference;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">this</span>.allowRawInjectionDespiteWrapping &amp;&amp; hasDependentBean(beanName)) &#123;</span><br><span class="line">                String[] dependentBeans = getDependentBeans(beanName);</span><br><span class="line">                Set&lt;String&gt; actualDependentBeans = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;(dependentBeans.length);</span><br><span class="line">                <span class="keyword">for</span> (String dependentBean : dependentBeans) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!removeSingletonIfCreatedForTypeCheckOnly(dependentBean)) &#123;</span><br><span class="line">                        actualDependentBeans.add(dependentBean);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!actualDependentBeans.isEmpty()) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCurrentlyInCreationException</span>(beanName,</span><br><span class="line">                            <span class="string">&quot;Bean with name &#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27; has been injected into other beans [&quot;</span> +</span><br><span class="line">                            StringUtils.collectionToCommaDelimitedString(actualDependentBeans) +</span><br><span class="line">                            <span class="string">&quot;] in its raw version as part of a circular reference, but has eventually been &quot;</span> +</span><br><span class="line">                            <span class="string">&quot;wrapped. This means that said other beans do not use the final version of the &quot;</span> +</span><br><span class="line">                            <span class="string">&quot;bean. This is often the result of over-eager type matching - consider using &quot;</span> +</span><br><span class="line">                            <span class="string">&quot;&#x27;getBeanNamesForType&#x27; with the &#x27;allowEagerInit&#x27; flag turned off, for example.&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Register bean as disposable.</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        registerDisposableBeanIfNecessary(beanName, bean, mbd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (BeanDefinitionValidationException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(</span><br><span class="line">                mbd.getResourceDescription(), beanName, <span class="string">&quot;Invalid destruction signature&quot;</span>, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> exposedObject;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SpringBootè‡ªåŠ¨é…ç½®åŸç†"><a href="#SpringBootè‡ªåŠ¨é…ç½®åŸç†" class="headerlink" title="SpringBootè‡ªåŠ¨é…ç½®åŸç†"></a>SpringBootè‡ªåŠ¨é…ç½®åŸç†</h3><p>Spring Bootçš„è‡ªåŠ¨é…ç½®æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼Œæ—¨åœ¨ç®€åŒ–åº”ç”¨çš„é…ç½®è¿‡ç¨‹ã€‚ä»¥ä¸‹æ˜¯å…¶å®ç°æœºåˆ¶çš„è¯¦ç»†æ­¥éª¤è§£æï¼š</p>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-df77ee15-2ff0-4ec7-8e65-e4ebb8ba88f1.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringBootè‡ªåŠ¨é…ç½®åŸç†"></p>
<ol>
<li><strong>å¯ç”¨è‡ªåŠ¨é…ç½®</strong></li>
</ol>
<p>é€šè¿‡ä¸»ç±»ä¸Šçš„<code>@SpringBootApplication</code>æ³¨è§£ï¼Œè¯¥æ³¨è§£ç»„åˆäº†<code>@EnableAutoConfiguration</code>ï¼Œä»è€Œè§¦å‘è‡ªåŠ¨é…ç½®æœºåˆ¶ã€‚</p>
<ol start="2">
<li><strong>åŠ è½½è‡ªåŠ¨é…ç½®ç±»</strong></li>
</ol>
<p>Spring Bootä¼šæ‰«ææ‰€æœ‰jaråŒ…ä¸­çš„<code>META-INF/spring.factories</code>æ–‡ä»¶ï¼Œè¯»å–<code>org.springframework.boot.autoconfigure.EnableAutoConfiguration</code>é”®ä¸‹çš„é…ç½®ç±»åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="string">\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>æ¡ä»¶åŒ–ç­›é€‰é…ç½®ç±»</strong></li>
</ol>
<p>æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»ä½¿ç”¨æ¡ä»¶æ³¨è§£å†³å®šæ˜¯å¦ç”Ÿæ•ˆï¼Œå¸¸è§æ¡ä»¶åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>@ConditionalOnClass</strong>ï¼šç±»è·¯å¾„å­˜åœ¨æŒ‡å®šç±»æ—¶ç”Ÿæ•ˆã€‚</li>
<li><strong>@ConditionalOnMissingBean</strong>ï¼šå®¹å™¨ä¸­æ— æŒ‡å®šBeanæ—¶ç”Ÿæ•ˆã€‚</li>
<li><strong>@ConditionalOnProperty</strong>ï¼šé…ç½®æ–‡ä»¶ä¸­å­˜åœ¨ç‰¹å®šå±æ€§æ—¶ç”Ÿæ•ˆã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼šDataSourceAutoConfiguration</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;DataSource.class, EmbeddedDatabaseType.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(DataSourceProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">(DataSourceProperties properties)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> properties.initializeDataSourceBuilder().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>@ConditionalOnClass</strong>ç¡®ä¿å­˜åœ¨æ•°æ®åº“ç›¸å…³ç±»ã€‚</li>
<li><strong>@ConditionalOnMissingBean</strong>ä»…åœ¨ç”¨æˆ·æœªè‡ªå®šä¹‰DataSourceæ—¶åˆ›å»ºBeanã€‚</li>
</ul>
<ol start="4">
<li><strong>ç»‘å®šé…ç½®å±æ€§</strong></li>
</ol>
<p>ä½¿ç”¨<code>@EnableConfigurationProperties</code>å°†é…ç½®å±æ€§ç±»ï¼ˆå¦‚<code>DataSourceProperties</code>ï¼‰ä¸é…ç½®æ–‡ä»¶ï¼ˆå¦‚<code>application.yml</code>ï¼‰ç»‘å®šï¼Œå…è®¸é€šè¿‡å±æ€§åŠ¨æ€é…ç½®Beanã€‚</p>
<p><strong>application.ymlç¤ºä¾‹</strong></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mydb</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">secret</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li><strong>è‡ªåŠ¨é…ç½®Beançš„æ³¨å†Œ</strong></li>
</ol>
<p>æ»¡è¶³æ¡ä»¶çš„é…ç½®ç±»ä¸­çš„Beanå®šä¹‰è¢«æ³¨å†Œåˆ°Springåº”ç”¨ä¸Šä¸‹æ–‡ï¼Œä¾›å…¶ä»–ç»„ä»¶æ³¨å…¥ä½¿ç”¨ã€‚</p>
<h3 id="è‡ªå®šä¹‰Starterå¼€å‘è¦ç‚¹"><a href="#è‡ªå®šä¹‰Starterå¼€å‘è¦ç‚¹" class="headerlink" title="è‡ªå®šä¹‰Starterå¼€å‘è¦ç‚¹"></a>è‡ªå®šä¹‰Starterå¼€å‘è¦ç‚¹</h3><p><strong>1. Starter çš„æ ¸å¿ƒç»„æˆ</strong></p>
<p>ä¸€ä¸ªå®Œæ•´çš„ Starter åŒ…å«ä¸¤ä¸ªæ¨¡å—ï¼ˆå¯åˆå¹¶ï¼‰ï¼š</p>
<ol>
<li><strong><code>xxx-spring-boot-starter</code></strong><br>ç©ºæ¨¡å—ï¼Œä»…å£°æ˜ä¾èµ–ï¼ˆå¦‚è‡ªåŠ¨é…ç½®æ¨¡å—å’Œå…¶ä»–å¿…è¦ä¾èµ–ï¼‰ï¼Œä¾›ç”¨æˆ·ç›´æ¥å¼•å…¥ã€‚</li>
<li><strong><code>xxx-spring-boot-autoconfigure</code></strong><br>æ ¸å¿ƒå®ç°æ¨¡å—ï¼ŒåŒ…å«è‡ªåŠ¨é…ç½®ç±»ã€æ¡ä»¶æ³¨è§£ã€é…ç½®å±æ€§ç»‘å®šç­‰ã€‚</li>
</ol>
<p><strong>2. å¼€å‘æ­¥éª¤ä¸å…³é”®ä»£ç </strong></p>
<p><strong>æ­¥éª¤ 1ï¼šåˆ›å»ºé¡¹ç›®ç»“æ„</strong></p>
<p>ä½¿ç”¨ Maven æˆ– Gradle åˆ›å»ºæ¨¡å—ï¼Œå»ºè®®ç»“æ„ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">my-starter/</span><br><span class="line">  â”œâ”€â”€ my-starter-spring-boot-autoconfigure/  # è‡ªåŠ¨é…ç½®æ¨¡å—</span><br><span class="line">  â”‚   â”œâ”€â”€ src/main/java</span><br><span class="line">  â”‚   â”‚   â””â”€â”€ com/example/autoconfigure</span><br><span class="line">  â”‚   â”‚       â”œâ”€â”€ MyServiceAutoConfiguration.java  # è‡ªåŠ¨é…ç½®ç±»</span><br><span class="line">  â”‚   â”‚       â””â”€â”€ MyServiceProperties.java         # é…ç½®å±æ€§ç±»</span><br><span class="line">  â”‚   â””â”€â”€ src/main/resources/META-INF</span><br><span class="line">  â”‚       â”œâ”€â”€ spring.factories                    # è‡ªåŠ¨é…ç½®æ³¨å†Œ</span><br><span class="line">  â”‚       â””â”€â”€ additional-spring-configuration-metadata.json  # é…ç½®æç¤ºï¼ˆå¯é€‰ï¼‰</span><br><span class="line">  â”‚</span><br><span class="line">  â””â”€â”€ my-starter-spring-boot-starter/         # Starter å…¥å£æ¨¡å—</span><br><span class="line">      â””â”€â”€ pom.xml                             # ä»…ä¾èµ–è‡ªåŠ¨é…ç½®æ¨¡å—</span><br></pre></td></tr></table></figure>

<p><strong>æ­¥éª¤ 2ï¼šç¼–å†™è‡ªåŠ¨é…ç½®ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(MyServiceProperties.class)</span>  <span class="comment">// å¯ç”¨é…ç½®å±æ€§ç»‘å®š</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(MyService.class)</span>  <span class="comment">// ç±»è·¯å¾„å­˜åœ¨ MyService æ—¶ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServiceAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span>  <span class="comment">// ç”¨æˆ·æœªè‡ªå®šä¹‰æ—¶æ³¨å†Œ Bean</span></span><br><span class="line">    <span class="keyword">public</span> MyService <span class="title function_">myService</span><span class="params">(MyServiceProperties properties)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyService</span>(properties.getUrl(), properties.getTimeout());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ­¥éª¤ 3ï¼šå®šä¹‰é…ç½®å±æ€§ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;my.service&quot;)</span>  <span class="comment">// é…ç½®å‰ç¼€</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServiceProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://default-url&quot;</span>;  <span class="comment">// é»˜è®¤å€¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">timeout</span> <span class="operator">=</span> <span class="number">5000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getter å’Œ Setter å¿…é¡»æä¾›</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUrl</span><span class="params">()</span> &#123; <span class="keyword">return</span> url; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUrl</span><span class="params">(String url)</span> &#123; <span class="built_in">this</span>.url = url; &#125;</span><br><span class="line">    <span class="comment">// ... å…¶ä»–å±æ€§</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ­¥éª¤ 4ï¼šæ³¨å†Œè‡ªåŠ¨é…ç½®ç±»</strong></p>
<p>åœ¨ <code>resources/META-INF/spring.factories</code> ä¸­å£°æ˜ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="string">\</span></span><br><span class="line"><span class="string">com.example.autoconfigure.MyServiceAutoConfiguration</span></span><br></pre></td></tr></table></figure>

<p><strong>æ­¥éª¤ 5ï¼šé…ç½®æç¤ºï¼ˆå¯é€‰ï¼‰</strong></p>
<p>åœ¨ <code>resources/META-INF/additional-spring-configuration-metadata.json</code> ä¸­ä¸ºé…ç½®é¡¹æ·»åŠ æè¿°ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my.service.url&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java.lang.String&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æœåŠ¡ URL åœ°å€&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;defaultValue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://default-url&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my.service.timeout&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java.lang.Integer&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;defaultValue&quot;</span><span class="punctuation">:</span> <span class="number">5000</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>æ­¥éª¤ 6ï¼šæ‰“åŒ…å¹¶å‘å¸ƒ</strong></p>
<ul>
<li><strong>Maven</strong>ï¼šé€šè¿‡ <code>mvn clean install</code> å®‰è£…åˆ°æœ¬åœ°ä»“åº“ï¼Œæˆ–éƒ¨ç½²åˆ° Nexus ç§æœã€‚</li>
<li><strong>Gradle</strong>ï¼šä½¿ç”¨ <code>publishToMavenLocal</code> æˆ–é…ç½®å‘å¸ƒä»»åŠ¡ã€‚</li>
</ul>
<p><strong>3. ä½¿ç”¨è‡ªå®šä¹‰ Starter</strong></p>
<p>ç”¨æˆ·å¼•å…¥ä¾èµ–åï¼Œå¯ç›´æ¥é€šè¿‡é…ç½®æ–‡ä»¶ï¼ˆå¦‚ <code>application.yml</code>ï¼‰é…ç½®å‚æ•°ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">my:</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://custom-url</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure>

<p><strong>4. å…³é”®æ³¨æ„äº‹é¡¹</strong></p>
<ol>
<li><p><strong>æ¡ä»¶åŒ–é…ç½®</strong><br>ä½¿ç”¨ <code>@ConditionalOnClass</code>, <code>@ConditionalOnProperty</code> ç­‰æ³¨è§£ï¼Œç¡®ä¿ Starter çµæ´»é€‚é…ä¸åŒåœºæ™¯ã€‚</p>
</li>
<li><p><strong>é¿å… Bean å†²çª</strong></p>
<ul>
<li>æ ¸å¿ƒ Bean ä½¿ç”¨ <code>@ConditionalOnMissingBean</code>ï¼Œå…è®¸ç”¨æˆ·è¦†ç›–ã€‚</li>
<li>é¿å…ä¸å…¶ä»– Starter çš„ Bean åç§°é‡å¤ã€‚</li>
</ul>
</li>
<li><p><strong>ç‰ˆæœ¬å…¼å®¹æ€§</strong></p>
<ul>
<li>Starter çš„ Spring Boot ç‰ˆæœ¬éœ€ä¸ç”¨æˆ·é¡¹ç›®åŒ¹é…ã€‚</li>
<li>ä½¿ç”¨ <code>spring-boot-dependencies</code> ç®¡ç†ä¾èµ–ç‰ˆæœ¬ã€‚</li>
</ul>
</li>
<li><p><strong>ä¾èµ–èŒƒå›´æ§åˆ¶</strong></p>
<ul>
<li>éå¿…è¦ä¾èµ–æ ‡è®°ä¸º <code>optional</code>ï¼ˆMavenï¼‰æˆ– <code>optional = true</code>ï¼ˆGradleï¼‰ï¼Œé¿å…ä¼ é€’ä¾èµ–æ±¡æŸ“ç”¨æˆ·é¡¹ç›®ã€‚</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Maven ç¤ºä¾‹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>some-library<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>æ—¥å¿—ä¸æ–‡æ¡£</strong></p>
<ul>
<li>åœ¨ Starter ä¸­æä¾›æ¸…æ™°çš„æ—¥å¿—è¾“å‡ºï¼Œå¸®åŠ©ç”¨æˆ·è°ƒè¯•ã€‚</li>
<li>ç¼–å†™ README è¯´æ˜é…ç½®é¡¹å’Œä½¿ç”¨ç¤ºä¾‹ã€‚</li>
</ul>
</li>
</ol>
<p><strong>5. æµ‹è¯• Starter</strong></p>
<p>ç¼–å†™æµ‹è¯•ç±»éªŒè¯è‡ªåŠ¨é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServiceAutoConfigurationTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="keyword">private</span> MyService myService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAutoConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">        assertNotNull(myService);</span><br><span class="line">        assertEquals(<span class="string">&quot;http://custom-url&quot;</span>, myService.getUrl());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>6. æœ€ä½³å®è·µ</strong></p>
<ul>
<li><strong>æ¨¡å—åŒ–è®¾è®¡</strong>ï¼šå°†è‡ªåŠ¨é…ç½®ä¸ Starter åˆ†ç¦»ï¼Œæ–¹ä¾¿å…¶ä»–æ¨¡å—å¤ç”¨ã€‚</li>
<li><strong>é˜²å¾¡æ€§ç¼–ç¨‹</strong>ï¼šåœ¨è‡ªåŠ¨é…ç½®ç±»ä¸­æ£€æŸ¥ä¾èµ–æ˜¯å¦å­˜åœ¨ï¼ˆå¦‚é€šè¿‡ <code>@ConditionalOnClass</code>ï¼‰ã€‚</li>
<li><strong>é»˜è®¤é…ç½®åˆç†</strong>ï¼šæä¾›å®‰å…¨ã€é€šç”¨çš„é»˜è®¤å€¼ï¼Œå‡å°‘ç”¨æˆ·é…ç½®è´Ÿæ‹…ã€‚</li>
</ul>
<h3 id="ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µ"><a href="#ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µ" class="headerlink" title="ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µ"></a>ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µ</h3><p>ä»¥ä¸‹æ˜¯ <strong>Spring Boot ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µ</strong>ï¼Œæ¶µç›–å¼‚å¸¸åˆ†ç±»ã€å…¨å±€å¤„ç†ã€æ—¥å¿—è®°å½•ã€é”™è¯¯å“åº”è§„èŒƒç­‰å…³é”®ç¯èŠ‚ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºå¥å£®ä¸”æ˜“ç»´æŠ¤çš„åº”ç”¨ç¨‹åºï¼š</p>
<p><strong>æ ¸å¿ƒåŸåˆ™</strong></p>
<ol>
<li><strong>ç»Ÿä¸€å…¥å£</strong>ï¼šæ‰€æœ‰å¼‚å¸¸ç”±å…¨å±€å¤„ç†å™¨æ•è·ï¼Œé¿å…åˆ†æ•£åœ¨å„å¤„ã€‚</li>
<li><strong>å‹å¥½å“åº”</strong>ï¼šå‰ç«¯æ¥æ”¶ç»“æ„åŒ–é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚JSONï¼‰ï¼ŒåŒ…å«é”™è¯¯ç ã€æç¤ºæ¶ˆæ¯ç­‰ã€‚</li>
<li><strong>åˆ†ç±»å¤„ç†</strong>ï¼šåŒºåˆ†ä¸šåŠ¡å¼‚å¸¸ã€ç³»ç»Ÿå¼‚å¸¸ã€å‚æ•°æ ¡éªŒå¼‚å¸¸ç­‰ï¼Œé’ˆå¯¹æ€§å¤„ç†ã€‚</li>
<li><strong>å®‰å…¨æ—¥å¿—</strong>ï¼šæ•æ„Ÿä¿¡æ¯è„±æ•ï¼Œå¼‚å¸¸æ—¥å¿—è¯¦ç»†è®°å½•ï¼Œä½†é¿å…æš´éœ²ç»™å®¢æˆ·ç«¯ã€‚</li>
</ol>
<p><strong>å®ç°æ­¥éª¤ä¸ä»£ç ç¤ºä¾‹</strong></p>
<ol>
<li><strong>å®šä¹‰ç»Ÿä¸€å“åº”æ ¼å¼</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;    <span class="comment">// çŠ¶æ€ç ï¼ˆå¦‚200æˆåŠŸï¼Œ500ç³»ç»Ÿé”™è¯¯ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> String msg;  <span class="comment">// æç¤ºä¿¡æ¯ï¼ˆç”¨æˆ·å‹å¥½ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> T data;      <span class="comment">// å“åº”æ•°æ®</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æˆåŠŸå“åº”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">success</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;æ“ä½œæˆåŠŸ&quot;</span>, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤±è´¥å“åº”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">error</span><span class="params">(<span class="type">int</span> code, String msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>&lt;&gt;(code, msg, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ æ–¹æ³•ã€Getter/Setterçœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>åˆ›å»ºå…¨å±€å¼‚å¸¸å¤„ç†å™¨</strong></li>
</ol>
<p>ä½¿ç”¨ <code>@ControllerAdvice</code> + <code>@ExceptionHandler</code> æ•è·å…¨å±€å¼‚å¸¸ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(BusinessException.class)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Void&gt; <span class="title function_">handleBusinessException</span><span class="params">(BusinessException e)</span> &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;ä¸šåŠ¡å¼‚å¸¸: &#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> Result.error(e.getCode(), e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†å‚æ•°æ ¡éªŒå¼‚å¸¸ï¼ˆJSR-303ï¼‰</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Void&gt; <span class="title function_">handleValidationException</span><span class="params">(MethodArgumentNotValidException e)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> e.getBindingResult().getFieldErrors().stream()</span><br><span class="line">                .map(fieldError -&gt; fieldError.getField() + <span class="string">&quot;: &quot;</span> + fieldError.getDefaultMessage())</span><br><span class="line">                .collect(Collectors.joining(<span class="string">&quot;; &quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="number">400</span>, <span class="string">&quot;å‚æ•°æ ¡éªŒå¤±è´¥: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†å…¶ä»–æœªæ•è·å¼‚å¸¸</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Void&gt; <span class="title function_">handleException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;ç³»ç»Ÿå¼‚å¸¸: &quot;</span>, e);  <span class="comment">// è®°å½•å®Œæ•´å †æ ˆ</span></span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="number">500</span>, <span class="string">&quot;ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BusinessException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(<span class="type">int</span> code, String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¿«é€Ÿåˆ›å»ºå¸¸ç”¨å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> BusinessException <span class="title function_">of</span><span class="params">(<span class="type">int</span> code, String msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(code, msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123; <span class="keyword">return</span> code; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>å‚æ•°æ ¡éªŒè§„èŒƒåŒ–</strong></li>
</ol>
<p>åœ¨ DTO ä¸­ä½¿ç”¨æ ¡éªŒæ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDTO</span> &#123;</span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;ç”¨æˆ·åä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Email(message = &quot;é‚®ç®±æ ¼å¼ä¸æ­£ç¡®&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getter/Setterçœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li><strong>HTTPçŠ¶æ€ç ä¸é”™è¯¯ç æ˜ å°„</strong></li>
</ol>
<table>
<thead>
<tr>
<th align="left">å¼‚å¸¸ç±»å‹</th>
<th align="left">HTTPçŠ¶æ€ç </th>
<th align="left">é”™è¯¯ç </th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>BusinessException</code></td>
<td align="left">200</td>
<td align="left">è‡ªå®šä¹‰</td>
<td align="left">ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼ˆå¦‚è®¢å•çŠ¶æ€å¼‚å¸¸ï¼‰</td>
</tr>
<tr>
<td align="left"><code>MethodArgumentNotValid</code></td>
<td align="left">400</td>
<td align="left">400</td>
<td align="left">å‚æ•°æ ¡éªŒå¤±è´¥</td>
</tr>
<tr>
<td align="left"><code>AuthenticationException</code></td>
<td align="left">401</td>
<td align="left">401</td>
<td align="left">æœªç™»å½•æˆ–Tokenè¿‡æœŸ</td>
</tr>
<tr>
<td align="left"><code>AccessDeniedException</code></td>
<td align="left">403</td>
<td align="left">403</td>
<td align="left">æ— æƒé™è®¿é—®</td>
</tr>
<tr>
<td align="left"><code>å…¶ä»–æœªæ•è·å¼‚å¸¸</code></td>
<td align="left">500</td>
<td align="left">500</td>
<td align="left">ç³»ç»Ÿå†…éƒ¨é”™è¯¯</td>
</tr>
</tbody></table>
<p><strong>ä¸‰ã€æœ€ä½³å®è·µ</strong></p>
<ol>
<li><strong>å¼‚å¸¸åˆ†ç±»åˆ†å±‚å¤„ç†</strong></li>
</ol>
<ul>
<li><strong>ä¸šåŠ¡å¼‚å¸¸</strong>ï¼šç”±å¼€å‘è€…ä¸»åŠ¨æŠ›å‡ºï¼ˆå¦‚åº“å­˜ä¸è¶³ï¼‰ï¼Œæ˜ç¡®æç¤ºç”¨æˆ·ã€‚</li>
<li><strong>ç³»ç»Ÿå¼‚å¸¸</strong>ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥ç­‰ï¼Œæç¤ºå‹å¥½ä¿¡æ¯ï¼Œè®°å½•è¯¦ç»†æ—¥å¿—ã€‚</li>
<li><strong>ç¬¬ä¸‰æ–¹æœåŠ¡å¼‚å¸¸</strong>ï¼šå°è£…ä¸ºç‰¹å®šå¼‚å¸¸ï¼ˆå¦‚ <code>ThirdPartyException</code>ï¼‰ï¼Œé¿å…æ±¡æŸ“æ ¸å¿ƒé€»è¾‘ã€‚</li>
</ul>
<ol start="2">
<li><strong>æ—¥å¿—è®°å½•è§„èŒƒ</strong></li>
</ol>
<ul>
<li><strong>ä¸šåŠ¡å¼‚å¸¸</strong>ï¼šè®°å½• <code>WARN</code> çº§åˆ«ï¼ŒåŒ…å«å…³é”®å‚æ•°ã€‚</li>
<li><strong>ç³»ç»Ÿå¼‚å¸¸</strong>ï¼šè®°å½• <code>ERROR</code> çº§åˆ«ï¼Œè¾“å‡ºå®Œæ•´å †æ ˆã€‚</li>
<li><strong>æ•æ„Ÿä¿¡æ¯è„±æ•</strong>ï¼šå¦‚èº«ä»½è¯å·ã€æ‰‹æœºå·åœ¨æ—¥å¿—ä¸­æ©ç å¤„ç†ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(PaymentException.class)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;Void&gt; <span class="title function_">handlePaymentException</span><span class="params">(PaymentException e)</span> &#123;</span><br><span class="line">    log.warn(<span class="string">&quot;æ”¯ä»˜å¤±è´¥, è®¢å•å·: &#123;&#125;, åŸå› : &#123;&#125;&quot;</span>, e.getOrderId(), e.getMessage());</span><br><span class="line">    <span class="keyword">return</span> Result.error(<span class="number">1001</span>, <span class="string">&quot;æ”¯ä»˜å¤±è´¥ï¼Œè¯·é‡è¯•&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>é”™è¯¯ç è§„èŒƒ</strong></li>
</ol>
<ul>
<li><strong>æ¨¡å—åˆ’åˆ†</strong>ï¼šæŒ‰æ¨¡å—å®šä¹‰é”™è¯¯ç èŒƒå›´ï¼ˆå¦‚ç”¨æˆ·æ¨¡å—1000-1999ï¼‰ã€‚</li>
<li><strong>æ–‡æ¡£ç»´æŠ¤</strong>ï¼šæä¾›é”™è¯¯ç å¯¹ç…§è¡¨ï¼Œæ–¹ä¾¿å‰åç«¯åä½œã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯ç å¸¸é‡ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ErrorCode</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">USER_NOT_FOUND</span> <span class="operator">=</span> <span class="number">1001</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ORDER_EXPIRED</span> <span class="operator">=</span> <span class="number">2001</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>å‰ç«¯å‹å¥½æç¤º</strong></li>
</ol>
<ul>
<li><strong>ç”¨æˆ·å¯è§æ¶ˆæ¯</strong>ï¼šç®€æ´æ˜ç¡®ï¼Œå¦‚â€œå¯†ç å¼ºåº¦ä¸è¶³ï¼Œè‡³å°‘åŒ…å«å¤§å°å†™å­—æ¯â€ã€‚</li>
<li><strong>æŠ€æœ¯ç»†èŠ‚éš”ç¦»</strong>ï¼šä¸è¿”å›Javaå¼‚å¸¸ç±»åã€å †æ ˆä¿¡æ¯ã€‚</li>
</ul>
<ol start="5">
<li><strong>æµ‹è¯•è¦†ç›–</strong></li>
</ol>
<p>éªŒè¯å¼‚å¸¸å¤„ç†é€»è¾‘ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionHandlerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBusinessException</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        mockMvc.perform(get(<span class="string">&quot;/api/order/123&quot;</span>))</span><br><span class="line">               .andExpect(status().isOk())</span><br><span class="line">               .andExpect(jsonPath(<span class="string">&quot;$.code&quot;</span>).value(<span class="number">1001</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å››ã€å¸¸è§é—®é¢˜ä¸è§£å†³</strong></p>
<ol>
<li><strong>å¼‚å¸¸æœªè¢«æ•è·</strong><ul>
<li>æ£€æŸ¥ <code>@ControllerAdvice</code> æ˜¯å¦åœ¨ç»„ä»¶æ‰«æè·¯å¾„å†…ã€‚</li>
<li>ç¡®è®¤æ²¡æœ‰å…¶ä»–å¼‚å¸¸å¤„ç†å™¨å†²çªã€‚</li>
</ul>
</li>
<li><strong>å¾ªç¯ä¾èµ–å¯¼è‡´å¤„ç†å™¨å¤±æ•ˆ</strong><ul>
<li>ç¡®ä¿å…¨å±€å¤„ç†å™¨ä¸ä¾èµ–å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„Beanã€‚</li>
</ul>
</li>
<li><strong>å¼‚æ­¥çº¿ç¨‹å¼‚å¸¸ä¸¢å¤±</strong><ul>
<li>ä½¿ç”¨ <code>AsyncUncaughtExceptionHandler</code> å¤„ç†å¼‚æ­¥ä»»åŠ¡å¼‚å¸¸ã€‚</li>
</ul>
</li>
</ol>
<p><strong>äº”ã€æ€»ç»“</strong></p>
<p>é€šè¿‡ç»Ÿä¸€å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œå¯ä»¥å®ç°ï¼š</p>
<ul>
<li><strong>ä»£ç ç®€æ´æ€§</strong>ï¼šæ¶ˆé™¤é‡å¤çš„ <code>try-catch</code> å—ã€‚</li>
<li><strong>ç»´æŠ¤ä¾¿æ·æ€§</strong>ï¼šé›†ä¸­ç®¡ç†é”™è¯¯å“åº”é€»è¾‘ã€‚</li>
<li><strong>æ¥å£è§„èŒƒæ€§</strong>ï¼šå‰åç«¯éµå¾ªç»Ÿä¸€çš„é”™è¯¯åè®®ã€‚</li>
<li><strong>ç³»ç»Ÿå¥å£®æ€§</strong>ï¼šå…³é”®å¼‚å¸¸ä¸æ¼å¤„ç†ï¼Œæ—¥å¿—å¯è¿½æº¯ã€‚</li>
</ul>
<h3 id="é…ç½®åŠ è½½ä¼˜å…ˆçº§ï¼ˆå‘½ä»¤è¡Œ-ç¯å¢ƒå˜é‡ï¼‰"><a href="#é…ç½®åŠ è½½ä¼˜å…ˆçº§ï¼ˆå‘½ä»¤è¡Œ-ç¯å¢ƒå˜é‡ï¼‰" class="headerlink" title="é…ç½®åŠ è½½ä¼˜å…ˆçº§ï¼ˆå‘½ä»¤è¡Œ&gt;ç¯å¢ƒå˜é‡ï¼‰"></a>é…ç½®åŠ è½½ä¼˜å…ˆçº§ï¼ˆå‘½ä»¤è¡Œ&gt;ç¯å¢ƒå˜é‡ï¼‰</h3><table>
<thead>
<tr>
<th align="left">ä¼˜å…ˆçº§</th>
<th align="left">é…ç½®æº</th>
<th align="left">ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>1</strong></td>
<td align="left"><strong>å‘½ä»¤è¡Œå‚æ•°</strong></td>
<td align="left"><code>--server.port=8081</code></td>
</tr>
<tr>
<td align="left"><strong>2</strong></td>
<td align="left">Java ç³»ç»Ÿå±æ€§ (<code>-D</code>)</td>
<td align="left"><code>-Dspring.datasource.url=jdbc:mysql://...</code></td>
</tr>
<tr>
<td align="left"><strong>3</strong></td>
<td align="left"><strong>æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡</strong></td>
<td align="left"><code>export SERVER_PORT=8081</code> (Linux)</td>
</tr>
<tr>
<td align="left"><strong>4</strong></td>
<td align="left">é…ç½®æ–‡ä»¶ï¼ˆå¦‚ <code>application.yml</code>ï¼‰</td>
<td align="left"><code>server.port: 8080</code></td>
</tr>
</tbody></table>
<h3 id="Spring-AOP-å’Œ-AspectJ-æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#Spring-AOP-å’Œ-AspectJ-æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="Spring AOP å’Œ AspectJ æœ‰ä»€ä¹ˆåŒºåˆ«"></a><code>Spring AOP</code> å’Œ <code>AspectJ</code> æœ‰ä»€ä¹ˆåŒºåˆ«</h3><h3 id="è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨ã€AOPçš„åŒºåˆ«ä¸å®è·µ"><a href="#è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨ã€AOPçš„åŒºåˆ«ä¸å®è·µ" class="headerlink" title="è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨ã€AOPçš„åŒºåˆ«ä¸å®è·µ"></a>è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨ã€AOPçš„åŒºåˆ«ä¸å®è·µ</h3><table>
<thead>
<tr>
<th align="left"><strong>ç»´åº¦</strong></th>
<th align="left"><strong>è¿‡æ»¤å™¨ï¼ˆFilterï¼‰</strong></th>
<th align="left"><strong>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰</strong></th>
<th align="left"><strong>AOPï¼ˆAspectï¼‰</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>è§„èŒƒ&#x2F;æ¡†æ¶</strong></td>
<td align="left">Servlet è§„èŒƒï¼ˆJava EEï¼‰</td>
<td align="left">Spring MVC æ¡†æ¶</td>
<td align="left">Spring AOP &#x2F; AspectJ</td>
</tr>
<tr>
<td align="left"><strong>ä½œç”¨é˜¶æ®µ</strong></td>
<td align="left">è¯·æ±‚è¿›å…¥ Servlet å‰&#x2F;å“åº”è¿”å›å®¢æˆ·ç«¯å‰</td>
<td align="left">Controller æ–¹æ³•æ‰§è¡Œå‰å</td>
<td align="left">ä»»æ„ Bean æ–¹æ³•æ‰§è¡Œå‰å</td>
</tr>
<tr>
<td align="left"><strong>ä½œç”¨èŒƒå›´</strong></td>
<td align="left">æ‰€æœ‰ HTTP è¯·æ±‚ï¼ˆåŒ…æ‹¬é™æ€èµ„æºï¼‰</td>
<td align="left">Spring MVC å¤„ç†çš„è¯·æ±‚ï¼ˆåŠ¨æ€èµ„æºï¼‰</td>
<td align="left">Spring ç®¡ç†çš„ Bean æ–¹æ³•</td>
</tr>
<tr>
<td align="left"><strong>ä¾èµ–å…³ç³»</strong></td>
<td align="left">ä¾èµ– Servlet å®¹å™¨ï¼ˆTomcat&#x2F;Jettyï¼‰</td>
<td align="left">ä¾èµ– Spring å®¹å™¨</td>
<td align="left">ä¾èµ– Spring å®¹å™¨</td>
</tr>
<tr>
<td align="left"><strong>å¯è®¿é—®å¯¹è±¡</strong></td>
<td align="left">ServletRequest&#x2F;ServletResponse</td>
<td align="left">HttpServletRequest&#x2F;ModelAndView</td>
<td align="left">æ–¹æ³•å‚æ•°ã€æ³¨è§£ã€è¿”å›å€¼</td>
</tr>
<tr>
<td align="left"><strong>æ‰§è¡Œé¡ºåº</strong></td>
<td align="left">è¿‡æ»¤å™¨é“¾é¡ºåºï¼ˆweb.xml æˆ–æ³¨è§£é¡ºåºï¼‰</td>
<td align="left">æ‹¦æˆªå™¨æ³¨å†Œé¡ºåº</td>
<td align="left">åˆ‡é¢ä¼˜å…ˆçº§ï¼ˆ<code>@Order</code> æ³¨è§£ï¼‰</td>
</tr>
<tr>
<td align="left"><strong>å…¸å‹åœºæ™¯</strong></td>
<td align="left">å­—ç¬¦ç¼–ç ã€è·¨åŸŸå¤„ç†ã€è¯·æ±‚æ—¥å¿—</td>
<td align="left">æƒé™æ ¡éªŒã€å‚æ•°é¢„å¤„ç†ã€æ—¥å¿—è®°å½•</td>
<td align="left">äº‹åŠ¡ç®¡ç†ã€æ€§èƒ½ç›‘æ§ã€ç¼“å­˜æ§åˆ¶</td>
</tr>
</tbody></table>
<p><strong>æ‰§è¡Œæµç¨‹ä¸é¡ºåº</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// HTTP è¯·æ±‚å¤„ç†æµç¨‹</span><br><span class="line">HTTP Request â†’ Filter Chain â†’ DispatcherServlet â†’ Interceptor Chain â†’ Controller â†’ AOP Advice â†’ Response</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>è¿‡æ»¤å™¨ï¼ˆFilterï¼‰</strong>ï¼šæœ€å…ˆæ‰§è¡Œï¼Œå¯æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼ˆå¦‚é™æ€èµ„æºï¼‰ã€‚</li>
<li><strong>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰</strong>ï¼šåœ¨ <code>DispatcherServlet</code> ä¹‹åã€Controller æ–¹æ³•ä¹‹å‰æ‰§è¡Œã€‚</li>
<li><strong>AOP åˆ‡é¢ï¼ˆAspectï¼‰</strong>ï¼šåœ¨ Controller æˆ– Service æ–¹æ³•æ‰§è¡Œå‰åè§¦å‘ã€‚</li>
</ol>
<p><strong>å®è·µåœºæ™¯ä¸ä»£ç ç¤ºä¾‹</strong></p>
<p><strong>åœºæ™¯ 1ï¼šå…¨å±€è¯·æ±‚æ—¥å¿—ï¼ˆè·¨æ‰€æœ‰è¯·æ±‚ï¼‰</strong></p>
<ul>
<li><p><strong>é€‰æ‹©æ–¹æ¡ˆ</strong>ï¼š<strong>è¿‡æ»¤å™¨ï¼ˆFilterï¼‰</strong><br><strong>åŸå› </strong>ï¼šéœ€è®°å½•æ‰€æœ‰è¯·æ±‚ï¼ˆåŒ…æ‹¬é™æ€èµ„æºï¼‰çš„åŸå§‹ä¿¡æ¯ï¼ˆå¦‚ IPã€URLï¼‰ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter(urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest req, ServletResponse res, FilterChain chain)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        chain.doFilter(req, res); <span class="comment">// æ”¾è¡Œè¯·æ±‚</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">cost</span> <span class="operator">=</span> System.currentTimeMillis() - start;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¯·æ±‚è€—æ—¶: &quot;</span> + cost + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>åœºæ™¯ 2ï¼šç”¨æˆ·ç™»å½•æ ¡éªŒï¼ˆä»…åŠ¨æ€è¯·æ±‚ï¼‰</strong></p>
<ul>
<li><p><strong>é€‰æ‹©æ–¹æ¡ˆ</strong>ï¼š<strong>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰</strong><br><strong>åŸå› </strong>ï¼šéœ€è®¿é—® Spring ä¸Šä¸‹æ–‡ï¼ˆå¦‚è·å–ç”¨æˆ· Sessionï¼‰ï¼Œä¸”ä»…éœ€æ‹¦æˆªåŠ¨æ€è¯·æ±‚ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest req, HttpServletResponse res, Object handler)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (req.getSession().getAttribute(<span class="string">&quot;user&quot;</span>) == <span class="literal">null</span>) &#123;</span><br><span class="line">            res.sendRedirect(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// ä¸­æ–­è¯·æ±‚</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œæ‹¦æˆªå™¨</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">AuthInterceptor</span>()).addPathPatterns(<span class="string">&quot;/api/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>åœºæ™¯ 3ï¼šæ–¹æ³•çº§äº‹åŠ¡ç®¡ç†</strong></p>
<ul>
<li><p><strong>é€‰æ‹©æ–¹æ¡ˆ</strong>ï¼š<strong>AOPï¼ˆå£°æ˜å¼äº‹åŠ¡ï¼‰</strong><br><strong>åŸå› </strong>ï¼šéœ€åœ¨æ–¹æ³•æ‰§è¡Œå‰åç®¡ç†äº‹åŠ¡ï¼Œä¸ä¸šåŠ¡é€»è¾‘è§£è€¦ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionAspect</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PlatformTransactionManager txManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;@annotation(org.springframework.transaction.annotation.Transactional)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">manageTransaction</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">TransactionStatus</span> <span class="variable">status</span> <span class="operator">=</span> txManager.getTransaction(<span class="keyword">new</span> <span class="title class_">DefaultTransactionDefinition</span>());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">            txManager.commit(status);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            txManager.rollback(status);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>åœºæ™¯ 4ï¼šæ¥å£è€—æ—¶ç»Ÿè®¡</strong></p>
<ul>
<li><p><strong>é€‰æ‹©æ–¹æ¡ˆ</strong>ï¼š<strong>AOPï¼ˆç¯ç»•é€šçŸ¥ï¼‰</strong><br><strong>åŸå› </strong>ï¼šéœ€ç»Ÿè®¡ä»»æ„æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´ï¼Œçµæ´»ä½œç”¨äº Service å±‚æˆ– Controller å±‚ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PerformanceAspect</span> &#123;</span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.example.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">logTime</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œè€—æ—¶: &quot;</span> + (System.currentTimeMillis() - start) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>å¦‚ä½•é€‰æ‹©ï¼Ÿ</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>æŠ€æœ¯</strong></th>
<th align="left"><strong>ä¼˜å…ˆä½¿ç”¨åœºæ™¯</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>è¿‡æ»¤å™¨</strong></td>
<td align="left">å¤„ç†åŸå§‹è¯·æ±‚&#x2F;å“åº”ï¼ˆå¦‚è·¨åŸŸã€å‹ç¼©ï¼‰ã€å…¨å±€æ—¥å¿—ã€å®‰å…¨è¿‡æ»¤ï¼ˆXSS&#x2F;SQL æ³¨å…¥é˜²å¾¡ï¼‰</td>
</tr>
<tr>
<td align="left"><strong>æ‹¦æˆªå™¨</strong></td>
<td align="left">éœ€è¦ Spring ä¸Šä¸‹æ–‡æ”¯æŒã€åŠ¨æ€è¯·æ±‚æ‹¦æˆªï¼ˆå¦‚æƒé™æ ¡éªŒã€å‚æ•°é¢„å¤„ç†ï¼‰</td>
</tr>
<tr>
<td align="left"><strong>AOP</strong></td>
<td align="left">ä¸ä¸šåŠ¡é€»è¾‘è§£è€¦çš„æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚äº‹åŠ¡ã€æ—¥å¿—ã€ç¼“å­˜ã€æ€§èƒ½ç›‘æ§ï¼‰</td>
</tr>
</tbody></table>
<p><strong>æœ€ä½³å®è·µ</strong></p>
<ol>
<li><strong>é¿å…åŠŸèƒ½é‡å </strong>ï¼š<ul>
<li>è‹¥è¿‡æ»¤å™¨ä¸æ‹¦æˆªå™¨å®ç°ç›¸ä¼¼åŠŸèƒ½ï¼ˆå¦‚æ—¥å¿—ï¼‰ï¼Œé€‰æ‹©æ›´é è¿‘è¯·æ±‚å…¥å£çš„ç»„ä»¶ï¼ˆè¿‡æ»¤å™¨ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>æ…ç”¨ AOP æ‹¦æˆª Controller</strong>ï¼š<ul>
<li>Controller æ–¹æ³•é€šå¸¸å·²ç”±æ‹¦æˆªå™¨å¤„ç†ï¼ŒAOP æ›´é€‚åˆ Service å±‚ã€‚</li>
</ul>
</li>
<li><strong>æ³¨æ„æ‰§è¡Œé¡ºåº</strong>ï¼š<ul>
<li>å¤šä¸ªè¿‡æ»¤å™¨&#x2F;æ‹¦æˆªå™¨éœ€æ˜ç¡®é¡ºåºï¼Œé¿å…ä¾èµ–é—®é¢˜ã€‚</li>
</ul>
</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼š<ul>
<li>è¿‡æ»¤å™¨é“¾å’Œæ‹¦æˆªå™¨é“¾è¾ƒé•¿æ—¶ï¼Œå¯èƒ½å½±å“ååé‡ï¼Œéœ€åˆç†è®¾è®¡ã€‚</li>
</ul>
</li>
</ol>
<p>é€šè¿‡åˆç†é€‰æ‹©è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨å’Œ AOPï¼Œå¼€å‘è€…å¯ä»¥é«˜æ•ˆç®¡ç†æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œæå‡ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œç³»ç»Ÿæ€§èƒ½ã€‚</p>
<h3 id="æ³¨è§£çš„å®ç°åŸç†"><a href="#æ³¨è§£çš„å®ç°åŸç†" class="headerlink" title="æ³¨è§£çš„å®ç°åŸç†"></a>æ³¨è§£çš„å®ç°åŸç†</h3><p>åœ¨ Java ä¸­ï¼Œ<strong>æ³¨è§£ï¼ˆAnnotationï¼‰</strong> æ˜¯ä¸€ç§å…ƒæ•°æ®æœºåˆ¶ï¼Œå…¶æœ¬è´¨æ˜¯ä»£ç ä¸­çš„ç‰¹æ®Šæ ‡è®°ï¼Œéœ€é…åˆ <strong>æ³¨è§£å¤„ç†å™¨</strong> å®ç°å…·ä½“åŠŸèƒ½ã€‚æ³¨è§£æœ¬èº«ä¸åŒ…å«é€»è¾‘ï¼Œå…¶ä½œç”¨ç”±å¤„ç†å™¨å†³å®šã€‚ä»¥ä¸‹æ˜¯æ³¨è§£çš„å®ç°åŸç†è¯¦è§£ï¼š</p>
<p><strong>ä¸€ã€æ³¨è§£çš„æœ¬è´¨</strong></p>
<ol>
<li><strong>æ³¨è§£çš„åº•å±‚ç»“æ„</strong></li>
</ol>
<ul>
<li><p>æ³¨è§£æœ¬è´¨æ˜¯ç»§æ‰¿ <code>java.lang.annotation.Annotation</code> çš„ <strong>æ¥å£</strong>ã€‚</p>
</li>
<li><p>é€šè¿‡ JDK åŠ¨æ€ä»£ç†ç”Ÿæˆæ³¨è§£çš„å®ä¾‹ã€‚</p>
</li>
<li><p><strong>ç¤ºä¾‹</strong>ï¼šåç¼–è¯‘ <code>@Override</code> æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Override</span> <span class="keyword">extends</span> <span class="title class_">Annotation</span> &#123;</span><br><span class="line">    <span class="comment">// ç©ºæ¥å£ï¼Œä»…ä½œæ ‡è®°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li><strong>å…ƒæ³¨è§£ï¼ˆMeta-Annotationï¼‰</strong></li>
</ol>
<p>ç”¨äºå®šä¹‰æ³¨è§£çš„è¡Œä¸ºï¼Œå¸¸è§å…ƒæ³¨è§£ï¼š</p>
<table>
<thead>
<tr>
<th align="left">å…ƒæ³¨è§£</th>
<th align="left">ä½œç”¨</th>
<th align="left">ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>@Target</code></td>
<td align="left">æŒ‡å®šæ³¨è§£å¯åº”ç”¨çš„ç›®æ ‡ï¼ˆç±»ã€æ–¹æ³•ã€å­—æ®µç­‰ï¼‰</td>
<td align="left"><code>@Target(ElementType.METHOD)</code></td>
</tr>
<tr>
<td align="left"><code>@Retention</code></td>
<td align="left">æŒ‡å®šæ³¨è§£çš„ä¿ç•™ç­–ç•¥ï¼ˆæºç ã€ç±»æ–‡ä»¶ã€è¿è¡Œæ—¶ï¼‰</td>
<td align="left"><code>@Retention(RetentionPolicy.RUNTIME)</code></td>
</tr>
<tr>
<td align="left"><code>@Documented</code></td>
<td align="left">æ³¨è§£æ˜¯å¦åŒ…å«åœ¨ Javadoc ä¸­</td>
<td align="left"><code>@Documented</code></td>
</tr>
<tr>
<td align="left"><code>@Inherited</code></td>
<td align="left">å­ç±»æ˜¯å¦ç»§æ‰¿çˆ¶ç±»çš„æ³¨è§£</td>
<td align="left"><code>@Inherited</code></td>
</tr>
</tbody></table>
<p><strong>äºŒã€æ³¨è§£çš„å¤„ç†æœºåˆ¶</strong></p>
<ol>
<li><strong>ç¼–è¯‘æ—¶å¤„ç†ï¼ˆAnnotation Processing Tool, APTï¼‰</strong></li>
</ol>
<ul>
<li><p><strong>åŸç†</strong>ï¼šåœ¨ç¼–è¯‘é˜¶æ®µï¼Œé€šè¿‡æ³¨è§£å¤„ç†å™¨ï¼ˆç»§æ‰¿ <code>AbstractProcessor</code>ï¼‰æ‰«æå’Œå¤„ç†æ³¨è§£ã€‚</p>
</li>
<li><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>ç”Ÿæˆä»£ç ï¼ˆå¦‚ Lombok ç”Ÿæˆ Getter&#x2F;Setterï¼‰ã€‚</li>
<li>è¯­æ³•æ£€æŸ¥ï¼ˆå¦‚ <code>@Override</code> éªŒè¯æ–¹æ³•é‡å†™ï¼‰ã€‚</li>
</ul>
</li>
<li><p><strong>ç¤ºä¾‹</strong>ï¼šè‡ªå®šä¹‰ç¼–è¯‘æ—¶æ³¨è§£å¤„ç†å™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SupportedAnnotationTypes(&quot;com.example.MyAnnotation&quot;)</span></span><br><span class="line"><span class="meta">@SupportedSourceVersion(SourceVersion.RELEASE_8)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProcessor</span> <span class="keyword">extends</span> <span class="title class_">AbstractProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment env)</span> &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†æ³¨è§£é€»è¾‘ï¼Œå¦‚ç”Ÿæˆä»£ç </span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li><strong>è¿è¡Œæ—¶å¤„ç†ï¼ˆåå°„æœºåˆ¶ï¼‰</strong></li>
</ol>
<ul>
<li><p><strong>åŸç†</strong>ï¼šé€šè¿‡åå°„ APIï¼ˆå¦‚ <code>Class.getAnnotation()</code>ï¼‰åœ¨è¿è¡Œæ—¶è¯»å–æ³¨è§£ä¿¡æ¯ã€‚</p>
</li>
<li><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>åŠ¨æ€é…ç½®ï¼ˆå¦‚ Spring çš„ <code>@Autowired</code> ä¾èµ–æ³¨å…¥ï¼‰ã€‚</li>
<li>è‡ªå®šä¹‰é€»è¾‘ï¼ˆå¦‚æƒé™æ ¡éªŒã€æ—¥å¿—è®°å½•ï¼‰ã€‚</li>
</ul>
</li>
<li><p><strong>ç¤ºä¾‹</strong>ï¼šè¯»å–æ–¹æ³•ä¸Šçš„æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> obj.getClass().getMethod(<span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (method.isAnnotationPresent(MyAnnotation.class)) &#123;</span><br><span class="line">    <span class="type">MyAnnotation</span> <span class="variable">anno</span> <span class="operator">=</span> method.getAnnotation(MyAnnotation.class);</span><br><span class="line">    System.out.println(anno.value());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li><strong>å­—èŠ‚ç å¢å¼ºå¤„ç†ï¼ˆAOP æ¡†æ¶ï¼‰</strong></li>
</ol>
<ul>
<li><strong>åŸç†</strong>ï¼šåœ¨ç±»åŠ è½½æ—¶ä¿®æ”¹å­—èŠ‚ç ï¼Œæ¤å…¥ä¸æ³¨è§£ç›¸å…³çš„é€»è¾‘ã€‚</li>
<li><strong>å·¥å…·</strong>ï¼šAspectJã€ASMã€Byte Buddyã€‚</li>
<li><strong>åº”ç”¨åœºæ™¯</strong>ï¼š<ul>
<li>å®ç° AOP åˆ‡é¢ï¼ˆå¦‚ <code>@Transactional</code> äº‹åŠ¡ç®¡ç†ï¼‰ã€‚</li>
<li>åŠ¨æ€ä»£ç†ï¼ˆå¦‚ Spring AOPï¼‰ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ä¸‰ã€æ³¨è§£å¤„ç†çš„æ ¸å¿ƒæµç¨‹</strong></p>
<ol>
<li><strong>å®šä¹‰æ³¨è§£</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> LogExecution &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;default log&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>ä½¿ç”¨æ³¨è§£</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@LogExecution(&quot;ç”¨æˆ·æŸ¥è¯¢æ–¹æ³•&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>å¤„ç†æ³¨è§£ï¼ˆä»¥è¿è¡Œæ—¶ä¸ºä¾‹ï¼‰</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">logIfNeeded</span><span class="params">(Method method)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (method.isAnnotationPresent(LogExecution.class)) &#123;</span><br><span class="line">            <span class="type">LogExecution</span> <span class="variable">log</span> <span class="operator">=</span> method.getAnnotation(LogExecution.class);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ‰§è¡Œæ—¥å¿—: &quot;</span> + log.value());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException &#123;</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> UserService.class.getMethod(<span class="string">&quot;getUser&quot;</span>);</span><br><span class="line">        logIfNeeded(method); <span class="comment">// è¾“å‡ºï¼šæ‰§è¡Œæ—¥å¿—: ç”¨æˆ·æŸ¥è¯¢æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å››ã€æ³¨è§£çš„åº•å±‚å®ç°ï¼ˆåå°„åŠ¨æ€ä»£ç†ï¼‰</strong></p>
<p>å½“ä½¿ç”¨ <code>@LogExecution</code> æ—¶ï¼ŒJVM ä¼šé€šè¿‡åŠ¨æ€ä»£ç†ç”Ÿæˆæ³¨è§£å®ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿæˆçš„ä»£ç†ç±»ï¼ˆç®€åŒ–ç‰ˆï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogExecutionProxy</span> <span class="keyword">implements</span> <span class="title class_">LogExecution</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">value</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ç”¨æˆ·æŸ¥è¯¢æ–¹æ³•&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; annotationType() &#123;</span><br><span class="line">        <span class="keyword">return</span> LogExecution.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>äº”ã€å¸¸è§æ¡†æ¶ä¸­çš„æ³¨è§£åº”ç”¨</strong></p>
<table>
<thead>
<tr>
<th align="left"><strong>æ¡†æ¶</strong></th>
<th align="left"><strong>æ³¨è§£ç¤ºä¾‹</strong></th>
<th align="left"><strong>å¤„ç†æœºåˆ¶</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>Spring</strong></td>
<td align="left"><code>@Autowired</code></td>
<td align="left">è¿è¡Œæ—¶åå°„ + ä¾èµ–æ³¨å…¥</td>
</tr>
<tr>
<td align="left"><strong>Lombok</strong></td>
<td align="left"><code>@Data</code></td>
<td align="left">ç¼–è¯‘æ—¶ APT ç”Ÿæˆä»£ç </td>
</tr>
<tr>
<td align="left"><strong>JUnit</strong></td>
<td align="left"><code>@Test</code></td>
<td align="left">è¿è¡Œæ—¶åå°„æ‰§è¡Œæµ‹è¯•æ–¹æ³•</td>
</tr>
<tr>
<td align="left"><strong>Hibernate</strong></td>
<td align="left"><code>@Entity</code></td>
<td align="left">è¿è¡Œæ—¶åå°„æ˜ å°„æ•°æ®åº“è¡¨</td>
</tr>
<tr>
<td align="left"><strong>AspectJ</strong></td>
<td align="left"><code>@Around</code></td>
<td align="left">ç¼–è¯‘æ—¶&#x2F;ç±»åŠ è½½æ—¶å­—èŠ‚ç å¢å¼º</td>
</tr>
</tbody></table>
<p><strong>å…­ã€æ³¨è§£çš„å±€é™æ€§</strong></p>
<ol>
<li><strong>æ— æ³•ç‹¬ç«‹å·¥ä½œ</strong>ï¼šå¿…é¡»ä¾èµ–å¤„ç†å™¨ï¼ˆAPTã€åå°„ã€AOP ç­‰ï¼‰ã€‚</li>
<li><strong>æ€§èƒ½å¼€é”€</strong>ï¼šè¿è¡Œæ—¶åå°„å¤„ç†å¯èƒ½å½±å“æ€§èƒ½ã€‚</li>
<li><strong>å¤æ‚åº¦é«˜</strong>ï¼šå­—èŠ‚ç å¢å¼ºéœ€æŒæ¡ ASM ç­‰å·¥å…·ã€‚</li>
</ol>
<p><strong>ä¸ƒã€æœ€ä½³å®è·µ</strong></p>
<ol>
<li><strong>æ˜ç¡®ä¿ç•™ç­–ç•¥</strong>ï¼š<ul>
<li>è‹¥åªéœ€ç¼–è¯‘æ—¶æ£€æŸ¥ï¼ˆå¦‚ <code>@Override</code>ï¼‰ï¼Œä½¿ç”¨ <code>RetentionPolicy.SOURCE</code>ã€‚</li>
<li>è‹¥éœ€è¿è¡Œæ—¶å¤„ç†ï¼ˆå¦‚ Spring æ³¨è§£ï¼‰ï¼Œä½¿ç”¨ <code>RetentionPolicy.RUNTIME</code>ã€‚</li>
</ul>
</li>
<li><strong>é¿å…è¿‡åº¦ä½¿ç”¨</strong>ï¼šæ³¨è§£æ»¥ç”¨ä¼šå¯¼è‡´ä»£ç å¯è¯»æ€§ä¸‹é™ã€‚</li>
<li><strong>ç»“åˆå·¥å…·é“¾</strong>ï¼šä½¿ç”¨ Lombokã€MapStruct ç­‰å·¥å…·ç®€åŒ–å¼€å‘ã€‚</li>
</ol>
<p>é€šè¿‡ç†è§£æ³¨è§£çš„å®ç°åŸç†ï¼Œå¼€å‘è€…å¯ä»¥æ›´é«˜æ•ˆåœ°åˆ©ç”¨å…¶å®ç°ä»£ç è§£è€¦ã€åŠ¨æ€é…ç½®å’Œè‡ªåŠ¨åŒ–å¤„ç†ï¼Œæå‡æ¡†æ¶çš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<h3 id="MapperScan-çš„å®ç°åŸç†"><a href="#MapperScan-çš„å®ç°åŸç†" class="headerlink" title="@MapperScan çš„å®ç°åŸç†"></a><code>@MapperScan</code> çš„å®ç°åŸç†</h3><p><code>@MapperScan</code> æ˜¯ MyBatis-Spring æ•´åˆä¸­çš„æ ¸å¿ƒæ³¨è§£ï¼Œç”¨äºè‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œ Mapper æ¥å£ä¸º Spring Beanã€‚å…¶å®ç°åŸç†åŸºäº Spring çš„æ‰©å±•æœºåˆ¶å’Œ MyBatis çš„åŠ¨æ€ä»£ç†ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†æ­¥éª¤å’Œæ ¸å¿ƒé€»è¾‘ï¼š</p>
<p><strong>1. æ³¨è§£å®šä¹‰ä¸å…¥å£</strong></p>
<p><code>@MapperScan</code> é€šè¿‡ <code>@Import</code> å¼•å…¥ <code>MapperScannerRegistrar</code>ï¼Œè§¦å‘æ‰«æå’Œæ³¨å†Œé€»è¾‘ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Import(MapperScannerRegistrar.class)</span> <span class="comment">// å…³é”®ï¼šå¼•å…¥æ³¨å†Œå™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MapperScan &#123;</span><br><span class="line">    String[] value() <span class="keyword">default</span> &#123;&#125;; <span class="comment">// æ‰«æçš„åŒ…è·¯å¾„</span></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; annotationClass() <span class="keyword">default</span> Annotation.class;</span><br><span class="line">    <span class="comment">// å…¶ä»–é…ç½®å±æ€§...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2. MapperScannerRegistrar æ³¨å†Œ Bean å®šä¹‰</strong></p>
<p><code>MapperScannerRegistrar</code> å®ç° <code>ImportBeanDefinitionRegistrar</code> æ¥å£ï¼Œåœ¨ Spring å®¹å™¨å¯åŠ¨æ—¶åŠ¨æ€æ³¨å†Œ Beanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperScannerRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// è§£æ @MapperScan æ³¨è§£çš„å±æ€§ï¼ˆå¦‚åŒ…è·¯å¾„ï¼‰</span></span><br><span class="line">        <span class="type">AnnotationAttributes</span> <span class="variable">attrs</span> <span class="operator">=</span> AnnotationAttributes.fromMap(metadata.getAnnotationAttributes(MapperScan.class.getName()));</span><br><span class="line">        <span class="comment">// åˆ›å»ºå¹¶é…ç½® ClassPathMapperScanner</span></span><br><span class="line">        <span class="type">ClassPathMapperScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathMapperScanner</span>(registry);</span><br><span class="line">        scanner.scan(attrs.getStringArray(<span class="string">&quot;value&quot;</span>)); <span class="comment">// æ‰§è¡Œæ‰«æ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3. ClassPathMapperScanner æ‰«ææ¥å£</strong></p>
<p><code>ClassPathMapperScanner</code> ç»§æ‰¿è‡ª Spring çš„ <code>ClassPathBeanDefinitionScanner</code>ï¼Œè‡ªå®šä¹‰æ‰«æè§„åˆ™ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassPathMapperScanner</span> <span class="keyword">extends</span> <span class="title class_">ClassPathBeanDefinitionScanner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Set&lt;BeanDefinitionHolder&gt; <span class="title function_">doScan</span><span class="params">(String... basePackages)</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨çˆ¶ç±»æ‰«ææ–¹æ³•ï¼Œç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„æ¥å£</span></span><br><span class="line">        Set&lt;BeanDefinitionHolder&gt; beanDefinitions = <span class="built_in">super</span>.doScan(basePackages);</span><br><span class="line">        <span class="comment">// ä¸ºæ¯ä¸ªæ¥å£ç”Ÿæˆ BeanDefinitionï¼Œç»‘å®šåˆ° MapperFactoryBean</span></span><br><span class="line">        <span class="keyword">for</span> (BeanDefinitionHolder holder : beanDefinitions) &#123;</span><br><span class="line">            <span class="type">GenericBeanDefinition</span> <span class="variable">definition</span> <span class="operator">=</span> (GenericBeanDefinition) holder.getBeanDefinition();</span><br><span class="line">            <span class="comment">// è®¾ç½® Bean çš„å·¥å‚ç±»ä¸º MapperFactoryBean</span></span><br><span class="line">            definition.getConstructorArgumentValues().addGenericArgumentValue(definition.getBeanClassName());</span><br><span class="line">            definition.setBeanClass(MapperFactoryBean.class); <span class="comment">// å…³é”®ï¼šä»£ç†å·¥å‚</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> beanDefinitions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isCandidateComponent</span><span class="params">(AnnotatedBeanDefinition beanDefinition)</span> &#123;</span><br><span class="line">        <span class="comment">// ä»…é€‰æ‹©æ¥å£ä½œä¸ºå€™é€‰ç»„ä»¶ï¼ˆæ’é™¤ç±»ï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> beanDefinition.getMetadata().isInterface();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4. MapperFactoryBean åˆ›å»ºä»£ç†å¯¹è±¡</strong></p>
<p><code>MapperFactoryBean</code> æ˜¯ Spring çš„ <code>FactoryBean</code> å®ç°ï¼Œè´Ÿè´£ç”Ÿæˆ Mapper æ¥å£çš„ä»£ç†å®ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperFactoryBean</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">SqlSessionDaoSupport</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Class&lt;T&gt; mapperInterface;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// é€šè¿‡ SqlSession è·å– Mapper åŠ¨æ€ä»£ç†</span></span><br><span class="line">        <span class="keyword">return</span> getSqlSession().getMapper(<span class="built_in">this</span>.mapperInterface);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;T&gt; <span class="title function_">getObjectType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.mapperInterface;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>5. åŠ¨æ€ä»£ç†ä¸ SQL æ‰§è¡Œ</strong></p>
<p>MyBatis é€šè¿‡ <code>MapperProxy</code> ç”Ÿæˆæ¥å£çš„ JDK åŠ¨æ€ä»£ç†å¯¹è±¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperProxy</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span>, Serializable &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// å°†æ–¹æ³•è°ƒç”¨è½¬æ¢ä¸º MappedStatement æ‰§è¡Œ</span></span><br><span class="line">        <span class="type">MapperMethod</span> <span class="variable">mapperMethod</span> <span class="operator">=</span> cachedMapperMethod(method);</span><br><span class="line">        <span class="keyword">return</span> mapperMethod.execute(sqlSession, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>6. æ•´åˆ Spring å®¹å™¨</strong></p>
<ul>
<li><strong>SqlSessionTemplate æ³¨å…¥</strong>ï¼š<br>MyBatis-Spring é…ç½® <code>SqlSessionTemplate</code>ï¼ˆçº¿ç¨‹å®‰å…¨çš„ SqlSession å®ç°ï¼‰ï¼Œç”± Spring ç®¡ç†æ•°æ®åº“è¿æ¥å’Œäº‹åŠ¡ã€‚</li>
<li><strong>ä¾èµ–å…³ç³»</strong>ï¼š<br><code>MapperFactoryBean</code> ä¾èµ– <code>SqlSessionTemplate</code>ï¼Œç¡®ä¿æ‰€æœ‰ Mapper ä»£ç†ä½¿ç”¨åŒä¸€äº‹åŠ¡ä¸Šä¸‹æ–‡ã€‚</li>
</ul>
<p><strong>7. è‡ªåŠ¨é…ç½®ä¸ Spring Boot é›†æˆ</strong></p>
<p>åœ¨ Spring Boot ä¸­ï¼Œ<code>@MapperScan</code> é€šå¸¸ä¸è‡ªåŠ¨é…ç½®ç±» <code>MyBatisAutoConfiguration</code> é…åˆï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; SqlSessionFactory.class, SqlSessionFactoryBean.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactory</span><span class="params">(DataSource dataSource)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º SqlSessionFactory</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ€»ç»“æµç¨‹</strong></p>
<ol>
<li><strong>æ³¨è§£è§¦å‘</strong>ï¼š<code>@MapperScan</code> å¼•å…¥ <code>MapperScannerRegistrar</code>ã€‚</li>
<li><strong>åŠ¨æ€æ³¨å†Œ</strong>ï¼š<code>MapperScannerRegistrar</code> ä½¿ç”¨ <code>ClassPathMapperScanner</code> æ‰«ææŒ‡å®šåŒ…ä¸‹çš„æ¥å£ã€‚</li>
<li><strong>Bean å®šä¹‰ç”Ÿæˆ</strong>ï¼šä¸ºæ¯ä¸ª Mapper æ¥å£åˆ›å»ºç»‘å®šåˆ° <code>MapperFactoryBean</code> çš„ Bean å®šä¹‰ã€‚</li>
<li><strong>ä»£ç†å®ä¾‹åŒ–</strong>ï¼šSpring å®¹å™¨å®ä¾‹åŒ–æ—¶ï¼Œ<code>MapperFactoryBean</code> é€šè¿‡ <code>SqlSessionTemplate</code> åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡ã€‚</li>
<li><strong>æ–¹æ³•æ‹¦æˆª</strong>ï¼šè°ƒç”¨ Mapper æ–¹æ³•æ—¶ï¼Œä»£ç†å¯¹è±¡å°†è¯·æ±‚è½¬å‘ç»™ MyBatis æ‰§è¡Œ SQLã€‚</li>
</ol>
<p><strong>å…³é”®è®¾è®¡ç‚¹</strong></p>
<ul>
<li><strong>è§£è€¦ä¸æ‰©å±•</strong>ï¼šé€šè¿‡ Spring çš„ <code>FactoryBean</code> å’Œ <code>ImportBeanDefinitionRegistrar</code> å®ç°æ— ç¼æ•´åˆã€‚</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šåŠ¨æ€ä»£ç†å’Œç¼“å­˜æœºåˆ¶ï¼ˆå¦‚ <code>MapperMethod</code> ç¼“å­˜ï¼‰å‡å°‘åå°„å¼€é”€ã€‚</li>
<li><strong>äº‹åŠ¡ä¸€è‡´æ€§</strong>ï¼šä¾èµ– Spring ç®¡ç†çš„äº‹åŠ¡ï¼Œç¡®ä¿ Mapper æ“ä½œåœ¨åŒä¸€ä¸ª <code>SqlSession</code> ä¸­æ‰§è¡Œã€‚</li>
</ul>
<p>é€šè¿‡ <code>@MapperScan</code>ï¼Œå¼€å‘è€…æ— éœ€æ‰‹åŠ¨é…ç½®æ¯ä¸ª Mapperï¼Œæ¡†æ¶è‡ªåŠ¨å®Œæˆæ¥å£åˆ° Bean çš„æ˜ å°„åŠä»£ç†ç”Ÿæˆï¼Œæå¤§ç®€åŒ–äº† MyBatis åœ¨ Spring ä¸­çš„ä½¿ç”¨ã€‚</p>
<h3 id="Autowired-çš„å®ç°åŸç†"><a href="#Autowired-çš„å®ç°åŸç†" class="headerlink" title="@Autowired çš„å®ç°åŸç†"></a><code>@Autowired</code> çš„å®ç°åŸç†</h3><p><code>@Autowired</code> æ˜¯ Spring æ¡†æ¶ä¸­å®ç°ä¾èµ–æ³¨å…¥çš„æ ¸å¿ƒæ³¨è§£ï¼Œå…¶åº•å±‚åŸç†åŸºäº <strong>Bean ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ã€<strong>åå°„æœºåˆ¶</strong> å’Œ <strong>BeanPostProcessor</strong> çš„åä½œã€‚ä»¥ä¸‹æ˜¯å…¶å®ç°åŸç†çš„è¯¦ç»†åˆ†æï¼š</p>
<p><strong>1. æ ¸å¿ƒæµç¨‹</strong></p>
<p><code>@Autowired</code> çš„ä¾èµ–æ³¨å…¥å‘ç”Ÿåœ¨ Bean çš„å®ä¾‹åŒ–é˜¶æ®µï¼ˆå±æ€§å¡«å……é˜¶æ®µï¼‰ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p><strong>1.1 Bean å®ä¾‹åŒ–</strong></p>
<p>Spring å®¹å™¨é€šè¿‡åå°„è°ƒç”¨æ„é€ å‡½æ•°åˆ›å»º Bean å®ä¾‹ï¼ˆè‹¥å­˜åœ¨å¤šä¸ªæ„é€ å‡½æ•°ï¼Œä¼˜å…ˆé€‰æ‹©æ— å‚æ„é€ å‡½æ•°ï¼Œæˆ–æ ‡è®° <code>@Autowired</code> çš„æ„é€ å‡½æ•°ï¼‰ã€‚</p>
<p><strong>1.2 å±æ€§å¡«å……ï¼ˆä¾èµ–æ³¨å…¥ï¼‰</strong></p>
<ul>
<li><strong>è§¦å‘æ—¶æœº</strong>ï¼šåœ¨ <code>AbstractAutowireCapableBeanFactory</code> çš„ <code>populateBean()</code> æ–¹æ³•ä¸­ã€‚</li>
<li><strong>å¤„ç†ç»„ä»¶</strong>ï¼š<code>AutowiredAnnotationBeanPostProcessor</code>ï¼ˆç»§æ‰¿è‡ª <code>BeanPostProcessor</code>ï¼‰ã€‚</li>
</ul>
<p><strong>1.3 ä¾èµ–è§£æä¸æ³¨å…¥</strong></p>
<ol>
<li><strong>æ‰«ææ³¨è§£</strong>ï¼š<br>é€šè¿‡åå°„æ£€æŸ¥ Bean çš„å­—æ®µã€æ–¹æ³•å’Œæ„é€ å‡½æ•°ä¸Šçš„ <code>@Autowired</code> æ³¨è§£ã€‚</li>
<li><strong>è§£æä¾èµ–</strong>ï¼š<ul>
<li><strong>æŒ‰ç±»å‹åŒ¹é…</strong>ï¼šæŸ¥æ‰¾ä¸ä¾èµ–ç±»å‹åŒ¹é…çš„å€™é€‰ Beanã€‚</li>
<li><strong>æŒ‰åç§°åŒ¹é…</strong>ï¼šè‹¥å­˜åœ¨å¤šä¸ªåŒç±»å‹ Beanï¼ŒæŒ‰å­—æ®µ&#x2F;æ–¹æ³•å‚æ•°åç§°åŒ¹é…ï¼ˆéœ€ç»“åˆ <code>@Qualifier</code> æˆ– <code>@Primary</code> è§£å†³æ­§ä¹‰ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>æ³¨å…¥ä¾èµ–</strong>ï¼š<ul>
<li><strong>å­—æ®µæ³¨å…¥</strong>ï¼šé€šè¿‡åå°„ <code>Field.setAccessible(true)</code> è®¾ç½®ç§æœ‰å­—æ®µå€¼ã€‚</li>
<li><strong>æ–¹æ³•æ³¨å…¥</strong>ï¼šåå°„è°ƒç”¨ Setter æ–¹æ³•ã€‚</li>
<li><strong>æ„é€ å‡½æ•°æ³¨å…¥</strong>ï¼šåœ¨å®ä¾‹åŒ–æ—¶é€šè¿‡æ„é€ å‡½æ•°å‚æ•°æ³¨å…¥ã€‚</li>
</ul>
</li>
</ol>
<p><strong>2. å…³é”®ç»„ä»¶è§£æ</strong></p>
<p><strong>2.1 AutowiredAnnotationBeanPostProcessor</strong></p>
<p>Spring å†…ç½®çš„ <code>BeanPostProcessor</code>ï¼Œè´Ÿè´£å¤„ç† <code>@Autowired</code> å’Œ <code>@Value</code> æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutowiredAnnotationBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span>, MergedBeanDefinitionPostProcessor &#123;</span><br><span class="line">    <span class="comment">// å­˜å‚¨å¾…æ³¨å…¥çš„å…ƒæ•°æ®ï¼ˆå­—æ®µã€æ–¹æ³•ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InjectionMetadata metadata;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PropertyValues <span class="title function_">postProcessProperties</span><span class="params">(PropertyValues pvs, Object bean, String beanName)</span> &#123;</span><br><span class="line">        <span class="comment">// æŸ¥æ‰¾å¹¶æ³¨å…¥ä¾èµ–</span></span><br><span class="line">        <span class="type">InjectionMetadata</span> <span class="variable">metadata</span> <span class="operator">=</span> findAutowiringMetadata(bean.getClass());</span><br><span class="line">        metadata.inject(bean, beanName, pvs);</span><br><span class="line">        <span class="keyword">return</span> pvs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2.2 ä¾èµ–è§£ææµç¨‹</strong></p>
<p>åœ¨ <code>DefaultListableBeanFactory</code> ä¸­è§£æä¾èµ–ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">resolveDependency</span><span class="params">(DependencyDescriptor descriptor, String beanName, Set&lt;String&gt; autowiredBeanNames, TypeConverter typeConverter)</span> &#123;</span><br><span class="line">    <span class="comment">// æŒ‰ç±»å‹è·å–å€™é€‰ Bean åç§°</span></span><br><span class="line">    String[] candidateNames = findAutowireCandidates(beanName, type, descriptor);</span><br><span class="line">    <span class="comment">// ç­›é€‰å”¯ä¸€å€™é€‰ Bean</span></span><br><span class="line">    <span class="keyword">if</span> (candidateNames.length == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> getBean(candidateNames[<span class="number">0</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (candidateNames.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// æŒ‰åç§°æˆ– @Primary/@Priority è§£å†³å†²çª</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">primaryCandidate</span> <span class="operator">=</span> determinePrimaryCandidate(candidateNames);</span><br><span class="line">        <span class="keyword">return</span> primaryCandidate != <span class="literal">null</span> ? primaryCandidate : determineHighestPriorityCandidate(candidateNames);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æŠ›å‡º NoUniqueBeanDefinitionException å¼‚å¸¸</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3. æ³¨å…¥æ–¹å¼ä¸ä¼˜å…ˆçº§</strong></p>
<p><strong>3.1 æ„é€ å‡½æ•°æ³¨å…¥</strong></p>
<ul>
<li><p><strong>è§¦å‘æ¡ä»¶</strong>ï¼šè‹¥ç±»ä¸­å­˜åœ¨å”¯ä¸€æ„é€ å‡½æ•°ï¼Œæˆ–æ„é€ å‡½æ•°æ ‡è®°äº† <code>@Autowired</code>ã€‚</p>
</li>
<li><p><strong>ä¼˜åŠ¿</strong>ï¼šä¿è¯ä¾èµ–ä¸å¯å˜ï¼Œç¬¦åˆä¸å¯å˜å¯¹è±¡è®¾è®¡ã€‚</p>
</li>
<li><p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(UserRepository userRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userRepository = userRepository;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>3.2 Setter æ–¹æ³•æ³¨å…¥</strong></p>
<ul>
<li><p><strong>è§¦å‘æ¡ä»¶</strong>ï¼šSetter æ–¹æ³•æ ‡è®° <code>@Autowired</code>ã€‚</p>
</li>
<li><p><strong>ä¼˜åŠ¿</strong>ï¼šå…è®¸å¯é€‰ä¾èµ–æˆ–åŠ¨æ€æ›´æ–°ä¾èµ–ã€‚</p>
</li>
<li><p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPaymentService</span><span class="params">(PaymentService paymentService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.paymentService = paymentService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>3.3 å­—æ®µæ³¨å…¥</strong></p>
<ul>
<li><p><strong>è§¦å‘æ¡ä»¶</strong>ï¼šå­—æ®µç›´æ¥æ ‡è®° <code>@Autowired</code>ã€‚</p>
</li>
<li><p><strong>åŠ£åŠ¿</strong>ï¼šéš¾ä»¥å®ç°ä¸å¯å˜æ€§ï¼Œæµ‹è¯•æ—¶éœ€é€šè¿‡åå°„æ³¨å…¥ã€‚</p>
</li>
<li><p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> InventoryService inventoryService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>4. è§£å†³ä¾èµ–å†²çª</strong></p>
<p><strong>4.1 @Qualifier</strong></p>
<p>é€šè¿‡åç§°æŒ‡å®šæ³¨å…¥çš„ Beanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;mysqlDataSource&quot;)</span></span><br><span class="line"><span class="keyword">private</span> DataSource dataSource;</span><br></pre></td></tr></table></figure>

<p><strong>4.2 @Primary</strong></p>
<p>æ ‡è®°ä¼˜å…ˆé€‰æ‹©çš„ Beanï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> DataSource <span class="title function_">primaryDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HikariDataSource</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4.3 è‡ªå®šä¹‰é™å®šç¬¦</strong></p>
<p>ç»“åˆè‡ªå®šä¹‰æ³¨è§£ä¸ <code>@Qualifier</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.PARAMETER&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Qualifier</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MysqlDatabase &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@MysqlDatabase</span></span><br><span class="line"><span class="keyword">private</span> DataSource dataSource;</span><br></pre></td></tr></table></figure>

<p><strong>5. æºç çº§å…³é”®é€»è¾‘</strong></p>
<p><strong>5.1 å­—æ®µæ³¨å…¥å®ç°</strong></p>
<p>åå°„è®¾ç½®å­—æ®µå€¼ï¼ˆç®€åŒ–ä»£ç ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> bean.getClass().getDeclaredField(<span class="string">&quot;userRepository&quot;</span>);</span><br><span class="line">field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">field.set(bean, userRepository);</span><br></pre></td></tr></table></figure>

<p><strong>5.2 æ–¹æ³•æ³¨å…¥å®ç°</strong></p>
<p>åå°„è°ƒç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> bean.getClass().getMethod(<span class="string">&quot;setUserRepository&quot;</span>, UserRepository.class);</span><br><span class="line">method.invoke(bean, userRepository);</span><br></pre></td></tr></table></figure>

<p><strong>6. æ€»ç»“ä¸æœ€ä½³å®è·µ</strong></p>
<ul>
<li><strong>åŸç†æœ¬è´¨</strong>ï¼š<code>@Autowired</code> é€šè¿‡ <code>BeanPostProcessor</code> åœ¨ Bean ç”Ÿå‘½å‘¨æœŸä¸­åŠ¨æ€è§£æå¹¶æ³¨å…¥ä¾èµ–ã€‚</li>
<li><strong>æ¨èæ–¹å¼</strong>ï¼šä¼˜å…ˆä½¿ç”¨ <strong>æ„é€ å‡½æ•°æ³¨å…¥</strong> ä¿è¯ä¾èµ–ä¸å¯å˜ã€‚</li>
<li><strong>é¿å…é™·é˜±</strong>ï¼š<ul>
<li><strong>å¾ªç¯ä¾èµ–</strong>ï¼šé¿å… A ä¾èµ– Bï¼ŒB åˆä¾èµ– Aï¼Œå¯é€šè¿‡ <code>@Lazy</code> å»¶è¿ŸåŠ è½½è§£å†³ã€‚</li>
<li><strong>å¤šå®ä¾‹å†²çª</strong>ï¼šä½¿ç”¨ <code>@Qualifier</code> æˆ– <code>@Primary</code> æ˜ç¡®æŒ‡å®š Beanã€‚</li>
</ul>
</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šåå°„æ“ä½œæœ‰ä¸€å®šå¼€é”€ï¼Œä½† Spring é€šè¿‡ç¼“å­˜å…ƒæ•°æ®ï¼ˆå¦‚ <code>InjectionMetadata</code>ï¼‰å‡å°‘é‡å¤è§£æã€‚</li>
</ul>
<h3 id="SpringMVC-å·¥ä½œæµç¨‹"><a href="#SpringMVC-å·¥ä½œæµç¨‹" class="headerlink" title="SpringMVC å·¥ä½œæµç¨‹"></a>SpringMVC å·¥ä½œæµç¨‹</h3><p><strong>æ ¸å¿ƒç»„ä»¶</strong></p>
<ol>
<li><strong>DispatcherServlet</strong>ï¼šå‰ç½®æ§åˆ¶å™¨ï¼Œæ˜¯æ•´ä¸ªæµç¨‹æ§åˆ¶çš„<strong>æ ¸å¿ƒ</strong>ï¼Œæ§åˆ¶å…¶ä»–ç»„ä»¶çš„æ‰§è¡Œï¼Œè¿›è¡Œç»Ÿä¸€è°ƒåº¦ï¼Œé™ä½ç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ï¼Œç›¸å½“äºæ€»æŒ‡æŒ¥ã€‚</li>
<li><strong>Handler</strong>ï¼šå¤„ç†å™¨ï¼Œå®Œæˆå…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼Œç›¸å½“äº Servlet æˆ– Actionã€‚</li>
<li><strong>HandlerMapping</strong>ï¼šDispatcherServlet æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œé€šè¿‡ HandlerMapping å°†ä¸åŒçš„è¯·æ±‚æ˜ å°„åˆ°ä¸åŒçš„ Handlerã€‚</li>
<li><strong>HandlerInterceptor</strong>ï¼šå¤„ç†å™¨æ‹¦æˆªå™¨ï¼Œæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¦‚æœéœ€è¦å®Œæˆä¸€äº›æ‹¦æˆªå¤„ç†ï¼Œå¯ä»¥å®ç°è¯¥æ¥å£ã€‚</li>
<li><strong>HandlerExecutionChain</strong>ï¼šå¤„ç†å™¨æ‰§è¡Œé“¾ï¼ŒåŒ…æ‹¬ä¸¤éƒ¨åˆ†å†…å®¹ï¼šHandler å’Œ HandlerInterceptorï¼ˆç³»ç»Ÿä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ HandlerInterceptorï¼Œå¦‚æœéœ€è¦é¢å¤–è®¾ç½®æ‹¦æˆªï¼Œå¯ä»¥æ·»åŠ æ‹¦æˆªå™¨ï¼‰ã€‚</li>
<li><strong>HandlerAdapter</strong>ï¼šå¤„ç†å™¨é€‚é…å™¨ï¼ŒHandler æ‰§è¡Œä¸šåŠ¡æ–¹æ³•ä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼ŒåŒ…æ‹¬è¡¨å•æ•°æ®çš„éªŒè¯ã€æ•°æ®ç±»å‹çš„è½¬æ¢ã€å°†è¡¨å•æ•°æ®å°è£…åˆ° JavaBean ç­‰ï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯ç”± HandlerApater æ¥å®Œæˆï¼Œå¼€å‘è€…åªéœ€å°†æ³¨æ„åŠ›é›†ä¸­ä¸šåŠ¡é€»è¾‘çš„å¤„ç†ä¸Šï¼ŒDispatcherServlet é€šè¿‡ HandlerAdapter æ‰§è¡Œä¸åŒçš„ Handlerã€‚</li>
<li><strong>ModelAndView</strong>ï¼šè£…è½½äº†æ¨¡å‹æ•°æ®å’Œè§†å›¾ä¿¡æ¯ï¼Œä½œä¸º Handler çš„å¤„ç†ç»“æœï¼Œè¿”å›ç»™ DispatcherServletã€‚</li>
<li><strong>ViewResolver</strong>ï¼šè§†å›¾è§£æå™¨ï¼ŒDispatcheServlet é€šè¿‡å®ƒå°†é€»è¾‘è§†å›¾è§£æä¸ºç‰©ç†è§†å›¾ï¼Œæœ€ç»ˆå°†æ¸²æŸ“ç»“æœå“åº”ç»™å®¢æˆ·ç«¯ã€‚</li>
</ol>
<p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-e29a122b-db07-48b8-8289-7251032e87a1.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring MVCçš„å·¥ä½œæµç¨‹"></p>
<h3 id="AOP-å“ªäº›æƒ…å†µä¸‹ä¼šå¤±æ•ˆ"><a href="#AOP-å“ªäº›æƒ…å†µä¸‹ä¼šå¤±æ•ˆ" class="headerlink" title="AOP å“ªäº›æƒ…å†µä¸‹ä¼šå¤±æ•ˆ"></a>AOP å“ªäº›æƒ…å†µä¸‹ä¼šå¤±æ•ˆ</h3><p><strong>AOP ç”Ÿæ•ˆçš„å…³é”®æ¡ä»¶</strong></p>
<table>
<thead>
<tr>
<th align="left">æ¡ä»¶</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ç›®æ ‡å¯¹è±¡æ˜¯ Spring Bean</td>
<td align="left">éœ€é€šè¿‡å®¹å™¨è·å–å®ä¾‹</td>
</tr>
<tr>
<td align="left">æ–¹æ³•éœ€ä¸º public</td>
<td align="left">é public æ–¹æ³•æ— æ³•è¢«ä»£ç†</td>
</tr>
<tr>
<td align="left">é¿å…ç±»å†…éƒ¨è‡ªè°ƒç”¨</td>
<td align="left">å¿…é¡»é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•</td>
</tr>
<tr>
<td align="left">é final ç±»&#x2F;æ–¹æ³•</td>
<td align="left">CGLIB è¦æ±‚æ–¹æ³•å¯è¢«é‡å†™</td>
</tr>
<tr>
<td align="left">æ­£ç¡®é…ç½®åˆ‡ç‚¹</td>
<td align="left">è¡¨è¾¾å¼éœ€åŒ¹é…åˆ°ç›®æ ‡æ–¹æ³•</td>
</tr>
</tbody></table>
<h3 id="SpringBootè‡ªåŠ¨è£…é…åŸç†"><a href="#SpringBootè‡ªåŠ¨è£…é…åŸç†" class="headerlink" title="SpringBootè‡ªåŠ¨è£…é…åŸç†"></a>SpringBootè‡ªåŠ¨è£…é…åŸç†</h3><p>Spring Boot çš„è‡ªåŠ¨è£…é…æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼Œå®ƒæå¤§åœ°ç®€åŒ–äº† Spring åº”ç”¨çš„é…ç½®è¿‡ç¨‹ï¼Œéµå¾ªâ€œ<strong>çº¦å®šå¤§äºé…ç½®</strong>â€çš„ç†å¿µã€‚å…¶æ ¸å¿ƒåŸç†å¯ä»¥åˆ†è§£ä¸ºä»¥ä¸‹å‡ ä¸ªå…³é”®ç‚¹ï¼š</p>
<ol>
<li><strong><code>@SpringBootApplication</code> æ³¨è§£ï¼š</strong><ul>
<li>è¿™æ˜¯ Spring Boot åº”ç”¨çš„å…¥å£æ³¨è§£ï¼Œæ ‡æ³¨åœ¨ä¸»å¯åŠ¨ç±»ä¸Šã€‚</li>
<li>å®ƒæ˜¯ä¸€ä¸ª<strong>ç»„åˆæ³¨è§£</strong>ï¼ŒåŒ…å«äº†ä¸‰ä¸ªæ ¸å¿ƒæ³¨è§£ï¼š<ul>
<li><code>@SpringBootConfiguration</code>: è¡¨æ˜è¯¥ç±»æ˜¯ä¸€ä¸ª Spring Boot çš„é…ç½®ç±»ï¼ˆæœ¬è´¨ä¸Šæ˜¯ <code>@Configuration</code>ï¼‰ã€‚</li>
<li><code>@EnableAutoConfiguration</code>: <strong>å¼€å¯è‡ªåŠ¨è£…é…çš„æ ¸å¿ƒæ³¨è§£</strong>ã€‚</li>
<li><code>@ComponentScan</code>: å¼€å¯ç»„ä»¶æ‰«æï¼Œé»˜è®¤æ‰«æä¸»é…ç½®ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ä¸‹çš„ <code>@Component</code>, <code>@Service</code>, <code>@Repository</code>, <code>@Controller</code> ç­‰æ³¨è§£çš„ç±»ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><strong><code>@EnableAutoConfiguration</code> çš„æ ¸å¿ƒä½œç”¨ï¼š</strong><ul>
<li>è¿™ä¸ªæ³¨è§£é€šè¿‡ <code>@Import(AutoConfigurationImportSelector.class)</code> å¯¼å…¥äº† <code>AutoConfigurationImportSelector</code>ã€‚</li>
<li><strong><code>AutoConfigurationImportSelector</code> æ˜¯è‡ªåŠ¨è£…é…çš„å…³é”®å¼•æ“ï¼š</strong><ul>
<li>å®ƒå®ç°äº† <code>DeferredImportSelector</code> æ¥å£ï¼Œåœ¨ Spring å®¹å™¨å¤„ç†å®Œæ‰€æœ‰å¸¸è§„çš„ <code>@Configuration</code> ç±»ä¹‹åæ‰ä¼šæ‰§è¡Œã€‚</li>
<li>å®ƒçš„æ ¸å¿ƒæ–¹æ³•æ˜¯ <code>selectImports()</code>ã€‚è¿™ä¸ªæ–¹æ³•è´Ÿè´£<strong>å†³å®šéœ€è¦å¯¼å…¥å“ªäº›è‡ªåŠ¨é…ç½®ç±»</strong>ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><strong><code>spring.factories</code> &#x2F; <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>ï¼ˆæ–°æ–¹å¼ï¼‰ï¼š</strong><ul>
<li><code>AutoConfigurationImportSelector</code> ä¼šå»<strong>ç±»è·¯å¾„ä¸‹æŸ¥æ‰¾ä¸€ä¸ªç‰¹å®šçš„æ–‡ä»¶</strong>æ¥è·å–æ‰€æœ‰å€™é€‰çš„è‡ªåŠ¨é…ç½®ç±»å…¨é™å®šåã€‚</li>
<li><strong>Spring Boot 2.7 ä¹‹å‰ï¼š</strong> æŸ¥æ‰¾ <code>META-INF/spring.factories</code> æ–‡ä»¶ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæœ‰ä¸€ä¸ªé”®ä¸º <code>org.springframework.boot.autoconfigure.EnableAutoConfiguration</code> çš„å±æ€§ï¼Œå…¶å€¼æ˜¯ä¸€ä¸ª<strong>é€—å·åˆ†éš”</strong>çš„è‡ªåŠ¨é…ç½®ç±»å…¨é™å®šååˆ—è¡¨ã€‚</li>
<li><strong>Spring Boot 2.7 åŠä¹‹åï¼š</strong> æ¨èä½¿ç”¨ <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code> æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶<strong>æ¯è¡Œå†™ä¸€ä¸ª</strong>è‡ªåŠ¨é…ç½®ç±»çš„å…¨é™å®šåã€‚è¿™æ˜¯ä¸ºäº†æ›´å¥½çš„ IDE æ”¯æŒå’Œå·¥å…·é“¾å…¼å®¹æ€§ï¼ˆå¦‚ GraalVM Native Imageï¼‰ã€‚Spring Boot ä»ç„¶å…¼å®¹ <code>spring.factories</code>ï¼Œä½†æ–°é¡¹ç›®å»ºè®®ä½¿ç”¨æ–°æ–¹å¼ã€‚</li>
<li><strong>æ¥æºï¼š</strong> è¿™äº›æ–‡ä»¶é€šå¸¸å­˜åœ¨äº <code>spring-boot-autoconfigure</code> jar åŒ…ä»¥åŠä½ å¼•å…¥çš„å„ç§ <code>starter</code> jar åŒ…ï¼ˆå¦‚ <code>spring-boot-starter-web</code>, <code>spring-boot-starter-data-jpa</code>ï¼‰ä¸­ã€‚æ¯ä¸ª <code>starter</code> é€šè¿‡æä¾›è‡ªå·±çš„ <code>spring.factories</code> æˆ– <code>AutoConfiguration.imports</code> æ–‡ä»¶æ¥å£°æ˜å®ƒéœ€è¦å“ªäº›è‡ªåŠ¨é…ç½®ã€‚</li>
</ul>
</li>
<li><strong>è‡ªåŠ¨é…ç½®ç±» (<code>@Configuration</code>)ï¼š</strong><ul>
<li>é€šè¿‡ä¸Šè¿°æœºåˆ¶æ‰¾åˆ°çš„å€™é€‰ç±»éƒ½æ˜¯æ ‡æœ‰ <code>@Configuration</code> æ³¨è§£çš„ Spring é…ç½®ç±»ã€‚</li>
<li>è¿™äº›é…ç½®ç±»å†…éƒ¨ä½¿ç”¨ <code>@Bean</code> æ³¨è§£å®šä¹‰äº†å¤§é‡<strong>æ¡ä»¶åŒ–</strong>çš„ Beanã€‚è¿™äº› Bean é€šå¸¸æ˜¯æ¡†æ¶æˆ–åº“çš„æ ¸å¿ƒç»„ä»¶ï¼ˆå¦‚ <code>DataSource</code>, <code>EntityManagerFactory</code>, <code>RestTemplate</code>, <code>DispatcherServlet</code> ç­‰ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>æ¡ä»¶æ³¨è§£ (<code>@Conditional</code> åŠå…¶è¡ç”Ÿæ³¨è§£)ï¼š</strong><ul>
<li>è¿™æ˜¯è‡ªåŠ¨è£…é…<strong>æ™ºèƒ½æ€§</strong>çš„å…³é”®ï¼è‡ªåŠ¨é…ç½®ç±»åŠå…¶å†…éƒ¨çš„ <code>@Bean</code> æ–¹æ³•ä¸Šä¼šå¤§é‡ä½¿ç”¨æ¡ä»¶æ³¨è§£ã€‚</li>
<li>è¿™äº›æ³¨è§£æ§åˆ¶ç€é…ç½®ç±»å’Œ Bean <strong>æ˜¯å¦ä¼šè¢«çœŸæ­£åŠ è½½å’Œåˆ›å»º</strong>ã€‚å¸¸è§çš„æ¡ä»¶æ³¨è§£æœ‰ï¼š<ul>
<li><code>@ConditionalOnClass</code>: å½“ç±»è·¯å¾„ä¸­å­˜åœ¨æŒ‡å®šçš„ç±»æ—¶æ‰ç”Ÿæ•ˆã€‚</li>
<li><code>@ConditionalOnMissingClass</code>: å½“ç±»è·¯å¾„ä¸­ä¸å­˜åœ¨æŒ‡å®šçš„ç±»æ—¶æ‰ç”Ÿæ•ˆã€‚</li>
<li><code>@ConditionalOnBean</code>: å½“å®¹å™¨ä¸­å­˜åœ¨æŒ‡å®šçš„ Bean æ—¶æ‰ç”Ÿæ•ˆã€‚</li>
<li><code>@ConditionalOnMissingBean</code>: å½“å®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šçš„ Bean æ—¶æ‰ç”Ÿæ•ˆã€‚<strong>è¿™æ˜¯å…è®¸ç”¨æˆ·è‡ªå®šä¹‰ Bean è¦†ç›–é»˜è®¤é…ç½®çš„å…³é”®ï¼</strong></li>
<li><code>@ConditionalOnProperty</code>: å½“æŒ‡å®šçš„é…ç½®å±æ€§æ»¡è¶³ç‰¹å®šæ¡ä»¶ï¼ˆå¦‚å­˜åœ¨ã€ç­‰äºæŸä¸ªå€¼ï¼‰æ—¶æ‰ç”Ÿæ•ˆã€‚</li>
<li><code>@ConditionalOnWebApplication</code> &#x2F; <code>@ConditionalOnNotWebApplication</code>: æ ¹æ®åº”ç”¨æ˜¯å¦æ˜¯ Web åº”ç”¨æ¥å†³å®šã€‚</li>
<li><code>@ConditionalOnResource</code>: å½“æŒ‡å®šçš„èµ„æºæ–‡ä»¶å­˜åœ¨æ—¶æ‰ç”Ÿæ•ˆã€‚</li>
<li><code>@ConditionalOnJava</code>: å½“è¿è¡Œåœ¨æŒ‡å®šçš„ Java ç‰ˆæœ¬ä¸Šæ—¶æ‰ç”Ÿæ•ˆã€‚</li>
</ul>
</li>
<li><strong>è¿‡ç¨‹ï¼š</strong> Spring Boot åœ¨å¯åŠ¨æ—¶ï¼Œä¼š<strong>æŒ‰é¡ºåºåŠ è½½</strong>æ‰€æœ‰å€™é€‰çš„è‡ªåŠ¨é…ç½®ç±»ã€‚å¯¹äºæ¯ä¸ªé…ç½®ç±»å’Œå…¶ä¸­çš„æ¯ä¸ª <code>@Bean</code> æ–¹æ³•ï¼ŒSpring Boot ä¼š<strong>è¯„ä¼°å…¶ä¸Šçš„æ¡ä»¶æ³¨è§£</strong>ã€‚åªæœ‰å½“æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³æ—¶ï¼Œè¿™ä¸ªé…ç½®ç±»æˆ– Bean å®šä¹‰æ‰ä¼šè¢«çœŸæ­£å¤„ç†å¹¶åŠ å…¥åˆ° Spring å®¹å™¨ä¸­ã€‚</li>
</ul>
</li>
<li><strong>è‡ªåŠ¨é…ç½®å…ƒæ•°æ® (<code>spring-autoconfigure-metadata.properties</code>)ï¼š</strong><ul>
<li>ä¸ºäº†<strong>æé«˜å¯åŠ¨æ€§èƒ½</strong>ï¼ˆé¿å…é€šè¿‡åå°„åŠ è½½å’Œè§£æå¤§é‡ä¸æ»¡è¶³æ¡ä»¶çš„é…ç½®ç±»ï¼‰ï¼ŒSpring Boot åœ¨ç¼–è¯‘æ—¶ä¼šä¸ºè‡ªåŠ¨é…ç½®æ¨¡å—ç”Ÿæˆä¸€ä¸ª <code>META-INF/spring-autoconfigure-metadata.properties</code> æ–‡ä»¶ã€‚</li>
<li>è¿™ä¸ªæ–‡ä»¶é¢„å…ˆå­˜å‚¨äº†æ‰€æœ‰è‡ªåŠ¨é…ç½®ç±»ä¸Šçš„<strong>æ¡ä»¶ä¿¡æ¯</strong>ï¼ˆå¦‚ <code>@ConditionalOnClass</code> è¦æ±‚çš„ç±»ï¼‰ã€‚</li>
<li>åœ¨å¯åŠ¨çš„æ—©æœŸé˜¶æ®µï¼Œ<code>AutoConfigurationImportSelector</code> ä¼šé¦–å…ˆè¯»å–è¿™ä¸ªå…ƒæ•°æ®æ–‡ä»¶ï¼Œ<strong>å¿«é€Ÿè¿‡æ»¤æ‰ä¸€å¤§æ‰¹æ˜æ˜¾ä¸æ»¡è¶³æ¡ä»¶</strong>ï¼ˆä¾‹å¦‚ï¼Œç±»è·¯å¾„ä¸Šæ ¹æœ¬æ²¡æœ‰æ‰€éœ€ä¾èµ–çš„ç±»ï¼‰çš„è‡ªåŠ¨é…ç½®ç±»ã€‚åªæœ‰é€šè¿‡å…ƒæ•°æ®åˆæ­¥ç­›é€‰çš„é…ç½®ç±»æ‰ä¼šè¢«çœŸæ­£åŠ è½½å’Œè§£æï¼Œå¤§å¤§å‡å°‘äº†ç±»åŠ è½½å’Œæ¡ä»¶è¯„ä¼°çš„å¼€é”€ã€‚</li>
</ul>
</li>
</ol>
<p><strong>æ€»ç»“æµç¨‹ï¼š</strong></p>
<ol>
<li>å¯åŠ¨ <code>main</code> æ–¹æ³•ï¼ŒåŠ è½½æ ‡æ³¨äº† <code>@SpringBootApplication</code> çš„ä¸»ç±»ã€‚</li>
<li><code>@SpringBootApplication</code> ä¸­çš„ <code>@EnableAutoConfiguration</code> æ¿€æ´»è‡ªåŠ¨è£…é…ã€‚</li>
<li><code>@EnableAutoConfiguration</code> é€šè¿‡ <code>@Import</code> å¼•å…¥ <code>AutoConfigurationImportSelector</code>ã€‚</li>
<li><code>AutoConfigurationImportSelector</code> åœ¨é€‚å½“çš„æ—¶å€™æ‰§è¡Œï¼š<ul>
<li>è¯»å– <code>spring-autoconfigure-metadata.properties</code> è¿›è¡Œ<strong>å¿«é€Ÿè¿‡æ»¤</strong>ã€‚</li>
<li>è¯»å– <code>META-INF/spring.factories</code> æˆ– <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code> æ–‡ä»¶ï¼Œè·å–<strong>æ‰€æœ‰å€™é€‰è‡ªåŠ¨é…ç½®ç±»</strong>çš„å…¨ååˆ—è¡¨ã€‚</li>
<li><strong>åº”ç”¨è‡ªåŠ¨é…ç½®å…ƒæ•°æ®è¿‡æ»¤å™¨</strong>ï¼Œå‰”é™¤æ˜æ˜¾ä¸æ»¡è¶³æ¡ä»¶çš„å€™é€‰ç±»ã€‚</li>
</ul>
</li>
<li>éå†å‰©ä¸‹çš„å€™é€‰è‡ªåŠ¨é…ç½®ç±»ï¼š<ul>
<li>ä½¿ç”¨åå°„åŠ è½½ç±»ã€‚</li>
<li><strong>è¯¦ç»†è¯„ä¼°ç±»ä¸Šçš„ <code>@Conditional</code> åŠå…¶è¡ç”Ÿæ³¨è§£</strong>ã€‚</li>
<li>å¦‚æœç±»çº§åˆ«çš„æ¡ä»¶æ»¡è¶³ï¼Œåˆ™å°†è¯¥é…ç½®ç±»ä½œä¸ºä¸€ä¸ª <code>@Configuration</code> ç±»å¤„ç†ã€‚</li>
<li>å¤„ç†é…ç½®ç±»å†…éƒ¨çš„ <code>@Bean</code> æ–¹æ³•ï¼ŒåŒæ ·è¯„ä¼°æ–¹æ³•ä¸Šçš„æ¡ä»¶æ³¨è§£ï¼Œæ»¡è¶³æ¡ä»¶çš„æ‰æ³¨å†Œä¸º Beanã€‚</li>
</ul>
</li>
<li>æœ€ç»ˆï¼Œæ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è‡ªåŠ¨é…ç½®ç±»ä¸­å®šä¹‰çš„ Bean è¢«æ³¨å†Œåˆ° Spring IoC å®¹å™¨ä¸­ï¼Œåº”ç”¨å°±æ‹¥æœ‰äº†æ‰€éœ€çš„åŸºç¡€è®¾æ–½ Beanã€‚</li>
</ol>
<p><strong>å…³é”®ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>ç®€åŒ–é…ç½®ï¼š</strong> å¼€å‘è€…åªéœ€å¼•å…¥ Starter ä¾èµ–ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®å¤§é‡ Beanã€‚</li>
<li><strong>å¼€ç®±å³ç”¨ï¼š</strong> æä¾›åˆç†çš„é»˜è®¤é…ç½®ï¼Œæ»¡è¶³å¤§éƒ¨åˆ†åœºæ™¯ã€‚</li>
<li><strong>æ˜“äºå®šåˆ¶ï¼š</strong> é€šè¿‡å®šä¹‰è‡ªå·±çš„ <code>@Bean</code> (åˆ©ç”¨ <code>@ConditionalOnMissingBean</code> è¦†ç›–) æˆ–ä¿®æ”¹ <code>application.properties</code>&#x2F;<code>application.yml</code> å³å¯è½»æ¾è¦†ç›–é»˜è®¤é…ç½®ã€‚</li>
<li><strong>æŒ‰éœ€åŠ è½½ï¼š</strong> åŸºäºæ¡ä»¶æ³¨è§£ï¼ŒåªåŠ è½½å½“å‰åº”ç”¨å®é™…éœ€è¦çš„é…ç½®å’Œ Beanï¼Œé¿å…èµ„æºæµªè´¹ã€‚</li>
</ul>
<p><strong>ç†è§£è¦ç‚¹ï¼š</strong></p>
<ul>
<li>è‡ªåŠ¨è£…é…ä¸æ˜¯é»‘é­”æ³•ï¼Œæœ¬è´¨ä¸Šæ˜¯ Spring <code>@Configuration</code> å’Œ <code>@Bean</code> çš„<strong>æ¡ä»¶åŒ–ã€æ‰¹é‡åŒ–ä½¿ç”¨</strong>ã€‚</li>
<li><code>spring.factories</code> &#x2F; <code>AutoConfiguration.imports</code> æ–‡ä»¶æ˜¯<strong>è‡ªåŠ¨é…ç½®ç±»çš„æ³¨å†Œä¸­å¿ƒ</strong>ã€‚</li>
<li>æ¡ä»¶æ³¨è§£ (<code>@ConditionalXXX</code>) æ˜¯<strong>å†³å®šå“ªäº›é…ç½®ç”Ÿæ•ˆçš„è§„åˆ™å¼•æ“</strong>ã€‚</li>
<li>è‡ªåŠ¨é…ç½®å…ƒæ•°æ® (<code>spring-autoconfigure-metadata.properties</code>) æ˜¯<strong>ä¼˜åŒ–å¯åŠ¨é€Ÿåº¦çš„å…³é”®</strong>ã€‚</li>
</ul>
<h3 id="è‡ªå®šä¹‰ä¸€ä¸ªstarter"><a href="#è‡ªå®šä¹‰ä¸€ä¸ªstarter" class="headerlink" title="è‡ªå®šä¹‰ä¸€ä¸ªstarter"></a>è‡ªå®šä¹‰ä¸€ä¸ªstarter</h3><p><code>starter</code>çš„é¡¹ç›®ç»“æ„</p>
<img src="/post/18f2748c/image-20241207213730855.png" class="" title="image-20241207213730855">

<p><code>starter</code>åæ ‡</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.tw<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>robot-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æœåŠ¡æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RobotService</span> &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">sayHello</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RobotServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">RobotService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RobotProperties robotProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, &quot;</span> + robotProperties.getGreeting();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å±æ€§é…ç½®ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;robot&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RobotProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String greeting;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‡ªåŠ¨é…ç½®ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;RobotServiceImpl.class, RobotProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RobotAutoConfiguration</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‡ªå®šä¹‰æ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Import(RobotAutoConfiguration.class)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableRobot &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¼•å…¥è‡ªå®šä¹‰<code>starter</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.tw<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>robot-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å¼€å¯è‡ªåŠ¨é…ç½®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableRobot</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> SpringApplication.run(ClientApplication.class, args);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">RobotService</span> <span class="variable">robotService</span> <span class="operator">=</span> context.getBean(RobotService.class);</span><br><span class="line">        System.out.println(robotService.sayHello());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŸºäºSPIè‡ªåŠ¨é…ç½®</p>
<p>æ–¹å¼1ï¼šåˆ›å»º<code>spring.factories</code>æ–‡ä»¶</p>
<img src="/post/18f2748c/image-20241207221646340.png" class="" title="image-20241207221646340">

<p>æ–¹å¼2ï¼šåˆ›å»º<code>org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>æ–‡ä»¶</p>
<img src="/post/18f2748c/image-20241207221743415.png" class="" title="image-20241207221743415">

<p>æ— è®ºé‡‡ç”¨ä¸Šè¿°å“ªç§æ–¹å¼ï¼Œéƒ½ä¸å†éœ€è¦<code>@EnableRobot</code>æ³¨è§£å°±å¯ä»¥å®ç°è‡ªåŠ¨é…ç½®ã€‚</p>
<h2 id="spring-beanæ˜¯çº¿ç¨‹å®‰å…¨çš„å—"><a href="#spring-beanæ˜¯çº¿ç¨‹å®‰å…¨çš„å—" class="headerlink" title="spring beanæ˜¯çº¿ç¨‹å®‰å…¨çš„å—"></a>spring beanæ˜¯çº¿ç¨‹å®‰å…¨çš„å—</h2><p>Spring Bean çš„çº¿ç¨‹å®‰å…¨æ€§<strong>ä¸æ˜¯ç”± Spring æ¡†æ¶æœ¬èº«ä¿è¯çš„</strong>ï¼Œè€Œæ˜¯<strong>å–å†³äº Bean çš„ä½œç”¨åŸŸï¼ˆScopeï¼‰å’Œä½ å¦‚ä½•ç¼–å†™è¯¥ Bean çš„ä»£ç </strong>ã€‚</p>
<p><strong>ä½œç”¨åŸŸï¼š</strong></p>
<ul>
<li><strong>å•ä¾‹ï¼ˆSingletonï¼‰ - é»˜è®¤ä½œç”¨åŸŸï¼š</strong> è¿™æ˜¯æœ€å¸¸ç”¨çš„ä½œç”¨åŸŸã€‚Spring IoC å®¹å™¨åœ¨æ•´ä¸ªåº”ç”¨ä¸­åªåˆ›å»ºè¯¥ Bean çš„ä¸€ä¸ªå®ä¾‹ã€‚<strong>è¿™ä¸ªå•ä¾‹å®ä¾‹ä¼šè¢«æ‰€æœ‰è¯·æ±‚å®ƒçš„çº¿ç¨‹å…±äº«ã€‚</strong><ul>
<li><strong>çº¿ç¨‹å®‰å…¨é£é™©ï¼š</strong> å¦‚æœè¿™ä¸ªå•ä¾‹ Bean æ˜¯<strong>æœ‰çŠ¶æ€çš„ï¼ˆStatefulï¼‰</strong>ï¼Œå³å®ƒåŒ…å«å¯å˜çš„æˆå‘˜å˜é‡ï¼ˆå­—æ®µï¼‰ï¼Œé‚£ä¹ˆå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å’Œä¿®æ”¹è¿™äº›çŠ¶æ€æ—¶ï¼Œ<strong>å°±ææœ‰å¯èƒ½å‘ç”Ÿç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰å’Œæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå¯¼è‡´çº¿ç¨‹ä¸å®‰å…¨ã€‚</strong></li>
<li><strong>çº¿ç¨‹å®‰å…¨æ¡ä»¶ï¼š</strong> å¦‚æœè¿™ä¸ªå•ä¾‹ Bean æ˜¯<strong>æ— çŠ¶æ€çš„ï¼ˆStatelessï¼‰</strong>ï¼Œå³å®ƒ<strong>ä¸åŒ…å«ä»»ä½•å¯å˜çš„æˆå‘˜å˜é‡</strong>ï¼Œæˆ–è€…å®ƒåªåŒ…å« <code>final</code> æˆ–ä¸å¯å˜å¯¹è±¡ï¼ˆå¦‚ <code>String</code>ã€<code>Integer</code> ç­‰ï¼‰ä½œä¸ºæˆå‘˜å˜é‡ï¼Œå¹¶ä¸”å…¶æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯åŸºäºä¼ å…¥å‚æ•°è¿›è¡Œè®¡ç®—è€Œä¸ä¾èµ–æˆ–ä¿®æ”¹å†…éƒ¨çŠ¶æ€ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯<strong>çº¿ç¨‹å®‰å…¨çš„</strong>ã€‚è¿™æ˜¯ç¼–å†™çº¿ç¨‹å®‰å…¨å•ä¾‹ Bean çš„æœ€ä½³å®è·µã€‚</li>
</ul>
</li>
<li><strong>åŸå‹ï¼ˆPrototypeï¼‰ï¼š</strong> æ¯æ¬¡è¯·æ±‚è¯¥ Bean æ—¶ï¼ŒSpring å®¹å™¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„å®ä¾‹ã€‚å› æ­¤ï¼Œæ¯ä¸ªçº¿ç¨‹é€šå¸¸æ“ä½œçš„æ˜¯è‡ªå·±çš„ Bean å®ä¾‹ã€‚<ul>
<li><strong>çº¿ç¨‹å®‰å…¨ï¼š</strong> <strong>é€šå¸¸è¢«è®¤ä¸ºæ˜¯çº¿ç¨‹å®‰å…¨çš„</strong>ï¼Œå› ä¸ºçŠ¶æ€ä¸å…±äº«ã€‚ä½†æ˜¯ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹å°†å®ƒçš„åŸå‹ Bean å®ä¾‹å¼•ç”¨ä¼ é€’ç»™å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”è¿™ä¸ª Bean æ˜¯æœ‰çŠ¶æ€çš„ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªå®ä¾‹æ—¶ï¼ŒåŒæ ·ä¼šå¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</li>
</ul>
</li>
<li><strong>è¯·æ±‚ï¼ˆRequestï¼‰ã€ä¼šè¯ï¼ˆSessionï¼‰ã€åº”ç”¨ï¼ˆApplicationï¼‰ã€WebSocketï¼ˆWebSocketï¼‰ï¼š</strong> è¿™äº›ä½œç”¨åŸŸä¸»è¦ç”¨äº Web åº”ç”¨ã€‚<code>Request</code> ä½œç”¨åŸŸä¸ºæ¯ä¸ª HTTP è¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹ï¼Œ<code>Session</code> ä½œç”¨åŸŸä¸ºæ¯ä¸ªç”¨æˆ·ä¼šè¯åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œç­‰ç­‰ã€‚åœ¨è¿™äº›ä½œç”¨åŸŸå†…ï¼Œå•ä¸ªå®ä¾‹é€šå¸¸åªè¢«ä¸€ä¸ªçº¿ç¨‹ï¼ˆå¤„ç†è¯¥è¯·æ±‚&#x2F;ä¼šè¯çš„çº¿ç¨‹ï¼‰è®¿é—®ï¼Œå› æ­¤<strong>åœ¨è¯¥ä½œç”¨åŸŸå®šä¹‰çš„è¾¹ç•Œå†…é€šå¸¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</strong>ã€‚ä½†è·¨è¯·æ±‚&#x2F;ä¼šè¯å…±äº«è¿™äº› Bean çš„å¼•ç”¨ä¼šå¯¼è‡´é—®é¢˜ã€‚</li>
</ul>
<p><strong>ä»£ç è®¾è®¡ï¼š</strong></p>
<ul>
<li><strong>æ— çŠ¶æ€è®¾è®¡ï¼š</strong> è¿™æ˜¯å®ç°çº¿ç¨‹å®‰å…¨æœ€æ¨èçš„æ–¹å¼ã€‚ç¡®ä¿ä½ çš„ Beanï¼ˆå°¤å…¶æ˜¯å•ä¾‹ Beanï¼‰<strong>ä¸åŒ…å«ä»»ä½•å¯å˜çš„æˆå‘˜å˜é‡</strong>ã€‚æ‰€æœ‰æ“ä½œæ‰€éœ€çš„æ•°æ®éƒ½é€šè¿‡æ–¹æ³•å‚æ•°ä¼ å…¥ã€‚</li>
<li><strong>ä½¿ç”¨å±€éƒ¨å˜é‡ï¼š</strong> åœ¨æ–¹æ³•å†…éƒ¨ä½¿ç”¨å±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æ–¹æ³•è°ƒç”¨æ ˆã€‚</li>
<li><strong>ä½¿ç”¨åŒæ­¥ï¼ˆSynchronizationï¼‰ï¼š</strong> å¦‚æœ Bean å¿…é¡»æœ‰çŠ¶æ€ï¼Œä½ éœ€è¦ä½¿ç”¨åŒæ­¥æœºåˆ¶ï¼ˆå¦‚ <code>synchronized</code> å…³é”®å­—ã€<code>ReentrantLock</code>ã€<code>Atomic</code> ç±»ç­‰ï¼‰æ¥ä¿æŠ¤å¯¹å…±äº«å¯å˜çŠ¶æ€çš„è®¿é—®ã€‚ä½†è¿™ä¼šå¢åŠ å¤æ‚æ€§å’Œå¯èƒ½é™ä½æ€§èƒ½ã€‚</li>
<li><strong>ä½¿ç”¨å¹¶å‘é›†åˆï¼š</strong> å¦‚æœéœ€è¦å…±äº«é›†åˆï¼Œä¼˜å…ˆä½¿ç”¨ <code>java.util.concurrent</code> åŒ…ä¸‹çš„çº¿ç¨‹å®‰å…¨é›†åˆç±»ï¼ˆå¦‚ <code>ConcurrentHashMap</code>, <code>CopyOnWriteArrayList</code> ç­‰ï¼‰ã€‚</li>
<li><strong>ä½¿ç”¨ ThreadLocalï¼š</strong> å¯¹äºéœ€è¦ä¸ºæ¯ä¸ªçº¿ç¨‹ä¿å­˜ç‹¬ç«‹çŠ¶æ€çš„æƒ…å†µï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ·èº«ä»½éªŒè¯ä¿¡æ¯ï¼‰ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ <code>ThreadLocal</code>ã€‚ä½†éœ€è¦éå¸¸å°å¿ƒåœ°ç®¡ç†å…¶ç”Ÿå‘½å‘¨æœŸï¼Œé¿å…å†…å­˜æ³„æ¼ï¼ˆå°¤å…¶æ˜¯åœ¨ä½¿ç”¨çº¿ç¨‹æ± æ—¶ï¼‰ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼ˆå±é™©çš„å•ä¾‹ï¼‰ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">// é»˜è®¤æ˜¯ Singleton</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnsafeCounterService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// å¯å˜çŠ¶æ€ï¼å±é™©ï¼</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        count++; <span class="comment">// éåŸå­æ“ä½œï¼Œå¤šçº¿ç¨‹ä¸‹ä¼šå‡ºé”™</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç¤ºä¾‹ï¼ˆå®‰å…¨çš„å•ä¾‹ - æ— çŠ¶æ€ï¼‰ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SafeCalculatorService</span> &#123;</span><br><span class="line">    <span class="comment">// æ²¡æœ‰æˆå‘˜å˜é‡ -&gt; æ— çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b; <span class="comment">// åªæ“ä½œå‚æ•°å’Œå±€éƒ¨å˜é‡ï¼Œçº¿ç¨‹å®‰å…¨</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç¤ºä¾‹ï¼ˆå®‰å…¨çš„å•ä¾‹ - ä½¿ç”¨ Atomic ç±»ï¼‰ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SafeCounterService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">count</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>); <span class="comment">// ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„åŸå­ç±»</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        count.incrementAndGet(); <span class="comment">// åŸå­æ“ä½œï¼Œçº¿ç¨‹å®‰å…¨</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Dubbo"><a href="#Dubbo" class="headerlink" title="Dubbo"></a>Dubbo</h1><h2 id="ä»€ä¹ˆæ˜¯SPIæœºåˆ¶"><a href="#ä»€ä¹ˆæ˜¯SPIæœºåˆ¶" class="headerlink" title="ä»€ä¹ˆæ˜¯SPIæœºåˆ¶"></a>ä»€ä¹ˆæ˜¯SPIæœºåˆ¶</h2><p><strong>SPI</strong> æ˜¯ Java æä¾›çš„ä¸€ç§<strong>æœåŠ¡å‘ç°æœºåˆ¶</strong>ï¼Œé€šè¿‡<strong>æ¥å£ä¸å®ç°è§£è€¦</strong>å®ç°åŠ¨æ€æ‰©å±•ã€‚æ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>å®šä¹‰æœåŠ¡æ¥å£</strong>ï¼ˆå¦‚ <code>PaymentService</code>ï¼‰</li>
<li><strong>æä¾›å®ç°ç±»</strong>ï¼ˆå¦‚ <code>AlipayService</code>, <code>WechatPayService</code>ï¼‰</li>
<li><strong>æ³¨å†Œå®ç°</strong>ï¼šåœ¨ <code>META-INF/services/</code> ä¸‹åˆ›å»ºä»¥æ¥å£å…¨é™å®šåå‘½åçš„æ–‡ä»¶ï¼Œå†™å…¥å®ç°ç±»å…¨é™å®šå</li>
<li><strong>åŠ¨æ€åŠ è½½</strong>ï¼šé€šè¿‡ <code>ServiceLoader</code> åŠ è½½æ‰€æœ‰æ³¨å†Œçš„å®ç°</li>
</ol>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>å¼€é—­åŸåˆ™</strong>ï¼šæ–°å¢å®ç°æ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç </li>
<li><strong>è§£è€¦</strong>ï¼šæ¥å£ä¸å®ç°åˆ†ç¦»</li>
<li><strong>å¯æ’æ‹”</strong>ï¼šé€šè¿‡é…ç½®æ–‡ä»¶åŠ¨æ€æ›¿æ¢å®ç°</li>
</ul>
<p><strong>Java SPI å®Œæ•´ Demo</strong></p>
<ol>
<li>å®šä¹‰æœåŠ¡æ¥å£</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PaymentService.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å®ç°æœåŠ¡æ¥å£</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AlipayService.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlipayService</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[æ”¯ä»˜å®] æ”¯ä»˜: Â¥&quot;</span> + amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// WechatPayService.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatPayService</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[å¾®ä¿¡æ”¯ä»˜] æ”¯ä»˜: Â¥&quot;</span> + amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æ³¨å†ŒæœåŠ¡å®ç°</li>
</ol>
<p>åˆ›å»ºèµ„æºæ–‡ä»¶ï¼š<br><code>src/main/resources/META-INF/services/com.example.PaymentService</code><br>å†…å®¹ï¼š</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">com.example.AlipayService</span><br><span class="line">com.example.WechatPayService</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ä½¿ç”¨ SPI åŠ è½½æœåŠ¡</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPIDemo.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.ServiceLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SPIDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åŠ è½½æ‰€æœ‰ PaymentService å®ç°</span></span><br><span class="line">        ServiceLoader&lt;PaymentService&gt; services = </span><br><span class="line">            ServiceLoader.load(PaymentService.class);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;=== å‘ç° &quot;</span> + getServiceCount(services) + <span class="string">&quot; ä¸ªæ”¯ä»˜æœåŠ¡ ===&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è°ƒç”¨æ‰€æœ‰å®ç°</span></span><br><span class="line">        <span class="keyword">for</span> (PaymentService service : services) &#123;</span><br><span class="line">            service.pay(<span class="number">100.0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getServiceCount</span><span class="params">(ServiceLoader&lt;PaymentService&gt; services)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (PaymentService ignored : services) &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>é¡¹ç›®ç»“æ„</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">src/</span><br><span class="line">â”œâ”€â”€ main/</span><br><span class="line">â”‚   â”œâ”€â”€ java/</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ com/example/</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ PaymentService.java</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ AlipayService.java</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ WechatPayService.java</span><br><span class="line">â”‚   â”‚   â”‚   â””â”€â”€ SPIDemo.java</span><br><span class="line">â”‚   â”‚</span><br><span class="line">â”‚   â””â”€â”€ resources/</span><br><span class="line">â”‚       â””â”€â”€ META-INF/services/</span><br><span class="line">â”‚           â””â”€â”€ com.example.PaymentService  &lt;-- å…³é”®é…ç½®æ–‡ä»¶</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>è¿è¡Œç»“æœ</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">=== å‘ç° 2 ä¸ªæ”¯ä»˜æœåŠ¡ ===</span><br><span class="line">[æ”¯ä»˜å®] æ”¯ä»˜: Â¥100.0</span><br><span class="line">[å¾®ä¿¡æ”¯ä»˜] æ”¯ä»˜: Â¥100.0</span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®ç‚¹è§£æï¼š</strong></p>
<ol>
<li><strong>é…ç½®æ–‡ä»¶è·¯å¾„</strong>ï¼š<code>META-INF/services/æ¥å£å…¨é™å®šå</code></li>
<li><strong>æ–‡ä»¶å†…å®¹</strong>ï¼šå®ç°ç±»çš„å…¨é™å®šåï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</li>
<li><strong>ServiceLoader</strong>ï¼šæ ¸å¿ƒåŠ è½½å·¥å…·ï¼Œå®ç°æ‡’åŠ è½½</li>
<li><strong>è¿­ä»£é¡ºåº</strong>ï¼šæŒ‰é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„é¡ºåºåŠ è½½</li>
</ol>
<p><strong>å®é™…åº”ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>JDBC é©±åŠ¨åŠ è½½ï¼ˆ<code>DriverManager</code>ï¼‰</li>
<li>æ—¥å¿—é—¨é¢ï¼ˆSLF4Jï¼‰</li>
<li>åºåˆ—åŒ–æ¡†æ¶ï¼ˆJacksonï¼‰</li>
<li>Spring Boot è‡ªåŠ¨é…ç½®</li>
</ul>
<blockquote>
<p>é€šè¿‡ SPI æœºåˆ¶ï¼ŒJava å®ç°äº†çœŸæ­£çš„é¢å‘æ¥å£ç¼–ç¨‹ï¼Œä½¿ç³»ç»Ÿå…·å¤‡é«˜åº¦å¯æ‰©å±•æ€§ï¼Œç¬¦åˆã€Œå¼€é—­åŸåˆ™ã€ã€‚</p>
</blockquote>
<h2 id="Javaçš„SPIæœºåˆ¶æœ‰ä»€ä¹ˆé—®é¢˜"><a href="#Javaçš„SPIæœºåˆ¶æœ‰ä»€ä¹ˆé—®é¢˜" class="headerlink" title="Javaçš„SPIæœºåˆ¶æœ‰ä»€ä¹ˆé—®é¢˜"></a>Javaçš„SPIæœºåˆ¶æœ‰ä»€ä¹ˆé—®é¢˜</h2><ol>
<li><strong>æ•ˆç‡ä½ä¸‹ï¼ˆå…¨é‡åŠ è½½ï¼‰</strong>ï¼š<ul>
<li><code>ServiceLoader</code> åœ¨åŠ è½½ä¸€ä¸ªæ¥å£çš„å®ç°æ—¶ï¼Œä¼š<strong>éå†å¹¶å®ä¾‹åŒ–</strong> <code>META-INF/services/</code> ç›®å½•ä¸‹å¯¹åº”é…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰å®ç°ç±»ã€‚</li>
<li><strong>é—®é¢˜ï¼š</strong> å¦‚æœæŸä¸ªæ‰©å±•ç‚¹æœ‰å¾ˆå¤šå®ç°ï¼ˆæˆ–è€…æŸäº›å®ç°ç±»åˆå§‹åŒ–æˆæœ¬å¾ˆé«˜ï¼‰ï¼Œä½†å®é™…è¿è¡Œæ—¶åªéœ€è¦ç”¨åˆ°å…¶ä¸­ä¸€ä¸ªæˆ–å‡ ä¸ªï¼Œè¿™ç§å…¨é‡åŠ è½½ä¼šé€ æˆ<strong>ä¸å¿…è¦çš„èµ„æºæ¶ˆè€—ï¼ˆå†…å­˜ã€CPUï¼‰å’Œå¯åŠ¨å»¶è¿Ÿ</strong>ã€‚</li>
</ul>
</li>
<li><strong>ç¼ºä¹æŒ‰éœ€è·å–èƒ½åŠ›ï¼ˆä¸çµæ´»ï¼‰</strong>ï¼š<ul>
<li>Java SPI åªèƒ½è·å–æ‰€æœ‰å®ç°ï¼Œç„¶åç”±è°ƒç”¨è€…éå†æŸ¥æ‰¾éœ€è¦çš„é‚£ä¸ªã€‚æ²¡æœ‰å†…ç½®çš„æœºåˆ¶æ ¹æ®åç§°ã€å‚æ•°æˆ–å…¶ä»–æ¡ä»¶ç›´æ¥è·å–ç‰¹å®šçš„å®ç°å®ä¾‹ã€‚</li>
<li><strong>é—®é¢˜ï¼š</strong> ä½¿ç”¨èµ·æ¥ä¸å¤Ÿæ–¹ä¾¿å’Œç›´è§‚ï¼Œéœ€è¦é¢å¤–çš„ç­›é€‰é€»è¾‘ã€‚</li>
</ul>
</li>
<li><strong>ä¸æ”¯æŒä¾èµ–æ³¨å…¥</strong>ï¼š<ul>
<li>é€šè¿‡ SPI åŠ è½½çš„å®ç°ç±»å®ä¾‹ï¼Œå…¶æ„é€ å‡½æ•°æˆ–æˆå‘˜å˜é‡å¦‚æœä¾èµ–å…¶ä»–å¯¹è±¡ï¼Œéœ€è¦è°ƒç”¨è€…æ‰‹åŠ¨è®¾ç½®ã€‚</li>
<li><strong>é—®é¢˜ï¼š</strong> åœ¨å¤æ‚çš„æ¡†æ¶ä¸­ï¼Œæ‰©å±•ç‚¹å®ç°ç±»å¯èƒ½éœ€è¦ä¾èµ–æ¡†æ¶å†…éƒ¨çš„æ ¸å¿ƒç»„ä»¶ï¼ˆå¦‚é…ç½®ä¸­å¿ƒã€æ³¨å†Œä¸­å¿ƒã€åºåˆ—åŒ–å™¨ç­‰ï¼‰ï¼Œæ‰‹åŠ¨ç®¡ç†è¿™äº›ä¾èµ–éå¸¸ç¹çä¸”å®¹æ˜“å‡ºé”™ï¼Œç ´åäº†æ‰©å±•ç‚¹çš„å°è£…æ€§ã€‚</li>
</ul>
</li>
<li><strong>ä¸æ”¯æŒæ‰©å±•ç‚¹è‡ªé€‚åº”&#x2F;IoC&#x2F;AOP</strong>ï¼š<ul>
<li>Java SPI æ˜¯é™æ€çš„ï¼ŒåŠ è½½å“ªä¸ªå®ç°åœ¨é…ç½®æ–‡ä»¶ä¸­æ˜¯å†™æ­»çš„ã€‚å®ƒæ— æ³•æ ¹æ®è¿è¡Œæ—¶çš„å‚æ•°ï¼ˆå¦‚æ–¹æ³•å‚æ•°ã€URL å‚æ•°ã€é…ç½®é¡¹ï¼‰åŠ¨æ€é€‰æ‹©ä¸åŒçš„å®ç°ã€‚</li>
<li><strong>é—®é¢˜ï¼š</strong> ç¼ºä¹åŠ¨æ€æ€§ï¼Œéš¾ä»¥å®ç°æ›´é«˜çº§çš„åŠŸèƒ½å¦‚é€‚é…å™¨ã€åŒ…è£…å™¨ï¼ˆAOPï¼‰ã€æ¡ä»¶é€‰æ‹©ç­‰ã€‚</li>
</ul>
</li>
<li><strong>é…ç½®ä¸å‹å¥½ï¼ˆæ— åç§°æ ‡è¯†ï¼‰</strong>ï¼š<ul>
<li>é…ç½®æ–‡ä»¶é‡Œç›´æ¥å†™å®ç°ç±»çš„å…¨é™å®šåã€‚æ²¡æœ‰ä¸ºæ¯ä¸ªå®ç°å®šä¹‰ä¸€ä¸ªæ˜“äºç†è§£å’Œä½¿ç”¨çš„åç§°ï¼ˆKeyï¼‰ã€‚</li>
<li><strong>é—®é¢˜ï¼š</strong> é…ç½®å’Œå¼•ç”¨ä¸å¤Ÿç›´è§‚ï¼Œå®¹æ˜“å‡ºé”™ï¼Œä¸åˆ©äºé€šè¿‡é…ç½®ä¸­å¿ƒåŠ¨æ€ä¿®æ”¹ã€‚</li>
</ul>
</li>
<li><strong>ç¼ºä¹ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼š<ul>
<li>Java SPI æ²¡æœ‰æä¾›æ ‡å‡†çš„åˆå§‹åŒ–å’Œé”€æ¯å›è°ƒæœºåˆ¶ã€‚</li>
</ul>
</li>
</ol>
<h2 id="Dubbo-SPI"><a href="#Dubbo-SPI" class="headerlink" title="Dubbo SPI"></a>Dubbo SPI</h2><p>Dubbo è®¾è®¡äº†ä¸€å¥—åŠŸèƒ½æ›´å¼ºå¤§ã€æ›´çµæ´»çš„ SPI æœºåˆ¶ï¼ˆæ ¸å¿ƒåœ¨ <code>org.apache.dubbo.common.extension</code> åŒ…ï¼‰ï¼Œå®Œç¾è§£å†³äº†ä¸Šè¿°é—®é¢˜ï¼š</p>
<ol>
<li><strong>æŒ‰éœ€åŠ è½½ï¼ˆæ ¸å¿ƒæ”¹è¿›ï¼‰</strong>ï¼š<ul>
<li>Dubbo SPI ä¸ä¼šä¸€æ¬¡æ€§åŠ è½½å’Œå®ä¾‹åŒ–æ‰€æœ‰å®ç°ç±»ã€‚</li>
<li>å®ƒç»´æŠ¤äº†ä¸€ä¸ªæ˜ å°„å…³ç³»ï¼š<code>æ‰©å±•ç‚¹åç§° (Key) -&gt; å®ç°ç±»å…¨é™å®šå</code>ã€‚</li>
<li>åªæœ‰å½“é€šè¿‡åç§° (<code>key</code>) æ˜ç¡®è¯·æ±‚æŸä¸ªæ‰©å±•ç‚¹æ—¶ï¼Œæ‰ä¼šåŠ è½½å¹¶å®ä¾‹åŒ–å¯¹åº”çš„å®ç°ç±»ã€‚<strong>å¤§å¤§æé«˜äº†æ•ˆç‡å’Œèµ„æºåˆ©ç”¨ç‡ï¼ŒåŠ å¿«äº†å¯åŠ¨é€Ÿåº¦ã€‚</strong></li>
</ul>
</li>
<li><strong>æ”¯æŒæ‰©å±•ç‚¹å‘½åä¸é…ç½®åŒ–</strong>ï¼š<ul>
<li>é…ç½®æ–‡ä»¶è·¯å¾„ï¼š<code>META-INF/dubbo/</code> æˆ– <code>META-INF/dubbo/internal/</code> æˆ– <code>META-INF/services/</code>ï¼ˆå…¼å®¹ Java SPIï¼‰ï¼Œæ–‡ä»¶åä¸ºæ¥å£å…¨é™å®šåã€‚</li>
<li>æ–‡ä»¶å†…å®¹æ ¼å¼ï¼š<code>key=implementation.class.name</code> (ä¾‹å¦‚ï¼š<code>dubbo=org.apache.dubbo.rpc.protocol.dubbo.DubboProtocol</code>)ã€‚è¿™ä¸ºæ¯ä¸ªå®ç°èµ‹äºˆäº†æ˜ç¡®çš„æ ‡è¯†ç¬¦ (<code>key</code>)ã€‚</li>
</ul>
</li>
<li>**å¼ºå¤§çš„ä¾èµ–æ³¨å…¥ (IoC)**ï¼š<ul>
<li>Dubbo SPI åœ¨å®ä¾‹åŒ–æ‰©å±•ç‚¹å®ç°æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰«æå…¶ setter æ–¹æ³•ã€‚</li>
<li>å¦‚æœ setter æ–¹æ³•çš„å‚æ•°ç±»å‹æ˜¯å¦ä¸€ä¸ª<strong>å·²çŸ¥çš„æ‰©å±•ç‚¹ç±»å‹</strong>ï¼ŒDubbo ä¼šè‡ªåŠ¨æ³¨å…¥è¯¥æ‰©å±•ç‚¹çš„<strong>é€‚é…å®ä¾‹</strong>ï¼ˆé€šå¸¸æ˜¯è‡ªé€‚åº”æ‰©å±•ç‚¹å®ä¾‹ï¼Œè§ä¸‹ä¸€ç‚¹ï¼‰ã€‚</li>
<li>ä¹Ÿæ”¯æŒæ³¨å…¥æ¡†æ¶å†…éƒ¨çš„æ ¸å¿ƒç»„ä»¶ï¼ˆå¦‚ <code>ApplicationModel</code>, <code>ModuleModel</code>, <code>ScopeModel</code> ç­‰ï¼‰ã€‚</li>
<li><strong>ä¼˜åŠ¿ï¼š</strong> è§£è€¦æ‰©å±•ç‚¹å®ç°ä¸æ¡†æ¶å†…éƒ¨ä¾èµ–ï¼Œå¼€å‘è€…åªéœ€å…³æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œä¾èµ–ç”±æ¡†æ¶è‡ªåŠ¨æ³¨å…¥ã€‚</li>
</ul>
</li>
<li>**è‡ªé€‚åº”æ‰©å±•ç‚¹ (Adaptive Extension - æ ¸å¿ƒç‰¹æ€§)**ï¼š<ul>
<li><strong>æ¦‚å¿µï¼š</strong> ä¸€ç§ç‰¹æ®Šçš„æ‰©å±•ç‚¹ï¼Œå®ƒæœ¬èº«é€šå¸¸ä¸åŒ…å«å…·ä½“é€»è¾‘ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>åŠ¨æ€ç”Ÿæˆçš„ä»£ç†</strong>ï¼ˆç¼–è¯‘æ—¶ç”Ÿæˆæˆ–è¿è¡Œæ—¶ç”Ÿæˆï¼‰ã€‚</li>
<li><strong>ä½œç”¨ï¼š</strong> åœ¨<strong>æ–¹æ³•è¢«è°ƒç”¨æ—¶</strong>ï¼Œæ ¹æ®ä¼ å…¥çš„<strong>è¿è¡Œæ—¶å‚æ•°</strong>ï¼ˆé€šå¸¸æ˜¯åŒ…å«é…ç½®ä¿¡æ¯çš„ <code>URL</code> å¯¹è±¡æˆ– <code>@Adaptive</code> æ³¨è§£æŒ‡å®šçš„å‚æ•°ï¼‰ï¼ŒåŠ¨æ€å†³å®šå°†è°ƒç”¨<strong>å§”æ‰˜</strong>ç»™å“ªä¸ªçœŸæ­£çš„æ‰©å±•ç‚¹å®ç° (<code>key</code> å¯¹åº”çš„å®ç°)ã€‚</li>
<li><strong>å®ç°æ–¹å¼ï¼š</strong><ul>
<li><strong>ç¼–è¯‘æ—¶ç”Ÿæˆï¼š</strong> Dubbo ç¼–è¯‘å™¨ä¼šä¸ºæ ‡è®°äº† <code>@Adaptive</code> æ³¨è§£çš„æ¥å£æ–¹æ³•ç”Ÿæˆä»£ç†ç±»ä»£ç ï¼ˆå¦‚ <code>Protocol$Adaptive</code>ï¼‰ã€‚</li>
<li><strong>è¿è¡Œæ—¶ç”Ÿæˆï¼š</strong> å¦‚æœæ¥å£æ²¡æœ‰ä»»ä½•æ–¹æ³•æ ‡è®° <code>@Adaptive</code>ï¼ŒDubbo ä¼šæŸ¥æ‰¾è¯¥æ¥å£çš„é»˜è®¤å®ç°ï¼ˆé€šè¿‡ <code>@SPI</code> çš„ <code>value</code> æŒ‡å®šï¼‰ã€‚å¦‚æœéœ€è¦åœ¨è¿è¡Œæ—¶æ ¹æ®æ–¹æ³•å‚æ•°é€‰æ‹©ï¼Œä¹Ÿå¯ä»¥åœ¨å…·ä½“å®ç°ç±»çš„æ–¹æ³•ä¸Šä½¿ç”¨ <code>@Adaptive</code>ï¼ˆè¾ƒå°‘è§ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>ä¼˜åŠ¿ï¼š</strong> å®ç°äº†çœŸæ­£çš„è¿è¡Œæ—¶åŠ¨æ€æ‰©å±•é€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œ<code>Protocol</code> æ¥å£çš„è‡ªé€‚åº”æ‰©å±•ç‚¹ï¼Œæ ¹æ® URL ä¸­çš„ <code>protocol</code> å‚æ•°å€¼ (<code>dubbo</code>, <code>hessian</code>, <code>http</code>, <code>injvm</code> ç­‰ï¼‰å†³å®šä½¿ç”¨å“ªä¸ªå…·ä½“çš„åè®®å®ç°ã€‚è¿™æ˜¯ Dubbo é«˜åº¦å¯æ‰©å±•æ€§çš„åŸºçŸ³ã€‚</li>
</ul>
</li>
<li>**è‡ªåŠ¨åŒ…è£… (Wrapper - AOP)**ï¼š<ul>
<li>å¦‚æœæ‰©å±•ç‚¹å®ç°ç±»çš„æ„é€ å‡½æ•°æ¥å—<strong>å•ä¸ªå‚æ•°</strong>ä¸”æ˜¯è¯¥æ‰©å±•ç‚¹æ¥å£ç±»å‹ï¼ŒDubbo ä¼šè¯†åˆ«å®ƒä¸º Wrapper ç±»ã€‚</li>
<li>åœ¨åŠ è½½çœŸæ­£çš„æ‰©å±•ç‚¹å®ç°ï¼ˆç§°ä¸º <code>instance</code>ï¼‰æ—¶ï¼ŒDubbo ä¼šåƒâ€œæ´‹è‘±â€ä¸€æ ·ï¼Œç”¨æ‰€æœ‰æ‰¾åˆ°çš„ Wrapper ç±»<strong>å±‚å±‚åŒ…è£¹</strong>è¿™ä¸ª <code>instance</code>ï¼š<code>new Wrapper1(new Wrapper2(new Wrapper3(instance)))</code>ã€‚</li>
<li><strong>ä½œç”¨ï¼š</strong> åœ¨ä¸ä¿®æ”¹åŸå§‹å®ç°ç±»ä»£ç çš„å‰æä¸‹ï¼Œå®ç° AOP åŠŸèƒ½ã€‚Wrapper å¯ä»¥åœ¨è°ƒç”¨çœŸæ­£å®ç°çš„å‰åæ·»åŠ é€»è¾‘ï¼Œå¦‚æ—¥å¿—è®°å½•ã€ç›‘æ§ç»Ÿè®¡ã€æƒé™æ ¡éªŒã€å¤±è´¥é‡è¯•ã€è´Ÿè½½å‡è¡¡ï¼ˆéƒ¨åˆ†ç­–ç•¥ï¼‰ç­‰ã€‚Dubbo è‡ªèº«çš„å¾ˆå¤šåŠŸèƒ½ï¼ˆå¦‚ Filter Chainï¼‰éƒ½æ˜¯é€šè¿‡ Wrapper æœºåˆ¶å®ç°çš„ã€‚</li>
</ul>
</li>
<li>**è‡ªåŠ¨æ¿€æ´»æ‰©å±•ç‚¹ (Activate)**ï¼š<ul>
<li>é€šè¿‡ <code>@Activate</code> æ³¨è§£æ ‡è®°æ‰©å±•ç‚¹å®ç°ã€‚</li>
<li>å¯ä»¥æ ¹æ®ç»™å®šçš„æ¡ä»¶ï¼ˆå¦‚ URL ä¸­çš„ç‰¹å®šå‚æ•°å€¼ã€æ¶ˆè´¹è€…&#x2F;æä¾›è€…ç«¯è§’è‰²ï¼‰<strong>è‡ªåŠ¨æ¿€æ´»å¹¶ç»„åˆ</strong>ä¸€ç»„ç¬¦åˆæ¡ä»¶çš„æ‰©å±•ç‚¹å®ç°ã€‚</li>
<li><strong>å…¸å‹åº”ç”¨ï¼š</strong> Dubbo çš„ Filter é“¾ã€‚å¼€å‘è€…å¯ä»¥æ–¹ä¾¿åœ°æ·»åŠ è‡ªå®šä¹‰ Filterï¼Œå¹¶é€šè¿‡ <code>@Activate</code> æ³¨è§£æ§åˆ¶å®ƒåœ¨å“ªäº›æ¡ä»¶ä¸‹è‡ªåŠ¨ç”Ÿæ•ˆï¼ˆå¦‚æ‰€æœ‰è°ƒç”¨ã€ç‰¹å®šåˆ†ç»„ã€ç‰¹å®šæœåŠ¡ç­‰ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>æ”¯æŒé»˜è®¤æ‰©å±•ç‚¹å’Œè¦†ç›–</strong>ï¼š<ul>
<li>åœ¨ <code>@SPI</code> æ³¨è§£ä¸­å¯ä»¥æŒ‡å®šé»˜è®¤æ‰©å±•ç‚¹çš„ <code>key</code> (å¦‚ <code>@SPI(&quot;dubbo&quot;)</code>)ã€‚</li>
<li>Dubbo æ”¯æŒé€šè¿‡é…ç½®ï¼ˆç³»ç»Ÿå±æ€§ã€å¤–éƒ¨é…ç½®ï¼‰è¦†ç›–é»˜è®¤å®ç°æˆ–å·²åŠ è½½çš„å®ç°ã€‚</li>
</ul>
</li>
<li><strong>ç¼“å­˜ä¼˜åŒ–</strong>ï¼š<ul>
<li>Dubbo å¯¹åŠ è½½çš„æ‰©å±•ç‚¹å®šä¹‰ã€å®ä¾‹ï¼ˆå•ä¾‹æˆ–åŸå‹ï¼‰ã€è‡ªé€‚åº”æ‰©å±•ç‚¹å®ä¾‹ç­‰è¿›è¡Œäº†ç»†è‡´çš„ç¼“å­˜ç®¡ç†ï¼Œé¿å…é‡å¤åŠ è½½å’Œåˆ›å»ºï¼Œæå‡æ€§èƒ½ã€‚</li>
</ul>
</li>
</ol>
<p><strong>æ€»ç»“å¯¹æ¯”è¡¨</strong></p>
<table>
<thead>
<tr>
<th align="left">ç‰¹æ€§</th>
<th align="left">Java SPI</th>
<th align="left">Dubbo SPI</th>
<th align="left">Dubbo æ”¹è¿›ç‚¹&#x2F;ä¼˜åŠ¿</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>åŠ è½½æ–¹å¼</strong></td>
<td align="left">å…¨é‡åŠ è½½å¹¶å®ä¾‹åŒ–æ‰€æœ‰å®ç°</td>
<td align="left"><strong>æŒ‰éœ€åŠ è½½</strong>ï¼Œä»…åœ¨ä½¿ç”¨æ—¶åŠ è½½å¹¶å®ä¾‹åŒ–æŒ‡å®š <code>key</code></td>
<td align="left"><strong>é«˜æ•ˆã€èŠ‚çœèµ„æºã€å¯åŠ¨å¿«</strong></td>
</tr>
<tr>
<td align="left"><strong>æ ‡è¯†ä¸é…ç½®</strong></td>
<td align="left">ä»…å®ç°ç±»å…¨å</td>
<td align="left"><code>key=implementation.class.name</code></td>
<td align="left"><strong>é…ç½®çµæ´»ã€å¯è¯»æ€§å¥½ã€æ˜“äºé€šè¿‡ <code>key</code> å¼•ç”¨</strong></td>
</tr>
<tr>
<td align="left"><strong>ä¾èµ–æ³¨å…¥ (IoC)</strong></td>
<td align="left">ä¸æ”¯æŒ</td>
<td align="left"><strong>å¼ºæœ‰åŠ›æ”¯æŒ</strong>ï¼Œè‡ªåŠ¨æ³¨å…¥å…¶ä»–æ‰©å±•ç‚¹æˆ–æ¡†æ¶ç»„ä»¶</td>
<td align="left"><strong>è§£è€¦ã€ç®€åŒ–æ‰©å±•å¼€å‘ã€å¢å¼ºå°è£…æ€§</strong></td>
</tr>
<tr>
<td align="left"><strong>åŠ¨æ€æ‰©å±•é€‰æ‹©</strong></td>
<td align="left">ä¸æ”¯æŒ</td>
<td align="left"><strong>è‡ªé€‚åº”æ‰©å±•ç‚¹ (Adaptive)</strong></td>
<td align="left"><strong>è¿è¡Œæ—¶æ ¹æ®å‚æ•°åŠ¨æ€é€‰æ‹©å®ç°ï¼Œæ ¸å¿ƒçµæ´»æ€§æ¥æº</strong></td>
</tr>
<tr>
<td align="left"><strong>AOP&#x2F;åŒ…è£…</strong></td>
<td align="left">ä¸æ”¯æŒ</td>
<td align="left"><strong>è‡ªåŠ¨åŒ…è£… (Wrapper)</strong></td>
<td align="left"><strong>æ— ä¾µå…¥æ·»åŠ å…¬å…±é€»è¾‘ (Filter, ç›‘æ§, æ ¡éªŒç­‰)</strong></td>
</tr>
<tr>
<td align="left"><strong>æ¡ä»¶æ¿€æ´»</strong></td>
<td align="left">ä¸æ”¯æŒ</td>
<td align="left"><code>@Activate</code> <strong>è‡ªåŠ¨æ¿€æ´»</strong></td>
<td align="left"><strong>ç®€åŒ–æ‰©å±•ç»„åˆï¼ŒæŒ‰æ¡ä»¶åŠ¨æ€å¯ç”¨æ‰©å±•é“¾ (å¦‚ Filter)</strong></td>
</tr>
<tr>
<td align="left"><strong>é»˜è®¤å®ç°ä¸è¦†ç›–</strong></td>
<td align="left">æ— æ˜ç¡®æœºåˆ¶</td>
<td align="left"><code>@SPI(&quot;defaultKey&quot;)</code> + é…ç½®è¦†ç›–</td>
<td align="left"><strong>çµæ´»æŒ‡å®šå’Œä¿®æ”¹é»˜è®¤è¡Œä¸º</strong></td>
</tr>
<tr>
<td align="left"><strong>ç¼“å­˜</strong></td>
<td align="left">åŸºç¡€ç¼“å­˜</td>
<td align="left"><strong>ç²¾ç»†åŒ–çš„å¤šçº§ç¼“å­˜ç®¡ç†</strong></td>
<td align="left"><strong>æ€§èƒ½ä¼˜åŒ–</strong></td>
</tr>
<tr>
<td align="left"><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td>
<td align="left">æ— </td>
<td align="left">(é—´æ¥é€šè¿‡ Spring ç­‰æˆ–è‡ªå®šä¹‰å®ç°)</td>
<td align="left">Dubbo SPI æœ¬èº«æœªå¼ºå®šä¹‰ï¼Œä½†å¸¸ä¸å…¶ä»–ç”Ÿå‘½å‘¨æœŸç®¡ç†é›†æˆ</td>
</tr>
</tbody></table>
<p><strong>ç»“è®ºï¼š</strong></p>
<p>Dubbo çš„ SPI æœºåˆ¶å¹¶éå¯¹ Java SPI çš„ç®€å•æ›¿æ¢ï¼Œè€Œæ˜¯ä¸ºäº†è§£å†³ Java SPI åœ¨<strong>æ•ˆç‡ã€çµæ´»æ€§ã€åŠ¨æ€æ€§ã€ä¾èµ–ç®¡ç†ã€åŠŸèƒ½å¢å¼ºï¼ˆAOPï¼‰</strong> ç­‰æ–¹é¢çš„ä¸¥é‡ä¸è¶³ï¼Œä¸ºæ„å»ºé«˜åº¦å¯æ‰©å±•ã€é«˜æ€§èƒ½ã€æ˜“äºé›†æˆçš„åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶é‡èº«æ‰“é€ çš„ä¸€å¥—å¼ºå¤§çš„æ‰©å±•ç‚¹åŠ è½½ä¸ç®¡ç†ä½“ç³»ã€‚Dubbo è‡ªèº«çš„å‡ ä¹æ‰€æœ‰æ ¸å¿ƒç»„ä»¶ï¼ˆProtocol, Cluster, LoadBalance, Serialization, Transport, Registry, Monitor, Filter ç­‰ï¼‰éƒ½é€šè¿‡è¿™å¥— SPI æœºåˆ¶å®ç°ï¼Œè¿™ä¹Ÿæ˜¯ Dubbo èƒ½å¤Ÿä¿æŒå¼ºå¤§ç”Ÿå‘½åŠ›å’Œé«˜åº¦å¯å®šåˆ¶æ€§çš„å…³é”®è®¾è®¡ä¹‹ä¸€ã€‚</p>
<script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/MyBatis/" rel="tag"><i class="fa fa-tag"></i> MyBatis</a>
              <a href="/tags/Spring/" rel="tag"><i class="fa fa-tag"></i> Spring</a>
              <a href="/tags/SpringBoot/" rel="tag"><i class="fa fa-tag"></i> SpringBoot</a>
              <a href="/tags/JPA/" rel="tag"><i class="fa fa-tag"></i> JPA</a>
              <a href="/tags/%E6%97%A5%E5%BF%97%E6%A1%86%E6%9E%B6/" rel="tag"><i class="fa fa-tag"></i> æ—¥å¿—æ¡†æ¶</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/post/688e2513.html" rel="prev" title="å­¦ä¹ &é¢è¯•-æ¶ˆæ¯é˜Ÿåˆ—">
                  <i class="fa fa-angle-left"></i> å­¦ä¹ &é¢è¯•-æ¶ˆæ¯é˜Ÿåˆ—
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/post/9787b587.html" rel="next" title="å­¦ä¹ &é¢è¯•-åˆ†å¸ƒå¼">
                  å­¦ä¹ &é¢è¯•-åˆ†å¸ƒå¼ <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa-regular fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder"></span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Word count total">105k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">6:22</span>
  </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.0/mermaid.min.js","integrity":"sha256-stuqcu2FrjYCXDOytWFA5SoUE/r3nkp6gTglzNSlavU="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>

  <script class="next-config" data-name="wavedrom" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.5.0/wavedrom.min.js","integrity":"sha256-INLAoJc6quTNfiMWkGZniYO2cxE8mHpddnLow1m6RFs="}}</script>
  <script class="next-config" data-name="wavedrom_skin" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.5.0/skins/default.js","integrity":"sha256-fduc/Zszk5ezWws2uInY/ALWVmIrmV6VTgXbsYSReFI="}}</script>
  <script src="/js/third-party/tags/wavedrom.js"></script>




  





</body>
</html>
