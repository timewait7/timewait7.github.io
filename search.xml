<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Javaå­¦ä¹ &amp;é¢è¯•</title>
      <link href="/post/65a5b0d7.html"/>
      <url>/post/65a5b0d7.html</url>
      
        <content type="html"><![CDATA[<h1 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h1><h2 id="æ–°ç‰¹æ€§"><a href="#æ–°ç‰¹æ€§" class="headerlink" title="æ–°ç‰¹æ€§"></a>æ–°ç‰¹æ€§</h2><h3 id="Java-8"><a href="#Java-8" class="headerlink" title="Java 8"></a>Java 8</h3><h4 id="Lambda-è¡¨è¾¾å¼"><a href="#Lambda-è¡¨è¾¾å¼" class="headerlink" title="Lambda è¡¨è¾¾å¼"></a>Lambda è¡¨è¾¾å¼</h4><p><strong>ä½œç”¨</strong>ï¼šç®€åŒ–åŒ¿åå†…éƒ¨ç±»ï¼Œå®ç°å‡½æ•°å¼ç¼–ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼ ç»Ÿæ–¹å¼</span></span><br><span class="line"><span class="type">Runnable</span> <span class="variable">r1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Runnable 1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Lambda æ–¹å¼</span></span><br><span class="line"><span class="type">Runnable</span> <span class="variable">r2</span> <span class="operator">=</span> () -&gt; System.out.println(<span class="string">&quot;Runnable 2&quot;</span>);</span><br><span class="line"></span><br><span class="line">r1.run();  <span class="comment">// è¾“å‡º: Runnable 1</span></span><br><span class="line">r2.run();  <span class="comment">// è¾“å‡º: Runnable 2</span></span><br></pre></td></tr></table></figure><h4 id="å‡½æ•°å¼æ¥å£"><a href="#å‡½æ•°å¼æ¥å£" class="headerlink" title="å‡½æ•°å¼æ¥å£"></a>å‡½æ•°å¼æ¥å£</h4><p><strong>ä½œç”¨</strong>ï¼šåªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ï¼Œå¯ç”¨ <code>@FunctionalInterface</code> æ³¨è§£æ ‡è®°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">MathOperation</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">operate</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MathOperation</span> <span class="variable">add</span> <span class="operator">=</span> (a, b) -&gt; a + b;</span><br><span class="line">        System.out.println(add.operate(<span class="number">5</span>, <span class="number">3</span>));  <span class="comment">// è¾“å‡º: 8</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ–¹æ³•å¼•ç”¨"><a href="#æ–¹æ³•å¼•ç”¨" class="headerlink" title="æ–¹æ³•å¼•ç”¨"></a>æ–¹æ³•å¼•ç”¨</h4><p><strong>ä½œç”¨</strong>ï¼šç®€åŒ– Lambda è¡¨è¾¾å¼ï¼Œç›´æ¥å¼•ç”¨å·²æœ‰æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; names = Arrays.asList(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Lambda è¡¨è¾¾å¼</span></span><br><span class="line">names.forEach(s -&gt; System.out.println(s));</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•å¼•ç”¨</span></span><br><span class="line">names.forEach(System.out::println);  <span class="comment">// è¾“å‡ºæ‰€æœ‰å…ƒç´ </span></span><br></pre></td></tr></table></figure><h4 id="é»˜è®¤æ–¹æ³•"><a href="#é»˜è®¤æ–¹æ³•" class="headerlink" title="é»˜è®¤æ–¹æ³•"></a>é»˜è®¤æ–¹æ³•</h4><p><strong>ä½œç”¨</strong>ï¼šåœ¨æ¥å£ä¸­æä¾›é»˜è®¤å®ç°ï¼Œé¿å…ç ´åç°æœ‰å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯ä¸€è¾†è½¦!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> <span class="keyword">implements</span> <span class="title class_">Vehicle</span> &#123;&#125;  <span class="comment">// æ— éœ€å®ç°printæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Car</span>().print();  <span class="comment">// è¾“å‡º: æˆ‘æ˜¯ä¸€è¾†è½¦!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Stream-API"><a href="#Stream-API" class="headerlink" title="Stream API"></a>Stream API</h4><p><strong>ä½œç”¨</strong>ï¼šå‡½æ•°å¼å¤„ç†é›†åˆæ•°æ®ï¼ˆè¿‡æ»¤ã€æ˜ å°„ã€å½’çº¦ç­‰ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; numbers = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ±‚æ‰€æœ‰å¶æ•°çš„å¹³æ–¹å’Œ</span></span><br><span class="line"><span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> numbers.stream()</span><br><span class="line">        .filter(n -&gt; n % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line">        .map(n -&gt; n * n)</span><br><span class="line">        .reduce(<span class="number">0</span>, Integer::sum);</span><br><span class="line"></span><br><span class="line">System.out.println(sum);  <span class="comment">// è¾“å‡º: 20 (2^2 + 4^2)</span></span><br></pre></td></tr></table></figure><h4 id="Optional-ç±»"><a href="#Optional-ç±»" class="headerlink" title="Optional ç±»"></a>Optional ç±»</h4><p><strong>ä½œç”¨</strong>ï¼šä¼˜é›…å¤„ç† <code>null</code> å€¼ï¼Œé¿å… <code>NullPointerException</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;String&gt; name = Optional.ofNullable(getName());</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­˜åœ¨æ—¶è¾“å‡ºï¼Œä¸å­˜åœ¨è¾“å‡ºé»˜è®¤å€¼</span></span><br><span class="line">System.out.println(name.orElse(<span class="string">&quot;Unknown&quot;</span>));  </span><br><span class="line"></span><br><span class="line"><span class="comment">// å®‰å…¨ä½¿ç”¨æ–¹æ³•å¼•ç”¨</span></span><br><span class="line">name.ifPresent(System.out::println);  </span><br><span class="line"></span><br><span class="line">String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Math.random() &gt; <span class="number">0.5</span> ? <span class="string">&quot;Alice&quot;</span> : <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ–°çš„æ—¥æœŸæ—¶é—´-API"><a href="#æ–°çš„æ—¥æœŸæ—¶é—´-API" class="headerlink" title="æ–°çš„æ—¥æœŸæ—¶é—´ API"></a>æ–°çš„æ—¥æœŸæ—¶é—´ API</h4><p><strong>ä½œç”¨</strong>ï¼šè§£å†³æ—§ <code>java.util.Date</code> çº¿ç¨‹å®‰å…¨é—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å½“å‰æ—¥æœŸå’Œæ—¶é—´</span></span><br><span class="line"><span class="type">LocalDateTime</span> <span class="variable">now</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">System.out.println(<span class="string">&quot;å½“å‰æ—¶é—´: &quot;</span> + now);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ—¥æœŸæ“ä½œ</span></span><br><span class="line"><span class="type">LocalDate</span> <span class="variable">date</span> <span class="operator">=</span> LocalDate.of(<span class="number">2023</span>, Month.JANUARY, <span class="number">1</span>);</span><br><span class="line"><span class="type">LocalDate</span> <span class="variable">nextWeek</span> <span class="operator">=</span> date.plusWeeks(<span class="number">1</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;ä¸‹å‘¨æ—¥æœŸ: &quot;</span> + nextWeek);  <span class="comment">// 2023-01-08</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¡ç®—æ—¶é—´å·®</span></span><br><span class="line"><span class="type">Duration</span> <span class="variable">duration</span> <span class="operator">=</span> Duration.between(LocalTime.NOON, LocalTime.now());</span><br><span class="line">System.out.println(<span class="string">&quot;è·ä¸­åˆè¿‡å»ç§’æ•°: &quot;</span> + duration.getSeconds());</span><br></pre></td></tr></table></figure><h3 id="Java-11"><a href="#Java-11" class="headerlink" title="Java 11"></a>Java 11</h3><h4 id="å±€éƒ¨å˜é‡ç±»å‹æ¨æ–­å¢å¼º"><a href="#å±€éƒ¨å˜é‡ç±»å‹æ¨æ–­å¢å¼º" class="headerlink" title="å±€éƒ¨å˜é‡ç±»å‹æ¨æ–­å¢å¼º"></a>å±€éƒ¨å˜é‡ç±»å‹æ¨æ–­å¢å¼º</h4><p>å…è®¸åœ¨Lambdaè¡¨è¾¾å¼ä¸­ä½¿ç”¨<code>var</code>å£°æ˜å‚æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LambdaVarExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;String&gt; names = List.of(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åœ¨Lambdaä¸­ä½¿ç”¨varå£°æ˜å‚æ•°</span></span><br><span class="line">        names.forEach((<span class="keyword">var</span> name) -&gt; System.out.println(name));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ–°çš„å­—ç¬¦ä¸²æ–¹æ³•"><a href="#æ–°çš„å­—ç¬¦ä¸²æ–¹æ³•" class="headerlink" title="æ–°çš„å­—ç¬¦ä¸²æ–¹æ³•"></a>æ–°çš„å­—ç¬¦ä¸²æ–¹æ³•</h4><p>æ–°å¢<code>isBlank()</code>ã€<code>lines()</code>ã€<code>strip()</code>ã€<code>repeat()</code>ç­‰æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringMethodsDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// isBlank(): æ£€æŸ¥ç©ºæˆ–ç©ºç™½</span></span><br><span class="line">        System.out.println(<span class="string">&quot; &quot;</span>.isBlank()); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// lines(): åˆ†å‰²ä¸ºè¡Œæµ</span></span><br><span class="line">        <span class="string">&quot;Line1\nLine2&quot;</span>.lines().forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// strip(): å»é™¤é¦–å°¾ç©ºç™½ï¼ˆæ¯”trim()æ›´æ™ºèƒ½ï¼‰</span></span><br><span class="line">        System.out.println(<span class="string">&quot;  Hello  &quot;</span>.strip()); <span class="comment">// &quot;Hello&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// repeat(): é‡å¤å­—ç¬¦ä¸²</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Java&quot;</span>.repeat(<span class="number">3</span>)); <span class="comment">// &quot;JavaJavaJava&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ ‡å‡†HTTPå®¢æˆ·ç«¯"><a href="#æ ‡å‡†HTTPå®¢æˆ·ç«¯" class="headerlink" title="æ ‡å‡†HTTPå®¢æˆ·ç«¯"></a>æ ‡å‡†HTTPå®¢æˆ·ç«¯</h4><p>æ›¿ä»£æ—§<code>HttpURLConnection</code>ï¼Œæ”¯æŒHTTP&#x2F;2å’ŒWebSocketã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.net.http.HttpClient;</span><br><span class="line"><span class="keyword">import</span> java.net.http.HttpRequest;</span><br><span class="line"><span class="keyword">import</span> java.net.http.HttpResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpClientDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">HttpClient</span> <span class="variable">client</span> <span class="operator">=</span> HttpClient.newHttpClient();</span><br><span class="line">        <span class="type">HttpRequest</span> <span class="variable">request</span> <span class="operator">=</span> HttpRequest.newBuilder()</span><br><span class="line">                .uri(URI.create(<span class="string">&quot;https://httpbin.org/get&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘é€åŒæ­¥è¯·æ±‚</span></span><br><span class="line">        HttpResponse&lt;String&gt; response = </span><br><span class="line">            client.send(request, HttpResponse.BodyHandlers.ofString());</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;Status: &quot;</span> + response.statusCode());</span><br><span class="line">        System.out.println(<span class="string">&quot;Body: &quot;</span> + response.body());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ–‡ä»¶è¯»å†™ç®€åŒ–"><a href="#æ–‡ä»¶è¯»å†™ç®€åŒ–" class="headerlink" title="æ–‡ä»¶è¯»å†™ç®€åŒ–"></a>æ–‡ä»¶è¯»å†™ç®€åŒ–</h4><p>æ–°å¢<code>readString()</code>å’Œ<code>writeString()</code>æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.nio.file.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileReadWriteDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Path</span> <span class="variable">path</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;test.txt&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å†™å…¥æ–‡ä»¶</span></span><br><span class="line">        Files.writeString(path, <span class="string">&quot;Hello Java 11!&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è¯»å–æ–‡ä»¶</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> Files.readString(path);</span><br><span class="line">        System.out.println(content); <span class="comment">// &quot;Hello Java 11!&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é›†åˆè½¬æ•°ç»„çš„ä¾¿æ·æ–¹æ³•"><a href="#é›†åˆè½¬æ•°ç»„çš„ä¾¿æ·æ–¹æ³•" class="headerlink" title="é›†åˆè½¬æ•°ç»„çš„ä¾¿æ·æ–¹æ³•"></a>é›†åˆè½¬æ•°ç»„çš„ä¾¿æ·æ–¹æ³•</h4><p><code>Collection.toArray(IntFunction)</code>ç®€åŒ–æ•°ç»„è½¬æ¢ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CollectionToArrayDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;String&gt; list = List.of(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç›´æ¥ä¼ å…¥æ•°ç»„æ„é€ å‡½æ•°å¼•ç”¨</span></span><br><span class="line">        String[] array = list.toArray(String[]::<span class="keyword">new</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (String s : array) &#123;</span><br><span class="line">            System.out.println(s); <span class="comment">// è¾“å‡ºA, B, C</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Java-17"><a href="#Java-17" class="headerlink" title="Java 17"></a>Java 17</h3><h4 id="æ¨¡å¼åŒ¹é…-instanceof"><a href="#æ¨¡å¼åŒ¹é…-instanceof" class="headerlink" title="æ¨¡å¼åŒ¹é… instanceof"></a>æ¨¡å¼åŒ¹é… <code>instanceof</code></h4><p>ç®€åŒ–ç±»å‹æ£€æŸ¥å’Œè½¬æ¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="string">&quot;Hello Java 17&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ—§å†™æ³•</span></span><br><span class="line"><span class="keyword">if</span> (obj <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> (String) obj;</span><br><span class="line">    System.out.println(s.toLowerCase());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°å†™æ³•ï¼šè‡ªåŠ¨ç±»å‹è½¬æ¢</span></span><br><span class="line"><span class="keyword">if</span> (obj <span class="keyword">instanceof</span> String s) &#123;</span><br><span class="line">    System.out.println(s.toLowerCase()); <span class="comment">// ç›´æ¥ä½¿ç”¨å˜é‡ s</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ–‡æœ¬å—"><a href="#æ–‡æœ¬å—" class="headerlink" title="æ–‡æœ¬å—"></a>æ–‡æœ¬å—</h4><p>ç®€åŒ–å¤šè¡Œå­—ç¬¦ä¸²å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ—§å†™æ³•ï¼ˆéœ€æ‰‹åŠ¨æ¢è¡Œå’Œè½¬ä¹‰ï¼‰</span></span><br><span class="line"><span class="type">String</span> <span class="variable">oldHtml</span> <span class="operator">=</span> <span class="string">&quot;&lt;html&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  &lt;body&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;     &lt;p&gt;Hello&lt;/p&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  &lt;/body&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;/html&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°å†™æ³•ï¼šæ–‡æœ¬å—ï¼ˆè‡ªåŠ¨ä¿ç•™æ ¼å¼ï¼‰</span></span><br><span class="line"><span class="type">String</span> <span class="variable">newHtml</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                &lt;html&gt;</span></span><br><span class="line"><span class="string">                  &lt;body&gt;</span></span><br><span class="line"><span class="string">                    &lt;p&gt;Hello Java 17&lt;/p&gt;</span></span><br><span class="line"><span class="string">                  &lt;/body&gt;</span></span><br><span class="line"><span class="string">                &lt;/html&gt;</span></span><br><span class="line"><span class="string">                &quot;&quot;&quot;</span>;</span><br><span class="line">System.out.println(newHtml);</span><br></pre></td></tr></table></figure><h4 id="ä¼ªéšæœºæ•°ç”Ÿæˆå™¨-API"><a href="#ä¼ªéšæœºæ•°ç”Ÿæˆå™¨-API" class="headerlink" title="ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ API"></a>ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ API</h4><p>ç»Ÿä¸€éšæœºæ•°ç”Ÿæˆå™¨æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.random.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RandomDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// é€‰æ‹©ç®—æ³•ï¼ˆå¦‚ L32X64MixRandomï¼‰</span></span><br><span class="line">        <span class="type">RandomGenerator</span> <span class="variable">generator</span> <span class="operator">=</span> RandomGeneratorFactory.of(<span class="string">&quot;L32X64MixRandom&quot;</span>).create();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç”Ÿæˆéšæœºæ•°</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">randomNum</span> <span class="operator">=</span> generator.nextInt(<span class="number">100</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Random: &quot;</span> + randomNum);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Java-21"><a href="#Java-21" class="headerlink" title="Java 21"></a>Java 21</h3><h4 id="è™šæ‹Ÿçº¿ç¨‹"><a href="#è™šæ‹Ÿçº¿ç¨‹" class="headerlink" title="è™šæ‹Ÿçº¿ç¨‹"></a>è™šæ‹Ÿçº¿ç¨‹</h4><p>è½»é‡çº§çº¿ç¨‹ï¼Œæ˜¾è‘—æå‡å¹¶å‘æ€§èƒ½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">var</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newVirtualThreadPerTaskExecutor()) &#123;</span><br><span class="line">    IntStream.range(<span class="number">0</span>, <span class="number">10_000</span>).forEach(i -&gt; </span><br><span class="line">        executor.submit(() -&gt; &#123;</span><br><span class="line">            Thread.sleep(Duration.ofSeconds(<span class="number">1</span>));</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;)</span><br><span class="line">    );</span><br><span class="line">&#125; <span class="comment">// è‡ªåŠ¨ç­‰å¾…æ‰€æœ‰çº¿ç¨‹ç»“æŸ</span></span><br></pre></td></tr></table></figure><h4 id="ç»“æ„åŒ–å¹¶å‘"><a href="#ç»“æ„åŒ–å¹¶å‘" class="headerlink" title="ç»“æ„åŒ–å¹¶å‘"></a>ç»“æ„åŒ–å¹¶å‘</h4><p>ç®€åŒ–å¤šçº¿ç¨‹ä»»åŠ¡ç®¡ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">var</span> <span class="variable">scope</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StructuredTaskScope</span>.ShutdownOnFailure()) &#123;</span><br><span class="line">    Future&lt;String&gt; user  = scope.fork(() -&gt; fetchUser());</span><br><span class="line">    Future&lt;Integer&gt; order = scope.fork(() -&gt; fetchOrder());</span><br><span class="line"></span><br><span class="line">    scope.join();          <span class="comment">// ç­‰å¾…æ‰€æœ‰ä»»åŠ¡</span></span><br><span class="line">    scope.throwIfFailed(); <span class="comment">// å¼‚å¸¸ä¼ æ’­</span></span><br><span class="line"></span><br><span class="line">    System.out.println(user.resultNow() + <span class="string">&quot;: &quot;</span> + order.resultNow());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="JavaåŸºç¡€"><a href="#JavaåŸºç¡€" class="headerlink" title="JavaåŸºç¡€"></a>JavaåŸºç¡€</h2><h3 id="è¯­æ³•åŸºç¡€"><a href="#è¯­æ³•åŸºç¡€" class="headerlink" title="è¯­æ³•åŸºç¡€"></a>è¯­æ³•åŸºç¡€</h3><h4 id="å’Œequalsçš„åŒºåˆ«"><a href="#å’Œequalsçš„åŒºåˆ«" class="headerlink" title="==å’Œequalsçš„åŒºåˆ«"></a><code>==</code>å’Œ<code>equals</code>çš„åŒºåˆ«</h4><p><code>==</code> ç”¨äºæ¯”è¾ƒåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼æˆ–å¯¹è±¡å¼•ç”¨çš„å†…å­˜åœ°å€ï¼Œ<code>equals</code> ç”¨æˆ·æ¯”è¾ƒå¯¹è±¡å†…å®¹ã€‚</p><h4 id="equalså’ŒhashCodeä¸ºä»€ä¹ˆè¦åŒæ—¶é‡å†™"><a href="#equalså’ŒhashCodeä¸ºä»€ä¹ˆè¦åŒæ—¶é‡å†™" class="headerlink" title="equalså’ŒhashCodeä¸ºä»€ä¹ˆè¦åŒæ—¶é‡å†™"></a><code>equals</code>å’Œ<code>hashCode</code>ä¸ºä»€ä¹ˆè¦åŒæ—¶é‡å†™</h4><ol><li>å¥‘çº¦è¦æ±‚ï¼šå¯¹è±¡ç›¸ç­‰æ€§çš„ä¸€è‡´æ€§</li></ol><ul><li><p><strong><code>Object</code>ç±»çš„è§„èŒƒ</strong>æ˜ç¡®è§„å®šï¼š</p><blockquote><p>å¦‚æœä¸¤ä¸ªå¯¹è±¡é€šè¿‡<code>equals()</code>æ–¹æ³•æ¯”è¾ƒæ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆå®ƒä»¬çš„<code>hashCode()</code><strong>å¿…é¡»</strong>è¿”å›ç›¸åŒçš„å€¼ã€‚</p></blockquote></li><li><p>å¦‚æœè¿åæ­¤å¥‘çº¦ï¼Œå¯¹è±¡åœ¨åŸºäºå“ˆå¸Œçš„é›†åˆä¸­ä¼šå‡ºç°ä¸å¯é¢„æµ‹çš„è¡Œä¸ºï¼ˆå¦‚<code>HashMap</code>æ— æ³•æ­£ç¡®æŸ¥æ‰¾å¯¹è±¡ï¼‰ã€‚</p></li></ul><ol start="2"><li>åŸºäºå“ˆå¸Œçš„é›†åˆï¼ˆå¦‚<code>HashMap</code>, <code>HashSet</code>ï¼‰ä¾èµ–<code>hashCode()</code>å’Œ<code>equals()</code>ååŒå·¥ä½œï¼š</li></ol><ul><li><p><strong><code>hashCode()</code>å®šä½æ¡¶ï¼ˆBucketï¼‰</strong>ï¼š<br>é›†åˆé¦–å…ˆè°ƒç”¨<code>hashCode()</code>ç¡®å®šå¯¹è±¡å­˜å‚¨åœ¨å“ªä¸ªå“ˆå¸Œæ¡¶ä¸­ã€‚</p></li><li><p><strong><code>equals()</code>ç¡®è®¤å”¯ä¸€æ€§</strong>ï¼š<br>åœ¨åŒä¸€ä¸ªæ¡¶å†…ï¼Œå†è°ƒç”¨<code>equals()</code>æ£€æŸ¥å¯¹è±¡æ˜¯å¦çœŸæ­£ç›¸ç­‰ï¼ˆè§£å†³å“ˆå¸Œå†²çªï¼‰ã€‚</p></li></ul><ol start="3"><li><p>å‡è®¾åªé‡å†™äº†<code>equals()</code>ä½†æœªé‡å†™<code>hashCode()</code>ï¼š</p><ul><li><p><strong>åœºæ™¯</strong>ï¼šä¸¤ä¸ªå¯¹è±¡<code>a</code>å’Œ<code>b</code>æ»¡è¶³<code>a.equals(b) == true</code>ï¼Œä½†<code>a.hashCode() != b.hashCode()</code>ã€‚</p></li><li><p><strong>é—®é¢˜</strong>ï¼š</p><ul><li>å®ƒä»¬ä¼šè¢«å­˜å…¥<code>HashMap</code>çš„<strong>ä¸åŒæ¡¶</strong>ä¸­ï¼ˆå› ä¸ºå“ˆå¸Œå€¼ä¸åŒï¼Œæœªé‡å†™çš„<code>hasoCode()</code>é»˜è®¤è¿”å›å†…å­˜åœ°å€ï¼‰ã€‚</li><li><code>map.put(a, val1)</code>å’Œ<code>map.put(b, val2)</code>ä¼šåŒæ—¶å­˜åœ¨ï¼Œè¿å<code>Map</code>çš„é”®å”¯ä¸€æ€§ã€‚</li></ul></li><li><p>ç¤ºä¾‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="comment">// é‡å†™equalsä½†æœªé‡å†™hashCode</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> (Person) o;</span><br><span class="line">        <span class="keyword">return</span> Objects.equals(name, person.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Person</span> <span class="variable">p1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">    <span class="type">Person</span> <span class="variable">p2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    Set&lt;Person&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    set.add(p1);</span><br><span class="line">    set.add(p2);  <span class="comment">// p1.equals(p2)=trueï¼Œä½†Setä¼šå­˜å‚¨ä¸¤ä¸ªå¯¹è±¡ï¼</span></span><br><span class="line">    System.out.println(set.size()); <span class="comment">// è¾“å‡º2ï¼ˆé”™è¯¯ï¼Œåº”ä¸º1ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>é‡å†™<code>hashCode()</code>éœ€æ»¡è¶³ï¼š</p><ul><li><strong>ä¸€è‡´æ€§</strong>ï¼šå¦‚æœ<code>a.equals(b)</code>ï¼Œåˆ™<code>a.hashCode() == b.hashCode()</code>ã€‚</li><li><strong>ç¨³å®šæ€§</strong>ï¼šåœ¨å¯¹è±¡çŠ¶æ€ä¸å˜æ—¶ï¼Œå¤šæ¬¡è°ƒç”¨<code>hashCode()</code>åº”è¿”å›ç›¸åŒå€¼ã€‚</li><li><strong>é«˜æ•ˆæ€§</strong>ï¼šå°½é‡å‡å°‘å“ˆå¸Œå†²çªï¼ˆä¸åŒå¯¹è±¡å°½é‡è¿”å›ä¸åŒå“ˆå¸Œå€¼ï¼‰ã€‚</li></ul><p><strong>æ¨èæ–¹æ³•</strong>ï¼ˆä½¿ç”¨<code>Objects.hash()</code>ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Objects.hash(name, age); <span class="comment">// åŒ…å«æ‰€æœ‰equalsä¸­ä½¿ç”¨çš„å­—æ®µ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="å¼‚å¸¸çš„å±‚æ¬¡ç»“æ„"><a href="#å¼‚å¸¸çš„å±‚æ¬¡ç»“æ„" class="headerlink" title="å¼‚å¸¸çš„å±‚æ¬¡ç»“æ„"></a>å¼‚å¸¸çš„å±‚æ¬¡ç»“æ„</h4><p><code>Throwable</code>ï¼šæ‰€æœ‰å¼‚å¸¸å’Œé”™è¯¯çš„çˆ¶ç±»</p><p><code>Error</code>ï¼š</p><ul><li><strong>ç³»ç»Ÿçº§ä¸¥é‡é—®é¢˜</strong>ï¼Œåº”ç”¨ç¨‹åºé€šå¸¸æ— æ³•æ¢å¤</li><li>ç¤ºä¾‹ï¼š<ul><li><code>OutOfMemoryError</code>ï¼šå†…å­˜è€—å°½</li><li><code>StackOverflowError</code>ï¼šæ ˆæº¢å‡º</li><li><code>VirtualMachineError</code>ï¼šJVMè‡´å‘½é”™è¯¯</li></ul></li><li>â— <strong>æ— éœ€æ•è·å¤„ç†</strong>ï¼ˆå³ä½¿æ•è·ä¹Ÿéš¾ä»¥æ¢å¤ï¼‰</li></ul><p><code>Exception</code>ï¼š</p><ol><li><ul><li><p><strong>ç¨‹åºå¯å¤„ç†çš„å¼‚å¸¸</strong>ï¼Œåˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li><p><strong>Checked Exceptionsï¼ˆå—æ£€å¼‚å¸¸ï¼‰</strong><br>ç¼–è¯‘å™¨å¼ºåˆ¶è¦æ±‚å¤„ç†ï¼ˆå¿…é¡»<code>try-catch</code>æˆ–<code>throws</code>ï¼‰<br>âœ… <strong>å…¸å‹ä»£è¡¨</strong>ï¼š<code>IOException</code>ã€<code>SQLException</code>ã€<code>ClassNotFoundException</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¿…é¡»å¤„ç†IOExceptionçš„ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  Files.readString(Path.of(<span class="string">&quot;file.txt&quot;</span>));</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123; <span class="comment">// å¿…é¡»æ•è·</span></span><br><span class="line">  e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong><code>RuntimeException</code>ï¼ˆè¿è¡Œæ—¶å¼‚å¸¸&#x2F;éå—æ£€å¼‚å¸¸ï¼‰</strong><br>ç¼–è¯‘å™¨ä¸å¼ºåˆ¶å¤„ç†ï¼Œé€šå¸¸ç”±<strong>ç¼–ç¨‹é€»è¾‘é”™è¯¯</strong>å¼•èµ·<br>âš ï¸ <strong>å…¸å‹ä»£è¡¨</strong>ï¼š<code>NullPointerException</code>ã€<code>IndexOutOfBoundsException</code>ã€<code>IllegalArgumentException</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯é€‰çš„è¿è¡Œæ—¶å¼‚å¸¸å¤„ç†</span></span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  System.out.println(str.length()); <span class="comment">// æŠ›å‡ºNullPointerException</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (RuntimeException e) &#123; <span class="comment">// éå¼ºåˆ¶æ•è·</span></span><br><span class="line">  System.out.println(<span class="string">&quot;é€»è¾‘é”™è¯¯ï¼&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li></ul></li></ol><img src="/post/65a5b0d7/image-20250720163023390.png" class="" title="image-20250720163023390"><h3 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h3><h4 id="ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹"><a href="#ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹"></a>ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹</h4><p>æ³›å‹ï¼ˆGenericsï¼‰æ˜¯ç°ä»£ç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚ Javaã€C#ã€C++ã€TypeScript ç­‰ï¼‰ä¸­ä¸€é¡¹æå…¶é‡è¦çš„ç‰¹æ€§ï¼Œå®ƒçš„å‡ºç°ä¸»è¦æ˜¯ä¸ºäº†è§£å†³<strong>ä»£ç å¤ç”¨</strong>ã€<strong>ç±»å‹å®‰å…¨</strong>å’Œ<strong>å¯è¯»æ€§</strong>è¿™ä¸‰å¤§æ ¸å¿ƒé—®é¢˜ã€‚</p><p>ğŸ“ 1. <strong>ç±»å‹å®‰å…¨ï¼ˆType Safetyï¼‰</strong></p><ul><li><strong>é—®é¢˜ï¼š</strong> åœ¨æ²¡æœ‰æ³›å‹ä¹‹å‰ï¼ˆä¾‹å¦‚ä½¿ç”¨ Java çš„ <code>Object</code> æˆ– C# çš„ <code>object</code>ï¼‰ï¼Œå®¹å™¨ç±»ï¼ˆå¦‚é›†åˆ <code>List</code>ã€<code>Array</code>ï¼‰å¯ä»¥å­˜æ”¾ä»»ä½•ç±»å‹çš„å¯¹è±¡ã€‚å½“ä½ ä»å®¹å™¨ä¸­å–å‡ºå¯¹è±¡æ—¶ï¼Œä½ éœ€è¦è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ (<code>(String) myList.get(0)</code>)ã€‚</li><li><strong>é£é™©ï¼š</strong> å¦‚æœå®¹å™¨é‡Œä¸å°å¿ƒæ”¾å…¥äº†é”™è¯¯çš„ç±»å‹ï¼ˆæ¯”å¦‚ä½ æœŸæœ›æ˜¯ <code>String</code>ï¼Œä½†å®é™…æ”¾å…¥äº† <code>Integer</code>ï¼‰ï¼Œè¿™ä¸ªé”™è¯¯åœ¨<strong>ç¼–è¯‘æ—¶ä¸ä¼šè¢«å‘ç°</strong>ï¼Œåªæœ‰åœ¨<strong>è¿è¡Œæ—¶è¿›è¡Œå¼ºåˆ¶è½¬æ¢æ—¶</strong>æ‰ä¼šæŠ›å‡º <code>ClassCastException</code>ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚</li><li><strong>æ³›å‹è§£å†³æ–¹æ¡ˆï¼š</strong> æ³›å‹å…è®¸ä½ åœ¨<strong>å£°æ˜</strong>å®¹å™¨æ—¶å°±æŒ‡å®šå®ƒåªèƒ½å­˜æ”¾ç‰¹å®šç±»å‹ï¼ˆå¦‚ <code>List&lt;String&gt;</code>ï¼‰ã€‚ç¼–è¯‘å™¨ä¼šåœ¨<strong>ç¼–è¯‘æ—¶</strong>ä¸¥æ ¼æ£€æŸ¥ä½ æ”¾å…¥å®¹å™¨çš„å¯¹è±¡ç±»å‹æ˜¯å¦åŒ¹é…ã€‚å¦‚æœå°è¯•æ”¾å…¥é”™è¯¯ç±»å‹ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥æŠ¥é”™ï¼Œé˜»æ­¢æ½œåœ¨çš„ç±»å‹é”™è¯¯è¿è¡Œåˆ°ç”Ÿäº§ç¯å¢ƒã€‚</li></ul><p>ğŸ” 2. <strong>æ¶ˆé™¤å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼ˆEliminating Castsï¼‰</strong></p><ul><li><strong>é—®é¢˜ï¼š</strong> ä½¿ç”¨åŸå§‹ç±»å‹ï¼ˆéæ³›å‹ï¼‰å®¹å™¨æ—¶ï¼Œæ¯æ¬¡å–å‡ºå…ƒç´ éƒ½éœ€è¦è¿›è¡Œæ˜¾å¼çš„ã€å†—é•¿çš„ã€å®¹æ˜“å‡ºé”™çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚ *   <strong>æ³›å‹è§£å†³æ–¹æ¡ˆï¼š</strong> ä½¿ç”¨æ³›å‹å®¹å™¨ï¼ˆå¦‚ <code>List&lt;String&gt;</code>ï¼‰åï¼Œå½“ä½ ä»å®¹å™¨ä¸­è·å–å…ƒç´ æ—¶ï¼ˆå¦‚ <code>String s = myList.get(0);</code>ï¼‰ï¼Œ<strong>ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨çŸ¥é“è¿”å›çš„æ˜¯ <code>String</code> ç±»å‹ï¼Œä¸éœ€è¦ä»»ä½•å¼ºåˆ¶è½¬æ¢</strong>ã€‚ä»£ç æ›´ç®€æ´ï¼Œæ›´å®‰å…¨ã€‚</li></ul><p>â™» 3. <strong>ä»£ç å¤ç”¨ï¼ˆCode Reuseï¼‰</strong></p><ul><li><strong>é—®é¢˜ï¼š</strong> ç¼–å†™ä¸€ä¸ªç®—æ³•ï¼ˆæ¯”å¦‚æ’åºã€æœç´¢ã€æ¯”è¾ƒï¼‰ï¼Œä½ å¸Œæœ›å®ƒèƒ½ä½œç”¨äºå¤šç§ä¸åŒç±»å‹çš„å¯¹è±¡ï¼ˆæ•´æ•°ã€å­—ç¬¦ä¸²ã€è‡ªå®šä¹‰å¯¹è±¡ç­‰ï¼‰ã€‚æ²¡æœ‰æ³›å‹æ—¶ï¼Œä½ éœ€è¦ä¸ºæ¯ç§ç±»å‹é‡å†™ç®—æ³•ï¼Œæˆ–è€…ä½¿ç”¨ <code>Object</code> å¹¶ä¼´éšç±»å‹æ£€æŸ¥å’Œè½¬æ¢ã€‚</li><li><strong>æ³›å‹è§£å†³æ–¹æ¡ˆï¼š</strong> æ³›å‹å…è®¸ä½ ç¼–å†™<strong>ç±»å‹æ— å…³çš„ç®—æ³•</strong>ã€‚ä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªæ“ä½œåœ¨ç±»å‹å‚æ•° <code>T</code> ä¸Šçš„æ–¹æ³•æˆ–ç±»ï¼ˆä¾‹å¦‚ <code>public static &lt;T&gt; void sort(List&lt;T&gt; list, Comparator&lt;? super T&gt; c)</code>ï¼‰ã€‚åªè¦ç±»å‹ <code>T</code> æ»¡è¶³ç®—æ³•æ‰€éœ€çš„åŸºæœ¬æ¡ä»¶ï¼ˆæ¯”å¦‚å®ç°äº† <code>Comparable</code> æ¥å£ï¼‰ï¼ŒåŒä¸€ä¸ªç®—æ³•ä»£ç å°±å¯ä»¥å®‰å…¨åœ°åº”ç”¨äºå„ç§ä¸åŒçš„æ•°æ®ç±»å‹ã€‚</li></ul><p>ğŸ“– 4. <strong>æé«˜ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼ˆImproved Readability &amp; Maintainabilityï¼‰</strong></p><ul><li><strong>é—®é¢˜ï¼š</strong> ä½¿ç”¨åŸå§‹ç±»å‹æˆ– <code>Object</code>ï¼Œä»£ç çš„æ„å›¾å˜å¾—æ¨¡ç³Šã€‚é˜…è¯»ä»£ç çš„äººéœ€è¦ä»”ç»†æŸ¥çœ‹ä¸Šä¸‹æ–‡ï¼ˆæˆ–è€…æ³¨é‡Šï¼‰æ‰èƒ½ç†è§£æŸä¸ªå®¹å™¨é¢„æœŸå­˜æ”¾ä»€ä¹ˆç±»å‹çš„æ•°æ®ã€‚</li><li><strong>æ³›å‹è§£å†³æ–¹æ¡ˆï¼š</strong> æ³›å‹å£°æ˜ï¼ˆå¦‚ <code>Map&lt;String, Customer&gt;</code>ï¼‰æœ¬èº«å°±æ˜¯<strong>æ¸…æ™°ã€è‡ªæ–‡æ¡£åŒ–çš„ä»£ç </strong>ã€‚å®ƒæ˜ç¡®åœ°å‘Šè¯‰å¼€å‘è€…å’Œç¼–è¯‘å™¨ï¼šè¿™ä¸ªå®¹å™¨æ˜¯åšä»€ä¹ˆç”¨çš„ï¼ˆå­˜å‚¨é”®ä¸º <code>String</code>ã€å€¼ä¸º <code>Customer</code> çš„æ˜ å°„ï¼‰ã€‚è¿™ä½¿å¾—ä»£ç æ›´å®¹æ˜“ç†è§£ã€ç»´æŠ¤å’Œè°ƒè¯•ã€‚</li></ul><h4 id="ä»€ä¹ˆæ˜¯æ³›å‹æ“¦é™¤"><a href="#ä»€ä¹ˆæ˜¯æ³›å‹æ“¦é™¤" class="headerlink" title="ä»€ä¹ˆæ˜¯æ³›å‹æ“¦é™¤"></a>ä»€ä¹ˆæ˜¯æ³›å‹æ“¦é™¤</h4><p>æ³›å‹æ“¦é™¤ï¼ˆType Erasureï¼‰æ˜¯ <strong>Java æ³›å‹å®ç°çš„æ ¸å¿ƒæœºåˆ¶</strong>ï¼Œå®ƒæŒ‡ç¼–è¯‘å™¨åœ¨ç¼–è¯‘é˜¶æ®µ<strong>ç§»é™¤æ‰€æœ‰æ³›å‹ç±»å‹ä¿¡æ¯</strong>ï¼Œå°†å…¶æ›¿æ¢ä¸ºåŸå§‹ç±»å‹ï¼ˆRaw Typeï¼‰æˆ–è¾¹ç•Œç±»å‹ï¼ˆBound Typeï¼‰ï¼Œå¹¶åœ¨å¿…è¦æ—¶æ’å…¥å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚è¿™ä¸€è®¾è®¡ä¸»è¦æ˜¯ä¸ºäº†<strong>å…¼å®¹æ—§ç‰ˆæœ¬çš„ Javaï¼ˆJDK 5 ä¹‹å‰ï¼‰</strong>ï¼Œç¡®ä¿æ³›å‹ä»£ç èƒ½ä¸éæ³›å‹é—ç•™ä»£ç äº’æ“ä½œã€‚</p><p><strong>ä¸€ã€æ³›å‹æ“¦é™¤çš„æ ¸å¿ƒè§„åˆ™</strong></p><ol><li><p><strong>ç±»å‹å‚æ•°æ›¿æ¢ä¸ºè¾¹ç•Œç±»å‹</strong></p><ul><li>è‹¥ç±»å‹å‚æ•°æœ‰ä¸Šé™ï¼ˆå¦‚ <code>&lt;T extends Number&gt;</code>ï¼‰ï¼Œ<code>T</code> è¢«æ›¿æ¢ä¸º<strong>è¾¹ç•Œç±»å‹</strong>ï¼ˆ<code>Number</code>ï¼‰ã€‚</li><li>è‹¥æ— æ˜ç¡®ä¸Šé™ï¼ˆå¦‚ <code>&lt;T&gt;</code>ï¼‰ï¼Œ<code>T</code> è¢«æ›¿æ¢ä¸º <code>Object</code>ã€‚</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¼–è¯‘å‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Box</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> T value;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T value)</span> &#123; <span class="built_in">this</span>.value = value; &#125;</span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–è¯‘åï¼ˆæ“¦é™¤åï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Box</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Object value;         <span class="comment">// T â†’ Object</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(Object value)</span> &#123; <span class="built_in">this</span>.value = value; &#125;</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">()</span> &#123; <span class="keyword">return</span> value; &#125; <span class="comment">// è¿”å› Object</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>åœ¨è°ƒç”¨å¤„æ’å…¥å¼ºåˆ¶ç±»å‹è½¬æ¢</strong><br>ç¼–è¯‘å™¨åœ¨<strong>ä½¿ç”¨æ³›å‹çš„åœ°æ–¹</strong>è‡ªåŠ¨æ·»åŠ ç±»å‹è½¬æ¢ä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¼–è¯‘å‰</span></span><br><span class="line">Box&lt;String&gt; box = <span class="keyword">new</span> <span class="title class_">Box</span>&lt;&gt;();</span><br><span class="line">box.set(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> box.get(); <span class="comment">// æ— éœ€æ˜¾å¼è½¬æ¢</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–è¯‘åï¼ˆæ“¦é™¤åï¼‰</span></span><br><span class="line"><span class="type">Box</span> <span class="variable">box</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Box</span>();</span><br><span class="line">box.set(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> (String) box.get(); <span class="comment">// ç¼–è¯‘å™¨æ’å…¥ (String) å¼ºåˆ¶è½¬æ¢</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ä¿è¯ç±»å‹å®‰å…¨çš„æ¡¥æ¥æ–¹æ³•ï¼ˆBridge Methodsï¼‰</strong><br>å½“æ³›å‹ç±»ç»§æ‰¿æˆ–å®ç°æ¥å£æ—¶ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆ<strong>åˆæˆæ–¹æ³•</strong>ç¡®ä¿å¤šæ€æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¼–è¯‘å‰</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Comparable</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(T other)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">String</span> <span class="keyword">implements</span> <span class="title class_">Comparable</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(String other)</span> &#123; ... &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–è¯‘åï¼ˆæ“¦é™¤åï¼‰</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">String</span> <span class="keyword">implements</span> <span class="title class_">Comparable</span> &#123;</span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨ç”Ÿæˆçš„æ¡¥æ¥æ–¹æ³•ï¼ˆä¿æŒå¤šæ€ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Object other)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> compareTo((String) other); <span class="comment">// è°ƒç”¨å®é™…æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®é™…ç¼–å†™çš„æ³›å‹æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(String other)</span> &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p><strong>äºŒã€æ³›å‹æ“¦é™¤å¯¼è‡´çš„å…³é”®é™åˆ¶</strong></p><ol><li><p><strong>æ— æ³•ä½¿ç”¨åŸºæœ¬ç±»å‹ä½œä¸ºç±»å‹å‚æ•°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼ä¸èƒ½ä½¿ç”¨ int</span></span><br><span class="line">List&lt;<span class="type">int</span>&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(); </span><br><span class="line"><span class="comment">// å¿…é¡»ä½¿ç”¨åŒ…è£…ç±»</span></span><br><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(); </span><br></pre></td></tr></table></figure></li><li><p><strong>æ— æ³•è·å–æ³›å‹å…·ä½“ç±»å‹çš„ <code>Class</code> å¯¹è±¡</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼List&lt;String&gt;.class ä¸å­˜åœ¨</span></span><br><span class="line">Class&lt;?&gt; clazz = list.getClass(); </span><br><span class="line"><span class="comment">// è¾“å‡ºï¼šjava.util.ArrayListï¼ˆæ— æ³•å¾—çŸ¥æ˜¯ List&lt;String&gt;ï¼‰</span></span><br></pre></td></tr></table></figure></li><li><p><strong>æ— æ³•ä½¿ç”¨ <code>instanceof</code> æ£€æŸ¥æ³›å‹ç±»å‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (list <span class="keyword">instanceof</span> List&lt;String&gt;) &#123; ... &#125; <span class="comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼</span></span><br><span class="line"><span class="keyword">if</span> (list <span class="keyword">instanceof</span> List&lt;?&gt;) &#123; ... &#125;      <span class="comment">// âœ… å…è®¸ï¼ˆä½†æ— å…·ä½“ç±»å‹ä¿¡æ¯ï¼‰</span></span><br></pre></td></tr></table></figure></li><li><p><strong>æ— æ³•åˆ›å»ºæ³›å‹æ•°ç»„</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼</span></span><br><span class="line">T[] array = <span class="keyword">new</span> <span class="title class_">T</span>[<span class="number">10</span>]; </span><br><span class="line"><span class="comment">// æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨åå°„æˆ– ArrayList</span></span><br></pre></td></tr></table></figure></li><li><p><strong>æ–¹æ³•ç­¾åå†²çªï¼ˆé‡è½½å¤±æ•ˆï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ç¼–è¯‘é”™è¯¯ï¼æ“¦é™¤åéƒ½æ˜¯ void print(List list)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">print</span><span class="params">(List&lt;String&gt; list)</span> &#123; ... &#125;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">print</span><span class="params">(List&lt;Integer&gt; list)</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure></li></ol><p><strong>ä¸‰ã€ä¸ºä»€ä¹ˆ Java é€‰æ‹©æ³›å‹æ“¦é™¤ï¼Ÿ</strong></p><ol><li><strong>å‘åå…¼å®¹æ€§ï¼ˆBackward Compatibilityï¼‰</strong><ul><li>ç¡®ä¿ JDK 5+ çš„æ³›å‹ä»£ç èƒ½è¿è¡Œåœ¨æ—§ JVMï¼ˆ1.4 æˆ–æ›´æ—©ï¼‰ä¸Šã€‚</li><li>éæ³›å‹é›†åˆï¼ˆå¦‚ <code>ArrayList</code>ï¼‰å’Œæ³›å‹é›†åˆï¼ˆ<code>ArrayList&lt;String&gt;</code>ï¼‰åœ¨ JVM å±‚é¢éƒ½æ˜¯åŒä¸€ä¸ªç±»ã€‚</li></ul></li><li><strong>è¿è¡Œæ—¶æ•ˆç‡ï¼ˆRuntime Efficiencyï¼‰</strong><ul><li>ä¸éœ€è¦ä¸ºæ¯ç§æ³›å‹ç»„åˆç”Ÿæˆæ–°çš„ç±»ï¼ˆå¦‚ C# çš„æ³›å‹å®ç°ï¼‰ï¼ŒèŠ‚çœå†…å­˜ã€‚</li><li>JVM æ— éœ€ä¿®æ”¹å³å¯æ”¯æŒæ³›å‹ï¼ˆä»…ç¼–è¯‘å™¨å±‚å¤„ç†ï¼‰ã€‚</li></ul></li></ol><p><strong>å››ã€å¦‚ä½•ç»•è¿‡æ“¦é™¤çš„é™åˆ¶ï¼Ÿ</strong></p><ol><li><p><strong>ç±»å‹ä»¤ç‰Œï¼ˆType Tokenï¼‰</strong><br>é€šè¿‡ä¼ é€’ <code>Class&lt;T&gt;</code> å¯¹è±¡ä¿ç•™ç±»å‹ä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Box</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Class&lt;T&gt; type;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Box</span><span class="params">(Class&lt;T&gt; type)</span> &#123; <span class="built_in">this</span>.type = type; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isInstance</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> type.isInstance(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>åå°„ APIï¼ˆReflectionï¼‰</strong><br>è¿è¡Œæ—¶è·å–æ³›å‹å‚æ•°ï¼ˆéœ€æ¥å£&#x2F;çˆ¶ç±»ä¿ç•™ä¿¡æ¯ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Type</span> <span class="variable">type</span> <span class="operator">=</span> myList.getClass().getGenericSuperclass();</span><br><span class="line"><span class="keyword">if</span> (type <span class="keyword">instanceof</span> ParameterizedType) &#123;</span><br><span class="line">    <span class="type">Type</span> <span class="variable">actualType</span> <span class="operator">=</span> ((ParameterizedType)type).getActualTypeArguments()[<span class="number">0</span>];</span><br><span class="line">    System.out.println(actualType); <span class="comment">// è¾“å‡ºå¦‚ String</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p><strong>äº”ã€ä¸å…¶ä»–è¯­è¨€æ³›å‹å®ç°çš„å¯¹æ¯”</strong></p><table><thead><tr><th align="left"><strong>è¯­è¨€</strong></th><th align="left"><strong>æ³›å‹å®ç°</strong></th><th align="left"><strong>è¿è¡Œæ—¶ç±»å‹ä¿ç•™</strong></th><th align="left"><strong>ç‰¹ç‚¹</strong></th></tr></thead><tbody><tr><td align="left">Java</td><td align="left">ç±»å‹æ“¦é™¤</td><td align="left">âŒ</td><td align="left">å…¼å®¹æ—§ç‰ˆï¼Œæ•ˆç‡é«˜</td></tr><tr><td align="left">C#</td><td align="left">å…·ç°åŒ–ï¼ˆReifiedï¼‰</td><td align="left">âœ…</td><td align="left">è¿è¡Œæ—¶ä¿ç•™ç±»å‹ï¼Œæ”¯æŒæ³›å‹æ•°ç»„</td></tr><tr><td align="left">Kotlin</td><td align="left">æ“¦é™¤ï¼ˆJVMä¸Šï¼‰</td><td align="left">âŒ</td><td align="left">é€šè¿‡ <code>inline</code> + <code>reified</code> ç»•è¿‡é™åˆ¶</td></tr><tr><td align="left">TypeScript</td><td align="left">ç¼–è¯‘æ—¶æ“¦é™¤</td><td align="left">âŒ</td><td align="left">ä»…é™æ€ç±»å‹æ£€æŸ¥</td></tr></tbody></table><p><strong>æ€»ç»“</strong></p><ul><li><strong>æ³›å‹æ“¦é™¤çš„æœ¬è´¨</strong>ï¼šç¼–è¯‘å™¨ç§»é™¤æ³›å‹ç±»å‹ä¿¡æ¯ï¼Œæ›¿æ¢ä¸ºåŸå§‹ç±»å‹ï¼ˆ<code>Object</code> æˆ–è¾¹ç•Œç±»å‹ï¼‰ï¼Œå¹¶åœ¨ä½¿ç”¨ç‚¹æ’å…¥å¼ºåˆ¶è½¬æ¢ã€‚</li><li><strong>ä¼˜ç‚¹</strong>ï¼šæ— ç¼å…¼å®¹æ—§ä»£ç ï¼Œè¿è¡Œæ—¶æ•ˆç‡é«˜ã€‚</li><li><strong>ä»£ä»·</strong>ï¼šè¿è¡Œæ—¶æ— æ³•è·å–æ³›å‹ç±»å‹ä¿¡æ¯ï¼Œå¯¼è‡´éƒ¨åˆ†æ“ä½œå—é™ï¼ˆå¦‚ <code>instanceof</code>ã€æ³›å‹æ•°ç»„ï¼‰ã€‚</li><li><strong>åº”å¯¹</strong>ï¼šé€šè¿‡ç±»å‹ä»¤ç‰Œã€åå°„æˆ–è®¾è®¡æ¨¡å¼ï¼ˆå¦‚å·¥å‚ï¼‰ç»•è¿‡é™åˆ¶ã€‚</li></ul><p>æ³›å‹æ“¦é™¤æ˜¯ Java åœ¨å…¼å®¹æ€§ä¸ç±»å‹å®‰å…¨ä¹‹é—´çš„æŠ˜è¡·æ–¹æ¡ˆï¼Œç†è§£å…¶åŸç†èƒ½å¸®åŠ©ä½ å†™å‡ºæ›´å¥å£®çš„æ³›å‹ä»£ç ï¼</p><h4 id="æ³›å‹çš„ä¸Šä¸‹é™åŠåº”ç”¨åœºæ™¯"><a href="#æ³›å‹çš„ä¸Šä¸‹é™åŠåº”ç”¨åœºæ™¯" class="headerlink" title="æ³›å‹çš„ä¸Šä¸‹é™åŠåº”ç”¨åœºæ™¯"></a>æ³›å‹çš„ä¸Šä¸‹é™åŠåº”ç”¨åœºæ™¯</h4><p>æ³›å‹çš„<strong>ä¸Šé™ï¼ˆUpper Boundï¼‰</strong> å’Œ<strong>ä¸‹é™ï¼ˆLower Boundï¼‰</strong> æ˜¯ç”¨äº<strong>çº¦æŸç±»å‹å‚æ•°èŒƒå›´</strong>çš„å…³é”®æœºåˆ¶ï¼Œä¸»è¦è§£å†³æ³›å‹ä»£ç éœ€è¦<strong>é™åˆ¶å¯æ¥å—çš„ç±»å‹</strong>æˆ–<strong>æ”¯æŒæ›´çµæ´»çš„å­ç±»å‹å…³ç³»</strong>çš„é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£é‡Šï¼š</p><p><strong>ä¸€ã€æ³›å‹çš„ä¸Šé™ï¼ˆUpper Boundï¼‰</strong></p><p>å®šä¹‰ï¼šé™åˆ¶ç±»å‹å‚æ•°å¿…é¡»æ˜¯<strong>æŸä¸ªç±»&#x2F;æ¥å£æœ¬èº«æˆ–å…¶å­ç±»</strong>ã€‚<br>è¯­æ³•ï¼š<code>&lt;T extends ç±»/æ¥å£&gt;</code> æˆ– <code>&lt;? extends ç±»/æ¥å£&gt;</code>ï¼ˆé€šé…ç¬¦å½¢å¼ï¼‰ã€‚</p><p><strong>æ ¸å¿ƒä½œç”¨</strong></p><ol><li><p><strong>ç¡®ä¿ç±»å‹å…·å¤‡æŸäº›èƒ½åŠ›</strong><br>è¦æ±‚ç±»å‹ <code>T</code> å¿…é¡»å®ç°ç‰¹å®šæ¥å£ï¼ˆå¦‚ <code>Comparable</code>ï¼‰æˆ–ç»§æ‰¿ç‰¹å®šç±»ï¼Œä»è€Œåœ¨æ³›å‹ä»£ç ä¸­å®‰å…¨è°ƒç”¨å…¶æ–¹æ³•ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼šè¦æ±‚ç±»å‹å¿…é¡»å¯æ¯”è¾ƒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// T å¿…é¡»æ˜¯å®ç°äº† Comparable æ¥å£çš„ç±»å‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T <span class="keyword">extends</span> <span class="title class_">Comparable</span>&lt;T&gt;&gt; T <span class="title function_">max</span><span class="params">(T a, T b)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a.compareTo(b) &gt; <span class="number">0</span> ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¯å®‰å…¨è°ƒç”¨ a.compareTo(b)</span></span><br></pre></td></tr></table></figure></li><li><p><strong>å®‰å…¨è®¿é—®æ•°æ®ï¼ˆåªè¯»ä¸å†™ï¼‰</strong><br>åœ¨é€šé…ç¬¦ <code>? extends T</code> ä¸­ï¼Œè¡¨ç¤ºâ€œæŸä¸ª <code>T</code> çš„å­ç±»å‹â€ï¼Œæ­¤æ—¶å®¹å™¨<strong>åªèƒ½è¯»å–æ•°æ®</strong>ï¼ˆè¿”å› <code>T</code> ç±»å‹ï¼‰ï¼Œ<strong>ä¸èƒ½å†™å…¥æ•°æ®</strong>ï¼ˆé™¤ <code>null</code> å¤–ï¼‰ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼šå®‰å…¨è¯»å–æ•°å­—é›†åˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">printNumbers</span><span class="params">(List&lt;? extends Number&gt; list)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (Number n : list) &#123;</span><br><span class="line">        System.out.println(n);  <span class="comment">// âœ… å¯è¯»</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// list.add(10); âŒ ç¼–è¯‘é”™è¯¯ï¼æ— æ³•å†™å…¥ï¼ˆé™¤ null å¤–ï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p><strong>å…¸å‹åœºæ™¯</strong></p><ul><li>å®šä¹‰æ³›å‹ç±»&#x2F;æ–¹æ³•æ—¶ï¼Œçº¦æŸç±»å‹å‚æ•°çš„èƒ½åŠ›ï¼ˆå¦‚ <code>T extends Runnable</code>ï¼‰ã€‚</li><li>ä½œä¸ºæ–¹æ³•å‚æ•°æ—¶ï¼Œå®‰å…¨æ¥æ”¶<strong>æŸç§å­ç±»å‹çš„é›†åˆ</strong>ï¼ˆç”Ÿäº§è€…åœºæ™¯ï¼‰ã€‚</li></ul><p><strong>äºŒã€æ³›å‹çš„ä¸‹é™ï¼ˆLower Boundï¼‰</strong></p><p>å®šä¹‰ï¼šé™åˆ¶ç±»å‹å‚æ•°å¿…é¡»æ˜¯<strong>æŸä¸ªç±»&#x2F;æ¥å£æœ¬èº«æˆ–å…¶çˆ¶ç±»</strong>ã€‚<br>è¯­æ³•ï¼š<code>&lt;? super ç±»/æ¥å£&gt;</code>ï¼ˆä»…é€šé…ç¬¦å½¢å¼ï¼‰ã€‚</p><p><strong>æ ¸å¿ƒä½œç”¨</strong></p><ol><li><p><strong>æ”¯æŒå®‰å…¨å†™å…¥æ•°æ®</strong><br>è¡¨ç¤ºâ€œæŸä¸ª <code>T</code> çš„çˆ¶ç±»å‹â€ï¼Œæ­¤æ—¶å®¹å™¨<strong>å¯ä»¥å†™å…¥ <code>T</code> åŠå…¶å­ç±»å‹å¯¹è±¡</strong>ï¼Œä½†è¯»å–æ—¶åªèƒ½è§†ä¸º <code>Object</code>ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼šå‘é›†åˆæ·»åŠ å…ƒç´ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">addNumbers</span><span class="params">(List&lt;? <span class="built_in">super</span> Integer&gt; list)</span> &#123;</span><br><span class="line">    list.add(<span class="number">10</span>);     <span class="comment">// âœ… å¯å†™å…¥ Integer</span></span><br><span class="line">    list.add(<span class="number">1000L</span>);  <span class="comment">// âŒ é”™è¯¯ï¼Long ä¸æ˜¯ Integer çš„å­ç±»</span></span><br><span class="line">    <span class="comment">// Object obj = list.get(0);  // è¯»å–æ—¶åªèƒ½è§†ä¸º Object</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>å®ç°çµæ´»çš„å­ç±»å‹å…¼å®¹</strong><br>å…è®¸æ–¹æ³•æ¥æ”¶æ¯”é¢„æœŸæ›´å®½æ³›çš„å®¹å™¨ï¼ˆå¦‚éœ€è¦ <code>List&lt;Number&gt;</code> æ—¶ï¼Œä¹Ÿå¯ä¼ å…¥ <code>List&lt;Object&gt;</code>ï¼‰ã€‚</p></li></ol><p><strong>å…¸å‹åœºæ™¯</strong></p><ul><li><p>å‘æ³›å‹å®¹å™¨<strong>å†™å…¥æ•°æ®</strong>ï¼ˆæ¶ˆè´¹è€…åœºæ™¯ï¼‰ã€‚</p></li><li><p>é…åˆ <code>Comparator</code> ç­‰æ¥å£å®ç°ç±»å‹çµæ´»çš„APIï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯æ¥æ”¶ Person æˆ–å…¶çˆ¶ç±»çš„ Comparator</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(List&lt;Person&gt; list, Comparator&lt;? <span class="built_in">super</span> Person&gt; comparator)</span> &#123;</span><br><span class="line">    Collections.sort(list, comparator);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>ä¸‰ã€å…³é”®å¯¹æ¯”ï¼š<code>extends</code> vs <code>super</code></strong></p><table><thead><tr><th align="left"><strong>ç‰¹æ€§</strong></th><th align="left"><strong>ä¸Šé™ (<code>? extends T</code>)</strong></th><th align="left"><strong>ä¸‹é™ (<code>? super T</code>)</strong></th></tr></thead><tbody><tr><td align="left"><strong>ç±»å‹èŒƒå›´</strong></td><td align="left"><code>T</code> æˆ–å…¶<strong>å­ç±»å‹</strong></td><td align="left"><code>T</code> æˆ–å…¶<strong>çˆ¶ç±»å‹</strong></td></tr><tr><td align="left"><strong>æ•°æ®è¯»å–</strong></td><td align="left">âœ… è¿”å› <code>T</code> ç±»å‹</td><td align="left">âŒ åªèƒ½è§†ä¸º <code>Object</code></td></tr><tr><td align="left"><strong>æ•°æ®å†™å…¥</strong></td><td align="left">âŒ ç¦æ­¢ï¼ˆé™¤ <code>null</code>ï¼‰</td><td align="left">âœ… å¯å†™å…¥ <code>T</code> <strong>åŠå…¶å­ç±»</strong></td></tr><tr><td align="left"><strong>è®¾è®¡æ„å›¾</strong></td><td align="left"><strong>ç”Ÿäº§è€…</strong>ï¼ˆProducerï¼‰åªæä¾›æ•°æ®</td><td align="left"><strong>æ¶ˆè´¹è€…</strong>ï¼ˆConsumerï¼‰åªæ¶ˆè´¹æ•°æ®</td></tr><tr><td align="left"><strong>ç»å…¸å£è¯€</strong></td><td align="left"><strong>PECS</strong> (Producer-Extends, Consumer-Super)</td><td align="left"></td></tr></tbody></table><p><strong>å››ã€å®é™…åº”ç”¨ï¼šPECS åŸåˆ™</strong></p><p>åœ¨æ³›å‹ç¼–ç¨‹ä¸­ï¼Œéµå¾ª <strong>PECSï¼ˆProducer-Extends, Consumer-Superï¼‰</strong> åŸåˆ™ï¼š</p><ul><li><strong>ç”Ÿäº§è€…ï¼ˆProducerï¼‰</strong>ï¼šäº§ç”Ÿ <code>T</code> çš„å¯¹è±¡ â†’ ç”¨ <code>&lt;? extends T&gt;</code></li><li><strong>æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰</strong>ï¼šæ¶ˆè´¹ <code>T</code> çš„å¯¹è±¡ â†’ ç”¨ <code>&lt;? super T&gt;</code></li></ul><p><strong>ç¤ºä¾‹</strong>ï¼šJava é›†åˆå·¥å…·ç±» <code>Collections.copy()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">copy</span><span class="params">(</span></span><br><span class="line"><span class="params">    List&lt;? <span class="built_in">super</span> T&gt; dest,    // æ¶ˆè´¹è€…ï¼šå†™å…¥ç›®æ ‡é›†åˆ</span></span><br><span class="line"><span class="params">    List&lt;? extends T&gt; src    // ç”Ÿäº§è€…ï¼šè¯»å–æºé›†åˆ</span></span><br><span class="line"><span class="params">)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; src.size(); i++) &#123;</span><br><span class="line">        dest.set(i, src.get(i));  <span class="comment">// âœ… å®‰å…¨è¯»å†™</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>äº”ã€ä½¿ç”¨åœºæ™¯æ€»ç»“</strong></p><table><thead><tr><th align="left"><strong>åœºæ™¯</strong></th><th align="left"><strong>æ¨èè¯­æ³•</strong></th><th align="left"><strong>ç¤ºä¾‹</strong></th></tr></thead><tbody><tr><td align="left">éœ€è¦è°ƒç”¨ç±»å‹ç‰¹å®šæ–¹æ³•</td><td align="left"><code>&lt;T extends Interface&gt;</code></td><td align="left"><code>T</code> å¿…é¡»å®ç°æŸä¸ªæ¥å£</td></tr><tr><td align="left">å®‰å…¨è¯»å–æ³›å‹é›†åˆå†…å®¹</td><td align="left"><code>&lt;? extends T&gt;</code></td><td align="left">éå† <code>List&lt;? extends Number&gt;</code></td></tr><tr><td align="left">å®‰å…¨å†™å…¥æ³›å‹é›†åˆ</td><td align="left"><code>&lt;? super T&gt;</code></td><td align="left">å‘ <code>List&lt;? super Integer&gt;</code> æ·»åŠ å€¼</td></tr><tr><td align="left">åŒæ—¶æ”¯æŒè¯»å†™</td><td align="left">ä½¿ç”¨ç¡®å®šçš„ç±»å‹å‚æ•° <code>T</code></td><td align="left"><code>List&lt;T&gt;</code></td></tr></tbody></table><h3 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h3><h4 id="ä»€ä¹ˆæ˜¯åå°„"><a href="#ä»€ä¹ˆæ˜¯åå°„" class="headerlink" title="ä»€ä¹ˆæ˜¯åå°„"></a>ä»€ä¹ˆæ˜¯åå°„</h4><p>åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ï¼›è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸º Java çš„åå°„æœºåˆ¶ã€‚</p><h4 id="åå°„çš„ä¼˜ç¼ºç‚¹"><a href="#åå°„çš„ä¼˜ç¼ºç‚¹" class="headerlink" title="åå°„çš„ä¼˜ç¼ºç‚¹"></a>åå°„çš„ä¼˜ç¼ºç‚¹</h4><ul><li><strong>ä¼˜ç‚¹ï¼š</strong><ul><li><strong>åŠ¨æ€æ€§ï¼š</strong> è¿è¡Œæ—¶æ‰ç¡®å®šç±»å‹ã€ç»‘å®šå¯¹è±¡ï¼Œæå¤§æé«˜äº†ç¨‹åºçš„çµæ´»æ€§å’Œæ‰©å±•æ€§ã€‚æ˜¯æ¡†æ¶è®¾è®¡çš„åŸºçŸ³ï¼ˆå¦‚ Spring çš„ IOCï¼‰ã€‚</li><li><strong>çµæ´»æ€§ï¼š</strong> å¯ä»¥è®¿é—®å’Œæ“ä½œç§æœ‰æˆå‘˜ï¼ˆé€šè¿‡ <code>setAccessible(true)</code>ï¼‰ï¼Œçªç ´å°è£…é™åˆ¶ï¼ˆéœ€è°¨æ…ï¼‰ã€‚</li><li><strong>é€šç”¨æ€§ï¼š</strong> å¯ä»¥ç¼–å†™éå¸¸é€šç”¨çš„ä»£ç ï¼ˆå¦‚é€šç”¨åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–å·¥å…·ã€å¯¹è±¡æ¯”è¾ƒå·¥å…·ã€åŠ¨æ€ä»£ç†ç­‰ï¼‰ã€‚</li></ul></li><li><strong>ç¼ºç‚¹ï¼š</strong><ul><li><strong>æ€§èƒ½å¼€é”€ï¼š</strong> åå°„æ“ä½œæ¯”ç›´æ¥è°ƒç”¨æ…¢å¾ˆå¤šã€‚å› ä¸ºæ¶‰åŠåŠ¨æ€ç±»å‹è§£æã€æ–¹æ³•æŸ¥æ‰¾ã€å®‰å…¨æ£€æŸ¥ç­‰ã€‚JVM éš¾ä»¥å¯¹å…¶ä¼˜åŒ–ã€‚</li><li><strong>å®‰å…¨éšæ‚£ï¼š</strong> å¯ä»¥ç ´åå°è£…æ€§ï¼ˆè®¿é—® private æˆå‘˜ï¼‰ï¼Œå¯èƒ½å¼•å‘å®‰å…¨é—®é¢˜ã€‚éœ€è¦é¢å¤–çš„å®‰å…¨ç®¡ç†ç­–ç•¥ã€‚</li><li><strong>ä»£ç å¤æ‚æ€§ï¼š</strong> åå°„ä»£ç é€šå¸¸æ¯”ç›´æ¥ä»£ç æ›´å¤æ‚ã€å¯è¯»æ€§æ›´å·®ã€æ›´éš¾ç»´æŠ¤ã€‚</li><li><strong>å†…éƒ¨æš´éœ²ï¼š</strong> å¯èƒ½æš´éœ²ç±»çš„å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œç ´åæŠ½è±¡ã€‚</li></ul></li></ul><h4 id="å¦‚ä½•è·å–ä¸€ä¸ªç±»çš„-Class-å¯¹è±¡"><a href="#å¦‚ä½•è·å–ä¸€ä¸ªç±»çš„-Class-å¯¹è±¡" class="headerlink" title="å¦‚ä½•è·å–ä¸€ä¸ªç±»çš„ Class å¯¹è±¡"></a>å¦‚ä½•è·å–ä¸€ä¸ªç±»çš„ <code>Class</code> å¯¹è±¡</h4><ol><li><code>Class clazz = Object.getClass();</code> (é€šè¿‡å¯¹è±¡å®ä¾‹è·å–)</li><li><code>Class clazz = ClassName.class;</code> (é€šè¿‡ç±»å­—é¢å¸¸é‡ <code>.class</code> è·å–)</li><li><code>Class clazz = Class.forName(&quot;fully.qualified.ClassName&quot;);</code> (é€šè¿‡å®Œæ•´ç±»åå­—ç¬¦ä¸²è·å–ï¼Œå¸¸ç”¨ï¼Œå¯èƒ½æŠ›å‡º <code>ClassNotFoundException</code>)</li><li>(å¯¹äºåŸºæœ¬ç±»å‹å’Œæ•°ç»„) <code>Class clazz = int.class;</code> &#x2F; <code>Class clazz = String[].class;</code></li></ol><h4 id="å¦‚ä½•é€šè¿‡åå°„åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹"><a href="#å¦‚ä½•é€šè¿‡åå°„åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹" class="headerlink" title="å¦‚ä½•é€šè¿‡åå°„åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹"></a>å¦‚ä½•é€šè¿‡åå°„åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹</h4><ol><li><p><strong>ä½¿ç”¨ <code>Class.newInstance()</code>ï¼ˆå·²è¿‡æ—¶ï¼‰ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.example.MyClass&quot;</span>);</span><br><span class="line"><span class="type">MyClass</span> <span class="variable">obj</span> <span class="operator">=</span> (MyClass) clazz.newInstance(); <span class="comment">// è°ƒç”¨æ— å‚æ„é€ å™¨</span></span><br></pre></td></tr></table></figure><p>åªèƒ½è°ƒç”¨æ— å‚æ„é€ å™¨ï¼›åœ¨ Java 9 å¼€å§‹è¢«æ ‡è®°ä¸º <code>@Deprecated(since=&quot;9&quot;)</code>ï¼Œæ¨èä½¿ç”¨ <code>Constructor.newInstance()</code>ã€‚</p></li><li><p><strong>ä½¿ç”¨ <code>Constructor.newInstance()</code> (æ¨è)ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.example.MyClass&quot;</span>);</span><br><span class="line"><span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> clazz.getConstructor(String.class, <span class="type">int</span>.class); <span class="comment">// è·å–ç‰¹å®šå‚æ•°ç±»å‹çš„æ„é€ å™¨</span></span><br><span class="line"><span class="type">MyClass</span> <span class="variable">obj</span> <span class="operator">=</span> (MyClass) constructor.newInstance(<span class="string">&quot;arg1&quot;</span>, <span class="number">42</span>); <span class="comment">// ä¼ å…¥å‚æ•°åˆ›å»ºå®ä¾‹</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="åå°„æœ‰å“ªäº›å®é™…åº”ç”¨åœºæ™¯"><a href="#åå°„æœ‰å“ªäº›å®é™…åº”ç”¨åœºæ™¯" class="headerlink" title="åå°„æœ‰å“ªäº›å®é™…åº”ç”¨åœºæ™¯"></a>åå°„æœ‰å“ªäº›å®é™…åº”ç”¨åœºæ™¯</h4><ul><li><strong>æ¡†æ¶å¼€å‘ï¼š</strong> æ˜¯å‡ ä¹æ‰€æœ‰ Java æ¡†æ¶çš„æ ¸å¿ƒï¼ˆå¦‚ Spring, Hibernate, MyBatis, JUnitï¼‰ã€‚<ul><li><strong>Spring IOCï¼š</strong> é€šè¿‡åå°„è¯»å–é…ç½®ï¼ˆXML æˆ–æ³¨è§£ï¼‰ï¼ŒåŠ¨æ€åˆ›å»º Bean å®ä¾‹ï¼Œæ³¨å…¥ä¾èµ–ã€‚</li><li><strong>Spring AOPï¼š</strong> åŠ¨æ€ä»£ç†ï¼ˆJDK Proxy æˆ– CGLIBï¼‰åº•å±‚ä¾èµ–åå°„è°ƒç”¨ç›®æ ‡æ–¹æ³•ã€‚</li><li><strong>Hibernate&#x2F;MyBatisï¼š</strong> å°†æ•°æ®åº“ç»“æœé›†æ˜ å°„åˆ° Java å¯¹è±¡æ—¶ï¼Œé€šè¿‡åå°„è®¾ç½®å¯¹è±¡çš„å±æ€§å€¼ã€‚</li></ul></li><li><strong>æ³¨è§£å¤„ç†ï¼š</strong> åœ¨è¿è¡Œæ—¶é€šè¿‡åå°„è¯»å–ç±»ã€æ–¹æ³•ã€å­—æ®µä¸Šçš„æ³¨è§£ä¿¡æ¯ï¼Œå¹¶æ ¹æ®æ³¨è§£æ‰§è¡Œç‰¹å®šé€»è¾‘ï¼ˆå¦‚ JUnit æŸ¥æ‰¾ <code>@Test</code> æ–¹æ³•ï¼‰ã€‚</li><li><strong>åŠ¨æ€ä»£ç†ï¼š</strong> JDK åŠ¨æ€ä»£ç† (<code>java.lang.reflect.Proxy</code>) çš„æ ¸å¿ƒå°±æ˜¯åˆ©ç”¨åå°„è°ƒç”¨è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•ã€‚</li><li><strong>é€šç”¨å·¥å…·åº“ï¼š</strong> å¦‚ Apache Commons BeanUtils, Jackson&#x2F;Gson (JSON åºåˆ—åŒ–&#x2F;ååºåˆ—åŒ–)ï¼Œé€šè¿‡åå°„æ“ä½œå¯¹è±¡çš„å±æ€§ã€‚</li><li><strong>IDE å’Œå¼€å‘å·¥å…·ï¼š</strong> ä»£ç æç¤ºã€è°ƒè¯•å™¨ã€åç¼–è¯‘å·¥å…·ç­‰åˆ©ç”¨åå°„è·å–ç±»çš„ç»“æ„ä¿¡æ¯ã€‚</li></ul><h4 id="Class-forName-å’Œ-ClassLoader-loadClass-æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#Class-forName-å’Œ-ClassLoader-loadClass-æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="Class.forName() å’Œ ClassLoader.loadClass() æœ‰ä»€ä¹ˆåŒºåˆ«"></a><strong><code>Class.forName()</code> å’Œ <code>ClassLoader.loadClass()</code> æœ‰ä»€ä¹ˆåŒºåˆ«</strong></h4><ul><li><code>Class.forName(String name)</code>ï¼š<ul><li>é»˜è®¤ä¼šè§¦å‘ç±»çš„<strong>åŠ è½½ã€é“¾æ¥ï¼ˆéªŒè¯ã€å‡†å¤‡ï¼‰ã€åˆå§‹åŒ–</strong>ï¼ˆæ‰§è¡Œ <code>&lt;clinit&gt;</code> é™æ€åˆå§‹åŒ–å—ï¼‰ã€‚</li><li>æœ‰ä¸€ä¸ªé‡è½½æ–¹æ³• <code>Class.forName(String name, boolean initialize, ClassLoader loader)</code> å¯ä»¥æ§åˆ¶æ˜¯å¦åˆå§‹åŒ– (<code>initialize</code>) å’ŒæŒ‡å®šç±»åŠ è½½å™¨ (<code>loader</code>)ã€‚</li></ul></li><li><code>ClassLoader.loadClass(String name)</code>ï¼š<ul><li>åªè§¦å‘ç±»çš„<strong>åŠ è½½</strong>å’Œ<strong>é“¾æ¥ï¼ˆéªŒè¯ã€å‡†å¤‡ï¼‰</strong> é˜¶æ®µï¼Œ<strong>ä¸ä¼šæ‰§è¡Œåˆå§‹åŒ–</strong> (<code>&lt;clinit&gt;</code>)ã€‚åªæœ‰é¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨æ—¶ï¼ˆå¦‚åˆ›å»ºå®ä¾‹ã€è®¿é—®é™æ€å­—æ®µ&#x2F;æ–¹æ³•ï¼‰æ‰ä¼šåˆå§‹åŒ–ã€‚</li></ul></li><li><strong>è€ƒå¯Ÿç‚¹ï¼š</strong> ç†è§£ç±»åŠ è½½è¿‡ç¨‹çš„é˜¶æ®µï¼ˆåŠ è½½ -&gt; é“¾æ¥ï¼ˆéªŒè¯ã€å‡†å¤‡ã€è§£æï¼‰ -&gt; åˆå§‹åŒ–ï¼‰ï¼Œä»¥åŠè¿™ä¸¤ä¸ªå…³é”®æ–¹æ³•åœ¨è§¦å‘ç±»åŠ è½½è¡Œä¸ºä¸Šçš„å·®å¼‚ã€‚çŸ¥é“ <code>forName</code> é»˜è®¤ä¼šåˆå§‹åŒ–ç±»ï¼Œè€Œ <code>loadClass</code> ä¸ä¼šã€‚</li></ul><h4 id="å¦‚ä½•é˜²æ­¢åå°„ç ´åå•ä¾‹æ¨¡å¼"><a href="#å¦‚ä½•é˜²æ­¢åå°„ç ´åå•ä¾‹æ¨¡å¼" class="headerlink" title="å¦‚ä½•é˜²æ­¢åå°„ç ´åå•ä¾‹æ¨¡å¼"></a><strong>å¦‚ä½•é˜²æ­¢åå°„ç ´åå•ä¾‹æ¨¡å¼</strong></h4><ul><li><p><strong>é—®é¢˜ï¼š</strong> æ ‡å‡†çš„é¥¿æ±‰å¼æˆ–æ‡’æ±‰å¼ï¼ˆéæšä¸¾ï¼‰å•ä¾‹ï¼Œå…¶ç§æœ‰æ„é€ å™¨å¯ä»¥é€šè¿‡åå°„çš„ <code>setAccessible(true)</code> è¢«è®¿é—®ï¼Œä»è€Œåˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚</p></li><li><p><strong>é˜²å¾¡æ–¹æ³•ï¼š</strong></p><ul><li><p><strong>åœ¨æ„é€ å™¨ä¸­æ£€æŸ¥ï¼š</strong> å¦‚æœå®ä¾‹å·²å­˜åœ¨ï¼Œåˆ™åœ¨ç§æœ‰æ„é€ å™¨ä¸­æŠ›å‡ºå¼‚å¸¸ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (INSTANCE != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Singleton instance already created&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨æšä¸¾å®ç°å•ä¾‹ (æ¨è)ï¼š</strong> æšä¸¾çš„å•ä¾‹å®ç°æ˜¯ã€ŠEffective Javaã€‹ä½œè€… Josh Bloch å¼ºçƒˆæ¨èçš„æ–¹å¼ã€‚JVM ä»æ ¹æœ¬ä¸Šä¿è¯äº†æšä¸¾ç±»å‹çš„æ„é€ å™¨åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œä¸”åå°„ API è¢«è®¾è®¡ä¸º<strong>ä¸èƒ½é€šè¿‡åå°„åˆ›å»ºæšä¸¾å®ä¾‹</strong>ï¼ˆ<code>Constructor.newInstance()</code> æ–¹æ³•å†…éƒ¨ä¼šæ£€æŸ¥å¹¶é˜»æ­¢ï¼‰ã€‚è¿™æ˜¯æœ€å®‰å…¨ã€ç®€æ´çš„æ–¹å¼ã€‚</p></li></ul></li></ul><h4 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h4><p>åŠ¨æ€ä»£ç†æ˜¯ä¸€ç§åœ¨è¿è¡Œæ—¶ç”Ÿæˆä»£ç†å¯¹è±¡çš„æœºåˆ¶ï¼Œå®ƒå¯ä»¥åœ¨ä¸æ”¹å˜åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡ä»£ç†å¯¹è±¡å¯¹åŸæœ‰å¯¹è±¡è¿›è¡Œå¢å¼ºã€æ‰©å±•æˆ–é™åˆ¶ç­‰æ“ä½œã€‚</p><p>åœ¨ Java ä¸­ï¼ŒåŠ¨æ€ä»£ç†ä¸»è¦æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š<strong>åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†</strong>å’ŒåŸºäº<strong>ç±»çš„åŠ¨æ€ä»£ç†</strong>ã€‚å…¶ä¸­ï¼ŒåŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†ä½¿ç”¨ Java è‡ªå¸¦çš„ java.lang.reflect.Proxy ç±»å®ç°ï¼Œè€ŒåŸºäºç±»çš„åŠ¨æ€ä»£ç†åˆ™éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œå¦‚ CGLIB æˆ– ByteBuddy ç­‰ã€‚</p><p><strong>åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†</strong></p><p>åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†è¦æ±‚ç›®æ ‡å¯¹è±¡å¿…é¡»å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ï¼ŒåŠ¨æ€ä»£ç†å¯¹è±¡ä¼šå®ç°è¿™äº›æ¥å£ï¼Œå¹¶å°†å¯¹è¿™äº›æ¥å£æ–¹æ³•çš„è°ƒç”¨å§”æ‰˜ç»™ç›®æ ‡å¯¹è±¡ã€‚åœ¨åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡æ—¶ï¼Œéœ€è¦æä¾›ä¸€ä¸ªå®ç°äº† InvocationHandler æ¥å£çš„ä»£ç†å¤„ç†å™¨å¯¹è±¡ï¼Œå®ƒä¼šåœ¨ä»£ç†å¯¹è±¡æ–¹æ³•è°ƒç”¨æ—¶è¢«å›è°ƒã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Hello</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloImpl</span> <span class="keyword">implements</span> <span class="title class_">Hello</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello, &quot;</span> + name + <span class="string">&quot;!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloProxy</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HelloProxy</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before method invocation&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target, args);</span><br><span class="line">        System.out.println(<span class="string">&quot;After method invocation&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Hello</span> <span class="variable">hello</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HelloImpl</span>();</span><br><span class="line">        <span class="type">Hello</span> <span class="variable">proxy</span> <span class="operator">=</span> (Hello) Proxy.newProxyInstance(</span><br><span class="line">            hello.getClass().getClassLoader(),</span><br><span class="line">            hello.getClass().getInterfaces(),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">HelloProxy</span>(hello)</span><br><span class="line">        );</span><br><span class="line">        proxy.sayHello(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸºäºç±»çš„åŠ¨æ€ä»£ç†</strong></p><p>åŸºäºç±»çš„åŠ¨æ€ä»£ç†åˆ™ä¸è¦æ±‚ç›®æ ‡å¯¹è±¡å¿…é¡»å®ç°æ¥å£ï¼Œè€Œæ˜¯é€šè¿‡åˆ›å»ºç›®æ ‡å¯¹è±¡çš„å­ç±»æ¥å®ç°ä»£ç†ã€‚åœ¨åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡æ—¶ï¼Œéœ€è¦æä¾›ä¸€ä¸ªå®ç°äº† MethodInterceptor æ¥å£çš„æ‹¦æˆªå™¨å¯¹è±¡ï¼Œå®ƒä¼šåœ¨ä»£ç†å¯¹è±¡æ–¹æ³•è°ƒç”¨æ—¶è¢«å›è°ƒã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Hello</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello, &quot;</span> + name + <span class="string">&quot;!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloInterceptor</span> <span class="keyword">implements</span> <span class="title class_">MethodInterceptor</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object obj, Method method, Object[] args, MethodProxy proxy)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before method invocation&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> proxy.invokeSuper(obj, args);</span><br><span class="line">        System.out.println(<span class="string">&quot;After method invocation&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Enhancer</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">        enhancer.setSuperclass(Hello.class);</span><br><span class="line">        enhancer.setCallback(<span class="keyword">new</span> <span class="title class_">HelloInterceptor</span>());</span><br><span class="line">        <span class="type">Hello</span> <span class="variable">hello</span> <span class="operator">=</span> (Hello) enhancer.create();</span><br><span class="line">        hello.sayHello(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h3><h4 id="Javaä¸­éƒ½æœ‰å“ªäº›å…ƒæ³¨è§£"><a href="#Javaä¸­éƒ½æœ‰å“ªäº›å…ƒæ³¨è§£" class="headerlink" title="Javaä¸­éƒ½æœ‰å“ªäº›å…ƒæ³¨è§£"></a>Javaä¸­éƒ½æœ‰å“ªäº›å…ƒæ³¨è§£</h4><table><thead><tr><th align="left">å…ƒæ³¨è§£</th><th align="left">ä½œç”¨åŸŸ</th><th align="left">ä¸»è¦ç”¨é€”</th><th align="left">Java ç‰ˆæœ¬</th></tr></thead><tbody><tr><td align="left"><strong><code>@Target</code></strong></td><td align="left">æ³¨è§£</td><td align="left">æŒ‡å®šæ³¨è§£å¯åº”ç”¨çš„ç¨‹åºå…ƒç´ ï¼ˆç±»ã€æ–¹æ³•ã€å­—æ®µç­‰ï¼‰</td><td align="left">5</td></tr><tr><td align="left"><strong><code>@Retention</code></strong></td><td align="left">æ³¨è§£</td><td align="left">æŒ‡å®šæ³¨è§£çš„ä¿ç•™ç­–ç•¥ï¼ˆæºç ã€ç±»æ–‡ä»¶ã€è¿è¡Œæ—¶ï¼‰</td><td align="left">5</td></tr><tr><td align="left"><strong><code>@Documented</code></strong></td><td align="left">æ³¨è§£</td><td align="left">æŒ‡ç¤ºæ³¨è§£åº”åŒ…å«åœ¨ Javadoc ä¸­</td><td align="left">5</td></tr><tr><td align="left"><strong><code>@Inherited</code></strong></td><td align="left">æ³¨è§£</td><td align="left">æŒ‡ç¤ºæ³¨è§£å…·æœ‰ç»§æ‰¿æ€§ï¼ˆä»…å¯¹ç±»æ³¨è§£æœ‰æ•ˆï¼‰</td><td align="left">5</td></tr><tr><td align="left"><strong><code>@Repeatable</code></strong></td><td align="left">æ³¨è§£</td><td align="left">å…è®¸åŒä¸€æ³¨è§£åœ¨å•ä¸ªå…ƒç´ ä¸Šé‡å¤ä½¿ç”¨ï¼ˆéœ€é…åˆå®¹å™¨æ³¨è§£ï¼‰</td><td align="left"><strong>8</strong></td></tr><tr><td align="left"><strong><code>@Native</code></strong></td><td align="left">å­—æ®µ</td><td align="left">æ ‡è®°å¯èƒ½è¢«æœ¬æœºä»£ç å¼•ç”¨çš„å¸¸é‡å­—æ®µï¼ˆä¸»è¦åœ¨ JDK å†…éƒ¨ä½¿ç”¨ï¼‰</td><td align="left"><strong>8</strong></td></tr></tbody></table><h3 id="SPI"><a href="#SPI" class="headerlink" title="SPI"></a>SPI</h3><p><strong>SPI</strong> æ˜¯ Java æä¾›çš„ä¸€ç§<strong>æœåŠ¡å‘ç°æœºåˆ¶</strong>ï¼Œé€šè¿‡<strong>æ¥å£ä¸å®ç°è§£è€¦</strong>å®ç°åŠ¨æ€æ‰©å±•ã€‚æ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li><strong>å®šä¹‰æœåŠ¡æ¥å£</strong>ï¼ˆå¦‚ <code>PaymentService</code>ï¼‰</li><li><strong>æä¾›å®ç°ç±»</strong>ï¼ˆå¦‚ <code>AlipayService</code>, <code>WechatPayService</code>ï¼‰</li><li><strong>æ³¨å†Œå®ç°</strong>ï¼šåœ¨ <code>META-INF/services/</code> ä¸‹åˆ›å»ºä»¥æ¥å£å…¨é™å®šåå‘½åçš„æ–‡ä»¶ï¼Œå†™å…¥å®ç°ç±»å…¨é™å®šå</li><li><strong>åŠ¨æ€åŠ è½½</strong>ï¼šé€šè¿‡ <code>ServiceLoader</code> åŠ è½½æ‰€æœ‰æ³¨å†Œçš„å®ç°</li></ol><p><strong>ä¼˜åŠ¿ï¼š</strong></p><ul><li><strong>å¼€é—­åŸåˆ™</strong>ï¼šæ–°å¢å®ç°æ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç </li><li><strong>è§£è€¦</strong>ï¼šæ¥å£ä¸å®ç°åˆ†ç¦»</li><li><strong>å¯æ’æ‹”</strong>ï¼šé€šè¿‡é…ç½®æ–‡ä»¶åŠ¨æ€æ›¿æ¢å®ç°</li></ul><p><strong>Java SPI å®Œæ•´ Demo</strong></p><ol><li>å®šä¹‰æœåŠ¡æ¥å£</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PaymentService.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>å®ç°æœåŠ¡æ¥å£</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AlipayService.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlipayService</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[æ”¯ä»˜å®] æ”¯ä»˜: Â¥&quot;</span> + amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// WechatPayService.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatPayService</span> <span class="keyword">implements</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[å¾®ä¿¡æ”¯ä»˜] æ”¯ä»˜: Â¥&quot;</span> + amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>æ³¨å†ŒæœåŠ¡å®ç°</li></ol><p>åˆ›å»ºèµ„æºæ–‡ä»¶ï¼š<br><code>src/main/resources/META-INF/services/com.example.PaymentService</code><br>å†…å®¹ï¼š</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">com.example.AlipayService</span><br><span class="line">com.example.WechatPayService</span><br></pre></td></tr></table></figure><ol start="4"><li>ä½¿ç”¨ SPI åŠ è½½æœåŠ¡</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SPIDemo.java</span></span><br><span class="line"><span class="keyword">import</span> java.util.ServiceLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SPIDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åŠ è½½æ‰€æœ‰ PaymentService å®ç°</span></span><br><span class="line">        ServiceLoader&lt;PaymentService&gt; services = </span><br><span class="line">            ServiceLoader.load(PaymentService.class);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;=== å‘ç° &quot;</span> + getServiceCount(services) + <span class="string">&quot; ä¸ªæ”¯ä»˜æœåŠ¡ ===&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è°ƒç”¨æ‰€æœ‰å®ç°</span></span><br><span class="line">        <span class="keyword">for</span> (PaymentService service : services) &#123;</span><br><span class="line">            service.pay(<span class="number">100.0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">getServiceCount</span><span class="params">(ServiceLoader&lt;PaymentService&gt; services)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (PaymentService ignored : services) &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>é¡¹ç›®ç»“æ„</li></ol><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">src/</span><br><span class="line">â”œâ”€â”€ main/</span><br><span class="line">â”‚   â”œâ”€â”€ java/</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ com/example/</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ PaymentService.java</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ AlipayService.java</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ WechatPayService.java</span><br><span class="line">â”‚   â”‚   â”‚   â””â”€â”€ SPIDemo.java</span><br><span class="line">â”‚   â”‚</span><br><span class="line">â”‚   â””â”€â”€ resources/</span><br><span class="line">â”‚       â””â”€â”€ META-INF/services/</span><br><span class="line">â”‚           â””â”€â”€ com.example.PaymentService  &lt;-- å…³é”®é…ç½®æ–‡ä»¶</span><br></pre></td></tr></table></figure><ol start="6"><li>è¿è¡Œç»“æœ</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">=== å‘ç° 2 ä¸ªæ”¯ä»˜æœåŠ¡ ===</span><br><span class="line">[æ”¯ä»˜å®] æ”¯ä»˜: Â¥100.0</span><br><span class="line">[å¾®ä¿¡æ”¯ä»˜] æ”¯ä»˜: Â¥100.0</span><br></pre></td></tr></table></figure><p><strong>å…³é”®ç‚¹è§£æï¼š</strong></p><ol><li><strong>é…ç½®æ–‡ä»¶è·¯å¾„</strong>ï¼š<code>META-INF/services/æ¥å£å…¨é™å®šå</code></li><li><strong>æ–‡ä»¶å†…å®¹</strong>ï¼šå®ç°ç±»çš„å…¨é™å®šåï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</li><li><strong>ServiceLoader</strong>ï¼šæ ¸å¿ƒåŠ è½½å·¥å…·ï¼Œå®ç°æ‡’åŠ è½½</li><li><strong>è¿­ä»£é¡ºåº</strong>ï¼šæŒ‰é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„é¡ºåºåŠ è½½</li></ol><p><strong>å®é™…åº”ç”¨åœºæ™¯ï¼š</strong></p><ul><li>JDBC é©±åŠ¨åŠ è½½ï¼ˆ<code>DriverManager</code>ï¼‰</li><li>æ—¥å¿—é—¨é¢ï¼ˆSLF4Jï¼‰</li><li>åºåˆ—åŒ–æ¡†æ¶ï¼ˆJacksonï¼‰</li><li>Spring Boot è‡ªåŠ¨é…ç½®</li></ul><blockquote><p>é€šè¿‡ SPI æœºåˆ¶ï¼ŒJava å®ç°äº†çœŸæ­£çš„é¢å‘æ¥å£ç¼–ç¨‹ï¼Œä½¿ç³»ç»Ÿå…·å¤‡é«˜åº¦å¯æ‰©å±•æ€§ï¼Œç¬¦åˆã€Œå¼€é—­åŸåˆ™ã€ã€‚</p></blockquote><h2 id="Javaé›†åˆ"><a href="#Javaé›†åˆ" class="headerlink" title="Javaé›†åˆ"></a>Javaé›†åˆ</h2><h3 id="é›†åˆåŸºç¡€"><a href="#é›†åˆåŸºç¡€" class="headerlink" title="é›†åˆåŸºç¡€"></a>é›†åˆåŸºç¡€</h3><p>Java é›†åˆæ¡†æ¶ä¸»è¦åŒ…æ‹¬ <code>Collection</code> å’Œ <code>Map</code> ä¸¤å¤§æ¥å£ä½“ç³»ã€‚<code>Collection</code> ä¸»è¦æœ‰ <code>List</code>ã€<code>Set</code>ã€<code>Queue</code> å‡ ä¸ªæ ¸å¿ƒå­æ¥å£ã€‚</p><h4 id="Iterator-å’Œ-ListIterator-çš„åŒºåˆ«"><a href="#Iterator-å’Œ-ListIterator-çš„åŒºåˆ«" class="headerlink" title="Iterator å’Œ ListIterator çš„åŒºåˆ«"></a><strong><code>Iterator</code> å’Œ <code>ListIterator</code> çš„åŒºåˆ«</strong></h4><ul><li><code>Iterator</code>ï¼šé€šç”¨è¿­ä»£å™¨æ¥å£ã€‚æä¾› <code>hasNext()</code>, <code>next()</code>, <code>remove()</code> æ–¹æ³•ã€‚åªèƒ½<strong>å•å‘</strong>éå† (<code>Collection</code> æ¥å£ä½¿ç”¨)ã€‚</li><li><code>ListIterator</code>ï¼šç»§æ‰¿ <code>Iterator</code>ã€‚ä¸“é—¨ç”¨äº <code>List</code>ã€‚é¢å¤–æä¾›ï¼š<ul><li><strong>åŒå‘éå†</strong>ï¼š<code>hasPrevious()</code>, <code>previous()</code>ã€‚</li><li><strong>è·å–ç´¢å¼•</strong>ï¼š<code>nextIndex()</code>, <code>previousIndex()</code>ã€‚</li><li><strong>ä¿®æ”¹å…ƒç´ </strong>ï¼š<code>set(E e)</code> (æ›¿æ¢ä¸Šæ¬¡è°ƒç”¨ <code>next()</code> æˆ– <code>previous()</code> è¿”å›çš„å…ƒç´ )ã€‚</li><li><strong>æ·»åŠ å…ƒç´ </strong>ï¼š<code>add(E e)</code> (åœ¨å½“å‰æ¸¸æ ‡ä½ç½®æ’å…¥å…ƒç´ )ã€‚</li></ul></li><li><code>ListIterator</code> åŠŸèƒ½æ›´å¼ºå¤§ï¼Œä½†åªèƒ½ç”¨äº <code>List</code> åŠå…¶å®ç°ç±»ã€‚</li></ul><h4 id="ä»€ä¹ˆæ˜¯-fail-fast-æœºåˆ¶"><a href="#ä»€ä¹ˆæ˜¯-fail-fast-æœºåˆ¶" class="headerlink" title="ä»€ä¹ˆæ˜¯ fail-fast æœºåˆ¶"></a><strong>ä»€ä¹ˆæ˜¯ <code>fail-fast</code> æœºåˆ¶</strong></h4><ul><li>ä¸€ç§<strong>é”™è¯¯æ£€æµ‹æœºåˆ¶</strong>ã€‚å½“ä½¿ç”¨è¿­ä»£å™¨ (<code>Iterator</code>) éå†é›†åˆæ—¶ï¼Œå¦‚æœ<strong>åœ¨éå†è¿‡ç¨‹ä¸­ï¼ˆé™¤äº†é€šè¿‡è¿­ä»£å™¨è‡ªèº«çš„ <code>remove()</code> æ–¹æ³•å¤–ï¼‰å¯¹é›†åˆç»“æ„è¿›è¡Œäº†ä¿®æ”¹</strong>ï¼ˆæ·»åŠ ã€åˆ é™¤å…ƒç´ ï¼‰ï¼Œåˆ™ä¼šç«‹å³æŠ›å‡º <code>ConcurrentModificationException</code>ã€‚</li><li><strong>å®ç°åŸç†</strong>ï¼šé›†åˆå†…éƒ¨ç»´æŠ¤ä¸€ä¸ª <code>modCount</code> (ä¿®æ”¹è®¡æ•°å™¨)ã€‚åˆ›å»ºè¿­ä»£å™¨æ—¶ï¼Œä¼šå°†å½“å‰çš„ <code>modCount</code> è®°å½•ä¸º <code>expectedModCount</code>ã€‚åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡è°ƒç”¨ <code>next()</code>ã€<code>remove()</code> ç­‰æ–¹æ³•å‰éƒ½ä¼šæ£€æŸ¥ <code>modCount == expectedModCount</code>ã€‚å¦‚æœä¸ç›¸ç­‰ï¼Œè¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹æˆ–æœ¬çº¿ç¨‹å…¶ä»–æ“ä½œä¿®æ”¹äº†é›†åˆç»“æ„ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚</li><li><strong>ç›®çš„</strong>ï¼šå¿«é€Ÿå¤±è´¥ï¼Œé¿å…åœ¨ä¸ç¡®å®šçŠ¶æ€ä¸‹ç»§ç»­æ“ä½œå¯¼è‡´æ›´éš¾ä»¥é¢„æ–™çš„ç»“æœã€‚<strong>å®ƒä¸èƒ½ä¿è¯å¹¶å‘ä¿®æ”¹ä¸€å®šè¢«æ£€æµ‹åˆ°ï¼Œä¸»è¦ç”¨äºå•çº¿ç¨‹ç¯å¢ƒä¸‹çš„é”™è¯¯æ£€æµ‹</strong>ã€‚</li></ul><h4 id="fail-fast-å’Œ-fail-safe-çš„åŒºåˆ«"><a href="#fail-fast-å’Œ-fail-safe-çš„åŒºåˆ«" class="headerlink" title="fail-fast å’Œ fail-safe çš„åŒºåˆ«"></a><strong><code>fail-fast</code> å’Œ <code>fail-safe</code> çš„åŒºåˆ«</strong></h4><ul><li><strong><code>fail-fast</code><strong>ï¼šç›´æ¥åœ¨åŸé›†åˆä¸Šæ“ä½œã€‚è¿­ä»£æ—¶æ£€æµ‹åˆ°å¹¶å‘ä¿®æ”¹å°±</strong>ç«‹å³æŠ›å¼‚å¸¸</strong>ã€‚ä»£è¡¨ï¼š<code>ArrayList</code>, <code>HashMap</code> ç­‰éå¹¶å‘é›†åˆçš„è¿­ä»£å™¨ã€‚</li><li><strong><code>fail-safe</code> (Concurrent Modification Tolerance)<strong>ï¼š</strong>ä¸åœ¨åŸé›†åˆä¸Šæ“ä½œ</strong>ï¼Œè€Œæ˜¯åŸºäºåŸé›†åˆçš„<strong>å¿«ç…§ (snapshot)</strong> æˆ– <strong>åªè¯»è§†å›¾</strong> è¿›è¡Œè¿­ä»£ã€‚è¿­ä»£è¿‡ç¨‹ä¸­åŸé›†åˆçš„ä¿®æ”¹ä¸ä¼šå½±å“è¿­ä»£å™¨ï¼Œä¸ä¼šæŠ›å¼‚å¸¸ã€‚ä»£è¡¨ï¼š<code>ConcurrentHashMap</code>, <code>CopyOnWriteArrayList</code> çš„è¿­ä»£å™¨ã€‚</li><li><strong>æ³¨æ„</strong>ï¼š<code>java.util.concurrent</code> åŒ…ä¸‹çš„é›†åˆé€šå¸¸é‡‡ç”¨ <strong>å¼±ä¸€è‡´æ€§ (Weakly Consistent)</strong> è¿­ä»£å™¨ï¼Œå®ƒæä¾› <code>fail-safe</code> è¡Œä¸ºï¼Œä½†ä¸ä¿è¯è¿­ä»£å™¨çœ‹åˆ°æ‰€æœ‰ä¿®æ”¹ã€‚</li></ul><h3 id="List"><a href="#List" class="headerlink" title="List"></a><code>List</code></h3><h4 id="ArrayListçš„æ‰©å®¹æœºåˆ¶"><a href="#ArrayListçš„æ‰©å®¹æœºåˆ¶" class="headerlink" title="ArrayListçš„æ‰©å®¹æœºåˆ¶"></a><code>ArrayList</code>çš„æ‰©å®¹æœºåˆ¶</h4><ul><li>ä½¿ç”¨ <code>Object[] elementData</code> å­˜å‚¨å…ƒç´ ã€‚</li><li>åˆ›å»ºæ—¶å¦‚æœæœªæŒ‡å®šå¤§å°ï¼Œåˆå§‹å®¹é‡ä¸º <strong>0</strong> (JDK 1.8+) æˆ– <strong>10</strong> (æ—§ç‰ˆæœ¬ï¼Œéœ€ç¡®è®¤å…·ä½“ç‰ˆæœ¬)ï¼Œç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ æ—¶æ‰©å®¹åˆ° <strong>10</strong>ã€‚</li><li>å½“æ·»åŠ å…ƒç´ æ—¶å‘ç°å®¹é‡ä¸è¶³ï¼ˆ<code>size + 1 &gt; elementData.length</code>ï¼‰ï¼Œè§¦å‘æ‰©å®¹ã€‚</li><li>æ–°å®¹é‡ &#x3D; <code>ArraysSupport.newLength(oldCapacity, minCapacity - oldCapacity, oldCapacity &gt;&gt; 1)</code>ï¼Œå³è®¡ç®—æ–°å®¹é‡ä¸º <code>oldCapacity + max(éœ€è¦çš„æœ€å°å¢é‡, oldCapacity / 2)</code>ï¼Œç®€å•ç†è§£é€šå¸¸æ˜¯ <strong>åŸå®¹é‡çš„1.5å€</strong>ã€‚</li><li>åˆ›å»ºä¸€ä¸ªæ–°çš„æ›´å¤§çš„æ•°ç»„ï¼Œå°†æ—§æ•°ç»„å…ƒç´ <strong>å¤åˆ¶</strong>åˆ°æ–°æ•°ç»„ã€‚</li></ul><h4 id="Vector-å’Œ-ArrayList-çš„åŒºåˆ«"><a href="#Vector-å’Œ-ArrayList-çš„åŒºåˆ«" class="headerlink" title="Vector å’Œ ArrayList çš„åŒºåˆ«"></a><code>Vector</code> å’Œ <code>ArrayList</code> çš„åŒºåˆ«</h4><ul><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼š<ul><li><code>Vector</code>ï¼š<strong>çº¿ç¨‹å®‰å…¨</strong>ã€‚å…³é”®æ–¹æ³•ä½¿ç”¨ <code>synchronized</code> ä¿®é¥°ï¼Œæ€§èƒ½è¾ƒä½ã€‚</li><li><code>ArrayList</code>ï¼š<strong>éçº¿ç¨‹å®‰å…¨</strong>ã€‚æ€§èƒ½æ›´é«˜ã€‚</li></ul></li><li><strong>æ‰©å®¹æœºåˆ¶</strong>ï¼š<ul><li><code>Vector</code>ï¼šé»˜è®¤æ‰©å®¹ä¸ºåŸæ¥çš„ <strong>2å€</strong>ï¼Œå¯é€šè¿‡æ„é€ å‡½æ•°æŒ‡å®šæ‰©å®¹å¢é‡ã€‚</li><li><code>ArrayList</code>ï¼šé»˜è®¤æ‰©å®¹ä¸ºåŸæ¥çš„ <strong>1.5å€</strong> (<code>(oldCapacity * 3)/2 + 1</code>)ã€‚</li></ul></li></ul><h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a><code>Set</code></h3><h4 id="HashSetã€LinkedHashSet-å’Œ-TreeSet-çš„åŒºåˆ«"><a href="#HashSetã€LinkedHashSet-å’Œ-TreeSet-çš„åŒºåˆ«" class="headerlink" title="HashSetã€LinkedHashSet å’Œ TreeSet çš„åŒºåˆ«"></a><strong><code>HashSet</code>ã€<code>LinkedHashSet</code> å’Œ <code>TreeSet</code> çš„åŒºåˆ«</strong></h4><ul><li><strong>åº•å±‚å®ç°</strong>ï¼š<ul><li><code>HashSet</code>ï¼šåŸºäº <code>HashMap</code> (åªéœ€ Keyï¼ŒValue ç”¨å¸¸é‡ <code>PRESENT</code> å¡«å……)ã€‚</li><li><code>LinkedHashSet</code>ï¼šç»§æ‰¿è‡ª <code>HashSet</code>ï¼ŒåŸºäº <code>LinkedHashMap</code>ã€‚</li><li><code>TreeSet</code>ï¼šåŸºäº <code>TreeMap</code> (çº¢é»‘æ ‘)ã€‚</li></ul></li><li><strong>å…ƒç´ é¡ºåº</strong>ï¼š<ul><li><code>HashSet</code>ï¼š<strong>æ— åº</strong> (ä¸ä¿è¯æ’å…¥é¡ºåºæˆ–æ’ä¹…ä¸å˜)ã€‚</li><li><code>LinkedHashSet</code>ï¼š<strong>æŒ‰å…ƒç´ æ’å…¥é¡ºåºæ’åº</strong> (åŒå‘é“¾è¡¨ç»´æŠ¤æ’å…¥æ¬¡åº)ã€‚</li><li><code>TreeSet</code>ï¼š<strong>æŒ‰å…ƒç´ çš„è‡ªç„¶é¡ºåº (<code>Comparable</code>) æˆ–æŒ‡å®šçš„ <code>Comparator</code> æ’åº</strong>ã€‚</li></ul></li><li><strong>æ€§èƒ½</strong>ï¼š<ul><li><code>HashSet</code>&#x2F;<code>LinkedHashSet</code>ï¼šæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾ O(1) (å¹³å‡æƒ…å†µ)ã€‚</li><li><code>TreeSet</code>ï¼šæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾ O(log n)ã€‚</li></ul></li><li><strong>å…ƒç´ è¦æ±‚</strong>ï¼š<ul><li><code>HashSet</code>&#x2F;<code>LinkedHashSet</code>ï¼šå…ƒç´ å¿…é¡»æ­£ç¡®å®ç° <code>equals()</code> å’Œ <code>hashCode()</code>ã€‚</li><li><code>TreeSet</code>ï¼šå…ƒç´ å¿…é¡»å®ç° <code>Comparable</code> æ¥å£æˆ–åœ¨æ„é€ æ—¶ä¼ å…¥ <code>Comparator</code>ã€‚</li></ul></li><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šä¸‰è€…éƒ½<strong>éçº¿ç¨‹å®‰å…¨</strong>ã€‚</li></ul><h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a><code>Map</code></h3><h4 id="HashMap-çš„åº•å±‚å®ç°åŸç†"><a href="#HashMap-çš„åº•å±‚å®ç°åŸç†" class="headerlink" title="HashMap çš„åº•å±‚å®ç°åŸç†"></a><strong><code>HashMap</code> çš„åº•å±‚å®ç°åŸç†</strong></h4><p><strong>JDK7ï¼šæ•°ç»„ + é“¾è¡¨</strong></p><ul><li><strong>æ‰©å®¹</strong>ï¼šåˆ›å»ºæ–°æ•°ç»„ (é€šå¸¸æ˜¯åŸæ•°ç»„é•¿åº¦çš„ <strong>2å€</strong>)ï¼Œéå†æ‰€æœ‰å…ƒç´ ï¼Œ<strong>é‡æ–°è®¡ç®—æ¯ä¸ªå…ƒç´ åœ¨æ–°æ•°ç»„ä¸­çš„ä½ç½®</strong> (<code>rehash</code>)ï¼Œå°†å…ƒç´ è½¬ç§»åˆ°æ–°æ•°ç»„ã€‚<strong>å¤´æ’æ³•ä¼šå¯¼è‡´æ‰©å®¹æ—¶é“¾è¡¨å…ƒç´ é¡ºåºåè½¬</strong>ã€‚</li></ul><p><strong>JDK8ï¼šæ•°ç»„ + é“¾è¡¨ &#x2F; çº¢é»‘æ ‘</strong></p><p><strong>ä¸»è¦æ”¹è¿›</strong>ï¼š</p><ul><li><strong>å°¾æ’æ³•</strong>ï¼šè§£å†³ JDK7 å¤´æ’æ³•å¤šçº¿ç¨‹ä¸‹å¯èƒ½å¯¼è‡´æ­»å¾ªç¯çš„é—®é¢˜ï¼ˆæœªè§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼‰ã€‚</li><li><strong>é“¾è¡¨è½¬çº¢é»‘æ ‘</strong>ï¼šå½“é“¾è¡¨é•¿åº¦ <strong>&gt;&#x3D; 8 (TREEIFY_THRESHOLD)</strong> ä¸” <strong>æ•°ç»„é•¿åº¦ &gt;&#x3D; 64 (MIN_TREEIFY_CAPACITY)</strong> æ—¶ï¼Œé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œæé«˜é•¿é“¾è¡¨çš„æŸ¥æ‰¾æ•ˆç‡ (O(n) -&gt; O(log n))ã€‚</li><li><strong>ä¼˜åŒ–å“ˆå¸Œç®—æ³•</strong>ï¼š<code>(key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16)</code>ï¼Œé«˜ä½å‚ä¸è¿ç®—ï¼Œå‡å°‘å“ˆå¸Œå†²çªã€‚</li><li><strong>æ‰©å®¹</strong>ï¼šæ ¹æ® <code>(e.hash &amp; oldCap) == 0</code> å°†é“¾è¡¨æ‹†åˆ†æˆä¸¤ä¸ªå­é“¾è¡¨ï¼Œç»“æœä¸º 0 çš„èŠ‚ç‚¹ä¿æŒåŸç´¢å¼•ä½ç½® <code>i</code>ï¼Œç»“æœä¸ä¸º 0 çš„èŠ‚ç‚¹æ”¾åˆ°æ–°ä½ç½® <code>i + oldCap</code>ï¼Œé¿å…å…¨é‡ <code>rehash</code>ï¼Œæå‡äº†æ•ˆç‡ã€‚</li></ul><h4 id="HashMap-å’Œ-HashTable-çš„åŒºåˆ«"><a href="#HashMap-å’Œ-HashTable-çš„åŒºåˆ«" class="headerlink" title="HashMap å’Œ HashTable çš„åŒºåˆ«"></a><strong><code>HashMap</code> å’Œ <code>HashTable</code> çš„åŒºåˆ«</strong></h4><ul><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼š<ul><li><code>HashMap</code>ï¼š<strong>éçº¿ç¨‹å®‰å…¨</strong>ã€‚æ€§èƒ½æ›´é«˜ã€‚</li><li><code>Hashtable</code>ï¼š<strong>çº¿ç¨‹å®‰å…¨</strong>ã€‚å‡ ä¹æ‰€æœ‰å…¬å…±æ–¹æ³•éƒ½ç”¨ <code>synchronized</code> ä¿®é¥°ï¼Œæ€§èƒ½è¾ƒä½ã€‚</li></ul></li><li><strong><code>null</code> å€¼</strong>ï¼š<ul><li><code>HashMap</code>ï¼šå…è®¸ <code>key</code> å’Œ <code>value</code> ä¸º <code>null</code>ã€‚</li><li><code>Hashtable</code>ï¼šä¸å…è®¸ <code>key</code> æˆ– <code>value</code> ä¸º <code>null</code>ã€‚</li></ul></li><li><strong>ç»§æ‰¿ä½“ç³»</strong>ï¼š<ul><li><code>HashMap</code>ï¼šç»§æ‰¿ <code>AbstractMap</code>ã€‚</li><li><code>Hashtable</code>ï¼šç»§æ‰¿ <code>Dictionary</code> (ä¸€ä¸ªå¤è€çš„ç±»)ã€‚</li></ul></li><li><strong>è¿­ä»£å™¨</strong>ï¼š<ul><li><code>HashMap</code> çš„ <code>Iterator</code> æ˜¯ <strong>fail-fast</strong> çš„ã€‚</li><li><code>Hashtable</code> çš„ <code>Enumerator</code> ä¸æ˜¯ fail-fast çš„ã€‚</li></ul></li><li><strong>åˆå§‹å®¹é‡ä¸æ‰©å®¹</strong>ï¼š<ul><li><code>HashMap</code>ï¼šé»˜è®¤ 16ï¼Œæ‰©å®¹ä¸º 2 å€ã€‚</li><li><code>Hashtable</code>ï¼šé»˜è®¤ 11ï¼Œæ‰©å®¹ä¸º 2 å€ + 1 (<code>oldCapacity * 2 + 1</code>)ã€‚</li></ul></li><li><strong>å“ˆå¸Œè®¡ç®—</strong>ï¼š<ul><li><code>HashMap</code>ï¼šä¼˜åŒ–äº†å“ˆå¸Œå‡½æ•° (<code>(h = key.hashCode()) ^ (h &gt;&gt;&gt; 16)</code>)ã€‚</li><li><code>Hashtable</code>ï¼šç›´æ¥ä½¿ç”¨ <code>key.hashCode()</code>ã€‚</li></ul></li><li><strong>æ¨èä½¿ç”¨</strong>ï¼š<code>HashMap</code> + <code>ConcurrentHashMap</code> æˆ– <code>Collections.synchronizedMap()</code> ä»£æ›¿ <code>Hashtable</code>ã€‚</li></ul><h2 id="Java-IO"><a href="#Java-IO" class="headerlink" title="Java IO"></a>Java IO</h2><h3 id="å­—èŠ‚æµä¸å­—ç¬¦æµçš„åŒºåˆ«"><a href="#å­—èŠ‚æµä¸å­—ç¬¦æµçš„åŒºåˆ«" class="headerlink" title="å­—èŠ‚æµä¸å­—ç¬¦æµçš„åŒºåˆ«"></a>å­—èŠ‚æµä¸å­—ç¬¦æµçš„åŒºåˆ«</h3><ul><li><strong>å­—èŠ‚æµ</strong>ï¼š<code>InputStream</code>&#x2F;<code>OutputStream</code>ï¼Œå¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼ˆå¦‚å›¾ç‰‡ã€è§†é¢‘ï¼‰ï¼Œæ ¸å¿ƒç±»å¦‚ <code>FileInputStream</code>ã€‚</li><li><strong>å­—ç¬¦æµ</strong>ï¼š<code>Reader</code>&#x2F;<code>Writer</code>ï¼Œå¤„ç†æ–‡æœ¬æ•°æ®ï¼ˆè‡ªåŠ¨å¤„ç†ç¼–ç ï¼‰ï¼Œæ ¸å¿ƒç±»å¦‚ <code>FileReader</code>ã€<code>InputStreamReader</code>ã€‚</li><li><strong>å…³é”®ç‚¹</strong>ï¼šå­—ç¬¦æµåº•å±‚ä¾èµ–å­—èŠ‚æµ + ç¼–ç è½¬æ¢ï¼ˆå¦‚ <code>InputStreamReader</code> æ˜¯å­—èŠ‚åˆ°å­—ç¬¦çš„æ¡¥æ¢ï¼‰ã€‚</li></ul><p><strong>ä¸ºä»€ä¹ˆè¦æœ‰å­—ç¬¦æµï¼Ÿ</strong></p><ul><li>ç›´æ¥æ“ä½œå­—ç¬¦æ›´é«˜æ•ˆï¼Œé¿å…æ‰‹åŠ¨å¤„ç†ç¼–ç ï¼ˆå¦‚ UTF-8 è½¬ç ï¼‰ï¼Œè§£å†³ä¹±ç é—®é¢˜ã€‚</li></ul><h3 id="BIOã€NIOã€AIOçš„åŒºåˆ«"><a href="#BIOã€NIOã€AIOçš„åŒºåˆ«" class="headerlink" title="BIOã€NIOã€AIOçš„åŒºåˆ«"></a>BIOã€NIOã€AIOçš„åŒºåˆ«</h3><table><thead><tr><th align="left"><strong>ç‰¹æ€§</strong></th><th align="left">ä¼ ç»Ÿ IO</th><th align="left">NIO</th></tr></thead><tbody><tr><td align="left"><strong>æ¨¡å‹</strong></td><td align="left">é˜»å¡å¼ï¼ˆBlockingï¼‰</td><td align="left">éé˜»å¡å¼ï¼ˆNon-blockingï¼‰</td></tr><tr><td align="left"><strong>æ•°æ®å•ä½</strong></td><td align="left">æµï¼ˆStreamï¼‰</td><td align="left">ç¼“å†²åŒºï¼ˆBufferï¼‰ + é€šé“ï¼ˆChannelï¼‰</td></tr><tr><td align="left"><strong>å¤šè·¯å¤ç”¨</strong></td><td align="left">ä¸æ”¯æŒ</td><td align="left">Selector è½®è¯¢æœºåˆ¶</td></tr></tbody></table><h3 id="NIO-ä¸‰å¤§æ ¸å¿ƒç»„ä»¶"><a href="#NIO-ä¸‰å¤§æ ¸å¿ƒç»„ä»¶" class="headerlink" title="NIO ä¸‰å¤§æ ¸å¿ƒç»„ä»¶"></a>NIO ä¸‰å¤§æ ¸å¿ƒç»„ä»¶</h3><ul><li><strong>Buffer</strong>ï¼šæ•°æ®å®¹å™¨ï¼ˆå¦‚ <code>ByteBuffer</code>ï¼‰ï¼Œæ”¯æŒ <code>flip()</code>ã€<code>clear()</code> ç­‰æ“ä½œã€‚</li><li><strong>Channel</strong>ï¼šåŒå‘æ•°æ®ä¼ è¾“é€šé“ï¼ˆå¦‚ <code>FileChannel</code>ã€<code>SocketChannel</code>ï¼‰ã€‚</li><li><strong>Selector</strong>ï¼šå•çº¿ç¨‹ç›‘å¬å¤šä¸ª Channel äº‹ä»¶ï¼ˆOP_READ&#x2F;OP_WRITEï¼‰ã€‚</li></ul><h3 id="ä»€ä¹ˆæ˜¯é›¶æ‹·è´"><a href="#ä»€ä¹ˆæ˜¯é›¶æ‹·è´" class="headerlink" title="ä»€ä¹ˆæ˜¯é›¶æ‹·è´"></a>ä»€ä¹ˆæ˜¯é›¶æ‹·è´</h3><h3 id="5ç§IOæ¨¡å‹"><a href="#5ç§IOæ¨¡å‹" class="headerlink" title="5ç§IOæ¨¡å‹"></a>5ç§IOæ¨¡å‹</h3><h3 id="ä»€ä¹ˆæ˜¯Reactoræ¨¡å‹"><a href="#ä»€ä¹ˆæ˜¯Reactoræ¨¡å‹" class="headerlink" title="ä»€ä¹ˆæ˜¯Reactoræ¨¡å‹"></a>ä»€ä¹ˆæ˜¯Reactoræ¨¡å‹</h3><h2 id="Javaå¹¶å‘"><a href="#Javaå¹¶å‘" class="headerlink" title="Javaå¹¶å‘"></a>Javaå¹¶å‘</h2><h3 id="synchronized-çš„å®ç°åŸç†"><a href="#synchronized-çš„å®ç°åŸç†" class="headerlink" title="synchronized çš„å®ç°åŸç†"></a><code>synchronized</code> çš„å®ç°åŸç†</h3><p><code>synchronized</code> å…³é”®å­—åœ¨ Java ä¸­çš„åº•å±‚å®ç°ä¾èµ–äº <strong>JVM å¯¹è±¡å¤´ã€Monitor ç›‘è§†å™¨é”ä»¥åŠé”å‡çº§æœºåˆ¶</strong>ã€‚</p><h4 id="å¯¹è±¡å¤´ä¸-Mark-Word"><a href="#å¯¹è±¡å¤´ä¸-Mark-Word" class="headerlink" title="å¯¹è±¡å¤´ä¸ Mark Word"></a><strong>å¯¹è±¡å¤´ä¸ Mark Word</strong></h4><ul><li><p>æ¯ä¸ª Java å¯¹è±¡åœ¨å†…å­˜ä¸­åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</p><ul><li><strong>å¯¹è±¡å¤´ï¼ˆHeaderï¼‰</strong>ï¼šå­˜å‚¨é”çŠ¶æ€ã€GC å¹´é¾„ç­‰å…ƒæ•°æ®ã€‚</li><li><strong>å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰</strong>ï¼šå¯¹è±¡å­—æ®µå€¼ã€‚</li><li><strong>å¯¹é½å¡«å……ï¼ˆPaddingï¼‰</strong>ï¼šä¿è¯å†…å­˜å¯¹é½ã€‚</li></ul></li><li><p><strong>Mark Word</strong>ï¼ˆå¯¹è±¡å¤´çš„æ ¸å¿ƒéƒ¨åˆ†ï¼‰å­˜å‚¨ä»¥ä¸‹ä¿¡æ¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">| é”çŠ¶æ€       | å­˜å‚¨å†…å®¹                       |</span><br><span class="line">|-------------|-------------------------------|</span><br><span class="line">| æ— é”         | å¯¹è±¡å“ˆå¸Œç ã€åˆ†ä»£å¹´é¾„             |</span><br><span class="line">| åå‘é”       | åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³           |</span><br><span class="line">| è½»é‡çº§é”      | æŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ             |</span><br><span class="line">| é‡é‡çº§é”      | æŒ‡å‘ Monitor çš„æŒ‡é’ˆ            |</span><br><span class="line">| GC æ ‡è®°      | ä¸åƒåœ¾å›æ”¶ç›¸å…³                  |</span><br></pre></td></tr></table></figure><p><strong>é”çŠ¶æ€çš„å˜åŒ–ç›´æ¥ä½“ç°åœ¨ Mark Word çš„æ¯”ç‰¹ä½ç»„åˆä¸Šã€‚</strong></p></li></ul><h4 id="Monitor-ç›‘è§†å™¨é”"><a href="#Monitor-ç›‘è§†å™¨é”" class="headerlink" title="Monitor ç›‘è§†å™¨é”"></a><strong>Monitor ç›‘è§†å™¨é”</strong></h4><ul><li><p>å½“ <code>synchronized</code> å‡çº§ä¸ºé‡é‡çº§é”æ—¶ï¼ŒMark Word æŒ‡å‘ä¸€ä¸ª <strong>Monitor å¯¹è±¡</strong>ï¼ˆç”± C++ å®ç°çš„ <code>ObjectMonitor</code>ï¼‰ã€‚</p></li><li><p>Monitor çš„æ ¸å¿ƒç»“æ„ï¼š</p><p>cpp</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class ObjectMonitor &#123;</span><br><span class="line">    void*     _header;      // å­˜å‚¨ Mark Word çš„å¤‡ä»½</span><br><span class="line">    void*     _owner;       // æŒæœ‰é”çš„çº¿ç¨‹ï¼ˆå¦‚ï¼šThread*ï¼‰</span><br><span class="line">    intptr_t  _count;       // é‡å…¥æ¬¡æ•°</span><br><span class="line">    ObjectWaiter* _WaitSet; // è°ƒç”¨ wait() åè¿›å…¥ç­‰å¾…é˜Ÿåˆ—</span><br><span class="line">    ObjectWaiter* _EntryList; // é˜»å¡ç­‰å¾…é”çš„çº¿ç¨‹é˜Ÿåˆ—</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>å·¥ä½œæµç¨‹</strong>ï¼š</p><ol><li>çº¿ç¨‹å°è¯•é€šè¿‡ CAS æ“ä½œå°† Mark Word æ›¿æ¢ä¸ºæŒ‡å‘ Monitor çš„æŒ‡é’ˆã€‚</li><li>æˆåŠŸåˆ™æˆä¸º <code>_owner</code>ï¼Œå¤±è´¥åˆ™è¿›å…¥ <code>_EntryList</code> é˜»å¡ï¼ˆé€šè¿‡æ“ä½œç³»ç»Ÿ mutex å®ç°ï¼‰ã€‚</li><li>å½“ <code>_owner</code> é‡Šæ”¾é”æ—¶ï¼Œå”¤é†’ <code>_EntryList</code> ä¸­çš„çº¿ç¨‹ç«äº‰é”ã€‚</li></ol></li></ul><h4 id="é”å‡çº§æœºåˆ¶"><a href="#é”å‡çº§æœºåˆ¶" class="headerlink" title="é”å‡çº§æœºåˆ¶"></a><strong>é”å‡çº§æœºåˆ¶</strong></h4><p>ä¸ºæé«˜æ€§èƒ½ï¼Œä» java1.6 å¼€å§‹é‡‡ç”¨æ¸è¿›å¼é”å‡çº§ç­–ç•¥ï¼š</p><p>(1) <strong>åå‘é”ï¼ˆBiased Lockingï¼‰</strong></p><ul><li><strong>ç›®æ ‡</strong>ï¼šå‡å°‘æ— ç«äº‰æ—¶çš„å¼€é”€ã€‚</li><li><strong>æµç¨‹</strong>ï¼š<ul><li>é¦–æ¬¡åŠ é”æ—¶ï¼Œé€šè¿‡ CAS å°† Mark Word çš„é”æ ‡å¿—ç½®ä¸º <code>101</code>ï¼ˆåå‘é”ï¼‰ï¼Œå¹¶å†™å…¥å½“å‰çº¿ç¨‹ IDã€‚</li><li>åç»­åŒä¸€çº¿ç¨‹è¿›å…¥åŒæ­¥å—æ—¶ï¼Œåªéœ€æ£€æŸ¥çº¿ç¨‹ ID åŒ¹é…å³å¯ç›´æ¥æ‰§è¡Œï¼ˆé›¶å¼€é”€ï¼‰ã€‚</li></ul></li><li><strong>æ’¤é”€</strong>ï¼šå½“å…¶ä»–çº¿ç¨‹å°è¯•è·å–é”æ—¶ï¼Œæ’¤é”€åå‘é”ï¼ˆStop-The-World æ“ä½œï¼‰ã€‚</li></ul><p>(2) <strong>è½»é‡çº§é”ï¼ˆLightweight Lockingï¼‰</strong></p><ul><li><strong>ç›®æ ‡</strong>ï¼šé¿å…çŸ­æ—¶é˜»å¡çš„çº¿ç¨‹åˆ‡æ¢å¼€é”€ã€‚</li><li><strong>æµç¨‹</strong>ï¼š<ol><li>åœ¨æ ˆå¸§ä¸­åˆ›å»º <strong>é”è®°å½•ï¼ˆLock Recordï¼‰</strong>ã€‚</li><li>é€šè¿‡ CAS å°† Mark Word å¤åˆ¶åˆ°é”è®°å½•ï¼Œå¹¶å°è¯•å°† Mark Word æ›¿æ¢ä¸ºæŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆã€‚</li><li>æˆåŠŸåˆ™è·å¾—é”ï¼›å¤±è´¥åˆ™è‡ªæ—‹ï¼ˆå¾ªç¯å°è¯•ï¼‰ä¸€å®šæ¬¡æ•°ã€‚</li></ol></li><li><strong>è‡ªæ—‹å¤±è´¥åå‡çº§ä¸ºé‡é‡çº§é”</strong>ã€‚</li></ul><p>(3) <strong>é‡é‡çº§é”ï¼ˆHeavyweight Lockingï¼‰</strong></p><ul><li>å½“ç«äº‰æ¿€çƒˆæ—¶ï¼Œæœ€ç»ˆå‡çº§ä¸ºé‡é‡çº§é”ã€‚</li><li>çº¿ç¨‹é€šè¿‡æ“ä½œç³»ç»Ÿäº’æ–¥é‡ï¼ˆmutexï¼‰é˜»å¡ï¼Œè¿›å…¥å†…æ ¸æ€ï¼Œæ€§èƒ½å¼€é”€æœ€å¤§ã€‚</li></ul><img src="/post/65a5b0d7/image-20250725195316321.png" class="" title="image-20250725195316321"><p><code>synchronized</code> å’Œ <code>ReentrantLock</code> æœ‰ä»€ä¹ˆåŒºåˆ«</p><ul><li>synchronized æ˜¯ JVM å®ç°çš„ï¼ŒReentrantLock æ˜¯ JDK å®ç°çš„</li><li>synchronized ä¸å¯ä¸­æ–­ï¼ŒReentrantLock å¯ä¸­æ–­</li><li>synchronized éå…¬å¹³ï¼ŒReentrantLock é»˜è®¤ä¹Ÿæ˜¯éå…¬å¹³ï¼Œå¯è®¾ç½®ä¸ºå…¬å¹³</li><li>synchronized åªèƒ½é”å®šä¸€ä¸ªå¯¹è±¡ï¼ŒReentrantLock å¯ä»¥é”å®šå¤šä¸ªå¯¹è±¡</li></ul><h3 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a><code>ThreadLocal</code></h3><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>ThreadLocal æ˜¯ Java ä¸­ä¸€ä¸ªç”¨äºå®ç°<strong>çº¿ç¨‹å±€éƒ¨å˜é‡</strong>çš„å·¥å…·ç±»ã€‚å®ƒä¸ºæ¯ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çº¿ç¨‹æä¾›äº†ä¸€ä¸ªç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œä»è€Œå®ç°äº†çº¿ç¨‹é—´çš„æ•°æ®éš”ç¦»ã€‚è¿™æ„å‘³ç€æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜è‡ªå·±çš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„å‰¯æœ¬ã€‚</p><p><strong>æ ¸å¿ƒåŸç†ï¼š</strong></p><ol><li><strong>Thread ç±»ä¸­çš„ ThreadLocalMapï¼š</strong><ul><li>æ¯ä¸ª <code>Thread</code> å¯¹è±¡å†…éƒ¨éƒ½æœ‰ä¸€ä¸ªç§æœ‰æˆå‘˜å˜é‡ <code>threadLocals</code> (åœ¨ JDK æºç ä¸­æ˜¯ <code>java.lang.Thread.threadLocals</code>)ï¼Œå®ƒçš„ç±»å‹æ˜¯ <code>ThreadLocal.ThreadLocalMap</code>ã€‚</li><li><code>ThreadLocalMap</code> æ˜¯ä¸€ä¸ªå®šåˆ¶çš„ã€ç±»ä¼¼ <code>HashMap</code> çš„ç»“æ„ï¼Œä¸“é—¨ç”¨äºå­˜å‚¨çº¿ç¨‹å±€éƒ¨å˜é‡ã€‚å®ƒçš„é”®æ˜¯ <code>ThreadLocal</code> å¯¹è±¡æœ¬èº«ï¼ˆä½¿ç”¨å¼±å¼•ç”¨ï¼‰ï¼Œå€¼æ˜¯è¯¥çº¿ç¨‹å¯¹åº”çš„å˜é‡å‰¯æœ¬ã€‚</li></ul></li><li><strong>ThreadLocal çš„æ“ä½œæœºåˆ¶ï¼š</strong><ul><li><strong><code>set(T value)</code>ï¼š</strong> å½“è°ƒç”¨ <code>threadLocal.set(value)</code> æ—¶ï¼š<ol><li>è·å–å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ (<code>Thread.currentThread()</code>)ã€‚</li><li>è·å–è¯¥çº¿ç¨‹çš„ <code>threadLocals</code> æˆå‘˜ï¼ˆä¸€ä¸ª <code>ThreadLocalMap</code>ï¼‰ã€‚</li><li>å¦‚æœ <code>threadLocals</code> ä¸º <code>null</code>ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>ThreadLocalMap</code> å¹¶èµ‹å€¼ç»™çº¿ç¨‹çš„ <code>threadLocals</code>ã€‚</li><li>ä»¥å½“å‰çš„ <code>ThreadLocal</code> å®ä¾‹ (<code>this</code>) ä½œä¸ºé”®ï¼Œä¼ å…¥çš„ <code>value</code> ä½œä¸ºå€¼ï¼Œå­˜å‚¨åˆ°è¿™ä¸ªçº¿ç¨‹çš„ <code>ThreadLocalMap</code> ä¸­ã€‚</li></ol></li><li><strong><code>get()</code>ï¼š</strong> å½“è°ƒç”¨ <code>threadLocal.get()</code> æ—¶ï¼š<ol><li>è·å–å½“å‰çº¿ç¨‹ã€‚</li><li>è·å–è¯¥çº¿ç¨‹çš„ <code>threadLocals</code>ã€‚</li><li>å¦‚æœ <code>threadLocals</code> ä¸ä¸º <code>null</code>ï¼Œåˆ™ä»¥å½“å‰ <code>ThreadLocal</code> å®ä¾‹ä¸ºé”®ï¼ŒæŸ¥æ‰¾ <code>ThreadLocalMap</code> ä¸­å¯¹åº”çš„æ¡ç›® (<code>Entry</code>)ã€‚</li><li>å¦‚æœæ‰¾åˆ°æ¡ç›®ä¸”æ¡ç›®ä¸ä¸º <code>null</code>ï¼Œåˆ™è¿”å›å…¶å€¼ã€‚</li><li>å¦‚æœæ²¡æ‰¾åˆ°æˆ–æ‰¾åˆ°çš„æ¡ç›®å€¼ä¸º <code>null</code>ï¼Œåˆ™è°ƒç”¨ <code>initialValue()</code> æ–¹æ³•ï¼ˆå¦‚æœç”¨æˆ·é‡å†™äº†ï¼‰æˆ– <code>setInitialValue()</code> æ–¹æ³•æ¥åˆå§‹åŒ–å¹¶è®¾ç½®ä¸€ä¸ªå€¼ï¼ˆé€šå¸¸é»˜è®¤è¿”å› <code>null</code>ï¼‰ï¼Œç„¶åè¿”å›è¿™ä¸ªåˆå§‹å€¼ã€‚</li></ol></li><li><strong><code>remove()</code>ï¼š</strong> å½“è°ƒç”¨ <code>threadLocal.remove()</code> æ—¶ï¼š<ol><li>è·å–å½“å‰çº¿ç¨‹çš„ <code>threadLocals</code>ã€‚</li><li>å¦‚æœ <code>threadLocals</code> ä¸ä¸º <code>null</code>ï¼Œåˆ™ä»ä¸­ç§»é™¤ä»¥å½“å‰ <code>ThreadLocal</code> å®ä¾‹ä¸ºé”®çš„æ¡ç›®ã€‚<strong>è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ“ä½œï¼Œç”¨äºé¿å…å†…å­˜æ³„æ¼ï¼</strong></li></ol></li></ul></li><li><strong>å…³é”®ç‚¹ï¼š</strong><ul><li><strong>æ•°æ®å­˜å‚¨ä½ç½®ï¼š</strong> å˜é‡å‰¯æœ¬å®é™…å­˜å‚¨åœ¨<strong>çº¿ç¨‹å¯¹è±¡</strong>å†…éƒ¨çš„ <code>ThreadLocalMap</code> é‡Œï¼Œè€Œä¸æ˜¯å­˜å‚¨åœ¨ <code>ThreadLocal</code> å¯¹è±¡æœ¬èº«ã€‚<code>ThreadLocal</code> åªæ˜¯ä¸€ä¸ªè®¿é—®è¿™äº›å‰¯æœ¬çš„å·¥å…·å’Œé”®ã€‚</li><li><strong>é”®çš„å¼•ç”¨ï¼š</strong> <code>ThreadLocalMap</code> ä¸­çš„é”® (<code>ThreadLocal</code> å¯¹è±¡) æ˜¯<strong>å¼±å¼•ç”¨</strong>ã€‚è¿™æ˜¯ä¸ºäº†åœ¨ <code>ThreadLocal</code> å®ä¾‹æœ¬èº«ä¸å†è¢«å¼ºå¼•ç”¨æ—¶ï¼ˆæ¯”å¦‚è¢« GC å›æ”¶äº†ï¼‰ï¼Œ<code>ThreadLocalMap</code> ä¸­çš„é”®èƒ½è‡ªåŠ¨è¢« GC å›æ”¶ï¼Œé¿å…å†…å­˜æ³„æ¼ï¼ˆé”®éƒ¨åˆ†ï¼‰ã€‚</li><li><strong>å€¼çš„å¼•ç”¨ï¼š</strong> <code>ThreadLocalMap</code> ä¸­çš„å€¼æ˜¯<strong>å¼ºå¼•ç”¨</strong>ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¦‚æœ <code>ThreadLocal</code> è¢«å›æ”¶äº†ï¼ˆé”®å˜ <code>null</code>ï¼‰ï¼Œä½†çº¿ç¨‹ï¼ˆå°¤å…¶æ˜¯çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼‰é•¿æœŸå­˜æ´»ï¼Œä¸”æ²¡æœ‰è°ƒç”¨ <code>remove()</code> æ–¹æ³•ï¼Œé‚£ä¹ˆå€¼å¯¹è±¡ä¼šä¸€ç›´è¢« <code>ThreadLocalMap</code> çš„æ¡ç›®å¼ºå¼•ç”¨ç€ï¼Œå¯¼è‡´å€¼å¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼Œé€ æˆ<strong>å†…å­˜æ³„æ¼</strong>ï¼ˆå€¼éƒ¨åˆ†ï¼‰ã€‚</li><li><strong>å†…å­˜æ³„æ¼é£é™©ï¼š</strong> è¿™æ˜¯ä½¿ç”¨ <code>ThreadLocal</code> æœ€å¤§çš„éšæ‚£ã€‚ä¸»è¦å‘ç”Ÿåœ¨ï¼š<ul><li>ä½¿ç”¨äº†<strong>çº¿ç¨‹æ± </strong>ï¼ˆçº¿ç¨‹å¤ç”¨ï¼Œç”Ÿå‘½å‘¨æœŸé•¿ï¼‰ã€‚</li><li>åœ¨ <code>ThreadLocal</code> ä¸­å­˜å‚¨äº†<strong>å¤§å¯¹è±¡</strong>ã€‚</li><li>åœ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œ<strong>æ²¡æœ‰è°ƒç”¨ <code>threadLocal.remove()</code></strong> æ¥æ¸…ç†å½“å‰çº¿ç¨‹çš„å‰¯æœ¬ã€‚</li></ul></li><li><strong>ç»§æ‰¿æ€§ï¼š</strong> <code>ThreadLocal</code> æœ¬èº«ä¸æ”¯æŒå˜é‡ä»çˆ¶çº¿ç¨‹ä¼ é€’ç»™å­çº¿ç¨‹ã€‚å¦‚æœéœ€è¦è¿™ç§èƒ½åŠ›ï¼Œå¯ä»¥ä½¿ç”¨ <code>InheritableThreadLocal</code>ã€‚</li></ul></li></ol><img src="/post/65a5b0d7/image-20250725210437363.png" class="" title="image-20250725210437363"><p><strong>å®é™…åº”ç”¨åœºæ™¯ï¼š</strong></p><p><code>ThreadLocal</code> ä¸»è¦ç”¨äºéœ€è¦å°†çŠ¶æ€ï¼ˆå¦‚ç”¨æˆ· IDã€äº‹åŠ¡ä¸Šä¸‹æ–‡ã€Locale ä¿¡æ¯ï¼‰ä¸å•ä¸ªçº¿ç¨‹å…³è”çš„åœºæ™¯ï¼Œé¿å…åœ¨æ–¹æ³•å‚æ•°ä¸­æ˜¾å¼ä¼ é€’è¿™äº›ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå°¤å…¶æ˜¯åœ¨è°ƒç”¨é“¾å¾ˆæ·±çš„æƒ…å†µä¸‹ã€‚å¸¸è§åº”ç”¨åŒ…æ‹¬ï¼š</p><ol><li><strong>ä¸Šä¸‹æ–‡ä¿¡æ¯ä¼ é€’ï¼š</strong><ul><li><strong>ç”¨æˆ·ä¼šè¯ (Session&#x2F;User ID)ï¼š</strong> åœ¨ Web åº”ç”¨ä¸­ï¼Œä¸€ä¸ªè¯·æ±‚é€šå¸¸ç”±ä¸€ä¸ªçº¿ç¨‹å¤„ç†ã€‚å°†å½“å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯å­˜å‚¨åœ¨ <code>ThreadLocal</code> ä¸­ï¼Œå¯ä»¥åœ¨è¯·æ±‚å¤„ç†çš„ä»»ä½•åœ°æ–¹ï¼ˆController, Service, DAOï¼‰æ–¹ä¾¿åœ°è·å–ï¼Œæ— éœ€åœ¨æ¯ä¸ªæ–¹æ³•å‚æ•°ä¸­ä¼ é€’ã€‚</li><li><strong>äº‹åŠ¡ç®¡ç†ï¼š</strong> Spring æ¡†æ¶ç­‰ä½¿ç”¨ <code>ThreadLocal</code> æ¥ä¿å­˜å½“å‰çº¿ç¨‹çš„äº‹åŠ¡ä¸Šä¸‹æ–‡ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ Connection å¯¹è±¡ï¼‰ï¼Œç¡®ä¿åŒä¸€ä¸ªäº‹åŠ¡å†…çš„æ‰€æœ‰æ•°æ®åº“æ“ä½œä½¿ç”¨åŒä¸€ä¸ªè¿æ¥ã€‚</li><li><strong>å…¨å±€è¯·æ±‚ä¿¡æ¯ï¼š</strong> å¦‚è¯·æ±‚ IDã€Trace IDï¼ˆç”¨äºåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªï¼‰ã€æ—¶åŒºã€è¯­è¨€ (Locale) ç­‰ã€‚</li><li><strong>æƒé™ä¿¡æ¯ï¼š</strong> å½“å‰ç”¨æˆ·çš„è§’è‰²ã€æƒé™åˆ—è¡¨ç­‰ã€‚</li></ul></li><li><strong>çº¿ç¨‹ä¸“æœ‰å¯¹è±¡ï¼š</strong><ul><li><strong>éçº¿ç¨‹å®‰å…¨å¯¹è±¡çš„çº¿ç¨‹å®‰å…¨ä½¿ç”¨ï¼š</strong> ä¾‹å¦‚ <code>SimpleDateFormat</code> æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ <code>SimpleDateFormat</code> å®ä¾‹å­˜å‚¨åœ¨ <code>ThreadLocal</code> ä¸­ï¼Œå¯ä»¥é¿å…åŒæ­¥å¼€é”€å’Œçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</li><li><strong>é¿å…é‡å¤åˆ›å»ºå¼€é”€å¤§çš„å¯¹è±¡ï¼š</strong> å¦‚æœä¸€ä¸ªå¯¹è±¡åˆ›å»ºæˆæœ¬é«˜ï¼ˆå¦‚å¤æ‚çš„è§£æå™¨ã€å¤§ç¼“å†²åŒºï¼‰ï¼Œä¸”ä»…åœ¨çº¿ç¨‹å†…éƒ¨å¤šæ¬¡ä½¿ç”¨ï¼Œå¯ä»¥å°†å…¶å­˜å‚¨åœ¨ <code>ThreadLocal</code> ä¸­ä½œä¸ºçº¿ç¨‹çš„â€œç¼“å­˜â€ï¼Œé¿å…æ¯æ¬¡ä½¿ç”¨éƒ½åˆ›å»ºæ–°å®ä¾‹ã€‚</li><li><strong>æ•°æ®åº“è¿æ¥ï¼ˆç‰¹å®šåœºæ™¯ï¼‰ï¼š</strong> è™½ç„¶é€šå¸¸ç”±è¿æ¥æ± ç®¡ç†ï¼Œä½†åœ¨ä¸€äº›ç‰¹æ®Šè®¾è®¡æˆ–å°å‹åº”ç”¨ä¸­ï¼Œ<code>ThreadLocal</code> å¯ç”¨äºç¡®ä¿ä¸€ä¸ªçº¿ç¨‹å†…å¤šæ¬¡æ•°æ®åº“æ“ä½œå¤ç”¨åŒä¸€ä¸ªè¿æ¥ï¼ˆéœ€è°¨æ…ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼‰ã€‚</li></ul></li><li><strong>è·¨æ–¹æ³•å‚æ•°ä¼ é€’ï¼š</strong><ul><li>å½“ä¸€ä¸ªå‚æ•°éœ€è¦åœ¨è°ƒç”¨æ ˆä¸­å¾ˆæ·±å±‚æ¬¡çš„æ–¹æ³•ä¸­ä½¿ç”¨ï¼Œä½†ä¸­é—´å±‚æ–¹æ³•ä¸éœ€è¦å®ƒæ—¶ï¼Œæ˜¾å¼ä¼ é€’ä¼šæ±¡æŸ“ä¸­é—´æ–¹æ³•çš„ç­¾åã€‚å°†å…¶æ”¾å…¥ <code>ThreadLocal</code> å¯ä»¥é¿å…è¿™ç§æ˜¾å¼ä¼ é€’ã€‚</li></ul></li><li><strong>æ›¿ä»£æ˜¾å¼åŒæ­¥ï¼š</strong><ul><li>å½“å¤šä¸ªçº¿ç¨‹éœ€è¦æ“ä½œä¸åŒå®ä¾‹ï¼ˆéå…±äº«ï¼‰çš„æ•°æ®æ—¶ï¼Œä½¿ç”¨ <code>ThreadLocal</code> è®©æ¯ä¸ªçº¿ç¨‹æ“ä½œè‡ªå·±çš„å‰¯æœ¬ï¼Œå¯ä»¥å®Œå…¨é¿å…åŒæ­¥ï¼ˆé”ï¼‰å¸¦æ¥çš„æ€§èƒ½å¼€é”€å’Œå¤æ‚æ€§ã€‚</li></ul></li></ol><p><strong>ä½¿ç”¨ ThreadLocal çš„æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹ï¼š</strong></p><ol><li><p><strong><code>private static final</code>ï¼š</strong> é€šå¸¸å°† <code>ThreadLocal</code> å˜é‡å£°æ˜ä¸º <code>private static final</code>ã€‚<code>static</code> ç¡®ä¿æ¯ä¸ªç±»åªæœ‰ä¸€ä¸ª <code>ThreadLocal</code> å®ä¾‹ï¼ˆä½œä¸ºé”®ï¼‰ï¼Œ<code>final</code> é˜²æ­¢æ„å¤–ä¿®æ”¹å¼•ç”¨ã€‚<code>private</code> æ§åˆ¶è®¿é—®ã€‚</p></li><li><p><strong>åŠ¡å¿…æ¸…ç†ï¼š</strong> è¿™æ˜¯æœ€é‡è¦çš„ï¼<strong>å°¤å…¶æ˜¯åœ¨ä½¿ç”¨çº¿ç¨‹æ± æ—¶</strong>ã€‚åœ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ã€çº¿ç¨‹è¢«å½’è¿˜ç»™çº¿ç¨‹æ± ä¹‹å‰ï¼Œå¿…é¡»è°ƒç”¨ <code>threadLocal.remove()</code> æ¥æ˜¾å¼æ¸…é™¤å½“å‰çº¿ç¨‹çš„å‰¯æœ¬ã€‚å¦åˆ™ä¼šå¯¼è‡´ä¸¥é‡çš„å†…å­˜æ³„æ¼å’Œæ½œåœ¨çš„æ•°æ®é”™ä¹±ï¼ˆçº¿ç¨‹æ± ä¸­ä¸‹ä¸€ä¸ªä»»åŠ¡å¯èƒ½è¯»åˆ°å‰ä¸€ä¸ªä»»åŠ¡é—ç•™çš„æ•°æ®ï¼‰ã€‚</p><ul><li><p>ä½¿ç”¨ <code>try-finally</code> å—ç¡®ä¿ <code>remove()</code> è¢«æ‰§è¡Œï¼š</p><p>java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">    threadLocal.set(someValue);</span><br><span class="line">    // ... æ‰§è¡Œä¸šåŠ¡é€»è¾‘ ...</span><br><span class="line">&#125; finally &#123;</span><br><span class="line">    threadLocal.remove(); // æ— è®ºå¦‚ä½•éƒ½æ¸…ç†</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>é¿å…å­˜å‚¨å¤§å¯¹è±¡ï¼š</strong> è°¨æ…å­˜å‚¨å ç”¨å†…å­˜å¤§çš„å¯¹è±¡ï¼Œå› ä¸ºçº¿ç¨‹é•¿æœŸå­˜æ´»ï¼ˆå°¤å…¶æ˜¯çº¿ç¨‹æ± ï¼‰ä¼šå¯¼è‡´è¿™äº›å¯¹è±¡é•¿æœŸæ— æ³•é‡Šæ”¾ã€‚</p></li><li><p><strong>ç†è§£å†…å­˜æ³„æ¼ï¼š</strong> æ·±åˆ»ç†è§£å¼±å¼•ç”¨é”®å’Œå¼ºå¼•ç”¨å€¼å¯¼è‡´çš„å†…å­˜æ³„æ¼æœºåˆ¶ï¼Œå¹¶ä¸¥æ ¼éµå®ˆ <code>remove()</code> çš„è§„èŒƒã€‚</p></li><li><p><strong>è€ƒè™‘ InheritableThreadLocalï¼š</strong> å¦‚æœéœ€è¦çˆ¶çº¿ç¨‹çš„å±€éƒ¨å˜é‡è¢«å­çº¿ç¨‹ç»§æ‰¿ï¼Œä½¿ç”¨ <code>InheritableThreadLocal</code>ã€‚ä½†è¦æ³¨æ„çº¿ç¨‹æ± åœºæ™¯ä¸‹ï¼Œçº¿ç¨‹æ˜¯å¤ç”¨çš„ï¼Œå­ä»»åŠ¡å¯èƒ½ä¸æ˜¯ç”±åˆ›å»º <code>InheritableThreadLocal</code> çš„çˆ¶çº¿ç¨‹æ‰§è¡Œçš„ï¼Œç»§æ‰¿å¯èƒ½ä¸ç¬¦åˆé¢„æœŸã€‚</p></li><li><p><strong>åˆå§‹å€¼ï¼š</strong> å¯ä»¥é€šè¿‡è¦†ç›– <code>initialValue()</code> æ–¹æ³•ï¼ˆåœ¨ç¬¬ä¸€æ¬¡ <code>get()</code> æ—¶è°ƒç”¨ï¼‰æˆ–åœ¨ Java 8 ä¹‹åä½¿ç”¨ <code>ThreadLocal.withInitial(Supplier)</code> æ¥è®¾ç½®åˆå§‹å€¼ã€‚</p></li></ol><p><strong>æ€»ç»“ï¼š</strong></p><p><code>ThreadLocal</code> é€šè¿‡åœ¨æ¯ä¸ªçº¿ç¨‹å†…éƒ¨ç»´æŠ¤ä¸€ä¸ªä¸“å±çš„å˜é‡å­˜å‚¨ç©ºé—´ (<code>ThreadLocalMap</code>)ï¼Œå®ç°äº†é«˜æ•ˆçš„çº¿ç¨‹å±€éƒ¨å˜é‡ã€‚å®ƒæ˜¯è§£å†³çº¿ç¨‹é—´æ•°æ®éš”ç¦»ã€ä¸Šä¸‹æ–‡ä¼ é€’ã€çº¿ç¨‹ä¸“æœ‰å¯¹è±¡ç®¡ç†ç­‰é—®é¢˜çš„å¼ºå¤§å·¥å…·ã€‚ç„¶è€Œï¼Œå…¶ä¼´éšçš„<strong>å†…å­˜æ³„æ¼é£é™©</strong>è¦æ±‚å¼€å‘è€…å¿…é¡»ä¸¥æ ¼éµå®ˆ <code>remove()</code> çš„æœ€ä½³å®è·µï¼Œå°¤å…¶æ˜¯åœ¨çº¿ç¨‹æ± ç¯å¢ƒä¸‹ã€‚åˆç†ä½¿ç”¨ <code>ThreadLocal</code> å¯ä»¥ç®€åŒ–ä»£ç ã€æé«˜æ€§èƒ½ï¼Œä½†æ»¥ç”¨æˆ–ç–å¿½æ¸…ç†åˆ™å¯èƒ½å¸¦æ¥éš¾ä»¥æ’æŸ¥çš„é—®é¢˜ã€‚</p><h4 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h4><p><strong>ç¤ºä¾‹1ï¼šå­˜å‚¨ç”¨æˆ·ä¿¡æ¯</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserContextHolder</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªThreadLocalå˜é‡ï¼Œç”¨äºå­˜å‚¨ç”¨æˆ·IDã€‚é€šå¸¸å£°æ˜ä¸ºprivate static final</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;String&gt; currentUser = ThreadLocal.withInitial(() -&gt; <span class="literal">null</span>);</span><br><span class="line">    <span class="comment">// è®¾ç½®å½“å‰çº¿ç¨‹çš„ç”¨æˆ·ID</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setCurrentUser</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        currentUser.set(userId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰çº¿ç¨‹çš„ç”¨æˆ·ID</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getCurrentUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> currentUser.get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ¸…é™¤å½“å‰çº¿ç¨‹çš„ç”¨æˆ·IDï¼ˆé‡è¦ï¼é¿å…å†…å­˜æ³„æ¼ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">        currentUser.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æ‹¦æˆªå™¨æˆ–è¿‡æ»¤å™¨ä¸­è®¾ç½®å’Œæ¸…é™¤</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> &#123;</span><br><span class="line">        <span class="comment">// ä»è¯·æ±‚ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆæ¯”å¦‚tokenè§£æï¼‰</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> ...; </span><br><span class="line">        UserContextHolder.setCurrentUser(userId);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> &#123;</span><br><span class="line">        <span class="comment">// è¯·æ±‚å¤„ç†å®Œæˆåï¼Œæ¸…é™¤ThreadLocalï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span></span><br><span class="line">        UserContextHolder.clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹2ï¼šäº‹åŠ¡ç®¡ç†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionContextHolder</span> &#123;</span><br><span class="line">    <span class="comment">// å­˜å‚¨å½“å‰çº¿ç¨‹çš„äº‹åŠ¡è¿æ¥</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Connection&gt; currentConnection = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> currentConnection.get();</span><br><span class="line">        <span class="keyword">if</span> (conn == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä»è¿æ¥æ± è·å–ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œå¹¶è®¾ç½®åˆ°ThreadLocal</span></span><br><span class="line">            conn = DataSourceUtils.getConnection(); <span class="comment">// å‡è®¾çš„å·¥å…·ç±»</span></span><br><span class="line">            currentConnection.set(conn);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">bindConnection</span><span class="params">(Connection conn)</span> &#123;</span><br><span class="line">        currentConnection.set(conn);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">unbindConnection</span><span class="params">()</span> &#123;</span><br><span class="line">        currentConnection.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionManager</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">begin</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> TransactionContextHolder.getConnection();</span><br><span class="line">        conn.setAutoCommit(<span class="literal">false</span>); <span class="comment">// å¼€å¯äº‹åŠ¡</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> TransactionContextHolder.getConnection();</span><br><span class="line">        conn.commit();</span><br><span class="line">        TransactionContextHolder.unbindConnection(); <span class="comment">// æäº¤åç§»é™¤è¿æ¥ï¼Œå¹¶é‡Šæ”¾åˆ°è¿æ¥æ± </span></span><br><span class="line">        DataSourceUtils.releaseConnection(conn); <span class="comment">// å‡è®¾çš„å·¥å…·ç±»ï¼Œå°†è¿æ¥å½’è¿˜è¿æ¥æ± </span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">rollback</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...ç±»ä¼¼commitï¼Œå›æ»šäº‹åŠ¡å¹¶æ¸…ç†</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> TransactionContextHolder.getConnection();</span><br><span class="line">        <span class="comment">// ä½¿ç”¨connæ‰§è¡Œæ›´æ–°...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="JUCé›†åˆ"><a href="#JUCé›†åˆ" class="headerlink" title="JUCé›†åˆ"></a>JUCé›†åˆ</h3><h4 id="ConcurrentHashMap-çš„å®ç°åŸç†"><a href="#ConcurrentHashMap-çš„å®ç°åŸç†" class="headerlink" title="ConcurrentHashMap çš„å®ç°åŸç†"></a><code>ConcurrentHashMap</code> çš„å®ç°åŸç†</h4><ul><li><strong>JDK7ï¼šåˆ†æ®µé” (Segment Locking)</strong><ul><li>å°†æ•°æ®åˆ†æˆå¤šä¸ªæ®µ (<code>Segment</code> æ•°ç»„ï¼Œé»˜è®¤ 16 ä¸ªæ®µ)ã€‚</li><li>æ¯ä¸ª <code>Segment</code> æœ¬èº«æ˜¯ä¸€ä¸ªç±»ä¼¼ <code>ReentrantLock</code> çš„é”ï¼Œå¹¶ç®¡ç†ä¸€ä¸ªç‹¬ç«‹çš„ <code>HashEntry</code> æ•°ç»„ (ç›¸å½“äºä¸€ä¸ªå°å‹çš„ <code>HashMap</code>)ã€‚</li><li><strong>é”ç²’åº¦</strong>ï¼šé”ä½çš„æ˜¯<strong>æ•´ä¸ªæ®µ</strong>ã€‚ä¸åŒæ®µä¸Šçš„æ“ä½œå¯ä»¥å¹¶å‘è¿›è¡Œã€‚å¹¶å‘åº¦ç­‰äº <code>Segment</code> çš„æ•°é‡ã€‚</li><li><strong>PUT</strong>ï¼šå…ˆå®šä½åˆ°å“ªä¸ª <code>Segment</code>ï¼Œç„¶åå¯¹è¯¥ <code>Segment</code> <strong>åŠ é”</strong>ï¼Œå†åœ¨è¯¥ <code>Segment</code> å†…éƒ¨çš„å“ˆå¸Œè¡¨ä¸Šè¿›è¡Œæ“ä½œï¼ˆç±»ä¼¼ <code>HashMap</code> JDK7ï¼‰ã€‚</li><li><strong>GET</strong>ï¼š<strong>æ— é”</strong> (volatile è¯»)ã€‚å®šä½åˆ° <code>Segment</code> å’Œ <code>HashEntry</code> åç›´æ¥è¯»å– <code>value</code> (value æ˜¯ volatile çš„)ã€‚</li></ul></li><li><strong>JDK8ï¼š<code>synchronized</code> + <code>CAS</code> + çº¢é»‘æ ‘</strong><ul><li>æ‘’å¼ƒåˆ†æ®µé”ï¼Œé‡‡ç”¨ <code>Node</code> æ•°ç»„ + é“¾è¡¨ &#x2F; çº¢é»‘æ ‘ (ç»“æ„ç±»ä¼¼ <code>HashMap</code> JDK8)ã€‚</li><li><strong>é”ç²’åº¦</strong>ï¼š<strong>é”å•ä¸ªé“¾è¡¨å¤´èŠ‚ç‚¹æˆ–æ ‘æ ¹èŠ‚ç‚¹</strong> (æ¡¶çº§åˆ«)ã€‚å¹¶å‘åº¦å¤§å¤§æé«˜ã€‚</li><li><strong>å…³é”®æœºåˆ¶</strong>ï¼š<ul><li><code>CAS</code> (Compare-And-Swap)ï¼šç”¨äºæ— é”åŒ–çš„åˆå§‹åŒ–æ•°ç»„ã€æ’å…¥æ–°èŠ‚ç‚¹ (<code>tabAt</code>, <code>casTabAt</code>, <code>setTabAt</code> ä½¿ç”¨ <code>Unsafe</code> æ“ä½œ)ã€‚</li><li><code>synchronized</code>ï¼šå½“å‘ç”Ÿå“ˆå¸Œå†²çªï¼ˆæ¡¶ä¸ä¸ºç©ºï¼‰æ—¶ï¼Œå¯¹é“¾è¡¨çš„å¤´èŠ‚ç‚¹æˆ–æ ‘çš„æ ¹èŠ‚ç‚¹åŠ  <code>synchronized</code> é”ã€‚é”å¯¹è±¡æ˜¯å¤´èŠ‚ç‚¹æœ¬èº«ã€‚</li><li><code>volatile</code>ï¼š<code>Node</code> çš„ <code>val</code> å’Œ <code>next</code> å­—æ®µç”¨ <code>volatile</code> ä¿®é¥°ï¼Œä¿è¯å¯è§æ€§ã€‚</li></ul></li><li><strong>PUT</strong>ï¼š<ol><li>è®¡ç®—å“ˆå¸Œå€¼ï¼Œå®šä½æ¡¶ä½ç½®ã€‚</li><li>å¦‚æœæ¡¶ä¸ºç©ºï¼Œå°è¯•ç”¨ <code>CAS</code> æ’å…¥æ–°èŠ‚ç‚¹ã€‚</li><li>å¦‚æœæ¡¶ä¸ä¸ºç©ºï¼ˆå¯èƒ½æœ‰é”ç«äº‰ï¼‰ï¼š<ul><li>å¦‚æœè¯¥æ¡¶èŠ‚ç‚¹æ­£åœ¨æ‰©å®¹ (<code>MOVED</code>)ï¼Œå½“å‰çº¿ç¨‹ååŠ©æ‰©å®¹ (<code>helpTransfer</code>)ã€‚</li><li>å¦åˆ™ï¼Œ<strong>å¯¹æ¡¶çš„å¤´èŠ‚ç‚¹åŠ  <code>synchronized</code> é”</strong>ã€‚</li><li>åœ¨é”å†…ï¼Œæ ¹æ®æ˜¯é“¾è¡¨è¿˜æ˜¯æ ‘ï¼Œæ‰§è¡Œç±»ä¼¼ <code>HashMap</code> JDK8 çš„æ’å…¥é€»è¾‘ï¼ˆå°¾æ’æ³•ï¼Œæ ‘åŒ–ï¼‰ã€‚</li></ul></li><li>æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹ï¼ˆé“¾è¡¨é•¿åº¦è¾¾åˆ° 8 ä¸”æ•°ç»„é•¿åº¦ &lt; 64 æ—¶ä¼˜å…ˆæ‰©å®¹ï¼‰ã€‚</li></ol></li><li><strong>GET</strong>ï¼š<strong>å®Œå…¨æ— é”</strong>ã€‚å®šä½åˆ°æ¡¶åï¼Œæ ¹æ®é“¾è¡¨æˆ–æ ‘éå†æŸ¥æ‰¾ã€‚ä¾èµ– <code>volatile</code> è¯»ä¿è¯å¯è§æ€§ã€‚</li><li><strong>æ‰©å®¹</strong>ï¼šæ”¯æŒ<strong>å¤šçº¿ç¨‹ååŒæ‰©å®¹</strong> (<code>transfer</code>)ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è§¦å‘æ‰©å®¹æ—¶ï¼Œå®ƒè´Ÿè´£åˆ†é…è¿ç§»ä»»åŠ¡åŒºé—´ã€‚å…¶ä»–çº¿ç¨‹åœ¨ PUT æ“ä½œæ—¶å¦‚æœå‘ç°æ­£åœ¨æ‰©å®¹ï¼Œä¼šååŠ©è¿ç§»ä¸€éƒ¨åˆ†æ•°æ®ã€‚ä½¿ç”¨ <code>ForwardingNode</code> èŠ‚ç‚¹æ ‡è®°è¿ç§»å®Œæˆçš„æ¡¶ã€‚</li></ul></li></ul><h4 id="ä¸ºä»€ä¹ˆ-ConcurrentHashMap-æ¯”-Hashtable-æ•ˆç‡é«˜"><a href="#ä¸ºä»€ä¹ˆ-ConcurrentHashMap-æ¯”-Hashtable-æ•ˆç‡é«˜" class="headerlink" title="ä¸ºä»€ä¹ˆ ConcurrentHashMap æ¯” Hashtable æ•ˆç‡é«˜"></a><strong>ä¸ºä»€ä¹ˆ <code>ConcurrentHashMap</code> æ¯” <code>Hashtable</code> æ•ˆç‡é«˜</strong></h4><ul><li><strong>é”ç²’åº¦</strong>ï¼š<ul><li><code>Hashtable</code>ï¼š<strong>å…¨å±€é”</strong>ã€‚é”ä½æ•´ä¸ªè¡¨ï¼Œä¸€æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ“ä½œã€‚</li><li><code>ConcurrentHashMap</code> (JDK7)ï¼šåˆ†æ®µé”ã€‚é”ä½ä¸€ä¸ªæ®µï¼Œä¸åŒæ®µæ“ä½œå¯å¹¶å‘ã€‚</li><li><code>ConcurrentHashMap</code> (JDK8)ï¼šæ¡¶é” (å¤´èŠ‚ç‚¹é”)ã€‚é”ç²’åº¦æ›´ç»†ï¼Œå†²çªæ¦‚ç‡æ›´ä½ï¼Œå¹¶å‘åº¦æ›´é«˜ã€‚</li></ul></li><li><strong>æ— é”è¯»</strong>ï¼š<ul><li><code>Hashtable</code>ï¼šè¯»æ“ä½œä¹Ÿéœ€è¦è·å–é”ã€‚</li><li><code>ConcurrentHashMap</code> (JDK7 &amp; JDK8)ï¼š<strong>è¯»æ“ä½œå®Œå…¨æ— é”</strong> (JDK7 åˆ©ç”¨ volatile valueï¼ŒJDK8 åˆ©ç”¨ volatile val&#x2F;next å’Œ Unsafe çš„åŸå­è¯»)ï¼Œæå¤§æå‡è¯»æ€§èƒ½ã€‚</li></ul></li></ul><h2 id="å¼‚æ­¥ç¼–ç¨‹"><a href="#å¼‚æ­¥ç¼–ç¨‹" class="headerlink" title="å¼‚æ­¥ç¼–ç¨‹"></a>å¼‚æ­¥ç¼–ç¨‹</h2><h3 id="CompletableFutureçš„åŸç†ä¸åº”ç”¨"><a href="#CompletableFutureçš„åŸç†ä¸åº”ç”¨" class="headerlink" title="CompletableFutureçš„åŸç†ä¸åº”ç”¨"></a><code>CompletableFuture</code>çš„åŸç†ä¸åº”ç”¨</h3><p><code>CompletableFuture</code> æ˜¯ Java 8 å¼•å…¥çš„æ ¸å¿ƒå¹¶å‘å·¥å…·ç±»ï¼ˆä½äº <code>java.util.concurrent</code> åŒ…ï¼‰ï¼Œå®ƒä»£è¡¨ä¸€ä¸ª<strong>å¼‚æ­¥è®¡ç®—çš„ç»“æœ</strong>ã€‚å®ƒä¸ä»…æ˜¯å¯¹ä¼ ç»Ÿ <code>Future</code> æ¥å£çš„å¢å¼ºï¼Œæ›´æ˜¯ä¸€ä¸ªå¼ºå¤§çš„<strong>å¼‚æ­¥ç¼–ç¨‹æ¡†æ¶</strong>ï¼Œæ”¯æŒæ˜¾å¼åœ°å®Œæˆè®¡ç®—ã€é“¾å¼ç»„åˆå¤šä¸ªå¼‚æ­¥ä»»åŠ¡ã€å¤„ç†ç»“æœå’Œå¼‚å¸¸ï¼Œæ˜¯å®ç°å“åº”å¼ã€éé˜»å¡ç¼–ç¨‹çš„å…³é”®ç»„ä»¶ã€‚</p><p><strong>ä¸€ã€æ ¸å¿ƒåŸç†</strong></p><ol><li><strong>å¼‚æ­¥æ‰§è¡Œä¸ç»“æœå®¹å™¨ï¼š</strong><ul><li>å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª<strong>å®¹å™¨</strong>ï¼Œç”¨äºæ‰¿è½½å°†æ¥æŸä¸ªæ—¶åˆ»è®¡ç®—å®Œæˆçš„ç»“æœï¼ˆæˆ–å¼‚å¸¸ï¼‰ã€‚</li><li>è®¡ç®—ä»»åŠ¡é€šå¸¸è¢«æäº¤ç»™ <code>Executor</code>ï¼ˆçº¿ç¨‹æ± ï¼‰åœ¨åå°çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œé¿å…é˜»å¡è°ƒç”¨çº¿ç¨‹ã€‚</li><li>åˆ›å»ºæ—¶ç»“æœæœªçŸ¥ï¼Œè®¡ç®—å®Œæˆåç»“æœè¢«è®¾ç½®ï¼ˆ<code>complete(result)</code> æˆ– <code>completeExceptionally(throwable)</code>ï¼‰ã€‚</li></ul></li><li><strong>æ˜¾å¼å®Œæˆï¼š</strong><ul><li>ä¸ä¼ ç»Ÿ <code>Future</code> åªèƒ½è¢«åŠ¨ç­‰å¾…ä¸åŒï¼Œ<code>CompletableFuture</code> å¯ä»¥è¢«<strong>ä¸»åŠ¨å®Œæˆ</strong>ã€‚</li><li>ä»»ä½•æ‹¥æœ‰è¯¥å¯¹è±¡å¼•ç”¨çš„çº¿ç¨‹éƒ½å¯ä»¥è°ƒç”¨ <code>complete()</code> æˆ– <code>completeExceptionally()</code> æ‰‹åŠ¨è®¾ç½®ç»“æœæˆ–å¼‚å¸¸ã€‚è¿™æ˜¯å®ç°è¶…æ—¶æ§åˆ¶ã€å¤–éƒ¨äº‹ä»¶è§¦å‘å®Œæˆç­‰åœºæ™¯çš„åŸºç¡€ã€‚</li></ul></li><li><strong>é“¾å¼ç»„åˆä¸å›è°ƒ (CompletionStage)ï¼š</strong><ul><li><code>CompletableFuture</code> å®ç°äº† <code>CompletionStage</code> æ¥å£ï¼Œè¿™æ˜¯å…¶å¼ºå¤§èƒ½åŠ›çš„æ ¸å¿ƒã€‚</li><li><code>CompletionStage</code> å®šä¹‰äº†ä¸°å¯Œçš„é“¾å¼æ–¹æ³•ï¼ˆ<code>thenApply</code>, <code>thenAccept</code>, <code>thenRun</code>, <code>thenCompose</code>, <code>thenCombine</code>, <code>handle</code>, <code>whenComplete</code>, <code>exceptionally</code> ç­‰ï¼‰ã€‚</li><li>è¿™äº›æ–¹æ³•å…è®¸ä½ <strong>å£°æ˜å¼åœ°</strong>æè¿°ï¼šâ€œ<strong>å½“å½“å‰é˜¶æ®µå®Œæˆæ—¶ï¼Œæ¥ä¸‹æ¥åº”è¯¥åšä»€ä¹ˆ</strong>â€ã€‚å›è°ƒå‡½æ•°ï¼ˆlambda è¡¨è¾¾å¼æˆ–æ–¹æ³•å¼•ç”¨ï¼‰ä¼šè¢«æŒ‚æ¥åˆ°å½“å‰é˜¶æ®µçš„å®Œæˆäº‹ä»¶ä¸Šã€‚</li><li>æ¯ä¸ªé“¾å¼è°ƒç”¨éƒ½ä¼šè¿”å›ä¸€ä¸ª<strong>æ–°çš„ <code>CompletionStage</code>ï¼ˆé€šå¸¸æ˜¯å¦ä¸€ä¸ª <code>CompletableFuture</code>ï¼‰</strong>ï¼Œä»£è¡¨ä¸‹ä¸€ä¸ªå¼‚æ­¥æ­¥éª¤ã€‚è¿™å½¢æˆäº†<strong>å¼‚æ­¥ä»»åŠ¡æµæ°´çº¿</strong>ã€‚</li></ul></li><li><strong>ä¾èµ–å…³ç³»ä¸å†…éƒ¨çŠ¶æ€æœºï¼š</strong><ul><li>å½“å¤šä¸ª <code>CompletableFuture</code> é€šè¿‡ <code>thenXxx</code> æ–¹æ³•é“¾æ¥èµ·æ¥æ—¶ï¼Œåç»­é˜¶æ®µä¾èµ–äºå‰é©±é˜¶æ®µçš„å®Œæˆã€‚</li><li><code>CompletableFuture</code> å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª<strong>çŠ¶æ€æœº</strong>ï¼ˆå¦‚ <code>NEW</code>, <code>COMPLETING</code>, <code>NORMAL</code>, <code>EXCEPTIONAL</code>, <code>CANCELLED</code>ï¼‰å’Œä¸€ä¸ª<strong>ä¾èµ–æ ˆ</strong>ï¼ˆæŒ‡å‘æ‰€æœ‰ä¾èµ–äºå®ƒå®Œæˆçš„åç»­é˜¶æ®µï¼‰ã€‚</li><li>å½“ä¸€ä¸ªé˜¶æ®µå®Œæˆæ—¶ï¼Œå®ƒä¼šéå†å…¶ä¾èµ–æ ˆï¼Œ<strong>å°è¯•è§¦å‘æ‰€æœ‰åç»­é˜¶æ®µ</strong>çš„æ‰§è¡Œï¼ˆå¯èƒ½ç«‹å³æ‰§è¡Œï¼Œä¹Ÿå¯èƒ½æäº¤åˆ°çº¿ç¨‹æ± ï¼‰ã€‚</li></ul></li><li><strong>éé˜»å¡ä¸äº‹ä»¶é©±åŠ¨ï¼š</strong><ul><li>æ•´ä¸ªæµç¨‹æ˜¯<strong>éé˜»å¡</strong>çš„ã€‚è°ƒç”¨ <code>thenXxx</code> åªæ˜¯æ³¨å†Œå›è°ƒï¼Œå¹¶ä¸ç­‰å¾…å‰é©±å®Œæˆã€‚ä¸»çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚</li><li>æ‰§è¡Œç”±<strong>å®Œæˆäº‹ä»¶é©±åŠ¨</strong>ï¼šå‰é©±å®Œæˆ -&gt; è§¦å‘å›è°ƒ -&gt; æ‰§è¡Œå›è°ƒé€»è¾‘ -&gt; å®Œæˆåç»§ -&gt; è§¦å‘åç»§çš„å›è°ƒâ€¦ã€‚</li></ul></li><li><strong>ç»„åˆå¤šä¸ª Futureï¼š</strong><ul><li>æä¾› <code>allOf()</code>, <code>anyOf()</code> ç­‰é™æ€æ–¹æ³•ï¼Œç”¨äºç»„åˆå¤šä¸ªç‹¬ç«‹çš„ <code>CompletableFuture</code>ï¼š<ul><li><code>allOf(futures...)</code>: åˆ›å»ºä¸€ä¸ªæ–°çš„ Futureï¼Œå½“<strong>æ‰€æœ‰</strong>è¾“å…¥ Future å®Œæˆæ—¶ï¼ˆæ— è®ºæˆåŠŸå¤±è´¥ï¼‰ï¼Œå®ƒæ‰å®Œæˆï¼ˆæœ¬èº«æ— ç»“æœï¼Œéœ€æ‰‹åŠ¨è·å–å„Futureç»“æœï¼‰ã€‚</li><li><code>anyOf(futures...)</code>: åˆ›å»ºä¸€ä¸ªæ–°çš„ Futureï¼Œå½“<strong>ä»»æ„ä¸€ä¸ª</strong>è¾“å…¥ Future å®Œæˆæ—¶ï¼ˆæ— è®ºæˆåŠŸå¤±è´¥ï¼‰ï¼Œå®ƒå°±å®Œæˆï¼ˆç»“æœæ˜¯æœ€å…ˆå®Œæˆçš„é‚£ä¸ªFutureçš„ç»“æœï¼‰ã€‚</li></ul></li></ul></li><li><strong>çº¿ç¨‹æ± æ§åˆ¶ï¼š</strong><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œé“¾å¼è°ƒç”¨ä¸­åç»­ä»»åŠ¡çš„æ‰§è¡Œçº¿ç¨‹ç”±å‰é©±ä»»åŠ¡çš„å®Œæˆçº¿ç¨‹æ‰§è¡Œï¼ˆé€šå¸¸æ˜¯æ‰§è¡Œå‰é©±ä»»åŠ¡çš„çº¿ç¨‹æˆ–è°ƒç”¨ <code>complete</code> çš„çº¿ç¨‹ï¼‰ã€‚</li><li>å¯ä»¥ä½¿ç”¨å¸¦æœ‰ <code>Executor</code> å‚æ•°çš„å˜ä½“æ–¹æ³•ï¼ˆå¦‚ <code>thenApplyAsync(func, executor)</code>ï¼‰<strong>æ˜¾å¼æŒ‡å®š</strong>åç»­ä»»åŠ¡åœ¨ç‰¹å®šçš„çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œé¿å…çº¿ç¨‹é¥¥é¥¿æˆ–æ§åˆ¶èµ„æºã€‚</li></ul></li></ol><p><strong>äºŒã€ä¸»è¦åº”ç”¨åœºæ™¯</strong></p><ol><li><p><strong>å¼‚æ­¥ä»»åŠ¡ç¼–æ’ä¸æµæ°´çº¿ï¼š</strong> å°†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘æ‹†åˆ†æˆå¤šä¸ªå¼‚æ­¥æ­¥éª¤ï¼ŒæŒ‰é¡ºåºæˆ–æ¡ä»¶é“¾å¼æ‰§è¡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture.supplyAsync(() -&gt; fetchUserData(userId), ioPool) <span class="comment">// æ­¥éª¤1ï¼šIOæ“ä½œ</span></span><br><span class="line">    .thenApply(userData -&gt; processData(userData))              <span class="comment">// æ­¥éª¤2ï¼šCPUå¯†é›†å‹å¤„ç†ï¼ˆé»˜è®¤åŒçº¿ç¨‹æˆ–ForkJoinPoolï¼‰</span></span><br><span class="line">    .thenApplyAsync(processedData -&gt; saveToDB(processedData), dbPool) <span class="comment">// æ­¥éª¤3ï¼šå¦ä¸€ä¸ªIOæ“ä½œï¼ŒæŒ‡å®šDBçº¿ç¨‹æ± </span></span><br><span class="line">    .thenAccept(savedResult -&gt; sendNotification(savedResult))  <span class="comment">// æ­¥éª¤4ï¼šæœ€ç»ˆå¤„ç†</span></span><br><span class="line">    .exceptionally(ex -&gt; &#123;                                     <span class="comment">// ç»Ÿä¸€å¼‚å¸¸å¤„ç†</span></span><br><span class="line">        log.error(<span class="string">&quot;Pipeline failed&quot;</span>, ex);</span><br><span class="line">        <span class="keyword">return</span> handleFailure(ex);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></li><li><p><strong>å¹¶è¡Œæ‰§è¡Œä¸ç»“æœèšåˆï¼š</strong> åŒæ—¶å‘èµ·å¤šä¸ªç‹¬ç«‹ä»»åŠ¡ï¼Œç­‰æ‰€æœ‰&#x2F;ä»»æ„ä¸€ä¸ªå®Œæˆåå†å¤„ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;ResultA&gt; futureA = CompletableFuture.supplyAsync(() -&gt; serviceA.call());</span><br><span class="line">CompletableFuture&lt;ResultB&gt; futureB = CompletableFuture.supplyAsync(() -&gt; serviceB.call());</span><br><span class="line">CompletableFuture&lt;ResultC&gt; futureC = CompletableFuture.supplyAsync(() -&gt; serviceC.call());</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰æ‰€æœ‰ä»»åŠ¡å®Œæˆ</span></span><br><span class="line">CompletableFuture&lt;Void&gt; allFutures = CompletableFuture.allOf(futureA, futureB, futureC);</span><br><span class="line">allFutures.thenRun(() -&gt; &#123;</span><br><span class="line">    <span class="comment">// æ‰‹åŠ¨è·å–å„ä¸ªç»“æœï¼ˆæ­¤æ—¶è‚¯å®šå·²å®Œæˆï¼‰</span></span><br><span class="line">    <span class="type">ResultA</span> <span class="variable">a</span> <span class="operator">=</span> futureA.join(); <span class="comment">// æˆ– get() (éœ€å¤„ç†å¼‚å¸¸)</span></span><br><span class="line">    <span class="type">ResultB</span> <span class="variable">b</span> <span class="operator">=</span> futureB.join();</span><br><span class="line">    <span class="type">ResultC</span> <span class="variable">c</span> <span class="operator">=</span> futureC.join();</span><br><span class="line">    aggregateResults(a, b, c);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰ä»»æ„ä¸€ä¸ªä»»åŠ¡å®Œæˆ</span></span><br><span class="line">CompletableFuture&lt;Object&gt; anyFuture = CompletableFuture.anyOf(futureA, futureB, futureC);</span><br><span class="line">anyFuture.thenAccept(result -&gt; handleFirstResult(result));</span><br></pre></td></tr></table></figure></li><li><p><strong>ç»“æœè½¬æ¢ä¸å¤„ç†ï¼š</strong> ä½¿ç”¨ <code>thenApply</code> å°†ä¸Šä¸€æ­¥çš„ç»“æœè½¬æ¢æˆå¦ä¸€ç§å½¢å¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; <span class="string">&quot;123&quot;</span>);</span><br><span class="line">CompletableFuture&lt;Integer&gt; intFuture = future.thenApply(Integer::parseInt);</span><br></pre></td></tr></table></figure></li><li><p><strong>å‰¯ä½œç”¨æ“ä½œï¼š</strong> ä½¿ç”¨ <code>thenAccept</code> æ¶ˆè´¹ç»“æœä½†ä¸äº§ç”Ÿæ–°ç»“æœï¼ˆå¦‚æ—¥å¿—ã€å‘é€æ¶ˆæ¯ï¼‰ï¼Œæˆ–ä½¿ç”¨ <code>thenRun</code> æ‰§è¡Œä¸ä¾èµ–ç»“æœçš„åŠ¨ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">future.thenAccept(result -&gt; System.out.println(<span class="string">&quot;Result: &quot;</span> + result));</span><br><span class="line">future.thenRun(() -&gt; cleanupResources());</span><br></pre></td></tr></table></figure></li><li><p><strong>ç»„åˆå¼‚æ­¥ä»»åŠ¡ï¼š</strong></p><ul><li><code>thenCompose(Function&lt;T, CompletionStage&lt;U&gt;&gt;)</code>: <strong>æ‰å¹³åŒ–</strong>ç»„åˆã€‚å½“å‰ Future å®Œæˆåï¼Œç”¨å…¶ç»“æœä½œä¸ºè¾“å…¥ï¼Œ<strong>å¯åŠ¨å¹¶è¿”å›å¦ä¸€ä¸ª Future</strong> (é¿å…åµŒå¥— <code>CompletableFuture&lt;CompletableFuture&lt;U&gt;&gt;</code>)ã€‚</li><li><code>thenCombine(CompletionStage&lt;U&gt;, BiFunction&lt;T, U, V&gt;)</code>: ç­‰å¾…<strong>å½“å‰ Future å’Œå¦ä¸€ä¸ª Future</strong> éƒ½å®Œæˆï¼Œç„¶åç”¨ä¸¤è€…çš„ç»“æœæ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›æ–°çš„ Futureã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// thenCompose ç¤ºä¾‹ (è·å–ç”¨æˆ·åè·å–è®¢å•)</span></span><br><span class="line">CompletableFuture&lt;User&gt; userFuture = getUserAsync(userId);</span><br><span class="line">CompletableFuture&lt;Order&gt; orderFuture = userFuture.thenCompose(user -&gt; getOrdersAsync(user));</span><br><span class="line"></span><br><span class="line"><span class="comment">// thenCombine ç¤ºä¾‹ (å¹¶è¡Œè®¡ç®—ä»·æ ¼å’Œåº“å­˜ï¼Œç„¶åç»„åˆ)</span></span><br><span class="line">CompletableFuture&lt;Price&gt; priceFuture = getPriceAsync(productId);</span><br><span class="line">CompletableFuture&lt;Inventory&gt; inventoryFuture = getInventoryAsync(productId);</span><br><span class="line">CompletableFuture&lt;ProductInfo&gt; productInfoFuture = priceFuture.thenCombine(inventoryFuture,</span><br><span class="line">    (price, inventory) -&gt; <span class="keyword">new</span> <span class="title class_">ProductInfo</span>(price, inventory));</span><br></pre></td></tr></table></figure></li><li><p><strong>å¼‚å¸¸å¤„ç†ï¼š</strong></p><ul><li><code>exceptionally(Function&lt;Throwable, T&gt;)</code>: æ•è·å¼‚å¸¸å¹¶æä¾›ä¸€ä¸ª<strong>æ¢å¤å€¼</strong>ï¼Œè¿”å›ä¸€ä¸ªæ­£å¸¸å®Œæˆçš„ Futureã€‚</li><li><code>handle(BiFunction&lt;T, Throwable, U&gt;)</code>: æ— è®ºæ­£å¸¸å®Œæˆè¿˜æ˜¯å¼‚å¸¸ï¼Œéƒ½ä¼šè¢«è°ƒç”¨ã€‚å¯ä»¥æ£€æŸ¥ç»“æœæˆ–å¼‚å¸¸ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°ç»“æœï¼ˆæˆ–æŠ›å‡ºæ–°å¼‚å¸¸ï¼‰ã€‚</li><li><code>whenComplete(BiConsumer&lt;T, Throwable&gt;)</code>: ç±»ä¼¼ <code>handle</code>ï¼Œä½†å®ƒæ˜¯æ¶ˆè´¹è€…ï¼ˆä¸æ”¹å˜ç»“æœï¼‰ï¼Œç”¨äºè®°å½•æ—¥å¿—ã€æ¸…ç†ç­‰ï¼Œè¿”å›ä¸€ä¸ªç»“æœç±»å‹ç›¸åŒçš„ Futureï¼ˆå¼‚å¸¸ä¼šä¼ æ’­ï¼‰ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">future.exceptionally(ex -&gt; defaultValue) <span class="comment">// å¼‚å¸¸æ—¶æä¾›é»˜è®¤å€¼</span></span><br><span class="line">     .handle((result, ex) -&gt; &#123;</span><br><span class="line">         <span class="keyword">if</span> (ex != <span class="literal">null</span>) &#123; <span class="keyword">return</span> fallback; &#125;</span><br><span class="line">         <span class="keyword">else</span> &#123; <span class="keyword">return</span> transform(result); &#125;</span><br><span class="line">     &#125;)</span><br><span class="line">     .whenComplete((result, ex) -&gt; &#123;</span><br><span class="line">         <span class="keyword">if</span> (ex != <span class="literal">null</span>) log.error(<span class="string">&quot;Oops&quot;</span>, ex);</span><br><span class="line">         <span class="keyword">else</span> metrics.recordSuccess();</span><br><span class="line">     &#125;);</span><br></pre></td></tr></table></figure></li><li><p><strong>è¶…æ—¶æ§åˆ¶ (Java 9+):</strong> ä½¿ç”¨ <code>orTimeout(timeout, timeUnit)</code> æˆ– <code>completeOnTimeout(value, timeout, timeUnit)</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture&lt;String&gt; future = someLongRunningTask()</span><br><span class="line">    .orTimeout(<span class="number">5</span>, TimeUnit.SECONDS) <span class="comment">// è¶…æ—¶æŠ›å‡º TimeoutException</span></span><br><span class="line">    .exceptionally(ex -&gt; (ex <span class="keyword">instanceof</span> TimeoutException) ? <span class="string">&quot;Timed out&quot;</span> : <span class="string">&quot;Other error&quot;</span>);</span><br><span class="line"></span><br><span class="line">CompletableFuture&lt;String&gt; future = someLongRunningTask()</span><br><span class="line">    .completeOnTimeout(<span class="string">&quot;Fallback Value&quot;</span>, <span class="number">5</span>, TimeUnit.SECONDS); <span class="comment">// è¶…æ—¶æä¾›é»˜è®¤å€¼</span></span><br></pre></td></tr></table></figure></li></ol><p><strong>ä¸‰ã€å…³é”®ä¼˜åŠ¿</strong></p><ol><li><strong>éé˜»å¡å¼‚æ­¥ï¼š</strong> æé«˜ç³»ç»Ÿååé‡å’Œå“åº”æ€§ã€‚</li><li><strong>å£°æ˜å¼ &amp; é“¾å¼ç¼–ç¨‹ï¼š</strong> ä»£ç æ›´ç®€æ´ã€æ˜“è¯»ã€æ˜“ç»´æŠ¤ï¼Œæ¥è¿‘åŒæ­¥ä»£ç çš„é£æ ¼ï¼ˆé¿å…å›è°ƒåœ°ç‹±ï¼‰ã€‚</li><li><strong>å¼ºå¤§çš„ç»„åˆèƒ½åŠ›ï¼š</strong> è½»æ¾ç¼–æ’å¤æ‚å¼‚æ­¥å·¥ä½œæµï¼ˆé¡ºåºã€å¹¶è¡Œã€èšåˆã€æ¡ä»¶ï¼‰ã€‚</li><li><strong>çµæ´»çš„å¼‚å¸¸å¤„ç†ï¼š</strong> æä¾›å¤šç§æ–¹å¼å¤„ç†å¼‚æ­¥ç®¡é“ä¸­çš„é”™è¯¯ã€‚</li><li><strong>æ˜¾å¼å®Œæˆæ§åˆ¶ï¼š</strong> æ”¯æŒæ‰‹åŠ¨è®¾ç½®ç»“æœï¼Œé€‚åº”æ›´å¤šåœºæ™¯ï¼ˆå¦‚è¶…æ—¶ã€å¤–éƒ¨äº‹ä»¶ï¼‰ã€‚</li><li><strong>çº¿ç¨‹æ± é›†æˆï¼š</strong> å¯ç²¾ç»†æ§åˆ¶ä»»åŠ¡æ‰§è¡Œä½ç½®ã€‚</li></ol><p><strong>å››ã€æ³¨æ„äº‹é¡¹ä¸æœ€ä½³å®è·µ</strong></p><ol><li><strong>é¿å…é˜»å¡ï¼š</strong> ä¸è¦åœ¨ <code>CompletableFuture</code> çš„å›è°ƒæ–¹æ³•ï¼ˆå¦‚ <code>thenApply</code>, <code>thenAccept</code> å†…éƒ¨ï¼‰æ‰§è¡Œé•¿æ—¶é—´é˜»å¡æ“ä½œï¼Œè¿™ä¼šå¡ä½æ‰§è¡Œçº¿ç¨‹ï¼ˆå¯èƒ½æ˜¯å…¬å…±çš„ ForkJoinPool çº¿ç¨‹ï¼‰ã€‚ä½¿ç”¨ <code>thenApplyAsync</code> ç­‰å¸¦ <code>Executor</code> çš„æ–¹æ³•å°†é˜»å¡æ“ä½œæäº¤åˆ°ä¸“ç”¨çº¿ç¨‹æ± ã€‚</li><li><strong>çº¿ç¨‹æ± é€‰æ‹©ï¼š</strong><ul><li>CPU å¯†é›†å‹ä»»åŠ¡ï¼šè€ƒè™‘ä½¿ç”¨ <code>ForkJoinPool.commonPool()</code> (é»˜è®¤) æˆ–å›ºå®šå¤§å°çº¿ç¨‹æ± ï¼ˆçº¿ç¨‹æ•° â‰ˆ CPU æ ¸å¿ƒæ•°ï¼‰ã€‚</li><li>IO å¯†é›†å‹ä»»åŠ¡ï¼š<strong>åŠ¡å¿…ä½¿ç”¨</strong> è¶³å¤Ÿå¤§çš„ç¼“å­˜çº¿ç¨‹æ± ï¼ˆå¦‚ <code>Executors.newCachedThreadPool()</code>ï¼‰æˆ–ä¸“é—¨é…ç½®çš„çº¿ç¨‹æ± ï¼Œé¿å…çº¿ç¨‹é¥¥é¥¿ã€‚<strong>å¼ºçƒˆæ¨èä¸ºä¸åŒèµ„æºï¼ˆå¦‚DBã€HTTPï¼‰ä½¿ç”¨ç‹¬ç«‹çº¿ç¨‹æ± ã€‚</strong></li></ul></li><li><strong>å¼‚å¸¸ä¼ æ’­ï¼š</strong> ç†è§£å¼‚å¸¸åœ¨é“¾å¼è°ƒç”¨ä¸­çš„ä¼ æ’­æœºåˆ¶ã€‚å¦‚æœæŸä¸ªé˜¶æ®µæŠ›å‡ºå¼‚å¸¸ä¸”æœªè¢«æ•è·ï¼ˆå¦‚ <code>exceptionally</code>ï¼‰ï¼Œåç»­ä¾èµ–å®ƒçš„ <code>thenApply</code>&#x2F;<code>thenAccept</code> ç­‰<strong>ä¸ä¼šè¢«æ‰§è¡Œ</strong>ï¼Œå¼‚å¸¸ä¼šä¼ é€’åˆ°é“¾çš„æœ«ç«¯æˆ–ç­‰å¾… <code>get()</code>&#x2F;<code>join()</code> æ—¶æŠ›å‡ºã€‚ä½¿ç”¨ <code>handle</code>&#x2F;<code>whenComplete</code>&#x2F;<code>exceptionally</code> å¦¥å–„å¤„ç†ã€‚</li><li><strong>ç»“æœè·å–ï¼š</strong><ul><li><code>get()</code>: é˜»å¡ç­‰å¾…ç»“æœï¼Œéœ€å¤„ç† <code>InterruptedException</code> å’Œ <code>ExecutionException</code>ï¼ˆå°è£…äº†åŸå§‹å¼‚å¸¸ï¼‰ã€‚</li><li><code>join()</code>: ç±»ä¼¼ <code>get()</code>ï¼Œä½†æŠ›å‡ºæœªç»æ£€æŸ¥çš„ <code>CompletionException</code>ï¼ˆå…¶ <code>getCause()</code> æ˜¯åŸå§‹å¼‚å¸¸ï¼‰ã€‚é€šå¸¸åœ¨é“¾çš„æœ«ç«¯æˆ–æ˜ç¡®çŸ¥é“ä¼šå¾ˆå¿«å®Œæˆæ—¶ä½¿ç”¨ã€‚</li><li><strong>å°½é‡ä½¿ç”¨å›è°ƒ</strong>ï¼ˆ<code>thenAccept</code>, <code>thenApply</code>, <code>whenComplete</code>ï¼‰è€Œéé˜»å¡è·å–ï¼Œä»¥ä¿æŒéé˜»å¡æ€§ã€‚</li></ul></li><li><strong>èµ„æºæ¸…ç†ï¼š</strong> ä½¿ç”¨ <code>whenComplete</code> æˆ– <code>handle</code> ç¡®ä¿èµ„æºï¼ˆå¦‚æ–‡ä»¶å¥æŸ„ã€ç½‘ç»œè¿æ¥ï¼‰åœ¨ä»»åŠ¡å®Œæˆï¼ˆæ— è®ºæˆåŠŸå¤±è´¥ï¼‰åè¢«æ­£ç¡®å…³é—­ã€‚</li><li><strong>é¿å…è¿‡åº¦åµŒå¥—ï¼š</strong> è™½ç„¶é“¾å¼è°ƒç”¨é¿å…å›è°ƒåœ°ç‹±ï¼Œä½†æ·±åº¦åµŒå¥—ä»å¯èƒ½é™ä½å¯è¯»æ€§ã€‚è€ƒè™‘å°†å¤æ‚æ­¥éª¤æŠ½å–æˆç‹¬ç«‹æ–¹æ³•ã€‚</li><li><strong>å–æ¶ˆä¼ æ’­ï¼š</strong> <code>CompletableFuture.cancel(true)</code> ä¼šå°è¯•ä¸­æ–­å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä½†<strong>ä¸ä¼šè‡ªåŠ¨å–æ¶ˆå®ƒä¾èµ–çš„æˆ–ä¾èµ–å®ƒçš„å…¶ä»– Future</strong>ã€‚éœ€è¦æ‰‹åŠ¨è®¾è®¡å–æ¶ˆé€»è¾‘ã€‚</li></ol><p><strong>æ€»ç»“</strong></p><p><code>CompletableFuture</code> æ˜¯ Java ç°ä»£å¼‚æ­¥ç¼–ç¨‹çš„åŸºçŸ³ã€‚å®ƒé€šè¿‡<strong>é“¾å¼ç»„åˆ</strong>ã€<strong>éé˜»å¡å›è°ƒ</strong>å’Œ<strong>æ˜¾å¼å®Œæˆ</strong>æœºåˆ¶ï¼Œæä¾›äº†å¼ºå¤§è€Œä¼˜é›…çš„æ–¹å¼æ¥æ„å»ºå¤æ‚ã€é«˜æ•ˆçš„å¼‚æ­¥åº”ç”¨ç¨‹åºã€‚æ·±å…¥ç†è§£å…¶åŸç†ï¼ˆçŠ¶æ€æœºã€ä¾èµ–ç®¡ç†ï¼‰å’Œç†Ÿç»ƒæŒæ¡å…¶ APIï¼ˆ<code>supplyAsync</code>, <code>thenXxx</code>, <code>handle</code>, <code>allOf</code>, <code>anyOf</code>, <code>thenCompose</code>, <code>thenCombine</code>, å¼‚å¸¸å¤„ç†ï¼‰æ˜¯ç¼–å†™é«˜æ€§èƒ½ã€é«˜å“åº”æ€§ Java æœåŠ¡çš„å…³é”®ã€‚åˆç†ä½¿ç”¨çº¿ç¨‹æ± å’Œéµå¾ªæœ€ä½³å®è·µï¼ˆé¿å…é˜»å¡å›è°ƒã€å¦¥å–„å¤„ç†å¼‚å¸¸ã€ç®¡ç†èµ„æºï¼‰è‡³å…³é‡è¦ã€‚</p><h3 id="CompletableFuture-å’Œä¼ ç»Ÿçš„-Future-æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#CompletableFuture-å’Œä¼ ç»Ÿçš„-Future-æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="CompletableFuture å’Œä¼ ç»Ÿçš„ Future æœ‰ä»€ä¹ˆåŒºåˆ«"></a><strong><code>CompletableFuture</code> å’Œä¼ ç»Ÿçš„ <code>Future</code> æœ‰ä»€ä¹ˆåŒºåˆ«</strong></h3><ul><li>è€ƒå¯Ÿç‚¹ï¼šç†è§£å…¶æ ¸å¿ƒä¼˜åŠ¿ï¼ˆé“¾å¼ç¼–ç¨‹ã€ç»„åˆèƒ½åŠ›ã€æ‰‹åŠ¨å®Œæˆã€å¼‚å¸¸å¤„ç†ï¼‰ã€‚</li><li>æœŸæœ›å›ç­”ï¼š<code>Future</code> ä»…æ”¯æŒé˜»å¡è·å–ç»“æœæˆ–è½®è¯¢ï¼Œæ— æ³•ç»„åˆï¼›<code>CompletableFuture</code> å®ç°äº† <code>CompletionStage</code>ï¼Œæ”¯æŒéé˜»å¡å›è°ƒã€ä»»åŠ¡é“¾å¼ç»„åˆã€æ‰‹åŠ¨è®¾ç½®ç»“æœ&#x2F;å¼‚å¸¸ã€æ›´å¼ºå¤§çš„å¼‚å¸¸å¤„ç†ã€‚</li></ul><h2 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h2><h3 id="ç±»åŠ è½½"><a href="#ç±»åŠ è½½" class="headerlink" title="ç±»åŠ è½½"></a>ç±»åŠ è½½</h3><p>ç±»åŠ è½½çš„è¿‡ç¨‹åŒ…æ‹¬äº†<strong>åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–</strong>äº”ä¸ªé˜¶æ®µã€‚</p><h4 id="å“ªäº›åœºæ™¯ä¼šè§¦å‘ç±»çš„åŠ è½½"><a href="#å“ªäº›åœºæ™¯ä¼šè§¦å‘ç±»çš„åŠ è½½" class="headerlink" title="å“ªäº›åœºæ™¯ä¼šè§¦å‘ç±»çš„åŠ è½½"></a>å“ªäº›åœºæ™¯ä¼šè§¦å‘ç±»çš„åŠ è½½</h4><ul><li>ç±»çš„å®ä¾‹åŒ–</li><li>è®¿é—®ç±»çš„é™æ€æˆå‘˜</li><li>è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•</li><li><code>Class.forName()</code>ã€<code>ClassLoader.loadClass()</code>ç­‰åå°„æ–¹æ³•</li><li>åŠ è½½å­ç±»æ—¶ä¼šåŠ è½½çˆ¶ç±»</li></ul><h4 id="Class-forName-å’ŒClassLoader-loadClass-æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#Class-forName-å’ŒClassLoader-loadClass-æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="Class.forName()å’ŒClassLoader.loadClass()æœ‰ä»€ä¹ˆåŒºåˆ«"></a><code>Class.forName()</code>å’Œ<code>ClassLoader.loadClass()</code>æœ‰ä»€ä¹ˆåŒºåˆ«</h4><ul><li><code>Class.forName()</code>: å°†ç±»çš„.classæ–‡ä»¶åŠ è½½åˆ°jvmä¸­ä¹‹å¤–ï¼Œè¿˜ä¼šå¯¹ç±»è¿›è¡Œè§£é‡Šï¼Œæ‰§è¡Œç±»ä¸­çš„staticå—ï¼›</li><li><code>ClassLoader.loadClass()</code>: åªå¹²ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯å°†.classæ–‡ä»¶åŠ è½½åˆ°jvmä¸­ï¼Œä¸ä¼šæ‰§è¡Œstaticä¸­çš„å†…å®¹,åªæœ‰åœ¨newInstanceæ‰ä¼šå»æ‰§è¡Œstaticå—ã€‚</li><li><code>Class.forName(name, initialize, loader)</code>å¸¦å‚å‡½æ•°ä¹Ÿå¯æ§åˆ¶æ˜¯å¦åŠ è½½staticå—ã€‚å¹¶ä¸”åªæœ‰è°ƒç”¨äº†newInstance()æ–¹æ³•é‡‡ç”¨è°ƒç”¨æ„é€ å‡½æ•°ï¼Œåˆ›å»ºç±»çš„å¯¹è±¡ ã€‚</li></ul><h4 id="ç±»åŠ è½½å™¨çš„å±‚æ¬¡ç»“æ„"><a href="#ç±»åŠ è½½å™¨çš„å±‚æ¬¡ç»“æ„" class="headerlink" title="ç±»åŠ è½½å™¨çš„å±‚æ¬¡ç»“æ„"></a>ç±»åŠ è½½å™¨çš„å±‚æ¬¡ç»“æ„</h4><p>ç±»åŠ è½½å™¨å±‚çº§ç»“æ„ï¼š</p><table><thead><tr><th><strong>ç±»åŠ è½½å™¨</strong></th><th><strong>åŠ è½½è·¯å¾„</strong></th><th><strong>çˆ¶åŠ è½½å™¨</strong></th></tr></thead><tbody><tr><td><strong>Bootstrap ClassLoader</strong></td><td><code>JRE/lib/rt.jar</code>ç­‰æ ¸å¿ƒåº“</td><td>æ— ï¼ˆé¡¶çº§åŠ è½½å™¨ï¼‰</td></tr><tr><td><strong>Extension ClassLoader</strong></td><td><code>JRE/lib/ext</code>ç›®å½•ä¸‹æ‰©å±•åº“</td><td>Bootstrap</td></tr><tr><td><strong>Application ClassLoader</strong></td><td>åº”ç”¨ç±»è·¯å¾„ï¼ˆClassPathï¼‰</td><td>Extension</td></tr><tr><td><strong>è‡ªå®šä¹‰ClassLoader</strong></td><td>ç”¨æˆ·è‡ªå®šä¹‰è·¯å¾„</td><td>Application</td></tr></tbody></table><h4 id="ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹"><a href="#ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹" class="headerlink" title="ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹"></a>ä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹</h4><p>åŒäº²å§”æ´¾æ¨¡å‹ï¼ˆParent Delegation Modelï¼‰æ˜¯Javaç±»åŠ è½½æœºåˆ¶ä¸­çš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œç”¨äºæ§åˆ¶ç±»çš„åŠ è½½é¡ºåºå’Œé¿å…ç±»çš„é‡å¤åŠ è½½ã€‚åœ¨åŒäº²å§”æ´¾æ¨¡å‹ä¸­ï¼Œç±»åŠ è½½å™¨ä¼šæŒ‰ç…§ä¸€å®šçš„é¡ºåºè¿›è¡Œç±»çš„åŠ è½½ï¼Œå¹¶å°†åŠ è½½è¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ï¼Œåªæœ‰åœ¨çˆ¶ç±»åŠ è½½å™¨æ‰¾ä¸åˆ°ç±»çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šç”±å­ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ã€‚</p><p><strong>åŒäº²å§”æ´¾æ¨¡å‹çš„ä¼˜ç‚¹</strong></p><ol><li>é¿å…ç±»çš„é‡å¤åŠ è½½ï¼šç”±äºç±»åŠ è½½å™¨ä¼šå…ˆå§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œæ‰€ä»¥å¯ä»¥é¿å…åŒä¸€ä¸ªç±»è¢«å¤šä¸ªç±»åŠ è½½å™¨é‡å¤åŠ è½½ï¼Œä»è€ŒèŠ‚çœå†…å­˜å’Œæé«˜æ€§èƒ½ã€‚</li><li>å®‰å…¨æ€§ï¼šæ ¸å¿ƒç±»åº“é€šå¸¸ç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œè€Œè‡ªå®šä¹‰ç±»é€šå¸¸ç”±åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨åŠ è½½ï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ ¸å¿ƒç±»åº“çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢è¢«æ¶æ„ä»£ç æ›¿ä»£ã€‚</li><li>æ¨¡å—åŒ–ï¼šé€šè¿‡ä½¿ç”¨ä¸åŒçš„ç±»åŠ è½½å™¨ï¼Œå¯ä»¥å®ç°ç±»çš„æ¨¡å—åŒ–å’Œéš”ç¦»ï¼Œä»è€Œåœ¨å¤æ‚çš„åº”ç”¨ç¨‹åºä¸­å®ç°ç±»çš„å…±äº«å’Œå¤ç”¨ã€‚</li></ol><p><strong>åŒäº²å§”æ´¾æ¨¡å‹çš„ç¼ºç‚¹</strong></p><ol><li>çµæ´»æ€§å—é™ï¼šåŒäº²å§”æ´¾æ¨¡å‹é™åˆ¶äº†ç±»åŠ è½½å™¨çš„çµæ´»æ€§ï¼Œå¯èƒ½å¯¼è‡´åœ¨æŸäº›ç‰¹å®šçš„åœºæ™¯ä¸­æ— æ³•å®ç°è‡ªå®šä¹‰çš„ç±»åŠ è½½è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œåœ¨æŸäº›éœ€è¦åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆç±»æˆ–åŠ è½½éæ ‡å‡†æ ¼å¼çš„ç±»æ–‡ä»¶çš„åœºæ™¯ä¸­ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹å¯èƒ½ä¼šå—é™ã€‚</li><li>ä¸é€‚åˆæŸäº›ç±»åŠ è½½åœºæ™¯ï¼šåœ¨æŸäº›åœºæ™¯ä¸­ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹å¯èƒ½å¹¶ä¸é€‚åˆï¼Œä¾‹å¦‚åœ¨OSGiï¼ˆOpen Service Gateway Initiativeï¼‰ç­‰åŠ¨æ€æ¨¡å—åŒ–ç³»ç»Ÿä¸­ï¼Œéœ€è¦å®ç°æ›´ä¸ºå¤æ‚çš„ç±»åŠ è½½ç­–ç•¥ï¼Œè€ŒåŒäº²å§”æ´¾æ¨¡å‹å¯èƒ½ä¸è¶³ä»¥æ»¡è¶³éœ€æ±‚ã€‚</li><li>ç±»å†²çªï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”±äºåŒäº²å§”æ´¾æ¨¡å‹çš„å­˜åœ¨ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç±»çš„å†²çªé—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­å­˜åœ¨å¤šä¸ªç‰ˆæœ¬çš„åŒä¸€ä¸ªç±»ï¼Œå¹¶ä¸”ä½¿ç”¨äº†ä¸åŒçš„ç±»åŠ è½½å™¨åŠ è½½ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç±»åŠ è½½å†²çªï¼Œä»è€Œå¯¼è‡´ç¨‹åºå‡ºç°é”™è¯¯æˆ–å¼‚å¸¸ã€‚</li><li>æ€§èƒ½å¼€é”€ï¼šç”±äºæ¯æ¬¡ç±»åŠ è½½éƒ½ä¼šå§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ï¼Œè¿™å¯èƒ½å¯¼è‡´å¤šå±‚çº§çš„ç±»åŠ è½½é“¾ï¼Œä»è€Œå¢åŠ äº†ç±»åŠ è½½çš„æ—¶é—´å’Œæ€§èƒ½å¼€é”€ã€‚ç‰¹åˆ«æ˜¯åœ¨æŸäº›å¤§å‹å¤æ‚çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°ç±»åŠ è½½æ€§èƒ½ç“¶é¢ˆã€‚</li></ol><p><strong>å¦‚ä½•æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹</strong></p><p>åœ¨Javaä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥æ‰“ç ´åŒäº²å§”æ´¾æ¨¡å‹ï¼Œå®ç°è‡ªå®šä¹‰çš„ç±»åŠ è½½è¡Œä¸ºï¼š</p><ol><li>è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼šå¯ä»¥ç»§æ‰¿java.lang.ClassLoaderç±»ï¼Œå¹¶å®ç°è‡ªå®šä¹‰çš„ç±»åŠ è½½é€»è¾‘ï¼Œä»è€Œç»•è¿‡åŒäº²å§”æ´¾æ¨¡å‹ã€‚<strong>é€šè¿‡é‡å†™ClassLoaderçš„loadClass()æ–¹æ³•ï¼Œå¯ä»¥åœ¨ç±»åŠ è½½è¿‡ç¨‹ä¸­è‡ªå®šä¹‰åŠ è½½è§„åˆ™</strong>ï¼Œä¾‹å¦‚å…ˆå°è¯•è‡ªå®šä¹‰åŠ è½½ï¼Œå¦‚æœå¤±è´¥å†å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ã€‚</li><li>ä½¿ç”¨Javaçš„æ‰©å±•ç±»åŠ è½½å™¨ï¼š<strong>Javaçš„æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰å¹¶ä¸éµå¾ªåŒäº²å§”æ´¾æ¨¡å‹ï¼Œå®ƒåœ¨åŠ è½½Javaæ‰©å±•åº“æ—¶ä¸ä¼šå§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨</strong>ã€‚å› æ­¤ï¼Œå¯ä»¥å°†è‡ªå®šä¹‰çš„ç±»æ”¾ç½®åœ¨Javaæ‰©å±•åº“ä¸­ï¼Œå¹¶ä½¿ç”¨æ‰©å±•ç±»åŠ è½½å™¨åŠ è½½è¿™äº›ç±»ï¼Œä»è€Œå®ç°å¯¹åŒäº²å§”æ´¾æ¨¡å‹çš„ç»•è¿‡ã€‚</li><li>ä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼šJavaä¸­çš„çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼ˆThread Context ClassLoaderï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»åŠ è½½å™¨ï¼Œå¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€è®¾ç½®ï¼Œä»è€Œåœ¨æŸä¸ªç‰¹å®šçº¿ç¨‹ä¸­ç»•è¿‡åŒäº²å§”æ´¾æ¨¡å‹ã€‚é€šè¿‡è®¾ç½®çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œå¯ä»¥ä½¿ç‰¹å®šçº¿ç¨‹åŠ è½½æŒ‡å®šçš„ç±»ï¼Œè€Œä¸å—åŒäº²å§”æ´¾æ¨¡å‹çš„é™åˆ¶ã€‚</li></ol><h4 id="loadClass-å’Œ-findClass-æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#loadClass-å’Œ-findClass-æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="loadClass å’Œ findClass() æœ‰ä»€ä¹ˆåŒºåˆ«"></a><code>loadClass</code> å’Œ <code>findClass()</code> æœ‰ä»€ä¹ˆåŒºåˆ«</h4><table><thead><tr><th align="left"><strong>ç‰¹æ€§</strong></th><th align="left"><code>loadClass()</code></th><th align="left"><code>findClass()</code></th></tr></thead><tbody><tr><td align="left"><strong>èŒè´£</strong></td><td align="left">æ§åˆ¶åŠ è½½æµç¨‹ï¼ˆå§”æ´¾æœºåˆ¶ï¼‰</td><td align="left">å®ç°å…·ä½“åŠ è½½é€»è¾‘</td></tr><tr><td align="left"><strong>é‡å†™å¿…è¦æ€§</strong></td><td align="left">é€šå¸¸ä¸é‡å†™ï¼ˆä¿æŒå§”æ´¾æ¨¡å‹ï¼‰</td><td align="left">è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶<strong>å¿…é¡»é‡å†™</strong></td></tr><tr><td align="left"><strong>åŒäº²å§”æ´¾è§’è‰²</strong></td><td align="left">å®ç°å§”æ´¾é€»è¾‘</td><td align="left">è¢«å§”æ´¾æœºåˆ¶è°ƒç”¨</td></tr><tr><td align="left"><strong>å…¸å‹ç”¨é€”</strong></td><td align="left">ç±»åŠ è½½å…¥å£ï¼ˆ<code>ClassLoader.loadClass()</code>ï¼‰</td><td align="left">è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ—¶æ‰©å±•èµ„æºè·å–æ–¹å¼</td></tr></tbody></table><p><strong>æœ€ä½³å®è·µ</strong></p><ol><li><p><strong>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</strong>ï¼š<br>åªéœ€é‡å†™ <code>findClass()</code>ï¼ˆä¿æŒåŒäº²å§”æ´¾ï¼‰ï¼Œ<strong>æ— éœ€</strong>é‡å†™ <code>loadClass()</code>ã€‚</p><p>java</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class CustomLoader extends ClassLoader &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected Class&lt;?&gt; findClass(String name) &#123;</span><br><span class="line">        // è‡ªå®šä¹‰åŠ è½½é€»è¾‘</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ç ´ååŒäº²å§”æ´¾</strong>ï¼š<br>éœ€é‡å†™ <code>loadClass()</code>ï¼ˆè°¨æ…ä½¿ç”¨ï¼Œå¦‚ JDBC&#x2F;JNDI ç­‰åœºæ™¯ï¼‰ã€‚</p></li></ol><img src="/post/65a5b0d7/image-20250725203542235.png" class="" title="image-20250725203542235"><p><code>loadClass()</code> æ˜¯æ¡†æ¶æµç¨‹æ§åˆ¶è€…ï¼Œ<code>findClass()</code> æ˜¯å®é™…åŠ è½½é€»è¾‘çš„å®ç°è€…ã€‚è‡ªå®šä¹‰ç±»åŠ è½½ä¼˜å…ˆæ‰©å±• <code>findClass()</code>ã€‚</p><h3 id="å†…å­˜ç»“æ„"><a href="#å†…å­˜ç»“æ„" class="headerlink" title="å†…å­˜ç»“æ„"></a>å†…å­˜ç»“æ„</h3><h4 id="JVMå†…å­˜ç»“æ„"><a href="#JVMå†…å­˜ç»“æ„" class="headerlink" title="JVMå†…å­˜ç»“æ„"></a>JVMå†…å­˜ç»“æ„</h4><table><thead><tr><th><strong>å†…å­˜åŒºåŸŸ</strong></th><th><strong>æè¿°</strong></th><th><strong>çº¿ç¨‹å…±äº«æ€§</strong></th><th><strong>å¼‚å¸¸è§¦å‘æ¡ä»¶</strong></th></tr></thead><tbody><tr><td><strong>ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰</strong></td><td>è®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€ï¼Œçº¿ç¨‹ç§æœ‰ï¼Œå”¯ä¸€æ— OOMçš„åŒºåŸŸã€‚</td><td>çº¿ç¨‹ç§æœ‰</td><td>æ— ï¼ˆä¸ä¼šæŠ›å‡ºå†…å­˜ç›¸å…³å¼‚å¸¸ï¼‰</td></tr><tr><td><strong>è™šæ‹Ÿæœºæ ˆï¼ˆJava Stackï¼‰</strong></td><td>å­˜å‚¨æ–¹æ³•è°ƒç”¨çš„æ ˆå¸§ï¼ˆå±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ï¼‰ï¼Œçº¿ç¨‹ç§æœ‰ã€‚</td><td>çº¿ç¨‹ç§æœ‰</td><td><code>StackOverflowError</code>ï¼ˆæ ˆæ·±åº¦æº¢å‡ºï¼‰ <code>OutOfMemoryError</code>ï¼ˆæ— æ³•æ‰©å±•æ ˆç©ºé—´ï¼‰</td></tr><tr><td><strong>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Stackï¼‰</strong></td><td>ä¸ºNativeæ–¹æ³•ï¼ˆå¦‚C&#x2F;C++å®ç°çš„æ–¹æ³•ï¼‰æä¾›æ ˆç©ºé—´ï¼Œçº¿ç¨‹ç§æœ‰ã€‚</td><td>çº¿ç¨‹ç§æœ‰</td><td>åŒè™šæ‹Ÿæœºæ ˆ</td></tr><tr><td><strong>å †ï¼ˆHeapï¼‰</strong></td><td>å­˜æ”¾å¯¹è±¡å®ä¾‹å’Œæ•°ç»„ï¼Œæ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œæ˜¯åƒåœ¾å›æ”¶çš„ä¸»è¦åŒºåŸŸã€‚</td><td>çº¿ç¨‹å…±äº«</td><td><code>OutOfMemoryError</code>ï¼ˆå †å†…å­˜ä¸è¶³ï¼‰</td></tr><tr><td><strong>æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰</strong></td><td>å­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ä»£ç ç­‰æ•°æ®ã€‚JDK 8åç”±å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰å®ç°ã€‚</td><td>çº¿ç¨‹å…±äº«</td><td><code>OutOfMemoryError</code>ï¼ˆå…ƒç©ºé—´&#x2F;æ–¹æ³•åŒºå†…å­˜ä¸è¶³ï¼‰</td></tr></tbody></table><h4 id="è¿è¡Œæ—¶å¸¸é‡æ± å’Œå­—ç¬¦ä¸²å¸¸é‡æ± æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#è¿è¡Œæ—¶å¸¸é‡æ± å’Œå­—ç¬¦ä¸²å¸¸é‡æ± æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="è¿è¡Œæ—¶å¸¸é‡æ± å’Œå­—ç¬¦ä¸²å¸¸é‡æ± æœ‰ä»€ä¹ˆåŒºåˆ«"></a>è¿è¡Œæ—¶å¸¸é‡æ± å’Œå­—ç¬¦ä¸²å¸¸é‡æ± æœ‰ä»€ä¹ˆåŒºåˆ«</h4><p>åœ¨JVMä¸­ï¼Œå¸¸é‡æ± åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š<strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong>å’Œ<strong>å­—ç¬¦ä¸²å¸¸é‡æ± </strong>ï¼ˆString Poolï¼Œä¹Ÿç§°ä¸ºString Tableï¼‰ã€‚</p><ul><li><p><strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong>ï¼šå±äºæ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚åœ¨JDK1.7ä¹‹å‰ï¼Œæ–¹æ³•åŒºä½äºæ°¸ä¹…ä»£ï¼ˆPermGenï¼‰ä¸­ï¼›ä»JDK1.7å¼€å§‹ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± è¢«ç§»åŠ¨åˆ°å †ä¸­ï¼›è€Œåˆ°äº†JDK1.8ï¼Œæ°¸ä¹…ä»£è¢«å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰å–ä»£ï¼Œè¿è¡Œæ—¶å¸¸é‡æ± ä¹Ÿéšä¹‹ç§»åˆ°äº†å…ƒç©ºé—´ã€‚ä½†æ˜¯ï¼Œå…ƒç©ºé—´å¹¶ä¸åœ¨è™šæ‹Ÿæœºå†…å­˜ä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚</p></li><li><p><strong>å­—ç¬¦ä¸²å¸¸é‡æ± </strong>ï¼šåœ¨JDK1.7ä¹‹å‰ä½äºæ–¹æ³•åŒºï¼ˆæ°¸ä¹…ä»£ï¼‰ï¼Œä»JDK1.7å¼€å§‹è¢«ç§»åŠ¨åˆ°å †ä¸­ï¼ˆHeapï¼‰ã€‚æ‰€ä»¥ï¼Œåœ¨JDK1.7åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± ä½äºå †å†…å­˜ä¸­ã€‚</p></li></ul><p>å› æ­¤ï¼Œé’ˆå¯¹ä¸åŒç‰ˆæœ¬çš„JDKï¼Œå¸¸é‡æ± çš„ä½ç½®æœ‰æ‰€ä¸åŒï¼š</p><ul><li><p>JDK1.6åŠä¹‹å‰ï¼šè¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆåŒ…æ‹¬å­—ç¬¦ä¸²å¸¸é‡æ± ï¼‰åœ¨æ–¹æ³•åŒºï¼ˆæ°¸ä¹…ä»£ï¼‰ã€‚</p></li><li><p>JDK1.7ï¼šè¿è¡Œæ—¶å¸¸é‡æ± ä»åœ¨æ–¹æ³•åŒºï¼ˆä½†æ–¹æ³•åŒºå¼€å§‹é€æ­¥ç§»é™¤æ°¸ä¹…ä»£ï¼Œä½¿ç”¨å…ƒç©ºé—´çš„å‰èº«ï¼‰ï¼Œè€Œå­—ç¬¦ä¸²å¸¸é‡æ± è¢«ç§»åŠ¨åˆ°å †ä¸­ã€‚</p></li><li><p>JDK1.8åŠä¹‹åï¼šè¿è¡Œæ—¶å¸¸é‡æ± åœ¨å…ƒç©ºé—´ï¼ˆMetaspaceï¼Œä½¿ç”¨æœ¬åœ°å†…å­˜ï¼‰ï¼Œå­—ç¬¦ä¸²å¸¸é‡æ± åœ¨å †ä¸­ã€‚</p></li></ul><p>StringTable åœ¨ jdk1.6 ä¹‹å‰ï¼Œæ˜¯æ–¹æ³•åŒºä¸­è¿è¡Œæ—¶å¸¸é‡æ± çš„ä¸€éƒ¨åˆ†ï¼Œ jdk1.7 ä¹‹åç§»åˆ°äº†å †ä¸­ã€‚</p><p>åœ¨ jdk1.6 ä¹‹å‰ï¼Œfull GC æ‰ä¼šè§¦å‘æ°¸ä¹…ä»£çš„åƒåœ¾å›æ”¶ï¼Œå›æ”¶æ•ˆç‡å¾ˆä½ï¼Œå¦‚æœæœ‰å¤§é‡å­—ç¬¦ä¸²æ”¾å…¥ StringTableï¼Œå®¹æ˜“å¯¼è‡´æ°¸ä¹…ä»£å†…å­˜æº¢å‡ºã€‚</p><p>StringTable æ”¾å…¥å †ä¸­ä¹‹åï¼Œåªè¦æœ‰ minor GCï¼Œå°±ä¼šè§¦å‘ StringTable çš„åƒåœ¾å›æ”¶ï¼Œå‡å°‘äº†æ— ç”¨å­—ç¬¦ä¸²å¸¸é‡å¯¹å†…å­˜çš„å ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// jdk8</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringPool</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;a&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;b&quot;</span>); <span class="comment">// s1 æŒ‡å‘å †ä¸­çš„ &quot;ab&quot;</span></span><br><span class="line">        s1.intern(); <span class="comment">// åœ¨ StringTable ä¸­æ”¾å…¥å †ä¸­ &quot;ab&quot; çš„åœ°å€</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>; <span class="comment">// s2 å­˜çš„åœ°å€å°±æ˜¯ StringTable ä¸­æŒ‡å‘å †ä¸­ &quot;ab&quot; çš„åœ°å€ï¼Œå³ s2 ä¹ŸæŒ‡å‘å †ä¸­çš„ &quot;ab&quot;</span></span><br><span class="line">        System.out.println(s1 == s2); <span class="comment">// true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// jdk6</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringPool</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;a&quot;</span>) + <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;b&quot;</span>); <span class="comment">// s1 æŒ‡å‘å †ä¸­çš„ &quot;ab&quot;</span></span><br><span class="line">        s1.intern(); <span class="comment">// åœ¨ StringTable åˆ›å»º &quot;ab&quot;</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;ab&quot;</span>; <span class="comment">// s2 æŒ‡å‘ StringTable ä¸­çš„ &quot;ab&quot;</span></span><br><span class="line">        System.out.println(s1 == s2); <span class="comment">// false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè§¦å‘StackOverflowErrorå’ŒOutOfMemoryError"><a href="#ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè§¦å‘StackOverflowErrorå’ŒOutOfMemoryError" class="headerlink" title="ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè§¦å‘StackOverflowErrorå’ŒOutOfMemoryError"></a>ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè§¦å‘StackOverflowErrorå’ŒOutOfMemoryError</h4><p><strong>è§¦å‘StackOverflowError</strong></p><ul><li><p><strong>æ— é™é€’å½’</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class StackOverflowExample &#123;</span><br><span class="line">    public static void recursiveMethod() &#123;</span><br><span class="line">        recursiveMethod(); // æ— é™é€’å½’è°ƒç”¨</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        recursiveMethod(); // è§¦å‘StackOverflowError</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡æ–¹æ³•è°ƒç”¨éƒ½ä¼šåœ¨è™šæ‹Ÿæœºæ ˆä¸­å‹å…¥æ–°æ ˆå¸§ï¼Œè¶…å‡ºæ ˆçš„æœ€å¤§æ·±åº¦é™åˆ¶ï¼ˆé»˜è®¤1MBï¼Œå¯é€šè¿‡<code>-Xss</code>è°ƒæ•´ï¼‰ã€‚</p></li><li><p>æ ˆå¸§è¿‡å¤§ï¼ˆå±€éƒ¨å˜é‡è¿‡å¤šæˆ–æ–¹æ³•æ“ä½œæ•°æ ˆè¿‡æ·±ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public void largeMethod() &#123;</span><br><span class="line">    int a1, a2, a3, ..., a10000; // å¤§é‡å±€éƒ¨å˜é‡å ç”¨æ ˆç©ºé—´</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å•ä¸ªæ ˆå¸§å ç”¨çš„å†…å­˜è¶…è¿‡æ ˆå®¹é‡ã€‚</p></li></ul><p><strong>è§¦å‘OutOfMemoryError</strong></p><ul><li><p><strong>å †å†…å­˜æº¢å‡º</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// ä¸æ–­åˆ›å»ºå¤§å¯¹è±¡ï¼Œè€—å°½å †å†…å­˜</span><br><span class="line">List&lt;byte[]&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">while (true) &#123;</span><br><span class="line">    list.add(new byte[1024 * 1024]); // æ¯æ¬¡åˆ†é…1MB</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸå› </strong>ï¼šå¯¹è±¡æ•°é‡è¶…è¿‡å †å®¹é‡ï¼ˆå¯é€šè¿‡<code>-Xmx</code>å’Œ<code>-Xms</code>è°ƒæ•´å †å¤§å°ï¼‰ã€‚</p><p><strong>å…¸å‹åœºæ™¯</strong>ï¼šå†…å­˜æ³„æ¼ï¼ˆå¦‚é™æ€é›†åˆæœªé‡Šæ”¾å¯¹è±¡ï¼‰æˆ–åˆç†å†…å­˜ä¸è¶³ã€‚</p></li><li><p><strong>æ–¹æ³•åŒº&#x2F;å…ƒç©ºé—´æº¢å‡º</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// åŠ¨æ€ç”Ÿæˆå¤§é‡ç±»ï¼ˆå¦‚ä½¿ç”¨CGLIBï¼‰</span><br><span class="line">public class MetaspaceOOM &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Enhancer enhancer = new Enhancer();</span><br><span class="line">        enhancer.setSuperclass(OOMObject.class);</span><br><span class="line">        enhancer.setCallback((MethodInterceptor) (obj, method, args1, proxy) -&gt; proxy.invokeSuper(obj, args1));</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            enhancer.create(); // æŒç»­ç”Ÿæˆä»£ç†ç±»</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    static class OOMObject &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸå› </strong>ï¼šåŠ è½½çš„ç±»æ•°é‡æˆ–å…ƒæ•°æ®é‡è¶…è¿‡å…ƒç©ºé—´å®¹é‡ï¼ˆé€šè¿‡<code>-XX:MaxMetaspaceSize</code>è®¾ç½®ä¸Šé™ï¼‰ã€‚</p><p><strong>å…¸å‹åœºæ™¯</strong>ï¼šåŠ¨æ€ä»£ç†æ¡†æ¶ï¼ˆå¦‚Spring AOPï¼‰ã€åå°„æ»¥ç”¨ã€‚</p></li><li><p><strong>è™šæ‹Ÿæœºæ ˆæˆ–æœ¬åœ°æ–¹æ³•æ ˆæ— æ³•æ‰©å±•</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// å¯åŠ¨å¤§é‡çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹çš„æ ˆç©ºé—´æ— æ³•åˆ†é…</span><br><span class="line">public class ThreadOOM &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            new Thread(() -&gt; &#123;</span><br><span class="line">                try &#123; Thread.sleep(1000000); &#125; catch (InterruptedException e) &#123;&#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸå› </strong>ï¼šçº¿ç¨‹æ•°é‡è¿‡å¤šå¯¼è‡´æ ˆæ€»å†…å­˜è¶…è¿‡ç³»ç»Ÿé™åˆ¶ï¼ˆé€šè¿‡<code>-Xss</code>å‡å°‘å•ä¸ªçº¿ç¨‹æ ˆå¤§å°ï¼‰ã€‚</p></li></ul><p><strong>æ€»ç»“</strong></p><table><thead><tr><th><strong>é”™è¯¯ç±»å‹</strong></th><th><strong>è§¦å‘åœºæ™¯</strong></th><th><strong>å…¸å‹åŸå› </strong></th><th><strong>è§£å†³æ–¹æ¡ˆ</strong></th></tr></thead><tbody><tr><td><strong>StackOverflowError</strong></td><td>é€’å½’è°ƒç”¨æœªç»ˆæ­¢ã€æ ˆå¸§è¿‡å¤§</td><td>ä»£ç é€»è¾‘é”™è¯¯</td><td>ä¿®å¤é€’å½’ç»ˆæ­¢æ¡ä»¶ï¼Œå‡å°‘å±€éƒ¨å˜é‡æ•°é‡</td></tr><tr><td><strong>OutOfMemoryError</strong></td><td>å †å†…å­˜ä¸è¶³ã€å…ƒç©ºé—´æº¢å‡ºã€çº¿ç¨‹æ•°è¿‡å¤š</td><td>å†…å­˜æ³„æ¼ã€é…ç½®ä¸å½“ã€èµ„æºè€—å°½</td><td>è°ƒæ•´JVMå‚æ•°ï¼Œä¼˜åŒ–ä»£ç ï¼Œå¢åŠ ç‰©ç†å†…å­˜</td></tr></tbody></table><h4 id="æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´çš„åŒºåˆ«"><a href="#æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´çš„åŒºåˆ«" class="headerlink" title="æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´çš„åŒºåˆ«"></a>æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´çš„åŒºåˆ«</h4><h4 id="å †å†…å­˜æ˜¯æ€ä¹ˆç»†åˆ†çš„"><a href="#å †å†…å­˜æ˜¯æ€ä¹ˆç»†åˆ†çš„" class="headerlink" title="å †å†…å­˜æ˜¯æ€ä¹ˆç»†åˆ†çš„"></a>å †å†…å­˜æ˜¯æ€ä¹ˆç»†åˆ†çš„</h4><h3 id="åƒåœ¾å›æ”¶"><a href="#åƒåœ¾å›æ”¶" class="headerlink" title="åƒåœ¾å›æ”¶"></a>åƒåœ¾å›æ”¶</h3><h4 id="å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶"><a href="#å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶" class="headerlink" title="å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶"></a>å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å¯å›æ”¶</h4><p><strong>å¼•ç”¨è®¡æ•°æ³•</strong></p><p><strong>å¯è¾¾æ€§åˆ†ææ³•</strong></p><p>åœ¨ Java ä¸­ ä»¥ä¸‹å¯¹è±¡å¯ä½œä¸º GC Rootsï¼š</p><ul><li>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­çš„å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¦å®£å‘Šä¸€ä¸ªå¯¹è±¡çš„çœŸæ­£æ­»äº¡ï¼Œéœ€è¦ç»è¿‡ä¸¤æ¬¡æ ‡è®°ã€‚</p><ol><li><p>ä» GC roots å‡ºå‘ï¼Œæ ‡è®°ä¸å¯è¾¾çš„å¯¹è±¡</p></li><li><p>å¯¹ F-Queue å¯¹åˆ—ä¸­çš„å¯¹è±¡è¿›è¡ŒäºŒæ¬¡æ ‡è®°</p><p>ä¸å¯è¾¾å¯¹è±¡å¦‚æœé‡å†™ä¸”è¿˜æœªæ‰§è¡Œ finalize æ–¹æ³•ï¼Œä¼šè¢«åŠ å…¥åˆ°ä¸€ä¸ªåä¸º F-Queue çš„é˜Ÿåˆ—ä¸­ã€‚åœ¨ F-Queue é˜Ÿåˆ—ä¸­çš„å¯¹è±¡å¯ä»¥é‡æ–°è¢«èµ‹å€¼ç»™æŸä¸ªå¼•ç”¨ï¼Œè¿™æ ·äºŒæ¬¡æ ‡è®°æ—¶ï¼Œè¿™äº›å¯¹è±¡å°†è¢«ç§»å‡º F-Queue é˜Ÿåˆ—ï¼Œä»è€Œå®ç°è‡ªæ•‘ã€‚</p></li></ol><h4 id="4ç§å¼•ç”¨ç±»å‹"><a href="#4ç§å¼•ç”¨ç±»å‹" class="headerlink" title="4ç§å¼•ç”¨ç±»å‹"></a>4ç§å¼•ç”¨ç±»å‹</h4><p>JVM çš„å››ç§å¼•ç”¨ç±»å‹ï¼ˆå¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ï¼‰å†³å®šäº†å¯¹è±¡å¦‚ä½•è¢«åƒåœ¾å›æ”¶å™¨ï¼ˆGCï¼‰å¯¹å¾…ï¼Œä¸»è¦æœåŠ¡äº<strong>æ›´ç²¾ç»†åœ°æ§åˆ¶å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ</strong>å’Œ<strong>ç®¡ç†å†…å­˜</strong>çš„ç›®çš„ã€‚å®ƒä»¬çš„ä½¿ç”¨åœºæ™¯å„æœ‰ä¾§é‡ï¼š</p><ol><li><p><strong>å¼ºå¼•ç”¨ (Strong Reference)</strong></p><ul><li><strong>å®šä¹‰ï¼š</strong> æœ€å¸¸è§çš„å¼•ç”¨ç±»å‹ã€‚é€šè¿‡ <code>new</code> å…³é”®å­—åˆ›å»ºçš„å¯¹è±¡é»˜è®¤å°±æ˜¯å¼ºå¼•ç”¨ã€‚åªè¦å¼ºå¼•ç”¨å­˜åœ¨ï¼Œåƒåœ¾å›æ”¶å™¨å°±<strong>ç»å¯¹ä¸ä¼š</strong>å›æ”¶è¯¥å¯¹è±¡ï¼Œå³ä½¿é¢ä¸´å†…å­˜ä¸è¶³ï¼ˆOOMï¼‰çš„é£é™©ã€‚</li><li><strong>è¯­æ³•ï¼š</strong> <code>Object obj = new Object(); // obj å°±æ˜¯ä¸€ä¸ªæŒ‡å‘æ–° Object å®ä¾‹çš„å¼ºå¼•ç”¨</code></li><li><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong><ul><li><strong>ç»å¤§å¤šæ•°å¯¹è±¡å¼•ç”¨ã€‚</strong> æ—¥å¸¸ç¼–ç¨‹ä¸­åˆ›å»ºçš„å¯¹è±¡å¼•ç”¨å‡ ä¹éƒ½æ˜¯å¼ºå¼•ç”¨ã€‚</li><li><strong>éœ€è¦å¯¹è±¡é•¿æœŸå­˜åœ¨ç›´åˆ°æ˜¾å¼è§£é™¤å¼•ç”¨ (<code>obj = null;</code>) çš„åœºæ™¯ã€‚</strong></li></ul></li><li><strong>GC è¡Œä¸ºï¼š</strong> å¯¹è±¡å¯è¾¾æ€§åˆ¤æ–­çš„åŸºå‡†ã€‚ä» GC Rootsï¼ˆå¦‚çº¿ç¨‹æ ˆä¸­çš„å±€éƒ¨å˜é‡ã€é™æ€å˜é‡ã€JNI å¼•ç”¨ç­‰ï¼‰å‡ºå‘ï¼Œé€šè¿‡å¼ºå¼•ç”¨é“¾å¯è¾¾çš„å¯¹è±¡æ˜¯å­˜æ´»çš„ï¼Œä¸ä¼šè¢«å›æ”¶ã€‚åªæœ‰å½“ä¸€ä¸ªå¯¹è±¡<strong>ä¸å†è¢«ä»»ä½•å¼ºå¼•ç”¨é“¾å¯è¾¾</strong>æ—¶ï¼Œå®ƒæ‰æˆä¸ºæ½œåœ¨çš„å›æ”¶å€™é€‰å¯¹è±¡ã€‚</li></ul></li><li><p><strong>è½¯å¼•ç”¨ (SoftReference)</strong></p><ul><li><p><strong>å®šä¹‰ï¼š</strong> ç”¨æ¥æè¿°ä¸€äº›<strong>æœ‰ç”¨ä½†éå¿…éœ€</strong>çš„å¯¹è±¡ã€‚å½“å†…å­˜å……è¶³æ—¶ï¼Œè½¯å¼•ç”¨å…³è”çš„å¯¹è±¡ä¸ä¼šè¢«å›æ”¶ï¼›å½“<strong>å†…å­˜ä¸è¶³ï¼ˆå³å°†å‘ç”Ÿ OOM ä¹‹å‰ï¼‰</strong>ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šå°è¯•å›æ”¶è¿™äº›è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ã€‚å¦‚æœå›æ”¶äº†è½¯å¼•ç”¨å¯¹è±¡åå†…å­˜ä»ç„¶ä¸è¶³ï¼Œæ‰ä¼šæŠ›å‡º <code>OutOfMemoryError</code>ã€‚</p></li><li><p><strong>è¯­æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">importantObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>(); <span class="comment">// åŸå§‹å¼ºå¼•ç”¨</span></span><br><span class="line">SoftReference&lt;Object&gt; softRef = <span class="keyword">new</span> <span class="title class_">SoftReference</span>&lt;&gt;(importantObj);</span><br><span class="line">importantObj = <span class="literal">null</span>; <span class="comment">// è§£é™¤å¼ºå¼•ç”¨ï¼Œåªå‰©ä¸‹è½¯å¼•ç”¨</span></span><br><span class="line"><span class="comment">// ç¨åå°è¯•è·å–</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">retrieved</span> <span class="operator">=</span> softRef.get(); <span class="comment">// å¦‚æœæœªè¢«å›æ”¶ï¼Œretrieved != null; å¦‚æœè¢«å›æ”¶ï¼Œretrieved == null</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p><ul><li><strong>å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ (Memory-Sensitive Caches)ï¼š</strong> è¿™æ˜¯æœ€ç»å…¸çš„åœºæ™¯ã€‚ç¼“å­˜çš„å¯¹è±¡å¦‚æœè¢«å›æ”¶ï¼Œé€šå¸¸å¯ä»¥é‡æ–°åŠ è½½æˆ–è®¡ç®—ã€‚è½¯å¼•ç”¨èƒ½ä¿è¯åœ¨å†…å­˜åƒç´§æ—¶è‡ªåŠ¨é‡Šæ”¾ç¼“å­˜ï¼Œé¿å… OOMï¼ŒåŒæ—¶å°½å¯èƒ½åˆ©ç”¨å†…å­˜æé«˜ç¼“å­˜å‘½ä¸­ç‡ã€‚ä¾‹å¦‚ï¼š<ul><li>å›¾ç‰‡ç¼“å­˜</li><li>æ•°æ®åº“æŸ¥è¯¢ç»“æœç¼“å­˜</li><li>å¤§å‹è®¡ç®—ç»“æœçš„ç¼“å­˜</li></ul></li><li><strong>éœ€è¦ä¸´æ—¶ä¿ç•™ä½†å¯ç‰ºç‰²çš„æ•°æ®ã€‚</strong></li></ul></li><li><p><strong>GC è¡Œä¸ºï¼š</strong> åœ¨ JVM åˆ¤æ–­å†…å­˜ä¸è¶³ï¼ˆé€šå¸¸æ˜¯åœ¨ Full GC ä¹‹åï¼‰æ—¶ï¼Œä¼šå›æ”¶ä»…è¢«è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ã€‚</p></li></ul></li><li><p><strong>å¼±å¼•ç”¨ (WeakReference)</strong></p><ul><li><p><strong>å®šä¹‰ï¼š</strong> ç”¨æ¥æè¿°<strong>éå¿…éœ€</strong>å¯¹è±¡ï¼Œæ¯”è½¯å¼•ç”¨æ›´å¼±ã€‚å¼±å¼•ç”¨å…³è”çš„å¯¹è±¡<strong>åªèƒ½ç”Ÿå­˜åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶å‘ç”Ÿä¹‹å‰</strong>ã€‚æ— è®ºå½“å‰å†…å­˜æ˜¯å¦å……è¶³ï¼Œåªè¦åƒåœ¾å›æ”¶å™¨å¼€å§‹å·¥ä½œï¼ˆå¹¶ä¸”æ‰«æåˆ°è¿™ä¸ªå¯¹è±¡ï¼‰ï¼Œå°±ä¼šå›æ”¶æ‰<strong>ä»…è¢«å¼±å¼•ç”¨æŒ‡å‘</strong>çš„å¯¹è±¡ã€‚</p></li><li><p><strong>è¯­æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">tempObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>(); <span class="comment">// åŸå§‹å¼ºå¼•ç”¨</span></span><br><span class="line">WeakReference&lt;Object&gt; weakRef = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;&gt;(tempObj);</span><br><span class="line">tempObj = <span class="literal">null</span>; <span class="comment">// è§£é™¤å¼ºå¼•ç”¨ï¼Œåªå‰©ä¸‹å¼±å¼•ç”¨</span></span><br><span class="line"><span class="comment">// å¼ºåˆ¶è§¦å‘ä¸€æ¬¡ GC (ä»…ç¤ºä¾‹ï¼Œç”Ÿäº§ç¯å¢ƒæ…ç”¨ System.gc())</span></span><br><span class="line">System.gc();</span><br><span class="line"><span class="comment">// å°è¯•è·å–</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">retrieved</span> <span class="operator">=</span> weakRef.get(); <span class="comment">// å¾ˆå¤§æ¦‚ç‡ retrieved == nullï¼Œå› ä¸ºå¯¹è±¡å·²è¢«å›æ”¶</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p><ul><li><strong>è§„èŒƒåŒ–æ˜ å°„ (Canonicalizing Mappings)ï¼š</strong> <code>WeakHashMap</code> æ˜¯å…¶å…¸å‹åº”ç”¨ã€‚å®ƒä½¿ç”¨å¼±å¼•ç”¨ä½œä¸ºé”®ï¼ˆKeyï¼‰ã€‚å½“é”®å¯¹è±¡<strong>åœ¨ WeakHashMap å¤–éƒ¨ä¸å†æœ‰ä»»ä½•å¼ºå¼•ç”¨</strong>æ—¶ï¼Œä¸‹æ¬¡ GC åï¼Œè¯¥é”®å€¼å¯¹ä¼šè‡ªåŠ¨ä» WeakHashMap ä¸­è¢«ç§»é™¤ã€‚é€‚ç”¨äºå­˜å‚¨å¯¹è±¡çš„å…ƒä¿¡æ¯ã€é™„åŠ å±æ€§ç­‰ï¼Œè¿™äº›ä¿¡æ¯åœ¨å¯¹è±¡æœ¬èº«ä¸å†è¢«ä½¿ç”¨æ—¶ä¹Ÿåº”è‡ªåŠ¨æ¶ˆå¤±ã€‚</li><li><strong>ç›‘å¬å™¨æ¨¡å¼ (Listener Patterns)ï¼š</strong> é¿å…å› æ³¨å†Œç›‘å¬å™¨åå¿˜è®°æ³¨é”€è€Œå¯¼è‡´ç›‘å¬å™¨å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯å®ç°äº†ç›‘å¬æ¥å£çš„å¯¹è±¡ï¼‰å’Œå‘å¸ƒè€…å¯¹è±¡éƒ½æ— æ³•å›æ”¶ï¼ˆå†…å­˜æ³„æ¼ï¼‰ã€‚ä½¿ç”¨å¼±å¼•ç”¨æŒæœ‰ç›‘å¬å™¨ï¼Œå½“ç›‘å¬å™¨å¯¹è±¡åœ¨å…¶ä»–åœ°æ–¹æ²¡æœ‰å¼ºå¼•ç”¨æ—¶ï¼ŒGC ä¼šè‡ªåŠ¨å›æ”¶å®ƒï¼Œå‘å¸ƒè€…æŒæœ‰çš„å¼±å¼•ç”¨ä¼šè‡ªåŠ¨å¤±æ•ˆï¼ˆget() è¿”å› nullï¼‰ï¼Œå‘å¸ƒè€…å¯ä»¥æ¸…ç†è¿™äº›æ— æ•ˆå¼•ç”¨ã€‚</li><li><strong>ä¸´æ—¶æ€§çš„ã€è¾…åŠ©æ€§çš„æ•°æ®ç»“æ„ã€‚</strong></li></ul></li><li><p><strong>GC è¡Œä¸ºï¼š</strong> åœ¨<strong>ä¸‹ä¸€æ¬¡ GC è¿è¡Œæ—¶</strong>ï¼ˆæ— è®ºæ˜¯ Minor GC è¿˜æ˜¯ Full GCï¼‰ï¼Œåªè¦å¯¹è±¡<strong>ä»…è¢«å¼±å¼•ç”¨æŒ‡å‘</strong>ï¼ˆæ²¡æœ‰å¼ºå¼•ç”¨æˆ–è½¯å¼•ç”¨ï¼‰ï¼Œå°±ä¼šè¢«å›æ”¶ã€‚</p></li></ul></li><li><p><strong>è™šå¼•ç”¨ (PhantomReference)</strong></p><ul><li><p><strong>å®šä¹‰ï¼š</strong> æœ€å¼±çš„ä¸€ç§å¼•ç”¨ã€‚<strong>æ— æ³•é€šè¿‡è™šå¼•ç”¨è·å–å¯¹è±¡å®ä¾‹</strong>ï¼ˆå…¶ <code>get()</code> æ–¹æ³•æ€»æ˜¯è¿”å› <code>null</code>ï¼‰ã€‚è™šå¼•ç”¨<strong>å¿…é¡»</strong>ä¸ <code>ReferenceQueue</code> è”åˆä½¿ç”¨ã€‚è®¾ç½®è™šå¼•ç”¨çš„<strong>å”¯ä¸€ç›®çš„</strong>æ˜¯<strong>è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„æ—¶æœº</strong>ã€‚å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡<strong>ä¹‹å</strong>ï¼ˆæ­¤æ—¶å¯¹è±¡å†…å­˜å·²è¢«é‡Šæ”¾æˆ–å³å°†è¢«é‡Šæ”¾ï¼‰ï¼Œå°†è¿™ä¸ªè™šå¼•ç”¨åŠ å…¥ä¸ä¹‹å…³è”çš„ <code>ReferenceQueue</code> ä¸­ã€‚</p></li><li><p><strong>è¯­æ³•ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ReferenceQueue&lt;Object&gt; queue = <span class="keyword">new</span> <span class="title class_">ReferenceQueue</span>&lt;&gt;();</span><br><span class="line"><span class="type">Object</span> <span class="variable">phantomObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>(); <span class="comment">// åŸå§‹å¼ºå¼•ç”¨</span></span><br><span class="line">PhantomReference&lt;Object&gt; phantomRef = <span class="keyword">new</span> <span class="title class_">PhantomReference</span>&lt;&gt;(phantomObj, queue);</span><br><span class="line">phantomObj = <span class="literal">null</span>; <span class="comment">// è§£é™¤å¼ºå¼•ç”¨</span></span><br><span class="line"><span class="comment">// ... å¼ºåˆ¶ GC æˆ–ç­‰å¾… GC å‘ç”Ÿ ...</span></span><br><span class="line"><span class="comment">// æ£€æŸ¥é˜Ÿåˆ—</span></span><br><span class="line">Reference&lt;?&gt; refFromQueue = queue.poll();</span><br><span class="line"><span class="keyword">if</span> (refFromQueue != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// æ­¤æ—¶ refFromQueue å°±æ˜¯ phantomRefï¼Œè¡¨ç¤º phantomObj å·²è¢«å›æ”¶æˆ–å¤„äº finalization çŠ¶æ€</span></span><br><span class="line">    <span class="comment">// å¯ä»¥åœ¨è¿™é‡Œæ‰§è¡Œä¸€äº›èµ„æºæ¸…ç†åŠ¨ä½œï¼ˆå¦‚å…³é—­å…³è”çš„æ–‡ä»¶æè¿°ç¬¦ã€é‡Šæ”¾å †å¤–å†…å­˜ç­‰ï¼‰</span></span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼šæ­¤æ—¶åŸå¯¹è±¡ phantomObj å·²ç»ä¸å¯è¾¾ä¸”å†…å­˜å¯èƒ½å·²è¢«å›æ”¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p><ul><li><strong>ç®¡ç†å †å¤–å†…å­˜ (Off-Heap Memory)ï¼š</strong> è¿™æ˜¯æœ€ä¸»è¦çš„åº”ç”¨åœºæ™¯ã€‚Java NIO çš„ <code>DirectByteBuffer</code> åˆ†é…å †å¤–å†…å­˜ã€‚<code>DirectByteBuffer</code> å¯¹è±¡æœ¬èº«å¾ˆå°ï¼ˆåœ¨å †ä¸Šï¼‰ï¼Œä½†å®ƒå…³è”ç€ä¸€å—è¾ƒå¤§çš„å †å¤–å†…å­˜ã€‚å½“ <code>DirectByteBuffer</code> å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œéœ€è¦é‡Šæ”¾å…¶å…³è”çš„å †å¤–å†…å­˜ã€‚JVM ä½¿ç”¨ <code>Cleaner</code> ç±»ï¼ˆå†…éƒ¨åŸºäº <code>PhantomReference</code>ï¼‰æ¥ç›‘æ§ <code>DirectByteBuffer</code> å¯¹è±¡ã€‚å½“ <code>DirectByteBuffer</code> å¯¹è±¡è¢« GC å›æ”¶åï¼Œ<code>Cleaner</code> çš„è™šå¼•ç”¨ä¼šè¢«æ”¾å…¥é˜Ÿåˆ—ï¼Œè§¦å‘ä¸€ä¸ªæ¸…ç†çº¿ç¨‹è°ƒç”¨ <code>unsafe.freeMemory</code> æ¥é‡Šæ”¾å †å¤–å†…å­˜ã€‚</li><li><strong>ç²¾ç¡®çš„å¯¹è±¡å›æ”¶åå¤„ç† (Post-Mortem Cleanup Actions)ï¼š</strong> éœ€è¦åœ¨ç¡®åˆ‡çŸ¥é“å¯¹è±¡<strong>å·²ç»è¢« GC å›æ”¶</strong>ï¼ˆæˆ–è€…è‡³å°‘å¤„äº finalization å®ŒæˆçŠ¶æ€ï¼‰ä¹‹åæ‰§è¡ŒæŸäº›ç‰¹å®šçš„æ¸…ç†æ“ä½œï¼Œä¸”è¿™äº›æ“ä½œä¸é€‚åˆæ”¾åœ¨ <code>finalize()</code> æ–¹æ³•ä¸­æ—¶ï¼ˆ<code>finalize()</code> æœ‰æ€§èƒ½é—®é¢˜ã€æ‰§è¡Œæ—¶æœºä¸ç¡®å®šã€å¯èƒ½å¤æ´»å¯¹è±¡ï¼‰ã€‚</li></ul></li><li><p><strong>GC è¡Œä¸ºï¼š</strong> å¯¹è±¡æ˜¯å¦è¢«è™šå¼•ç”¨æŒ‡å‘<strong>å®Œå…¨ä¸å½±å“</strong>å…¶è¢«åƒåœ¾å›æ”¶çš„èµ„æ ¼ï¼ˆåªè¦ä¸å¯è¾¾å°±ä¼šè¢«å›æ”¶ï¼‰ã€‚è™šå¼•ç”¨çš„å­˜åœ¨æ˜¯ä¸ºäº†åœ¨å¯¹è±¡è¢«å›æ”¶<strong>ä¹‹å</strong>æä¾›ä¸€ä¸ªé€šçŸ¥æœºåˆ¶ï¼ˆé€šè¿‡ <code>ReferenceQueue</code>ï¼‰ã€‚å¯¹è±¡å›æ”¶åï¼Œå…¶å…³è”çš„è™šå¼•ç”¨ä¼šè¢«åŠ å…¥é˜Ÿåˆ—ã€‚</p></li></ul></li></ol><p><strong>æ€»ç»“å¯¹æ¯”è¡¨ï¼š</strong></p><table><thead><tr><th align="left">å¼•ç”¨ç±»å‹</th><th align="left">å¼ºåº¦</th><th align="left">è¢« GC å›æ”¶çš„æ—¶æœº</th><th align="left"><code>get()</code> è¡Œä¸º</th><th align="left">æ˜¯å¦å½±å“å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ</th><th align="left">ä¸»è¦ç”¨é€”</th><th align="left">æ˜¯å¦å…³è” ReferenceQueue</th></tr></thead><tbody><tr><td align="left"><strong>å¼ºå¼•ç”¨</strong></td><td align="left">æœ€å¼º</td><td align="left"><strong>æ°¸ä¸</strong>ï¼ˆåªè¦å¯è¾¾ï¼‰</td><td align="left">è¿”å›å¯¹è±¡æœ¬èº«</td><td align="left"><strong>æ˜¯</strong></td><td align="left">é»˜è®¤å¼•ç”¨ï¼Œä¿æŒå¯¹è±¡é•¿æœŸå­˜åœ¨</td><td align="left">å¦</td></tr><tr><td align="left"><strong>è½¯å¼•ç”¨</strong></td><td align="left">æ¬¡å¼º</td><td align="left"><strong>å†…å­˜ä¸è¶³æ—¶</strong>ï¼ˆåœ¨ OOM ä¹‹å‰ï¼‰</td><td align="left">å†…å­˜è¶³æ—¶è¿”å›å¯¹è±¡ï¼›å†…å­˜ä¸è¶³è¿”å›<code>null</code></td><td align="left">é—´æ¥æ˜¯ï¼ˆé€šè¿‡å†…å­˜å‹åŠ›ï¼‰</td><td align="left">å†…å­˜æ•æ„Ÿç¼“å­˜</td><td align="left">å¯é€‰</td></tr><tr><td align="left"><strong>å¼±å¼•ç”¨</strong></td><td align="left">è¾ƒå¼±</td><td align="left"><strong>ä¸‹ä¸€æ¬¡ GC è¿è¡Œæ—¶</strong>ï¼ˆæ— è®ºå†…å­˜æ˜¯å¦å……è¶³ï¼‰</td><td align="left">GC å‰è¿”å›å¯¹è±¡ï¼›GC åè¿”å› <code>null</code></td><td align="left"><strong>å¦</strong></td><td align="left">è§„èŒƒåŒ–æ˜ å°„ï¼ˆWeakHashMapï¼‰ã€ç›‘å¬å™¨ã€ä¸´æ—¶æ•°æ®</td><td align="left">å¯é€‰</td></tr><tr><td align="left"><strong>è™šå¼•ç”¨</strong></td><td align="left">æœ€å¼±</td><td align="left"><strong>å¯¹è±¡è¢«å›æ”¶ä¹‹å</strong>é€šçŸ¥</td><td align="left"><strong>æ€»æ˜¯è¿”å› <code>null</code></strong></td><td align="left"><strong>å¦</strong></td><td align="left">å¯¹è±¡å›æ”¶è·Ÿè¸ªã€å †å¤–å†…å­˜æ¸…ç†ã€å›æ”¶åå¤„ç†</td><td align="left"><strong>å¿…é¡»</strong></td></tr></tbody></table><p>ç†è§£å¹¶æ­£ç¡®ä½¿ç”¨è¿™å››ç§å¼•ç”¨ç±»å‹ï¼Œç‰¹åˆ«æ˜¯è½¯ã€å¼±ã€è™šå¼•ç”¨ï¼Œå¯¹äºç¼–å†™é«˜æ•ˆã€å†…å­˜å‹å¥½çš„ Java ç¨‹åºï¼ˆå°¤å…¶æ˜¯éœ€è¦ç®¡ç†ç¼“å­˜ã€ç›‘å¬å™¨æˆ–å †å¤–èµ„æºæ—¶ï¼‰è‡³å…³é‡è¦ã€‚å®ƒä»¬æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œè®©ç¨‹åºèƒ½åœ¨ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½çš„å‰æä¸‹ï¼Œæ›´ä¼˜é›…åœ°å¤„ç†å†…å­˜èµ„æºã€‚</p><h4 id="æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•"><a href="#æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•"></a>æœ‰å“ªäº›åƒåœ¾å›æ”¶ç®—æ³•</h4><table><thead><tr><th>ç®—æ³•</th><th>æ­¥éª¤</th><th>ç‰¹ç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰</strong></td><td>1. <strong>æ ‡è®°</strong>ï¼šéå†æ‰€æœ‰å¯¹è±¡ï¼Œæ ‡è®°å­˜æ´»å¯¹è±¡ã€‚ 2. <strong>æ¸…é™¤</strong>ï¼šå›æ”¶æœªè¢«æ ‡è®°çš„å¯¹è±¡ï¼ˆåƒåœ¾ï¼‰ã€‚</td><td><strong>ä¼˜ç‚¹</strong>ï¼šå®ç°ç®€å•ï¼Œä¸éœ€è¦ç§»åŠ¨å¯¹è±¡ã€‚ <strong>ç¼ºç‚¹</strong>ï¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œå¯èƒ½è§¦å‘é¢‘ç¹çš„ Full GCã€‚</td><td>1. è€å¹´ä»£å›æ”¶ï¼ˆå¦‚ CMS æ”¶é›†å™¨çš„åˆå§‹é˜¶æ®µï¼‰ã€‚ 2. å¯¹å†…å­˜ç¢ç‰‡ä¸æ•æ„Ÿçš„åœºæ™¯ï¼Œæˆ–çŸ­æœŸè¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚</td></tr><tr><td><strong>å¤åˆ¶ç®—æ³•ï¼ˆCopyingï¼‰</strong></td><td>1. å°†å†…å­˜åˆ†ä¸ºä¸¤å—ï¼ˆFrom å’Œ Toï¼‰ï¼Œå¯¹è±¡åˆ†é…åœ¨ From åŒºã€‚ 2. æ ‡è®°å­˜æ´»å¯¹è±¡ï¼Œå°†å…¶å¤åˆ¶åˆ° To åŒºã€‚ 3. æ¸…ç©º From åŒºï¼Œäº¤æ¢ From å’Œ To çš„è§’è‰²ã€‚</td><td><strong>ä¼˜ç‚¹</strong>ï¼šæ— å†…å­˜ç¢ç‰‡ï¼Œå›æ”¶é«˜æ•ˆã€‚ <strong>ç¼ºç‚¹</strong>ï¼šå†…å­˜åˆ©ç”¨ç‡ä½ï¼ˆéœ€é¢„ç•™ä¸€åŠç©ºé—´ï¼‰ã€‚</td><td>1. æ–°ç”Ÿä»£å›æ”¶ï¼ˆå¦‚ Serialã€ParNewã€Parallel Scavenge ç­‰æ”¶é›†å™¨ï¼‰ã€‚ 2. é€‚ç”¨äºå¯¹è±¡å­˜æ´»ç‡ä½çš„åœºæ™¯ï¼ˆå¦‚æ–°ç”Ÿä»£ Eden åŒºï¼‰ã€‚</td></tr><tr><td><strong>æ ‡è®°-æ•´ç†ï¼ˆMark-Compactï¼‰</strong></td><td><strong>æ ‡è®°</strong>ï¼šéå†æ‰€æœ‰å¯¹è±¡ï¼Œæ ‡è®°å­˜æ´»å¯¹è±¡ã€‚ <strong>æ•´ç†</strong>ï¼šå°†å­˜æ´»å¯¹è±¡å‘å†…å­˜ä¸€ç«¯ç§»åŠ¨ï¼Œæ¸…ç†è¾¹ç•Œå¤–çš„ç©ºé—´ã€‚</td><td><strong>ä¼˜ç‚¹</strong>ï¼šé¿å…å†…å­˜ç¢ç‰‡ï¼Œé€‚åˆé•¿æœŸè¿è¡Œçš„ç³»ç»Ÿã€‚ <strong>ç¼ºç‚¹</strong>ï¼šç§»åŠ¨å¯¹è±¡éœ€è¦æ—¶é—´ï¼Œå¯¼è‡´åœé¡¿è¾ƒé•¿ï¼ˆSTWï¼‰ã€‚</td><td>1. è€å¹´ä»£å›æ”¶ï¼ˆå¦‚ Serial Oldã€Parallel Old æ”¶é›†å™¨ï¼‰ã€‚ 2. å¯¹å†…å­˜æ•æ„Ÿä¸”éœ€è¦é¿å…ç¢ç‰‡çš„åœºæ™¯ï¼ˆå¦‚å¤§æ•°æ®åº”ç”¨ï¼‰ã€‚</td></tr></tbody></table><h4 id="CMSæ”¶é›†å™¨å·¥ä½œåŸç†"><a href="#CMSæ”¶é›†å™¨å·¥ä½œåŸç†" class="headerlink" title="CMSæ”¶é›†å™¨å·¥ä½œåŸç†"></a>CMSæ”¶é›†å™¨å·¥ä½œåŸç†</h4><h4 id="G1æ”¶é›†å™¨å·¥ä½œåŸç†"><a href="#G1æ”¶é›†å™¨å·¥ä½œåŸç†" class="headerlink" title="G1æ”¶é›†å™¨å·¥ä½œåŸç†"></a>G1æ”¶é›†å™¨å·¥ä½œåŸç†</h4><h3 id="JVMè°ƒä¼˜"><a href="#JVMè°ƒä¼˜" class="headerlink" title="JVMè°ƒä¼˜"></a>JVMè°ƒä¼˜</h3><h4 id="å¸¸ç”¨è°ƒä¼˜å‚æ•°"><a href="#å¸¸ç”¨è°ƒä¼˜å‚æ•°" class="headerlink" title="å¸¸ç”¨è°ƒä¼˜å‚æ•°"></a>å¸¸ç”¨è°ƒä¼˜å‚æ•°</h4><ol><li>-Xmx: è®¾ç½®Javaå †çš„æœ€å¤§å†…å­˜å¤§å°ã€‚</li><li>-Xms: è®¾ç½®Javaå †çš„åˆå§‹å†…å­˜å¤§å°ã€‚</li><li>-Xmn: è®¾ç½®æ–°ç”Ÿä»£çš„å¤§å°ã€‚</li><li>-XX:NewRatio: è®¾ç½®æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¯”ä¾‹ã€‚</li><li>-XX:SurvivorRatio: è®¾ç½®EdenåŒºå’ŒSurvivoråŒºçš„æ¯”ä¾‹ã€‚</li><li>-XX:MaxPermSize (Java 8ä¹‹å‰) &#x2F; -XX:MaxMetaspaceSize (Java 8åŠä¹‹å): è®¾ç½®æ°¸ä¹…ä»£ï¼ˆJava 8ä¹‹å‰ï¼‰æˆ–å…ƒç©ºé—´ï¼ˆJava 8åŠä¹‹åï¼‰çš„æœ€å¤§å†…å­˜å¤§å°ã€‚</li><li>-XX:ParallelGCThreads: è®¾ç½®å¹¶è¡Œåƒåœ¾å›æ”¶çš„çº¿ç¨‹æ•°ã€‚</li><li>-XX:+UseConcMarkSweepGC: å¯ç”¨CMSåƒåœ¾å›æ”¶å™¨ã€‚</li><li>-XX:+UseG1GC: å¯ç”¨G1ï¼ˆGarbage-Firstï¼‰åƒåœ¾å›æ”¶å™¨ã€‚</li><li>-XX:G1HeapRegionSizeï¼šè®¾ç½® Region çš„å¤§å°ã€‚</li><li>-XX:+HeapDumpOnOutOfMemoryError: å½“å‘ç”ŸOutOfMemoryErroré”™è¯¯æ—¶ï¼Œè‡ªåŠ¨ç”Ÿæˆå †å†…å­˜è½¬å‚¨æ–‡ä»¶ã€‚</li><li>-XX:HeapDumpPath&#x3D;&lt;è·¯å¾„&gt;: è®¾ç½®å †å†…å­˜è½¬å‚¨æ–‡ä»¶çš„ä¿å­˜è·¯å¾„ã€‚</li><li>-XX:+DisableExplicitGC: ç¦ç”¨æ˜¾å¼çš„åƒåœ¾å›æ”¶æ“ä½œã€‚</li><li>-XX:CMSInitiatingOccupancyFractionï¼šè®¾ç½®è€å¹´ä»£çš„ä½¿ç”¨æ¯”ä¾‹ã€‚</li><li>-XX:PretenureSizeThresholdï¼šè®¾ç½®å¤§å¯¹è±¡é˜ˆå€¼ï¼Œè¶…è¿‡è¿™ä¸ªå¤§å°ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…ã€‚</li><li>-XX:MaxTenuringThresholdï¼šè®¾ç½®æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„</li></ol><h1 id="æ•°æ®å­˜å‚¨"><a href="#æ•°æ®å­˜å‚¨" class="headerlink" title="æ•°æ®å­˜å‚¨"></a>æ•°æ®å­˜å‚¨</h1><h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><h3 id="æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œé¡ºåº"><a href="#æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œé¡ºåº" class="headerlink" title="æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œé¡ºåº"></a>æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œé¡ºåº</h3><p>MySQL åˆ†ä¸º server å±‚å’Œå­˜å‚¨å¼•æ“å±‚ã€‚</p><p>server å±‚æ¶µç›– MySQL å¤§å¤šæ•°æ ¸å¿ƒåŠŸèƒ½ï¼ˆå¦‚å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ç­‰ï¼‰å’Œæ‰€æœ‰å†…ç½®å‡½æ•°ï¼ˆå¦‚æ—¥æœŸã€æ—¶é—´ã€æ•°å­¦å‡½æ•°ç­‰ï¼‰ã€‚</p><p>å­˜å‚¨å¼•æ“å±‚è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œæå–ã€‚</p><p><code>from</code> -&gt; <code>where</code> -&gt; <code>group by</code> -&gt; <code>having</code> -&gt; <code>select</code> -&gt; <code>distinct</code> -&gt; <code>order by</code> -&gt; <code>limit</code></p><img src="/post/65a5b0d7/1726212535664-4bb3f3ff-704a-4706-84c8-a046a8486657.webp" class="" title="img"><h3 id="ä¸€æ¡-update-è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹"><a href="#ä¸€æ¡-update-è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="ä¸€æ¡ update è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹"></a>ä¸€æ¡ update è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹</h3><p>ä¸€æ¡ <code>UPDATE</code> è¯­å¥åœ¨ MySQLï¼ˆå°¤å…¶æ˜¯ InnoDB å­˜å‚¨å¼•æ“ï¼‰ä¸­çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯ä¸€ä¸ªæ¶‰åŠå¤šä¸ªç»„ä»¶ï¼ˆè§£æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå¼•æ“ã€å­˜å‚¨å¼•æ“ã€ç¼“å†²æ± ã€æ—¥å¿—ç³»ç»Ÿã€é”æœºåˆ¶ç­‰ï¼‰ååŒå·¥ä½œçš„å¤æ‚è¿‡ç¨‹ã€‚ä¸‹é¢æ˜¯å…¶æ ¸å¿ƒæ­¥éª¤çš„è¯¦ç»†åˆ†è§£ï¼š</p><ol><li><strong>è¿æ¥ä¸è¯·æ±‚æ¥æ”¶</strong></li></ol><ul><li>å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼ˆå¦‚ Java ç¨‹åºã€MySQL CLIï¼‰é€šè¿‡è¿æ¥å™¨å»ºç«‹ä¸ MySQL æœåŠ¡å™¨çš„è¿æ¥ã€‚</li><li>æœåŠ¡å™¨éªŒè¯ç”¨æˆ·èº«ä»½å’Œæƒé™ã€‚</li><li>å®¢æˆ·ç«¯å‘é€ <code>UPDATE</code> SQL è¯­å¥åˆ°æœåŠ¡å™¨ã€‚</li></ul><ol start="2"><li><strong>è§£æä¸ä¼˜åŒ–ï¼ˆServer å±‚ï¼‰</strong></li></ol><ul><li><strong>è§£æå™¨ï¼š</strong><ul><li>è¿›è¡Œè¯æ³•åˆ†æï¼šè¯†åˆ« <code>UPDATE</code>ã€è¡¨åã€<code>SET</code>ã€åˆ—åã€<code>=</code>ã€å€¼ã€<code>WHERE</code> ç­‰å…³é”®å­—å’Œæ ‡è¯†ç¬¦ã€‚</li><li>è¿›è¡Œè¯­æ³•åˆ†æï¼šæ£€æŸ¥è¯­å¥æ˜¯å¦ç¬¦åˆ SQL è¯­æ³•è§„åˆ™ï¼Œæ„å»ºæŠ½è±¡è¯­æ³•æ ‘ã€‚</li></ul></li><li><strong>é¢„å¤„ç†å™¨ï¼š</strong><ul><li>æ£€æŸ¥è¡¨å’Œåˆ—æ˜¯å¦å­˜åœ¨ã€‚</li><li>è§£æåç§°å’Œåˆ«åã€‚</li><li>æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æ‰§è¡Œ <code>UPDATE</code> çš„æƒé™ã€‚</li></ul></li><li><strong>ä¼˜åŒ–å™¨ï¼š</strong><ul><li><strong>å…³é”®æ­¥éª¤ï¼</strong> åŸºäºç»Ÿè®¡ä¿¡æ¯ï¼ˆè¡¨å¤§å°ã€ç´¢å¼•åˆ†å¸ƒã€åŸºæ•°ç­‰ï¼‰é€‰æ‹©å®ƒè®¤ä¸ºæœ€é«˜æ•ˆçš„æ‰§è¡Œè®¡åˆ’ã€‚</li><li>å†³å®šï¼š<ul><li>ä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼ˆä¸»é”®ç´¢å¼•ã€äºŒçº§ç´¢å¼•ï¼‰æ¥å®šä½éœ€è¦æ›´æ–°çš„è¡Œã€‚è¿™æ˜¯å½±å“é€Ÿåº¦çš„å…³é”®å› ç´ ã€‚</li><li>æ˜¯å¦å¯ä»¥ä½¿ç”¨ç´¢å¼•æ¡ä»¶ä¸‹æ¨ã€‚</li><li>æ˜¯å¦éœ€è¦è¿›è¡Œå…¨è¡¨æ‰«æï¼ˆå¦‚æœ <code>WHERE</code> æ¡ä»¶æ— æ³•æœ‰æ•ˆåˆ©ç”¨ç´¢å¼•ï¼‰ã€‚</li></ul></li><li>ç”Ÿæˆå…·ä½“çš„æ‰§è¡Œè®¡åˆ’ã€‚</li></ul></li></ul><ol start="3"><li><strong>æ‰§è¡Œå¼•æ“è°ƒç”¨å­˜å‚¨å¼•æ“ï¼ˆServer å±‚ -&gt; å­˜å‚¨å¼•æ“å±‚ï¼‰</strong></li></ol><ul><li>æ‰§è¡Œå¼•æ“æ ¹æ®ä¼˜åŒ–å™¨é€‰æ‹©çš„æ‰§è¡Œè®¡åˆ’ï¼Œè°ƒç”¨å­˜å‚¨å¼•æ“ï¼ˆInnoDBï¼‰æä¾›çš„æ¥å£æ¥æ‰§è¡Œå®é™…çš„æ•°æ®æŸ¥æ‰¾å’Œä¿®æ”¹æ“ä½œã€‚</li></ul><ol start="4"><li><strong>InnoDB å­˜å‚¨å¼•æ“å†…éƒ¨å¤„ç†</strong></li></ol><ul><li><strong>ç¼“å†²æ± æŸ¥æ‰¾ï¼š</strong><ul><li>æ‰§è¡Œå¼•æ“å‘ŠçŸ¥ InnoDB è¦æ›´æ–°å“ªäº›è¡Œï¼ˆé€šè¿‡ <code>WHERE</code> æ¡ä»¶å®šä½ï¼‰ã€‚</li><li>InnoDB é¦–å…ˆåœ¨ <strong>Buffer Poolï¼ˆç¼“å†²æ± ï¼‰</strong> ä¸­æŸ¥æ‰¾è¿™äº›è¡Œæ‰€åœ¨çš„æ•°æ®é¡µã€‚</li><li>å¦‚æœæ•°æ®é¡µä¸åœ¨ Buffer Pool ä¸­ï¼Œåˆ™ä»ç£ç›˜ä¸Šçš„ <code>.ibd</code> æ•°æ®æ–‡ä»¶ä¸­å°†å…¶åŠ è½½åˆ° Buffer Poolã€‚</li></ul></li><li><strong>å†™ Undo Logï¼š</strong><ul><li><strong>å…³é”®æ­¥éª¤ï¼</strong> åœ¨ä¿®æ”¹ Buffer Pool ä¸­çš„æ•°æ®é¡µ<strong>ä¹‹å‰</strong>ï¼ŒInnoDB ä¼šå…ˆå°†è¿™è¡Œæ•°æ®çš„æ—§ç‰ˆæœ¬ï¼ˆä¿®æ”¹å‰çš„çŠ¶æ€ï¼‰å†™å…¥ <strong>Undo Logï¼ˆå›æ»šæ—¥å¿—ï¼‰</strong>ã€‚</li><li><strong>ç›®çš„ï¼š</strong><ul><li>æ”¯æŒäº‹åŠ¡å›æ»šï¼šå¦‚æœäº‹åŠ¡éœ€è¦å›æ»šï¼Œå¯ä»¥ç”¨ Undo Log ä¸­çš„æ—§æ•°æ®è¦†ç›–ä¿®æ”¹ã€‚</li><li>å®ç° MVCCï¼šå…¶ä»–å¹¶å‘äº‹åŠ¡å¦‚æœéœ€è¦è¯»å–è¿™è¡Œæ•°æ®çš„æ—§ç‰ˆæœ¬ï¼ˆåŸºäºå®ƒä»¬çš„ Read Viewï¼‰ï¼Œå¯ä»¥é€šè¿‡ Undo Log é“¾æ‰¾åˆ°ã€‚</li></ul></li><li>Undo Log å­˜å‚¨åœ¨ Undo Tablespaces ä¸­ã€‚</li></ul></li><li><strong>ä¿®æ”¹ Buffer Poolï¼š</strong><ul><li>å°† Buffer Pool ä¸­å¯¹åº”çš„æ•°æ®é¡µä¸­çš„è¡Œæ•°æ®æ›´æ–°ä¸ºæ–°å€¼ã€‚</li><li>æ­¤æ—¶æ•°æ®é¡µå˜æˆ<strong>è„é¡µ</strong>ï¼ˆå†…å­˜ä¸­çš„æ•°æ®ä¸ç£ç›˜æ•°æ®ä¸ä¸€è‡´ï¼‰ã€‚</li></ul></li><li><strong>å†™ Redo Log Bufferï¼š</strong><ul><li><strong>å…³é”®æ­¥éª¤ï¼</strong> åœ¨è„é¡µåˆ·ç›˜<strong>ä¹‹å‰</strong>ï¼ŒInnoDB ä¼šå…ˆæŠŠå¯¹æ•°æ®é¡µæ‰€åšçš„ç‰©ç†ä¿®æ”¹ï¼ˆå­—èŠ‚çº§åˆ«çš„å˜åŒ–ï¼‰è®°å½•åˆ°å†…å­˜ä¸­çš„ <strong>Redo Log Bufferï¼ˆé‡åšæ—¥å¿—ç¼“å†²åŒºï¼‰</strong>ã€‚</li><li><strong>ç›®çš„ï¼š</strong> ä¿è¯äº‹åŠ¡çš„æŒä¹…æ€§ã€‚å³ä½¿ç³»ç»Ÿå´©æºƒï¼Œé‡å¯åä¹Ÿèƒ½æ ¹æ® Redo Log é‡åšæœªæŒä¹…åŒ–çš„ä¿®æ”¹ã€‚</li></ul></li><li><strong>å¤„ç†äºŒçº§ç´¢å¼•ï¼ˆå¦‚æœæ¶‰åŠï¼‰ï¼š</strong><ul><li>å¦‚æœæ›´æ–°çš„åˆ—åŒ…å«åœ¨äºŒçº§ç´¢å¼•ä¸­ï¼Œæˆ–è€…æ›´æ–°å½±å“äº†ç´¢å¼•åˆ—çš„å€¼ï¼ˆå¦‚ <code>UPDATE users SET username=&#39;new&#39; WHERE id=1</code>ï¼Œä¸” <code>username</code> ä¸Šæœ‰ç´¢å¼•ï¼‰ï¼Œåˆ™éœ€è¦æ›´æ–°å¯¹åº”çš„äºŒçº§ç´¢å¼•é¡µã€‚</li><li>æ›´æ–°äºŒçº§ç´¢å¼•é¡µåŒæ ·éµå¾ªâ€œå†™ Undo Log -&gt; ä¿®æ”¹ BP -&gt; å†™ Redo Log Bufferâ€çš„è¿‡ç¨‹ã€‚</li><li>å¦‚æœå¯ç”¨ <strong>Change Buffer</strong>ï¼Œå¯¹äºéå”¯ä¸€çš„äºŒçº§ç´¢å¼•çš„æ›´æ–°æ“ä½œï¼ˆINSERT&#x2F;DELETE&#x2F;UPDATEï¼‰ï¼Œå¯èƒ½ä¸ä¼šç«‹å³åŠ è½½ç´¢å¼•é¡µåˆ° BPï¼Œè€Œæ˜¯å…ˆå°†å˜æ›´è®°å½•åˆ° Change Buffer ä¸­ï¼Œç­‰åˆ°åç»­éœ€è¦è¯»å–è¯¥ç´¢å¼•é¡µæ—¶å†åˆå¹¶æ“ä½œï¼Œä»è€Œå‡å°‘éšæœº I&#x2F;Oã€‚</li></ul></li></ul><ol start="5"><li><strong>äº‹åŠ¡æäº¤ï¼ˆå…³é”®æ­¥éª¤ï¼ï¼‰</strong></li></ol><ul><li>å½“ç”¨æˆ·æ˜¾å¼æ‰§è¡Œ <code>COMMIT</code> æˆ–è‡ªåŠ¨æäº¤å¼€å¯æ—¶ï¼Œäº‹åŠ¡è¿›å…¥æäº¤é˜¶æ®µã€‚</li><li><strong>Write Redo Logï¼š</strong><ul><li><strong>ä¸¤é˜¶æ®µæäº¤çš„æ ¸å¿ƒç¬¬ä¸€æ­¥ï¼š</strong> å°† Redo Log Buffer ä¸­ä¸è¯¥äº‹åŠ¡ç›¸å…³çš„æ‰€æœ‰æ—¥å¿—è®°å½•<strong>é¡ºåºã€å¿«é€Ÿ</strong>åœ°å†™å…¥ï¼ˆ<code>write()</code> ç³»ç»Ÿè°ƒç”¨ï¼‰ç£ç›˜ä¸Šçš„ <strong>Redo Log Fileï¼ˆé€šå¸¸æ˜¯ <code>ib_logfile0</code>, <code>ib_logfile1</code>ï¼‰</strong>ã€‚æ­¤æ—¶æ•°æ®å¯èƒ½è¿˜åœ¨å†…å­˜ï¼ˆBuffer Poolï¼‰ã€‚</li><li><strong><code>fsync()</code>ï¼š</strong> ä¸ºäº†ç¡®ä¿æ—¥å¿—çœŸæ­£è½ç›˜ï¼ˆé˜²æ­¢æ“ä½œç³»ç»Ÿç¼“å­˜ä¸¢å¤±ï¼‰ï¼Œé€šå¸¸éœ€è¦è°ƒç”¨ <code>fsync()</code>ï¼ˆæˆ–é…ç½®å†³å®šçš„ç±»ä¼¼æœºåˆ¶ï¼‰å¼ºåˆ¶å°†æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ä¸­çš„æ—¥å¿—æ•°æ®åˆ·åˆ°ç‰©ç†ç£ç›˜ã€‚<strong>è¿™æ˜¯ä¿è¯æŒä¹…æ€§ï¼ˆDï¼‰çš„å…³é”®ç‚¹ï¼Œä¹Ÿæ˜¯ç›¸å¯¹è€—æ—¶çš„æ“ä½œã€‚</strong></li></ul></li><li><strong>å†™ Binlogï¼ˆå¦‚æœå¯ç”¨ï¼‰ï¼š</strong><ul><li>åœ¨å†™å…¥ Redo Log <strong>ä¹‹å</strong>ï¼ˆåœ¨ç»„æäº¤ä¼˜åŒ–ä¸‹é¡ºåºå¯èƒ½ä¸åŒï¼Œä½†é€»è¾‘ä¸Š Redo Prepare åœ¨ Binlog ä¹‹å‰ï¼‰ï¼ŒServer å±‚ä¼šå°†æ›´æ–°æ“ä½œçš„é€»è¾‘è¯­å¥æˆ–è¡Œå˜æ›´å†™å…¥ <strong>Binlogï¼ˆäºŒè¿›åˆ¶æ—¥å¿—ï¼‰</strong>ã€‚Binlog ç”¨äºä¸»ä»å¤åˆ¶å’Œæ•°æ®æ¢å¤ã€‚</li><li>åŒæ ·éœ€è¦ <code>fsync()</code> ç¡®ä¿ Binlog è½ç›˜ï¼ˆå–å†³äº <code>sync_binlog</code> é…ç½®ï¼‰ã€‚</li></ul></li><li><strong>Redo Log Commitï¼š</strong><ul><li><strong>ä¸¤é˜¶æ®µæäº¤çš„æ ¸å¿ƒç¬¬äºŒæ­¥ï¼š</strong> åœ¨ Binlog æˆåŠŸå†™å…¥å¹¶ <code>fsync()</code> åï¼ŒInnoDB åœ¨ Redo Log ä¸­å†™å…¥ä¸€ä¸ªç‰¹æ®Šçš„ <strong>Commit Record</strong>ï¼Œæ ‡è®°è¯¥äº‹åŠ¡<strong>å·²æäº¤</strong>ã€‚</li><li>å†æ¬¡ <code>fsync()</code> Redo Logï¼ˆå¦‚æœé…ç½®éœ€è¦ï¼‰ã€‚</li></ul></li><li><strong>é‡Šæ”¾é”ï¼š</strong> äº‹åŠ¡æäº¤åï¼ŒInnoDB é‡Šæ”¾è¯¥äº‹åŠ¡æŒæœ‰çš„æ‰€æœ‰é”ï¼ˆè¡Œé”ã€é—´éš™é”ç­‰ï¼‰ã€‚</li><li><strong>è¿”å›æˆåŠŸï¼š</strong> å‘å®¢æˆ·ç«¯è¿”å›æ‰§è¡ŒæˆåŠŸçš„æ¶ˆæ¯ã€‚</li></ul><ol start="6"><li><strong>åå°åˆ·è„é¡µ</strong></li></ol><ul><li><strong>éåŒæ­¥æ“ä½œï¼</strong> æäº¤æˆåŠŸ<strong>å¹¶ä¸ä¿è¯</strong>è„é¡µç«‹å³å†™å…¥ç£ç›˜æ•°æ®æ–‡ä»¶ï¼ˆ<code>.ibd</code>ï¼‰ã€‚å†™å…¥ Redo Log å·²ç»ä¿è¯äº†æŒä¹…æ€§ã€‚</li><li>InnoDB æœ‰åå°çº¿ç¨‹ï¼ˆPage Cleaner Threadï¼‰è´Ÿè´£åœ¨ä»¥ä¸‹æ—¶æœºå°†è„é¡µå¼‚æ­¥åˆ·æ–°å›ç£ç›˜ï¼š<ul><li>å½“ Buffer Pool ä¸­è„é¡µæ¯”ä¾‹è¿‡é«˜æ—¶ï¼ˆç”± <code>innodb_max_dirty_pages_pct</code> ç­‰å‚æ•°æ§åˆ¶ï¼‰ã€‚</li><li>å½“ç³»ç»Ÿç©ºé—²æ—¶ã€‚</li><li>å½“ Redo Log ç©ºé—´å³å°†ç”¨å®Œæ—¶ï¼ˆéœ€è¦å›æ”¶æ—§çš„ Redo Log ç©ºé—´ï¼Œè¿™è¦æ±‚å¯¹åº”çš„è„é¡µå¿…é¡»å…ˆåˆ·ç›˜ï¼‰ã€‚</li><li>å…³é—­æ•°æ®åº“æ—¶ã€‚</li></ul></li><li>åˆ·è„é¡µæ—¶ï¼Œä¼šåˆ©ç”¨ Doublewrite Buffer æœºåˆ¶æ¥é¿å…éƒ¨åˆ†å†™å¤±è´¥å¯¼è‡´çš„æ•°æ®é¡µæŸåã€‚</li></ul><p><strong>å…³é”®ç‚¹ä¸æ³¨æ„äº‹é¡¹</strong></p><ol><li><strong>Buffer Pool æ ¸å¿ƒä½œç”¨ï¼š</strong> æ‰€æœ‰æ•°æ®è¯»å†™éƒ½å‘ç”Ÿåœ¨å†…å­˜ï¼ˆBuffer Poolï¼‰ï¼Œæå¤§æå‡æ€§èƒ½ã€‚</li><li><strong>WAL æœºåˆ¶ï¼š</strong> Write-Ahead Logging (Redo Log) æ˜¯ä¿è¯æŒä¹…æ€§å’Œå´©æºƒæ¢å¤çš„æ ¸å¿ƒã€‚å…ˆå†™æ—¥å¿—ï¼ˆé¡ºåºå†™ï¼Œå¿«ï¼‰ï¼Œååˆ·è„é¡µï¼ˆéšæœºå†™ï¼Œæ…¢ï¼‰ã€‚</li><li><strong>ä¸¤é˜¶æ®µæäº¤ï¼š</strong> åè°ƒ Redo Log å’Œ Binlog çš„å†™å…¥ï¼Œä¿è¯è¿™ä¸¤ä¸ªå…³é”®æ—¥å¿—åœ¨å´©æºƒæ—¶çŠ¶æ€ä¸€è‡´ï¼Œæ˜¯æ•°æ®ä¸€è‡´æ€§å’Œä¸»ä»å¤åˆ¶çš„åŸºçŸ³ã€‚</li><li><strong>Undo Log ä¸ MVCCï¼š</strong> Undo Log æ”¯æŒå›æ»šå’Œå®ç°éé”å®šè¯»ï¼ˆMVCCï¼‰ï¼Œæ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶çš„å…³é”®ã€‚</li><li><strong>Change Bufferï¼š</strong> ä¼˜åŒ–éå”¯ä¸€äºŒçº§ç´¢å¼•æ›´æ–°çš„åˆ©å™¨ï¼Œå‡å°‘éšæœº I&#x2F;Oã€‚</li><li><strong>é”æœºåˆ¶ï¼š</strong> InnoDB åœ¨æŸ¥æ‰¾å’Œæ›´æ–°è¡Œæ—¶ä¼šåŠ é”ï¼ˆè¡Œé”ã€é—´éš™é”ç­‰ï¼‰ï¼Œä»¥ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ€§ã€‚é”åœ¨äº‹åŠ¡æäº¤æˆ–å›æ»šæ—¶é‡Šæ”¾ã€‚</li><li><strong>å¼‚æ­¥åˆ·ç›˜ï¼š</strong> æ•°æ®æ–‡ä»¶ï¼ˆ.ibdï¼‰çš„å†™å…¥æ˜¯å¼‚æ­¥çš„ï¼Œä¾èµ–äº Redo Log ä¿è¯æŒä¹…æ€§ã€‚</li><li><strong>æ€§èƒ½ç“¶é¢ˆï¼š</strong> <code>UPDATE</code> æ€§èƒ½å—ç´¢å¼•ä½¿ç”¨ã€é”ç«äº‰ã€Redo Log&#x2F;Binlog åˆ·ç›˜ç­–ç•¥ã€ç£ç›˜ I&#x2F;O èƒ½åŠ›ç­‰å› ç´ å½±å“ã€‚</li></ol><h3 id="InnoDBç´¢å¼•ç»“æ„"><a href="#InnoDBç´¢å¼•ç»“æ„" class="headerlink" title="InnoDBç´¢å¼•ç»“æ„"></a>InnoDBç´¢å¼•ç»“æ„</h3><p>Bæ ‘ç»“æ„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">       [10 | 20]</span><br><span class="line">      /    |     \</span><br><span class="line">[5|8]  [12|15|18]  [25|30]</span><br></pre></td></tr></table></figure><p>ç‰¹å¾ï¼š</p><ul><li>æ‰€æœ‰èŠ‚ç‚¹éƒ½å­˜å‚¨å®Œæ•´æ•°æ®</li><li>æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåŒ…æ¶µ m-1 ä¸ªé”®å€¼å’Œ m ä¸ªå­èŠ‚ç‚¹</li></ul><p>B+æ ‘ç»“æ„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">               [15]</span><br><span class="line">              /    \</span><br><span class="line">     [10|15]          [20|25]</span><br><span class="line">     /     \          /     \ </span><br><span class="line">[10|...]â†’[15|...]â†’[20|...]â†’[25|...]ï¼ˆå¶å­èŠ‚ç‚¹é“¾è¡¨ï¼‰</span><br></pre></td></tr></table></figure><p>ç‰¹å¾ï¼š</p><ul><li>åªæœ‰å¶å­èŠ‚ç‚¹å­˜å‚¨å®Œæ•´æ•°æ®ï¼Œå†…éƒ¨èŠ‚ç‚¹åªå­˜å‚¨ç´¢å¼•</li><li>å¶å­èŠ‚ç‚¹é€šè¿‡åŒå‘é“¾è¡¨è¿æ¥ï¼Œæ”¯æŒé«˜æ•ˆèŒƒå›´æŸ¥è¯¢</li><li>ç›¸åŒç£ç›˜é¡µå¯ä»¥å­˜å‚¨æ›´å¤šç´¢å¼•ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡</li></ul><p><strong>InnoDBé€‰æ‹©B+æ ‘çš„7å¤§å…³é”®åŸå› </strong></p><table><thead><tr><th align="left"><strong>å¯¹æ¯”ç»´åº¦</strong></th><th align="left"><strong>Bæ ‘</strong></th><th align="left"><strong>B+æ ‘</strong></th><th align="left"><strong>InnoDBä¼˜åŠ¿ä½“ç°</strong></th></tr></thead><tbody><tr><td align="left"><strong>æ•°æ®å­˜å‚¨ä½ç½®</strong></td><td align="left">æ‰€æœ‰èŠ‚ç‚¹å­˜å‚¨æ•°æ®</td><td align="left">ä»…å¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®</td><td align="left">å‡å°‘ç£ç›˜IOæ¬¡æ•°</td></tr><tr><td align="left"><strong>æ ‘é«˜åº¦</strong></td><td align="left">è¾ƒé«˜ï¼ˆæ•°æ®åˆ†æ•£å­˜å‚¨ï¼‰</td><td align="left">è¾ƒä½ï¼ˆå†…éƒ¨èŠ‚ç‚¹çº¯ç´¢å¼•ï¼‰</td><td align="left">3å±‚B+æ ‘å¯æ”¯æ’‘åƒä¸‡çº§æ•°æ®</td></tr><tr><td align="left"><strong>èŒƒå›´æŸ¥è¯¢</strong></td><td align="left">éœ€è¦å›æº¯çˆ¶èŠ‚ç‚¹</td><td align="left">é€šè¿‡å¶å­é“¾è¡¨é¡ºåºæ‰«æ</td><td align="left"><code>WHERE id &gt; 100</code> æ•ˆç‡æå‡10å€+</td></tr><tr><td align="left"><strong>å…¨è¡¨æ‰«æ</strong></td><td align="left">éœ€éå†æ•´æ£µæ ‘</td><td align="left">ç›´æ¥é¡ºåºéå†å¶å­èŠ‚ç‚¹é“¾è¡¨</td><td align="left">å…¨è¡¨æ‰«æé€Ÿåº¦æ¥è¿‘é¡ºåºè¯»</td></tr><tr><td align="left"><strong>ç£ç›˜åˆ©ç”¨ç‡</strong></td><td align="left">èŠ‚ç‚¹åŒ…å«æ•°æ®å¯¼è‡´å­˜å‚¨é”®å€¼æ•°å°‘</td><td align="left">å•é¡µå¯å­˜å‚¨æ›´å¤šé”®å€¼ï¼ˆé«˜åˆ†æ”¯å› å­ï¼‰</td><td align="left">ç›¸åŒæ•°æ®é‡å‡å°‘30%-50%æ ‘é«˜åº¦</td></tr><tr><td align="left"><strong>æ•°æ®æ›´æ–°ä»£ä»·</strong></td><td align="left">å¯èƒ½å¼•èµ·å¤æ‚ç»“æ„è°ƒæ•´</td><td align="left">æ’å…¥åˆ é™¤å¤šæ•°æƒ…å†µåªéœ€å±€éƒ¨è°ƒæ•´</td><td align="left">æ”¯æŒæ›´é«˜å¹¶å‘å†™å…¥</td></tr><tr><td align="left"><strong>ç¼“å­˜å‘½ä¸­ç‡</strong></td><td align="left">çƒ­ç‚¹æ•°æ®åˆ†æ•£åœ¨ä¸åŒå±‚çº§</td><td align="left">å¶å­èŠ‚ç‚¹é›†ä¸­å­˜å‚¨æ‰€æœ‰æ•°æ®</td><td align="left">Buffer Poolåˆ©ç”¨ç‡æå‡40%+</td></tr></tbody></table><h3 id="ä¸ºä»€ä¹ˆMongoDBä½¿ç”¨Bæ ‘è€ŒMySQLç”¨B-æ ‘"><a href="#ä¸ºä»€ä¹ˆMongoDBä½¿ç”¨Bæ ‘è€ŒMySQLç”¨B-æ ‘" class="headerlink" title="ä¸ºä»€ä¹ˆMongoDBä½¿ç”¨Bæ ‘è€ŒMySQLç”¨B+æ ‘"></a>ä¸ºä»€ä¹ˆMongoDBä½¿ç”¨Bæ ‘è€ŒMySQLç”¨B+æ ‘</h3><p>MongoDBé¢å‘æ–‡æ¡£å­˜å‚¨ï¼Œéœ€å¿«é€Ÿè·å–æ•´ä¸ªæ–‡æ¡£ï¼ˆBæ ‘çš„å†…éƒ¨èŠ‚ç‚¹å­˜å‚¨å®Œæ•´æ•°æ®ï¼Œå¯ä»¥å‡å°‘å¯»å€æ¬¡æ•°ï¼‰</p><p>MySQLä¾§é‡èŒƒå›´æŸ¥è¯¢å’Œäº‹åŠ¡å¤„ç†ï¼ˆB+æ ‘çš„é¡ºåºè®¿é—®ç‰¹æ€§æ›´ä¼˜ç§€ï¼‰</p><h3 id="B-æ ‘èŠ‚ç‚¹åˆ†è£‚çš„å…·ä½“è¿‡ç¨‹"><a href="#B-æ ‘èŠ‚ç‚¹åˆ†è£‚çš„å…·ä½“è¿‡ç¨‹" class="headerlink" title="B+æ ‘èŠ‚ç‚¹åˆ†è£‚çš„å…·ä½“è¿‡ç¨‹"></a>B+æ ‘èŠ‚ç‚¹åˆ†è£‚çš„å…·ä½“è¿‡ç¨‹</h3><p>InnoDBä¼˜åŒ–ï¼šé¢„ç•™1&#x2F;16é¡µç©ºé—´é¿å…é¢‘ç¹åˆ†è£‚</p><p><strong>ç´¢å¼•è®¾è®¡åŸåˆ™</strong></p><ul><li>å‰ç¼€ç´¢å¼•ä¼˜åŒ–</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ADD</span> INDEX (name(<span class="number">10</span>));</span><br></pre></td></tr></table></figure><ul><li>è¦†ç›–ç´¢å¼•ä¼˜åŒ–</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºåŒ…å«æ‰€æœ‰æŸ¥è¯¢å­—æ®µçš„ç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_cover <span class="keyword">ON</span> orders(user_id, status, create_time);</span><br></pre></td></tr></table></figure><p><strong>ç›‘æ§å·¥å…·ä½¿ç”¨</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sys.schema_index_statistics;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ†æç´¢å¼•æ•ˆç‡</span></span><br><span class="line">EXPLAIN ANALYZE <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> products <span class="keyword">WHERE</span> category_id<span class="operator">=</span><span class="number">5</span>;</span><br></pre></td></tr></table></figure><p><strong>ç»´æŠ¤ç­–ç•¥</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å®šæœŸä¼˜åŒ–è¡¨ï¼ˆé‡å»ºç´¢å¼•ï¼‰</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> orders ENGINE<span class="operator">=</span>InnoDB;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ç›‘æ§é¡µåˆ†è£‚æ¬¡æ•°</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;Innodb_page_splits%&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="EXPLAIN-å­—æ®µè¯´æ˜"><a href="#EXPLAIN-å­—æ®µè¯´æ˜" class="headerlink" title="EXPLAIN å­—æ®µè¯´æ˜"></a><code>EXPLAIN</code> å­—æ®µè¯´æ˜</h3><p>é€šå¸¸<code>EXPALIN</code>æŸ¥è¯¢è¯­å¥çš„è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="comment">// æ¯ä¸ªselectè¯­å¥å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„id</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢ç±»å‹ï¼š</span></span><br><span class="line"><span class="comment">     * SIMPLEï¼šä¸åŒ…å«UNIONæˆ–å­æŸ¥è¯¢çš„selectï¼ˆè¿æ¥æŸ¥è¯¢çš„æ¯ä¸ªæŸ¥è¯¢éƒ½æ˜¯simpleæŸ¥è¯¢ï¼‰</span></span><br><span class="line"><span class="comment">     * PRIMARYï¼šæœ€å¤–å±‚æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * UNION</span></span><br><span class="line"><span class="comment">     * ...</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">&quot;select_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;SIMPLE&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;table&quot;</span><span class="punctuation">:</span> <span class="string">&quot;users&quot;</span><span class="punctuation">,</span> <span class="comment">// è¦æŸ¥è¯¢çš„è¡¨</span></span><br><span class="line">    <span class="attr">&quot;partitions&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span> <span class="comment">// åˆ†åŒºä¿¡æ¯</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é’ˆå¯¹å•è¡¨çš„è®¿é—®æ–¹æ³•ï¼š</span></span><br><span class="line"><span class="comment">     * systemï¼šå½“è¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•ï¼Œå¹¶ä¸”è¯¥è¡¨ä½¿ç”¨çš„å­˜å‚¨å¼•æ“çš„ç»Ÿè®¡æ•°æ®æ˜¯ç²¾ç¡®çš„ï¼Œè®¿é—®æ–¹æ³•å°±æ˜¯system</span></span><br><span class="line"><span class="comment">     * constantï¼šæ ¹æ®ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•åˆ—ä¸å¸¸æ•°è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ï¼Œè®¿é—®æ–¹æ³•å°±æ˜¯const</span></span><br><span class="line"><span class="comment">     * eq_refï¼šè¿æ¥æŸ¥è¯¢ä¸­å¯¹è¢«é©±åŠ¨è¡¨çš„ä¸»é”®æˆ–ä¸å…è®¸ä¸ºNULLçš„å”¯ä¸€ç´¢å¼•è¿›è¡Œç­‰å€¼æŸ¥è¯¢æ—¶ï¼Œè®¿é—®æ–¹æ³•å°±æ˜¯eq_ref</span></span><br><span class="line"><span class="comment">     * refï¼šé€šè¿‡æ™®é€šäºŒçº§ç´¢å¼•åˆ—ä¸å¸¸é‡è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ï¼Œå¯¹è¯¥è¡¨çš„è®¿é—®æ–¹æ³•å°±æ˜¯ ref</span></span><br><span class="line"><span class="comment">     * ref_or_nullï¼šselect * from single_table where key1 = &#x27;abc&#x27; or key1 is NULL;</span></span><br><span class="line"><span class="comment">     * index_mergeï¼šä½¿ç”¨å¤šä¸ªç´¢å¼•è¿›è¡Œç­‰å€¼åŒ¹é…</span></span><br><span class="line"><span class="comment">     * unique_subqueryï¼šåœ¨å­æŸ¥è¯¢ä¸­ä½¿ç”¨ä¸»é”®æˆ–ä¸å…è®¸å­˜å‚¨NULLå€¼çš„å”¯ä¸€äºŒçº§ç´¢å¼•è¿›è¡Œç­‰å€¼åŒ¹é…</span></span><br><span class="line"><span class="comment">     * index_subqueryï¼šåœ¨å­æŸ¥è¯¢ä¸­ä½¿ç”¨æ™®é€šäºŒçº§ç´¢å¼•è¿›è¡Œç­‰å€¼åŒ¹</span></span><br><span class="line"><span class="comment">     * rangeï¼šåˆ©ç”¨ç´¢å¼•è¿›è¡ŒèŒƒå›´æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * indexï¼šå½“å¯ä»¥ä½¿ç”¨ç´¢å¼•è¦†ç›–ï¼Œä½†éœ€è¦æ‰«æå…¨éƒ¨ç´¢å¼•è®°å½•</span></span><br><span class="line"><span class="comment">     * allï¼šå…¨è¡¨æ‰«æ</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ref&quot;</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="attr">&quot;possible_keys&quot;</span><span class="punctuation">:</span> <span class="string">&quot;idx_composite&quot;</span><span class="punctuation">,</span> <span class="comment">// å¯èƒ½ä½¿ç”¨çš„ç´¢å¼•</span></span><br><span class="line">    <span class="attr">&quot;key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;idx_composite&quot;</span><span class="punctuation">,</span> <span class="comment">// å®é™…ä½¿ç”¨çš„ç´¢å¼•</span></span><br><span class="line">    <span class="attr">&quot;key_len&quot;</span><span class="punctuation">:</span> <span class="string">&quot;208&quot;</span><span class="punctuation">,</span> <span class="comment">// å®é™…ä½¿ç”¨çš„ç´¢å¼•é•¿åº¦</span></span><br><span class="line">    <span class="attr">&quot;ref&quot;</span><span class="punctuation">:</span> <span class="string">&quot;const&quot;</span><span class="punctuation">,</span> <span class="comment">// ä½¿ç”¨ç´¢å¼•åˆ—ç­‰å€¼æŸ¥è¯¢æ—¶ï¼Œä¸ç´¢å¼•åˆ—è¿›è¡Œç­‰å€¼åŒ¹é…çš„å¯¹è±¡ä¿¡æ¯</span></span><br><span class="line">    <span class="attr">&quot;rows&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span> <span class="comment">// é¢„ä¼°éœ€è¦è¯»å–çš„è®°å½•è¡Œæ•°</span></span><br><span class="line">    <span class="attr">&quot;filtered&quot;</span><span class="punctuation">:</span> <span class="number">100.0</span><span class="punctuation">,</span> <span class="comment">// è¿‡æ»¤åå‰©ä½™è®°å½•è¡Œæ•°ç™¾åˆ†æ¯”</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é¢å¤–ä¿¡æ¯ï¼š</span></span><br><span class="line"><span class="comment">     * Using indexï¼šä½¿ç”¨è¦†ç›–ç´¢å¼•</span></span><br><span class="line"><span class="comment">     * Using index conditionï¼šä½¿ç”¨ç´¢å¼•æ¡ä»¶ä¸‹æ¨</span></span><br><span class="line"><span class="comment">     * Using whereï¼šéœ€è¦åœ¨serverå±‚åˆ¤æ–­æ¡ä»¶æ˜¯å¦æˆç«‹</span></span><br><span class="line"><span class="comment">     * Using join bufferï¼šæ‰§è¡Œè¿æ¥æŸ¥è¯¢æ—¶ï¼Œè¢«é©±åŠ¨è¡¨ä¸èƒ½æœ‰æ•ˆåˆ©ç”¨ç´¢å¼•åŠ å¿«è®¿é—®é€Ÿåº¦æ—¶ï¼Œä¼šåˆ†é…ä¸€å—å†…å­˜ç”¨æ¥ä¿å­˜è¢«é©±åŠ¨è¡¨çš„æŸ¥è¯¢ç»“æœï¼Œ</span></span><br><span class="line"><span class="comment">       åˆ©ç”¨join bufferå¯ä»¥å‡å°‘è®¿é—®è¢«é©±åŠ¨è¡¨çš„æ¬¡æ•°</span></span><br><span class="line"><span class="comment">     * Using filesortï¼š</span></span><br><span class="line"><span class="comment">     * Using temporary</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">&quot;Extra&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Using index&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><h3 id="è¦†ç›–ç´¢å¼•ä¸æœ€å·¦å‰ç¼€åŸåˆ™å®æˆ˜æ¡ˆä¾‹"><a href="#è¦†ç›–ç´¢å¼•ä¸æœ€å·¦å‰ç¼€åŸåˆ™å®æˆ˜æ¡ˆä¾‹" class="headerlink" title="è¦†ç›–ç´¢å¼•ä¸æœ€å·¦å‰ç¼€åŸåˆ™å®æˆ˜æ¡ˆä¾‹"></a>è¦†ç›–ç´¢å¼•ä¸æœ€å·¦å‰ç¼€åŸåˆ™å®æˆ˜æ¡ˆä¾‹</h3><p><strong>å›è¡¨</strong>ï¼šæŸ¥è¯¢éœ€è¦çš„å­—æ®µæ²¡æœ‰å…¨éƒ¨åŒ…å«åœ¨ç´¢å¼•ä¸­ï¼Œéœ€è¦æ ¹æ®ç´¢å¼•æ‰¾åˆ°ä¸»é”®ï¼Œå†ä»ä¸»é”®ç´¢å¼•ä¸­æ‰¾åˆ°å®Œæ•´æ•°æ®æ‰èƒ½è·å–æ‰€éœ€å­—æ®µã€‚</p><p><strong>è¦†ç›–ç´¢å¼•</strong>ï¼šæŸ¥è¯¢æ‰€éœ€çš„å­—æ®µéƒ½åŒ…å«åœ¨ç´¢å¼•ä¸­ï¼Œæ— éœ€å›è¡¨æ“ä½œã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li>å‡å°‘IOæ“ä½œ</li><li>é¿å…å›è¡¨ï¼ˆå‡å°‘éšæœºè¯»ï¼‰</li></ul><p><strong>æœ€å·¦å‰ç¼€åŸåˆ™</strong>ï¼šå¤åˆç´¢å¼• <code>(a, b, c)</code> çš„æŸ¥è¯¢æ¡ä»¶å¿…é¡»ä»æœ€å·¦åˆ—å¼€å§‹ï¼Œä¸”ä¸èƒ½è·³è¿‡ä¸­é—´åˆ—æ‰èƒ½å‘½ä¸­ç´¢å¼•ã€‚</p><p>å…·ä½“è§„åˆ™ï¼š</p><ul><li>ç­‰å€¼æŸ¥è¯¢ï¼š<code>WHERE a = 1 and b = 2</code> â†’ å‘½ä¸­ç´¢å¼•</li><li>èŒƒå›´æŸ¥è¯¢ï¼š<code>WHERE a &gt; 1 and b = 2</code> â†’ ä»…èƒ½å‘½ä¸­ <code>a</code> åˆ—</li><li>è·³è·ƒæŸ¥è¯¢ï¼š<code>WHERE b = 2 and c = 3</code> â†’ ä¸èƒ½èƒ½å‘½ä¸­ç´¢å¼•</li></ul><p>è¦†ç›–ç´¢å¼•ä¼˜åŒ–ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `users` (</span><br><span class="line">`id` <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">`name` <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">`age` <span class="type">INT</span>,</span><br><span class="line">`city` <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">`created_at` DATETIME,</span><br><span class="line">KEY `idx_composite` (`city`, `age`, `created_at`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢éœ€æ±‚ï¼šç»Ÿè®¡åŒ—äº¬25å²ç”¨æˆ·çš„æ•°é‡</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> city<span class="operator">=</span><span class="string">&#x27;åŒ—äº¬&#x27;</span> <span class="keyword">AND</span> age<span class="operator">=</span><span class="number">25</span>;</span><br></pre></td></tr></table></figure><img src="/post/65a5b0d7/image-20250302111116621.png" class="" title="image-20250302111116621"><p>ä¹‹å‰çš„ç‰ˆæœ¬<code>Extra</code>ä¸­åº”è¯¥æ˜¯<code>Using where</code>ï¼Œå› ä¸ºéœ€è¦å›è¡¨ç¡®è®¤æ•°æ®æ˜¯å¦å­˜åœ¨ã€‚</p><p>ä¼˜åŒ–æ–¹æ¡ˆï¼šæ·»åŠ è¦†ç›–ç´¢å¼•è¦†ç›–ç»Ÿè®¡éœ€è¦çš„æ‰€æœ‰å­—æ®µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> users <span class="keyword">ADD</span> INDEX idx_covering(city, age, id);</span><br></pre></td></tr></table></figure><p>æœ€å·¦å‰ç¼€ç´¢å¼•ä¼˜åŒ–</p><p>æŸ¥è¯¢éœ€æ±‚ï¼šæŸ¥è¯¢åŒ—äº¬åœ°åŒºå¹´é¾„å¤§äº 30 å²çš„ç”¨æˆ·ï¼Œå¹¶æŒ‰æ³¨å†Œæ—¶é—´æ’åº</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> city<span class="operator">=</span><span class="string">&#x27;åŒ—äº¬&#x27;</span> <span class="keyword">AND</span> age<span class="operator">&gt;</span> <span class="number">30</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> created_at LIMIT <span class="number">10</span>;</span><br></pre></td></tr></table></figure><img src="/post/65a5b0d7/image-20250302111551681.png" class="" title="image-20250302111551681"><p>ä»<code>EXPLAIN</code>ç»“æœå¯ä»¥çœ‹å‡ºï¼Œè¿™æ¡æŸ¥è¯¢è¯­å¥éœ€è¦ç”¨åˆ°è€—æ—¶çš„æ–‡ä»¶æ’åºï¼Œè¿™æ˜¯å› ä¸ºæŸ¥è¯¢æ¡ä»¶ä¸­å­˜åœ¨èŒƒå›´æŸ¥è¯¢ï¼Œå¯¼è‡´ä¸èƒ½å®Œå…¨åˆ©ç”¨ä¸Šç»„åˆç´¢å¼•ã€‚</p><p>ä¼˜åŒ–æ–¹æ¡ˆï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> users <span class="keyword">ADD</span> INDEX idx_city_created_age(city, created_at, age);</span><br></pre></td></tr></table></figure><img src="/post/65a5b0d7/image-20250302112330725.png" class="" title="image-20250302112330725"><p>ç´¢å¼•è®¾è®¡è§„èŒƒï¼š</p><ul><li>ç»„åˆç´¢å¼•å­—æ®µæŒ‰åŒºåˆ†åº¦ä»é«˜åˆ°ä½æ’åº</li><li>ç´¢å¼•åˆ—æ•°â‰¤5åˆ—ï¼Œé¿å…æ›´æ–°å¼€é”€å¤ªå¤§</li><li>ç¦æ­¢<code>SELECT *</code>ï¼Œå°½é‡æŸ¥è¯¢ç´¢å¼•èƒ½è¦†ç›–çš„å­—æ®µ</li></ul><h3 id="æ…¢æŸ¥è¯¢ä¼˜åŒ–"><a href="#æ…¢æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="æ…¢æŸ¥è¯¢ä¼˜åŒ–"></a>æ…¢æŸ¥è¯¢ä¼˜åŒ–</h3><p>æ…¢æŸ¥è¯¢ä¼˜åŒ–æµç¨‹ï¼š</p><ol><li>æŠ“å–æ…¢æ—¥å¿—ï¼š<code>long_query_time=1s</code></li><li><code>EXPLAIN</code> åˆ†ææ‰§è¡Œè®¡åˆ’</li><li>æ£€æŸ¥ç´¢å¼•ä½¿ç”¨æƒ…å†µ<ul><li>æ˜¯å¦è§¦å‘è¦†ç›–ç´¢å¼•</li><li>æ˜¯å¦è¿åæœ€å·¦å‰ç¼€åŸåˆ™</li></ul></li><li>ä½¿ç”¨<code>force index</code>éªŒè¯ç´¢å¼•æœ‰æ•ˆæ€§</li><li>è°ƒæ•´ç´¢å¼•æˆ–SQLå†™æ³•</li></ol><ul><li>ç´¢å¼•ä¼˜åŒ–</li><li>ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œé¿å…å›è¡¨</li><li>æœ€å·¦å‰ç¼€åŒ¹é…ï¼Œ</li></ul><p>ç›‘æ§æŒ‡æ ‡</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨é¢‘ç‡</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sys.schema_index_statistics <span class="keyword">WHERE</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æ£€æŸ¥å†—ä½™ç´¢å¼•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sys.schema_redundant_indexes;</span><br></pre></td></tr></table></figure><h3 id="ä¸ºä»€ä¹ˆInnoDBä¸ä¿å­˜è¡¨çš„æ€»è¡Œæ•°"><a href="#ä¸ºä»€ä¹ˆInnoDBä¸ä¿å­˜è¡¨çš„æ€»è¡Œæ•°" class="headerlink" title="ä¸ºä»€ä¹ˆInnoDBä¸ä¿å­˜è¡¨çš„æ€»è¡Œæ•°"></a>ä¸ºä»€ä¹ˆInnoDBä¸ä¿å­˜è¡¨çš„æ€»è¡Œæ•°</h3><p>ä¸MyISAMä¿å­˜è¡¨çš„æ€»è¡Œæ•°ä¸åŒï¼ŒInnoDBç»Ÿè®¡è¡Œæ•°éœ€è¦æ‰«æå…¨è¡¨ï¼Œå› ä¸ºMVCCï¼ŒåŒä¸€æ—¶åˆ»å¤šä¸ªæŸ¥è¯¢è¿”å›çš„è¡Œæ•°å¯èƒ½ä¸ä¸€è‡´ã€‚</p><p>å¯¹äºéœ€è¦ç»å¸¸ç»Ÿè®¡è¡¨çš„è¡Œæ•°çš„è§£å†³åŠæ³•ï¼š</p><ul><li>åœ¨ç¼“å­˜ï¼ˆå¦‚ Redisï¼‰ä¸­ä¿å­˜è®¡æ•°</li><li>åœ¨ MySQL ä¸­ä¿å­˜è®¡æ•°</li></ul><table><thead><tr><th><strong>è¯­æ³•</strong></th><th><strong>ç»Ÿè®¡é€»è¾‘</strong></th><th><strong>æ˜¯å¦åŒ…å« NULL</strong></th></tr></thead><tbody><tr><td><code>COUNT(*)</code></td><td>ç»Ÿè®¡æ‰€æœ‰è¡Œï¼ˆåŒ…æ‹¬æ‰€æœ‰åˆ—ï¼‰ï¼Œå³ä½¿æ‰€æœ‰å­—æ®µéƒ½ä¸º <code>NULL</code> ä¹Ÿä¼šè®¡æ•°</td><td><strong>åŒ…å«</strong></td></tr><tr><td><code>COUNT(1)</code></td><td>ç»Ÿè®¡æ‰€æœ‰è¡Œï¼ˆ<code>1</code> æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œä¸åˆ—æ— å…³ï¼‰</td><td><strong>åŒ…å«</strong></td></tr><tr><td><code>COUNT(id)</code></td><td>ç»Ÿè®¡ <code>id</code> åˆ—ä¸­ <strong>é NULL</strong> çš„è¡Œæ•°ï¼ˆ<code>id</code> æ˜¯ä¸»é”®æˆ–æ™®é€šåˆ—ï¼‰</td><td><strong>ä¸åŒ…å« NULL</strong></td></tr><tr><td><code>COUNT(æŸä¸ªå­—æ®µ)</code></td><td>ç»Ÿè®¡è¯¥å­—æ®µä¸­ <strong>é NULL</strong> çš„è¡Œæ•°ï¼ˆå¦‚æœå­—æ®µå…è®¸ <code>NULL</code>ï¼‰</td><td><strong>ä¸åŒ…å« NULL</strong></td></tr></tbody></table><p>æ€§èƒ½ï¼š<code>count(å­—æ®µ)</code> &lt; <code>count(ä¸»é”®)</code> &lt; <code>count(1)</code> â‰ˆ <code>count(*)</code></p><p><code>count(ä¸»é”®/å­—æ®µ)</code> çš„æ•ˆç‡æ›´ä½çš„åŸå› æ˜¯éœ€è¦è§£ææ•°æ®è¡Œï¼Œå¹¶æ‹·è´è¦è¿”å›çš„å­—æ®µå€¼ã€‚</p><h3 id="è§£é‡Šä¸€ä¸‹äº‹åŠ¡çš„åŸºæœ¬ç‰¹æ€§å’Œéš”ç¦»çº§åˆ«"><a href="#è§£é‡Šä¸€ä¸‹äº‹åŠ¡çš„åŸºæœ¬ç‰¹æ€§å’Œéš”ç¦»çº§åˆ«" class="headerlink" title="è§£é‡Šä¸€ä¸‹äº‹åŠ¡çš„åŸºæœ¬ç‰¹æ€§å’Œéš”ç¦»çº§åˆ«"></a>è§£é‡Šä¸€ä¸‹äº‹åŠ¡çš„åŸºæœ¬ç‰¹æ€§å’Œéš”ç¦»çº§åˆ«</h3><p>äº‹åŠ¡ä¿è¯ä¸€ç»„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚åœ¨ MySQL ä¸­ï¼Œäº‹åŠ¡æ”¯æŒæ˜¯åœ¨å¼•æ“å±‚å®ç°çš„ã€‚</p><table><thead><tr><th>åŸºæœ¬ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>åŸå­æ€§ï¼ˆ<code>atomicity</code>ï¼‰</td><td>äº‹åŠ¡ä¸­çš„æ“ä½œè¦ä¹ˆå…¨éƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ</td></tr><tr><td>ä¸€è‡´æ€§ï¼ˆ<code>consistency</code>ï¼‰</td><td>äº‹åŠ¡çš„æ‰§è¡Œè¦ä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§</td></tr><tr><td>éš”ç¦»æ€§ï¼ˆ<code>isolation</code>ï¼‰</td><td>äº‹åŠ¡çš„æ‰§è¡Œäº’ä¸å¹²æ‰°</td></tr><tr><td>æŒä¹…æ€§ï¼ˆ<code>durability</code>ï¼‰</td><td>äº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ°¸ä¹…ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œä¸å¯æ’¤é”€</td></tr></tbody></table><table><thead><tr><th>äº‹åŠ¡å¯èƒ½å¼•å‘çš„é—®é¢˜</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>è„è¯»</td><td>A äº‹åŠ¡è¯»å– B äº‹åŠ¡å°šæœªæäº¤çš„ä¿®æ”¹</td></tr><tr><td>ä¸å¯é‡å¤è¯»</td><td>A äº‹åŠ¡å¤šæ¬¡è¯»å–åŒä¸€æ•°æ®ï¼Œç»“æœå‰åä¸ä¸€è‡´</td></tr><tr><td>å¹»è¯»</td><td>A äº‹åŠ¡å¤šæ¬¡è¯»å–ï¼Œæ•°æ®æ€»é‡å‰åä¸ä¸€è‡´</td></tr></tbody></table><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>è¯´æ˜</th><th>è„è¯»</th><th>ä¸å¯é‡å¤è¯»</th><th>å¹»è¯»</th></tr></thead><tbody><tr><td><code>read uncommitted</code></td><td>ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œèƒ½çœ‹åˆ°å…¶ä»–æœªæäº¤äº‹åŠ¡åšçš„å˜æ›´</td><td>âœ“</td><td>âœ“</td><td>âœ“</td></tr><tr><td><code>read committed</code></td><td>ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œèƒ½çœ‹åˆ°å…¶ä»–å·²æäº¤äº‹åŠ¡åšçš„å˜æ›´ï¼ˆMySQL ä¼šåœ¨æ¯ä¸ª SQL è¯­å¥å¼€å§‹æ‰§è¡Œæ—¶åˆ›å»ºä¸€ä¸ªè§†å›¾ï¼‰</td><td></td><td>âœ“</td><td>âœ“</td></tr><tr><td><code>repeatable read</code></td><td>ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…¶ä»–äº‹åŠ¡çš„å˜æ›´å¯¹å®ƒä¸å¯è§ï¼ˆMySQL ä¼šåœ¨äº‹åŠ¡å¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ªè§†å›¾ï¼Œæ•´ä¸ªäº‹åŠ¡æ‰§è¡ŒæœŸé—´éƒ½ä½¿ç”¨è¿™ä¸ªè§†å›¾ï¼‰</td><td></td><td></td><td>âœ“</td></tr><tr><td><code>serializable</code></td><td>äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œéš”ç¦»çº§åˆ«æœ€é«˜ï¼Œä¸ä¼šå‡ºç°ä¸Šé¢æ‰€è¯´çš„é—®é¢˜ï¼Œä½†ç›¸åº”çš„æ•ˆç‡ä¹Ÿæœ€ä½</td><td></td><td></td><td></td></tr></tbody></table><h3 id="InnoDBå¦‚ä½•è§£å†³å¹»è¯»"><a href="#InnoDBå¦‚ä½•è§£å†³å¹»è¯»" class="headerlink" title="InnoDBå¦‚ä½•è§£å†³å¹»è¯»"></a>InnoDBå¦‚ä½•è§£å†³å¹»è¯»</h3><p>InnoDBè§£å†³å¹»è¯»ä¸»è¦é ä»¥ä¸‹ä¸‰å¤§æ ¸å¿ƒæœºåˆ¶ï¼š</p><ul><li>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼ˆ<code>MVCC</code>ï¼‰</li><li>é—´éš™é”ï¼ˆ<code>Gap Lock</code>ï¼‰</li><li>ä¸´é”®é”ï¼ˆ<code>Next-Key Lock</code>ï¼‰</li></ul><p><strong><code>MVCC</code>å®ç°åŸç†ï¼š</strong></p><ul><li><code>Undo log</code>ï¼šæ¯æ¡æ•°æ®ç»´æŠ¤å¤šä¸ªå†å²ç‰ˆæœ¬</li><li><code>ReadView</code>ï¼šå¿«ç…§</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ReadViewç»“æ„ï¼š</span><br><span class="line">&#123;</span><br><span class="line">  creator_trx_id: 150,      -- å½“å‰äº‹åŠ¡ID</span><br><span class="line">  m_ids: [100, 120, 140],   -- æ´»è·ƒäº‹åŠ¡IDåˆ—è¡¨</span><br><span class="line">  min_trx_id: 100,          -- æœ€å°æ´»è·ƒäº‹åŠ¡ID</span><br><span class="line">  max_trx_id: 150           -- é¢„åˆ†é…æœ€å¤§äº‹åŠ¡ID</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¯è§æ€§åˆ¤æ–­è§„åˆ™</strong>ï¼š</p><ol><li>æ•°æ®ç‰ˆæœ¬<code>trx_id</code> &lt; <code>min_trx_id</code> â†’ å¯è§</li><li><code>trx_id</code>åœ¨<code>m_ids</code>ä¸­ â†’ ä¸å¯è§</li><li><code>trx_id</code> &gt;&#x3D; <code>max_trx_id</code> â†’ ä¸å¯è§</li></ol><p>InnoDBé»˜è®¤ä¼šä¸ºæ¯è¡Œæ•°æ®ç”Ÿæˆä¸¤ä¸ªéšè—åˆ—ï¼š</p><ul><li><code>DB_TRX_ID</code>ï¼šæœ€åä¿®æ”¹è¯¥è¡Œçš„äº‹åŠ¡ID</li><li><code>DB_ROLL_PTR</code>ï¼šæŒ‡å‘<code>Undo Log</code>çš„å›æ»šæŒ‡é’ˆ</li></ul><p>ä¸åŒéš”ç¦»çº§åˆ«ä¸‹<code>ReadView</code>çš„ç”Ÿæˆæ—¶æœºï¼š</p><ul><li><code>READ COMMITTED(RC)</code>ï¼šæ¯æ¬¡<code>SELECT</code>éƒ½ä¼šåˆ›å»ºæ–°çš„<code>ReadView</code></li><li><code>REPEATABLE READ(RR)</code>ï¼šäº‹åŠ¡ä¸­ç¬¬ä¸€æ¬¡<code>SELECT</code>æ—¶åˆ›å»º<code>ReadView</code></li></ul><p><strong>é—´éš™é”ï¼ˆ<code>Gap Lock</code>ï¼‰</strong></p><p>é”å®šè®°å½•ä¹‹é—´çš„é—´éš™ï¼Œä¸é”å®šè®°å½•æœ¬èº«ã€‚é˜²æ­¢å¹»è¯»ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- è¡¨æ•°æ®ï¼š5, 10, 15</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">10</span> <span class="keyword">AND</span> id <span class="operator">&lt;</span> <span class="number">20</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure><p>è¿™æ¡è¯­å¥ä¼šé”å®šåŒºé—´ <code>(10,15)</code>ã€<code>(15,+âˆ)</code>ï¼Œåœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œå…¶ä»–äº‹åŠ¡æ— æ³•åœ¨è¿™ä¸¤ä¸ªåŒºé—´æ’å…¥æ•°æ®</p><p><strong>ä¸´é”®é”ï¼ˆ<code>Next-Key Lock</code>ï¼‰</strong></p><p>é”å®šè®°å½•æœ¬èº«åŠä¹‹å‰çš„é—´éš™ã€‚åŒæ—¶é˜²æ­¢å¹»è¯»å’Œä¸å¯é‡å¤è¯»ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- äº‹åŠ¡Aæ‰§è¡Œï¼š</span><br><span class="line">SELECT * FROM users WHERE id &gt; 15 AND id &lt; 25 FOR UPDATE;</span><br><span class="line">-- å‡è®¾å­˜åœ¨id=20çš„è®°å½•ï¼Œä¸´é”®é”ä¼šé”å®šï¼š(15,20],(20,+âˆ)</span><br></pre></td></tr></table></figure><p><strong>Q1ï¼šRRéš”ç¦»çº§åˆ«å¦‚ä½•æ—¢ä½¿ç”¨MVCCåˆç”¨é”ï¼Ÿ</strong></p><ul><li><strong>å¿«ç…§è¯»</strong>ï¼ˆæ™®é€šSELECTï¼‰ï¼šä¾èµ–MVCCä¿è¯ä¸€è‡´æ€§</li><li><strong>å½“å‰è¯»</strong>ï¼ˆSELECT FOR UPDATEï¼‰ï¼šä½¿ç”¨ä¸´é”®é”ä¿è¯ç‰©ç†æ•°æ®ä¸€è‡´</li></ul><p><strong>Q2ï¼šGap Lockæ˜¯å¦ä¼šå¯¼è‡´æ­»é”ï¼Ÿ</strong></p><p>é—´éš™é”æ˜¯æœ‰å¯èƒ½å¯¼è‡´æ­»é”çš„ï¼Œå¦‚ï¼šäº‹åŠ¡Aé”(5,10)ï¼Œäº‹åŠ¡Bé”(10,15)ï¼Œä¸¤è€…åŒæ—¶è¯·æ±‚å¯¹æ–¹åŒºé—´çš„æ’å…¥</p><p>è§£å†³æ–¹æ¡ˆï¼šè®¾ç½®<code>innodb_deadlock_detect=ON</code>ï¼ˆé»˜è®¤å¼€å¯æ£€æµ‹ï¼‰</p><p><strong>Q3ï¼šPurgeçº¿ç¨‹çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><p>æ¸…ç†ä¸å†è¢«ä»»ä½•äº‹åŠ¡éœ€è¦çš„<code>Undo Log</code>ï¼Œå›æ”¶ç‰ˆæœ¬é“¾ä¸­çš„è¿‡æœŸæ•°æ®ç‰ˆæœ¬</p><h3 id="InnoDBå’ŒMyISAMçš„åŒºåˆ«"><a href="#InnoDBå’ŒMyISAMçš„åŒºåˆ«" class="headerlink" title="InnoDBå’ŒMyISAMçš„åŒºåˆ«"></a>InnoDBå’ŒMyISAMçš„åŒºåˆ«</h3><table><thead><tr><th></th><th>MyISAM</th><th>InnoDB</th></tr></thead><tbody><tr><td>é”</td><td>è¡¨çº§é”</td><td>è¡Œçº§é”</td></tr><tr><td>äº‹åŠ¡æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>ç´¢å¼•ç»“æ„</td><td>Bæ ‘</td><td>B+æ ‘</td></tr><tr><td>å…¨æ–‡æ£€ç´¢</td><td>æ”¯æŒ</td><td>5.5ç‰ˆæœ¬åæ”¯æŒ</td></tr></tbody></table><p>æ€»ä½“æ¥è¯´ï¼Œå¦‚æœéœ€è¦æ”¯æŒäº‹åŠ¡ã€å¤–é”®çº¦æŸå’Œé«˜å¹¶å‘è®¿é—®ï¼Œé‚£ä¹ˆInnoDBæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚å¦‚æœéœ€è¦è¿›è¡Œå…¨æ–‡æ£€ç´¢ï¼Œé‚£ä¹ˆMyISAMæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMySQL 5.5ç‰ˆæœ¬ä¹‹åï¼ŒInnoDBå·²ç»æ”¯æŒäº†å…¨æ–‡æ£€ç´¢ã€‚</p><h3 id="ä¸ºä»€ä¹ˆæœ‰æ—¶ç´¢å¼•ä¼šå¤±æ•ˆæˆ–é€‰é”™ç´¢å¼•"><a href="#ä¸ºä»€ä¹ˆæœ‰æ—¶ç´¢å¼•ä¼šå¤±æ•ˆæˆ–é€‰é”™ç´¢å¼•" class="headerlink" title="ä¸ºä»€ä¹ˆæœ‰æ—¶ç´¢å¼•ä¼šå¤±æ•ˆæˆ–é€‰é”™ç´¢å¼•"></a>ä¸ºä»€ä¹ˆæœ‰æ—¶ç´¢å¼•ä¼šå¤±æ•ˆæˆ–é€‰é”™ç´¢å¼•</h3><p>ç´¢å¼•å¤±æ•ˆçš„å¸¸è§åœºæ™¯ï¼š</p><ul><li>è¿åæœ€å·¦å‰ç¼€åŸåˆ™</li><li>å¯¹ç´¢å¼•åˆ—è¿›è¡Œè¿ç®—æˆ–å‡½æ•°æ“ä½œ</li><li>ä½¿ç”¨ <code>or</code> è¿æ¥éç´¢å¼•åˆ—</li><li>ç´¢å¼•åˆ—å­˜åœ¨å¤§é‡é‡å¤å€¼ï¼Œå¦‚æ€§åˆ«</li><li>ä½¿ç”¨ <code>like &#39;%åœ°å€&#39;</code></li></ul><p>é€‰é”™ç´¢å¼•çš„å¸¸è§åŸå› ï¼š</p><ul><li><p>ç»Ÿè®¡ä¿¡æ¯ä¸å‡†ç¡®ï¼šä¼˜åŒ–å™¨ä¾èµ–çš„ç»Ÿè®¡ä¿¡æ¯ï¼ˆå¦‚ <code>cardinality</code>ï¼‰è¿‡æ—¶ï¼Œè¯¯åˆ¤ç´¢å¼•æ•ˆç‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- è¡¨æ•°æ®åˆ†å¸ƒå·²å˜åŒ–ï¼Œä½†ç»Ÿè®¡ä¿¡æ¯æœªæ›´æ–°</span><br><span class="line">ANALYZE TABLE users; -- æ‰‹åŠ¨æ›´æ–°ç»Ÿè®¡ä¿¡æ¯</span><br></pre></td></tr></table></figure></li><li><p>ç´¢å¼•è¦†ç›–ä¸è¶³ï¼šç´¢å¼•æœªè¦†ç›–æŸ¥è¯¢æ‰€éœ€å­—æ®µï¼Œå¯¼è‡´å›è¡¨æˆæœ¬è¿‡é«˜ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç´¢å¼• (a) æ— æ³•è¦†ç›– SELECT *</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> <span class="number">1</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä½¿ç”¨è¦†ç›–ç´¢å¼•</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">table</span> <span class="keyword">ADD</span> INDEX idx_a_b_c (a, b, c);</span><br></pre></td></tr></table></figure></li></ul><h3 id="å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢"><a href="#å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢" class="headerlink" title="å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢"></a>å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢</h3><ol><li>ç¼–å†™é«˜æ•ˆçš„æŸ¥è¯¢è¯­å¥ï¼šåˆç†ç¼–å†™æŸ¥è¯¢è¯­å¥æ˜¯æŸ¥è¯¢ä¼˜åŒ–çš„åŸºç¡€ã€‚é¿å…ä½¿ç”¨å¤æ‚çš„åµŒå¥—æŸ¥è¯¢å’Œå­æŸ¥è¯¢ï¼Œå°½é‡ä½¿ç”¨ç®€å•çš„æŸ¥è¯¢è¯­å¥ï¼›é¿å…ä½¿ç”¨è¿‡å¤šçš„é€šé…ç¬¦ï¼Œå°½é‡æŒ‡å®šå…·ä½“çš„æŸ¥è¯¢æ¡ä»¶ï¼›ä½¿ç”¨åˆé€‚çš„è¿æ¥æ–¹å¼ï¼Œå¦‚INNER JOINã€LEFT JOINã€RIGHT JOINç­‰ï¼›é¿å…ä½¿ç”¨ä¸å¿…è¦çš„æ’åºå’Œåˆ†ç»„ã€‚</li><li>ä½¿ç”¨ç´¢å¼•ï¼šåˆç†ä½¿ç”¨ç´¢å¼•å¯ä»¥æ˜¾è‘—æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚åœ¨æŸ¥è¯¢æ¡ä»¶ä¸­é¢‘ç¹ä½¿ç”¨çš„åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œé¿å…åœ¨å¤§è¡¨ä¸Šè¿›è¡Œå…¨è¡¨æ‰«æã€‚</li><li>é¿å…ä½¿ç”¨SELECT *ï¼šåœ¨æŸ¥è¯¢æ—¶ï¼Œé¿å…ä½¿ç”¨SELECT *ï¼Œè€Œæ˜¯åªé€‰æ‹©éœ€è¦çš„åˆ—ã€‚è¿™æ ·å¯ä»¥å‡å°‘æ•°æ®åº“ä¼ è¾“å’Œå¤„ç†çš„æ•°æ®é‡ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li><li>ä¼˜åŒ–å­æŸ¥è¯¢å’ŒåµŒå¥—æŸ¥è¯¢ï¼šå­æŸ¥è¯¢å’ŒåµŒå¥—æŸ¥è¯¢å¯èƒ½å¯¼è‡´æŸ¥è¯¢æ€§èƒ½ä¸‹é™ï¼Œå°½é‡é¿å…åœ¨æŸ¥è¯¢ä¸­å¤šæ¬¡åµŒå¥—å­æŸ¥è¯¢ã€‚å¯ä»¥è€ƒè™‘ä½¿ç”¨è¿æ¥ï¼ˆJOINï¼‰æ“ä½œã€ä¸´æ—¶è¡¨ç­‰æ›¿ä»£å­æŸ¥è¯¢ï¼Œä»è€Œä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ã€‚</li><li>ä½¿ç”¨åˆé€‚çš„æ•°æ®ç±»å‹ï¼šåœ¨æ•°æ®åº“è®¾è®¡å’ŒæŸ¥è¯¢ä¸­ï¼Œä½¿ç”¨åˆé€‚çš„æ•°æ®ç±»å‹å¯ä»¥é¿å…æ•°æ®ç±»å‹è½¬æ¢å’Œéšå¼è½¬æ¢ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œå¯¹äºæ•´æ•°ç±»å‹çš„åˆ—ï¼Œä½¿ç”¨æ•´æ•°ç±»å‹çš„æ•°æ®è€Œä¸æ˜¯å­—ç¬¦ç±»å‹çš„æ•°æ®ï¼Œå¯ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li></ol><h3 id="ä¸ºä»€ä¹ˆæœ‰æ—¶åªæŸ¥è¯¢ä¸€è¡Œä½†æ˜¯å¾ˆæ…¢"><a href="#ä¸ºä»€ä¹ˆæœ‰æ—¶åªæŸ¥è¯¢ä¸€è¡Œä½†æ˜¯å¾ˆæ…¢" class="headerlink" title="ä¸ºä»€ä¹ˆæœ‰æ—¶åªæŸ¥è¯¢ä¸€è¡Œä½†æ˜¯å¾ˆæ…¢"></a>ä¸ºä»€ä¹ˆæœ‰æ—¶åªæŸ¥è¯¢ä¸€è¡Œä½†æ˜¯å¾ˆæ…¢</h3><ol><li>æ•°æ®åº“è¡¨ä¸­æ•°æ®é‡å¢åŠ ï¼šéšç€è¡¨ä¸­æ•°æ®é‡çš„å¢åŠ ï¼ŒæŸ¥è¯¢ä¸€è¡Œçš„æ—¶é—´å¯èƒ½ä¼šå˜å¾—æ›´é•¿ã€‚</li><li>ç´¢å¼•å¤±æ•ˆï¼šå¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­ä½¿ç”¨çš„åˆ—æ²¡æœ‰ç´¢å¼•ï¼Œæˆ–è€…ç´¢å¼•å¤±æ•ˆï¼ˆä¾‹å¦‚ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯è¿‡æœŸæˆ–è€…ç´¢å¼•æŸåï¼‰ï¼Œæ•°æ®åº“å¯èƒ½ä¼šæ‰§è¡Œå…¨è¡¨æ‰«ææˆ–è€…å…¶ä»–ä½æ•ˆçš„æŸ¥è¯¢æ–¹æ³•ï¼Œä»è€Œå¯¼è‡´æŸ¥è¯¢ä¸€è¡Œçš„æ€§èƒ½ä¸‹é™ã€‚</li><li>æŸ¥è¯¢å¤æ‚åº¦å¢åŠ ï¼šå¦‚æœæŸ¥è¯¢çš„å¤æ‚åº¦å¢åŠ ï¼Œä¾‹å¦‚æ¶‰åŠåˆ°å¤šä¸ªè¡¨çš„è”æ¥ã€å­æŸ¥è¯¢ã€èšåˆå‡½æ•°ç­‰ï¼ŒæŸ¥è¯¢ä¸€è¡Œçš„æ€§èƒ½å¯èƒ½ä¼šå—åˆ°å½±å“ã€‚</li><li>æ•°æ®åº“æœåŠ¡å™¨è´Ÿè½½å¢åŠ ï¼šå¦‚æœæ•°æ®åº“æœåŠ¡å™¨è´Ÿè½½å¢åŠ ï¼Œä¾‹å¦‚åŒæ—¶æœ‰å¤§é‡çš„æŸ¥è¯¢å’Œå†™å…¥æ“ä½œï¼Œæ•°æ®åº“çš„æ€§èƒ½å¯èƒ½ä¼šä¸‹é™ï¼Œä»è€Œå¯¼è‡´æŸ¥è¯¢ä¸€è¡Œå˜å¾—å¾ˆæ…¢ã€‚</li></ol><h3 id="æ…¢SQLä¼˜åŒ–å…¨æµç¨‹"><a href="#æ…¢SQLä¼˜åŒ–å…¨æµç¨‹" class="headerlink" title="æ…¢SQLä¼˜åŒ–å…¨æµç¨‹"></a>æ…¢SQLä¼˜åŒ–å…¨æµç¨‹</h3><p><strong>é˜¶æ®µ1ï¼šé—®é¢˜å®šä½ä¸æ•°æ®é‡‡é›†</strong></p><ul><li>å¼€å¯æ…¢æ—¥å¿—æŸ¥è¯¢</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åŠ¨æ€å¼€å¯ï¼ˆé‡å¯å¤±æ•ˆï¼‰</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> long_query_time <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- é˜ˆå€¼è®¾ä¸º1ç§’</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log_file <span class="operator">=</span> <span class="string">&#x27;/var/log/mysql/slow.log&#x27;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- æ°¸ä¹…é…ç½®ï¼ˆmy.cnfï¼‰</span><br><span class="line">[mysqld]</span><br><span class="line">slow_query_log = 1</span><br><span class="line">long_query_time = 1</span><br><span class="line">log_queries_not_using_indexes = 1  -- è®°å½•æœªèµ°ç´¢å¼•çš„æŸ¥è¯¢</span><br></pre></td></tr></table></figure><ul><li>å®æ—¶ç›‘æµ‹å·¥å…·</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„æ…¢æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.PROCESSLIST </span><br><span class="line"><span class="keyword">WHERE</span> <span class="type">TIME</span> <span class="operator">&gt;</span> <span class="number">2</span> <span class="keyword">AND</span> COMMAND <span class="operator">=</span> <span class="string">&#x27;Query&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä½¿ç”¨Percona ToolkitæŠ“å–é—®é¢˜SQL</span></span><br><span class="line">pt<span class="operator">-</span>query<span class="operator">-</span>digest <span class="operator">/</span>var<span class="operator">/</span>log<span class="operator">/</span>mysql<span class="operator">/</span>slow.log</span><br></pre></td></tr></table></figure><ul><li>å…³é”®æ€§èƒ½æŒ‡æ ‡</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">é‡ç‚¹ç›‘æ§é¡¹ï¼š</span><br><span class="line">- QPS/TPSæ³¢åŠ¨</span><br><span class="line">- CPUä½¿ç”¨ç‡ï¼ˆç‰¹åˆ«æ˜¯%sysï¼‰</span><br><span class="line">- é”ç­‰å¾…æ—¶é—´(Innodb_row_lock_time_avg)</span><br><span class="line">- ç¼“å†²æ± å‘½ä¸­ç‡(Innodb_buffer_pool_reads)</span><br></pre></td></tr></table></figure><p>Qï¼š<code>IN</code> å’Œ <code>EXISTS</code> çš„åŒºåˆ«</p><p>å½“ä½¿ç”¨ <code>IN</code> æ—¶ï¼ŒMySQL ä¼šé¦–å…ˆæ‰§è¡Œå­æŸ¥è¯¢ï¼Œç„¶åå°†å­æŸ¥è¯¢çš„ç»“æœé›†ç”¨äºå¤–éƒ¨æŸ¥è¯¢çš„æ¡ä»¶ã€‚è¿™æ„å‘³ç€å­æŸ¥è¯¢çš„ç»“æœé›†éœ€è¦å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</p><p>è€Œ <code>EXISTS</code> ä¼šå¯¹å¤–éƒ¨æŸ¥è¯¢çš„æ¯ä¸€è¡Œï¼Œæ‰§è¡Œä¸€æ¬¡å­æŸ¥è¯¢ã€‚å¦‚æœå­æŸ¥è¯¢è¿”å›ä»»ä½•è¡Œï¼Œåˆ™ <code>EXISTS</code> æ¡ä»¶ä¸ºçœŸã€‚<code>EXISTS</code> å…³æ³¨çš„æ˜¯å­æŸ¥è¯¢æ˜¯å¦è¿”å›è¡Œï¼Œè€Œä¸æ˜¯è¿”å›çš„å…·ä½“å€¼ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- IN çš„ä¸´æ—¶è¡¨å¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆ</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users </span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> user_id <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> amount <span class="operator">&gt;</span> <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- EXISTS å¯ä»¥åˆ©ç”¨å…³è”ç´¢å¼•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users u</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> orders o </span><br><span class="line">            <span class="keyword">WHERE</span> o.user_id <span class="operator">=</span> u.id <span class="keyword">AND</span> o.amount <span class="operator">&gt;</span> <span class="number">100</span>);</span><br></pre></td></tr></table></figure><p><code>IN</code> é€‚ç”¨äºå­æŸ¥è¯¢ç»“æœé›†è¾ƒå°çš„æƒ…å†µã€‚å¦‚æœå­æŸ¥è¯¢è¿”å›å¤§é‡æ•°æ®ï¼Œ<code>IN</code> çš„æ€§èƒ½å¯èƒ½ä¼šä¸‹é™ï¼Œå› ä¸ºå®ƒéœ€è¦å°†æ•´ä¸ªç»“æœé›†åŠ è½½åˆ°å†…å­˜ã€‚</p><p>è€Œ EXISTS é€‚ç”¨äºå­æŸ¥è¯¢ç»“æœé›†å¯èƒ½å¾ˆå¤§çš„æƒ…å†µã€‚ç”±äº <code>EXISTS</code> åªéœ€è¦åˆ¤æ–­å­æŸ¥è¯¢æ˜¯å¦è¿”å›è¡Œï¼Œè€Œä¸éœ€è¦åŠ è½½æ•´ä¸ªç»“æœé›†ï¼Œå› æ­¤åœ¨æŸäº›æƒ…å†µä¸‹æ€§èƒ½æ›´å¥½ï¼Œç‰¹åˆ«æ˜¯å½“å­æŸ¥è¯¢å¯ä»¥ä½¿ç”¨ç´¢å¼•æ—¶ã€‚</p><p><strong>NULLå€¼é™·</strong></p><p><code>IN</code>: å¦‚æœå­æŸ¥è¯¢çš„ç»“æœé›†ä¸­åŒ…å« <code>NULL</code> å€¼ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„ç»“æœã€‚ä¾‹å¦‚ï¼Œ<code>WHERE column IN (subquery)</code>ï¼Œå¦‚æœ <code>subquery</code> è¿”å› <code>NULL</code>ï¼Œåˆ™ <code>column IN (subquery)</code> æ°¸è¿œä¸ä¼šä¸ºçœŸï¼Œé™¤é <code>column</code> æœ¬èº«ä¹Ÿä¸º <code>NULL</code>ã€‚</p><p><code>EXISTS</code>: å¯¹ <code>NULL</code> å€¼çš„å¤„ç†æ›´åŠ ç›´æ¥ã€‚<code>EXISTS</code> åªæ˜¯æ£€æŸ¥å­æŸ¥è¯¢æ˜¯å¦è¿”å›è¡Œï¼Œä¸å…³å¿ƒè¡Œçš„å…·ä½“å€¼ï¼Œå› æ­¤ä¸å— <code>NULL</code> å€¼çš„å½±å“ã€‚</p><h3 id="å­—æ®µç±»å‹"><a href="#å­—æ®µç±»å‹" class="headerlink" title="å­—æ®µç±»å‹"></a>å­—æ®µç±»å‹</h3><p>åœ¨æ•°æ®åº“è®¾è®¡ä¸­ï¼Œæ–‡æœ¬ç±»å‹å­—æ®µï¼ˆå¦‚MySQLä¸­çš„TEXTï¼ŒPostgreSQLä¸­çš„TEXTç­‰ï¼‰é€šå¸¸ç”¨äºå­˜å‚¨å¤§é‡æ–‡æœ¬æ•°æ®ã€‚è™½ç„¶å®ƒä»¬å¯ä»¥å­˜å‚¨å¤§é‡æ•°æ®ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ä¸å»ºè®®ä½¿ç”¨ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p><ol><li><strong>æ€§èƒ½é—®é¢˜</strong>ï¼šTEXTç±»å‹é€šå¸¸å­˜å‚¨åœ¨æ•°æ®åº“çš„ä¸»è¡¨ä¹‹å¤–ï¼ˆæ¯”å¦‚åœ¨MySQLçš„InnoDBä¸­ï¼ŒTEXTå’ŒBLOBç±»å‹åœ¨è®°å½•è¾ƒå¤§æ—¶å¯èƒ½å­˜å‚¨åœ¨æº¢å‡ºé¡µï¼‰ï¼Œè¿™å¯èƒ½å¯¼è‡´é¢å¤–çš„ç£ç›˜I&#x2F;Oã€‚å½“æŸ¥è¯¢ä¸­åŒ…å«TEXTå­—æ®µæ—¶ï¼Œå¯èƒ½éœ€è¦è®¿é—®å¤šä¸ªé¡µï¼Œä»è€Œé™ä½æŸ¥è¯¢é€Ÿåº¦ã€‚</li><li><strong>å†…å­˜ä½¿ç”¨</strong>ï¼šåœ¨å¤„ç†æŸ¥è¯¢æ—¶ï¼Œæ•°æ®åº“å¯èƒ½ä¼šä¸ºTEXTå­—æ®µåˆ†é…å¤§é‡å†…å­˜ï¼Œå°¤å…¶æ˜¯å½“ä½¿ç”¨ä¸´æ—¶è¡¨æˆ–æ’åºæ—¶ã€‚è¿™å¯èƒ½å¯¼è‡´å†…å­˜ä½¿ç”¨è¿‡é«˜ï¼Œå½±å“æ•°æ®åº“æ€§èƒ½ã€‚</li><li><strong>ç´¢å¼•é™åˆ¶</strong>ï¼šå¯¹äºTEXTç±»å‹ï¼Œé€šå¸¸ä¸èƒ½ç›´æ¥åˆ›å»ºç´¢å¼•ï¼ˆé™¤éæŒ‡å®šå‰ç¼€ç´¢å¼•ï¼‰ï¼Œè€Œä¸”å‰ç¼€ç´¢å¼•å¯èƒ½ä¸å¤Ÿç²¾ç¡®ã€‚åœ¨MySQLä¸­ï¼Œå¯¹TEXTåˆ—å»ºç«‹ç´¢å¼•å¿…é¡»æŒ‡å®šå‰ç¼€é•¿åº¦ï¼Œè¿™å¯èƒ½å¯¼è‡´ç´¢å¼•æ•ˆç‡ä¸é«˜ã€‚</li><li><strong>é»˜è®¤å€¼é—®é¢˜</strong>ï¼šåœ¨æŸäº›æ•°æ®åº“ç³»ç»Ÿä¸­ï¼ˆå¦‚MySQL 5.6ä¹‹å‰çš„ç‰ˆæœ¬ï¼‰ï¼ŒTEXTå­—æ®µä¸èƒ½æœ‰é»˜è®¤å€¼ã€‚è™½ç„¶è¾ƒæ–°çš„ç‰ˆæœ¬å·²ç»æ”¯æŒï¼Œä½†ä»æœ‰å…¶ä»–é™åˆ¶ã€‚</li><li><strong>å­˜å‚¨ç©ºé—´</strong>ï¼šTEXTç±»å‹é€šå¸¸å ç”¨æ›´å¤šå­˜å‚¨ç©ºé—´ï¼Œå› ä¸ºæ•°æ®åº“å¯èƒ½ä¼šä¸ºè¿™äº›å­—æ®µåˆ†é…é¢å¤–çš„ç©ºé—´ä»¥åº”å¯¹å¯èƒ½çš„å¢é•¿ã€‚</li><li><strong>å¤åˆ¶å’Œæ¢å¤</strong>ï¼šç”±äºTEXTå­—æ®µå¯èƒ½åŒ…å«å¤§é‡æ•°æ®ï¼Œåœ¨æ•°æ®åº“å¤åˆ¶ï¼ˆå¦‚ä¸»ä»å¤åˆ¶ï¼‰å’Œå¤‡ä»½æ¢å¤è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå¢åŠ ç½‘ç»œä¼ è¾“å’ŒI&#x2F;Oè´Ÿæ‹…ï¼Œå¯¼è‡´å»¶è¿Ÿã€‚</li><li><strong>æŸ¥è¯¢ä¼˜åŒ–</strong>ï¼šä¼˜åŒ–å™¨åœ¨å¤„ç†åŒ…å«TEXTå­—æ®µçš„æŸ¥è¯¢æ—¶å¯èƒ½ä¼šé€‰æ‹©æ•ˆç‡è¾ƒä½çš„æ‰§è¡Œè®¡åˆ’ï¼Œå› ä¸ºæ— æ³•å‡†ç¡®ä¼°è®¡TEXTå­—æ®µçš„å¤§å°ã€‚</li><li><strong>æ’åºå’Œåˆ†ç»„</strong>ï¼šå¦‚æœæŸ¥è¯¢éœ€è¦å¯¹TEXTå­—æ®µè¿›è¡Œæ’åºæˆ–åˆ†ç»„ï¼Œç”±äºæ•°æ®é‡å¤§ï¼Œå¯èƒ½ä¼šä½¿ç”¨ç£ç›˜ä¸´æ—¶è¡¨ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</li><li><strong>åº”ç”¨åœºæ™¯ä¸åŒ¹é…</strong>ï¼šå¾ˆå¤šæ—¶å€™ï¼Œå¼€å‘è€…ä½¿ç”¨TEXTç±»å‹å­˜å‚¨çš„æ•°æ®å®é™…ä¸Šå¯èƒ½æ˜¯ä¸€ä¸ªæœ‰é™é•¿åº¦çš„å­—ç¬¦ä¸²ï¼ˆå¦‚åœ°å€ã€æè¿°ç­‰ï¼‰ï¼Œæ­¤æ—¶ä½¿ç”¨VARCHARï¼ˆæœ‰é•¿åº¦é™åˆ¶ï¼‰æ›´ä¸ºåˆé€‚ï¼Œå› ä¸ºVARCHARåœ¨å­˜å‚¨å’Œæ€§èƒ½ä¸Šé€šå¸¸æ›´é«˜æ•ˆã€‚</li></ol><p>å½“ç„¶ï¼Œå¦‚æœç¡®å®éœ€è¦å­˜å‚¨å¤§æ–‡æœ¬ï¼ˆå¦‚æ–‡ç« å†…å®¹ã€æ—¥å¿—ç­‰ï¼‰ï¼Œé‚£ä¹ˆä½¿ç”¨TEXTç±»å‹æ˜¯åˆç†çš„ã€‚ä½†åœ¨ä¸éœ€è¦å­˜å‚¨å¤§æ–‡æœ¬çš„æƒ…å†µä¸‹ï¼Œåº”ä¼˜å…ˆé€‰æ‹©VARCHARç­‰ç±»å‹ï¼Œå¹¶è®¾ç½®åˆé€‚çš„é•¿åº¦é™åˆ¶ã€‚</p><p><strong>æ€»ç»“</strong>ï¼šåœ¨ä¸éœ€è¦å­˜å‚¨å¤§æ–‡æœ¬æ—¶ï¼Œä½¿ç”¨TEXTç±»å‹å¯èƒ½ä¼šå¸¦æ¥æ€§èƒ½ã€å­˜å‚¨å’ŒåŠŸèƒ½ä¸Šçš„é™åˆ¶ï¼Œå› æ­¤å»ºè®®ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨ã€‚</p><p><strong>å»ºè®®</strong></p><table><thead><tr><th align="left"><strong>åœºæ™¯</strong></th><th align="left"><strong>æ¨èç±»å‹</strong></th></tr></thead><tbody><tr><td align="left">çŸ­æ–‡æœ¬ï¼ˆ&lt; 255 å­—ç¬¦ï¼‰</td><td align="left"><code>VARCHAR(n)</code></td></tr><tr><td align="left">ä¸­ç­‰æ–‡æœ¬ï¼ˆ&lt; 64KBï¼‰</td><td align="left"><code>VARCHAR(65535)</code></td></tr><tr><td align="left">è¶…å¤§æ–‡æœ¬ï¼ˆ&gt; 64KBï¼‰</td><td align="left"><code>TEXT</code>ï¼ˆæˆ–åˆ†è¡¨å­˜å‚¨ï¼‰</td></tr></tbody></table><h3 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h3><h3 id="æ…¢æŸ¥è¯¢"><a href="#æ…¢æŸ¥è¯¢" class="headerlink" title="æ…¢æŸ¥è¯¢"></a>æ…¢æŸ¥è¯¢</h3><h3 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h3><h3 id="åˆ†åº“åˆ†è¡¨"><a href="#åˆ†åº“åˆ†è¡¨" class="headerlink" title="åˆ†åº“åˆ†è¡¨"></a>åˆ†åº“åˆ†è¡¨</h3><h4 id="ä»€ä¹ˆæ˜¯åˆ†åº“åˆ†è¡¨"><a href="#ä»€ä¹ˆæ˜¯åˆ†åº“åˆ†è¡¨" class="headerlink" title="ä»€ä¹ˆæ˜¯åˆ†åº“åˆ†è¡¨"></a>ä»€ä¹ˆæ˜¯åˆ†åº“åˆ†è¡¨</h4><ol><li><strong>åˆ†åº“ (Database Sharding):</strong><ul><li><strong>æ¦‚å¿µï¼š</strong> å°†ä¸€ä¸ªæ•°æ®åº“ä¸­çš„æ•°æ®ï¼ŒæŒ‰ç…§æŸç§è§„åˆ™ï¼ˆå¦‚ç”¨æˆ·IDã€è®¢å•æ—¥æœŸã€åœ°ç†ä½ç½®ç­‰ï¼‰åˆ†æ•£åˆ°å¤šä¸ª<strong>ç‰©ç†ä¸Šç‹¬ç«‹</strong>çš„æ•°æ®åº“å®ä¾‹ä¸­ã€‚</li><li><strong>ç›®çš„ï¼š</strong><ul><li><strong>åˆ†æ‹…å†™è´Ÿè½½&#x2F;è¯»è´Ÿè½½ï¼š</strong> å¤šä¸ªæ•°æ®åº“å®ä¾‹å¯ä»¥åŒæ—¶å¤„ç†å†™å…¥å’Œè¯»å–è¯·æ±‚ï¼Œæ˜¾è‘—æå‡æ•´ä½“ååé‡ã€‚</li><li><strong>çªç ´å•æœºè¿æ¥æ•°é™åˆ¶ï¼š</strong> æ¯ä¸ªæ•°æ®åº“å®ä¾‹æœ‰è‡ªå·±çš„è¿æ¥æ± ã€‚</li><li><strong>æé«˜å¯ç”¨æ€§ï¼š</strong> ä¸€ä¸ªæ•°æ®åº“å®ä¾‹æ•…éšœï¼Œä¸å½±å“å…¶ä»–å®ä¾‹ä¸Šçš„æœåŠ¡ï¼ˆéœ€è¦é…åˆé«˜å¯ç”¨æ–¹æ¡ˆï¼‰ã€‚</li><li><strong>èµ„æºéš”ç¦»ï¼š</strong> ä¸åŒä¸šåŠ¡æ¨¡å—æˆ–ä¸åŒç±»å‹çš„æ•°æ®å¯ä»¥éƒ¨ç½²åˆ°ä¸åŒçš„æ•°æ®åº“é›†ç¾¤ï¼Œäº’ä¸å½±å“ã€‚</li></ul></li></ul></li><li><strong>åˆ†è¡¨ (Table Sharding&#x2F;Partitioning):</strong><ul><li><strong>æ¦‚å¿µï¼š</strong> å°†ä¸€å¼ è¡¨ä¸­çš„æ•°æ®ï¼ŒæŒ‰ç…§æŸç§è§„åˆ™ï¼ˆé€šå¸¸æ˜¯åŸºäºæŸä¸ªå­—æ®µçš„å€¼ï¼Œå¦‚ç”¨æˆ·IDã€æ—¶é—´æˆ³ã€å“ˆå¸Œå€¼ç­‰ï¼‰åˆ†æ•£åˆ°<strong>åŒä¸€ä¸ªæ•°æ®åº“å®ä¾‹å†…</strong>çš„å¤šå¼ ç»“æ„ç›¸åŒçš„è¡¨ä¸­ï¼Œæˆ–è€…åˆ†æ•£åˆ°<strong>ä¸åŒæ•°æ®åº“å®ä¾‹</strong>çš„å¤šå¼ è¡¨ä¸­ï¼ˆæ­¤æ—¶æ˜¯åˆ†åº“åˆ†è¡¨çš„ç»“åˆï¼‰ã€‚</li><li><strong>ç›®çš„ï¼š</strong><ul><li><strong>è§£å†³å•è¡¨æ•°æ®é‡è¿‡å¤§é—®é¢˜ï¼š</strong> è¿™æ˜¯æœ€æ ¸å¿ƒçš„é©±åŠ¨åŠ›ã€‚å•è¡¨æ•°æ®é‡è¿‡å¤§ï¼ˆå¦‚æ•°åƒä¸‡ã€ä¸Šäº¿è¡Œï¼‰ä¼šå¯¼è‡´ç´¢å¼•æ ‘å˜å¾—éå¸¸æ·±ï¼ŒæŸ¥è¯¢æ•ˆç‡æ€¥å‰§ä¸‹é™ï¼ŒDDLæ“ä½œï¼ˆå¦‚åŠ ç´¢å¼•ã€ä¿®æ”¹è¡¨ç»“æ„ï¼‰è€—æ—¶æé•¿ä¸”å¯èƒ½é”è¡¨ï¼Œæ•°æ®å¤‡ä»½æ¢å¤å›°éš¾ã€‚</li><li><strong>æå‡æŸ¥è¯¢æ•ˆç‡ï¼š</strong> é’ˆå¯¹ç‰¹å®šåˆ†ç‰‡é”®çš„æŸ¥è¯¢ï¼Œå¯ä»¥å¿«é€Ÿå®šä½åˆ°å…·ä½“çš„åˆ†ç‰‡è¡¨ï¼Œé¿å…æ‰«æå…¨é‡æ•°æ®ã€‚</li><li><strong>å‡å°‘é”ç«äº‰ï¼š</strong> å†™æ“ä½œåˆ†æ•£åˆ°å¤šå¼ è¡¨ï¼Œå‡å°‘äº†é”äº‰ç”¨çš„æ¦‚ç‡ã€‚</li></ul></li></ul></li></ol><h4 id="å¸¸è§æ‹†åˆ†ç»´åº¦"><a href="#å¸¸è§æ‹†åˆ†ç»´åº¦" class="headerlink" title="å¸¸è§æ‹†åˆ†ç»´åº¦"></a>å¸¸è§æ‹†åˆ†ç»´åº¦</h4><ul><li><strong>æ°´å¹³æ‹†åˆ† (Horizontal Sharding&#x2F;Partitioning):</strong><ul><li>æŒ‰è¡Œæ‹†åˆ†ã€‚å°†è¡¨ä¸­çš„ä¸åŒè¡Œè®°å½•åˆ†æ•£åˆ°ä¸åŒçš„åº“&#x2F;è¡¨ã€‚</li><li>æ‹†åˆ†è§„åˆ™ï¼šåŸºäºæŸä¸ªå­—æ®µçš„å€¼ï¼ˆåˆ†ç‰‡é”®ï¼‰ï¼Œå¦‚ï¼š<ul><li><strong>èŒƒå›´åˆ†ç‰‡ï¼š</strong> æŒ‰æ—¶é—´èŒƒå›´ï¼ˆå¦‚æŒ‰æœˆã€æŒ‰å¹´ï¼‰ã€æŒ‰IDèŒƒå›´ï¼ˆå¦‚ 1-100ä¸‡åœ¨è¡¨1ï¼Œ100ä¸‡-200ä¸‡åœ¨è¡¨2ï¼‰ã€‚</li><li><strong>å“ˆå¸Œåˆ†ç‰‡ï¼š</strong> å¯¹åˆ†ç‰‡é”®è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œæ ¹æ®å“ˆå¸Œå€¼å–æ¨¡æˆ–å…¶ä»–ç®—æ³•åˆ†é…åˆ°ä¸åŒåº“è¡¨ã€‚èƒ½è¾ƒå‡åŒ€åˆ†å¸ƒæ•°æ®ï¼Œä½†èŒƒå›´æŸ¥è¯¢å›°éš¾ã€‚</li><li><strong>åœ°ç†ä½ç½®åˆ†ç‰‡ï¼š</strong> æŒ‰ç”¨æˆ·æˆ–ä¸šåŠ¡æ‰€å±åœ°åŒºã€‚</li><li><strong>ä¸šåŠ¡åˆ†ç‰‡ï¼š</strong> æŒ‰ä¸šåŠ¡çº¿ã€ç§Ÿæˆ·IDç­‰ã€‚</li></ul></li></ul></li><li><strong>å‚ç›´æ‹†åˆ† (Vertical Sharding&#x2F;Partitioning):</strong><ul><li>æŒ‰åˆ—æ‹†åˆ†ã€‚å°†ä¸€å¼ å®½è¡¨çš„ä¸åŒåˆ—æ‹†åˆ†åˆ°ä¸åŒçš„åº“&#x2F;è¡¨ä¸­ã€‚</li><li>é€šå¸¸ç”¨äºï¼š<ul><li>å°†è®¿é—®é¢‘ç‡é«˜çš„åˆ—å’Œè®¿é—®é¢‘ç‡ä½çš„åˆ—ï¼ˆå¦‚å¤§æ–‡æœ¬ã€BLOBï¼‰åˆ†å¼€ã€‚</li><li>å°†æ ¸å¿ƒä¸šåŠ¡å­—æ®µå’Œæ‰©å±•å­—æ®µåˆ†å¼€ã€‚</li><li>å°†ä¸åŒä¸šåŠ¡æ¨¡å—çš„å­—æ®µæ‹†åˆ†åˆ°ç‹¬ç«‹çš„åº“æˆ–è¡¨ä¸­ï¼ˆè¿™é€šå¸¸ä¹Ÿå±äºåˆ†åº“çš„èŒƒç•´ï¼‰ã€‚</li></ul></li></ul></li></ul><h4 id="åˆ†åº“åˆ†è¡¨å¸¦æ¥çš„æŒ‘æˆ˜"><a href="#åˆ†åº“åˆ†è¡¨å¸¦æ¥çš„æŒ‘æˆ˜" class="headerlink" title="åˆ†åº“åˆ†è¡¨å¸¦æ¥çš„æŒ‘æˆ˜"></a>åˆ†åº“åˆ†è¡¨å¸¦æ¥çš„æŒ‘æˆ˜</h4><ul><li><strong>åˆ†å¸ƒå¼äº‹åŠ¡ï¼š</strong> è·¨åº“&#x2F;è·¨è¡¨çš„æ“ä½œéš¾ä»¥ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œéœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼ˆå¦‚2PC, 3PC, TCC, Saga, æœ¬åœ°æ¶ˆæ¯è¡¨ç­‰ï¼‰ï¼Œå¢åŠ äº†å¤æ‚æ€§å’Œæ€§èƒ½å¼€é”€ã€‚</li><li><strong>è·¨åº“&#x2F;è·¨è¡¨JOINï¼š</strong> åŸæœ¬ç®€å•çš„JOINæŸ¥è¯¢å˜å¾—éå¸¸å›°éš¾ä¸”ä½æ•ˆï¼Œé€šå¸¸éœ€è¦ä¸šåŠ¡å±‚å¤„ç†ï¼ˆå¤šæ¬¡æŸ¥è¯¢+å†…å­˜JOINï¼‰æˆ–ä½¿ç”¨å¼‚æ„ç´¢å¼•ï¼ˆå¦‚Elasticsearchï¼‰ã€‚</li><li><strong>å…¨å±€å”¯ä¸€ä¸»é”®ï¼š</strong> å•æœºè‡ªå¢IDä¸å†é€‚ç”¨ï¼Œéœ€è¦åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆï¼ˆSnowflake, UUID, Redis, æ•°æ®åº“å·æ®µç­‰ï¼‰ã€‚</li><li><strong>åˆ†ç‰‡é”®é€‰æ‹©ï¼š</strong> åˆ†ç‰‡é”®çš„é€‰æ‹©è‡³å…³é‡è¦ï¼Œç›´æ¥å½±å“æ•°æ®åˆ†å¸ƒå‡åŒ€æ€§ã€æŸ¥è¯¢æ•ˆç‡ã€æ‰©å®¹éš¾æ˜“åº¦ã€‚ä¸€æ—¦é€‰å®šï¼ŒåæœŸä¿®æ”¹æˆæœ¬æé«˜ã€‚</li><li><strong>æ‰©å®¹å¤æ‚æ€§ï¼š</strong> æ°´å¹³æ‰©å®¹ï¼ˆå¢åŠ åˆ†ç‰‡èŠ‚ç‚¹ï¼‰é€šå¸¸æ¶‰åŠæ•°æ®è¿ç§»ï¼Œéœ€è¦ç²¾å¿ƒè®¾è®¡ï¼Œå¯èƒ½å½±å“æœåŠ¡ã€‚</li><li><strong>è¿ç»´å¤æ‚åº¦ï¼š</strong> éœ€è¦ç®¡ç†æ›´å¤šçš„æ•°æ®åº“å®ä¾‹å’Œè¡¨ï¼Œç›‘æ§ã€å¤‡ä»½ã€å‡çº§ã€æ•…éšœæ’æŸ¥ç­‰è¿ç»´å·¥ä½œé‡å’Œå¤æ‚åº¦æˆå€å¢åŠ ã€‚</li><li><strong>SQLé™åˆ¶ï¼š</strong> éƒ¨åˆ†SQLè¯­å¥ï¼ˆå¦‚æœªå¸¦åˆ†ç‰‡é”®çš„æ¡ä»¶æŸ¥è¯¢ã€å¤æ‚å­æŸ¥è¯¢ã€æ’åºåˆ†é¡µï¼‰å¯èƒ½æ— æ³•é«˜æ•ˆæ‰§è¡Œæˆ–éœ€è¦æ”¹å†™ã€‚</li></ul><h4 id="å¤šå¤§çš„æ•°æ®é‡éœ€è¦è€ƒè™‘åˆ†åº“åˆ†è¡¨"><a href="#å¤šå¤§çš„æ•°æ®é‡éœ€è¦è€ƒè™‘åˆ†åº“åˆ†è¡¨" class="headerlink" title="å¤šå¤§çš„æ•°æ®é‡éœ€è¦è€ƒè™‘åˆ†åº“åˆ†è¡¨"></a>å¤šå¤§çš„æ•°æ®é‡éœ€è¦è€ƒè™‘åˆ†åº“åˆ†è¡¨</h4><p><strong>è¿™æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§ä½†ä¹Ÿéå¸¸éš¾ç»™å‡ºç»å¯¹æ•°å­—çš„é—®é¢˜ã€‚æ²¡æœ‰æ”¾ä¹‹å››æµ·è€Œçš†å‡†çš„é˜ˆå€¼ï¼Œéœ€è¦ç»¼åˆè€ƒé‡å¤šä¸ªå› ç´ ï¼š</strong></p><ol><li><strong>æ•°æ®é‡ (æœ€æ ¸å¿ƒå› ç´ )ï¼š</strong><ul><li><strong>å•è¡¨è¡Œæ•°ï¼š</strong> è¿™æ˜¯æœ€ç›´è§‚çš„æŒ‡æ ‡ã€‚ä¸šç•Œç»éªŒå€¼é€šå¸¸è®¤ä¸ºï¼š<ul><li><code>ç™¾ä¸‡çº§åˆ« (1M+)</code>ï¼šéœ€è¦å¼€å§‹å…³æ³¨å•è¡¨æ€§èƒ½ï¼Œä¼˜åŒ–ç´¢å¼•å’ŒSQLã€‚</li><li><code>åƒä¸‡çº§åˆ« (10M+)</code>ï¼šæ€§èƒ½ç“¶é¢ˆå¼€å§‹æ˜¾ç°ï¼ˆå¦‚å¤æ‚æŸ¥è¯¢å˜æ…¢ã€count(<em>)æ…¢ã€DDLæ“ä½œè€—æ—¶ï¼‰ã€‚*<em>è¿™æ˜¯éœ€è¦è®¤çœŸè¯„ä¼°æ˜¯å¦éœ€è¦åˆ†è¡¨çš„é‡è¦ä¿¡å·åŒºã€‚</em></em></li><li><code>äº¿çº§åˆ« (100M+)</code>ï¼š<strong>ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå•è¡¨å·²éš¾ä»¥æ”¯æ’‘é«˜æ•ˆæ“ä½œï¼Œå¼ºçƒˆå»ºè®®è¿›è¡Œåˆ†è¡¨ã€‚</strong> ç´¢å¼•ç»´æŠ¤æˆæœ¬ã€æŸ¥è¯¢æ•ˆç‡ã€ç»´æŠ¤æ“ä½œï¼ˆå¤‡ä»½ã€è¿ç§»ã€åŠ å­—æ®µï¼‰éƒ½æˆä¸ºä¸¥é‡é—®é¢˜ã€‚</li></ul></li><li><strong>è¡¨æ•°æ®å¤§å°ï¼š</strong> å³ä½¿è¡Œæ•°ä¸å¤šï¼Œä½†å¦‚æœå•è¡Œæ•°æ®éå¸¸å¤§ï¼ˆå¦‚åŒ…å«å¤§æ–‡æœ¬ã€BLOBå­—æ®µï¼‰ï¼Œå¯¼è‡´å•è¡¨æ•°æ®æ–‡ä»¶å·¨å¤§ï¼ˆå¦‚å‡ åGBç”šè‡³ä¸Šç™¾GBï¼‰ï¼Œä¹Ÿä¼šä¸¥é‡å½±å“æ€§èƒ½ï¼ˆç‰¹åˆ«æ˜¯å…¨è¡¨æ‰«æã€å¤‡ä»½æ¢å¤ï¼‰å’Œç£ç›˜IOï¼Œéœ€è¦è€ƒè™‘å‚ç›´æ‹†åˆ†æˆ–åˆ†è¡¨ã€‚</li></ul></li><li><strong>å¹¶å‘è®¿é—®é‡ (QPS&#x2F;TPS)ï¼š</strong><ul><li>å³ä½¿æ•°æ®é‡ä¸å¤§ï¼Œä½†<strong>æé«˜çš„å¹¶å‘è¯»å†™è¯·æ±‚</strong>ä¹Ÿå¯èƒ½å‹å®å•åº“å•è¡¨ï¼ˆè¿æ¥æ•°è€—å°½ã€CPU&#x2F;IOç“¶é¢ˆã€é”ç«äº‰æ¿€çƒˆï¼‰ã€‚</li><li>å¦‚æœå•åº“å®ä¾‹çš„è¿æ¥æ•°ã€CPUåˆ©ç”¨ç‡ã€ç£ç›˜IOæŒç»­åœ¨é«˜ä½ï¼ˆå¦‚&gt;70%ï¼‰ï¼Œä¸”ä¼˜åŒ–SQLå’Œç´¢å¼•æ•ˆæœæœ‰é™ï¼Œå°±éœ€è¦è€ƒè™‘åˆ†åº“æ¥åˆ†æ‹…è´Ÿè½½ã€‚</li></ul></li><li><strong>ç¡¬ä»¶é…ç½®ï¼š</strong><ul><li>ä½¿ç”¨é¡¶é…çš„SSDã€å¤§å†…å­˜ã€å¤šæ ¸CPUçš„æ•°æ®åº“æœåŠ¡å™¨ï¼Œèƒ½æ”¯æ’‘çš„å•è¡¨æ•°æ®é‡å’Œå¹¶å‘é‡è¿œé«˜äºæ™®é€šé…ç½®çš„æœºå™¨ã€‚è¯„ä¼°æ˜¯å¦éœ€è¦åˆ†åº“åˆ†è¡¨æ—¶ï¼Œè¦åŸºäºå½“å‰å’Œæœªæ¥è§„åˆ’çš„å®é™…ç¡¬ä»¶æ°´å¹³ã€‚</li></ul></li><li><strong>ä¸šåŠ¡å¤æ‚åº¦å’ŒæŸ¥è¯¢æ¨¡å¼ï¼š</strong><ul><li>ä¸šåŠ¡é€»è¾‘ç®€å•ï¼ŒæŸ¥è¯¢æ¨¡å¼å›ºå®šï¼ˆæ€»æ˜¯é€šè¿‡é«˜æ•ˆç´¢å¼•è®¿é—®ï¼‰ï¼Œå•è¡¨èƒ½æ”¯æ’‘çš„æ•°æ®é‡ä¼šæ›´å¤§ã€‚</li><li>ä¸šåŠ¡å¤æ‚ï¼Œæ¶‰åŠå¤šè¡¨å…³è”ã€å¤æ‚æŸ¥è¯¢ã€èšåˆã€æ’åºåˆ†é¡µç­‰æ“ä½œï¼Œå³ä½¿æ•°æ®é‡ä¸å¤§ï¼Œä¹Ÿå¯èƒ½å› ä¸ºæŸ¥è¯¢æ•ˆç‡ä½ä¸‹è€Œéœ€è¦æå‰è€ƒè™‘æ‹†åˆ†ã€‚</li></ul></li><li><strong>å¢é•¿é€Ÿåº¦ï¼š</strong><ul><li>æ•°æ®é‡å¢é•¿<strong>éå¸¸å¿«</strong>çš„ä¸šåŠ¡ï¼ˆå¦‚æ—¥å¢ç™¾ä¸‡çº§è®°å½•ï¼‰ï¼Œå³ä½¿å½“å‰æ•°æ®é‡ä¸å¤§ï¼Œä¹Ÿéœ€è¦æå‰è§„åˆ’åˆ†åº“åˆ†è¡¨æ–¹æ¡ˆï¼Œé¿å…æœªæ¥è¢«åŠ¨ã€‚</li></ul></li><li><strong>å¯ç”¨æ€§å’Œæ‰©å±•æ€§è¦æ±‚ï¼š</strong><ul><li>å¯¹ç³»ç»Ÿå¯ç”¨æ€§è¦æ±‚æé«˜ï¼ˆå¦‚é‡‘èæ ¸å¿ƒç³»ç»Ÿï¼‰ï¼Œéœ€è¦é¿å…å•ç‚¹æ•…éšœï¼Œåˆ†åº“æœ¬èº«ï¼ˆé…åˆä¸»ä»å¤åˆ¶ï¼‰èƒ½æé«˜å¯ç”¨æ€§ã€‚</li><li>æ˜ç¡®çŸ¥é“ä¸šåŠ¡æœªæ¥ä¼šå¿«é€Ÿå¢é•¿ï¼Œéœ€è¦ç³»ç»Ÿå…·å¤‡æ°´å¹³æ‰©å±•èƒ½åŠ›ï¼Œåˆ†åº“åˆ†è¡¨æ˜¯æ ¸å¿ƒæ‰‹æ®µã€‚</li></ul></li></ol><p><strong>æ€»ç»“åˆ¤æ–­æ ‡å‡†</strong>ï¼ˆç»éªŒæ³•åˆ™ï¼Œéç»å¯¹ï¼‰</p><ol><li><strong>é¢„è­¦ä¿¡å· (å¼€å§‹è®¤çœŸè¯„ä¼°)ï¼š</strong><ul><li>å•è¡¨è¡Œæ•°é€¼è¿‘æˆ–è¶…è¿‡ <code>500ä¸‡ - 1000ä¸‡</code>ã€‚</li><li>å•è¡¨æ•°æ®æ–‡ä»¶å¤§å°è¾¾åˆ° <code>å‡ åGB</code>ã€‚</li><li>å…³é”®ä¸šåŠ¡æŸ¥è¯¢å“åº”æ—¶é—´æ˜æ˜¾å˜é•¿ï¼ˆ&gt;å‡ ç™¾æ¯«ç§’ï¼‰ï¼Œä¸”ä¼˜åŒ–ç©ºé—´æœ‰é™ã€‚</li><li>DDLæ“ä½œï¼ˆå¦‚åŠ ç´¢å¼•ã€æ”¹å­—æ®µï¼‰è€—æ—¶è¿‡é•¿ï¼ˆ&gt;åˆ†é’Ÿçº§ï¼‰ï¼Œå½±å“ä¸šåŠ¡ã€‚</li><li>æ•°æ®åº“æœåŠ¡å™¨CPUã€IOã€è¿æ¥æ•°ç­‰å…³é”®æŒ‡æ ‡æŒç»­é«˜ä½ï¼ˆ&gt;70%ï¼‰ã€‚</li><li>æ•°æ®é‡æˆ–å¹¶å‘é‡é¢„è®¡åœ¨æœªæ¥6-12ä¸ªæœˆå†…ä¼šå¢é•¿æ•°å€ã€‚</li></ul></li><li><strong>å¼ºçƒˆå»ºè®®å®æ–½ï¼š</strong><ul><li>å•è¡¨è¡Œæ•°è¶…è¿‡ <code>5000ä¸‡ - 1äº¿</code>ã€‚</li><li>å•è¡¨æ•°æ®æ–‡ä»¶å¤§å°è¾¾åˆ° <code>æ•°ç™¾GB</code>ã€‚</li><li>æ•°æ®åº“æ€§èƒ½ç“¶é¢ˆæˆä¸ºä¸šåŠ¡å‘å±•çš„æ˜æ˜¾é˜»ç¢ã€‚</li><li>é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œé¢‘ç¹å‡ºç°é”è¶…æ—¶ã€è¿æ¥æ± è€—å°½ç­‰é—®é¢˜ã€‚</li></ul></li></ol><p><strong>é‡è¦å»ºè®®</strong></p><ol><li><strong>ä¸è¦è¿‡æ—©ä¼˜åŒ–ï¼š</strong> åˆ†åº“åˆ†è¡¨å¸¦æ¥å·¨å¤§å¤æ‚æ€§ã€‚åœ¨æ•°æ®é‡å’Œå¹¶å‘é‡çœŸæ­£æˆä¸ºç“¶é¢ˆä¹‹å‰ï¼Œä¼˜å…ˆä½¿ç”¨æ›´ç®€å•çš„æ‰‹æ®µï¼š<ul><li><strong>ç¡¬ä»¶å‡çº§ï¼š</strong> æå‡CPUã€å†…å­˜ã€æ¢SSDã€‚</li><li><strong>æ•°æ®åº“ä¼˜åŒ–ï¼š</strong> ä¼˜åŒ–æ…¢æŸ¥è¯¢SQLã€åˆç†è®¾è®¡ç´¢å¼•ã€è°ƒæ•´æ•°æ®åº“å‚æ•°ã€‚</li><li><strong>è¯»å†™åˆ†ç¦»ï¼š</strong> ç”¨ä¸»åº“å†™ï¼Œå¤šä¸ªä»åº“è¯»ï¼Œåˆ†æ‹…è¯»è´Ÿè½½ã€‚</li><li><strong>ç¼“å­˜ï¼š</strong> ä½¿ç”¨Redisã€Memcachedç­‰ç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼Œå‡å°‘æ•°æ®åº“è®¿é—®ã€‚</li><li><strong>å½’æ¡£&#x2F;æ¸…ç†ï¼š</strong> å°†å†å²å†·æ•°æ®è¿ç§»åˆ°å½’æ¡£åº“æˆ–åˆ é™¤ã€‚</li><li><strong>æ•°æ®åº“åˆ†åŒº (Partitioning)ï¼š</strong> å¦‚æœæ•°æ®åº“æœ¬èº«æ”¯æŒï¼ˆå¦‚MySQLçš„Partitioningï¼‰ï¼Œå¯ä»¥åœ¨å•åº“å†…è¿›è¡Œæ°´å¹³åˆ†åŒºï¼Œç®¡ç†æ¯”å•è¡¨å¤§å¾—å¤šçš„æ•°æ®é‡ï¼Œæ¯”åº”ç”¨å±‚åˆ†è¡¨ç®€å•å¾ˆå¤šã€‚ä½†åˆ†åŒºä¸èƒ½è§£å†³å•åº“èµ„æºç“¶é¢ˆï¼ˆCPU&#x2F;IO&#x2F;è¿æ¥æ•°ï¼‰å’Œå†™è´Ÿè½½é—®é¢˜ã€‚</li></ul></li><li><strong>ç²¾å¿ƒè®¾è®¡ï¼š</strong> ä¸€æ—¦å†³å®šåˆ†åº“åˆ†è¡¨ï¼Œå¿…é¡»æŠ•å…¥ç²¾åŠ›åšå¥½è®¾è®¡ï¼Œå°¤å…¶æ˜¯<strong>åˆ†ç‰‡é”®çš„é€‰æ‹©</strong>ã€<strong>æ‹†åˆ†è§„åˆ™</strong>ã€<strong>åˆ†å¸ƒå¼ID</strong>ã€<strong>åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ</strong>ã€<strong>æ•°æ®è¿ç§»å’Œæ‰©å®¹æ–¹æ¡ˆ</strong>ã€‚å‰æœŸè®¾è®¡å¤±è¯¯ä¼šå¯¼è‡´åæœŸç»´æŠ¤æˆæœ¬å‰§å¢ã€‚</li><li><strong>é€‰æ‹©åˆé€‚çš„ä¸­é—´ä»¶ï¼š</strong> ä½¿ç”¨æˆç†Ÿçš„æ•°æ®åº“ä¸­é—´ä»¶ï¼ˆå¦‚ShardingSphere, MyCat, Vitessç­‰ï¼‰å¯ä»¥å¤§å¤§ç®€åŒ–åˆ†åº“åˆ†è¡¨çš„å¼€å‘å’Œç®¡ç†å·¥ä½œï¼Œå®ƒä»¬å¸®ä½ å¤„ç†è·¯ç”±ã€åˆ†å¸ƒå¼äº‹åŠ¡ã€è·¨åº“æŸ¥è¯¢ç­‰éš¾é¢˜ã€‚</li></ol><p><strong>ç»“è®ºï¼š</strong> åˆ†åº“åˆ†è¡¨æ˜¯è§£å†³æµ·é‡æ•°æ®å’Œé«˜å¹¶å‘é—®é¢˜çš„ç»ˆææ‰‹æ®µä¹‹ä¸€ï¼Œä½†å…¶å¤æ‚æ€§æé«˜ã€‚è§¦å‘ç‚¹é€šå¸¸æ˜¯å•è¡¨æ•°æ®é‡è¾¾åˆ°<strong>åƒä¸‡çº§ï¼ˆ10M+ï¼‰å¹¶ä¼´éšæ€§èƒ½ç“¶é¢ˆ</strong>ï¼Œæˆ–<strong>é«˜å¹¶å‘å¯¼è‡´å•åº“èµ„æºè€—å°½</strong>ã€‚åŠ¡å¿…ä¼˜å…ˆå°è¯•æ›´ç®€å•çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œå¹¶åœ¨çœŸæ­£éœ€è¦æ—¶ï¼Œè¿›è¡Œå……åˆ†è¯„ä¼°å’Œç²¾å¿ƒè®¾è®¡ã€‚æ²¡æœ‰å›ºå®šçš„â€œå¤šå¤§å¿…é¡»åˆ†â€çš„æ•°å­—ï¼Œå¿…é¡»ç»“åˆå…·ä½“ä¸šåŠ¡åœºæ™¯ã€æ•°æ®ç‰¹æ€§ã€ç¡¬ä»¶é…ç½®å’Œå¢é•¿é¢„æœŸç»¼åˆåˆ¤æ–­ã€‚</p><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><h3 id="Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿå•çº¿ç¨‹å¦‚ä½•å¤„ç†é«˜å¹¶å‘ï¼Ÿ"><a href="#Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿå•çº¿ç¨‹å¦‚ä½•å¤„ç†é«˜å¹¶å‘ï¼Ÿ" class="headerlink" title="Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿå•çº¿ç¨‹å¦‚ä½•å¤„ç†é«˜å¹¶å‘ï¼Ÿ"></a>Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿå•çº¿ç¨‹å¦‚ä½•å¤„ç†é«˜å¹¶å‘ï¼Ÿ</h3><p>å¯¹äºRedisçš„é«˜æ€§èƒ½è®¾è®¡ï¼Œæˆ‘çš„ç†è§£ä¸»è¦å¾—ç›Šäºä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>å†…å­˜æ“ä½œï¼šRedisæ•°æ®å­˜å‚¨åœ¨å†…å­˜ï¼Œç›¸æ¯”äºç£ç›˜æ•°æ®åº“ï¼Œå‡å°‘äº†IOå¼€é”€</li><li>é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼šRedisé’ˆå¯¹ä¸åŒåœºæ™¯è®¾è®¡äº†ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œä¼˜åŒ–äº†ç©ºé—´å’Œè®¿é—®æ•ˆç‡</li><li>å•çº¿ç¨‹ï¼šRedisä½¿ç”¨å•çº¿ç¨‹å¤„ç†å‘½ä»¤ï¼Œé¿å…äº†å¤šçº¿ç¨‹ä¹‹é—´çš„ç«äº‰å’Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€</li><li>IOå¤šè·¯å¤ç”¨ï¼šRedisåŸºäºepoll&#x2F;kqueueå®ç°äº†éé˜»å¡çš„ç½‘ç»œæ¨¡å‹ï¼Œé€šè¿‡äº‹ä»¶æœºåˆ¶å¾ªç¯å¤„ç†è¯·æ±‚</li></ul><p><strong>è¿½é—®1ï¼šå•çº¿ç¨‹å¦‚ä½•åˆ©ç”¨å¤šæ ¸CPU</strong></p><p>å¯ä»¥éƒ¨ç½²åˆ†ç‰‡é›†ç¾¤ï¼Œæ¯ä¸ªRediså®ä¾‹ç»‘å®šä¸€ä¸ªCPUæ ¸ï¼ˆå¦‚ä½•éƒ¨ç½²å’Œç»‘å®šï¼Ÿï¼‰</p><p><strong>è¿½é—®2ï¼šä¸ºä»€ä¹ˆé€‰ç”¨å•çº¿ç¨‹è€Œä¸æ˜¯å¤šçº¿ç¨‹</strong></p><ul><li>é¿å…é”ç«äº‰</li><li>é¿å…ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€</li><li>å¤šçº¿ç¨‹å†…å­˜ç®¡ç†å¤æ‚</li></ul><p><strong>è¿½é—®3ï¼š ä»€ä¹ˆåœºæ™¯ä¸‹å•çº¿ç¨‹ä¼šæˆä¸ºç“¶é¢ˆ</strong></p><ul><li>è¶…å¤§ Value æ“ä½œï¼ˆå¦‚10MBçš„stringï¼‰ï¼ˆä»€ä¹ˆæ“ä½œï¼Œæ™®é€šè¯»å†™å°±ä¼šé˜»å¡å—ï¼‰</li><li>å¤æ‚ Lua è„šæœ¬æ‰§è¡Œï¼ˆé˜»å¡å…¶ä»–å‘½ä»¤ï¼‰</li></ul><p><strong>Qï¼šRedisæœ‰å“ªäº›æ•°æ®ç»“æ„ï¼Œåˆ†åˆ«æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯åœºæ™¯ï¼Ÿ</strong></p><p>Redisçš„åŸºç¡€æ•°æ®ç»“æ„åŒ…æ‹¬stringã€hashã€listã€setã€zsetï¼Œé«˜çº§æ•°æ®ç»“æ„åŒ…æ‹¬hyperloglogã€geoã€bitmapã€stream</p><h3 id="ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€-é›ªå´©-å‡»ç©¿ï¼Œå¯¹åº”çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ"><a href="#ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€-é›ªå´©-å‡»ç©¿ï¼Œå¯¹åº”çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€&#x2F;é›ªå´©&#x2F;å‡»ç©¿ï¼Œå¯¹åº”çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ"></a>ä»€ä¹ˆæ˜¯ç¼“å­˜ç©¿é€&#x2F;é›ªå´©&#x2F;å‡»ç©¿ï¼Œå¯¹åº”çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ</h3><p><strong>ç¼“å­˜ç©¿é€</strong>æ˜¯æŒ‡æŸ¥è¯¢æ•°æ®åº“ä¸­ä¸å­˜åœ¨çš„æ•°æ®ï¼Œå¯¼è‡´è¯·æ±‚æ¯æ¬¡éƒ½ç©¿è¿‡ç¼“å­˜æŸ¥è¯¢æ•°æ®åº“ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li><strong>å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰</strong></li></ul><p>æœåŠ¡å¯åŠ¨æ—¶åŠ è½½å…¨é‡æœ‰æ•ˆkeyï¼Œæ ‡è®°æ•°æ®æ˜¯å¦å­˜åœ¨ï¼›æ–°å¢æ•°æ®æ—¶åŒæ­¥æ›´æ–°è¿‡æ»¤å™¨</p><p>ç¼ºç‚¹ï¼šå­˜åœ¨ä¸€å®šçš„è¯¯åˆ¤ç‡</p><ul><li><strong>ç¼“å­˜ç©ºå€¼</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getData</span><span class="params">(String key)</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> redis.get(key);</span><br><span class="line">    <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (value <span class="keyword">instanceof</span> NullValue) &#123; <span class="comment">// ç©ºå€¼æ ‡è®°</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    value = db.query(key);</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">        redis.setex(key, <span class="number">300</span>, <span class="keyword">new</span> <span class="title class_">NullValue</span>()); <span class="comment">// ç¼“å­˜ç©ºå€¼5åˆ†é’Ÿ</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        redis.setex(key, <span class="number">3600</span>, value); <span class="comment">// æ­£å¸¸ç¼“å­˜1å°æ—¶</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¢å¼ºè¯·æ±‚å‚æ•°çš„å¤æ‚åº¦ï¼Œé¿å…è¢«çŒœæµ‹ï¼ŒåŒæ—¶åšå¥½æ•°æ®çš„åŸºç¡€æ ¼å¼æ ¡éªŒ</li></ul><p><strong>ç¼“å­˜é›ªå´©</strong>æ˜¯æŒ‡<strong>å¤§é‡key</strong>åŒæ—¶å¤±æ•ˆï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚éƒ½å»æŸ¥è¯¢æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“å‹åŠ›éª¤å¢ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li><strong>å·®å¼‚åŒ–è¿‡æœŸæ—¶é—´</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸºç¡€è¿‡æœŸæ—¶é—´ï¼Œ1å°æ—¶</span></span><br><span class="line"><span class="type">int</span> <span class="variable">baseExpire</span> <span class="operator">=</span> <span class="number">3600</span>;</span><br><span class="line"><span class="comment">// éšæœº0-5åˆ†é’Ÿ</span></span><br><span class="line"><span class="type">int</span> <span class="variable">randomExpire</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(<span class="number">300</span>);</span><br><span class="line">redis.setex(key, baseExpire + randomExpire, value);</span><br></pre></td></tr></table></figure><ul><li><strong>æ°¸ä¸è¿‡æœŸ+å¼‚æ­¥æ›´æ–°</strong></li><li><strong>æ·»åŠ é™çº§é™æµç­–ç•¥</strong></li><li><strong>æ·»åŠ å¤šçº§ç¼“å­˜</strong></li></ul><p><strong>ç¼“å­˜å‡»ç©¿</strong>æ˜¯æŒ‡æŸä¸ª<strong>çƒ­ç‚¹key</strong>å¤±æ•ˆçš„ç¬é—´ï¼Œæœ‰å¤§é‡è¯·æ±‚åŒæ—¶è®¿é—®è¿™ä¸ªkeyï¼Œå¯¼è‡´æ‰€æœ‰è¯·æ±‚éƒ½å»æŸ¥è¯¢æ•°æ®åº“ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li><strong>äº’æ–¥é”</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> Redission.getLock(<span class="string">&quot;PREFIX:&quot;</span> + key);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (lock.tryLock(<span class="number">3</span>, <span class="number">30</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">        <span class="comment">// æŸ¥åº“å¹¶é‡å»ºç¼“å­˜</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>é€»è¾‘è¿‡æœŸ</strong></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="string">&quot;çœŸå®æ•°æ®&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;expire_ts&quot;</span><span class="punctuation">:</span> <span class="number">1672502400</span> <span class="comment">// é€»è¾‘è¿‡æœŸæ—¶é—´æˆ³</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å¤„ç†æµç¨‹ï¼š</p><ol><li>åˆ¤æ–­é€»è¾‘è¿‡æœŸæ—¶é—´<ol><li>æœªè¿‡æœŸï¼Œç›´æ¥è¿”å›æ•°æ®</li><li>å·²è¿‡æœŸï¼Œåˆ›å»ºå­çº¿ç¨‹ï¼Œå¼‚æ­¥é‡å»ºç¼“å­˜</li></ol></li></ol><table><thead><tr><th>è§£å†³æ–¹æ¡ˆ</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>äº’æ–¥é”</td><td>å®ç°ç®€å•ï¼›ä¿è¯ä¸€è‡´æ€§ï¼›æ— éœ€æ¶ˆè€—é¢å¤–å†…å­˜</td><td>çº¿ç¨‹éœ€ç­‰å¾…ï¼Œå½±å“æ€§èƒ½</td></tr><tr><td>é€»è¾‘è¿‡æœŸ</td><td>çº¿ç¨‹æ— éœ€ç­‰å¾…ï¼Œæ€§èƒ½è¾ƒå¥½</td><td>å­˜åœ¨ä¸ä¸€è‡´æ€§ï¼›æ¶ˆè€—é¢å¤–å†…å­˜ï¼›å®ç°å¤æ‚</td></tr></tbody></table><h3 id="å¸ƒéš†è¿‡æ»¤å™¨"><a href="#å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨"></a>å¸ƒéš†è¿‡æ»¤å™¨</h3><p>å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰æ˜¯ä¸€ç§ç©ºé—´é«˜æ•ˆã€å¿«é€Ÿåˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­çš„æ•°æ®ç»“æ„ã€‚å®ƒç”±å¸ƒéš†äº1970å¹´æå‡ºï¼Œä¸»è¦ç”¨äºå¤§è§„æ¨¡æ•°æ®é›†åˆçš„å¿«é€ŸæŸ¥æ‰¾å’Œå»é‡ã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨çš„åŸºæœ¬æ€æƒ³æ˜¯ä½¿ç”¨å¤šä¸ªç‹¬ç«‹çš„å“ˆå¸Œå‡½æ•°å°†å…ƒç´ æ˜ å°„åˆ°ä¸€ä¸ªä½æ•°ç»„ï¼ˆæˆ–ç§°ä¸ºå¸ƒéš†è¿‡æ»¤å™¨çš„ä½å‘é‡ï¼‰ä¸­ï¼Œå¹¶å°†è¿™äº›ä½æ•°ç»„åˆå§‹åŒ–ä¸º0ã€‚å½“è¦æ’å…¥ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œé€šè¿‡è¿™äº›å“ˆå¸Œå‡½æ•°è®¡ç®—å¾—åˆ°çš„å¤šä¸ªå“ˆå¸Œå€¼å¯¹åº”çš„ä½éƒ½è¢«è®¾ç½®ä¸º1ã€‚å½“è¦æŸ¥è¯¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨æ—¶ï¼ŒåŒæ ·é€šè¿‡è¿™äº›å“ˆå¸Œå‡½æ•°è®¡ç®—å¾—åˆ°çš„å¤šä¸ªå“ˆå¸Œå€¼å¯¹åº”çš„ä½éƒ½è¢«æ£€æŸ¥ï¼Œå¦‚æœå…¶ä¸­æœ‰ä»»æ„ä¸€ä¸ªä½ä¸º0ï¼Œåˆ™è¡¨ç¤ºå…ƒç´ ä¸€å®šä¸å­˜åœ¨ï¼›å¦‚æœæ‰€æœ‰ä½éƒ½ä¸º1ï¼Œåˆ™è¡¨ç¤ºå…ƒç´ å¯èƒ½å­˜åœ¨ï¼Œä½†å¹¶ä¸ä¸€å®šå­˜åœ¨ï¼Œå¯èƒ½ä¼šå­˜åœ¨ä¸€å®šçš„è¯¯åˆ¤ç‡ã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨çš„ä¼˜ç‚¹æ˜¯å ç”¨ç©ºé—´å°ï¼Œæ’å…¥å’ŒæŸ¥è¯¢æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(k)ï¼Œå…¶ä¸­kæ˜¯å“ˆå¸Œå‡½æ•°çš„æ•°é‡ã€‚æ­¤å¤–ï¼Œå¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥å¤„ç†éå¸¸å¤§çš„æ•°æ®é›†åˆï¼Œè€Œä¸”å¯¹äºæ’å…¥å’ŒæŸ¥è¯¢æ“ä½œçš„å“åº”é€Ÿåº¦éå¸¸å¿«ã€‚ç„¶è€Œï¼Œå¸ƒéš†è¿‡æ»¤å™¨çš„ç¼ºç‚¹æ˜¯å­˜åœ¨ä¸€å®šçš„è¯¯åˆ¤ç‡ï¼Œå³åœ¨æŸ¥è¯¢æ—¶å¯èƒ½ä¼šå‡ºç°â€è¯¯åˆ¤ä¸ºå­˜åœ¨â€çš„æƒ…å†µï¼Œå› æ­¤åœ¨ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„é€‰æ‹©åˆé€‚çš„å“ˆå¸Œå‡½æ•°æ•°é‡å’Œä½æ•°ç»„å¤§å°ï¼Œä»¥åŠåˆç†è®¾ç½®è¯¯åˆ¤ç‡çš„é˜ˆå€¼ã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨åœ¨å®é™…åº”ç”¨ä¸­æœ‰å¾ˆå¤šç”¨é€”ï¼Œä¾‹å¦‚åœ¨æ•°æ®åº“ã€ç¼“å­˜ã€ç½‘ç»œè·¯ç”±å™¨ã€çˆ¬è™«ç­‰é¢†åŸŸä¸­éƒ½æœ‰å¹¿æ³›çš„åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§è§„æ¨¡æ•°æ®é›†åˆæ—¶ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘å­˜å‚¨å’ŒæŸ¥è¯¢çš„å¼€é”€ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¸ƒéš†è¿‡æ»¤å™¨å¹¶ä¸é€‚ç”¨äºæ‰€æœ‰æƒ…å†µï¼Œå› ä¸ºå®ƒå­˜åœ¨ä¸€å®šçš„è¯¯åˆ¤ç‡ï¼Œå¹¶ä¸”æ— æ³•åˆ é™¤å·²æ’å…¥çš„å…ƒç´ ï¼Œå› æ­¤åœ¨é€‰æ‹©ä½¿ç”¨æ—¶éœ€è¦æ ¹æ®å…·ä½“åº”ç”¨åœºæ™¯è¿›è¡Œè¯„ä¼°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.BitSet;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.security.NoSuchAlgorithmException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BloomFilter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> BitSet bitArray;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> m; <span class="comment">// ä½æ•°ç»„çš„å¤§å°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> k; <span class="comment">// å“ˆå¸Œå‡½æ•°çš„æ•°é‡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BloomFilter</span><span class="params">(<span class="type">int</span> m, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.m = m;</span><br><span class="line">        <span class="built_in">this</span>.k = k;</span><br><span class="line">        <span class="built_in">this</span>.bitArray = <span class="keyword">new</span> <span class="title class_">BitSet</span>(m);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] hash(String data) &#123;</span><br><span class="line">        <span class="type">int</span>[] hashValues = <span class="keyword">new</span> <span class="title class_">int</span>[k];</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MessageDigest</span> <span class="variable">md</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;SHA-256&quot;</span>);</span><br><span class="line">            <span class="type">byte</span>[] hashBytes = md.digest(data.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">                hashValues[i] = Math.abs((<span class="type">int</span>) (hashBytes[(i * <span class="number">4</span>) % hashBytes.length]) % m);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hashValues;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] hashValues = hash(data);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> hashValue : hashValues) &#123;</span><br><span class="line">            bitArray.set(hashValue);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">query</span><span class="params">(String data)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] hashValues = hash(data);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> hashValue : hashValues) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!bitArray.get(hashValue)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºå¸ƒéš†è¿‡æ»¤å™¨ï¼Œä½æ•°ç»„å¤§å°ä¸º100ï¼Œå“ˆå¸Œå‡½æ•°æ•°é‡ä¸º3</span></span><br><span class="line">        <span class="type">BloomFilter</span> <span class="variable">bloomFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BloomFilter</span>(<span class="number">100</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ’å…¥å…ƒç´ </span></span><br><span class="line">        bloomFilter.insert(<span class="string">&quot;apple&quot;</span>);</span><br><span class="line">        bloomFilter.insert(<span class="string">&quot;banana&quot;</span>);</span><br><span class="line">        bloomFilter.insert(<span class="string">&quot;cherry&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŸ¥è¯¢å…ƒç´ æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        System.out.println(bloomFilter.query(<span class="string">&quot;apple&quot;</span>)); <span class="comment">// true</span></span><br><span class="line">        System.out.println(bloomFilter.query(<span class="string">&quot;grape&quot;</span>)); <span class="comment">// false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="RDBå’ŒAOFæŒä¹…åŒ–åŸç†åŠä¼˜åŠ£å¯¹æ¯”"><a href="#RDBå’ŒAOFæŒä¹…åŒ–åŸç†åŠä¼˜åŠ£å¯¹æ¯”" class="headerlink" title="RDBå’ŒAOFæŒä¹…åŒ–åŸç†åŠä¼˜åŠ£å¯¹æ¯”"></a>RDBå’ŒAOFæŒä¹…åŒ–åŸç†åŠä¼˜åŠ£å¯¹æ¯”</h3><p>RDBï¼Œå­˜å‚¨æŸä¸€æ—¶åˆ»å†…å­˜ä¸­æ‰€æœ‰çš„æ•°æ®ï¼Œè§¦å‘å‘½ä»¤<code>save</code>ã€<code>bgsave</code>ï¼Œä¸»è¿›ç¨‹<code>fork</code>å­è¿›ç¨‹ï¼Œé˜»å¡ã€‚</p><p>è§¦å‘æ¡ä»¶ï¼š</p><ol><li>å®¢æˆ·ç«¯å‘é€<code>shutdown</code></li><li>ä»èŠ‚ç‚¹è¦è¿›è¡Œå…¨é‡å¤åˆ¶</li><li>è¾¾åˆ°<code>redis.conf</code>æ–‡ä»¶ä¸­é…ç½®çš„æ¡ä»¶</li><li>å®¢æˆ·ç«¯æ‰§è¡Œ<code>flushall</code>ï¼ˆç”Ÿæˆç©ºçš„<code>dump.rdb</code>ï¼Œæ…ç”¨ï¼‰</li></ol><p>ä¸èƒ½é¢‘ç¹ç”Ÿæˆ RBD å¿«ç…§ï¼ŒåŸå› ï¼š</p><ul><li>å¤šæ¬¡ RDB ä¼šç«äº‰ç£ç›˜å¸¦å®½</li><li><code>fork</code> å­è¿›ç¨‹ä¼šé˜»å¡ä¸»è¿›ç¨‹</li></ul><p>å†™æ—¶å¤åˆ¶<code>copy-on-write</code>ï¼š</p><ul><li><strong>å…±äº«å†…å­˜åˆå§‹åŒ–</strong>ï¼šå­è¿›ç¨‹åˆšåˆ›å»ºæ—¶ï¼Œ<strong>ä¸çˆ¶è¿›ç¨‹å…±äº«å…¨éƒ¨å†…å­˜é¡µ</strong>ï¼Œæ­¤æ—¶å†…å­˜å ç”¨å‡ ä¹æ— é¢å¤–å¼€é”€ã€‚</li><li><strong>å†™æ“ä½œè§¦å‘å¤åˆ¶</strong>ï¼šè‹¥çˆ¶è¿›ç¨‹æ”¶åˆ°å†™è¯·æ±‚ï¼ˆä¿®æ”¹æ•°æ®ï¼‰ï¼Œæ“ä½œç³»ç»Ÿä¼š<strong>å°†è¢«ä¿®æ”¹çš„å†…å­˜é¡µå¤åˆ¶ä¸€ä»½</strong>ï¼Œçˆ¶è¿›ç¨‹åœ¨å‰¯æœ¬ä¸Šä¿®æ”¹ï¼Œå­è¿›ç¨‹ä»è¯»å–åŸå§‹é¡µã€‚</li><li><strong>å­è¿›ç¨‹è§†è§’å›ºå®š</strong>ï¼šå­è¿›ç¨‹çœ‹åˆ°çš„æ•°æ®å§‹ç»ˆæ˜¯ <code>fork()</code> ç¬é—´çš„çŠ¶æ€ï¼Œç¡®ä¿å¿«ç…§ä¸€è‡´æ€§ã€‚</li></ul><p>AOFï¼Œæ‰€æœ‰å†™å‘½ä»¤è¿½åŠ åˆ° <code>aof_buf</code>ï¼Œåˆ·ç›˜ç­–ç•¥ç”± <code>appendfsync</code> å†³å®šã€‚</p><p>å¦‚æœæœ‰ AOF æ–‡ä»¶ï¼ŒåŠ è½½ AOFï¼›å¦åˆ™ï¼ŒåŠ è½½ RDB æ–‡ä»¶ã€‚AOF æœ€å¤šä¸¢å¤± 1s æ•°æ®ã€‚</p><p>AOFé‡å†™æ˜¯ç›´æ¥ä¸ºå½“å‰å†…å­˜çš„æ•°æ®ç”Ÿæˆå¯¹åº”å‘½ä»¤ï¼Œå¹¶ä¸æ˜¯è¯»å–æ—§AOFæ–‡ä»¶è¿›è¡Œå‘½ä»¤åˆå¹¶</p><ul><li>çˆ¶å­è¿›ç¨‹å†™åŒä¸€ä¸ªæ–‡ä»¶ä¼šäº§ç”Ÿç«äº‰é—®é¢˜ï¼Œå½±å“çˆ¶è¿›ç¨‹çš„æ€§èƒ½ã€‚</li><li>å¦‚æœAOFé‡å†™è¿‡ç¨‹ä¸­å¤±è´¥äº†ï¼Œç›¸å½“äºæ±¡æŸ“äº†åŸæœ¬çš„AOFæ–‡ä»¶ï¼Œæ— æ³•åšæ¢å¤æ•°æ®ä½¿ç”¨</li></ul><p>ä¿®å¤å·²æŸå®³çš„AOFæ–‡ä»¶ï¼š<code>redis-check-aof --fix appendonly.aof</code></p><table><thead><tr><th></th><th>RDB</th><th>AOF</th></tr></thead><tbody><tr><td>å¯åŠ¨åŠ è½½ä¼˜å…ˆçº§</td><td>ä½</td><td>é«˜</td></tr><tr><td>ä½“ç§¯</td><td>å°</td><td>å¤§</td></tr><tr><td>æ¢å¤é€Ÿåº¦</td><td>æ…¢</td><td>å¿«</td></tr></tbody></table><p>æ€»ç»“ï¼šRDBé€‚åˆç”¨ä½œæ•°æ®å¤‡ä»½ï¼ŒAOFé€‚åˆç”¨ä½œæ•°æ®æ¢å¤ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯çƒ­Keyé—®é¢˜"><a href="#ä»€ä¹ˆæ˜¯çƒ­Keyé—®é¢˜" class="headerlink" title="ä»€ä¹ˆæ˜¯çƒ­Keyé—®é¢˜"></a>ä»€ä¹ˆæ˜¯çƒ­Keyé—®é¢˜</h3><h3 id="Redisäº‹åŠ¡ä¸MySQLäº‹åŠ¡æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#Redisäº‹åŠ¡ä¸MySQLäº‹åŠ¡æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="Redisäº‹åŠ¡ä¸MySQLäº‹åŠ¡æœ‰ä»€ä¹ˆåŒºåˆ«"></a>Redisäº‹åŠ¡ä¸MySQLäº‹åŠ¡æœ‰ä»€ä¹ˆåŒºåˆ«</h3><h3 id="Redisåˆ†å¸ƒå¼é”"><a href="#Redisåˆ†å¸ƒå¼é”" class="headerlink" title="Redisåˆ†å¸ƒå¼é”"></a>Redisåˆ†å¸ƒå¼é”</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.ValueOperations;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisDistributedLock</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">LOCK_KEY</span> <span class="operator">=</span> <span class="string">&quot;myLock&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">LOCK_EXPIRE_TIME</span> <span class="operator">=</span> <span class="number">5000</span>; <span class="comment">// é”è¿‡æœŸæ—¶é—´ï¼Œå•ä½æ¯«ç§’</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, String&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedisDistributedLock</span><span class="params">(RedisTemplate&lt;String, String&gt; redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">acquireLock</span><span class="params">()</span> &#123;</span><br><span class="line">        ValueOperations&lt;String, String&gt; valueOperations = redisTemplate.opsForValue();</span><br><span class="line">        <span class="comment">// å°è¯•è·å–åˆ†å¸ƒå¼é”</span></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">result</span> <span class="operator">=</span> valueOperations.setIfAbsent(LOCK_KEY, <span class="string">&quot;locked&quot;</span>); <span class="comment">// RedisTemplate çš„ setIfAbsent æ–¹æ³•ï¼Œå¦‚æœé”®ä¸å­˜åœ¨åˆ™è®¾ç½®é”®å€¼å¯¹å¹¶è¿”å› trueï¼Œå¦åˆ™è¿”å› false</span></span><br><span class="line">        <span class="keyword">if</span> (result != <span class="literal">null</span> &amp;&amp; result) &#123;</span><br><span class="line">            <span class="comment">// æˆåŠŸè·å–åˆ°é”ï¼Œè®¾ç½®é”çš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line">            redisTemplate.expire(LOCK_KEY, LOCK_EXPIRE_TIME, TimeUnit.MILLISECONDS); <span class="comment">// è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ï¼Œå•ä½æ¯«ç§’</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">releaseLock</span><span class="params">()</span> &#123;</span><br><span class="line">        redisTemplate.delete(LOCK_KEY); <span class="comment">// åˆ é™¤é”®</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨åˆ†å¸ƒå¼é”çš„ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doBusinessWithLock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acquireLock()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// è·å¾—åˆ†å¸ƒå¼é”åæ‰§è¡Œä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">                System.out.println(<span class="string">&quot;Acquired lock, do business logic...&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>); <span class="comment">// æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†æ—¶é—´</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                releaseLock(); <span class="comment">// ä¸šåŠ¡å¤„ç†å®Œæˆåé‡Šæ”¾é”</span></span><br><span class="line">                System.out.println(<span class="string">&quot;Released lock.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æœªè·å¾—åˆ†å¸ƒå¼é”ï¼Œæ‰§è¡Œå…¶ä»–é€»è¾‘</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Failed to acquire lock, do other logic...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º RedisTemplate å®ä¾‹å¹¶è®¾ç½®è¿æ¥ä¿¡æ¯</span></span><br><span class="line">        RedisTemplate&lt;String, String&gt; redisTemplate = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// è®¾ç½® Redis è¿æ¥å·¥å‚ã€åºåˆ—åŒ–æ–¹å¼ç­‰</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="type">RedisDistributedLock</span> <span class="variable">distributedLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisDistributedLock</span>(redisTemplate);</span><br><span class="line">        distributedLock.doBusinessWithLock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ç«äº‰æ¡ä»¶ï¼ˆRace Conditionï¼‰ï¼šåœ¨å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶å°è¯•è·å–é”æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°ç«äº‰æ¡ä»¶ï¼Œå¯¼è‡´å¤šä¸ªå®¢æˆ·ç«¯éƒ½æˆåŠŸè·å¾—é”ï¼Œä»è€Œå¼•å‘å¹¶å‘è®¿é—®èµ„æºçš„é—®é¢˜ã€‚</li><li>æ­»é”ï¼ˆDeadlockï¼‰ï¼šå¦‚æœæŸä¸ªæŒæœ‰é”çš„å®¢æˆ·ç«¯åœ¨ä¸šåŠ¡å¤„ç†æœŸé—´å‘ç”Ÿå¼‚å¸¸æˆ–å´©æºƒï¼Œå¯¼è‡´æ²¡æœ‰é‡Šæ”¾é”çš„æ“ä½œï¼Œå¯èƒ½ä¼šå‡ºç°æ­»é”çš„æƒ…å†µï¼Œå¯¼è‡´å…¶ä»–å®¢æˆ·ç«¯æ— æ³•è·å¾—é”ã€‚</li><li>é”è¿‡æœŸï¼ˆLock Expirationï¼‰ï¼šä¸ºäº†é¿å…æ­»é”ï¼Œé€šå¸¸ä¼šç»™é”è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä½†å¦‚æœä¸šåŠ¡å¤„ç†æ—¶é—´è¾ƒé•¿ï¼Œè¶…è¿‡äº†é”çš„è¿‡æœŸæ—¶é—´ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¶ä»–å®¢æˆ·ç«¯è¯¯è®¤ä¸ºé”å·²ç»é‡Šæ”¾ï¼Œä»è€Œå¼•å‘å¹¶å‘è®¿é—®èµ„æºçš„é—®é¢˜ã€‚</li><li>é”çš„é‡å…¥æ€§ï¼ˆLock Reentrancyï¼‰ï¼šåœ¨æŸäº›åœºæ™¯ä¸‹ï¼ŒåŒä¸€ä¸ªå®¢æˆ·ç«¯å¯èƒ½éœ€è¦å¤šæ¬¡è·å–åŒä¸€ä¸ªé”ï¼Œä¾‹å¦‚åµŒå¥—çš„ä¸šåŠ¡å¤„ç†é€»è¾‘ã€‚å¦‚æœåˆ†å¸ƒå¼é”æ²¡æœ‰æ”¯æŒé”çš„é‡å…¥æ€§ï¼Œå¯èƒ½ä¼šå¯¼è‡´åŒä¸€ä¸ªå®¢æˆ·ç«¯æ— æ³•åœ¨ä¸šåŠ¡å¤„ç†æœŸé—´é‡æ–°è·å–é”ï¼Œä»è€Œå¼•å‘æ­»é”æˆ–å¹¶å‘è®¿é—®èµ„æºçš„é—®é¢˜ã€‚</li><li>æ€§èƒ½å¼€é”€ï¼ˆPerformance Overheadï¼‰ï¼šä½¿ç”¨åˆ†å¸ƒå¼é”å¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿçš„æ€§èƒ½å¼€é”€ï¼Œä¾‹å¦‚é¢‘ç¹çš„é”è·å–å’Œé”é‡Šæ”¾æ“ä½œï¼Œä»¥åŠé”çš„ç®¡ç†å’Œç»´æŠ¤ã€‚å¦‚æœé”çš„ä½¿ç”¨ä¸å½“ï¼Œå¯èƒ½ä¼šå½±å“ç³»ç»Ÿçš„æ€§èƒ½å’Œå“åº”æ—¶é—´ã€‚</li></ol><p><strong>å¦‚ä½•é¿å…è¯¯é‡Šæ”¾é”</strong></p><p>ä¸ºäº†é˜²æ­¢è¯¯åˆ å…¶ä»–é”ï¼Œå¯ä»¥é€šè¿‡<code>key</code>å¯¹åº”çš„<code>value</code>æ¥åˆ¤æ–­ã€‚ä¸ºäº†ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼ˆå…ˆæ¯”è¾ƒ<code>value</code>ï¼Œå†åˆ é™¤<code>key</code>ï¼‰ï¼Œå¯ä»¥é€šè¿‡Luaè„šæœ¬æ¥æ‰§è¡Œã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// é‡Šæ”¾é”æ—¶ï¼Œå…ˆæ¯”è¾ƒé”å¯¹åº”çš„ value å€¼æ˜¯å¦ç›¸ç­‰ï¼Œé¿å…é”çš„è¯¯é‡Šæ”¾</span><br><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&quot;get&quot;</span>,KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> redis.call(<span class="string">&quot;del&quot;</span>,KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p><strong>å¦‚ä½•å®ç°é”ç»­æœŸ</strong></p><p>åœ¨ Redis ä¸­å®ç°åˆ†å¸ƒå¼é”æ—¶ï¼Œç»­æœŸï¼ˆå³é”çš„è‡ªåŠ¨å»¶æœŸï¼‰æ˜¯ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚ï¼Œå°¤å…¶æ˜¯åœ¨é”çš„æŒæœ‰æ—¶é—´å¯èƒ½è¶…è¿‡æœ€åˆè®¾å®šçš„è¿‡æœŸæ—¶é—´æ—¶ã€‚å¸¸è§çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼ˆæˆ–å®šæ—¶ä»»åŠ¡ï¼‰å®šæœŸæ£€æŸ¥é”æ˜¯å¦ä»ç„¶è¢«æŒæœ‰ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å»¶é•¿é”çš„è¿‡æœŸæ—¶é—´ã€‚è¿™ç§æœºåˆ¶é€šå¸¸è¢«ç§°ä¸ºâ€œ<strong>çœ‹é—¨ç‹—</strong>â€ï¼ˆWatchdogï¼‰æœºåˆ¶ã€‚</p><p>åŸºäº Redis çš„åˆ†å¸ƒå¼é”ç»­æœŸçš„åŸºæœ¬æ€è·¯ï¼š</p><ol><li><strong>è·å–é”æ—¶è®¾ç½®è¿‡æœŸæ—¶é—´</strong>ï¼šåœ¨è·å–é”æ—¶ï¼Œé€šå¸¸ä¼šè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼ˆä¾‹å¦‚30ç§’ï¼‰ï¼Œä»¥é˜²æ­¢å®¢æˆ·ç«¯å´©æºƒå¯¼è‡´é”æ— æ³•é‡Šæ”¾ã€‚</li><li><strong>å¯åŠ¨ä¸€ä¸ªç»­æœŸçº¿ç¨‹</strong>ï¼šå½“æˆåŠŸè·å–é”åï¼Œå¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹å®šæœŸï¼ˆä¾‹å¦‚ï¼Œæ¯éš”è¿‡æœŸæ—¶é—´çš„1&#x2F;3æ—¶é—´ï¼‰å»æ£€æŸ¥é”æ˜¯å¦è¿˜å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™å»¶é•¿é”çš„è¿‡æœŸæ—¶é—´ã€‚</li><li><strong>ç»­æœŸæ“ä½œ</strong>ï¼šç»­æœŸæ“ä½œå®é™…ä¸Šå°±æ˜¯é‡æ–°è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´ã€‚åœ¨Redisä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>PEXPIRE</code>å‘½ä»¤ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰æˆ–<code>EXPIRE</code>å‘½ä»¤ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰æ¥é‡æ–°è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚</li><li><strong>é‡Šæ”¾é”æ—¶åœæ­¢ç»­æœŸ</strong>ï¼šå½“ä¸šåŠ¡é€»è¾‘æ‰§è¡Œå®Œæ¯•ï¼Œé‡Šæ”¾é”çš„æ—¶å€™ï¼Œéœ€è¦åŒæ—¶åœæ­¢ç»­æœŸçº¿ç¨‹ï¼Œä»¥é¿å…ä¸å¿…è¦çš„ç»­æœŸæ“ä½œã€‚</li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç»­æœŸæ“ä½œå¿…é¡»ä¿è¯åŸå­æ€§ï¼Œå³åœ¨æ£€æŸ¥é”æ˜¯å¦ä»ç„¶ç”±å½“å‰å®¢æˆ·ç«¯æŒæœ‰ä¹‹åï¼Œå†æ‰§è¡Œç»­æœŸã€‚å¯ä»¥ä½¿ç”¨Luaè„šæœ¬æ¥ä¿è¯åŸå­æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–é”</span></span><br><span class="line"><span class="keyword">if</span> set lock_key my_random_value NX PX <span class="number">30000</span>:</span><br><span class="line">    <span class="comment">// é”è·å–æˆåŠŸ</span></span><br><span class="line">    <span class="comment">// å¯åŠ¨ä¸€ä¸ªçœ‹é—¨ç‹—çº¿ç¨‹ï¼Œæ¯10ç§’æ‰§è¡Œä¸€æ¬¡ç»­æœŸ</span></span><br><span class="line">    watchdog = <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">while</span> (lockIsHeld) &#123;</span><br><span class="line">            sleep(<span class="number">10000</span>); <span class="comment">// 10ç§’</span></span><br><span class="line">            <span class="comment">// ä½¿ç”¨Luaè„šæœ¬ç»­æœŸï¼šå¦‚æœé”çš„å€¼è¿˜æ˜¯my_random_valueï¼Œåˆ™é‡æ–°è®¾ç½®ä¸º30ç§’</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">script</span> <span class="operator">=</span> <span class="string">&quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then &quot;</span> +</span><br><span class="line">                           <span class="string">&quot;return redis.call(&#x27;pexpire&#x27;, KEYS[1], ARGV[2]) &quot;</span> +</span><br><span class="line">                           <span class="string">&quot;else &quot;</span> +</span><br><span class="line">                           <span class="string">&quot;return 0 &quot;</span> +</span><br><span class="line">                           <span class="string">&quot;end&quot;</span>;</span><br><span class="line">            redis.eval(script, lock_key, my_random_value, <span class="number">30000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    watchdog.start();</span><br><span class="line">    <span class="comment">// æ‰§è¡Œä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    doBusiness();</span><br><span class="line">    <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">    <span class="comment">// å…ˆåœæ­¢çœ‹é—¨ç‹—çº¿ç¨‹</span></span><br><span class="line">    lockIsHeld = <span class="literal">false</span>;</span><br><span class="line">    watchdog.join();</span><br><span class="line">    <span class="comment">// ç„¶åé‡Šæ”¾é”ï¼Œä½¿ç”¨Luaè„šæœ¬æ¥ä¿è¯åŸå­æ€§</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">releaseScript</span> <span class="operator">=</span> <span class="string">&quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then &quot;</span> +</span><br><span class="line">                           <span class="string">&quot;return redis.call(&#x27;del&#x27;, KEYS[1]) &quot;</span> +</span><br><span class="line">                           <span class="string">&quot;else &quot;</span> +</span><br><span class="line">                           <span class="string">&quot;return 0 &quot;</span> +</span><br><span class="line">                           <span class="string">&quot;end&quot;</span>;</span><br><span class="line">    redis.eval(releaseScript, lock_key, my_random_value);</span><br></pre></td></tr></table></figure><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›æˆç†Ÿçš„åº“ï¼Œä¾‹å¦‚Redissonï¼Œå®ƒå·²ç»å†…ç½®äº†çœ‹é—¨ç‹—æœºåˆ¶æ¥è‡ªåŠ¨ç»­æœŸã€‚åœ¨Redissonä¸­ï¼Œè·å–é”åï¼Œå®ƒä¼šå¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ¥å®šæœŸç»­æœŸï¼Œç›´åˆ°é”è¢«é‡Šæ”¾æˆ–æŒæœ‰é”çš„å®¢æˆ·ç«¯å®•æœºã€‚</p><p>ä½¿ç”¨Redissonçš„ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RedissonClient</span> <span class="variable">redisson</span> <span class="operator">=</span> Redisson.create(config);</span><br><span class="line"><span class="type">RLock</span> <span class="variable">lock</span> <span class="operator">=</span> redisson.getLock(<span class="string">&quot;myLock&quot;</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–é”ï¼Œå¹¶è®¾ç½®å°è¯•åŠ é”æ—¶é—´å’Œé”è‡ªåŠ¨é‡Šæ”¾æ—¶é—´ï¼Œä½†æ˜¯Redissonçš„çœ‹é—¨ç‹—æœºåˆ¶ä¼šåœ¨è·å–é”æˆåŠŸåè‡ªåŠ¨ç»­æœŸ</span></span><br><span class="line">    lock.lock(); <span class="comment">// é»˜è®¤æƒ…å†µä¸‹ï¼Œçœ‹é—¨ç‹—ä¼šæ¯30/3=10ç§’ç»­æœŸä¸€æ¬¡ï¼Œå°†é”çš„è¿‡æœŸæ—¶é—´é‡ç½®ä¸º30ç§’</span></span><br><span class="line">    <span class="comment">// æ‰§è¡Œä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…¨é‡åŒæ­¥å’Œå¢é‡åŒæ­¥çš„åŒºåˆ«"><a href="#å…¨é‡åŒæ­¥å’Œå¢é‡åŒæ­¥çš„åŒºåˆ«" class="headerlink" title="å…¨é‡åŒæ­¥å’Œå¢é‡åŒæ­¥çš„åŒºåˆ«"></a>å…¨é‡åŒæ­¥å’Œå¢é‡åŒæ­¥çš„åŒºåˆ«</h3><p>å…¨é‡åŒæ­¥ï¼šmasterç”Ÿæˆå½“å‰å†…å­˜ä¸­æ‰€æœ‰æ•°æ®çš„RDBæ–‡ä»¶ï¼Œå°†RDBå‘é€ç»™slaveã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œmasterå°†æ–°çš„å‘½ä»¤è®°å½•åœ¨<code>repl_backlog</code>ä¸­ï¼Œåç»­å†å‘é€ç»™slaveã€‚</p><p>æ‰§è¡Œæ—¶æœºï¼š</p><ol><li>slaveç¬¬ä¸€æ¬¡è¿æ¥åˆ°master</li><li>slaveå®•æœºå¤ªä¹…ï¼Œå¯¼è‡´å®ƒåœ¨<code>repl_backlog</code>ä¸­çš„<code>offset</code>å·²ç»è¢«è¦†ç›–æ‰äº†</li></ol><p>å¢é‡åŒæ­¥ï¼šsalveå°†è‡ªå·±çš„<code>offset</code>å‘é€åˆ°masterï¼Œmasterå°†<code>repl_backlog</code>ä¸­<code>offset</code>ä¹‹åçš„å‘½ä»¤å‘é€ç»™slave</p><p>æ‰§è¡Œæ—¶æœºï¼š</p><ol><li>slaveæ–­å¼€é‡è¿ä¹‹åï¼Œ<code>repl_backlog</code>ä¸­çš„<code>offset</code>å°šæœªè¢«è¦†ç›–</li></ol><h3 id="å†…å­˜æ·˜æ±°ç­–ç•¥ä¸LRUå®ç°"><a href="#å†…å­˜æ·˜æ±°ç­–ç•¥ä¸LRUå®ç°" class="headerlink" title="å†…å­˜æ·˜æ±°ç­–ç•¥ä¸LRUå®ç°"></a>å†…å­˜æ·˜æ±°ç­–ç•¥ä¸LRUå®ç°</h3><table><thead><tr><th align="left"><strong>æ•°æ®èŒƒå›´</strong></th><th align="left"><strong>ç­–ç•¥</strong></th><th align="left"><strong>è¯´æ˜</strong></th></tr></thead><tbody><tr><td align="left"><strong>æ‰€æœ‰Key</strong></td><td align="left"><code>allkeys-lru</code></td><td align="left">ä»æ‰€æœ‰Keyä¸­æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„</td></tr><tr><td align="left"></td><td align="left"><code>allkeys-lfu</code></td><td align="left">ä»æ‰€æœ‰Keyä¸­æ·˜æ±°æœ€ä¸ç»å¸¸ä½¿ç”¨çš„ï¼ˆRedis 4.0+ï¼‰</td></tr><tr><td align="left"></td><td align="left"><code>allkeys-random</code></td><td align="left">ä»æ‰€æœ‰Keyä¸­éšæœºæ·˜æ±°</td></tr><tr><td align="left"><strong>è¿‡æœŸKey</strong></td><td align="left"><code>volatile-lru</code></td><td align="left">ä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„Keyä¸­æ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„</td></tr><tr><td align="left"></td><td align="left"><code>volatile-lfu</code></td><td align="left">ä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„Keyä¸­æ·˜æ±°æœ€ä¸ç»å¸¸ä½¿ç”¨çš„</td></tr><tr><td align="left"></td><td align="left"><code>volatile-random</code></td><td align="left">ä»è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„Keyä¸­éšæœºæ·˜æ±°</td></tr><tr><td align="left"></td><td align="left"><code>volatile-ttl</code></td><td align="left">æ·˜æ±°å‰©ä½™å­˜æ´»æ—¶é—´ï¼ˆTTLï¼‰æœ€çŸ­çš„Key</td></tr><tr><td align="left"><strong>ä¸æ·˜æ±°</strong></td><td align="left"><code>noeviction</code>ï¼ˆé»˜è®¤ï¼‰</td><td align="left">å†…å­˜ä¸è¶³æ—¶æ‹’ç»å†™å…¥ï¼Œè¿”å›é”™è¯¯</td></tr></tbody></table><h3 id="Rediså’ŒMySQLçš„åŒºåˆ«"><a href="#Rediså’ŒMySQLçš„åŒºåˆ«" class="headerlink" title="Rediså’ŒMySQLçš„åŒºåˆ«"></a>Rediså’ŒMySQLçš„åŒºåˆ«</h3><table><thead><tr><th></th><th>Redis</th><th>MySQL</th></tr></thead><tbody><tr><td>æ•°æ®ç»“æ„</td><td>éç»“æ„åŒ–</td><td>ç»“æ„åŒ–</td></tr><tr><td>æŒä¹…åŒ–</td><td>å¯é€‰æŒä¹…åŒ–</td><td>é»˜è®¤æŒä¹…åŒ–</td></tr><tr><td>äº‹åŠ¡æ”¯æŒ</td><td>ç®€å•æ”¯æŒ</td><td>æ”¯æŒå®Œæ•´çš„ACID</td></tr><tr><td>æ‰©å±•æ€§</td><td>é€šè¿‡åˆ†ç‰‡æ°´å¹³æ‰©å±•</td><td>å¤æ‚ï¼Œéœ€åˆ†åº“åˆ†è¡¨æˆ–ä¸­é—´ä»¶</td></tr><tr><td>æ•°æ®ä¸€è‡´æ€§</td><td>æœ€ç»ˆä¸€è‡´æ€§</td><td>å¼ºä¸€è‡´æ€§</td></tr></tbody></table><p>æ€»ç»“ï¼š</p><ul><li>å½“éœ€è¦å¤æ‚æŸ¥è¯¢å’Œäº‹åŠ¡æ”¯æŒï¼Œå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚è¾ƒé«˜ï¼Œéœ€è¦é•¿æœŸæŒä¹…åŒ–å­˜å‚¨çš„åœºæ™¯ï¼Œé€‰æ‹©MySQL</li><li>å½“éœ€è¦è¶…é«˜æ€§èƒ½å’Œçµæ´»æ•°æ®ç±»å‹ï¼Œå¯¹æ•°æ®çš„ä¸€è‡´æ€§è¦æ±‚ä¸é‚£ä¹ˆé«˜ï¼Œä¸”å®¹å¿ä¸€å®šçš„æ•°æ®ä¸¢å¤±çš„æƒ…å†µä¸‹ï¼Œé€‰æ‹©Redis</li></ul><h3 id="Rediså’Œmemchahedçš„åŒºåˆ«"><a href="#Rediså’Œmemchahedçš„åŒºåˆ«" class="headerlink" title="Rediså’Œmemchahedçš„åŒºåˆ«"></a>Rediså’Œmemchahedçš„åŒºåˆ«</h3><table><thead><tr><th></th><th>Redis</th><th>Memcached</th></tr></thead><tbody><tr><td>æ•°æ®ç±»å‹</td><td>ä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼šstringã€hashã€listç­‰</td><td>åªæ”¯æŒstring</td></tr><tr><td>æŒä¹…åŒ–</td><td>æ”¯æŒï¼ˆRDBã€AOFï¼‰</td><td>ä¸æ”¯æŒ</td></tr><tr><td>äº‹åŠ¡</td><td>ç®€å•æ”¯æŒï¼ˆMULTI&#x2F;EXECï¼‰</td><td>ä¸æ”¯æŒ</td></tr><tr><td>åˆ†å¸ƒå¼</td><td>æ”¯æŒï¼Œé›†ç¾¤è‡ªåŠ¨åˆ†ç‰‡</td><td>ä¾èµ–å®¢æˆ·ç«¯ä¸€è‡´æ€§å“ˆå¸Œæˆ–ç¬¬ä¸‰æ–¹å·¥å…·å®ç°åˆ†å¸ƒå¼</td></tr><tr><td>å‘½ä»¤</td><td>æ”¯æŒä¸°å¯Œçš„å‘½ä»¤</td><td>ä»…æ”¯æŒSETã€GETã€ADDã€DELTEç­‰åŸºç¡€æ“ä½œ</td></tr><tr><td>å†…å­˜å ç”¨</td><td>å¤æ‚æ•°æ®ç»“æ„å¯èƒ½å¯¼è‡´å†…å­˜æ¶ˆè€—è¾ƒé«˜</td><td>å†…å­˜åˆ©ç”¨ç‡é«˜ï¼Œä½†çµæ´»æ€§è¾ƒä½</td></tr></tbody></table><p>æ€»ç»“ï¼š</p><ul><li>éœ€è¦å¤æ‚æ•°æ®ç»“æ„ã€æŒä¹…åŒ–ã€äº‹åŠ¡æ”¯æŒå’Œé«˜å¯ç”¨æ€§çš„åœºæ™¯ï¼Œé€‰æ‹©Redis</li><li>è¿½æ±‚æè‡´çš„æ€§èƒ½å’Œç®€å•æ€§ï¼Œæ•°æ®ç»“æ„ç®€å•ä¸”æ— éœ€æŒä¹…åŒ–çš„åœºæ™¯ï¼Œå¯ä»¥é€‰æ‹©Memcached</li></ul><h3 id="Redis-IOå¤šè·¯å¤ç”¨"><a href="#Redis-IOå¤šè·¯å¤ç”¨" class="headerlink" title="Redis IOå¤šè·¯å¤ç”¨"></a>Redis IOå¤šè·¯å¤ç”¨</h3><p>å¸¸è§çš„ I&#x2F;O å¤šè·¯å¤ç”¨æœºåˆ¶åŒ…æ‹¬ selectã€poll å’Œ epoll ç­‰ã€‚</p><table><thead><tr><th>ç‰¹æ€§</th><th><code>select</code></th><th><code>poll</code></th><th><code>epoll</code></th></tr></thead><tbody><tr><td>æ–‡ä»¶æè¿°ç¬¦é™åˆ¶</td><td>å— <code>FD_SETSIZE</code> é™åˆ¶</td><td>æ— é™åˆ¶</td><td>æ— é™åˆ¶</td></tr><tr><td>æ—¶é—´å¤æ‚åº¦</td><td>O(n)</td><td>O(n)</td><td>O(1)</td></tr><tr><td>æ•°æ®å¤åˆ¶</td><td>éœ€è¦</td><td>éœ€è¦</td><td>ä¸éœ€è¦</td></tr><tr><td>å·¥ä½œæ–¹å¼</td><td>çº¿æ€§æ‰«æ</td><td>çº¿æ€§æ‰«æ</td><td>äº‹ä»¶é€šçŸ¥</td></tr><tr><td>å†…æ ¸æ”¯æŒ</td><td>æ‰€æœ‰ UNIX ç³»ç»Ÿ</td><td>æ‰€æœ‰ UNIX ç³»ç»Ÿ</td><td>Linux 2.6 åŠä»¥ä¸Šç‰ˆæœ¬</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>å°‘é‡è¿æ¥</td><td>ä¸­ç­‰è¿æ¥</td><td>å¤§é‡å¹¶å‘è¿æ¥</td></tr></tbody></table><p><img src="https://cdn.tobebetterjavaer.com/stutymore/redis-20240918114125.png" alt="æœ‰ç›å…ˆç”Ÿï¼šIO å¤šè·¯å¤ç”¨"></p><h3 id="Redis-6-0-å¤šçº¿ç¨‹"><a href="#Redis-6-0-å¤šçº¿ç¨‹" class="headerlink" title="Redis 6.0 å¤šçº¿ç¨‹"></a>Redis 6.0 å¤šçº¿ç¨‹</h3><p>åœ¨ Redis 6.0 ä¸­ï¼Œå¤šçº¿ç¨‹ä¸»è¦ç”¨æ¥å¤„ç†ç½‘ç»œ IO æ“ä½œï¼Œå‘½ä»¤è§£æå’Œæ‰§è¡Œä»ç„¶æ˜¯å•çº¿ç¨‹å®Œæˆï¼Œè¿™æ ·æ—¢å¯ä»¥å‘æŒ¥å¤šæ ¸ CPU çš„ä¼˜åŠ¿ï¼Œåˆèƒ½é¿å…é”å’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/redis-b7b24e25-d2dc-4457-994f-95bdb3674b8e.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šRedis6.0å¤šçº¿ç¨‹"></p><h3 id="ç¼“å­˜æ›´æ–°ç­–ç•¥"><a href="#ç¼“å­˜æ›´æ–°ç­–ç•¥" class="headerlink" title="ç¼“å­˜æ›´æ–°ç­–ç•¥"></a>ç¼“å­˜æ›´æ–°ç­–ç•¥</h3><ul><li><code>Cache Aside</code>ï¼šä¸šåŠ¡æ–¹æ›´æ–°æ•°æ®åº“æ—¶ï¼ŒåŒæ­¥æ›´æ–°ç¼“å­˜</li><li><code>Read/Write Through</code>ï¼šç¼“å­˜å’Œæ•°æ®åº“æ•´åˆä¸ºä¸€ä¸ªæœåŠ¡ï¼Œä¸šåŠ¡æ–¹åªéœ€è°ƒç”¨è¯¥æœåŠ¡ï¼Œç”±è¯¥æœåŠ¡ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§</li><li><code>Write Behind</code>ï¼šä¸šåŠ¡æ–¹åªæ“ä½œç¼“å­˜ï¼Œç”±å…¶ä»–çº¿ç¨‹å¼‚æ­¥æ›´æ–°ç¼“å­˜ï¼Œä¿è¯æœ€ç»ˆä¸€è‡´æ€§</li></ul><p>é€šå¸¸ä¸šåŠ¡ä¸­ä¼šä½¿ç”¨<code>Cache Aside</code></p><ul><li>è¯»æ“ä½œï¼šç¼“å­˜å‘½ä¸­ç›´æ¥è¿”å›ï¼›ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥è¯¢æ•°æ®åº“å¹¶å†™å…¥ç¼“å­˜ï¼ˆè®¾ç½®è¶…æ—¶æ—¶é—´ï¼‰</li><li>å†™æ“ä½œï¼šå…ˆå†™æ•°æ®åº“ï¼Œå†åˆ ç¼“å­˜ï¼ˆå‡ºç°å¹¶å‘é—®é¢˜çš„æ¦‚ç‡ä½ä¸€ç‚¹ï¼‰</li></ul><h2 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h2><h3 id="Elasticsearch-çš„æ ¸å¿ƒæ¦‚å¿µ"><a href="#Elasticsearch-çš„æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="Elasticsearch çš„æ ¸å¿ƒæ¦‚å¿µ"></a><strong>Elasticsearch çš„æ ¸å¿ƒæ¦‚å¿µ</strong></h3><ul><li><strong>æ–‡æ¡£ï¼š</strong> æ•°æ®çš„åŸºæœ¬å•ä½ï¼Œé€šå¸¸æ˜¯ JSON æ ¼å¼ã€‚ç›¸å½“äºæ•°æ®åº“ä¸­çš„ä¸€è¡Œè®°å½•ã€‚</li><li><strong>ç´¢å¼•ï¼š</strong> å…·æœ‰ç›¸ä¼¼ç‰¹å¾çš„æ–‡æ¡£é›†åˆã€‚ç›¸å½“äºæ•°æ®åº“ä¸­çš„ä¸€ä¸ªè¡¨ã€‚ä¸€ä¸ªç´¢å¼•å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç‰‡ã€‚</li><li><strong>ç±»å‹ï¼š</strong> (7.x ä¹‹å‰) ç´¢å¼•å†…éƒ¨çš„é€»è¾‘åˆ†åŒºï¼Œå…è®¸åœ¨åŒä¸€ç´¢å¼•ä¸­å­˜å‚¨ä¸åŒç±»å‹çš„æ–‡æ¡£ï¼ˆå¦‚ <code>user</code>, <code>product</code>ï¼‰ã€‚(<strong>æ³¨æ„ï¼š</strong> åœ¨ 7.x ä¸­ç±»å‹è¢«åºŸå¼ƒï¼Œ8.x ä¸­å®Œå…¨ç§»é™¤ã€‚ç°åœ¨ä¸€ä¸ªç´¢å¼•é€šå¸¸åªåŒ…å«ä¸€ç§æ–‡æ¡£ç±»å‹)ã€‚</li><li><strong>åˆ†ç‰‡ï¼š</strong> ç´¢å¼•è¢«æ°´å¹³åˆ†å‰²æˆçš„å­é›†ã€‚æ¯ä¸ªåˆ†ç‰‡æœ¬èº«å°±æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ä¸”ç‹¬ç«‹çš„â€œç´¢å¼•â€ã€‚<ul><li><strong>ä¸»åˆ†ç‰‡ï¼š</strong> å­˜å‚¨æ–‡æ¡£æ•°æ®å’Œå¤„ç†ç´¢å¼•&#x2F;æ›´æ–°æ“ä½œã€‚ç´¢å¼•åˆ›å»ºæ—¶æŒ‡å®šæ•°é‡ï¼Œåç»­ä¸å¯æ›´æ”¹ï¼ˆé™¤é Reindexï¼‰ã€‚</li><li><strong>å‰¯æœ¬åˆ†ç‰‡ï¼š</strong> ä¸»åˆ†ç‰‡çš„æ‹·è´ã€‚æä¾›é«˜å¯ç”¨æ€§ï¼ˆä¸»åˆ†ç‰‡æ•…éšœæ—¶å‰¯æœ¬å¯æå‡ä¸ºä¸»ï¼‰å’Œè¯»å–ååé‡ï¼ˆæŸ¥è¯¢å¯è´Ÿè½½å‡è¡¡åˆ°æ‰€æœ‰å‰¯æœ¬ï¼‰ã€‚</li></ul></li><li><strong>èŠ‚ç‚¹ï¼š</strong> è¿è¡Œä¸­çš„ Elasticsearch å®ä¾‹ã€‚</li><li><strong>é›†ç¾¤ï¼š</strong> ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ååŒå·¥ä½œçš„é›†åˆï¼Œå…±åŒæŒæœ‰æ•´ä¸ªæ•°æ®å¹¶æä¾›è”åˆç´¢å¼•å’Œæœç´¢èƒ½åŠ›ã€‚</li><li><strong>å€’æ’ç´¢å¼•ï¼š</strong> ES å®ç°å¿«é€Ÿå…¨æ–‡æœç´¢çš„æ ¸å¿ƒæ•°æ®ç»“æ„ã€‚å®ƒå­˜å‚¨äº†è¯é¡¹ï¼ˆTokenï¼‰åˆ°åŒ…å«è¯¥è¯é¡¹çš„æ–‡æ¡£ ID åˆ—è¡¨çš„æ˜ å°„ã€‚ç›¸æ¯”ä¼ ç»Ÿæ•°æ®åº“çš„æ­£æ’ç´¢å¼•ï¼ˆæ–‡æ¡£ ID åˆ°å­—æ®µå€¼ï¼‰ï¼Œå®ƒæ›´æ“…é•¿å›ç­”â€œå“ªäº›æ–‡æ¡£åŒ…å«æŸä¸ªè¯ï¼Ÿâ€çš„é—®é¢˜ã€‚</li></ul><h3 id="ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆå®ƒå¯¹æœç´¢å¾ˆé‡è¦ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆå®ƒå¯¹æœç´¢å¾ˆé‡è¦ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆå®ƒå¯¹æœç´¢å¾ˆé‡è¦ï¼Ÿ"></a><strong>ä»€ä¹ˆæ˜¯å€’æ’ç´¢å¼•ï¼Ÿä¸ºä»€ä¹ˆå®ƒå¯¹æœç´¢å¾ˆé‡è¦ï¼Ÿ</strong></h3><ul><li><strong>å®šä¹‰ï¼š</strong> å€’æ’ç´¢å¼•æ˜¯ä¸€ç§å°†æ–‡æ¡£ä¸­çš„è¯é¡¹ï¼ˆTokenï¼‰æ˜ å°„åˆ°åŒ…å«è¯¥è¯é¡¹çš„æ–‡æ¡£åˆ—è¡¨çš„æ•°æ®ç»“æ„ã€‚å®ƒåŒ…å«ä¸¤ä¸ªæ ¸å¿ƒéƒ¨åˆ†ï¼š<ul><li><strong>è¯é¡¹å­—å…¸ï¼š</strong> åŒ…å«æ‰€æœ‰ä¸é‡å¤çš„è¯é¡¹ï¼ˆTokenï¼‰ï¼Œé€šå¸¸æŒ‰å­—å…¸åºæ’åºã€‚</li><li><strong>å€’æ’åˆ—è¡¨ï¼š</strong> å¯¹äºæ¯ä¸ªè¯é¡¹ï¼Œè®°å½•åŒ…å«è¯¥è¯é¡¹çš„æ‰€æœ‰æ–‡æ¡£ ID åˆ—è¡¨ï¼ˆPostings Listï¼‰ï¼Œä»¥åŠè¯é¡¹åœ¨æ–‡æ¡£ä¸­å‡ºç°çš„ä½ç½®ï¼ˆPositionï¼‰ã€é¢‘ç‡ï¼ˆTerm Frequencyï¼‰ç­‰ä¿¡æ¯ï¼ˆç”¨äºç›¸å…³æ€§è¯„åˆ†ï¼‰ã€‚</li></ul></li><li><strong>é‡è¦æ€§ï¼š</strong><ul><li><strong>å¿«é€Ÿå®šä½ï¼š</strong> ç›´æ¥é€šè¿‡è¯é¡¹æ‰¾åˆ°åŒ…å«å®ƒçš„æ–‡æ¡£ï¼Œé¿å…äº†æ‰«ææ‰€æœ‰æ–‡æ¡£ã€‚</li><li><strong>é«˜æ•ˆå¸ƒå°”æŸ¥è¯¢ï¼š</strong> AND&#x2F;OR&#x2F;NOT æ“ä½œå¯ä»¥é€šè¿‡å¯¹å€’æ’åˆ—è¡¨è¿›è¡Œäº¤&#x2F;å¹¶&#x2F;å·®é›†è¿ç®—é«˜æ•ˆå®Œæˆã€‚</li><li><strong>ç›¸å…³æ€§è¯„åˆ†åŸºç¡€ï¼š</strong> TF-IDFã€BM25 ç­‰ç»å…¸è¯„åˆ†æ¨¡å‹ä¸¥é‡ä¾èµ–å€’æ’ç´¢å¼•ä¸­å­˜å‚¨çš„è¯é¢‘ï¼ˆTFï¼‰ã€æ–‡æ¡£é¢‘ç‡ï¼ˆDF&#x2F;IDFï¼‰ä¿¡æ¯ã€‚</li><li><strong>æ”¯æŒçŸ­è¯­æŸ¥è¯¢ï¼š</strong> åˆ©ç”¨å­˜å‚¨çš„ä½ç½®ä¿¡æ¯ï¼Œå¯ä»¥ç²¾ç¡®æŸ¥æ‰¾ç›¸é‚»å‡ºç°çš„è¯ç»„ã€‚</li></ul></li></ul><h2 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h2><h1 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h1><h2 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h2><ol><li>Kafkaé«˜ååé‡å®ç°åŸç†</li><li>æ¶ˆæ¯ä¸¢å¤±ä¸é‡å¤æ¶ˆè´¹è§£å†³æ–¹æ¡ˆ</li><li>é¡ºåºæ¶ˆæ¯å®ç°æ–¹æ¡ˆ</li><li>å»¶è¿Ÿæ¶ˆæ¯å®ç°åŸç†</li><li>æ­»ä¿¡é˜Ÿåˆ—åº”ç”¨åœºæ™¯</li><li>æ¶ˆæ¯å †ç§¯å¤„ç†ç­–ç•¥</li><li>RocketMQäº‹åŠ¡æ¶ˆæ¯æµç¨‹</li><li>Pulsaråˆ†å±‚å­˜å‚¨æ¶æ„ä¼˜åŠ¿</li><li>å¦‚ä½•è®¾è®¡æ¶ˆæ¯è½¨è¿¹ç³»ç»Ÿï¼Ÿ</li><li>Brokeré€‰ä¸¾æœºåˆ¶å¯¹æ¯”ï¼ˆKafka vs RocketMQï¼‰</li></ol><h3 id="Kafka-ä¸ºä»€ä¹ˆèƒ½å®ç°é«˜ååé‡ï¼Ÿ"><a href="#Kafka-ä¸ºä»€ä¹ˆèƒ½å®ç°é«˜ååé‡ï¼Ÿ" class="headerlink" title="Kafka ä¸ºä»€ä¹ˆèƒ½å®ç°é«˜ååé‡ï¼Ÿ"></a>Kafka ä¸ºä»€ä¹ˆèƒ½å®ç°é«˜ååé‡ï¼Ÿ</h3><ul><li><strong>é¡ºåºè¯»å†™ç£ç›˜:</strong> æ¶ˆæ¯æŒ‰é¡ºåºè¿½åŠ åˆ° Partition æ–‡ä»¶æœ«å°¾ï¼Œå……åˆ†åˆ©ç”¨ç£ç›˜é¡ºåº I&#x2F;O çš„é«˜æ€§èƒ½ï¼ˆè¿œé«˜äºéšæœº I&#x2F;Oï¼‰ã€‚</li><li><strong>Page Cache:</strong> åˆ©ç”¨æ“ä½œç³»ç»Ÿ Page Cache ç¼“å­˜æ•°æ®ï¼Œå‡å°‘ç›´æ¥ç£ç›˜è®¿é—®ã€‚</li><li><strong>é›¶æ‹·è´ (Zero-Copy):</strong> ä½¿ç”¨ <code>sendfile</code> å’Œ <code>mmap</code> ç­‰æŠ€æœ¯ï¼Œå‡å°‘æ•°æ®åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´çš„æ‹·è´æ¬¡æ•°ï¼Œé™ä½ CPU å¼€é”€å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</li><li><strong>æ‰¹é‡å¤„ç† (Batching):</strong> Producer æ‰¹é‡å‘é€æ¶ˆæ¯ï¼ŒBroker æ‰¹é‡å†™å…¥ç£ç›˜å’Œæ‰¹é‡å‘é€ç»™ Consumerï¼Œå‡å°‘ç½‘ç»œå’Œ I&#x2F;O å¼€é”€ã€‚</li><li><strong>æ¶ˆæ¯å‹ç¼©:</strong> Producer ç«¯å¯é…ç½®å‹ç¼©ç®—æ³• (Snappy, LZ4, Gzip, Zstd)ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“å’Œç£ç›˜å­˜å‚¨å¼€é”€ã€‚</li><li><strong>Partition å¹¶è¡Œ:</strong> Topic è¢«åˆ†æˆå¤šä¸ª Partitionï¼Œåˆ†å¸ƒåœ¨å¤šä¸ª Broker ä¸Šï¼Œè¯»å†™æ“ä½œå¯ä»¥å¹¶è¡Œå‘ç”Ÿåœ¨ä¸åŒ Partitionï¼Œå……åˆ†åˆ©ç”¨å¤š Brokerã€å¤šç£ç›˜ã€å¤šæ ¸ CPUã€‚</li></ul><h3 id="è§£é‡Š-Kafka-ä¸­-Topicã€Partitionã€Replica-çš„å…³ç³»"><a href="#è§£é‡Š-Kafka-ä¸­-Topicã€Partitionã€Replica-çš„å…³ç³»" class="headerlink" title="è§£é‡Š Kafka ä¸­ Topicã€Partitionã€Replica çš„å…³ç³»"></a>è§£é‡Š Kafka ä¸­ Topicã€Partitionã€Replica çš„å…³ç³»</h3><ul><li><strong>Topic</strong> æ˜¯æ¶ˆæ¯å‘å¸ƒçš„ç±»åˆ«æˆ–ä¸»é¢˜ã€‚</li><li>ä¸€ä¸ª <strong>Topic</strong> è¢«åˆ’åˆ†ä¸ºä¸€ä¸ªæˆ–å¤šä¸ª <strong>Partition</strong>ã€‚Partition æ˜¯ç‰©ç†å­˜å‚¨å•å…ƒï¼Œåˆ†å¸ƒåœ¨ä¸åŒçš„ Broker ä¸Šã€‚</li><li>æ¯ä¸ª <strong>Partition</strong> å¯ä»¥æœ‰å¤šä¸ª <strong>Replica</strong> (å‰¯æœ¬)ã€‚å…¶ä¸­ä¸€ä¸ª Replica æ˜¯ <strong>Leader</strong>ï¼Œè´Ÿè´£è¯»å†™ï¼›å…¶ä»–æ˜¯ <strong>Follower</strong>ï¼Œåªè´Ÿè´£ä» Leader åŒæ­¥æ•°æ®ã€‚Replica ä¹Ÿåˆ†å¸ƒåœ¨ä¸åŒçš„ Broker ä¸Šï¼Œæä¾›å®¹é”™èƒ½åŠ›ã€‚</li></ul><h3 id="Producer-çš„-acks-å‚æ•°æœ‰å“ªå‡ ç§ï¼Ÿåˆ†åˆ«ä»£è¡¨ä»€ä¹ˆå«ä¹‰ï¼Ÿ"><a href="#Producer-çš„-acks-å‚æ•°æœ‰å“ªå‡ ç§ï¼Ÿåˆ†åˆ«ä»£è¡¨ä»€ä¹ˆå«ä¹‰ï¼Ÿ" class="headerlink" title="Producer çš„ acks å‚æ•°æœ‰å“ªå‡ ç§ï¼Ÿåˆ†åˆ«ä»£è¡¨ä»€ä¹ˆå«ä¹‰ï¼Ÿ"></a>Producer çš„ <code>acks</code> <strong>å‚æ•°æœ‰å“ªå‡ ç§ï¼Ÿåˆ†åˆ«ä»£è¡¨ä»€ä¹ˆå«ä¹‰ï¼Ÿ</strong></h3><ul><li><code>acks=0</code>: Producer å‘é€æ¶ˆæ¯å<strong>ä¸ç­‰å¾…</strong> Broker çš„ä»»ä½•ç¡®è®¤ã€‚<strong>æœ€é«˜ååï¼Œæœ€ä½å»¶è¿Ÿï¼Œæœ€ä½å¯é æ€§</strong> (å¯èƒ½ä¸¢å¤±æ•°æ®)ã€‚</li><li><code>acks=1</code>: Producer å‘é€æ¶ˆæ¯åï¼Œç­‰å¾… <strong>Leader å‰¯æœ¬æˆåŠŸå†™å…¥æœ¬åœ°æ—¥å¿—</strong> çš„ç¡®è®¤ã€‚<strong>æŠ˜ä¸­æ–¹æ¡ˆ</strong>ã€‚Leader æ•…éšœä½†æ•°æ®æœªåŒæ­¥åˆ° Follower æ—¶å¯èƒ½ä¸¢å¤±æ•°æ®ã€‚</li><li><code>acks=all</code> <strong>(æˆ–</strong> <code>acks=-1</code><strong>)</strong>: Producer å‘é€æ¶ˆæ¯åï¼Œç­‰å¾… <strong>Leader æ”¶åˆ°æ¶ˆæ¯å¹¶ç¡®è®¤è¯¥æ¶ˆæ¯å·²è¢«å½“å‰ ISR é›†åˆä¸­çš„æ‰€æœ‰å‰¯æœ¬æˆåŠŸå†™å…¥æœ¬åœ°æ—¥å¿—</strong>ã€‚<strong>æœ€é«˜å¯é æ€§</strong>ï¼Œæœ€ä½ä¸¢å¤±é£é™©ï¼Œä½†å»¶è¿Ÿæœ€é«˜ï¼Œååå¯èƒ½æœ€ä½ã€‚éœ€è¦é…åˆ <code>min.insync.replicas</code> å‚æ•°ä½¿ç”¨ã€‚</li></ul><h3 id="è§£é‡Š-Consumer-Group-å’Œ-Rebalance-çš„æ¦‚å¿µã€‚"><a href="#è§£é‡Š-Consumer-Group-å’Œ-Rebalance-çš„æ¦‚å¿µã€‚" class="headerlink" title="è§£é‡Š Consumer Group å’Œ Rebalance çš„æ¦‚å¿µã€‚"></a>è§£é‡Š Consumer Group å’Œ Rebalance çš„æ¦‚å¿µã€‚</h3><ul><li><strong>Consumer Group (CG):</strong> ä¸€ç»„ Consumer å®ä¾‹çš„é›†åˆï¼Œå®ƒä»¬å…±åŒæ¶ˆè´¹ä¸€ä¸ªæˆ–å¤šä¸ª Topicã€‚ç»„å†…æ¶ˆè´¹å®ä¾‹<strong>åä½œæ¶ˆè´¹</strong>è®¢é˜… Topic çš„æ‰€æœ‰ Partitionã€‚ä¸€ä¸ª Partition åªèƒ½è¢«ç»„å†…<strong>ä¸€ä¸ª</strong> Consumer å®ä¾‹æ¶ˆè´¹ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</li><li><strong>Rebalance (é‡å¹³è¡¡):</strong> å½“ä»¥ä¸‹æƒ…å†µå‘ç”Ÿæ—¶ï¼ŒKafka ä¼šé‡æ–°åˆ†é… CG å†… Consumer è´Ÿè´£çš„ Partitionï¼š</li><li>ç»„å†… Consumer æ•°é‡å˜åŒ– (æ–° Consumer åŠ å…¥ã€Consumer å´©æºƒæˆ–ä¸»åŠ¨ç¦»å¼€)ã€‚</li><li>è®¢é˜…çš„ Topic Partition æ•°é‡å˜åŒ– (å¦‚ Topic è¢«ä¿®æ”¹å¢åŠ äº† Partition)ã€‚</li><li>è®¢é˜…çš„ Topic æœ¬èº«å˜åŒ–ã€‚</li><li><strong>å½±å“:</strong> Rebalance æœŸé—´ï¼Œæ•´ä¸ª CG ä¼š<strong>çŸ­æš‚åœæ­¢æ¶ˆè´¹</strong>ï¼Œç›´åˆ°åˆ†é…å®Œæˆã€‚é¢‘ç¹æˆ–é•¿æ—¶é—´çš„ Rebalance ä¼šå½±å“æ¶ˆè´¹è¿›åº¦å’Œç³»ç»Ÿç¨³å®šæ€§ã€‚</li></ul><h3 id="Kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ"><a href="#Kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ" class="headerlink" title="Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ"></a>Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ</h3><ul><li><strong>Producer ç«¯:</strong></li><li>è®¾ç½® <code>acks=all</code>ï¼Œç¡®ä¿æ¶ˆæ¯è¢« ISR æ‰€æœ‰å‰¯æœ¬ç¡®è®¤ã€‚</li><li>ä½¿ç”¨å¸¦å›è°ƒçš„å¼‚æ­¥å‘é€æˆ–åŒæ­¥å‘é€ï¼Œæ­£ç¡®å¤„ç†å‘é€å¤±è´¥ï¼ˆé‡è¯• + ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼‰ã€‚</li><li>è®¾ç½® <code>retries</code> &gt; 0 å’Œåˆç†çš„ <code>retry.backoff.ms</code>ã€‚</li><li><strong>Broker ç«¯:</strong></li><li>è®¾ç½® <code>unclean.leader.election.enable=false</code>ï¼Œé˜²æ­¢è½åå¤ªå¤šçš„é ISR å‰¯æœ¬æˆä¸º Leaderï¼ˆå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼‰ã€‚</li><li>è®¾ç½® <code>replication.factor &gt;= 3</code>ï¼Œä¿è¯è¶³å¤Ÿçš„å‰¯æœ¬æ•°ã€‚</li><li>è®¾ç½® <code>min.insync.replicas &gt; 1</code> (é€šå¸¸ &#x3D; <code>replication.factor - 1</code>)ï¼Œç¡®ä¿ ISR æœ€å°å­˜æ´»å‰¯æœ¬æ•°ã€‚å½“ ISR æ•°é‡ä¸è¶³ <code>min.insync.replicas</code> æ—¶ï¼ŒProducer <code>acks=all</code> çš„è¯·æ±‚ä¼šå¤±è´¥ã€‚</li><li>ç¡®ä¿ Broker ç£ç›˜å¯é  (RAIDï¼Œç›‘æ§)ã€‚</li><li><strong>Consumer ç«¯:</strong></li><li>å…³é—­è‡ªåŠ¨æäº¤ (<code>enable.auto.commit=false</code>)ï¼Œåœ¨æ¶ˆæ¯<strong>ä¸šåŠ¡é€»è¾‘å¤„ç†å®Œæˆå¹¶ç¡®è®¤æˆåŠŸå</strong>å†<strong>æ‰‹åŠ¨æäº¤ Offset</strong>ã€‚</li><li>å¤„ç†å¥½æ¶ˆè´¹é€»è¾‘å¼‚å¸¸ï¼Œé¿å…å› å¼‚å¸¸å¯¼è‡´æ¶ˆæ¯æœªå¤„ç†ä½† Offset å·²æäº¤ã€‚</li></ul><h3 id="è§£é‡Š-Kafka-çš„-ISR-æœºåˆ¶åŠå…¶åœ¨-Leader-é€‰ä¸¾ä¸­çš„ä½œç”¨ã€‚"><a href="#è§£é‡Š-Kafka-çš„-ISR-æœºåˆ¶åŠå…¶åœ¨-Leader-é€‰ä¸¾ä¸­çš„ä½œç”¨ã€‚" class="headerlink" title="è§£é‡Š Kafka çš„ ISR æœºåˆ¶åŠå…¶åœ¨ Leader é€‰ä¸¾ä¸­çš„ä½œç”¨ã€‚"></a>è§£é‡Š Kafka çš„ ISR æœºåˆ¶åŠå…¶åœ¨ Leader é€‰ä¸¾ä¸­çš„ä½œç”¨ã€‚</h3><ul><li><strong>ISR (In-Sync Replicas):</strong> æŒ‡ä¸ Partition Leader å‰¯æœ¬<strong>ä¿æŒåŒæ­¥</strong>çš„ Follower å‰¯æœ¬é›†åˆã€‚Leader ç»´æŠ¤ ISR åˆ—è¡¨ã€‚</li><li><strong>åŒæ­¥æ ‡å‡†:</strong> Follower å‰¯æœ¬åœ¨ <code>replica.lag.time.max.ms</code> æ—¶é—´å†…æˆåŠŸä» Leader æ‹‰å–åˆ°æœ€æ–°æ•°æ®ã€‚</li><li><strong>Leader é€‰ä¸¾:</strong> å½“ Leader å‰¯æœ¬æ‰€åœ¨ Broker å®•æœºæ—¶ï¼ŒController ä¼š<strong>ä»å½“å‰ ISR é›†åˆä¸­é€‰æ‹©ä¸€ä¸ªå‰¯æœ¬</strong>ä½œä¸ºæ–°çš„ Leaderã€‚è¿™æ˜¯ä¸ºäº†ä¿è¯æ–° Leader æ‹¥æœ‰æœ€æ–°çš„å·²æäº¤æ•°æ®ï¼Œé¿å…æ•°æ®ä¸¢å¤±æˆ–ä¸ä¸€è‡´ã€‚</li><li><code>unclean.leader.election.enable</code><strong>:</strong></li><li><code>false</code> (é»˜è®¤æ¨è): å¿…é¡»ä» ISR ä¸­é€‰ä¸¾ Leaderã€‚å¦‚æœ ISR ä¸ºç©ºï¼Œåˆ™åˆ†åŒºä¸å¯ç”¨ï¼ˆç‰ºç‰²å¯ç”¨æ€§ä¿ä¸€è‡´æ€§ï¼‰ã€‚</li><li><code>true</code>: å…è®¸ä»é ISR (ä¸åŒæ­¥) çš„å‰¯æœ¬ä¸­é€‰ä¸¾ Leaderã€‚å¯èƒ½ä¸¢å¤±æ•°æ®æˆ–å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼ˆç‰ºç‰²ä¸€è‡´æ€§ä¿å¯ç”¨æ€§ï¼‰ã€‚</li></ul><h3 id="Kafka-å¦‚ä½•å®ç°-Exactly-Once-è¯­ä¹‰ï¼Ÿ"><a href="#Kafka-å¦‚ä½•å®ç°-Exactly-Once-è¯­ä¹‰ï¼Ÿ" class="headerlink" title="Kafka å¦‚ä½•å®ç° Exactly-Once è¯­ä¹‰ï¼Ÿ"></a>Kafka å¦‚ä½•å®ç° Exactly-Once è¯­ä¹‰ï¼Ÿ</h3><ul><li><strong>å¹‚ç­‰æ€§ (Idempotence -</strong> <code>enable.idempotence=true</code><strong>)ï¼š</strong></li><li>è§£å†³å•ä¸ª Producer ä¼šè¯å†…å‘é€<strong>å•åˆ†åŒº</strong>çš„<strong>é‡å¤</strong>é—®é¢˜ (at-least-once å¼•èµ·çš„é‡å¤)ã€‚</li><li>åŸç†ï¼šProducer ä¸ºæ¯ä¸ªå‘é€æ‰¹æ¬¡åˆ†é…å”¯ä¸€ PID (Producer ID) å’Œåºåˆ—å· (Sequence Number)ã€‚Broker æ ¹æ® PID+Partition+SeqNum å»é‡ï¼Œä¸¢å¼ƒé‡å¤çš„æ‰¹æ¬¡ã€‚</li><li><strong>äº‹åŠ¡ (Transactions)ï¼š</strong></li><li>è§£å†³è·¨åˆ†åŒºã€è·¨ä¼šè¯çš„â€œè¯»-å¤„ç†-å†™â€æ¨¡å¼ä¸‹çš„<strong>ç²¾ç¡®ä¸€æ¬¡</strong>è¯­ä¹‰ (ä¾‹å¦‚ Kafka Streams åº”ç”¨)ã€‚</li><li>åŸç†ï¼š</li><li>Producer å¼€å¯äº‹åŠ¡ (<code>initTransactions()</code>)ã€‚</li><li>å‘é€çš„æ¶ˆæ¯æ ‡è®°ä¸ºäº‹åŠ¡æ€§æ¶ˆæ¯ã€‚</li><li>å°†æ¶ˆè´¹å’Œç”Ÿäº§çš„ Offset æäº¤éƒ½åŒ…å«åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ (<code>sendOffsetsToTransaction()</code> + <code>commitTransaction()</code>)ã€‚</li><li>Broker ä½¿ç”¨äº‹åŠ¡åè°ƒå™¨ (Transaction Coordinator) ç®¡ç†äº‹åŠ¡çŠ¶æ€ (PREPARE_COMMIT, COMMITTED, ABORTED)ã€‚</li><li>æ¶ˆè´¹è€…é…ç½® <code>isolation.level=read_committed</code> åªè¯»å–å·²æäº¤çš„äº‹åŠ¡æ¶ˆæ¯ã€‚</li><li><strong>æ³¨æ„:</strong> ä¸¥æ ¼æ„ä¹‰çš„ç«¯åˆ°ç«¯ EOS è¿˜éœ€è¦ Consumer çš„è¾“å‡ºæ“ä½œæ˜¯å¹‚ç­‰çš„ã€‚</li></ul><h3 id="Kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ"><a href="#Kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ" class="headerlink" title="Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ"></a>Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Ÿ</h3><ul><li><strong>Kafka ä»…ä¿è¯å•ä¸ª Partition å†…æ¶ˆæ¯çš„ä¸¥æ ¼é¡ºåº (FIFO)ã€‚</strong> è¿™æ˜¯ç”±å…¶è¿½åŠ å†™å…¥å’Œå•çº¿ç¨‹æ¶ˆè´¹åˆ†åŒºçš„ç‰¹æ€§ä¿è¯çš„ã€‚</li><li><strong>æ— æ³•ä¿è¯è·¨ Partition çš„æ¶ˆæ¯å…¨å±€é¡ºåºã€‚</strong></li><li><strong>éœ€è¦å…¨å±€é¡ºåºæ€ä¹ˆåŠï¼Ÿ</strong> å°†æ‰€æœ‰éœ€è¦ä¿è¯é¡ºåºçš„æ¶ˆæ¯å‘é€åˆ°<strong>åŒä¸€ä¸ª Partition</strong>ã€‚é€šå¸¸é€šè¿‡ä¸ºè¿™äº›æ¶ˆæ¯æŒ‡å®š<strong>ç›¸åŒçš„ Key</strong> æ¥å®ç° (Producer æ ¹æ® Key çš„å“ˆå¸Œå€¼å†³å®š Partition)ã€‚</li><li><strong>éœ€è¦åˆ†åŒºé¡ºåºæ€ä¹ˆåŠï¼Ÿ</strong> ç¡®ä¿åŒä¸€ä¸ª Key çš„æ¶ˆæ¯æ€»æ˜¯å‘åˆ°åŒä¸€ä¸ª Partition (åŒæ ·é€šè¿‡ Key å“ˆå¸Œ)ï¼Œåˆ™è¯¥ Key ç›¸å…³çš„æ¶ˆæ¯åœ¨è¯¥ Partition å†…æ˜¯é¡ºåºçš„ã€‚</li></ul><h3 id="Kafka-ä¸­-Zookeeper-å’Œ-KRaft-çš„åŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆ-Kafka-è¦å»-Zookeeper-åŒ–ï¼Ÿ"><a href="#Kafka-ä¸­-Zookeeper-å’Œ-KRaft-çš„åŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆ-Kafka-è¦å»-Zookeeper-åŒ–ï¼Ÿ" class="headerlink" title="Kafka ä¸­ Zookeeper å’Œ KRaft çš„åŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆ Kafka è¦å» Zookeeper åŒ–ï¼Ÿ"></a>Kafka ä¸­ Zookeeper å’Œ KRaft çš„åŒºåˆ«ï¼Ÿä¸ºä»€ä¹ˆ Kafka è¦å» Zookeeper åŒ–ï¼Ÿ</h3><ul><li><strong>Zookeeper (ZK)ï¼š</strong> æ˜¯ Kafka 2.7 åŠä¹‹å‰ç‰ˆæœ¬çš„æ ¸å¿ƒå¤–éƒ¨ä¾èµ–ã€‚è´Ÿè´£ï¼š<ul><li>Broker æ³¨å†Œä¸å‘ç°</li><li>Controller é€‰ä¸¾</li><li>Topic é…ç½®å­˜å‚¨</li><li>ACL æƒé™å­˜å‚¨</li><li>(æ—§ç‰ˆ) Consumer Offset å­˜å‚¨</li></ul></li><li><strong>KRaftï¼š</strong> æ˜¯ Kafka å†…éƒ¨å®ç°çš„åŸºäº Raft å…±è¯†åè®®çš„å…ƒæ•°æ®ç®¡ç†ç³»ç»Ÿï¼Œä» Kafka 2.8 (é¢„è§ˆ) &#x2F; 3.0+ (ç”Ÿäº§å¯ç”¨) å¼€å§‹å¼•å…¥ï¼Œæ—¨åœ¨å®Œå…¨å–ä»£ Zookeeperã€‚</li><li><strong>å» ZK åŒ–åŸå›  (KRaft ä¼˜åŠ¿)ï¼š</strong><ul><li><strong>ç®€åŒ–æ¶æ„ä¸éƒ¨ç½²ï¼š</strong> ç§»é™¤å¤–éƒ¨ä¾èµ–ï¼ŒKafka è‡ªåŒ…å«ï¼Œéƒ¨ç½²ã€é…ç½®ã€ç›‘æ§æ›´ç®€å•ã€‚</li><li><strong>æå‡æ€§èƒ½ä¸å¯ä¼¸ç¼©æ€§ï¼š</strong> å…ƒæ•°æ®æ“ä½œç›´æ¥åœ¨ Kafka åè®®ä¸Šå¤„ç†ï¼Œå‡å°‘ä¸€æ¬¡ç½‘ç»œè·³è½¬å’Œåºåˆ—åŒ–å¼€é”€ã€‚KRaft è®¾è®¡ä¸Šèƒ½æ›´å¥½åœ°æ”¯æŒå¤§è§„æ¨¡é›†ç¾¤ï¼ˆæ•°ä¸‡ä¸ª Partitionï¼‰ã€‚</li><li><strong>æ›´å¼ºçš„å…ƒæ•°æ®ä¸€è‡´æ€§æ¨¡å‹ï¼š</strong> KRaft ä½¿ç”¨ Raft å¼ºä¸€è‡´æ€§åè®®ç®¡ç†å…ƒæ•°æ®çŠ¶æ€æœºã€‚</li><li><strong>æ›´ç›´æ¥çš„è¿ç»´ï¼š</strong> æ‰€æœ‰æ“ä½œé€šè¿‡ Kafka API æˆ– <code>kafka-metadata-shell</code> å®Œæˆï¼Œæ— éœ€å•ç‹¬ç®¡ç† ZKã€‚</li><li><strong>ç»Ÿä¸€å®‰å…¨æ¨¡å‹ï¼š</strong> å…ƒæ•°æ®é€šä¿¡å¤ç”¨ Kafka çš„å®‰å…¨æœºåˆ¶ (SSL&#x2F;SASL)ï¼Œæ— éœ€å•ç‹¬é…ç½® ZK å®‰å…¨ã€‚</li><li><strong>ç°çŠ¶ï¼š</strong> KRaft å·²æˆä¸ºç”Ÿäº§æ¨èæ¨¡å¼ï¼Œæ–°é›†ç¾¤åº”ä¼˜å…ˆä½¿ç”¨ KRaftã€‚Zookeeper æ¨¡å¼åœ¨é€æ­¥æ·˜æ±°ã€‚</li></ul></li></ul><h3 id="ä»€ä¹ˆæ˜¯-Consumer-Lagï¼Ÿå¦‚ä½•ç›‘æ§å’Œå¤„ç†-Lagï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Consumer-Lagï¼Ÿå¦‚ä½•ç›‘æ§å’Œå¤„ç†-Lagï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Consumer Lagï¼Ÿå¦‚ä½•ç›‘æ§å’Œå¤„ç† Lagï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Consumer Lagï¼Ÿå¦‚ä½•ç›‘æ§å’Œå¤„ç† Lagï¼Ÿ</h3><ul><li><strong>å®šä¹‰ï¼š</strong> Consumer Lag æŒ‡ Consumer Group åœ¨æŸä¸ª Partition ä¸Š<strong>æœ€æ–°æäº¤çš„ Offset</strong> ä¸ <strong>Partition å½“å‰æœ€æ–°æ¶ˆæ¯çš„ Offset (LEO)</strong> ä¹‹é—´çš„å·®å€¼ã€‚å³ <strong>æœªæ¶ˆè´¹çš„æ¶ˆæ¯æ•°é‡</strong>ã€‚</li><li><strong>ç›‘æ§é‡è¦æ€§ï¼š</strong> Lag æ˜¯è¡¡é‡æ¶ˆè´¹å¥åº·çŠ¶å†µçš„å…³é”®æŒ‡æ ‡ã€‚æŒç»­å¢é•¿çš„ Lag æ„å‘³ç€æ¶ˆè´¹é€Ÿåº¦è·Ÿä¸ä¸Šç”Ÿäº§é€Ÿåº¦ï¼Œå¯èƒ½å¯¼è‡´å»¶è¿Ÿå’Œæ•°æ®ç§¯å‹</li><li><strong>åŸå› ï¼š</strong><ul><li>æ¶ˆè´¹è€…å¤„ç†èƒ½åŠ›ä¸è¶³ (CPU, å†…å­˜, é€»è¾‘å¤æ‚, I&#x2F;O æ…¢)ã€‚</li><li>æ¶ˆè´¹è€…å®ä¾‹æ•°é‡ä¸è¶³ (Partition æ•° &gt; Consumer å®ä¾‹æ•°)ã€‚</li><li>ä¸‹æ¸¸ç³»ç»Ÿæ•…éšœæˆ–æ…¢ã€‚</li><li>æ¶ˆè´¹è€…ä»£ç  Bug æˆ–é…ç½®é—®é¢˜ (å¦‚ <code>max.poll.records</code> å¤ªå¤§å¯¼è‡´å•æ¬¡å¤„ç†æ—¶é—´è¿‡é•¿)ã€‚</li><li>ç½‘ç»œé—®é¢˜ã€‚</li></ul></li><li><strong>å¤„ç†ï¼š</strong><ul><li><strong>ç›‘æ§:</strong> ä½¿ç”¨ Kafka è‡ªå¸¦å·¥å…· (<code>kafka-consumer-groups.sh</code>)ï¼ŒJMX æŒ‡æ ‡ï¼Œæˆ–ç¬¬ä¸‰æ–¹ç›‘æ§ç³»ç»Ÿ (Prometheus+Grafana, Confluent Control Center)ã€‚</li><li><strong>æ‰©å®¹ï¼š</strong> å¢åŠ  Consumer Group å†…çš„ Consumer å®ä¾‹æ•° (ç¡®ä¿ &lt;&#x3D; Partition æ•°)ã€‚</li><li><strong>ä¼˜åŒ–æ¶ˆè´¹è€…ï¼š</strong> æå‡å• Consumer å¤„ç†èƒ½åŠ› (ä¼˜åŒ–ä»£ç é€»è¾‘ã€å¼‚æ­¥å¤„ç†ã€æ‰¹å¤„ç†ã€è°ƒä¼˜ JVM)ã€‚</li><li><strong>è°ƒæ•´å‚æ•°ï¼š</strong> é€‚å½“å¢åŠ  <code>fetch.min.bytes</code>, <code>fetch.max.wait.ms</code> æé«˜æ‹‰å–æ•ˆç‡ï¼›è°ƒæ•´ <code>max.poll.records</code> é¿å…å•æ¬¡å¤„ç†è¿‡å¤šæ¶ˆæ¯è¶…æ—¶ï¼›æ£€æŸ¥ <code>session.timeout.ms</code> å’Œ <code>max.poll.interval.ms</code> é¿å…è¯¯åˆ¤ç¦»çº¿è§¦å‘ Rebalanceã€‚</li><li><strong>æ’æŸ¥ä¸‹æ¸¸ä¾èµ–ã€‚</strong></li></ul></li></ul><h3 id="kafkaä¸»è¦åº”ç”¨åœºæ™¯ï¼šå¼‚æ­¥ã€å‰Šå³°ã€è§£è€¦"><a href="#kafkaä¸»è¦åº”ç”¨åœºæ™¯ï¼šå¼‚æ­¥ã€å‰Šå³°ã€è§£è€¦" class="headerlink" title="kafkaä¸»è¦åº”ç”¨åœºæ™¯ï¼šå¼‚æ­¥ã€å‰Šå³°ã€è§£è€¦"></a>kafkaä¸»è¦åº”ç”¨åœºæ™¯ï¼šå¼‚æ­¥ã€å‰Šå³°ã€è§£è€¦</h3><p>å¼‚æ­¥ï¼šç¼©çŸ­å“åº”æ—¶é—´</p><p>å®é™…åº”ç”¨</p><p>å‰Šå³°ï¼š</p><p>è§£è€¦ï¼š</p><h2 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h2><h2 id="RocketMQ"><a href="#RocketMQ" class="headerlink" title="RocketMQ"></a>RocketMQ</h2><h1 id="å¼€å‘æ¡†æ¶"><a href="#å¼€å‘æ¡†æ¶" class="headerlink" title="å¼€å‘æ¡†æ¶"></a>å¼€å‘æ¡†æ¶</h1><h2 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h2><h3 id="å¾ªç¯ä¾èµ–è§£å†³åŸç†"><a href="#å¾ªç¯ä¾èµ–è§£å†³åŸç†" class="headerlink" title="å¾ªç¯ä¾èµ–è§£å†³åŸç†"></a>å¾ªç¯ä¾èµ–è§£å†³åŸç†</h3><p>Spring é€šè¿‡<strong>ä¸‰çº§ç¼“å­˜ï¼ˆä¸‰çº§ Map ç»“æ„ï¼‰</strong>è§£å†³å•ä¾‹ Bean çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå…¶æ ¸å¿ƒåŸç†æ˜¯<strong>æå‰æš´éœ²æœªå®Œæˆåˆå§‹åŒ–çš„ Bean å¼•ç”¨</strong>ï¼Œä»è€Œæ‰“ç ´å¾ªç¯ä¾èµ–çš„åƒµå±€ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†åŸç†å’Œæµç¨‹ï¼š</p><p><strong>ä¸‰çº§ç¼“å­˜çš„å®šä¹‰ä¸ä½œç”¨</strong></p><ol><li><strong>ä¸€çº§ç¼“å­˜ï¼ˆsingletonObjectsï¼‰</strong><br>å­˜æ”¾<strong>å®Œå…¨åˆå§‹åŒ–å¥½çš„ Bean</strong>ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</li><li><strong>äºŒçº§ç¼“å­˜ï¼ˆearlySingletonObjectsï¼‰</strong><br>å­˜æ”¾<strong>æå‰æš´éœ²çš„ Bean çš„æ—©æœŸå¼•ç”¨</strong>ï¼ˆä»…å®ä¾‹åŒ–ï¼Œå°šæœªå¡«å……å±æ€§å’Œåˆå§‹åŒ–ï¼‰ã€‚</li><li><strong>ä¸‰çº§ç¼“å­˜ï¼ˆsingletonFactoriesï¼‰</strong><br>å­˜æ”¾ Bean çš„ <strong>ObjectFactory</strong>ï¼Œç”¨äºç”Ÿæˆ Bean çš„æ—©æœŸå¼•ç”¨ï¼ˆå¯èƒ½ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œç”¨äºæ”¯æŒ AOPï¼‰ã€‚</li></ol><p><strong>è§£å†³å¾ªç¯ä¾èµ–çš„æµç¨‹</strong></p><p>ä»¥ <code>A â†’ B â†’ A</code> çš„å¾ªç¯ä¾èµ–ä¸ºä¾‹ï¼š</p><ol><li><strong>åˆ›å»º Bean A</strong></li></ol><ul><li><strong>å®ä¾‹åŒ– A</strong>ï¼šè°ƒç”¨æ„é€ å‡½æ•°åˆ›å»º A å¯¹è±¡ï¼ˆæ­¤æ—¶å±æ€§æœªå¡«å……ï¼Œç§°ä¸ºâ€œæ—©æœŸå¯¹è±¡â€ï¼‰ã€‚</li><li><strong>å°† A çš„ ObjectFactory æ”¾å…¥ä¸‰çº§ç¼“å­˜</strong>ï¼š<br><code>addSingletonFactory(A_name, () -&gt; getEarlyBeanReference(A))</code><br>ï¼ˆè¿™ä¸€æ­¥æ˜¯å…³é”®ï¼Œå…è®¸åç»­ä¾èµ–é€šè¿‡ ObjectFactory è·å– A çš„æ—©æœŸå¼•ç”¨ï¼‰</li></ul><ol start="2"><li><strong>å¡«å…… A çš„å±æ€§</strong></li></ol><ul><li>å‘ç° A ä¾èµ– Bï¼Œè§¦å‘ <code>getBean(B)</code>ã€‚</li></ul><ol start="3"><li><strong>åˆ›å»º Bean B</strong></li></ol><ul><li><strong>å®ä¾‹åŒ– B</strong>ï¼šæ„é€ å‡½æ•°åˆ›å»º B å¯¹è±¡ã€‚</li><li><strong>å°† B çš„ ObjectFactory æ”¾å…¥ä¸‰çº§ç¼“å­˜</strong>ï¼š<br><code>addSingletonFactory(B_name, () -&gt; getEarlyBeanReference(B))</code></li></ul><ol start="4"><li><strong>å¡«å…… B çš„å±æ€§</strong></li></ol><ul><li>å‘ç° B ä¾èµ– Aï¼Œè§¦å‘ <code>getBean(A)</code>ã€‚</li><li><strong>ä»ä¸‰çº§ç¼“å­˜è·å– A çš„ ObjectFactory</strong>ï¼Œç”Ÿæˆ A çš„æ—©æœŸå¼•ç”¨ï¼ˆå¯èƒ½æ˜¯åŸå§‹å¯¹è±¡æˆ–ä»£ç†å¯¹è±¡ï¼‰ã€‚</li><li>å°† A çš„æ—©æœŸå¼•ç”¨æ”¾å…¥äºŒçº§ç¼“å­˜ï¼Œ<strong>åŒæ—¶åˆ é™¤ä¸‰çº§ç¼“å­˜ä¸­çš„ A</strong>ã€‚</li></ul><ol start="5"><li><strong>å®Œæˆ B çš„åˆå§‹åŒ–</strong></li></ol><ul><li>B çš„æ—©æœŸå¼•ç”¨æ³¨å…¥ A åï¼Œç»§ç»­å®Œæˆå…¶ä»–åˆå§‹åŒ–å’Œåç½®å¤„ç†ã€‚</li><li>å°† B æ”¾å…¥ä¸€çº§ç¼“å­˜ï¼Œ<strong>åˆ é™¤äºŒçº§å’Œä¸‰çº§ç¼“å­˜ä¸­çš„ B</strong>ã€‚</li></ul><ol start="6"><li><strong>å®Œæˆ A çš„åˆå§‹åŒ–</strong></li></ol><ul><li>B å·²å°±ç»ªï¼ŒA æ³¨å…¥ B åå®Œæˆå±æ€§å¡«å……å’Œåˆå§‹åŒ–ã€‚</li><li>å°† A æ”¾å…¥ä¸€çº§ç¼“å­˜ï¼Œ<strong>åˆ é™¤äºŒçº§ç¼“å­˜ä¸­çš„ A</strong>ã€‚</li></ul><p><strong>å…³é”®è®¾è®¡ç‚¹</strong></p><ol><li><strong>ä¸ºä»€ä¹ˆéœ€è¦ä¸‰çº§ç¼“å­˜ï¼Ÿ</strong><ul><li><strong>æ”¯æŒ AOP ä»£ç†</strong>ï¼š<br>å¦‚æœ Bean éœ€è¦è¢«ä»£ç†ï¼Œä¸‰çº§ç¼“å­˜çš„ ObjectFactory å¯ä»¥å»¶è¿Ÿç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œç¡®ä¿ä¾èµ–æ³¨å…¥çš„æ˜¯æœ€ç»ˆä»£ç†å¯¹è±¡ï¼Œè€ŒéåŸå§‹å¯¹è±¡ã€‚</li><li><strong>é¿å…é‡å¤åˆ›å»ºä»£ç†</strong>ï¼š<br>äºŒçº§ç¼“å­˜ï¼ˆ<code>earlySingletonObjects</code>ï¼‰ä¿å­˜å·²ç”Ÿæˆçš„æ—©æœŸå¯¹è±¡ï¼ˆå¯èƒ½æ˜¯ä»£ç†ï¼‰ï¼Œé¿å…å¤šæ¬¡è°ƒç”¨ ObjectFactoryã€‚</li></ul></li><li><strong>åªèƒ½è§£å†³å•ä¾‹ Bean çš„å¾ªç¯ä¾èµ–</strong><br>åŸå‹ï¼ˆPrototypeï¼‰Bean æ¯æ¬¡éƒ½ä¼šæ–°å»ºå®ä¾‹ï¼Œæ— æ³•é€šè¿‡ç¼“å­˜æå‰æš´éœ²å¼•ç”¨ã€‚</li><li><strong>æ„é€ å‡½æ•°å¾ªç¯ä¾èµ–æ— æ³•è§£å†³</strong><br>è‹¥å¾ªç¯ä¾èµ–é€šè¿‡æ„é€ å‡½æ•°å‘ç”Ÿï¼ŒBean å°šæœªå®ä¾‹åŒ–ï¼Œæ— æ³•æå‰æš´éœ²å¼•ç”¨ï¼ŒSpring ä¼šæŠ›å‡º <code>BeanCurrentlyInCreationException</code>ã€‚</li></ol><p><strong>æ€»ç»“</strong></p><p>Spring é€šè¿‡ä¸‰çº§ç¼“å­˜å®ç°ï¼š</p><ol><li><strong>æå‰æš´éœ²æœªåˆå§‹åŒ–çš„ Bean å¼•ç”¨</strong>ï¼ˆé€šè¿‡ ObjectFactoryï¼‰ã€‚</li><li><strong>å»¶è¿Ÿä»£ç†å¯¹è±¡çš„ç”Ÿæˆ</strong>ï¼Œç¡®ä¿ä¾èµ–æ³¨å…¥æ­£ç¡®çš„å¯¹è±¡ã€‚</li><li><strong>ç¼“å­˜å±‚çº§éš”ç¦»</strong>ï¼Œå¹³è¡¡æ€§èƒ½ä¸æ­£ç¡®æ€§ã€‚</li></ol><p>è¿™ä¸€æœºåˆ¶ä½¿å¾—å¤§å¤šæ•°å•ä¾‹ Bean çš„å¾ªç¯ä¾èµ–é—®é¢˜å¾—ä»¥è§£å†³ï¼ŒåŒæ—¶ä¿æŒäº†æ¡†æ¶çš„çµæ´»æ€§å’Œæ‰©å±•æ€§ã€‚</p><h3 id="FactoryBean-çš„ä½œç”¨ä¸åº”ç”¨"><a href="#FactoryBean-çš„ä½œç”¨ä¸åº”ç”¨" class="headerlink" title="FactoryBean çš„ä½œç”¨ä¸åº”ç”¨"></a><code>FactoryBean</code> çš„ä½œç”¨ä¸åº”ç”¨</h3><p><strong>1. FactoryBean çš„æ ¸å¿ƒä½œç”¨</strong><br>FactoryBean æ˜¯ Spring æ¡†æ¶ä¸­ç”¨äº <strong>å°è£…å¤æ‚å¯¹è±¡åˆ›å»ºé€»è¾‘</strong> çš„ç‰¹æ®Šæ¥å£ï¼Œå…¶æ ¸å¿ƒä½œç”¨å¦‚ä¸‹ï¼š</p><ul><li><strong>éšè—å¤æ‚æ„é€ è¿‡ç¨‹</strong>ï¼šå°†åˆå§‹åŒ–ç¹ççš„å¯¹è±¡ï¼ˆå¦‚ç¬¬ä¸‰æ–¹åº“ç»„ä»¶ï¼‰çš„åˆ›å»ºç»†èŠ‚å°è£…åœ¨ FactoryBean ä¸­ã€‚</li><li><strong>åŠ¨æ€å†³å®šå¯¹è±¡ç±»å‹</strong>ï¼šæ ¹æ®æ¡ä»¶è¿”å›ä¸åŒç±»å‹çš„ Bean å®ä¾‹ã€‚</li><li><strong>å»¶è¿Ÿåˆå§‹åŒ–</strong>ï¼šæ§åˆ¶å¯¹è±¡çš„åˆ›å»ºæ—¶æœºï¼Œå®ç°æŒ‰éœ€åŠ è½½ã€‚</li><li><strong>ç»Ÿä¸€ç®¡ç†ä¾èµ–</strong>ï¼šé›†ä¸­å¤„ç†å¯¹è±¡åˆ›å»ºæ—¶çš„ä¾èµ–æ³¨å…¥åŠé…ç½®ã€‚</li></ul><p><strong>2. FactoryBean æ¥å£æ–¹æ³•è§£æ</strong><br>å®ç° <code>FactoryBean</code> æ¥å£éœ€é‡å†™ä»¥ä¸‹æ–¹æ³•ï¼š</p><table><thead><tr><th align="left">æ–¹æ³•å</th><th align="left">ä½œç”¨</th></tr></thead><tbody><tr><td align="left"><code>T getObject()</code></td><td align="left">è¿”å›ç”± FactoryBean åˆ›å»ºçš„å®é™…å¯¹è±¡å®ä¾‹ã€‚</td></tr><tr><td align="left"><code>Class&lt;?&gt; getObjectType()</code></td><td align="left">è¿”å›åˆ›å»ºçš„å¯¹è±¡ç±»å‹ï¼Œç”¨äº Spring å®¹å™¨ç±»å‹æ£€æŸ¥ã€‚</td></tr><tr><td align="left"><code>boolean isSingleton()</code></td><td align="left">å†³å®šå¯¹è±¡æ˜¯å¦ä¸ºå•ä¾‹ã€‚é»˜è®¤ <code>true</code>ï¼Œè‹¥è¿”å› <code>false</code> åˆ™æ¯æ¬¡è¯·æ±‚åˆ›å»ºæ–°å®ä¾‹ã€‚</td></tr></tbody></table><p><strong>3. å®é™…åº”ç”¨ç¤ºä¾‹ï¼šè‡ªå®šä¹‰åŠ å¯†å·¥å…· FactoryBean</strong><br>å‡è®¾éœ€åˆ›å»ºä¸€ä¸ªæ ¹æ®é…ç½®åŠ¨æ€é€‰æ‹©åŠ å¯†ç®—æ³•çš„å·¥å…·ç±»ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><p><strong>æ­¥éª¤ 1ï¼šå®šä¹‰åŠ å¯†æ¥å£åŠå®ç°ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EncryptionTool</span> &#123;</span><br><span class="line">    String <span class="title function_">encrypt</span><span class="params">(String text)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AES åŠ å¯†å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AesEncryptionTool</span> <span class="keyword">implements</span> <span class="title class_">EncryptionTool</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encrypt</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;AESåŠ å¯†åçš„æ•°æ®: &quot;</span> + text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// RSA åŠ å¯†å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RsaEncryptionTool</span> <span class="keyword">implements</span> <span class="title class_">EncryptionTool</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encrypt</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;RSAåŠ å¯†åçš„æ•°æ®: &quot;</span> + text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤ 2ï¼šå®ç° EncryptionToolFactoryBean</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.FactoryBean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EncryptionToolFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;EncryptionTool&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> String algorithm; <span class="comment">// é…ç½®å±æ€§ï¼Œå†³å®šåŠ å¯†ç®—æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®ç®—æ³•ç±»å‹ï¼ˆé€šè¿‡Springå±æ€§æ³¨å…¥ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAlgorithm</span><span class="params">(String algorithm)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.algorithm = algorithm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> EncryptionTool <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;AES&quot;</span>.equalsIgnoreCase(algorithm)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AesEncryptionTool</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;RSA&quot;</span>.equalsIgnoreCase(algorithm)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RsaEncryptionTool</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;ä¸æ”¯æŒçš„åŠ å¯†ç®—æ³•: &quot;</span> + algorithm);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> EncryptionTool.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// å•ä¾‹æ¨¡å¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤ 3ï¼šé…ç½® Spring Bean</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- XML é…ç½®æ–¹å¼ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;encryptionTool&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.EncryptionToolFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;algorithm&quot;</span> <span class="attr">value</span>=<span class="string">&quot;AES&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ–ä½¿ç”¨ Java é…ç½®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FactoryBean&lt;EncryptionTool&gt; <span class="title function_">encryptionTool</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">EncryptionToolFactoryBean</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EncryptionToolFactoryBean</span>();</span><br><span class="line">        factory.setAlgorithm(<span class="string">&quot;RSA&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤ 4ï¼šåœ¨ä¸šåŠ¡ç±»ä¸­æ³¨å…¥ä½¿ç”¨</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EncryptionTool encryptionTool;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">encrypted</span> <span class="operator">=</span> encryptionTool.encrypt(password);</span><br><span class="line">        System.out.println(<span class="string">&quot;åŠ å¯†åçš„å¯†ç : &quot;</span> + encrypted);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ‰§è¡Œç»“æœ</strong>ï¼š<br>æ ¹æ®é…ç½®çš„ <code>algorithm</code> å€¼ï¼ˆAES æˆ– RSAï¼‰ï¼Œ<code>UserService</code> å°†è‡ªåŠ¨ä½¿ç”¨å¯¹åº”çš„åŠ å¯†å·¥å…·ã€‚</p><p><strong>4. è·å– FactoryBean å®ä¾‹æœ¬èº«</strong><br>è‹¥éœ€ç›´æ¥è·å– <code>FactoryBean</code> è€Œéå…¶åˆ›å»ºçš„å¯¹è±¡ï¼Œå¯åœ¨ Bean åç§°å‰åŠ  <code>&amp;</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FactoryBean&lt;?&gt; factory = context.getBean(<span class="string">&quot;&amp;encryptionTool&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>5. å®é™…åº”ç”¨åœºæ™¯æ€»ç»“</strong></p><ul><li><strong>MyBatis çš„ SqlSessionFactoryBean</strong>ï¼šå°è£… <code>SqlSessionFactory</code> çš„åˆ›å»ºï¼Œå¤„ç†æ•°æ®æºã€Mapper æ‰«æç­‰å¤æ‚é…ç½®ã€‚</li><li><strong>Spring çš„ ScheduledTaskFactoryBean</strong>ï¼šç”¨äºåŠ¨æ€åˆ›å»ºå®šæ—¶ä»»åŠ¡ Beanã€‚</li><li><strong>è¿æ¥æ± é…ç½®</strong>ï¼šå¦‚è‡ªå®šä¹‰ Druid æ•°æ®æºçš„è¯¦ç»†å‚æ•°åˆå§‹åŒ–ã€‚</li><li><strong>åŠ¨æ€ä»£ç†ç”Ÿæˆ</strong>ï¼šç»“åˆ AOPï¼Œä¸ºç‰¹å®šæ¥å£ç”Ÿæˆä»£ç†å®ä¾‹ã€‚</li></ul><p><strong>6. å¯¹æ¯”æ™®é€š @Bean æ–¹æ³•</strong></p><table><thead><tr><th align="left"><strong>ç‰¹æ€§</strong></th><th align="left"><strong>FactoryBean</strong></th><th align="left"><strong>@Bean æ–¹æ³•</strong></th></tr></thead><tbody><tr><td align="left"><strong>çµæ´»æ€§</strong></td><td align="left">é«˜ï¼ˆå¯åŠ¨æ€å†³å®šå¯¹è±¡ç±»å‹ï¼Œå®ç°å¤æ‚åˆå§‹åŒ–é€»è¾‘ï¼‰</td><td align="left">ä¸­ï¼ˆé€‚åˆç®€å•å¯¹è±¡åˆ›å»ºï¼‰</td></tr><tr><td align="left"><strong>ä»£ç å¤ç”¨</strong></td><td align="left">å¯é€šè¿‡ç»§æ‰¿å¤ç”¨é€»è¾‘</td><td align="left">éœ€é‡å¤ç¼–å†™ç›¸ä¼¼ä»£ç </td></tr><tr><td align="left"><strong>ç”Ÿå‘½å‘¨æœŸæ§åˆ¶</strong></td><td align="left">æ”¯æŒå»¶è¿Ÿåˆå§‹åŒ–åŠå•ä¾‹æ§åˆ¶</td><td align="left">ä¾èµ– <code>@Lazy</code> å’Œ <code>@Scope</code> æ³¨è§£</td></tr><tr><td align="left"><strong>é€‚ç”¨åœºæ™¯</strong></td><td align="left">å¤æ‚å¯¹è±¡åˆ›å»ºã€æ¡†æ¶é›†æˆ</td><td align="left">ç®€å• Bean å®šä¹‰ã€å¿«é€Ÿé…ç½®</td></tr></tbody></table><p><strong>æ€»ç»“</strong><br>FactoryBean æ˜¯ Spring ä¸­å¤„ç†å¤æ‚å¯¹è±¡åˆ›å»ºçš„å¼ºå¤§å·¥å…·ï¼Œç‰¹åˆ«é€‚ç”¨äºå°è£…åˆå§‹åŒ–é€»è¾‘ã€åŠ¨æ€ç”Ÿæˆå®ä¾‹åŠæ¡†æ¶é›†æˆã€‚åˆç†ä½¿ç”¨ FactoryBean èƒ½æ˜¾è‘—æå‡ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼Œå°¤å…¶åœ¨éœ€è¦ç²¾ç»†æ§åˆ¶ Bean åˆ›å»ºè¿‡ç¨‹æ—¶ï¼Œå…¶ä¼˜åŠ¿æ›´ä¸ºæ˜æ˜¾ã€‚</p><h3 id="BeanFactoryPostProcessor-å’Œ-BeanPostProcessor-çš„åŒºåˆ«"><a href="#BeanFactoryPostProcessor-å’Œ-BeanPostProcessor-çš„åŒºåˆ«" class="headerlink" title="BeanFactoryPostProcessor å’Œ BeanPostProcessor çš„åŒºåˆ«"></a><code>BeanFactoryPostProcessor</code> å’Œ <code>BeanPostProcessor</code> çš„åŒºåˆ«</h3><table><thead><tr><th align="left"><strong>ç‰¹æ€§</strong></th><th align="left"><strong>BeanFactoryPostProcessor</strong></th><th align="left"><strong>BeanPostProcessor</strong></th></tr></thead><tbody><tr><td align="left"><strong>ä½œç”¨é˜¶æ®µ</strong></td><td align="left">Bean å®šä¹‰åŠ è½½åã€Bean å®ä¾‹åŒ–<strong>ä¹‹å‰</strong></td><td align="left">Bean å®ä¾‹åŒ–åã€åˆå§‹åŒ–ï¼ˆ<code>init-method</code>ï¼‰<strong>å‰å</strong></td></tr><tr><td align="left"><strong>æ“ä½œå¯¹è±¡</strong></td><td align="left">ä¿®æ”¹ Bean çš„<strong>å®šä¹‰</strong>ï¼ˆ<code>BeanDefinition</code>ï¼‰</td><td align="left">ä¿®æ”¹æˆ–å¢å¼º Bean çš„<strong>å®ä¾‹</strong></td></tr><tr><td align="left"><strong>è§¦å‘æ¬¡æ•°</strong></td><td align="left">æ¯ä¸ªå®¹å™¨å¯åŠ¨æ—¶<strong>æ‰§è¡Œä¸€æ¬¡</strong></td><td align="left"><strong>æ¯ä¸ª Bean åˆå§‹åŒ–æ—¶éƒ½ä¼šè§¦å‘</strong></td></tr><tr><td align="left"><strong>ä¸»è¦ç”¨é€”</strong></td><td align="left">åŠ¨æ€ä¿®æ”¹ Bean é…ç½®ï¼ˆå¦‚å±æ€§å ä½ç¬¦æ›¿æ¢ï¼‰</td><td align="left">Bean å®ä¾‹çš„ä»£ç†å¢å¼ºï¼ˆå¦‚ AOPï¼‰ã€å±æ€§æ³¨å…¥</td></tr><tr><td align="left"><strong>æ¥å£æ–¹æ³•</strong></td><td align="left"><code>postProcessBeanFactory(ConfigurableListableBeanFactory)</code></td><td align="left"><code>postProcessBeforeInitialization(Object, String)</code> <code>postProcessAfterInitialization(Object, String)</code></td></tr><tr><td align="left"><strong>å…¸å‹å®ç°ç±»</strong></td><td align="left"><code>PropertySourcesPlaceholderConfigurer</code> <code>ConfigurationClassPostProcessor</code></td><td align="left"><code>AutowiredAnnotationBeanPostProcessor</code> <code>AnnotationAwareAspectJAutoProxyCreator</code></td></tr></tbody></table><p><strong>æ€»ç»“</strong></p><ul><li><strong>BeanFactoryPostProcessor</strong>ï¼šå¹²é¢„ Bean çš„<strong>å®šä¹‰é˜¶æ®µ</strong>ï¼Œç”¨äºå®¹å™¨çº§é…ç½®è°ƒæ•´ã€‚</li><li><strong>BeanPostProcessor</strong>ï¼šå¹²é¢„ Bean çš„<strong>å®ä¾‹åŒ–é˜¶æ®µ</strong>ï¼Œç”¨äº Bean çº§åŠŸèƒ½å¢å¼ºã€‚</li></ul><h3 id="Beanç”Ÿå‘½å‘¨æœŸæ‰©å±•ç‚¹å®æˆ˜"><a href="#Beanç”Ÿå‘½å‘¨æœŸæ‰©å±•ç‚¹å®æˆ˜" class="headerlink" title="Beanç”Ÿå‘½å‘¨æœŸæ‰©å±•ç‚¹å®æˆ˜"></a>Beanç”Ÿå‘½å‘¨æœŸæ‰©å±•ç‚¹å®æˆ˜</h3><p>Spring Bean ç”Ÿå‘½å‘¨æœŸçš„æ ¸å¿ƒé˜¶æ®µå’Œæ‰©å±•ç‚¹é¡ºåºï¼š</p><ol><li><strong>å®ä¾‹åŒ–</strong>ï¼ˆè°ƒç”¨æ„é€ å‡½æ•°ï¼‰</li><li><strong>å±æ€§èµ‹å€¼</strong>ï¼ˆä¾èµ–æ³¨å…¥ï¼‰</li><li><strong>BeanPostProcessor å‰ç½®å¤„ç†</strong>ï¼ˆ<code>postProcessBeforeInitialization</code>ï¼‰</li><li><strong>åˆå§‹åŒ–æ–¹æ³•</strong>ï¼ˆ<code>@PostConstruct</code> â†’ <code>InitializingBean</code> â†’ <code>init-method</code>ï¼‰</li><li><strong>BeanPostProcessor åç½®å¤„ç†</strong>ï¼ˆ<code>postProcessAfterInitialization</code>ï¼‰</li><li><strong>Bean å°±ç»ªï¼Œè¿›å…¥è¿è¡ŒæœŸ</strong></li><li><strong>é”€æ¯æ–¹æ³•</strong>ï¼ˆ<code>@PreDestroy</code> â†’ <code>DisposableBean</code> â†’ <code>destroy-method</code>ï¼‰</li></ol><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-942a927a-86e4-4a01-8f52-9addd89642ff.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring Beanç”Ÿå‘½å‘¨æœŸ"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AbstractAutowireCapableBeanFactory</span></span><br><span class="line"><span class="keyword">protected</span> Object <span class="title function_">doCreateBean</span><span class="params">(String beanName, RootBeanDefinition mbd, <span class="meta">@Nullable</span> Object[] args)</span></span><br><span class="line">        <span class="keyword">throws</span> BeanCreationException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Instantiate the bean.</span></span><br><span class="line">    <span class="type">BeanWrapper</span> <span class="variable">instanceWrapper</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (mbd.isSingleton()) &#123;</span><br><span class="line">        instanceWrapper = <span class="built_in">this</span>.factoryBeanInstanceCache.remove(beanName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (instanceWrapper == <span class="literal">null</span>) &#123;</span><br><span class="line">        instanceWrapper = createBeanInstance(beanName, mbd, args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> instanceWrapper.getWrappedInstance();</span><br><span class="line">    Class&lt;?&gt; beanType = instanceWrapper.getWrappedClass();</span><br><span class="line">    <span class="keyword">if</span> (beanType != NullBean.class) &#123;</span><br><span class="line">        mbd.resolvedTargetType = beanType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Allow post-processors to modify the merged bean definition.</span></span><br><span class="line">    <span class="keyword">synchronized</span> (mbd.postProcessingLock) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!mbd.postProcessed) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(mbd.getResourceDescription(), beanName,</span><br><span class="line">                        <span class="string">&quot;Post-processing of merged bean definition failed&quot;</span>, ex);</span><br><span class="line">            &#125;</span><br><span class="line">            mbd.postProcessed = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Eagerly cache singletons to be able to resolve circular references</span></span><br><span class="line">    <span class="comment">// even when triggered by lifecycle interfaces like BeanFactoryAware.</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">earlySingletonExposure</span> <span class="operator">=</span> (mbd.isSingleton() &amp;&amp; <span class="built_in">this</span>.allowCircularReferences &amp;&amp;</span><br><span class="line">            isSingletonCurrentlyInCreation(beanName));</span><br><span class="line">    <span class="keyword">if</span> (earlySingletonExposure) &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">            logger.trace(<span class="string">&quot;Eagerly caching bean &#x27;&quot;</span> + beanName +</span><br><span class="line">                    <span class="string">&quot;&#x27; to allow for resolving potential circular references&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize the bean instance.</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">exposedObject</span> <span class="operator">=</span> bean;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        populateBean(beanName, mbd, instanceWrapper);</span><br><span class="line">        exposedObject = initializeBean(beanName, exposedObject, mbd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> BeanCreationException &amp;&amp; beanName.equals(((BeanCreationException) ex).getBeanName())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> (BeanCreationException) ex;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(</span><br><span class="line">                    mbd.getResourceDescription(), beanName, <span class="string">&quot;Initialization of bean failed&quot;</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (earlySingletonExposure) &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">earlySingletonReference</span> <span class="operator">=</span> getSingleton(beanName, <span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (earlySingletonReference != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (exposedObject == bean) &#123;</span><br><span class="line">                exposedObject = earlySingletonReference;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">this</span>.allowRawInjectionDespiteWrapping &amp;&amp; hasDependentBean(beanName)) &#123;</span><br><span class="line">                String[] dependentBeans = getDependentBeans(beanName);</span><br><span class="line">                Set&lt;String&gt; actualDependentBeans = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;(dependentBeans.length);</span><br><span class="line">                <span class="keyword">for</span> (String dependentBean : dependentBeans) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!removeSingletonIfCreatedForTypeCheckOnly(dependentBean)) &#123;</span><br><span class="line">                        actualDependentBeans.add(dependentBean);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!actualDependentBeans.isEmpty()) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCurrentlyInCreationException</span>(beanName,</span><br><span class="line">                            <span class="string">&quot;Bean with name &#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27; has been injected into other beans [&quot;</span> +</span><br><span class="line">                            StringUtils.collectionToCommaDelimitedString(actualDependentBeans) +</span><br><span class="line">                            <span class="string">&quot;] in its raw version as part of a circular reference, but has eventually been &quot;</span> +</span><br><span class="line">                            <span class="string">&quot;wrapped. This means that said other beans do not use the final version of the &quot;</span> +</span><br><span class="line">                            <span class="string">&quot;bean. This is often the result of over-eager type matching - consider using &quot;</span> +</span><br><span class="line">                            <span class="string">&quot;&#x27;getBeanNamesForType&#x27; with the &#x27;allowEagerInit&#x27; flag turned off, for example.&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Register bean as disposable.</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        registerDisposableBeanIfNecessary(beanName, bean, mbd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (BeanDefinitionValidationException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(</span><br><span class="line">                mbd.getResourceDescription(), beanName, <span class="string">&quot;Invalid destruction signature&quot;</span>, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> exposedObject;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="SpringBootè‡ªåŠ¨é…ç½®åŸç†"><a href="#SpringBootè‡ªåŠ¨é…ç½®åŸç†" class="headerlink" title="SpringBootè‡ªåŠ¨é…ç½®åŸç†"></a>SpringBootè‡ªåŠ¨é…ç½®åŸç†</h3><p>Spring Bootçš„è‡ªåŠ¨é…ç½®æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼Œæ—¨åœ¨ç®€åŒ–åº”ç”¨çš„é…ç½®è¿‡ç¨‹ã€‚ä»¥ä¸‹æ˜¯å…¶å®ç°æœºåˆ¶çš„è¯¦ç»†æ­¥éª¤è§£æï¼š</p><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-df77ee15-2ff0-4ec7-8e65-e4ebb8ba88f1.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpringBootè‡ªåŠ¨é…ç½®åŸç†"></p><ol><li><strong>å¯ç”¨è‡ªåŠ¨é…ç½®</strong></li></ol><p>é€šè¿‡ä¸»ç±»ä¸Šçš„<code>@SpringBootApplication</code>æ³¨è§£ï¼Œè¯¥æ³¨è§£ç»„åˆäº†<code>@EnableAutoConfiguration</code>ï¼Œä»è€Œè§¦å‘è‡ªåŠ¨é…ç½®æœºåˆ¶ã€‚</p><ol start="2"><li><strong>åŠ è½½è‡ªåŠ¨é…ç½®ç±»</strong></li></ol><p>Spring Bootä¼šæ‰«ææ‰€æœ‰jaråŒ…ä¸­çš„<code>META-INF/spring.factories</code>æ–‡ä»¶ï¼Œè¯»å–<code>org.springframework.boot.autoconfigure.EnableAutoConfiguration</code>é”®ä¸‹çš„é…ç½®ç±»åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="string">\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration</span></span><br></pre></td></tr></table></figure><ol start="3"><li><strong>æ¡ä»¶åŒ–ç­›é€‰é…ç½®ç±»</strong></li></ol><p>æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»ä½¿ç”¨æ¡ä»¶æ³¨è§£å†³å®šæ˜¯å¦ç”Ÿæ•ˆï¼Œå¸¸è§æ¡ä»¶åŒ…æ‹¬ï¼š</p><ul><li><strong>@ConditionalOnClass</strong>ï¼šç±»è·¯å¾„å­˜åœ¨æŒ‡å®šç±»æ—¶ç”Ÿæ•ˆã€‚</li><li><strong>@ConditionalOnMissingBean</strong>ï¼šå®¹å™¨ä¸­æ— æŒ‡å®šBeanæ—¶ç”Ÿæ•ˆã€‚</li><li><strong>@ConditionalOnProperty</strong>ï¼šé…ç½®æ–‡ä»¶ä¸­å­˜åœ¨ç‰¹å®šå±æ€§æ—¶ç”Ÿæ•ˆã€‚</li></ul><p><strong>ç¤ºä¾‹ï¼šDataSourceAutoConfiguration</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;DataSource.class, EmbeddedDatabaseType.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(DataSourceProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">(DataSourceProperties properties)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> properties.initializeDataSourceBuilder().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>@ConditionalOnClass</strong>ç¡®ä¿å­˜åœ¨æ•°æ®åº“ç›¸å…³ç±»ã€‚</li><li><strong>@ConditionalOnMissingBean</strong>ä»…åœ¨ç”¨æˆ·æœªè‡ªå®šä¹‰DataSourceæ—¶åˆ›å»ºBeanã€‚</li></ul><ol start="4"><li><strong>ç»‘å®šé…ç½®å±æ€§</strong></li></ol><p>ä½¿ç”¨<code>@EnableConfigurationProperties</code>å°†é…ç½®å±æ€§ç±»ï¼ˆå¦‚<code>DataSourceProperties</code>ï¼‰ä¸é…ç½®æ–‡ä»¶ï¼ˆå¦‚<code>application.yml</code>ï¼‰ç»‘å®šï¼Œå…è®¸é€šè¿‡å±æ€§åŠ¨æ€é…ç½®Beanã€‚</p><p><strong>application.ymlç¤ºä¾‹</strong></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mydb</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">secret</span></span><br></pre></td></tr></table></figure><ol start="5"><li><strong>è‡ªåŠ¨é…ç½®Beançš„æ³¨å†Œ</strong></li></ol><p>æ»¡è¶³æ¡ä»¶çš„é…ç½®ç±»ä¸­çš„Beanå®šä¹‰è¢«æ³¨å†Œåˆ°Springåº”ç”¨ä¸Šä¸‹æ–‡ï¼Œä¾›å…¶ä»–ç»„ä»¶æ³¨å…¥ä½¿ç”¨ã€‚</p><h3 id="è‡ªå®šä¹‰Starterå¼€å‘è¦ç‚¹"><a href="#è‡ªå®šä¹‰Starterå¼€å‘è¦ç‚¹" class="headerlink" title="è‡ªå®šä¹‰Starterå¼€å‘è¦ç‚¹"></a>è‡ªå®šä¹‰Starterå¼€å‘è¦ç‚¹</h3><p><strong>1. Starter çš„æ ¸å¿ƒç»„æˆ</strong></p><p>ä¸€ä¸ªå®Œæ•´çš„ Starter åŒ…å«ä¸¤ä¸ªæ¨¡å—ï¼ˆå¯åˆå¹¶ï¼‰ï¼š</p><ol><li><strong><code>xxx-spring-boot-starter</code></strong><br>ç©ºæ¨¡å—ï¼Œä»…å£°æ˜ä¾èµ–ï¼ˆå¦‚è‡ªåŠ¨é…ç½®æ¨¡å—å’Œå…¶ä»–å¿…è¦ä¾èµ–ï¼‰ï¼Œä¾›ç”¨æˆ·ç›´æ¥å¼•å…¥ã€‚</li><li><strong><code>xxx-spring-boot-autoconfigure</code></strong><br>æ ¸å¿ƒå®ç°æ¨¡å—ï¼ŒåŒ…å«è‡ªåŠ¨é…ç½®ç±»ã€æ¡ä»¶æ³¨è§£ã€é…ç½®å±æ€§ç»‘å®šç­‰ã€‚</li></ol><p><strong>2. å¼€å‘æ­¥éª¤ä¸å…³é”®ä»£ç </strong></p><p><strong>æ­¥éª¤ 1ï¼šåˆ›å»ºé¡¹ç›®ç»“æ„</strong></p><p>ä½¿ç”¨ Maven æˆ– Gradle åˆ›å»ºæ¨¡å—ï¼Œå»ºè®®ç»“æ„ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">my-starter/</span><br><span class="line">  â”œâ”€â”€ my-starter-spring-boot-autoconfigure/  # è‡ªåŠ¨é…ç½®æ¨¡å—</span><br><span class="line">  â”‚   â”œâ”€â”€ src/main/java</span><br><span class="line">  â”‚   â”‚   â””â”€â”€ com/example/autoconfigure</span><br><span class="line">  â”‚   â”‚       â”œâ”€â”€ MyServiceAutoConfiguration.java  # è‡ªåŠ¨é…ç½®ç±»</span><br><span class="line">  â”‚   â”‚       â””â”€â”€ MyServiceProperties.java         # é…ç½®å±æ€§ç±»</span><br><span class="line">  â”‚   â””â”€â”€ src/main/resources/META-INF</span><br><span class="line">  â”‚       â”œâ”€â”€ spring.factories                    # è‡ªåŠ¨é…ç½®æ³¨å†Œ</span><br><span class="line">  â”‚       â””â”€â”€ additional-spring-configuration-metadata.json  # é…ç½®æç¤ºï¼ˆå¯é€‰ï¼‰</span><br><span class="line">  â”‚</span><br><span class="line">  â””â”€â”€ my-starter-spring-boot-starter/         # Starter å…¥å£æ¨¡å—</span><br><span class="line">      â””â”€â”€ pom.xml                             # ä»…ä¾èµ–è‡ªåŠ¨é…ç½®æ¨¡å—</span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤ 2ï¼šç¼–å†™è‡ªåŠ¨é…ç½®ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(MyServiceProperties.class)</span>  <span class="comment">// å¯ç”¨é…ç½®å±æ€§ç»‘å®š</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(MyService.class)</span>  <span class="comment">// ç±»è·¯å¾„å­˜åœ¨ MyService æ—¶ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServiceAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span>  <span class="comment">// ç”¨æˆ·æœªè‡ªå®šä¹‰æ—¶æ³¨å†Œ Bean</span></span><br><span class="line">    <span class="keyword">public</span> MyService <span class="title function_">myService</span><span class="params">(MyServiceProperties properties)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyService</span>(properties.getUrl(), properties.getTimeout());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤ 3ï¼šå®šä¹‰é…ç½®å±æ€§ç±»</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;my.service&quot;)</span>  <span class="comment">// é…ç½®å‰ç¼€</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServiceProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://default-url&quot;</span>;  <span class="comment">// é»˜è®¤å€¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">timeout</span> <span class="operator">=</span> <span class="number">5000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getter å’Œ Setter å¿…é¡»æä¾›</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUrl</span><span class="params">()</span> &#123; <span class="keyword">return</span> url; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUrl</span><span class="params">(String url)</span> &#123; <span class="built_in">this</span>.url = url; &#125;</span><br><span class="line">    <span class="comment">// ... å…¶ä»–å±æ€§</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤ 4ï¼šæ³¨å†Œè‡ªåŠ¨é…ç½®ç±»</strong></p><p>åœ¨ <code>resources/META-INF/spring.factories</code> ä¸­å£°æ˜ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="string">\</span></span><br><span class="line"><span class="string">com.example.autoconfigure.MyServiceAutoConfiguration</span></span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤ 5ï¼šé…ç½®æç¤ºï¼ˆå¯é€‰ï¼‰</strong></p><p>åœ¨ <code>resources/META-INF/additional-spring-configuration-metadata.json</code> ä¸­ä¸ºé…ç½®é¡¹æ·»åŠ æè¿°ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my.service.url&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java.lang.String&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æœåŠ¡ URL åœ°å€&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;defaultValue&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://default-url&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my.service.timeout&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java.lang.Integer&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;defaultValue&quot;</span><span class="punctuation">:</span> <span class="number">5000</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>æ­¥éª¤ 6ï¼šæ‰“åŒ…å¹¶å‘å¸ƒ</strong></p><ul><li><strong>Maven</strong>ï¼šé€šè¿‡ <code>mvn clean install</code> å®‰è£…åˆ°æœ¬åœ°ä»“åº“ï¼Œæˆ–éƒ¨ç½²åˆ° Nexus ç§æœã€‚</li><li><strong>Gradle</strong>ï¼šä½¿ç”¨ <code>publishToMavenLocal</code> æˆ–é…ç½®å‘å¸ƒä»»åŠ¡ã€‚</li></ul><p><strong>3. ä½¿ç”¨è‡ªå®šä¹‰ Starter</strong></p><p>ç”¨æˆ·å¼•å…¥ä¾èµ–åï¼Œå¯ç›´æ¥é€šè¿‡é…ç½®æ–‡ä»¶ï¼ˆå¦‚ <code>application.yml</code>ï¼‰é…ç½®å‚æ•°ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">my:</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://custom-url</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure><p><strong>4. å…³é”®æ³¨æ„äº‹é¡¹</strong></p><ol><li><p><strong>æ¡ä»¶åŒ–é…ç½®</strong><br>ä½¿ç”¨ <code>@ConditionalOnClass</code>, <code>@ConditionalOnProperty</code> ç­‰æ³¨è§£ï¼Œç¡®ä¿ Starter çµæ´»é€‚é…ä¸åŒåœºæ™¯ã€‚</p></li><li><p><strong>é¿å… Bean å†²çª</strong></p><ul><li>æ ¸å¿ƒ Bean ä½¿ç”¨ <code>@ConditionalOnMissingBean</code>ï¼Œå…è®¸ç”¨æˆ·è¦†ç›–ã€‚</li><li>é¿å…ä¸å…¶ä»– Starter çš„ Bean åç§°é‡å¤ã€‚</li></ul></li><li><p><strong>ç‰ˆæœ¬å…¼å®¹æ€§</strong></p><ul><li>Starter çš„ Spring Boot ç‰ˆæœ¬éœ€ä¸ç”¨æˆ·é¡¹ç›®åŒ¹é…ã€‚</li><li>ä½¿ç”¨ <code>spring-boot-dependencies</code> ç®¡ç†ä¾èµ–ç‰ˆæœ¬ã€‚</li></ul></li><li><p><strong>ä¾èµ–èŒƒå›´æ§åˆ¶</strong></p><ul><li>éå¿…è¦ä¾èµ–æ ‡è®°ä¸º <code>optional</code>ï¼ˆMavenï¼‰æˆ– <code>optional = true</code>ï¼ˆGradleï¼‰ï¼Œé¿å…ä¼ é€’ä¾èµ–æ±¡æŸ“ç”¨æˆ·é¡¹ç›®ã€‚</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Maven ç¤ºä¾‹ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>some-library<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>æ—¥å¿—ä¸æ–‡æ¡£</strong></p><ul><li>åœ¨ Starter ä¸­æä¾›æ¸…æ™°çš„æ—¥å¿—è¾“å‡ºï¼Œå¸®åŠ©ç”¨æˆ·è°ƒè¯•ã€‚</li><li>ç¼–å†™ README è¯´æ˜é…ç½®é¡¹å’Œä½¿ç”¨ç¤ºä¾‹ã€‚</li></ul></li></ol><p><strong>5. æµ‹è¯• Starter</strong></p><p>ç¼–å†™æµ‹è¯•ç±»éªŒè¯è‡ªåŠ¨é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServiceAutoConfigurationTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="keyword">private</span> MyService myService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAutoConfiguration</span><span class="params">()</span> &#123;</span><br><span class="line">        assertNotNull(myService);</span><br><span class="line">        assertEquals(<span class="string">&quot;http://custom-url&quot;</span>, myService.getUrl());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>6. æœ€ä½³å®è·µ</strong></p><ul><li><strong>æ¨¡å—åŒ–è®¾è®¡</strong>ï¼šå°†è‡ªåŠ¨é…ç½®ä¸ Starter åˆ†ç¦»ï¼Œæ–¹ä¾¿å…¶ä»–æ¨¡å—å¤ç”¨ã€‚</li><li><strong>é˜²å¾¡æ€§ç¼–ç¨‹</strong>ï¼šåœ¨è‡ªåŠ¨é…ç½®ç±»ä¸­æ£€æŸ¥ä¾èµ–æ˜¯å¦å­˜åœ¨ï¼ˆå¦‚é€šè¿‡ <code>@ConditionalOnClass</code>ï¼‰ã€‚</li><li><strong>é»˜è®¤é…ç½®åˆç†</strong>ï¼šæä¾›å®‰å…¨ã€é€šç”¨çš„é»˜è®¤å€¼ï¼Œå‡å°‘ç”¨æˆ·é…ç½®è´Ÿæ‹…ã€‚</li></ul><h3 id="ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µ"><a href="#ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µ" class="headerlink" title="ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µ"></a>ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µ</h3><p>ä»¥ä¸‹æ˜¯ <strong>Spring Boot ç»Ÿä¸€å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µ</strong>ï¼Œæ¶µç›–å¼‚å¸¸åˆ†ç±»ã€å…¨å±€å¤„ç†ã€æ—¥å¿—è®°å½•ã€é”™è¯¯å“åº”è§„èŒƒç­‰å…³é”®ç¯èŠ‚ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºå¥å£®ä¸”æ˜“ç»´æŠ¤çš„åº”ç”¨ç¨‹åºï¼š</p><p><strong>æ ¸å¿ƒåŸåˆ™</strong></p><ol><li><strong>ç»Ÿä¸€å…¥å£</strong>ï¼šæ‰€æœ‰å¼‚å¸¸ç”±å…¨å±€å¤„ç†å™¨æ•è·ï¼Œé¿å…åˆ†æ•£åœ¨å„å¤„ã€‚</li><li><strong>å‹å¥½å“åº”</strong>ï¼šå‰ç«¯æ¥æ”¶ç»“æ„åŒ–é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚JSONï¼‰ï¼ŒåŒ…å«é”™è¯¯ç ã€æç¤ºæ¶ˆæ¯ç­‰ã€‚</li><li><strong>åˆ†ç±»å¤„ç†</strong>ï¼šåŒºåˆ†ä¸šåŠ¡å¼‚å¸¸ã€ç³»ç»Ÿå¼‚å¸¸ã€å‚æ•°æ ¡éªŒå¼‚å¸¸ç­‰ï¼Œé’ˆå¯¹æ€§å¤„ç†ã€‚</li><li><strong>å®‰å…¨æ—¥å¿—</strong>ï¼šæ•æ„Ÿä¿¡æ¯è„±æ•ï¼Œå¼‚å¸¸æ—¥å¿—è¯¦ç»†è®°å½•ï¼Œä½†é¿å…æš´éœ²ç»™å®¢æˆ·ç«¯ã€‚</li></ol><p><strong>å®ç°æ­¥éª¤ä¸ä»£ç ç¤ºä¾‹</strong></p><ol><li><strong>å®šä¹‰ç»Ÿä¸€å“åº”æ ¼å¼</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;    <span class="comment">// çŠ¶æ€ç ï¼ˆå¦‚200æˆåŠŸï¼Œ500ç³»ç»Ÿé”™è¯¯ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> String msg;  <span class="comment">// æç¤ºä¿¡æ¯ï¼ˆç”¨æˆ·å‹å¥½ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> T data;      <span class="comment">// å“åº”æ•°æ®</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æˆåŠŸå“åº”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">success</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;æ“ä½œæˆåŠŸ&quot;</span>, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤±è´¥å“åº”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">error</span><span class="params">(<span class="type">int</span> code, String msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>&lt;&gt;(code, msg, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ„é€ æ–¹æ³•ã€Getter/Setterçœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>åˆ›å»ºå…¨å±€å¼‚å¸¸å¤„ç†å™¨</strong></li></ol><p>ä½¿ç”¨ <code>@ControllerAdvice</code> + <code>@ExceptionHandler</code> æ•è·å…¨å±€å¼‚å¸¸ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(BusinessException.class)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Void&gt; <span class="title function_">handleBusinessException</span><span class="params">(BusinessException e)</span> &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;ä¸šåŠ¡å¼‚å¸¸: &#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> Result.error(e.getCode(), e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†å‚æ•°æ ¡éªŒå¼‚å¸¸ï¼ˆJSR-303ï¼‰</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Void&gt; <span class="title function_">handleValidationException</span><span class="params">(MethodArgumentNotValidException e)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> e.getBindingResult().getFieldErrors().stream()</span><br><span class="line">                .map(fieldError -&gt; fieldError.getField() + <span class="string">&quot;: &quot;</span> + fieldError.getDefaultMessage())</span><br><span class="line">                .collect(Collectors.joining(<span class="string">&quot;; &quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="number">400</span>, <span class="string">&quot;å‚æ•°æ ¡éªŒå¤±è´¥: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤„ç†å…¶ä»–æœªæ•è·å¼‚å¸¸</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Void&gt; <span class="title function_">handleException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;ç³»ç»Ÿå¼‚å¸¸: &quot;</span>, e);  <span class="comment">// è®°å½•å®Œæ•´å †æ ˆ</span></span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="number">500</span>, <span class="string">&quot;ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BusinessException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(<span class="type">int</span> code, String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¿«é€Ÿåˆ›å»ºå¸¸ç”¨å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> BusinessException <span class="title function_">of</span><span class="params">(<span class="type">int</span> code, String msg)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(code, msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123; <span class="keyword">return</span> code; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li><strong>å‚æ•°æ ¡éªŒè§„èŒƒåŒ–</strong></li></ol><p>åœ¨ DTO ä¸­ä½¿ç”¨æ ¡éªŒæ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDTO</span> &#123;</span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;ç”¨æˆ·åä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Email(message = &quot;é‚®ç®±æ ¼å¼ä¸æ­£ç¡®&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getter/Setterçœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li><strong>HTTPçŠ¶æ€ç ä¸é”™è¯¯ç æ˜ å°„</strong></li></ol><table><thead><tr><th align="left">å¼‚å¸¸ç±»å‹</th><th align="left">HTTPçŠ¶æ€ç </th><th align="left">é”™è¯¯ç </th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left"><code>BusinessException</code></td><td align="left">200</td><td align="left">è‡ªå®šä¹‰</td><td align="left">ä¸šåŠ¡é€»è¾‘é”™è¯¯ï¼ˆå¦‚è®¢å•çŠ¶æ€å¼‚å¸¸ï¼‰</td></tr><tr><td align="left"><code>MethodArgumentNotValid</code></td><td align="left">400</td><td align="left">400</td><td align="left">å‚æ•°æ ¡éªŒå¤±è´¥</td></tr><tr><td align="left"><code>AuthenticationException</code></td><td align="left">401</td><td align="left">401</td><td align="left">æœªç™»å½•æˆ–Tokenè¿‡æœŸ</td></tr><tr><td align="left"><code>AccessDeniedException</code></td><td align="left">403</td><td align="left">403</td><td align="left">æ— æƒé™è®¿é—®</td></tr><tr><td align="left"><code>å…¶ä»–æœªæ•è·å¼‚å¸¸</code></td><td align="left">500</td><td align="left">500</td><td align="left">ç³»ç»Ÿå†…éƒ¨é”™è¯¯</td></tr></tbody></table><p><strong>ä¸‰ã€æœ€ä½³å®è·µ</strong></p><ol><li><strong>å¼‚å¸¸åˆ†ç±»åˆ†å±‚å¤„ç†</strong></li></ol><ul><li><strong>ä¸šåŠ¡å¼‚å¸¸</strong>ï¼šç”±å¼€å‘è€…ä¸»åŠ¨æŠ›å‡ºï¼ˆå¦‚åº“å­˜ä¸è¶³ï¼‰ï¼Œæ˜ç¡®æç¤ºç”¨æˆ·ã€‚</li><li><strong>ç³»ç»Ÿå¼‚å¸¸</strong>ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥ç­‰ï¼Œæç¤ºå‹å¥½ä¿¡æ¯ï¼Œè®°å½•è¯¦ç»†æ—¥å¿—ã€‚</li><li><strong>ç¬¬ä¸‰æ–¹æœåŠ¡å¼‚å¸¸</strong>ï¼šå°è£…ä¸ºç‰¹å®šå¼‚å¸¸ï¼ˆå¦‚ <code>ThirdPartyException</code>ï¼‰ï¼Œé¿å…æ±¡æŸ“æ ¸å¿ƒé€»è¾‘ã€‚</li></ul><ol start="2"><li><strong>æ—¥å¿—è®°å½•è§„èŒƒ</strong></li></ol><ul><li><strong>ä¸šåŠ¡å¼‚å¸¸</strong>ï¼šè®°å½• <code>WARN</code> çº§åˆ«ï¼ŒåŒ…å«å…³é”®å‚æ•°ã€‚</li><li><strong>ç³»ç»Ÿå¼‚å¸¸</strong>ï¼šè®°å½• <code>ERROR</code> çº§åˆ«ï¼Œè¾“å‡ºå®Œæ•´å †æ ˆã€‚</li><li><strong>æ•æ„Ÿä¿¡æ¯è„±æ•</strong>ï¼šå¦‚èº«ä»½è¯å·ã€æ‰‹æœºå·åœ¨æ—¥å¿—ä¸­æ©ç å¤„ç†ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler(PaymentException.class)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;Void&gt; <span class="title function_">handlePaymentException</span><span class="params">(PaymentException e)</span> &#123;</span><br><span class="line">    log.warn(<span class="string">&quot;æ”¯ä»˜å¤±è´¥, è®¢å•å·: &#123;&#125;, åŸå› : &#123;&#125;&quot;</span>, e.getOrderId(), e.getMessage());</span><br><span class="line">    <span class="keyword">return</span> Result.error(<span class="number">1001</span>, <span class="string">&quot;æ”¯ä»˜å¤±è´¥ï¼Œè¯·é‡è¯•&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>é”™è¯¯ç è§„èŒƒ</strong></li></ol><ul><li><strong>æ¨¡å—åˆ’åˆ†</strong>ï¼šæŒ‰æ¨¡å—å®šä¹‰é”™è¯¯ç èŒƒå›´ï¼ˆå¦‚ç”¨æˆ·æ¨¡å—1000-1999ï¼‰ã€‚</li><li><strong>æ–‡æ¡£ç»´æŠ¤</strong>ï¼šæä¾›é”™è¯¯ç å¯¹ç…§è¡¨ï¼Œæ–¹ä¾¿å‰åç«¯åä½œã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯ç å¸¸é‡ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ErrorCode</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">USER_NOT_FOUND</span> <span class="operator">=</span> <span class="number">1001</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ORDER_EXPIRED</span> <span class="operator">=</span> <span class="number">2001</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li><strong>å‰ç«¯å‹å¥½æç¤º</strong></li></ol><ul><li><strong>ç”¨æˆ·å¯è§æ¶ˆæ¯</strong>ï¼šç®€æ´æ˜ç¡®ï¼Œå¦‚â€œå¯†ç å¼ºåº¦ä¸è¶³ï¼Œè‡³å°‘åŒ…å«å¤§å°å†™å­—æ¯â€ã€‚</li><li><strong>æŠ€æœ¯ç»†èŠ‚éš”ç¦»</strong>ï¼šä¸è¿”å›Javaå¼‚å¸¸ç±»åã€å †æ ˆä¿¡æ¯ã€‚</li></ul><ol start="5"><li><strong>æµ‹è¯•è¦†ç›–</strong></li></ol><p>éªŒè¯å¼‚å¸¸å¤„ç†é€»è¾‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionHandlerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBusinessException</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        mockMvc.perform(get(<span class="string">&quot;/api/order/123&quot;</span>))</span><br><span class="line">               .andExpect(status().isOk())</span><br><span class="line">               .andExpect(jsonPath(<span class="string">&quot;$.code&quot;</span>).value(<span class="number">1001</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å››ã€å¸¸è§é—®é¢˜ä¸è§£å†³</strong></p><ol><li><strong>å¼‚å¸¸æœªè¢«æ•è·</strong><ul><li>æ£€æŸ¥ <code>@ControllerAdvice</code> æ˜¯å¦åœ¨ç»„ä»¶æ‰«æè·¯å¾„å†…ã€‚</li><li>ç¡®è®¤æ²¡æœ‰å…¶ä»–å¼‚å¸¸å¤„ç†å™¨å†²çªã€‚</li></ul></li><li><strong>å¾ªç¯ä¾èµ–å¯¼è‡´å¤„ç†å™¨å¤±æ•ˆ</strong><ul><li>ç¡®ä¿å…¨å±€å¤„ç†å™¨ä¸ä¾èµ–å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„Beanã€‚</li></ul></li><li><strong>å¼‚æ­¥çº¿ç¨‹å¼‚å¸¸ä¸¢å¤±</strong><ul><li>ä½¿ç”¨ <code>AsyncUncaughtExceptionHandler</code> å¤„ç†å¼‚æ­¥ä»»åŠ¡å¼‚å¸¸ã€‚</li></ul></li></ol><p><strong>äº”ã€æ€»ç»“</strong></p><p>é€šè¿‡ç»Ÿä¸€å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œå¯ä»¥å®ç°ï¼š</p><ul><li><strong>ä»£ç ç®€æ´æ€§</strong>ï¼šæ¶ˆé™¤é‡å¤çš„ <code>try-catch</code> å—ã€‚</li><li><strong>ç»´æŠ¤ä¾¿æ·æ€§</strong>ï¼šé›†ä¸­ç®¡ç†é”™è¯¯å“åº”é€»è¾‘ã€‚</li><li><strong>æ¥å£è§„èŒƒæ€§</strong>ï¼šå‰åç«¯éµå¾ªç»Ÿä¸€çš„é”™è¯¯åè®®ã€‚</li><li><strong>ç³»ç»Ÿå¥å£®æ€§</strong>ï¼šå…³é”®å¼‚å¸¸ä¸æ¼å¤„ç†ï¼Œæ—¥å¿—å¯è¿½æº¯ã€‚</li></ul><h3 id="é…ç½®åŠ è½½ä¼˜å…ˆçº§ï¼ˆå‘½ä»¤è¡Œ-ç¯å¢ƒå˜é‡ï¼‰"><a href="#é…ç½®åŠ è½½ä¼˜å…ˆçº§ï¼ˆå‘½ä»¤è¡Œ-ç¯å¢ƒå˜é‡ï¼‰" class="headerlink" title="é…ç½®åŠ è½½ä¼˜å…ˆçº§ï¼ˆå‘½ä»¤è¡Œ&gt;ç¯å¢ƒå˜é‡ï¼‰"></a>é…ç½®åŠ è½½ä¼˜å…ˆçº§ï¼ˆå‘½ä»¤è¡Œ&gt;ç¯å¢ƒå˜é‡ï¼‰</h3><table><thead><tr><th align="left">ä¼˜å…ˆçº§</th><th align="left">é…ç½®æº</th><th align="left">ç¤ºä¾‹</th></tr></thead><tbody><tr><td align="left"><strong>1</strong></td><td align="left"><strong>å‘½ä»¤è¡Œå‚æ•°</strong></td><td align="left"><code>--server.port=8081</code></td></tr><tr><td align="left"><strong>2</strong></td><td align="left">Java ç³»ç»Ÿå±æ€§ (<code>-D</code>)</td><td align="left"><code>-Dspring.datasource.url=jdbc:mysql://...</code></td></tr><tr><td align="left"><strong>3</strong></td><td align="left"><strong>æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡</strong></td><td align="left"><code>export SERVER_PORT=8081</code> (Linux)</td></tr><tr><td align="left"><strong>4</strong></td><td align="left">é…ç½®æ–‡ä»¶ï¼ˆå¦‚ <code>application.yml</code>ï¼‰</td><td align="left"><code>server.port: 8080</code></td></tr></tbody></table><h3 id="Spring-AOP-å’Œ-AspectJ-æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#Spring-AOP-å’Œ-AspectJ-æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="Spring AOP å’Œ AspectJ æœ‰ä»€ä¹ˆåŒºåˆ«"></a><code>Spring AOP</code> å’Œ <code>AspectJ</code> æœ‰ä»€ä¹ˆåŒºåˆ«</h3><h3 id="è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨ã€AOPçš„åŒºåˆ«ä¸å®è·µ"><a href="#è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨ã€AOPçš„åŒºåˆ«ä¸å®è·µ" class="headerlink" title="è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨ã€AOPçš„åŒºåˆ«ä¸å®è·µ"></a>è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨ã€AOPçš„åŒºåˆ«ä¸å®è·µ</h3><table><thead><tr><th align="left"><strong>ç»´åº¦</strong></th><th align="left"><strong>è¿‡æ»¤å™¨ï¼ˆFilterï¼‰</strong></th><th align="left"><strong>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰</strong></th><th align="left"><strong>AOPï¼ˆAspectï¼‰</strong></th></tr></thead><tbody><tr><td align="left"><strong>è§„èŒƒ&#x2F;æ¡†æ¶</strong></td><td align="left">Servlet è§„èŒƒï¼ˆJava EEï¼‰</td><td align="left">Spring MVC æ¡†æ¶</td><td align="left">Spring AOP &#x2F; AspectJ</td></tr><tr><td align="left"><strong>ä½œç”¨é˜¶æ®µ</strong></td><td align="left">è¯·æ±‚è¿›å…¥ Servlet å‰&#x2F;å“åº”è¿”å›å®¢æˆ·ç«¯å‰</td><td align="left">Controller æ–¹æ³•æ‰§è¡Œå‰å</td><td align="left">ä»»æ„ Bean æ–¹æ³•æ‰§è¡Œå‰å</td></tr><tr><td align="left"><strong>ä½œç”¨èŒƒå›´</strong></td><td align="left">æ‰€æœ‰ HTTP è¯·æ±‚ï¼ˆåŒ…æ‹¬é™æ€èµ„æºï¼‰</td><td align="left">Spring MVC å¤„ç†çš„è¯·æ±‚ï¼ˆåŠ¨æ€èµ„æºï¼‰</td><td align="left">Spring ç®¡ç†çš„ Bean æ–¹æ³•</td></tr><tr><td align="left"><strong>ä¾èµ–å…³ç³»</strong></td><td align="left">ä¾èµ– Servlet å®¹å™¨ï¼ˆTomcat&#x2F;Jettyï¼‰</td><td align="left">ä¾èµ– Spring å®¹å™¨</td><td align="left">ä¾èµ– Spring å®¹å™¨</td></tr><tr><td align="left"><strong>å¯è®¿é—®å¯¹è±¡</strong></td><td align="left">ServletRequest&#x2F;ServletResponse</td><td align="left">HttpServletRequest&#x2F;ModelAndView</td><td align="left">æ–¹æ³•å‚æ•°ã€æ³¨è§£ã€è¿”å›å€¼</td></tr><tr><td align="left"><strong>æ‰§è¡Œé¡ºåº</strong></td><td align="left">è¿‡æ»¤å™¨é“¾é¡ºåºï¼ˆweb.xml æˆ–æ³¨è§£é¡ºåºï¼‰</td><td align="left">æ‹¦æˆªå™¨æ³¨å†Œé¡ºåº</td><td align="left">åˆ‡é¢ä¼˜å…ˆçº§ï¼ˆ<code>@Order</code> æ³¨è§£ï¼‰</td></tr><tr><td align="left"><strong>å…¸å‹åœºæ™¯</strong></td><td align="left">å­—ç¬¦ç¼–ç ã€è·¨åŸŸå¤„ç†ã€è¯·æ±‚æ—¥å¿—</td><td align="left">æƒé™æ ¡éªŒã€å‚æ•°é¢„å¤„ç†ã€æ—¥å¿—è®°å½•</td><td align="left">äº‹åŠ¡ç®¡ç†ã€æ€§èƒ½ç›‘æ§ã€ç¼“å­˜æ§åˆ¶</td></tr></tbody></table><p><strong>æ‰§è¡Œæµç¨‹ä¸é¡ºåº</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// HTTP è¯·æ±‚å¤„ç†æµç¨‹</span><br><span class="line">HTTP Request â†’ Filter Chain â†’ DispatcherServlet â†’ Interceptor Chain â†’ Controller â†’ AOP Advice â†’ Response</span><br></pre></td></tr></table></figure><ol><li><strong>è¿‡æ»¤å™¨ï¼ˆFilterï¼‰</strong>ï¼šæœ€å…ˆæ‰§è¡Œï¼Œå¯æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼ˆå¦‚é™æ€èµ„æºï¼‰ã€‚</li><li><strong>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰</strong>ï¼šåœ¨ <code>DispatcherServlet</code> ä¹‹åã€Controller æ–¹æ³•ä¹‹å‰æ‰§è¡Œã€‚</li><li><strong>AOP åˆ‡é¢ï¼ˆAspectï¼‰</strong>ï¼šåœ¨ Controller æˆ– Service æ–¹æ³•æ‰§è¡Œå‰åè§¦å‘ã€‚</li></ol><p><strong>å®è·µåœºæ™¯ä¸ä»£ç ç¤ºä¾‹</strong></p><p><strong>åœºæ™¯ 1ï¼šå…¨å±€è¯·æ±‚æ—¥å¿—ï¼ˆè·¨æ‰€æœ‰è¯·æ±‚ï¼‰</strong></p><ul><li><p><strong>é€‰æ‹©æ–¹æ¡ˆ</strong>ï¼š<strong>è¿‡æ»¤å™¨ï¼ˆFilterï¼‰</strong><br><strong>åŸå› </strong>ï¼šéœ€è®°å½•æ‰€æœ‰è¯·æ±‚ï¼ˆåŒ…æ‹¬é™æ€èµ„æºï¼‰çš„åŸå§‹ä¿¡æ¯ï¼ˆå¦‚ IPã€URLï¼‰ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebFilter(urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest req, ServletResponse res, FilterChain chain)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        chain.doFilter(req, res); <span class="comment">// æ”¾è¡Œè¯·æ±‚</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">cost</span> <span class="operator">=</span> System.currentTimeMillis() - start;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¯·æ±‚è€—æ—¶: &quot;</span> + cost + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>åœºæ™¯ 2ï¼šç”¨æˆ·ç™»å½•æ ¡éªŒï¼ˆä»…åŠ¨æ€è¯·æ±‚ï¼‰</strong></p><ul><li><p><strong>é€‰æ‹©æ–¹æ¡ˆ</strong>ï¼š<strong>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰</strong><br><strong>åŸå› </strong>ï¼šéœ€è®¿é—® Spring ä¸Šä¸‹æ–‡ï¼ˆå¦‚è·å–ç”¨æˆ· Sessionï¼‰ï¼Œä¸”ä»…éœ€æ‹¦æˆªåŠ¨æ€è¯·æ±‚ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest req, HttpServletResponse res, Object handler)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (req.getSession().getAttribute(<span class="string">&quot;user&quot;</span>) == <span class="literal">null</span>) &#123;</span><br><span class="line">            res.sendRedirect(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// ä¸­æ–­è¯·æ±‚</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œæ‹¦æˆªå™¨</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">AuthInterceptor</span>()).addPathPatterns(<span class="string">&quot;/api/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>åœºæ™¯ 3ï¼šæ–¹æ³•çº§äº‹åŠ¡ç®¡ç†</strong></p><ul><li><p><strong>é€‰æ‹©æ–¹æ¡ˆ</strong>ï¼š<strong>AOPï¼ˆå£°æ˜å¼äº‹åŠ¡ï¼‰</strong><br><strong>åŸå› </strong>ï¼šéœ€åœ¨æ–¹æ³•æ‰§è¡Œå‰åç®¡ç†äº‹åŠ¡ï¼Œä¸ä¸šåŠ¡é€»è¾‘è§£è€¦ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionAspect</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PlatformTransactionManager txManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;@annotation(org.springframework.transaction.annotation.Transactional)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">manageTransaction</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">TransactionStatus</span> <span class="variable">status</span> <span class="operator">=</span> txManager.getTransaction(<span class="keyword">new</span> <span class="title class_">DefaultTransactionDefinition</span>());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">            txManager.commit(status);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            txManager.rollback(status);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>åœºæ™¯ 4ï¼šæ¥å£è€—æ—¶ç»Ÿè®¡</strong></p><ul><li><p><strong>é€‰æ‹©æ–¹æ¡ˆ</strong>ï¼š<strong>AOPï¼ˆç¯ç»•é€šçŸ¥ï¼‰</strong><br><strong>åŸå› </strong>ï¼šéœ€ç»Ÿè®¡ä»»æ„æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´ï¼Œçµæ´»ä½œç”¨äº Service å±‚æˆ– Controller å±‚ã€‚<br><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PerformanceAspect</span> &#123;</span><br><span class="line">    <span class="meta">@Around(&quot;execution(* com.example.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">logTime</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•æ‰§è¡Œè€—æ—¶: &quot;</span> + (System.currentTimeMillis() - start) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>å¦‚ä½•é€‰æ‹©ï¼Ÿ</strong></p><table><thead><tr><th align="left"><strong>æŠ€æœ¯</strong></th><th align="left"><strong>ä¼˜å…ˆä½¿ç”¨åœºæ™¯</strong></th></tr></thead><tbody><tr><td align="left"><strong>è¿‡æ»¤å™¨</strong></td><td align="left">å¤„ç†åŸå§‹è¯·æ±‚&#x2F;å“åº”ï¼ˆå¦‚è·¨åŸŸã€å‹ç¼©ï¼‰ã€å…¨å±€æ—¥å¿—ã€å®‰å…¨è¿‡æ»¤ï¼ˆXSS&#x2F;SQL æ³¨å…¥é˜²å¾¡ï¼‰</td></tr><tr><td align="left"><strong>æ‹¦æˆªå™¨</strong></td><td align="left">éœ€è¦ Spring ä¸Šä¸‹æ–‡æ”¯æŒã€åŠ¨æ€è¯·æ±‚æ‹¦æˆªï¼ˆå¦‚æƒé™æ ¡éªŒã€å‚æ•°é¢„å¤„ç†ï¼‰</td></tr><tr><td align="left"><strong>AOP</strong></td><td align="left">ä¸ä¸šåŠ¡é€»è¾‘è§£è€¦çš„æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚äº‹åŠ¡ã€æ—¥å¿—ã€ç¼“å­˜ã€æ€§èƒ½ç›‘æ§ï¼‰</td></tr></tbody></table><p><strong>æœ€ä½³å®è·µ</strong></p><ol><li><strong>é¿å…åŠŸèƒ½é‡å </strong>ï¼š<ul><li>è‹¥è¿‡æ»¤å™¨ä¸æ‹¦æˆªå™¨å®ç°ç›¸ä¼¼åŠŸèƒ½ï¼ˆå¦‚æ—¥å¿—ï¼‰ï¼Œé€‰æ‹©æ›´é è¿‘è¯·æ±‚å…¥å£çš„ç»„ä»¶ï¼ˆè¿‡æ»¤å™¨ï¼‰ã€‚</li></ul></li><li><strong>æ…ç”¨ AOP æ‹¦æˆª Controller</strong>ï¼š<ul><li>Controller æ–¹æ³•é€šå¸¸å·²ç”±æ‹¦æˆªå™¨å¤„ç†ï¼ŒAOP æ›´é€‚åˆ Service å±‚ã€‚</li></ul></li><li><strong>æ³¨æ„æ‰§è¡Œé¡ºåº</strong>ï¼š<ul><li>å¤šä¸ªè¿‡æ»¤å™¨&#x2F;æ‹¦æˆªå™¨éœ€æ˜ç¡®é¡ºåºï¼Œé¿å…ä¾èµ–é—®é¢˜ã€‚</li></ul></li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼š<ul><li>è¿‡æ»¤å™¨é“¾å’Œæ‹¦æˆªå™¨é“¾è¾ƒé•¿æ—¶ï¼Œå¯èƒ½å½±å“ååé‡ï¼Œéœ€åˆç†è®¾è®¡ã€‚</li></ul></li></ol><p>é€šè¿‡åˆç†é€‰æ‹©è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨å’Œ AOPï¼Œå¼€å‘è€…å¯ä»¥é«˜æ•ˆç®¡ç†æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œæå‡ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œç³»ç»Ÿæ€§èƒ½ã€‚</p><h3 id="æ³¨è§£çš„å®ç°åŸç†"><a href="#æ³¨è§£çš„å®ç°åŸç†" class="headerlink" title="æ³¨è§£çš„å®ç°åŸç†"></a>æ³¨è§£çš„å®ç°åŸç†</h3><p>åœ¨ Java ä¸­ï¼Œ<strong>æ³¨è§£ï¼ˆAnnotationï¼‰</strong> æ˜¯ä¸€ç§å…ƒæ•°æ®æœºåˆ¶ï¼Œå…¶æœ¬è´¨æ˜¯ä»£ç ä¸­çš„ç‰¹æ®Šæ ‡è®°ï¼Œéœ€é…åˆ <strong>æ³¨è§£å¤„ç†å™¨</strong> å®ç°å…·ä½“åŠŸèƒ½ã€‚æ³¨è§£æœ¬èº«ä¸åŒ…å«é€»è¾‘ï¼Œå…¶ä½œç”¨ç”±å¤„ç†å™¨å†³å®šã€‚ä»¥ä¸‹æ˜¯æ³¨è§£çš„å®ç°åŸç†è¯¦è§£ï¼š</p><p><strong>ä¸€ã€æ³¨è§£çš„æœ¬è´¨</strong></p><ol><li><strong>æ³¨è§£çš„åº•å±‚ç»“æ„</strong></li></ol><ul><li><p>æ³¨è§£æœ¬è´¨æ˜¯ç»§æ‰¿ <code>java.lang.annotation.Annotation</code> çš„ <strong>æ¥å£</strong>ã€‚</p></li><li><p>é€šè¿‡ JDK åŠ¨æ€ä»£ç†ç”Ÿæˆæ³¨è§£çš„å®ä¾‹ã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼šåç¼–è¯‘ <code>@Override</code> æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Override</span> <span class="keyword">extends</span> <span class="title class_">Annotation</span> &#123;</span><br><span class="line">    <span class="comment">// ç©ºæ¥å£ï¼Œä»…ä½œæ ‡è®°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ol start="2"><li><strong>å…ƒæ³¨è§£ï¼ˆMeta-Annotationï¼‰</strong></li></ol><p>ç”¨äºå®šä¹‰æ³¨è§£çš„è¡Œä¸ºï¼Œå¸¸è§å…ƒæ³¨è§£ï¼š</p><table><thead><tr><th align="left">å…ƒæ³¨è§£</th><th align="left">ä½œç”¨</th><th align="left">ç¤ºä¾‹</th></tr></thead><tbody><tr><td align="left"><code>@Target</code></td><td align="left">æŒ‡å®šæ³¨è§£å¯åº”ç”¨çš„ç›®æ ‡ï¼ˆç±»ã€æ–¹æ³•ã€å­—æ®µç­‰ï¼‰</td><td align="left"><code>@Target(ElementType.METHOD)</code></td></tr><tr><td align="left"><code>@Retention</code></td><td align="left">æŒ‡å®šæ³¨è§£çš„ä¿ç•™ç­–ç•¥ï¼ˆæºç ã€ç±»æ–‡ä»¶ã€è¿è¡Œæ—¶ï¼‰</td><td align="left"><code>@Retention(RetentionPolicy.RUNTIME)</code></td></tr><tr><td align="left"><code>@Documented</code></td><td align="left">æ³¨è§£æ˜¯å¦åŒ…å«åœ¨ Javadoc ä¸­</td><td align="left"><code>@Documented</code></td></tr><tr><td align="left"><code>@Inherited</code></td><td align="left">å­ç±»æ˜¯å¦ç»§æ‰¿çˆ¶ç±»çš„æ³¨è§£</td><td align="left"><code>@Inherited</code></td></tr></tbody></table><p><strong>äºŒã€æ³¨è§£çš„å¤„ç†æœºåˆ¶</strong></p><ol><li><strong>ç¼–è¯‘æ—¶å¤„ç†ï¼ˆAnnotation Processing Tool, APTï¼‰</strong></li></ol><ul><li><p><strong>åŸç†</strong>ï¼šåœ¨ç¼–è¯‘é˜¶æ®µï¼Œé€šè¿‡æ³¨è§£å¤„ç†å™¨ï¼ˆç»§æ‰¿ <code>AbstractProcessor</code>ï¼‰æ‰«æå’Œå¤„ç†æ³¨è§£ã€‚</p></li><li><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>ç”Ÿæˆä»£ç ï¼ˆå¦‚ Lombok ç”Ÿæˆ Getter&#x2F;Setterï¼‰ã€‚</li><li>è¯­æ³•æ£€æŸ¥ï¼ˆå¦‚ <code>@Override</code> éªŒè¯æ–¹æ³•é‡å†™ï¼‰ã€‚</li></ul></li><li><p><strong>ç¤ºä¾‹</strong>ï¼šè‡ªå®šä¹‰ç¼–è¯‘æ—¶æ³¨è§£å¤„ç†å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SupportedAnnotationTypes(&quot;com.example.MyAnnotation&quot;)</span></span><br><span class="line"><span class="meta">@SupportedSourceVersion(SourceVersion.RELEASE_8)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProcessor</span> <span class="keyword">extends</span> <span class="title class_">AbstractProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment env)</span> &#123;</span><br><span class="line">        <span class="comment">// å¤„ç†æ³¨è§£é€»è¾‘ï¼Œå¦‚ç”Ÿæˆä»£ç </span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ol start="2"><li><strong>è¿è¡Œæ—¶å¤„ç†ï¼ˆåå°„æœºåˆ¶ï¼‰</strong></li></ol><ul><li><p><strong>åŸç†</strong>ï¼šé€šè¿‡åå°„ APIï¼ˆå¦‚ <code>Class.getAnnotation()</code>ï¼‰åœ¨è¿è¡Œæ—¶è¯»å–æ³¨è§£ä¿¡æ¯ã€‚</p></li><li><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>åŠ¨æ€é…ç½®ï¼ˆå¦‚ Spring çš„ <code>@Autowired</code> ä¾èµ–æ³¨å…¥ï¼‰ã€‚</li><li>è‡ªå®šä¹‰é€»è¾‘ï¼ˆå¦‚æƒé™æ ¡éªŒã€æ—¥å¿—è®°å½•ï¼‰ã€‚</li></ul></li><li><p><strong>ç¤ºä¾‹</strong>ï¼šè¯»å–æ–¹æ³•ä¸Šçš„æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> obj.getClass().getMethod(<span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (method.isAnnotationPresent(MyAnnotation.class)) &#123;</span><br><span class="line">    <span class="type">MyAnnotation</span> <span class="variable">anno</span> <span class="operator">=</span> method.getAnnotation(MyAnnotation.class);</span><br><span class="line">    System.out.println(anno.value());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ol start="3"><li><strong>å­—èŠ‚ç å¢å¼ºå¤„ç†ï¼ˆAOP æ¡†æ¶ï¼‰</strong></li></ol><ul><li><strong>åŸç†</strong>ï¼šåœ¨ç±»åŠ è½½æ—¶ä¿®æ”¹å­—èŠ‚ç ï¼Œæ¤å…¥ä¸æ³¨è§£ç›¸å…³çš„é€»è¾‘ã€‚</li><li><strong>å·¥å…·</strong>ï¼šAspectJã€ASMã€Byte Buddyã€‚</li><li><strong>åº”ç”¨åœºæ™¯</strong>ï¼š<ul><li>å®ç° AOP åˆ‡é¢ï¼ˆå¦‚ <code>@Transactional</code> äº‹åŠ¡ç®¡ç†ï¼‰ã€‚</li><li>åŠ¨æ€ä»£ç†ï¼ˆå¦‚ Spring AOPï¼‰ã€‚</li></ul></li></ul><p><strong>ä¸‰ã€æ³¨è§£å¤„ç†çš„æ ¸å¿ƒæµç¨‹</strong></p><ol><li><strong>å®šä¹‰æ³¨è§£</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> LogExecution &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;default log&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>ä½¿ç”¨æ³¨è§£</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@LogExecution(&quot;ç”¨æˆ·æŸ¥è¯¢æ–¹æ³•&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>å¤„ç†æ³¨è§£ï¼ˆä»¥è¿è¡Œæ—¶ä¸ºä¾‹ï¼‰</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">logIfNeeded</span><span class="params">(Method method)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (method.isAnnotationPresent(LogExecution.class)) &#123;</span><br><span class="line">            <span class="type">LogExecution</span> <span class="variable">log</span> <span class="operator">=</span> method.getAnnotation(LogExecution.class);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ‰§è¡Œæ—¥å¿—: &quot;</span> + log.value());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException &#123;</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> UserService.class.getMethod(<span class="string">&quot;getUser&quot;</span>);</span><br><span class="line">        logIfNeeded(method); <span class="comment">// è¾“å‡ºï¼šæ‰§è¡Œæ—¥å¿—: ç”¨æˆ·æŸ¥è¯¢æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å››ã€æ³¨è§£çš„åº•å±‚å®ç°ï¼ˆåå°„åŠ¨æ€ä»£ç†ï¼‰</strong></p><p>å½“ä½¿ç”¨ <code>@LogExecution</code> æ—¶ï¼ŒJVM ä¼šé€šè¿‡åŠ¨æ€ä»£ç†ç”Ÿæˆæ³¨è§£å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿæˆçš„ä»£ç†ç±»ï¼ˆç®€åŒ–ç‰ˆï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogExecutionProxy</span> <span class="keyword">implements</span> <span class="title class_">LogExecution</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">value</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ç”¨æˆ·æŸ¥è¯¢æ–¹æ³•&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; annotationType() &#123;</span><br><span class="line">        <span class="keyword">return</span> LogExecution.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>äº”ã€å¸¸è§æ¡†æ¶ä¸­çš„æ³¨è§£åº”ç”¨</strong></p><table><thead><tr><th align="left"><strong>æ¡†æ¶</strong></th><th align="left"><strong>æ³¨è§£ç¤ºä¾‹</strong></th><th align="left"><strong>å¤„ç†æœºåˆ¶</strong></th></tr></thead><tbody><tr><td align="left"><strong>Spring</strong></td><td align="left"><code>@Autowired</code></td><td align="left">è¿è¡Œæ—¶åå°„ + ä¾èµ–æ³¨å…¥</td></tr><tr><td align="left"><strong>Lombok</strong></td><td align="left"><code>@Data</code></td><td align="left">ç¼–è¯‘æ—¶ APT ç”Ÿæˆä»£ç </td></tr><tr><td align="left"><strong>JUnit</strong></td><td align="left"><code>@Test</code></td><td align="left">è¿è¡Œæ—¶åå°„æ‰§è¡Œæµ‹è¯•æ–¹æ³•</td></tr><tr><td align="left"><strong>Hibernate</strong></td><td align="left"><code>@Entity</code></td><td align="left">è¿è¡Œæ—¶åå°„æ˜ å°„æ•°æ®åº“è¡¨</td></tr><tr><td align="left"><strong>AspectJ</strong></td><td align="left"><code>@Around</code></td><td align="left">ç¼–è¯‘æ—¶&#x2F;ç±»åŠ è½½æ—¶å­—èŠ‚ç å¢å¼º</td></tr></tbody></table><p><strong>å…­ã€æ³¨è§£çš„å±€é™æ€§</strong></p><ol><li><strong>æ— æ³•ç‹¬ç«‹å·¥ä½œ</strong>ï¼šå¿…é¡»ä¾èµ–å¤„ç†å™¨ï¼ˆAPTã€åå°„ã€AOP ç­‰ï¼‰ã€‚</li><li><strong>æ€§èƒ½å¼€é”€</strong>ï¼šè¿è¡Œæ—¶åå°„å¤„ç†å¯èƒ½å½±å“æ€§èƒ½ã€‚</li><li><strong>å¤æ‚åº¦é«˜</strong>ï¼šå­—èŠ‚ç å¢å¼ºéœ€æŒæ¡ ASM ç­‰å·¥å…·ã€‚</li></ol><p><strong>ä¸ƒã€æœ€ä½³å®è·µ</strong></p><ol><li><strong>æ˜ç¡®ä¿ç•™ç­–ç•¥</strong>ï¼š<ul><li>è‹¥åªéœ€ç¼–è¯‘æ—¶æ£€æŸ¥ï¼ˆå¦‚ <code>@Override</code>ï¼‰ï¼Œä½¿ç”¨ <code>RetentionPolicy.SOURCE</code>ã€‚</li><li>è‹¥éœ€è¿è¡Œæ—¶å¤„ç†ï¼ˆå¦‚ Spring æ³¨è§£ï¼‰ï¼Œä½¿ç”¨ <code>RetentionPolicy.RUNTIME</code>ã€‚</li></ul></li><li><strong>é¿å…è¿‡åº¦ä½¿ç”¨</strong>ï¼šæ³¨è§£æ»¥ç”¨ä¼šå¯¼è‡´ä»£ç å¯è¯»æ€§ä¸‹é™ã€‚</li><li><strong>ç»“åˆå·¥å…·é“¾</strong>ï¼šä½¿ç”¨ Lombokã€MapStruct ç­‰å·¥å…·ç®€åŒ–å¼€å‘ã€‚</li></ol><p>é€šè¿‡ç†è§£æ³¨è§£çš„å®ç°åŸç†ï¼Œå¼€å‘è€…å¯ä»¥æ›´é«˜æ•ˆåœ°åˆ©ç”¨å…¶å®ç°ä»£ç è§£è€¦ã€åŠ¨æ€é…ç½®å’Œè‡ªåŠ¨åŒ–å¤„ç†ï¼Œæå‡æ¡†æ¶çš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h3 id="MapperScan-çš„å®ç°åŸç†"><a href="#MapperScan-çš„å®ç°åŸç†" class="headerlink" title="@MapperScan çš„å®ç°åŸç†"></a><code>@MapperScan</code> çš„å®ç°åŸç†</h3><p><code>@MapperScan</code> æ˜¯ MyBatis-Spring æ•´åˆä¸­çš„æ ¸å¿ƒæ³¨è§£ï¼Œç”¨äºè‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œ Mapper æ¥å£ä¸º Spring Beanã€‚å…¶å®ç°åŸç†åŸºäº Spring çš„æ‰©å±•æœºåˆ¶å’Œ MyBatis çš„åŠ¨æ€ä»£ç†ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†æ­¥éª¤å’Œæ ¸å¿ƒé€»è¾‘ï¼š</p><p><strong>1. æ³¨è§£å®šä¹‰ä¸å…¥å£</strong></p><p><code>@MapperScan</code> é€šè¿‡ <code>@Import</code> å¼•å…¥ <code>MapperScannerRegistrar</code>ï¼Œè§¦å‘æ‰«æå’Œæ³¨å†Œé€»è¾‘ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Import(MapperScannerRegistrar.class)</span> <span class="comment">// å…³é”®ï¼šå¼•å…¥æ³¨å†Œå™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MapperScan &#123;</span><br><span class="line">    String[] value() <span class="keyword">default</span> &#123;&#125;; <span class="comment">// æ‰«æçš„åŒ…è·¯å¾„</span></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; annotationClass() <span class="keyword">default</span> Annotation.class;</span><br><span class="line">    <span class="comment">// å…¶ä»–é…ç½®å±æ€§...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2. MapperScannerRegistrar æ³¨å†Œ Bean å®šä¹‰</strong></p><p><code>MapperScannerRegistrar</code> å®ç° <code>ImportBeanDefinitionRegistrar</code> æ¥å£ï¼Œåœ¨ Spring å®¹å™¨å¯åŠ¨æ—¶åŠ¨æ€æ³¨å†Œ Beanï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperScannerRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// è§£æ @MapperScan æ³¨è§£çš„å±æ€§ï¼ˆå¦‚åŒ…è·¯å¾„ï¼‰</span></span><br><span class="line">        <span class="type">AnnotationAttributes</span> <span class="variable">attrs</span> <span class="operator">=</span> AnnotationAttributes.fromMap(metadata.getAnnotationAttributes(MapperScan.class.getName()));</span><br><span class="line">        <span class="comment">// åˆ›å»ºå¹¶é…ç½® ClassPathMapperScanner</span></span><br><span class="line">        <span class="type">ClassPathMapperScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathMapperScanner</span>(registry);</span><br><span class="line">        scanner.scan(attrs.getStringArray(<span class="string">&quot;value&quot;</span>)); <span class="comment">// æ‰§è¡Œæ‰«æ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3. ClassPathMapperScanner æ‰«ææ¥å£</strong></p><p><code>ClassPathMapperScanner</code> ç»§æ‰¿è‡ª Spring çš„ <code>ClassPathBeanDefinitionScanner</code>ï¼Œè‡ªå®šä¹‰æ‰«æè§„åˆ™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassPathMapperScanner</span> <span class="keyword">extends</span> <span class="title class_">ClassPathBeanDefinitionScanner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Set&lt;BeanDefinitionHolder&gt; <span class="title function_">doScan</span><span class="params">(String... basePackages)</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨çˆ¶ç±»æ‰«ææ–¹æ³•ï¼Œç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„æ¥å£</span></span><br><span class="line">        Set&lt;BeanDefinitionHolder&gt; beanDefinitions = <span class="built_in">super</span>.doScan(basePackages);</span><br><span class="line">        <span class="comment">// ä¸ºæ¯ä¸ªæ¥å£ç”Ÿæˆ BeanDefinitionï¼Œç»‘å®šåˆ° MapperFactoryBean</span></span><br><span class="line">        <span class="keyword">for</span> (BeanDefinitionHolder holder : beanDefinitions) &#123;</span><br><span class="line">            <span class="type">GenericBeanDefinition</span> <span class="variable">definition</span> <span class="operator">=</span> (GenericBeanDefinition) holder.getBeanDefinition();</span><br><span class="line">            <span class="comment">// è®¾ç½® Bean çš„å·¥å‚ç±»ä¸º MapperFactoryBean</span></span><br><span class="line">            definition.getConstructorArgumentValues().addGenericArgumentValue(definition.getBeanClassName());</span><br><span class="line">            definition.setBeanClass(MapperFactoryBean.class); <span class="comment">// å…³é”®ï¼šä»£ç†å·¥å‚</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> beanDefinitions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isCandidateComponent</span><span class="params">(AnnotatedBeanDefinition beanDefinition)</span> &#123;</span><br><span class="line">        <span class="comment">// ä»…é€‰æ‹©æ¥å£ä½œä¸ºå€™é€‰ç»„ä»¶ï¼ˆæ’é™¤ç±»ï¼‰</span></span><br><span class="line">        <span class="keyword">return</span> beanDefinition.getMetadata().isInterface();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>4. MapperFactoryBean åˆ›å»ºä»£ç†å¯¹è±¡</strong></p><p><code>MapperFactoryBean</code> æ˜¯ Spring çš„ <code>FactoryBean</code> å®ç°ï¼Œè´Ÿè´£ç”Ÿæˆ Mapper æ¥å£çš„ä»£ç†å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperFactoryBean</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">SqlSessionDaoSupport</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Class&lt;T&gt; mapperInterface;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// é€šè¿‡ SqlSession è·å– Mapper åŠ¨æ€ä»£ç†</span></span><br><span class="line">        <span class="keyword">return</span> getSqlSession().getMapper(<span class="built_in">this</span>.mapperInterface);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;T&gt; <span class="title function_">getObjectType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.mapperInterface;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>5. åŠ¨æ€ä»£ç†ä¸ SQL æ‰§è¡Œ</strong></p><p>MyBatis é€šè¿‡ <code>MapperProxy</code> ç”Ÿæˆæ¥å£çš„ JDK åŠ¨æ€ä»£ç†å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperProxy</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span>, Serializable &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// å°†æ–¹æ³•è°ƒç”¨è½¬æ¢ä¸º MappedStatement æ‰§è¡Œ</span></span><br><span class="line">        <span class="type">MapperMethod</span> <span class="variable">mapperMethod</span> <span class="operator">=</span> cachedMapperMethod(method);</span><br><span class="line">        <span class="keyword">return</span> mapperMethod.execute(sqlSession, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>6. æ•´åˆ Spring å®¹å™¨</strong></p><ul><li><strong>SqlSessionTemplate æ³¨å…¥</strong>ï¼š<br>MyBatis-Spring é…ç½® <code>SqlSessionTemplate</code>ï¼ˆçº¿ç¨‹å®‰å…¨çš„ SqlSession å®ç°ï¼‰ï¼Œç”± Spring ç®¡ç†æ•°æ®åº“è¿æ¥å’Œäº‹åŠ¡ã€‚</li><li><strong>ä¾èµ–å…³ç³»</strong>ï¼š<br><code>MapperFactoryBean</code> ä¾èµ– <code>SqlSessionTemplate</code>ï¼Œç¡®ä¿æ‰€æœ‰ Mapper ä»£ç†ä½¿ç”¨åŒä¸€äº‹åŠ¡ä¸Šä¸‹æ–‡ã€‚</li></ul><p><strong>7. è‡ªåŠ¨é…ç½®ä¸ Spring Boot é›†æˆ</strong></p><p>åœ¨ Spring Boot ä¸­ï¼Œ<code>@MapperScan</code> é€šå¸¸ä¸è‡ªåŠ¨é…ç½®ç±» <code>MyBatisAutoConfiguration</code> é…åˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; SqlSessionFactory.class, SqlSessionFactoryBean.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactory</span><span class="params">(DataSource dataSource)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º SqlSessionFactory</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ€»ç»“æµç¨‹</strong></p><ol><li><strong>æ³¨è§£è§¦å‘</strong>ï¼š<code>@MapperScan</code> å¼•å…¥ <code>MapperScannerRegistrar</code>ã€‚</li><li><strong>åŠ¨æ€æ³¨å†Œ</strong>ï¼š<code>MapperScannerRegistrar</code> ä½¿ç”¨ <code>ClassPathMapperScanner</code> æ‰«ææŒ‡å®šåŒ…ä¸‹çš„æ¥å£ã€‚</li><li><strong>Bean å®šä¹‰ç”Ÿæˆ</strong>ï¼šä¸ºæ¯ä¸ª Mapper æ¥å£åˆ›å»ºç»‘å®šåˆ° <code>MapperFactoryBean</code> çš„ Bean å®šä¹‰ã€‚</li><li><strong>ä»£ç†å®ä¾‹åŒ–</strong>ï¼šSpring å®¹å™¨å®ä¾‹åŒ–æ—¶ï¼Œ<code>MapperFactoryBean</code> é€šè¿‡ <code>SqlSessionTemplate</code> åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡ã€‚</li><li><strong>æ–¹æ³•æ‹¦æˆª</strong>ï¼šè°ƒç”¨ Mapper æ–¹æ³•æ—¶ï¼Œä»£ç†å¯¹è±¡å°†è¯·æ±‚è½¬å‘ç»™ MyBatis æ‰§è¡Œ SQLã€‚</li></ol><p><strong>å…³é”®è®¾è®¡ç‚¹</strong></p><ul><li><strong>è§£è€¦ä¸æ‰©å±•</strong>ï¼šé€šè¿‡ Spring çš„ <code>FactoryBean</code> å’Œ <code>ImportBeanDefinitionRegistrar</code> å®ç°æ— ç¼æ•´åˆã€‚</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šåŠ¨æ€ä»£ç†å’Œç¼“å­˜æœºåˆ¶ï¼ˆå¦‚ <code>MapperMethod</code> ç¼“å­˜ï¼‰å‡å°‘åå°„å¼€é”€ã€‚</li><li><strong>äº‹åŠ¡ä¸€è‡´æ€§</strong>ï¼šä¾èµ– Spring ç®¡ç†çš„äº‹åŠ¡ï¼Œç¡®ä¿ Mapper æ“ä½œåœ¨åŒä¸€ä¸ª <code>SqlSession</code> ä¸­æ‰§è¡Œã€‚</li></ul><p>é€šè¿‡ <code>@MapperScan</code>ï¼Œå¼€å‘è€…æ— éœ€æ‰‹åŠ¨é…ç½®æ¯ä¸ª Mapperï¼Œæ¡†æ¶è‡ªåŠ¨å®Œæˆæ¥å£åˆ° Bean çš„æ˜ å°„åŠä»£ç†ç”Ÿæˆï¼Œæå¤§ç®€åŒ–äº† MyBatis åœ¨ Spring ä¸­çš„ä½¿ç”¨ã€‚</p><h3 id="Autowired-çš„å®ç°åŸç†"><a href="#Autowired-çš„å®ç°åŸç†" class="headerlink" title="@Autowired çš„å®ç°åŸç†"></a><code>@Autowired</code> çš„å®ç°åŸç†</h3><p><code>@Autowired</code> æ˜¯ Spring æ¡†æ¶ä¸­å®ç°ä¾èµ–æ³¨å…¥çš„æ ¸å¿ƒæ³¨è§£ï¼Œå…¶åº•å±‚åŸç†åŸºäº <strong>Bean ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ã€<strong>åå°„æœºåˆ¶</strong> å’Œ <strong>BeanPostProcessor</strong> çš„åä½œã€‚ä»¥ä¸‹æ˜¯å…¶å®ç°åŸç†çš„è¯¦ç»†åˆ†æï¼š</p><p><strong>1. æ ¸å¿ƒæµç¨‹</strong></p><p><code>@Autowired</code> çš„ä¾èµ–æ³¨å…¥å‘ç”Ÿåœ¨ Bean çš„å®ä¾‹åŒ–é˜¶æ®µï¼ˆå±æ€§å¡«å……é˜¶æ®µï¼‰ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><p><strong>1.1 Bean å®ä¾‹åŒ–</strong></p><p>Spring å®¹å™¨é€šè¿‡åå°„è°ƒç”¨æ„é€ å‡½æ•°åˆ›å»º Bean å®ä¾‹ï¼ˆè‹¥å­˜åœ¨å¤šä¸ªæ„é€ å‡½æ•°ï¼Œä¼˜å…ˆé€‰æ‹©æ— å‚æ„é€ å‡½æ•°ï¼Œæˆ–æ ‡è®° <code>@Autowired</code> çš„æ„é€ å‡½æ•°ï¼‰ã€‚</p><p><strong>1.2 å±æ€§å¡«å……ï¼ˆä¾èµ–æ³¨å…¥ï¼‰</strong></p><ul><li><strong>è§¦å‘æ—¶æœº</strong>ï¼šåœ¨ <code>AbstractAutowireCapableBeanFactory</code> çš„ <code>populateBean()</code> æ–¹æ³•ä¸­ã€‚</li><li><strong>å¤„ç†ç»„ä»¶</strong>ï¼š<code>AutowiredAnnotationBeanPostProcessor</code>ï¼ˆç»§æ‰¿è‡ª <code>BeanPostProcessor</code>ï¼‰ã€‚</li></ul><p><strong>1.3 ä¾èµ–è§£æä¸æ³¨å…¥</strong></p><ol><li><strong>æ‰«ææ³¨è§£</strong>ï¼š<br>é€šè¿‡åå°„æ£€æŸ¥ Bean çš„å­—æ®µã€æ–¹æ³•å’Œæ„é€ å‡½æ•°ä¸Šçš„ <code>@Autowired</code> æ³¨è§£ã€‚</li><li><strong>è§£æä¾èµ–</strong>ï¼š<ul><li><strong>æŒ‰ç±»å‹åŒ¹é…</strong>ï¼šæŸ¥æ‰¾ä¸ä¾èµ–ç±»å‹åŒ¹é…çš„å€™é€‰ Beanã€‚</li><li><strong>æŒ‰åç§°åŒ¹é…</strong>ï¼šè‹¥å­˜åœ¨å¤šä¸ªåŒç±»å‹ Beanï¼ŒæŒ‰å­—æ®µ&#x2F;æ–¹æ³•å‚æ•°åç§°åŒ¹é…ï¼ˆéœ€ç»“åˆ <code>@Qualifier</code> æˆ– <code>@Primary</code> è§£å†³æ­§ä¹‰ï¼‰ã€‚</li></ul></li><li><strong>æ³¨å…¥ä¾èµ–</strong>ï¼š<ul><li><strong>å­—æ®µæ³¨å…¥</strong>ï¼šé€šè¿‡åå°„ <code>Field.setAccessible(true)</code> è®¾ç½®ç§æœ‰å­—æ®µå€¼ã€‚</li><li><strong>æ–¹æ³•æ³¨å…¥</strong>ï¼šåå°„è°ƒç”¨ Setter æ–¹æ³•ã€‚</li><li><strong>æ„é€ å‡½æ•°æ³¨å…¥</strong>ï¼šåœ¨å®ä¾‹åŒ–æ—¶é€šè¿‡æ„é€ å‡½æ•°å‚æ•°æ³¨å…¥ã€‚</li></ul></li></ol><p><strong>2. å…³é”®ç»„ä»¶è§£æ</strong></p><p><strong>2.1 AutowiredAnnotationBeanPostProcessor</strong></p><p>Spring å†…ç½®çš„ <code>BeanPostProcessor</code>ï¼Œè´Ÿè´£å¤„ç† <code>@Autowired</code> å’Œ <code>@Value</code> æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutowiredAnnotationBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span>, MergedBeanDefinitionPostProcessor &#123;</span><br><span class="line">    <span class="comment">// å­˜å‚¨å¾…æ³¨å…¥çš„å…ƒæ•°æ®ï¼ˆå­—æ®µã€æ–¹æ³•ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InjectionMetadata metadata;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PropertyValues <span class="title function_">postProcessProperties</span><span class="params">(PropertyValues pvs, Object bean, String beanName)</span> &#123;</span><br><span class="line">        <span class="comment">// æŸ¥æ‰¾å¹¶æ³¨å…¥ä¾èµ–</span></span><br><span class="line">        <span class="type">InjectionMetadata</span> <span class="variable">metadata</span> <span class="operator">=</span> findAutowiringMetadata(bean.getClass());</span><br><span class="line">        metadata.inject(bean, beanName, pvs);</span><br><span class="line">        <span class="keyword">return</span> pvs;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2.2 ä¾èµ–è§£ææµç¨‹</strong></p><p>åœ¨ <code>DefaultListableBeanFactory</code> ä¸­è§£æä¾èµ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">resolveDependency</span><span class="params">(DependencyDescriptor descriptor, String beanName, Set&lt;String&gt; autowiredBeanNames, TypeConverter typeConverter)</span> &#123;</span><br><span class="line">    <span class="comment">// æŒ‰ç±»å‹è·å–å€™é€‰ Bean åç§°</span></span><br><span class="line">    String[] candidateNames = findAutowireCandidates(beanName, type, descriptor);</span><br><span class="line">    <span class="comment">// ç­›é€‰å”¯ä¸€å€™é€‰ Bean</span></span><br><span class="line">    <span class="keyword">if</span> (candidateNames.length == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> getBean(candidateNames[<span class="number">0</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (candidateNames.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// æŒ‰åç§°æˆ– @Primary/@Priority è§£å†³å†²çª</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">primaryCandidate</span> <span class="operator">=</span> determinePrimaryCandidate(candidateNames);</span><br><span class="line">        <span class="keyword">return</span> primaryCandidate != <span class="literal">null</span> ? primaryCandidate : determineHighestPriorityCandidate(candidateNames);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æŠ›å‡º NoUniqueBeanDefinitionException å¼‚å¸¸</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3. æ³¨å…¥æ–¹å¼ä¸ä¼˜å…ˆçº§</strong></p><p><strong>3.1 æ„é€ å‡½æ•°æ³¨å…¥</strong></p><ul><li><p><strong>è§¦å‘æ¡ä»¶</strong>ï¼šè‹¥ç±»ä¸­å­˜åœ¨å”¯ä¸€æ„é€ å‡½æ•°ï¼Œæˆ–æ„é€ å‡½æ•°æ ‡è®°äº† <code>@Autowired</code>ã€‚</p></li><li><p><strong>ä¼˜åŠ¿</strong>ï¼šä¿è¯ä¾èµ–ä¸å¯å˜ï¼Œç¬¦åˆä¸å¯å˜å¯¹è±¡è®¾è®¡ã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(UserRepository userRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userRepository = userRepository;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>3.2 Setter æ–¹æ³•æ³¨å…¥</strong></p><ul><li><p><strong>è§¦å‘æ¡ä»¶</strong>ï¼šSetter æ–¹æ³•æ ‡è®° <code>@Autowired</code>ã€‚</p></li><li><p><strong>ä¼˜åŠ¿</strong>ï¼šå…è®¸å¯é€‰ä¾èµ–æˆ–åŠ¨æ€æ›´æ–°ä¾èµ–ã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> PaymentService paymentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPaymentService</span><span class="params">(PaymentService paymentService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.paymentService = paymentService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>3.3 å­—æ®µæ³¨å…¥</strong></p><ul><li><p><strong>è§¦å‘æ¡ä»¶</strong>ï¼šå­—æ®µç›´æ¥æ ‡è®° <code>@Autowired</code>ã€‚</p></li><li><p><strong>åŠ£åŠ¿</strong>ï¼šéš¾ä»¥å®ç°ä¸å¯å˜æ€§ï¼Œæµ‹è¯•æ—¶éœ€é€šè¿‡åå°„æ³¨å…¥ã€‚</p></li><li><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> InventoryService inventoryService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>4. è§£å†³ä¾èµ–å†²çª</strong></p><p><strong>4.1 @Qualifier</strong></p><p>é€šè¿‡åç§°æŒ‡å®šæ³¨å…¥çš„ Beanï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;mysqlDataSource&quot;)</span></span><br><span class="line"><span class="keyword">private</span> DataSource dataSource;</span><br></pre></td></tr></table></figure><p><strong>4.2 @Primary</strong></p><p>æ ‡è®°ä¼˜å…ˆé€‰æ‹©çš„ Beanï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> DataSource <span class="title function_">primaryDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HikariDataSource</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>4.3 è‡ªå®šä¹‰é™å®šç¬¦</strong></p><p>ç»“åˆè‡ªå®šä¹‰æ³¨è§£ä¸ <code>@Qualifier</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.PARAMETER&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Qualifier</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MysqlDatabase &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@MysqlDatabase</span></span><br><span class="line"><span class="keyword">private</span> DataSource dataSource;</span><br></pre></td></tr></table></figure><p><strong>5. æºç çº§å…³é”®é€»è¾‘</strong></p><p><strong>5.1 å­—æ®µæ³¨å…¥å®ç°</strong></p><p>åå°„è®¾ç½®å­—æ®µå€¼ï¼ˆç®€åŒ–ä»£ç ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> bean.getClass().getDeclaredField(<span class="string">&quot;userRepository&quot;</span>);</span><br><span class="line">field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">field.set(bean, userRepository);</span><br></pre></td></tr></table></figure><p><strong>5.2 æ–¹æ³•æ³¨å…¥å®ç°</strong></p><p>åå°„è°ƒç”¨æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> bean.getClass().getMethod(<span class="string">&quot;setUserRepository&quot;</span>, UserRepository.class);</span><br><span class="line">method.invoke(bean, userRepository);</span><br></pre></td></tr></table></figure><p><strong>6. æ€»ç»“ä¸æœ€ä½³å®è·µ</strong></p><ul><li><strong>åŸç†æœ¬è´¨</strong>ï¼š<code>@Autowired</code> é€šè¿‡ <code>BeanPostProcessor</code> åœ¨ Bean ç”Ÿå‘½å‘¨æœŸä¸­åŠ¨æ€è§£æå¹¶æ³¨å…¥ä¾èµ–ã€‚</li><li><strong>æ¨èæ–¹å¼</strong>ï¼šä¼˜å…ˆä½¿ç”¨ <strong>æ„é€ å‡½æ•°æ³¨å…¥</strong> ä¿è¯ä¾èµ–ä¸å¯å˜ã€‚</li><li><strong>é¿å…é™·é˜±</strong>ï¼š<ul><li><strong>å¾ªç¯ä¾èµ–</strong>ï¼šé¿å… A ä¾èµ– Bï¼ŒB åˆä¾èµ– Aï¼Œå¯é€šè¿‡ <code>@Lazy</code> å»¶è¿ŸåŠ è½½è§£å†³ã€‚</li><li><strong>å¤šå®ä¾‹å†²çª</strong>ï¼šä½¿ç”¨ <code>@Qualifier</code> æˆ– <code>@Primary</code> æ˜ç¡®æŒ‡å®š Beanã€‚</li></ul></li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šåå°„æ“ä½œæœ‰ä¸€å®šå¼€é”€ï¼Œä½† Spring é€šè¿‡ç¼“å­˜å…ƒæ•°æ®ï¼ˆå¦‚ <code>InjectionMetadata</code>ï¼‰å‡å°‘é‡å¤è§£æã€‚</li></ul><h3 id="SpringMVC-å·¥ä½œæµç¨‹"><a href="#SpringMVC-å·¥ä½œæµç¨‹" class="headerlink" title="SpringMVC å·¥ä½œæµç¨‹"></a>SpringMVC å·¥ä½œæµç¨‹</h3><p><strong>æ ¸å¿ƒç»„ä»¶</strong></p><ol><li><strong>DispatcherServlet</strong>ï¼šå‰ç½®æ§åˆ¶å™¨ï¼Œæ˜¯æ•´ä¸ªæµç¨‹æ§åˆ¶çš„<strong>æ ¸å¿ƒ</strong>ï¼Œæ§åˆ¶å…¶ä»–ç»„ä»¶çš„æ‰§è¡Œï¼Œè¿›è¡Œç»Ÿä¸€è°ƒåº¦ï¼Œé™ä½ç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ï¼Œç›¸å½“äºæ€»æŒ‡æŒ¥ã€‚</li><li><strong>Handler</strong>ï¼šå¤„ç†å™¨ï¼Œå®Œæˆå…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼Œç›¸å½“äº Servlet æˆ– Actionã€‚</li><li><strong>HandlerMapping</strong>ï¼šDispatcherServlet æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œé€šè¿‡ HandlerMapping å°†ä¸åŒçš„è¯·æ±‚æ˜ å°„åˆ°ä¸åŒçš„ Handlerã€‚</li><li><strong>HandlerInterceptor</strong>ï¼šå¤„ç†å™¨æ‹¦æˆªå™¨ï¼Œæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¦‚æœéœ€è¦å®Œæˆä¸€äº›æ‹¦æˆªå¤„ç†ï¼Œå¯ä»¥å®ç°è¯¥æ¥å£ã€‚</li><li><strong>HandlerExecutionChain</strong>ï¼šå¤„ç†å™¨æ‰§è¡Œé“¾ï¼ŒåŒ…æ‹¬ä¸¤éƒ¨åˆ†å†…å®¹ï¼šHandler å’Œ HandlerInterceptorï¼ˆç³»ç»Ÿä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ HandlerInterceptorï¼Œå¦‚æœéœ€è¦é¢å¤–è®¾ç½®æ‹¦æˆªï¼Œå¯ä»¥æ·»åŠ æ‹¦æˆªå™¨ï¼‰ã€‚</li><li><strong>HandlerAdapter</strong>ï¼šå¤„ç†å™¨é€‚é…å™¨ï¼ŒHandler æ‰§è¡Œä¸šåŠ¡æ–¹æ³•ä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼ŒåŒ…æ‹¬è¡¨å•æ•°æ®çš„éªŒè¯ã€æ•°æ®ç±»å‹çš„è½¬æ¢ã€å°†è¡¨å•æ•°æ®å°è£…åˆ° JavaBean ç­‰ï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯ç”± HandlerApater æ¥å®Œæˆï¼Œå¼€å‘è€…åªéœ€å°†æ³¨æ„åŠ›é›†ä¸­ä¸šåŠ¡é€»è¾‘çš„å¤„ç†ä¸Šï¼ŒDispatcherServlet é€šè¿‡ HandlerAdapter æ‰§è¡Œä¸åŒçš„ Handlerã€‚</li><li><strong>ModelAndView</strong>ï¼šè£…è½½äº†æ¨¡å‹æ•°æ®å’Œè§†å›¾ä¿¡æ¯ï¼Œä½œä¸º Handler çš„å¤„ç†ç»“æœï¼Œè¿”å›ç»™ DispatcherServletã€‚</li><li><strong>ViewResolver</strong>ï¼šè§†å›¾è§£æå™¨ï¼ŒDispatcheServlet é€šè¿‡å®ƒå°†é€»è¾‘è§†å›¾è§£æä¸ºç‰©ç†è§†å›¾ï¼Œæœ€ç»ˆå°†æ¸²æŸ“ç»“æœå“åº”ç»™å®¢æˆ·ç«¯ã€‚</li></ol><p><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/sidebar/sanfene/spring-e29a122b-db07-48b8-8289-7251032e87a1.png" alt="ä¸‰åˆ†æ¶é¢æ¸£é€†è¢­ï¼šSpring MVCçš„å·¥ä½œæµç¨‹"></p><h2 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h2><h3 id="SpringBootè‡ªåŠ¨è£…é…åŸç†"><a href="#SpringBootè‡ªåŠ¨è£…é…åŸç†" class="headerlink" title="SpringBootè‡ªåŠ¨è£…é…åŸç†"></a>SpringBootè‡ªåŠ¨è£…é…åŸç†</h3><p>Spring Boot çš„è‡ªåŠ¨è£…é…æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼Œå®ƒæå¤§åœ°ç®€åŒ–äº† Spring åº”ç”¨çš„é…ç½®è¿‡ç¨‹ï¼Œéµå¾ªâ€œ<strong>çº¦å®šå¤§äºé…ç½®</strong>â€çš„ç†å¿µã€‚å…¶æ ¸å¿ƒåŸç†å¯ä»¥åˆ†è§£ä¸ºä»¥ä¸‹å‡ ä¸ªå…³é”®ç‚¹ï¼š</p><ol><li><strong><code>@SpringBootApplication</code> æ³¨è§£ï¼š</strong><ul><li>è¿™æ˜¯ Spring Boot åº”ç”¨çš„å…¥å£æ³¨è§£ï¼Œæ ‡æ³¨åœ¨ä¸»å¯åŠ¨ç±»ä¸Šã€‚</li><li>å®ƒæ˜¯ä¸€ä¸ª<strong>ç»„åˆæ³¨è§£</strong>ï¼ŒåŒ…å«äº†ä¸‰ä¸ªæ ¸å¿ƒæ³¨è§£ï¼š<ul><li><code>@SpringBootConfiguration</code>: è¡¨æ˜è¯¥ç±»æ˜¯ä¸€ä¸ª Spring Boot çš„é…ç½®ç±»ï¼ˆæœ¬è´¨ä¸Šæ˜¯ <code>@Configuration</code>ï¼‰ã€‚</li><li><code>@EnableAutoConfiguration</code>: <strong>å¼€å¯è‡ªåŠ¨è£…é…çš„æ ¸å¿ƒæ³¨è§£</strong>ã€‚</li><li><code>@ComponentScan</code>: å¼€å¯ç»„ä»¶æ‰«æï¼Œé»˜è®¤æ‰«æä¸»é…ç½®ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ä¸‹çš„ <code>@Component</code>, <code>@Service</code>, <code>@Repository</code>, <code>@Controller</code> ç­‰æ³¨è§£çš„ç±»ã€‚</li></ul></li></ul></li><li><strong><code>@EnableAutoConfiguration</code> çš„æ ¸å¿ƒä½œç”¨ï¼š</strong><ul><li>è¿™ä¸ªæ³¨è§£é€šè¿‡ <code>@Import(AutoConfigurationImportSelector.class)</code> å¯¼å…¥äº† <code>AutoConfigurationImportSelector</code>ã€‚</li><li><strong><code>AutoConfigurationImportSelector</code> æ˜¯è‡ªåŠ¨è£…é…çš„å…³é”®å¼•æ“ï¼š</strong><ul><li>å®ƒå®ç°äº† <code>DeferredImportSelector</code> æ¥å£ï¼Œåœ¨ Spring å®¹å™¨å¤„ç†å®Œæ‰€æœ‰å¸¸è§„çš„ <code>@Configuration</code> ç±»ä¹‹åæ‰ä¼šæ‰§è¡Œã€‚</li><li>å®ƒçš„æ ¸å¿ƒæ–¹æ³•æ˜¯ <code>selectImports()</code>ã€‚è¿™ä¸ªæ–¹æ³•è´Ÿè´£<strong>å†³å®šéœ€è¦å¯¼å…¥å“ªäº›è‡ªåŠ¨é…ç½®ç±»</strong>ã€‚</li></ul></li></ul></li><li><strong><code>spring.factories</code> &#x2F; <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>ï¼ˆæ–°æ–¹å¼ï¼‰ï¼š</strong><ul><li><code>AutoConfigurationImportSelector</code> ä¼šå»<strong>ç±»è·¯å¾„ä¸‹æŸ¥æ‰¾ä¸€ä¸ªç‰¹å®šçš„æ–‡ä»¶</strong>æ¥è·å–æ‰€æœ‰å€™é€‰çš„è‡ªåŠ¨é…ç½®ç±»å…¨é™å®šåã€‚</li><li><strong>Spring Boot 2.7 ä¹‹å‰ï¼š</strong> æŸ¥æ‰¾ <code>META-INF/spring.factories</code> æ–‡ä»¶ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæœ‰ä¸€ä¸ªé”®ä¸º <code>org.springframework.boot.autoconfigure.EnableAutoConfiguration</code> çš„å±æ€§ï¼Œå…¶å€¼æ˜¯ä¸€ä¸ª<strong>é€—å·åˆ†éš”</strong>çš„è‡ªåŠ¨é…ç½®ç±»å…¨é™å®šååˆ—è¡¨ã€‚</li><li><strong>Spring Boot 2.7 åŠä¹‹åï¼š</strong> æ¨èä½¿ç”¨ <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code> æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶<strong>æ¯è¡Œå†™ä¸€ä¸ª</strong>è‡ªåŠ¨é…ç½®ç±»çš„å…¨é™å®šåã€‚è¿™æ˜¯ä¸ºäº†æ›´å¥½çš„ IDE æ”¯æŒå’Œå·¥å…·é“¾å…¼å®¹æ€§ï¼ˆå¦‚ GraalVM Native Imageï¼‰ã€‚Spring Boot ä»ç„¶å…¼å®¹ <code>spring.factories</code>ï¼Œä½†æ–°é¡¹ç›®å»ºè®®ä½¿ç”¨æ–°æ–¹å¼ã€‚</li><li><strong>æ¥æºï¼š</strong> è¿™äº›æ–‡ä»¶é€šå¸¸å­˜åœ¨äº <code>spring-boot-autoconfigure</code> jar åŒ…ä»¥åŠä½ å¼•å…¥çš„å„ç§ <code>starter</code> jar åŒ…ï¼ˆå¦‚ <code>spring-boot-starter-web</code>, <code>spring-boot-starter-data-jpa</code>ï¼‰ä¸­ã€‚æ¯ä¸ª <code>starter</code> é€šè¿‡æä¾›è‡ªå·±çš„ <code>spring.factories</code> æˆ– <code>AutoConfiguration.imports</code> æ–‡ä»¶æ¥å£°æ˜å®ƒéœ€è¦å“ªäº›è‡ªåŠ¨é…ç½®ã€‚</li></ul></li><li><strong>è‡ªåŠ¨é…ç½®ç±» (<code>@Configuration</code>)ï¼š</strong><ul><li>é€šè¿‡ä¸Šè¿°æœºåˆ¶æ‰¾åˆ°çš„å€™é€‰ç±»éƒ½æ˜¯æ ‡æœ‰ <code>@Configuration</code> æ³¨è§£çš„ Spring é…ç½®ç±»ã€‚</li><li>è¿™äº›é…ç½®ç±»å†…éƒ¨ä½¿ç”¨ <code>@Bean</code> æ³¨è§£å®šä¹‰äº†å¤§é‡<strong>æ¡ä»¶åŒ–</strong>çš„ Beanã€‚è¿™äº› Bean é€šå¸¸æ˜¯æ¡†æ¶æˆ–åº“çš„æ ¸å¿ƒç»„ä»¶ï¼ˆå¦‚ <code>DataSource</code>, <code>EntityManagerFactory</code>, <code>RestTemplate</code>, <code>DispatcherServlet</code> ç­‰ï¼‰ã€‚</li></ul></li><li><strong>æ¡ä»¶æ³¨è§£ (<code>@Conditional</code> åŠå…¶è¡ç”Ÿæ³¨è§£)ï¼š</strong><ul><li>è¿™æ˜¯è‡ªåŠ¨è£…é…<strong>æ™ºèƒ½æ€§</strong>çš„å…³é”®ï¼è‡ªåŠ¨é…ç½®ç±»åŠå…¶å†…éƒ¨çš„ <code>@Bean</code> æ–¹æ³•ä¸Šä¼šå¤§é‡ä½¿ç”¨æ¡ä»¶æ³¨è§£ã€‚</li><li>è¿™äº›æ³¨è§£æ§åˆ¶ç€é…ç½®ç±»å’Œ Bean <strong>æ˜¯å¦ä¼šè¢«çœŸæ­£åŠ è½½å’Œåˆ›å»º</strong>ã€‚å¸¸è§çš„æ¡ä»¶æ³¨è§£æœ‰ï¼š<ul><li><code>@ConditionalOnClass</code>: å½“ç±»è·¯å¾„ä¸­å­˜åœ¨æŒ‡å®šçš„ç±»æ—¶æ‰ç”Ÿæ•ˆã€‚</li><li><code>@ConditionalOnMissingClass</code>: å½“ç±»è·¯å¾„ä¸­ä¸å­˜åœ¨æŒ‡å®šçš„ç±»æ—¶æ‰ç”Ÿæ•ˆã€‚</li><li><code>@ConditionalOnBean</code>: å½“å®¹å™¨ä¸­å­˜åœ¨æŒ‡å®šçš„ Bean æ—¶æ‰ç”Ÿæ•ˆã€‚</li><li><code>@ConditionalOnMissingBean</code>: å½“å®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šçš„ Bean æ—¶æ‰ç”Ÿæ•ˆã€‚<strong>è¿™æ˜¯å…è®¸ç”¨æˆ·è‡ªå®šä¹‰ Bean è¦†ç›–é»˜è®¤é…ç½®çš„å…³é”®ï¼</strong></li><li><code>@ConditionalOnProperty</code>: å½“æŒ‡å®šçš„é…ç½®å±æ€§æ»¡è¶³ç‰¹å®šæ¡ä»¶ï¼ˆå¦‚å­˜åœ¨ã€ç­‰äºæŸä¸ªå€¼ï¼‰æ—¶æ‰ç”Ÿæ•ˆã€‚</li><li><code>@ConditionalOnWebApplication</code> &#x2F; <code>@ConditionalOnNotWebApplication</code>: æ ¹æ®åº”ç”¨æ˜¯å¦æ˜¯ Web åº”ç”¨æ¥å†³å®šã€‚</li><li><code>@ConditionalOnResource</code>: å½“æŒ‡å®šçš„èµ„æºæ–‡ä»¶å­˜åœ¨æ—¶æ‰ç”Ÿæ•ˆã€‚</li><li><code>@ConditionalOnJava</code>: å½“è¿è¡Œåœ¨æŒ‡å®šçš„ Java ç‰ˆæœ¬ä¸Šæ—¶æ‰ç”Ÿæ•ˆã€‚</li></ul></li><li><strong>è¿‡ç¨‹ï¼š</strong> Spring Boot åœ¨å¯åŠ¨æ—¶ï¼Œä¼š<strong>æŒ‰é¡ºåºåŠ è½½</strong>æ‰€æœ‰å€™é€‰çš„è‡ªåŠ¨é…ç½®ç±»ã€‚å¯¹äºæ¯ä¸ªé…ç½®ç±»å’Œå…¶ä¸­çš„æ¯ä¸ª <code>@Bean</code> æ–¹æ³•ï¼ŒSpring Boot ä¼š<strong>è¯„ä¼°å…¶ä¸Šçš„æ¡ä»¶æ³¨è§£</strong>ã€‚åªæœ‰å½“æ‰€æœ‰æ¡ä»¶éƒ½æ»¡è¶³æ—¶ï¼Œè¿™ä¸ªé…ç½®ç±»æˆ– Bean å®šä¹‰æ‰ä¼šè¢«çœŸæ­£å¤„ç†å¹¶åŠ å…¥åˆ° Spring å®¹å™¨ä¸­ã€‚</li></ul></li><li><strong>è‡ªåŠ¨é…ç½®å…ƒæ•°æ® (<code>spring-autoconfigure-metadata.properties</code>)ï¼š</strong><ul><li>ä¸ºäº†<strong>æé«˜å¯åŠ¨æ€§èƒ½</strong>ï¼ˆé¿å…é€šè¿‡åå°„åŠ è½½å’Œè§£æå¤§é‡ä¸æ»¡è¶³æ¡ä»¶çš„é…ç½®ç±»ï¼‰ï¼ŒSpring Boot åœ¨ç¼–è¯‘æ—¶ä¼šä¸ºè‡ªåŠ¨é…ç½®æ¨¡å—ç”Ÿæˆä¸€ä¸ª <code>META-INF/spring-autoconfigure-metadata.properties</code> æ–‡ä»¶ã€‚</li><li>è¿™ä¸ªæ–‡ä»¶é¢„å…ˆå­˜å‚¨äº†æ‰€æœ‰è‡ªåŠ¨é…ç½®ç±»ä¸Šçš„<strong>æ¡ä»¶ä¿¡æ¯</strong>ï¼ˆå¦‚ <code>@ConditionalOnClass</code> è¦æ±‚çš„ç±»ï¼‰ã€‚</li><li>åœ¨å¯åŠ¨çš„æ—©æœŸé˜¶æ®µï¼Œ<code>AutoConfigurationImportSelector</code> ä¼šé¦–å…ˆè¯»å–è¿™ä¸ªå…ƒæ•°æ®æ–‡ä»¶ï¼Œ<strong>å¿«é€Ÿè¿‡æ»¤æ‰ä¸€å¤§æ‰¹æ˜æ˜¾ä¸æ»¡è¶³æ¡ä»¶</strong>ï¼ˆä¾‹å¦‚ï¼Œç±»è·¯å¾„ä¸Šæ ¹æœ¬æ²¡æœ‰æ‰€éœ€ä¾èµ–çš„ç±»ï¼‰çš„è‡ªåŠ¨é…ç½®ç±»ã€‚åªæœ‰é€šè¿‡å…ƒæ•°æ®åˆæ­¥ç­›é€‰çš„é…ç½®ç±»æ‰ä¼šè¢«çœŸæ­£åŠ è½½å’Œè§£æï¼Œå¤§å¤§å‡å°‘äº†ç±»åŠ è½½å’Œæ¡ä»¶è¯„ä¼°çš„å¼€é”€ã€‚</li></ul></li></ol><p><strong>æ€»ç»“æµç¨‹ï¼š</strong></p><ol><li>å¯åŠ¨ <code>main</code> æ–¹æ³•ï¼ŒåŠ è½½æ ‡æ³¨äº† <code>@SpringBootApplication</code> çš„ä¸»ç±»ã€‚</li><li><code>@SpringBootApplication</code> ä¸­çš„ <code>@EnableAutoConfiguration</code> æ¿€æ´»è‡ªåŠ¨è£…é…ã€‚</li><li><code>@EnableAutoConfiguration</code> é€šè¿‡ <code>@Import</code> å¼•å…¥ <code>AutoConfigurationImportSelector</code>ã€‚</li><li><code>AutoConfigurationImportSelector</code> åœ¨é€‚å½“çš„æ—¶å€™æ‰§è¡Œï¼š<ul><li>è¯»å– <code>spring-autoconfigure-metadata.properties</code> è¿›è¡Œ<strong>å¿«é€Ÿè¿‡æ»¤</strong>ã€‚</li><li>è¯»å– <code>META-INF/spring.factories</code> æˆ– <code>META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports</code> æ–‡ä»¶ï¼Œè·å–<strong>æ‰€æœ‰å€™é€‰è‡ªåŠ¨é…ç½®ç±»</strong>çš„å…¨ååˆ—è¡¨ã€‚</li><li><strong>åº”ç”¨è‡ªåŠ¨é…ç½®å…ƒæ•°æ®è¿‡æ»¤å™¨</strong>ï¼Œå‰”é™¤æ˜æ˜¾ä¸æ»¡è¶³æ¡ä»¶çš„å€™é€‰ç±»ã€‚</li></ul></li><li>éå†å‰©ä¸‹çš„å€™é€‰è‡ªåŠ¨é…ç½®ç±»ï¼š<ul><li>ä½¿ç”¨åå°„åŠ è½½ç±»ã€‚</li><li><strong>è¯¦ç»†è¯„ä¼°ç±»ä¸Šçš„ <code>@Conditional</code> åŠå…¶è¡ç”Ÿæ³¨è§£</strong>ã€‚</li><li>å¦‚æœç±»çº§åˆ«çš„æ¡ä»¶æ»¡è¶³ï¼Œåˆ™å°†è¯¥é…ç½®ç±»ä½œä¸ºä¸€ä¸ª <code>@Configuration</code> ç±»å¤„ç†ã€‚</li><li>å¤„ç†é…ç½®ç±»å†…éƒ¨çš„ <code>@Bean</code> æ–¹æ³•ï¼ŒåŒæ ·è¯„ä¼°æ–¹æ³•ä¸Šçš„æ¡ä»¶æ³¨è§£ï¼Œæ»¡è¶³æ¡ä»¶çš„æ‰æ³¨å†Œä¸º Beanã€‚</li></ul></li><li>æœ€ç»ˆï¼Œæ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è‡ªåŠ¨é…ç½®ç±»ä¸­å®šä¹‰çš„ Bean è¢«æ³¨å†Œåˆ° Spring IoC å®¹å™¨ä¸­ï¼Œåº”ç”¨å°±æ‹¥æœ‰äº†æ‰€éœ€çš„åŸºç¡€è®¾æ–½ Beanã€‚</li></ol><p><strong>å…³é”®ä¼˜åŠ¿ï¼š</strong></p><ul><li><strong>ç®€åŒ–é…ç½®ï¼š</strong> å¼€å‘è€…åªéœ€å¼•å…¥ Starter ä¾èµ–ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®å¤§é‡ Beanã€‚</li><li><strong>å¼€ç®±å³ç”¨ï¼š</strong> æä¾›åˆç†çš„é»˜è®¤é…ç½®ï¼Œæ»¡è¶³å¤§éƒ¨åˆ†åœºæ™¯ã€‚</li><li><strong>æ˜“äºå®šåˆ¶ï¼š</strong> é€šè¿‡å®šä¹‰è‡ªå·±çš„ <code>@Bean</code> (åˆ©ç”¨ <code>@ConditionalOnMissingBean</code> è¦†ç›–) æˆ–ä¿®æ”¹ <code>application.properties</code>&#x2F;<code>application.yml</code> å³å¯è½»æ¾è¦†ç›–é»˜è®¤é…ç½®ã€‚</li><li><strong>æŒ‰éœ€åŠ è½½ï¼š</strong> åŸºäºæ¡ä»¶æ³¨è§£ï¼ŒåªåŠ è½½å½“å‰åº”ç”¨å®é™…éœ€è¦çš„é…ç½®å’Œ Beanï¼Œé¿å…èµ„æºæµªè´¹ã€‚</li></ul><p><strong>ç†è§£è¦ç‚¹ï¼š</strong></p><ul><li>è‡ªåŠ¨è£…é…ä¸æ˜¯é»‘é­”æ³•ï¼Œæœ¬è´¨ä¸Šæ˜¯ Spring <code>@Configuration</code> å’Œ <code>@Bean</code> çš„<strong>æ¡ä»¶åŒ–ã€æ‰¹é‡åŒ–ä½¿ç”¨</strong>ã€‚</li><li><code>spring.factories</code> &#x2F; <code>AutoConfiguration.imports</code> æ–‡ä»¶æ˜¯<strong>è‡ªåŠ¨é…ç½®ç±»çš„æ³¨å†Œä¸­å¿ƒ</strong>ã€‚</li><li>æ¡ä»¶æ³¨è§£ (<code>@ConditionalXXX</code>) æ˜¯<strong>å†³å®šå“ªäº›é…ç½®ç”Ÿæ•ˆçš„è§„åˆ™å¼•æ“</strong>ã€‚</li><li>è‡ªåŠ¨é…ç½®å…ƒæ•°æ® (<code>spring-autoconfigure-metadata.properties</code>) æ˜¯<strong>ä¼˜åŒ–å¯åŠ¨é€Ÿåº¦çš„å…³é”®</strong>ã€‚</li></ul><h3 id="è‡ªå®šä¹‰ä¸€ä¸ªstarter"><a href="#è‡ªå®šä¹‰ä¸€ä¸ªstarter" class="headerlink" title="è‡ªå®šä¹‰ä¸€ä¸ªstarter"></a>è‡ªå®šä¹‰ä¸€ä¸ªstarter</h3><p><code>starter</code>çš„é¡¹ç›®ç»“æ„</p><img src="/post/65a5b0d7/image-20241207213730855.png" class="" title="image-20241207213730855"><p><code>starter</code>åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.tw<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>robot-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æœåŠ¡æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RobotService</span> &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">sayHello</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RobotServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">RobotService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RobotProperties robotProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sayHello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, &quot;</span> + robotProperties.getGreeting();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å±æ€§é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;robot&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RobotProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String greeting;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªåŠ¨é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;RobotServiceImpl.class, RobotProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RobotAutoConfiguration</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Import(RobotAutoConfiguration.class)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableRobot &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼•å…¥è‡ªå®šä¹‰<code>starter</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.tw<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>robot-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¼€å¯è‡ªåŠ¨é…ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableRobot</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> SpringApplication.run(ClientApplication.class, args);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">RobotService</span> <span class="variable">robotService</span> <span class="operator">=</span> context.getBean(RobotService.class);</span><br><span class="line">        System.out.println(robotService.sayHello());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸºäºSPIè‡ªåŠ¨é…ç½®</p><p>æ–¹å¼1ï¼šåˆ›å»º<code>spring.factories</code>æ–‡ä»¶</p><img src="/post/65a5b0d7/image-20241207221646340.png" class="" title="image-20241207221646340"><p>æ–¹å¼2ï¼šåˆ›å»º<code>org.springframework.boot.autoconfigure.AutoConfiguration.imports</code>æ–‡ä»¶</p><img src="/post/65a5b0d7/image-20241207221743415.png" class="" title="image-20241207221743415"><p>æ— è®ºé‡‡ç”¨ä¸Šè¿°å“ªç§æ–¹å¼ï¼Œéƒ½ä¸å†éœ€è¦<code>@EnableRobot</code>æ³¨è§£å°±å¯ä»¥å®ç°è‡ªåŠ¨é…ç½®ã€‚</p><h2 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h2><h2 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h2><h2 id="JPA"><a href="#JPA" class="headerlink" title="JPA"></a>JPA</h2><h2 id="æ—¥å¿—æ¡†æ¶"><a href="#æ—¥å¿—æ¡†æ¶" class="headerlink" title="æ—¥å¿—æ¡†æ¶"></a>æ—¥å¿—æ¡†æ¶</h2><h1 id="åˆ†å¸ƒå¼"><a href="#åˆ†å¸ƒå¼" class="headerlink" title="åˆ†å¸ƒå¼"></a>åˆ†å¸ƒå¼</h1><h2 id="åŸºæœ¬ç†è®º"><a href="#åŸºæœ¬ç†è®º" class="headerlink" title="åŸºæœ¬ç†è®º"></a>åŸºæœ¬ç†è®º</h2><h3 id="ä»€ä¹ˆæ˜¯CAP"><a href="#ä»€ä¹ˆæ˜¯CAP" class="headerlink" title="ä»€ä¹ˆæ˜¯CAP"></a>ä»€ä¹ˆæ˜¯CAP</h3><p>CAPå®šç†æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒåŸåˆ™ï¼Œç”±è®¡ç®—æœºç§‘å­¦å®¶Eric Breweråœ¨2000å¹´æå‡ºï¼Œåäº2002å¹´è¢«è¯æ˜ã€‚å®ƒæŒ‡å‡ºï¼Œåœ¨å­˜åœ¨<strong>ç½‘ç»œåˆ†åŒºï¼ˆPartition Toleranceï¼‰</strong>çš„æƒ…å†µä¸‹ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿæ— æ³•åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªç‰¹æ€§ï¼š</p><ol><li><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong><br>æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶åˆ»çœ‹åˆ°çš„æ•°æ®å®Œå…¨ç›¸åŒã€‚å†™å…¥æ“ä½œåï¼Œæ‰€æœ‰è¯»å–è¯·æ±‚éƒ½ä¼šç«‹å³è·å¾—æœ€æ–°æ•°æ®ï¼Œä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚</li><li><strong>å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰</strong><br>æ¯ä¸ªè¯·æ±‚ï¼ˆæ— è®ºè¯»å†™ï¼‰éƒ½èƒ½åœ¨åˆç†æ—¶é—´å†…è·å¾—éé”™è¯¯å“åº”ï¼Œä½†ä¸ä¿è¯è¿”å›çš„æ•°æ®æ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚å³ä½¿éƒ¨åˆ†èŠ‚ç‚¹æ•…éšœï¼Œç³»ç»Ÿä»èƒ½æ­£å¸¸å“åº”ã€‚</li><li><strong>åˆ†åŒºå®¹å¿æ€§ï¼ˆPartition Toleranceï¼‰</strong><br>ç³»ç»Ÿåœ¨ç½‘ç»œåˆ†åŒºï¼ˆèŠ‚ç‚¹é—´é€šä¿¡ä¸­æ–­ï¼Œå½¢æˆå­¤å²›ï¼‰æ—¶ä»èƒ½ç»§ç»­è¿è¡Œã€‚ç½‘ç»œåˆ†åŒºæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®¢è§‚ç°å®ï¼Œå› æ­¤è¿™ä¸€ç‰¹æ€§é€šå¸¸è¢«è§†ä¸ºå¿…é¡»æ”¯æŒçš„åŸºç¡€ã€‚</li></ol><img src="/post/65a5b0d7/image-20250505093121422.png" class="" title="image-20250505093121422"><h3 id="ä»€ä¹ˆæ˜¯BASE"><a href="#ä»€ä¹ˆæ˜¯BASE" class="headerlink" title="ä»€ä¹ˆæ˜¯BASE"></a>ä»€ä¹ˆæ˜¯BASE</h3><p>BASE æ˜¯åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰ã€è½¯çŠ¶æ€ï¼ˆSoft Stateï¼‰å’Œæœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventually Consistentï¼‰ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™ã€‚</p><p>BASE ç†è®ºæ˜¯å¯¹ CAP ä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æœï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªåº”ç”¨éƒ½å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚</p><p><strong>åŸºæœ¬å¯ç”¨</strong></p><p>æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œä¿è¯æ ¸å¿ƒå¯ç”¨ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ã€‚</p><p>ä¾‹å¦‚ï¼Œç”µå•†åœ¨åšä¿ƒé”€æ—¶ï¼Œä¸ºäº†ä¿è¯è´­ç‰©ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œéƒ¨åˆ†æ¶ˆè´¹è€…å¯èƒ½ä¼šè¢«å¼•å¯¼åˆ°ä¸€ä¸ªé™çº§çš„é¡µé¢ã€‚</p><p><strong>è½¯çŠ¶æ€</strong></p><p>æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡ŒåŒæ­¥çš„è¿‡ç¨‹å­˜åœ¨æ—¶å»¶ã€‚</p><p><strong>æœ€ç»ˆä¸€è‡´æ€§</strong></p><p>æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½è¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚</p><p>ACID è¦æ±‚å¼ºä¸€è‡´æ€§ï¼Œé€šå¸¸è¿ç”¨åœ¨ä¼ ç»Ÿçš„æ•°æ®åº“ç³»ç»Ÿä¸Šã€‚è€Œ BASE è¦æ±‚æœ€ç»ˆä¸€è‡´æ€§ï¼Œé€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è¾¾åˆ°å¯ç”¨æ€§ï¼Œé€šå¸¸è¿ç”¨åœ¨å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ã€‚</p><p>åœ¨å®é™…çš„åˆ†å¸ƒå¼åœºæ™¯ä¸­ï¼Œä¸åŒä¸šåŠ¡å•å…ƒå’Œç»„ä»¶å¯¹ä¸€è‡´æ€§çš„è¦æ±‚æ˜¯ä¸åŒçš„ï¼Œå› æ­¤ ACID å’Œ BASE å¾€å¾€ä¼šç»“åˆåœ¨ä¸€èµ·ä½¿ç”¨ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡"><a href="#ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡" class="headerlink" title="ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡"></a>ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡</h3><p>åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯æŒ‡<strong>æ¶‰åŠå¤šä¸ªç‹¬ç«‹æœåŠ¡æˆ–æ•°æ®åº“èµ„æºçš„ä¸€ä¸ªæ“ä½œå•å…ƒ</strong>ï¼Œè¿™äº›æœåŠ¡æˆ–èµ„æºé€šå¸¸åˆ†å¸ƒåœ¨ç½‘ç»œçš„ä¸åŒèŠ‚ç‚¹ä¸Šã€‚å…¶æ ¸å¿ƒç›®æ ‡æ˜¯ä¿è¯æ•´ä¸ªæ“ä½œè¦ä¹ˆåœ¨æ‰€æœ‰å‚ä¸çš„èŠ‚ç‚¹ä¸Š<strong>å…¨éƒ¨æˆåŠŸæäº¤</strong>ï¼Œè¦ä¹ˆåœ¨å‘ç”Ÿä»»ä½•å¤±è´¥æ—¶<strong>å…¨éƒ¨å›æ»š</strong>ï¼Œä»¥ç»´æŠ¤æ•°æ®çš„<strong>ACIDç‰¹æ€§</strong>ï¼ˆåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ï¼‰ï¼Œå°¤å…¶æ˜¯åœ¨è·¨ç³»ç»Ÿè¾¹ç•Œå’Œç½‘ç»œä¸å¯é çš„ç¯å¢ƒä¸‹ã€‚</p><p><strong>ä¸ºä»€ä¹ˆéœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ</strong></p><p>éšç€ç³»ç»Ÿæ¶æ„ä»å•ä½“åº”ç”¨å‘å¾®æœåŠ¡ã€åˆ†å¸ƒå¼æ•°æ®åº“æ¼”è¿›ï¼š</p><ol><li><strong>æ•°æ®&#x2F;æœåŠ¡æ‹†åˆ†ï¼š</strong> ä¸šåŠ¡é€»è¾‘æ¶‰åŠå¤šä¸ªç‹¬ç«‹çš„æ•°æ®åº“æˆ–æœåŠ¡ã€‚</li><li><strong>è·¨ç³»ç»Ÿè°ƒç”¨ï¼š</strong> å®Œæˆä¸€ä¸ªä¸šåŠ¡ç›®æ ‡éœ€è¦è°ƒç”¨å¤šä¸ªä¸åŒçš„æœåŠ¡ã€‚</li><li><strong>åŸå­æ€§æŒ‘æˆ˜ï¼š</strong> åœ¨å•ä¸ªæ•°æ®åº“å†…ï¼Œäº‹åŠ¡ç”±æ•°æ®åº“å¼•æ“ä¿è¯ã€‚ä½†å½“æ“ä½œè·¨è¶Šå¤šä¸ªç‹¬ç«‹èµ„æºï¼ˆæœåŠ¡&#x2F;æ•°æ®åº“ï¼‰æ—¶ï¼Œéœ€è¦é¢å¤–çš„æœºåˆ¶æ¥åè°ƒå®ƒä»¬ï¼Œç¡®ä¿æ•´ä½“åŸå­æ€§ã€‚</li></ol><p><strong>å®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸»è¦æ¨¡å¼ä¸æŠ€æœ¯ï¼š</strong></p><p>æ²¡æœ‰ä¸€ç§â€œé“¶å¼¹â€æ–¹æ¡ˆé€‚ç”¨äºæ‰€æœ‰åœºæ™¯ï¼Œé€‰æ‹©å–å†³äºä¸šåŠ¡éœ€æ±‚ï¼ˆå¦‚å¯¹å¼ºä¸€è‡´æ€§çš„è¦æ±‚ã€æ€§èƒ½å®¹å¿åº¦ã€å¤æ‚åº¦ï¼‰å’Œç³»ç»Ÿæ¶æ„ã€‚ä¸»è¦æ¨¡å¼åŒ…æ‹¬ï¼š</p><ol><li><strong>ä¸¤é˜¶æ®µæäº¤ï¼š</strong><ul><li><strong>åŸç†ï¼š</strong> å¼•å…¥ä¸€ä¸ªç‹¬ç«‹çš„<strong>åè°ƒè€…</strong>æ¥ç®¡ç†äº‹åŠ¡çš„æäº¤è¿‡ç¨‹ï¼Œåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š<ul><li><strong>å‡†å¤‡é˜¶æ®µï¼š</strong> åè°ƒè€…è¯¢é—®æ‰€æœ‰å‚ä¸è€…æ˜¯å¦å¯ä»¥æäº¤äº‹åŠ¡ã€‚å‚ä¸è€…æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼ˆé”å®šèµ„æºã€å†™Redo&#x2F;Undoæ—¥å¿—ï¼‰ï¼Œä½†<strong>ä¸å®é™…æäº¤</strong>ï¼Œç„¶åå‘åè°ƒè€…æŠ•ç¥¨ï¼ˆâ€œåŒæ„â€æˆ–â€œä¸­æ­¢â€ï¼‰ã€‚</li><li><strong>æäº¤&#x2F;å›æ»šé˜¶æ®µï¼š</strong><ul><li>å¦‚æœæ‰€æœ‰å‚ä¸è€…éƒ½æŠ•ç¥¨â€œåŒæ„â€ï¼Œåè°ƒè€…å‘é€<strong>æäº¤</strong>æŒ‡ä»¤ç»™æ‰€æœ‰å‚ä¸è€…ã€‚å‚ä¸è€…æ”¶åˆ°å<strong>æ­£å¼æäº¤</strong>äº‹åŠ¡å¹¶é‡Šæ”¾èµ„æºï¼Œç„¶åå‘åè°ƒè€…å‘é€â€œå®Œæˆâ€ç¡®è®¤ã€‚</li><li>å¦‚æœ<strong>ä»»ä½•ä¸€ä¸ª</strong>å‚ä¸è€…æŠ•ç¥¨â€œä¸­æ­¢â€ï¼Œæˆ–è€…åè°ƒè€…åœ¨ç­‰å¾…æŠ•ç¥¨æ—¶è¶…æ—¶ï¼Œåè°ƒè€…å‘é€<strong>å›æ»š</strong>æŒ‡ä»¤ç»™æ‰€æœ‰å‚ä¸è€…ã€‚å‚ä¸è€…æ”¶åˆ°ååˆ©ç”¨Undoæ—¥å¿—<strong>å›æ»š</strong>äº‹åŠ¡å¹¶é‡Šæ”¾èµ„æºã€‚</li></ul></li></ul></li><li><strong>ä¼˜ç‚¹ï¼š</strong> ç†è®ºä¸Šæä¾›å¼ºä¸€è‡´æ€§ï¼ˆACIDï¼‰ï¼Œå®ç°ç›¸å¯¹æ ‡å‡†ï¼ˆå¦‚XAåè®®ï¼‰ã€‚</li><li><strong>ç¼ºç‚¹ï¼š</strong><ul><li><strong>æ€§èƒ½ç“¶é¢ˆï¼š</strong> åŒæ­¥é˜»å¡ï¼ˆå‚ä¸è€…åœ¨å‡†å¤‡é˜¶æ®µé”å®šèµ„æºç›´åˆ°æ”¶åˆ°ç¬¬äºŒé˜¶æ®µæŒ‡ä»¤ï¼‰ã€å¤šè½®ç½‘ç»œé€šä¿¡ã€‚</li><li><strong>åè°ƒè€…å•ç‚¹æ•…éšœï¼š</strong> å¦‚æœåè°ƒè€…å´©æºƒï¼Œå‚ä¸è€…å¯èƒ½ä¸€ç›´æŒæœ‰é”ï¼Œé˜»å¡å…¶ä»–æ“ä½œã€‚</li><li><strong>æ•°æ®ä¸ä¸€è‡´é£é™©ï¼ˆè„‘è£‚ï¼‰ï¼š</strong> åœ¨ç¬¬äºŒé˜¶æ®µï¼Œå¦‚æœåè°ƒè€…å‘å‡ºæäº¤æŒ‡ä»¤åéƒ¨åˆ†å‚ä¸è€…å´©æºƒæˆ–ç½‘ç»œä¸­æ–­ï¼Œå¯èƒ½å¯¼è‡´éƒ¨åˆ†æäº¤ã€éƒ¨åˆ†æœªæäº¤çš„æ•°æ®ä¸ä¸€è‡´çŠ¶æ€ï¼ˆéœ€è¦äººå·¥å¹²é¢„ï¼‰ã€‚</li></ul></li><li><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> å¯¹å¼ºä¸€è‡´æ€§è¦æ±‚æé«˜ä¸”æ€§èƒ½è¦æ±‚ä¸é«˜ã€å‚ä¸æ–¹è¾ƒå°‘çš„å†…éƒ¨ç³»ç»Ÿï¼ˆå¦‚ä¼ ç»Ÿé“¶è¡Œæ ¸å¿ƒç³»ç»Ÿï¼‰ã€‚å¸¸ç”¨åè®®ï¼š<strong>XA</strong> (ç”±æ•°æ®åº“&#x2F;ä¸­é—´ä»¶å®ç°ï¼Œå¦‚Java JTA)ã€‚</li></ul></li><li><strong>è¡¥å¿äº‹åŠ¡ï¼š</strong><ul><li><strong>åŸç†ï¼š</strong> æ”¾å¼ƒå…¨å±€é”å’Œå¼ºä¸€è‡´æ€§ï¼Œé‡‡ç”¨â€œäº‹åè¡¥å¿â€çš„æ€è·¯å®ç°æœ€ç»ˆä¸€è‡´æ€§ã€‚æ ¸å¿ƒæ€æƒ³æ˜¯ä¸ºæ¯ä¸ªæ­£å‘ä¸šåŠ¡æ“ä½œå®šä¹‰ä¸€ä¸ªå¯¹åº”çš„ã€å¯é€†çš„<strong>è¡¥å¿æ“ä½œ</strong>ã€‚<ul><li>é¡ºåºæ‰§è¡Œå„ä¸ªæœåŠ¡è°ƒç”¨ï¼ˆT1, T2, T3â€¦ï¼‰ã€‚</li><li>å¦‚æœæŸä¸ªæ­¥éª¤ï¼ˆå¦‚Tnï¼‰å¤±è´¥ï¼Œåˆ™<strong>æŒ‰ç›¸åé¡ºåº</strong>æ‰§è¡Œå‰é¢æ‰€æœ‰å·²æˆåŠŸæ­¥éª¤çš„è¡¥å¿æ“ä½œï¼ˆCn-1, â€¦, C1ï¼‰ã€‚</li><li>è¡¥å¿æ“ä½œéœ€è¦æ˜¯å¹‚ç­‰çš„ï¼ˆå¯é‡å¤æ‰§è¡Œæ— å‰¯ä½œç”¨ï¼‰ã€‚</li></ul></li><li><strong>å¸¸è§å®ç°ï¼š</strong><ul><li><strong>TCCï¼š</strong> æœ€å…¸å‹çš„è¡¥å¿æ¨¡å¼ã€‚æ¯ä¸ªä¸šåŠ¡æœåŠ¡éœ€è¦å®ç°ä¸‰ä¸ªæ¥å£ï¼š<ul><li><strong>Tryï¼š</strong> é¢„ç•™ä¸šåŠ¡èµ„æºï¼ˆå†»ç»“åº“å­˜ã€æ‰£å‡ä¿¡ç”¨é¢åº¦ç­‰ï¼‰ã€‚å®Œæˆæ‰€æœ‰æ£€æŸ¥ï¼Œä¸ºæœ€ç»ˆæ“ä½œåšå‡†å¤‡ã€‚</li><li><strong>Confirmï¼š</strong> çœŸæ­£æäº¤ä¸šåŠ¡ï¼ˆç¡®è®¤æ‰£æ¬¾ã€ç¡®è®¤åº“å­˜ï¼‰ã€‚TryæˆåŠŸæ‰ä¼šæ‰§è¡Œï¼Œé€šå¸¸å¿…é¡»æˆåŠŸã€‚</li><li><strong>Cancelï¼š</strong> è¡¥å¿æ“ä½œï¼ˆé‡Šæ”¾å†»ç»“çš„åº“å­˜ã€æ¢å¤ä¿¡ç”¨é¢åº¦ï¼‰ã€‚TryæˆåŠŸåï¼Œå¦‚æœæ•´ä½“äº‹åŠ¡éœ€è¦å›æ»šï¼Œåˆ™æ‰§è¡ŒCancelã€‚</li></ul></li><li><strong>Sagaï¼š</strong><ul><li><strong>åè°ƒæ–¹å¼ï¼š</strong><ul><li><em>ç¼–æ’ï¼š</em> æ²¡æœ‰ä¸­å¿ƒåè°ƒè€…ï¼Œæ¯ä¸ªæœåŠ¡æ‰§è¡Œåå‘å¸ƒäº‹ä»¶ï¼Œä¸‹ä¸€ä¸ªæœåŠ¡ç›‘å¬äº‹ä»¶å¹¶æ‰§è¡Œè‡ªå·±çš„æ“ä½œæˆ–è¡¥å¿æ“ä½œã€‚</li><li><em>ç¼–æ’ï¼š</em> ä¸€ä¸ªä¸­å¿ƒåè°ƒå™¨è´Ÿè´£æŒ‰é¡ºåºè°ƒç”¨æœåŠ¡ï¼Œå¹¶åœ¨å¤±è´¥æ—¶è§¦å‘è¡¥å¿æµç¨‹ã€‚</li></ul></li><li><strong>æ‰§è¡Œæ¨¡å¼ï¼š</strong><ul><li><em>å‘å‰æ¢å¤ï¼š</em> æŸä¸ªæ­¥éª¤å¤±è´¥ï¼Œåˆ™é‡è¯•è¯¥æ­¥éª¤ï¼ˆé€‚ç”¨äºå¯é‡è¯•çš„ä¸´æ—¶é”™è¯¯ï¼‰ã€‚</li><li><em>å‘åæ¢å¤ï¼š</em> æŸä¸ªæ­¥éª¤å¤±è´¥ï¼Œåˆ™è§¦å‘è¡¥å¿æµç¨‹ã€‚</li></ul></li></ul></li></ul></li><li><strong>ä¼˜ç‚¹ï¼š</strong><ul><li>é¿å…äº†å…¨å±€é”ï¼Œæ€§èƒ½è¾ƒé«˜ï¼Œååé‡å¥½ã€‚</li><li>æœåŠ¡è®¾è®¡æ›´æ¾è€¦åˆã€‚</li><li>é€‚ç”¨äºé•¿äº‹åŠ¡ã€‚</li></ul></li><li><strong>ç¼ºç‚¹ï¼š</strong><ul><li>å®ç°å¤æ‚ï¼šæ¯ä¸ªæœåŠ¡éƒ½éœ€è¦è®¾è®¡Try&#x2F;Confirm&#x2F;Cancelæ¥å£ï¼ˆTCCï¼‰æˆ–è¡¥å¿é€»è¾‘ï¼ˆSagaï¼‰ã€‚</li><li>æœ€ç»ˆä¸€è‡´æ€§ï¼šå­˜åœ¨ä¸­é—´çŠ¶æ€ï¼ˆå¦‚åº“å­˜å†»ç»“ä½†æœªæ‰£å‡ï¼‰ï¼Œä¸šåŠ¡éœ€è¦å®¹å¿çŸ­æš‚ä¸ä¸€è‡´ã€‚</li><li>è¡¥å¿æ“ä½œçš„è®¾è®¡å’Œå®ç°æŒ‘æˆ˜ï¼šéœ€è¦ä¿è¯å¹‚ç­‰æ€§ã€å¯é‡è¯•ï¼›è¡¥å¿å¯èƒ½å¤±è´¥ï¼Œéœ€è¦é‡è¯•ç­–ç•¥ã€‚</li></ul></li><li><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> é«˜å¹¶å‘ã€æ€§èƒ½è¦æ±‚é«˜ã€ä¸šåŠ¡ä¸Šå¯ä»¥æ¥å—çŸ­æš‚æœ€ç»ˆä¸€è‡´æ€§çš„åœºæ™¯ï¼ˆç”µå•†ä¸‹å•ã€æ”¯ä»˜ã€è®¢å•ç®¡ç†ç­‰ï¼‰ã€‚TCCé€‚ç”¨äºé‡‘èç­‰å¯¹éš”ç¦»æ€§è¦æ±‚ç¨é«˜çš„åœºæ™¯ï¼ŒSagaæ›´é€šç”¨ã€‚</li></ul></li><li><strong>åŸºäºå¯é æ¶ˆæ¯çš„æœ€ç»ˆä¸€è‡´æ€§ï¼š</strong><ul><li><strong>åŸç†ï¼š</strong> åˆ©ç”¨<strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>çš„å¯é æŠ•é€’ç‰¹æ€§æ¥è§£è€¦æœåŠ¡å’Œä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚<ul><li>äº‹åŠ¡å‘èµ·æ–¹ï¼ˆæœåŠ¡Aï¼‰åœ¨æœ¬åœ°äº‹åŠ¡ä¸­æ‰§è¡Œæ“ä½œï¼Œå¹¶<strong>åŒæ—¶</strong>å‘æ¶ˆæ¯é˜Ÿåˆ—å‘é€ä¸€æ¡â€œå¾…ç¡®è®¤â€çš„æ¶ˆæ¯ï¼ˆè®°å½•æ“ä½œçŠ¶æ€ï¼‰ã€‚è¿™éœ€è¦æœ¬åœ°æ•°æ®åº“å’Œæ¶ˆæ¯é˜Ÿåˆ—æ”¯æŒ<strong>æœ¬åœ°æ¶ˆæ¯è¡¨</strong>æˆ–<strong>äº‹åŠ¡æ€§å‘ä»¶ç®±</strong>æ¨¡å¼ã€‚</li><li>æœ¬åœ°äº‹åŠ¡æäº¤æˆåŠŸåï¼Œç”±ä¸€ä¸ªç‹¬ç«‹çš„<strong>æ¶ˆæ¯è½¬å‘å™¨</strong>å°†â€œå¾…ç¡®è®¤â€æ¶ˆæ¯å¯é åœ°å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ã€‚</li><li>æ¶ˆæ¯é˜Ÿåˆ—å°†æ¶ˆæ¯æŠ•é€’ç»™æ¶ˆè´¹è€…ï¼ˆæœåŠ¡Bï¼‰ã€‚</li><li>æœåŠ¡Bæ‰§è¡Œæœ¬åœ°æ“ä½œã€‚</li><li>æœåŠ¡Bæ“ä½œæˆåŠŸåï¼Œå‘æ¶ˆæ¯é˜Ÿåˆ—å‘é€ACKç¡®è®¤æ¶ˆè´¹æˆåŠŸã€‚å¦‚æœå¤±è´¥æˆ–è¶…æ—¶ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ä¼šé‡æŠ•ã€‚</li><li>ï¼ˆå¯é€‰ï¼‰æœåŠ¡Bæ‰§è¡ŒæˆåŠŸåï¼Œå¯ä»¥å†å‘é€æ¶ˆæ¯é©±åŠ¨åç»­æ“ä½œã€‚</li></ul></li><li><strong>å…³é”®æœºåˆ¶ï¼š</strong><ul><li><strong>æœ¬åœ°æ¶ˆæ¯è¡¨&#x2F;äº‹åŠ¡å‘ä»¶ç®±ï¼š</strong> ä¿è¯æœåŠ¡Aæœ¬åœ°äº‹åŠ¡æ‰§è¡Œå’Œæ¶ˆæ¯è®°å½•å­˜å‚¨çš„åŸå­æ€§ã€‚</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—çš„æŒä¹…åŒ–ä¸é‡è¯•ï¼š</strong> ä¿è¯æ¶ˆæ¯è‡³å°‘è¢«æŠ•é€’ä¸€æ¬¡ã€‚</li><li><strong>æ¶ˆè´¹è€…å¹‚ç­‰æ€§ï¼š</strong> æœåŠ¡Bçš„æ“ä½œå¿…é¡»æ˜¯å¹‚ç­‰çš„ï¼Œä»¥åº”å¯¹æ¶ˆæ¯å¯èƒ½é‡å¤æŠ•é€’çš„æƒ…å†µã€‚</li></ul></li><li><strong>ä¼˜ç‚¹ï¼š</strong><ul><li>ç³»ç»Ÿè§£è€¦ï¼Œå®¹é”™æ€§å¥½ã€‚</li><li>æ€§èƒ½è¾ƒå¥½ã€‚</li><li>å®ç°ç›¸å¯¹ç®€å•ï¼ˆåˆ©ç”¨æˆç†Ÿçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼‰ã€‚</li></ul></li><li><strong>ç¼ºç‚¹ï¼š</strong><ul><li><strong>æœ€ç»ˆä¸€è‡´æ€§ï¼š</strong> å­˜åœ¨å»¶è¿Ÿï¼ŒAæˆåŠŸåˆ°BæˆåŠŸä¹‹é—´æ•°æ®ä¸ä¸€è‡´ã€‚</li><li><strong>æ¶ˆæ¯ç§¯å‹é£é™©ï¼š</strong> å¦‚æœBå¤„ç†èƒ½åŠ›ä¸è¶³ã€‚</li><li><strong>ä¾èµ–æ¶ˆæ¯é˜Ÿåˆ—çš„å¯é æ€§ã€‚</strong></li><li><strong>è¦æ±‚æ¶ˆè´¹è€…å¹‚ç­‰ã€‚</strong></li></ul></li><li><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> å¼‚æ­¥å¤„ç†ã€äº‹ä»¶é©±åŠ¨æ¶æ„ã€å¯¹å®æ—¶ä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯ï¼ˆå¦‚ç”¨æˆ·æ³¨å†Œåå‘é€æ¬¢è¿é‚®ä»¶ã€ç§¯åˆ†å¢å‡ã€çŠ¶æ€æ›´æ–°é€šçŸ¥ç­‰ï¼‰ã€‚</li></ul></li></ol><p><strong>å¦‚ä½•é€‰æ‹©ï¼Ÿ</strong></p><ul><li><strong>å¼ºä¸€è‡´æ€§è¦æ±‚æé«˜ï¼Œæ€§èƒ½è¦æ±‚ä¸é«˜ï¼Œå‚ä¸æ–¹å°‘ä¸”å¯æ§ï¼š</strong> è€ƒè™‘ <strong>2PC&#x2F;XA</strong> (ä½†è¦éå¸¸æ¸…æ¥šå…¶ä»£ä»·å’Œé£é™©)ã€‚</li><li><strong>é«˜å¹¶å‘ã€æ€§èƒ½è¦æ±‚é«˜ã€å¯æ¥å—æœ€ç»ˆä¸€è‡´æ€§ã€ä¸šåŠ¡é€»è¾‘å¯è¡¥å¿ï¼š</strong> <strong>TCC</strong> æˆ– <strong>Saga</strong> æ˜¯ä¸»æµé€‰æ‹©ã€‚TCCéš”ç¦»æ€§æ›´å¥½ä½†å®ç°æ›´é‡ï¼ŒSagaæ›´çµæ´»ã€‚</li><li><strong>å¼‚æ­¥è§£è€¦ã€å¯¹å»¶è¿Ÿå®¹å¿åº¦é«˜ã€éœ€è¦é«˜å¯ç”¨ï¼š</strong> <strong>åŸºäºå¯é æ¶ˆæ¯çš„æœ€ç»ˆä¸€è‡´æ€§</strong> æ˜¯æœ€å¸¸ç”¨ã€æœ€æ¨èçš„æ–¹å¼ä¹‹ä¸€ï¼Œå®ç°ç›¸å¯¹ç®€å•å¯é ã€‚</li><li><strong>é•¿ä¸šåŠ¡æµç¨‹ã€äº‹ä»¶é©±åŠ¨ï¼š</strong> <strong>Saga</strong> (å°¤å…¶æ˜¯Choreographyæ¨¡å¼) æˆ– <strong>åŸºäºäº‹ä»¶+å¯é æ¶ˆæ¯</strong>ã€‚</li></ul><p><strong>æ€»ç»“ï¼š</strong></p><p>åˆ†å¸ƒå¼äº‹åŠ¡çš„æ ¸å¿ƒæŒ‘æˆ˜æ˜¯åœ¨ç½‘ç»œåˆ†åŒºå’ŒèŠ‚ç‚¹æ•…éšœçš„æƒ…å†µä¸‹ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚æ²¡æœ‰å®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼Œéƒ½æ˜¯åœ¨<strong>ä¸€è‡´æ€§(C)ã€å¯ç”¨æ€§(A)ã€åˆ†åŒºå®¹å¿æ€§(P)<strong>ï¼ˆCAPå®šç†ï¼‰å’Œ</strong>æ€§èƒ½ã€å¤æ‚åº¦</strong>ä¹‹é—´è¿›è¡Œæƒè¡¡ã€‚ç°ä»£åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ä¸­ï¼Œ<strong>åŸºäºå¯é æ¶ˆæ¯çš„æœ€ç»ˆä¸€è‡´æ€§</strong>å’Œ<strong>è¡¥å¿äº‹åŠ¡(TCC&#x2F;Saga)</strong> å› å…¶æ›´å¥½çš„æ‰©å±•æ€§å’Œå¯ç”¨æ€§ï¼Œæ¯”ä¼ ç»Ÿçš„2PCä½¿ç”¨å¾—æ›´å¹¿æ³›ã€‚ç†è§£ä¸šåŠ¡éœ€æ±‚ï¼ˆå¯¹ä¸€è‡´æ€§å’Œå»¶è¿Ÿçš„å®¹å¿åº¦ï¼‰æ˜¯é€‰æ‹©åˆé€‚æ–¹æ¡ˆçš„å…³é”®ã€‚</p><ol><li>åˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ¡ˆï¼ˆé›ªèŠ±ç®—æ³•ä¼˜åŒ–ï¼‰</li><li>ä¸€è‡´æ€§Hashç®—æ³•è™šæ‹ŸèŠ‚ç‚¹è®¾è®¡</li><li>åˆ†å¸ƒå¼é”çš„ä¸‰ç§å®ç°æ–¹å¼å¯¹æ¯”</li><li>åˆ†å¸ƒå¼Sessionè§£å†³æ–¹æ¡ˆ</li><li>å¦‚ä½•å®ç°æœ€ç»ˆä¸€è‡´æ€§ï¼ˆæ¶ˆæ¯è¡¨+é‡è¯•ï¼‰</li><li>åˆ†åº“åˆ†è¡¨ååˆ†é¡µæŸ¥è¯¢æ–¹æ¡ˆ</li><li>åˆ†å¸ƒå¼äº‹åŠ¡æœ€å¤§åŠªåŠ›é€šçŸ¥å‹å®ç°</li><li>æ•°æ®åŒæ­¥æ–¹æ¡ˆï¼ˆcanal+MQï¼‰</li><li>é«˜å¹¶å‘ä¸‹å•ç³»ç»Ÿè®¾è®¡ï¼ˆåº“å­˜æ‰£å‡ï¼‰</li><li>åˆ†å¸ƒå¼ç¼“å­˜æ›´æ–°ç­–ç•¥ï¼ˆCache Asideï¼‰</li><li>åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶é’ŸåŒæ­¥é—®é¢˜</li><li>è„‘è£‚é—®é¢˜è§£å†³æ–¹æ¡ˆ</li></ol><h2 id="ä¸€è‡´æ€§åè®®"><a href="#ä¸€è‡´æ€§åè®®" class="headerlink" title="ä¸€è‡´æ€§åè®®"></a>ä¸€è‡´æ€§åè®®</h2><h3 id="Paxos"><a href="#Paxos" class="headerlink" title="Paxos"></a>Paxos</h3><h3 id="Raft"><a href="#Raft" class="headerlink" title="Raft"></a>Raft</h3><h2 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h2><h2 id="åˆ†å¸ƒå¼IDç”Ÿæˆ"><a href="#åˆ†å¸ƒå¼IDç”Ÿæˆ" class="headerlink" title="åˆ†å¸ƒå¼IDç”Ÿæˆ"></a>åˆ†å¸ƒå¼IDç”Ÿæˆ</h2><h1 id="ç³»ç»Ÿè®¾è®¡"><a href="#ç³»ç»Ÿè®¾è®¡" class="headerlink" title="ç³»ç»Ÿè®¾è®¡"></a>ç³»ç»Ÿè®¾è®¡</h1><h2 id="DDD"><a href="#DDD" class="headerlink" title="DDD"></a>DDD</h2><p>é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ–¹æ³•ï¼Œé€šè¿‡å°†è½¯ä»¶ç³»ç»Ÿçš„è®¾è®¡ä¸å®é™…ä¸šåŠ¡é¢†åŸŸè¿›è¡Œç´§å¯†å…³è”ï¼Œä»è€Œä½¿è½¯ä»¶ç³»ç»Ÿæ›´å¥½åœ°æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚å…¶æ ¸å¿ƒæ¦‚å¿µåŒ…æ‹¬ï¼š</p><ul><li>é¢†åŸŸæ¨¡å‹ï¼ˆDomain Modelï¼‰ï¼šå¯¹ä¸šåŠ¡é¢†åŸŸä¸­çš„å®ä½“ã€å€¼å¯¹è±¡ã€èšåˆç­‰æ¦‚å¿µçš„æŠ½è±¡å’Œå»ºæ¨¡ï¼Œç”¨äºè¡¨ç¤ºä¸šåŠ¡é¢†åŸŸçš„æ ¸å¿ƒæ¦‚å¿µå’Œè§„åˆ™ã€‚</li><li>èšåˆï¼ˆAggregateï¼‰ï¼šä¸€ç»„ç›¸å…³çš„é¢†åŸŸå¯¹è±¡çš„é›†åˆï¼Œä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡Œç®¡ç†å’Œæ“ä½œï¼Œä¿æŒä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚</li><li>é¢†åŸŸäº‹ä»¶ï¼ˆDomain Eventï¼‰ï¼šè¡¨ç¤ºé¢†åŸŸä¸­å‘ç”Ÿçš„é‡è¦äº‹ä»¶ï¼Œå¯ä»¥è¢«å…¶ä»–éƒ¨åˆ†ç›‘å¬å’Œå¤„ç†ï¼Œç”¨äºè§£è€¦å’Œå¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚</li><li>é¢†åŸŸæœåŠ¡ï¼ˆDomain Serviceï¼‰ï¼šå¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œä½†ä¸æ‹¥æœ‰çŠ¶æ€çš„æœåŠ¡ï¼Œé€šå¸¸ç”¨äºå®Œæˆå¤æ‚çš„ä¸šåŠ¡æ“ä½œã€‚</li><li>é™ç•Œä¸Šä¸‹æ–‡ï¼ˆBounded Contextï¼‰ï¼šè¡¨ç¤ºä¸€ä¸ªè¾¹ç•Œå†…çš„ä¸šåŠ¡é¢†åŸŸï¼Œç”¨äºåˆ’åˆ†å¤æ‚ç³»ç»Ÿçš„ä¸åŒéƒ¨åˆ†ï¼Œé¿å…æ··æ·†å’Œè€¦åˆã€‚</li></ul><span id="more"></span><h3 id="ä»€ä¹ˆæ˜¯èšåˆ"><a href="#ä»€ä¹ˆæ˜¯èšåˆ" class="headerlink" title="ä»€ä¹ˆæ˜¯èšåˆ"></a>ä»€ä¹ˆæ˜¯èšåˆ</h3><p>èšåˆæ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œç”¨äºç®¡ç†å’Œæ“ä½œä¸€ç»„ç›¸å…³çš„é¢†åŸŸå¯¹è±¡ï¼Œä¿æŒä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚èšåˆæœ‰ä»¥ä¸‹å‡ ä¸ªä½œç”¨å’Œè®¾è®¡åŸåˆ™ï¼š</p><ul><li>äº‹åŠ¡è¾¹ç•Œï¼šèšåˆæ˜¯ä¸€ä¸ªäº‹åŠ¡è¾¹ç•Œï¼Œè¡¨ç¤ºä¸€ç»„å¯¹è±¡åœ¨ä¸šåŠ¡æ“ä½œä¸­åº”è¯¥ä¿æŒä¸€è‡´æ€§ã€‚æ‰€æœ‰çš„å˜æ›´æ“ä½œéƒ½åº”è¯¥åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­è¿›è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä»è€Œä¿æŒèšåˆå†…çš„æ•°æ®ä¸€è‡´æ€§ã€‚</li><li>å°è£…æ€§ï¼šèšåˆåº”è¯¥å¯¹å¤–éƒ¨éšè—å…¶å†…éƒ¨çš„çŠ¶æ€å’Œå®ç°ç»†èŠ‚ï¼Œåªæš´éœ²å¿…è¦çš„æ¥å£å’Œæ–¹æ³•ï¼Œé™åˆ¶å¤–éƒ¨ç›´æ¥è®¿é—®å†…éƒ¨çŠ¶æ€ï¼Œä»è€Œä¿æŠ¤èšåˆçš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚</li><li>è¾¹ç•Œæ¸…æ™°ï¼šèšåˆåº”è¯¥åœ¨ä¸šåŠ¡ä¸Šæœ‰æ˜ç¡®å®šä¹‰çš„è¾¹ç•Œï¼Œç”¨äºåˆ’åˆ†å¤æ‚ç³»ç»Ÿçš„ä¸åŒéƒ¨åˆ†ï¼Œé¿å…æ··æ·†å’Œè€¦åˆã€‚</li><li>å•ä¸€è´£ä»»ï¼šèšåˆåº”è¯¥åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„ä¸šåŠ¡åŠŸèƒ½ï¼Œä¸åº”è¯¥åŒ…å«å¤šä¸ªä¸ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ï¼Œä»è€Œä¿æŒèšåˆçš„ç®€å•æ€§å’Œé«˜å†…èšæ€§ã€‚</li></ul><h3 id="ä»€ä¹ˆæ˜¯èšåˆæ ¹"><a href="#ä»€ä¹ˆæ˜¯èšåˆæ ¹" class="headerlink" title="ä»€ä¹ˆæ˜¯èšåˆæ ¹"></a>ä»€ä¹ˆæ˜¯èšåˆæ ¹</h3><p>èšåˆæ ¹ï¼ˆAggregate Rootï¼‰æ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œç”¨äºè¡¨ç¤ºåœ¨é¢†åŸŸæ¨¡å‹ä¸­çš„èšåˆï¼ˆAggregateï¼‰çš„æ ¹å®ä½“ã€‚èšåˆæ˜¯ä¸€ç»„ç›¸å…³è”çš„å®ä½“å’Œå€¼å¯¹è±¡çš„é›†åˆï¼Œå®ƒä»¬å…±åŒå½¢æˆäº†ä¸€ä¸ªæœ‰æ„ä¹‰çš„æ•´ä½“ï¼Œèšåˆæ ¹æ˜¯è¿™ä¸ªèšåˆä¸­çš„ä¸€ä¸ªç‰¹å®šå®ä½“ï¼Œè´Ÿè´£ç»´æŠ¤æ•´ä¸ªèšåˆçš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚</p><p>èšåˆæ ¹åœ¨é¢†åŸŸé©±åŠ¨è®¾è®¡ä¸­æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p><ol><li>èšåˆæ ¹æ˜¯èšåˆçš„å…¥å£ç‚¹ï¼šèšåˆæ ¹æ˜¯èšåˆçš„å…¬å…±è®¿é—®ç‚¹ï¼Œå®ƒæ˜¯å¤–éƒ¨ä¸–ç•Œä¸èšåˆå†…éƒ¨çš„äº¤äº’å…¥å£ï¼Œæ‰€æœ‰å¯¹èšåˆå†…éƒ¨å®ä½“å’Œå€¼å¯¹è±¡çš„æ“ä½œéƒ½åº”è¯¥é€šè¿‡èšåˆæ ¹è¿›è¡Œã€‚</li><li>èšåˆæ ¹è´Ÿè´£ç»´æŠ¤èšåˆçš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ï¼šèšåˆæ ¹è´Ÿè´£åè°ƒèšåˆå†…éƒ¨å®ä½“å’Œå€¼å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼Œä»¥ä¿æŒèšåˆçš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚èšåˆæ ¹è´Ÿè´£åœ¨èšåˆå†…éƒ¨è¿›è¡Œæ“ä½œï¼Œç¡®ä¿èšåˆå†…çš„å®ä½“å’Œå€¼å¯¹è±¡ä¹‹é—´çš„çŠ¶æ€ä¿æŒä¸€è‡´ã€‚</li><li>èšåˆæ ¹å®šä¹‰èšåˆçš„è¾¹ç•Œï¼šèšåˆæ ¹å®šä¹‰äº†èšåˆçš„è¾¹ç•Œï¼Œå®ƒå†³å®šäº†å“ªäº›å®ä½“å’Œå€¼å¯¹è±¡å±äºèšåˆçš„ä¸€éƒ¨åˆ†ï¼Œå“ªäº›ä¸å±äºã€‚èšåˆæ ¹åº”è¯¥åŒ…å«è¶³å¤Ÿçš„ä¿¡æ¯ï¼Œä½¿å¾—èšåˆèƒ½å¤Ÿè‡ªæˆ‘å®Œæ•´åœ°å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶ä¿æŒå†…éƒ¨å®ä½“å’Œå€¼å¯¹è±¡çš„ä¸€è‡´æ€§ã€‚</li><li>èšåˆæ ¹æ˜¯å”¯ä¸€æ ‡è¯†èšåˆçš„å…ƒç´ ï¼šèšåˆæ ¹é€šå¸¸å…·æœ‰å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºåœ¨ç³»ç»Ÿä¸­æ ‡è¯†å’Œå®šä½èšåˆã€‚èšåˆæ ¹çš„å”¯ä¸€æ ‡è¯†å¯ä»¥ä½œä¸ºèšåˆçš„å¤–éƒ¨å¼•ç”¨ï¼Œç”¨äºåœ¨ç³»ç»Ÿä¸­è¯†åˆ«å’Œæ“ä½œèšåˆã€‚</li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œèšåˆæ ¹å¹¶ä¸ä¸€å®šæ˜¯é¢†åŸŸæ¨¡å‹ä¸­çš„æ ¹å®ä½“ï¼Œå®ƒå¯ä»¥æ˜¯ä»»ä½•åœ¨èšåˆä¸­å…·æœ‰ç‰¹æ®Šè§’è‰²çš„å®ä½“ã€‚åœ¨è®¾è®¡èšåˆæ—¶ï¼Œéœ€è¦ä»”ç»†è€ƒè™‘èšåˆæ ¹çš„é€‰æ‹©ï¼Œå¹¶ç¡®ä¿èšåˆæ ¹èƒ½å¤Ÿæœ‰æ•ˆåœ°ç»´æŠ¤èšåˆçš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚èšåˆæ ¹çš„è®¾è®¡åº”è¯¥éµå¾ªé¢†åŸŸé©±åŠ¨è®¾è®¡çš„åŸåˆ™ï¼ŒåŒ…æ‹¬å°è£…ã€èšåˆè¾¹ç•Œã€é™ç•Œä¸Šä¸‹æ–‡ç­‰ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯é¢†åŸŸäº‹ä»¶"><a href="#ä»€ä¹ˆæ˜¯é¢†åŸŸäº‹ä»¶" class="headerlink" title="ä»€ä¹ˆæ˜¯é¢†åŸŸäº‹ä»¶"></a>ä»€ä¹ˆæ˜¯é¢†åŸŸäº‹ä»¶</h3><p>é¢†åŸŸäº‹ä»¶ï¼ˆDomain Eventï¼‰æ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œç”¨äºè¡¨ç¤ºé¢†åŸŸä¸­å‘ç”Ÿçš„é‡è¦äº‹ä»¶ã€‚å®ƒæ˜¯å¯¹ä¸šåŠ¡é¢†åŸŸä¸­å‘ç”Ÿçš„äº‹å®æˆ–çŠ¶æ€å˜åŒ–çš„ä¸€ç§æŠ½è±¡ï¼Œå¯ä»¥è¢«å…¶ä»–éƒ¨åˆ†ç›‘å¬å’Œå¤„ç†ã€‚</p><p>é¢†åŸŸäº‹ä»¶å…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</p><ul><li>äº‹ä»¶é©±åŠ¨ï¼šé¢†åŸŸäº‹ä»¶æ˜¯åŸºäºäº‹ä»¶é©±åŠ¨çš„è®¾è®¡æ¨¡å¼ï¼Œé€šè¿‡å‘å¸ƒ&#x2F;è®¢é˜…ï¼ˆPublish&#x2F;Subscribeï¼‰æœºåˆ¶ï¼Œå°†äº‹ä»¶å‘é€ç»™å¯¹è¯¥äº‹ä»¶æ„Ÿå…´è¶£çš„è®¢é˜…è€…ï¼Œä»è€Œå®ç°è§£è€¦å’Œæ¾æ•£è€¦åˆçš„ç›®çš„ã€‚</li><li>å¼‚æ­¥å¤„ç†ï¼šé¢†åŸŸäº‹ä»¶é€šå¸¸æ˜¯å¼‚æ­¥å¤„ç†çš„ï¼Œå³äº‹ä»¶çš„å‘ç”Ÿå’Œå¤„ç†æ˜¯åœ¨ä¸åŒçš„æ—¶é—´å’Œå¤„ç†å•å…ƒä¸­è¿›è¡Œçš„ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå“åº”æ€§ã€‚</li><li>å¯æº¯æºæ€§ï¼šé¢†åŸŸäº‹ä»¶è®°å½•äº†é¢†åŸŸä¸­å‘ç”Ÿçš„äº‹å®ï¼Œå¯ä»¥ä½œä¸ºç³»ç»Ÿçš„å®¡è®¡æ—¥å¿—ï¼Œå¸®åŠ©è¿›è¡Œç³»ç»Ÿçš„æº¯æºå’Œæ•…éšœè¯Šæ–­ã€‚</li><li>é«˜å†…èšæ€§ï¼šé¢†åŸŸäº‹ä»¶é€šå¸¸ä¸é¢†åŸŸæ¨¡å‹ç´§å¯†ç›¸å…³ï¼Œç”¨äºè¡¨ç¤ºä¸šåŠ¡é¢†åŸŸä¸­çš„ä¸šåŠ¡é€»è¾‘å’ŒçŠ¶æ€å˜åŒ–ï¼Œä»è€Œä¿æŒç³»ç»Ÿçš„é«˜å†…èšæ€§ã€‚</li></ul><p>åœ¨é¢†åŸŸé©±åŠ¨è®¾è®¡ä¸­ï¼Œé¢†åŸŸäº‹ä»¶å¯ä»¥ä½œä¸ºä¸€ç§æœ‰æ•ˆçš„æ–¹å¼æ¥å¤„ç†ä¸šåŠ¡é€»è¾‘çš„å¤æ‚æ€§å’Œå˜åŒ–ï¼Œå®ç°ä¸šåŠ¡æµç¨‹çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p><p>æ­¤å¤–ï¼Œé¢†åŸŸäº‹ä»¶è¿˜å¯ä»¥ç”¨äºå®ç°ä¸šåŠ¡ä¹‹é—´çš„è§£è€¦å’ŒååŒï¼Œä¿ƒè¿›å›¢é˜Ÿé—´çš„åˆä½œå’Œè‡ªæ²»ã€‚é€šè¿‡å¼•å…¥é¢†åŸŸäº‹ä»¶ï¼Œå¯ä»¥å°†ä¸šåŠ¡ä¸­çš„é‡è¦çŠ¶æ€å˜åŒ–å’Œäº‹å®è¿›è¡ŒæŠ½è±¡å’Œå»ºæ¨¡ï¼Œä»è€Œå¯ä»¥åœ¨ç³»ç»Ÿä¸­è¿›è¡Œäº‹ä»¶çš„å‘å¸ƒã€è®¢é˜…å’Œå¤„ç†ï¼Œä½¿ä¸åŒçš„ä¸šåŠ¡æ¨¡å—èƒ½å¤Ÿé€šè¿‡äº‹ä»¶è¿›è¡Œè§£è€¦ï¼Œå®ç°ç‹¬ç«‹æ¼”è¿›å’Œçµæ´»ç»„åˆã€‚</p><p>é¢†åŸŸäº‹ä»¶çš„è®¾è®¡å’Œä½¿ç”¨éœ€è¦è°¨æ…ï¼Œéœ€è¦è€ƒè™‘äº‹ä»¶çš„ç²’åº¦ã€å‘½åã€å†…å®¹å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ç­‰å› ç´ ã€‚åˆç†åœ°ä½¿ç”¨é¢†åŸŸäº‹ä»¶å¯ä»¥æé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œå¯æµ‹è¯•æ€§ï¼Œä»è€Œæ›´å¥½åœ°æ”¯æŒå¤æ‚ä¸šåŠ¡éœ€æ±‚å’Œç³»ç»Ÿçš„æ¼”è¿›ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯é¢†åŸŸæœåŠ¡"><a href="#ä»€ä¹ˆæ˜¯é¢†åŸŸæœåŠ¡" class="headerlink" title="ä»€ä¹ˆæ˜¯é¢†åŸŸæœåŠ¡"></a>ä»€ä¹ˆæ˜¯é¢†åŸŸæœåŠ¡</h3><p>é¢†åŸŸæœåŠ¡ï¼ˆDomain Servicesï¼‰æ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå®ƒç”¨äºå¤„ç†é¢†åŸŸæ¨¡å‹ä¸­çš„ä¸šåŠ¡é€»è¾‘å’Œæ“ä½œï¼Œä½†ä¸å±äºç‰¹å®šçš„å®ä½“æˆ–å€¼å¯¹è±¡ã€‚é¢†åŸŸæœåŠ¡é€šå¸¸ç”¨äºå¤„ç†æ¶‰åŠå¤šä¸ªå®ä½“æˆ–å€¼å¯¹è±¡çš„ä¸šåŠ¡é€»è¾‘ï¼Œæˆ–è€…å¤„ç†é¢†åŸŸæ¨¡å‹ä¸­çš„è·¨èšåˆæ ¹çš„æ“ä½œã€‚</p><p>é¢†åŸŸæœåŠ¡é€šå¸¸å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li>å°è£…ä¸šåŠ¡é€»è¾‘ï¼šé¢†åŸŸæœåŠ¡å°è£…äº†é¢†åŸŸæ¨¡å‹ä¸­çš„ä¸šåŠ¡é€»è¾‘å’Œæ“ä½œï¼Œå¯ä»¥åŒ…å«ä¸€ç³»åˆ—çš„æ–¹æ³•æˆ–æ“ä½œï¼Œç”¨äºå®ç°ç‰¹å®šçš„ä¸šåŠ¡éœ€æ±‚ã€‚</li><li>æ— çŠ¶æ€æ€§ï¼šé¢†åŸŸæœåŠ¡é€šå¸¸æ˜¯æ— çŠ¶æ€çš„ï¼Œä¸ä¿å­˜ä»»ä½•çŠ¶æ€ä¿¡æ¯ï¼Œæ¯æ¬¡è°ƒç”¨æ—¶éƒ½éœ€è¦ä¼ å…¥æ‰€éœ€çš„å‚æ•°ã€‚è¿™æœ‰åŠ©äºé¿å…çŠ¶æ€çš„æ··æ·†å’Œå¤æ‚æ€§ï¼Œå¹¶ä¸”ä½¿é¢†åŸŸæœåŠ¡æ›´åŠ çµæ´»å’Œå¯æµ‹è¯•ã€‚</li><li>è·¨èšåˆæ ¹æ“ä½œï¼šé¢†åŸŸæœåŠ¡å¯ä»¥å¤„ç†æ¶‰åŠå¤šä¸ªèšåˆæ ¹ï¼ˆAggregate Rootï¼‰çš„ä¸šåŠ¡é€»è¾‘ï¼Œåè°ƒèšåˆæ ¹ä¹‹é—´çš„äº¤äº’å’Œæ“ä½œã€‚è¿™æœ‰åŠ©äºé¿å…åœ¨èšåˆæ ¹ä¹‹é—´å¼•å…¥è¿‡å¤šçš„è€¦åˆå’Œå¤æ‚æ€§ã€‚</li><li>ä¸šåŠ¡å…³æ³¨ç‚¹ï¼šé¢†åŸŸæœåŠ¡é€šå¸¸å…³æ³¨äºè§£å†³ä¸šåŠ¡é—®é¢˜ï¼Œè€Œä¸æ˜¯æŠ€æœ¯å®ç°ã€‚å®ƒä»¬åº”è¯¥ä¸å…·ä½“çš„æŠ€æœ¯å®ç°è§£è€¦ï¼Œä»è€Œå¯ä»¥æ›´å¥½åœ°åº”å¯¹ä¸šåŠ¡éœ€æ±‚çš„å˜åŒ–ã€‚</li></ol><p>é¢†åŸŸæœåŠ¡åœ¨DDDä¸­è¢«ç”¨äºå¤„ç†å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ã€åè°ƒä¸åŒèšåˆæ ¹ä¹‹é—´çš„æ“ä½œï¼Œä»¥åŠå¤„ç†ä¸€äº›æ— æ³•å½’å±äºç‰¹å®šå®ä½“æˆ–å€¼å¯¹è±¡çš„ä¸šåŠ¡éœ€æ±‚ã€‚åˆç†ä½¿ç”¨é¢†åŸŸæœåŠ¡å¯ä»¥å¸®åŠ©å®ç°é¢†åŸŸæ¨¡å‹çš„é«˜å†…èšã€ä½è€¦åˆï¼Œå¹¶æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§ã€‚</p><h3 id="å€¼å¯¹è±¡å’Œå®ä½“æœ‰ä»€ä¹ˆåŒºåˆ«"><a href="#å€¼å¯¹è±¡å’Œå®ä½“æœ‰ä»€ä¹ˆåŒºåˆ«" class="headerlink" title="å€¼å¯¹è±¡å’Œå®ä½“æœ‰ä»€ä¹ˆåŒºåˆ«"></a>å€¼å¯¹è±¡å’Œå®ä½“æœ‰ä»€ä¹ˆåŒºåˆ«</h3><p>åœ¨é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰ä¸­ï¼Œå€¼å¯¹è±¡ï¼ˆValue Objectï¼‰å’Œå®ä½“ï¼ˆEntityï¼‰æ˜¯ä¸¤ç§ä¸åŒçš„é¢†åŸŸæ¨¡å‹å¯¹è±¡ï¼Œå®ƒä»¬æœ‰ä»¥ä¸‹åŒºåˆ«ï¼š</p><ol><li>ä¸å¯å˜æ€§ï¼ˆImmutabilityï¼‰ï¼šå€¼å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½ä¿®æ”¹å…¶çŠ¶æ€ã€‚è€Œå®ä½“æ˜¯å¯å˜çš„ï¼Œå¯ä»¥åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…æ”¹å˜å…¶çŠ¶æ€ã€‚</li><li>ç­‰åŒæ€§æ¯”è¾ƒï¼ˆEquality Comparisonï¼‰ï¼šå€¼å¯¹è±¡çš„ç›¸ç­‰æ€§æ˜¯åŸºäºå…¶å±æ€§å€¼çš„æ¯”è¾ƒï¼Œå³å¦‚æœä¸¤ä¸ªå€¼å¯¹è±¡çš„å±æ€§å€¼ç›¸ç­‰ï¼Œåˆ™å®ƒä»¬è¢«è§†ä¸ºç›¸ç­‰ã€‚è€Œå®ä½“çš„ç›¸ç­‰æ€§ä¸€èˆ¬æ˜¯åŸºäºå…¶å”¯ä¸€æ ‡è¯†ï¼ˆä¾‹å¦‚æ•°æ®åº“ä¸­çš„ä¸»é”®ï¼‰çš„æ¯”è¾ƒï¼Œå³ä½¿ä¸¤ä¸ªå®ä½“çš„å±æ€§å€¼ç›¸ç­‰ï¼Œä½†å¦‚æœå®ƒä»¬çš„å”¯ä¸€æ ‡è¯†ä¸åŒï¼Œåˆ™è¢«è§†ä¸ºä¸ç›¸ç­‰ã€‚</li><li>èº«ä»½ä¸ç”Ÿå‘½å‘¨æœŸï¼ˆIdentity and Lifecycleï¼‰ï¼šå€¼å¯¹è±¡æ²¡æœ‰æ˜ç¡®çš„èº«ä»½ï¼ˆIdentityï¼‰ï¼Œå®ƒä»¬çš„ä¸»è¦ä½œç”¨æ˜¯æè¿°ä¸€ç»„å±æ€§å€¼ï¼Œé€šå¸¸ç”¨äºè¡¨ç¤ºä¸å¯å˜çš„å±æ€§æˆ–å±æ€§ç»„åˆã€‚è€Œå®ä½“æœ‰æ˜ç¡®çš„èº«ä»½ï¼Œé€šå¸¸é€šè¿‡å”¯ä¸€æ ‡è¯†æ¥åŒºåˆ†ä¸åŒçš„å®ä½“ï¼Œå¹¶ä¸”å®ä½“å…·æœ‰ç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥åœ¨ç³»ç»Ÿä¸­åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤ã€‚</li><li>æŒä¹…åŒ–ï¼ˆPersistenceï¼‰ï¼šå€¼å¯¹è±¡é€šå¸¸ä¸ä¼šå•ç‹¬è¿›è¡ŒæŒä¹…åŒ–ï¼Œå®ƒä»¬é€šå¸¸ä½œä¸ºå®ä½“çš„å±æ€§è€Œå­˜åœ¨ï¼Œå½“å®ä½“è¢«æŒä¹…åŒ–æ—¶ï¼Œå€¼å¯¹è±¡ä¹Ÿä¼šä¸€åŒè¢«æŒä¹…åŒ–ã€‚è€Œå®ä½“é€šå¸¸éœ€è¦è¢«æŒä¹…åŒ–åˆ°æ•°æ®åº“æˆ–å…¶ä»–æ•°æ®å­˜å‚¨ä¸­ï¼Œä»¥ä¾¿èƒ½å¤Ÿåœ¨ç³»ç»Ÿé‡å¯æˆ–æŒä¹…åŒ–çŠ¶æ€æ—¶é‡æ–°åŠ è½½ã€‚</li><li>ä¸šåŠ¡è§„åˆ™ï¼ˆBusiness Rulesï¼‰ï¼šå€¼å¯¹è±¡é€šå¸¸åŒ…å«ä¸ä¸šåŠ¡ç›¸å…³çš„å±æ€§å’Œè¡Œä¸ºï¼Œä½†å®ƒä»¬ä¸ä¼šåŒ…å«å¤æ‚çš„ä¸šåŠ¡è§„åˆ™ï¼Œå› ä¸ºå€¼å¯¹è±¡çš„ä¸»è¦ç›®çš„æ˜¯æè¿°å±æ€§å€¼ã€‚è€Œå®ä½“é€šå¸¸åŒ…å«å¤æ‚çš„ä¸šåŠ¡è§„åˆ™å’Œè¡Œä¸ºï¼Œå› ä¸ºå®ä½“å…·æœ‰æ›´ä¸°å¯Œçš„çŠ¶æ€å’Œè¡Œä¸ºã€‚</li></ol><p>æ€»çš„æ¥è¯´ï¼Œå€¼å¯¹è±¡ä¸»è¦ç”¨äºæè¿°ä¸å¯å˜çš„å±æ€§æˆ–å±æ€§ç»„åˆï¼Œé€šå¸¸æ²¡æœ‰æ˜ç¡®çš„èº«ä»½å’Œç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”ä¸ä¼šå•ç‹¬è¿›è¡ŒæŒä¹…åŒ–ã€‚è€Œå®ä½“åˆ™å…·æœ‰æ˜ç¡®çš„èº«ä»½å’Œç”Ÿå‘½å‘¨æœŸï¼Œé€šå¸¸éœ€è¦è¿›è¡ŒæŒä¹…åŒ–ï¼Œå¹¶ä¸”å¯èƒ½åŒ…å«å¤æ‚çš„ä¸šåŠ¡è§„åˆ™å’Œè¡Œä¸ºã€‚åœ¨DDDä¸­ï¼Œåˆç†ä½¿ç”¨å€¼å¯¹è±¡å’Œå®ä½“å¯ä»¥å¸®åŠ©è¿›è¡Œæ›´å¥½çš„é¢†åŸŸå»ºæ¨¡å’Œè®¾è®¡ï¼Œä»è€Œæ›´å¥½åœ°æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ã€‚</p><h3 id="DDDä¸­çš„å…­è¾¹å½¢æ¶æ„"><a href="#DDDä¸­çš„å…­è¾¹å½¢æ¶æ„" class="headerlink" title="DDDä¸­çš„å…­è¾¹å½¢æ¶æ„"></a>DDDä¸­çš„å…­è¾¹å½¢æ¶æ„</h3><p>å…­è¾¹å½¢æ¶æ„ï¼ˆHexagonal Architectureï¼‰ï¼Œåˆç§°ä¸ºç«¯å£å’Œé€‚é…å™¨æ¶æ„ï¼ˆPorts and Adapters Architectureï¼‰ï¼Œæ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDomain-Driven Designï¼ŒDDDï¼‰ä¸­ä¸€ç§å¸¸ç”¨çš„æ¶æ„æ¨¡å¼ã€‚å®ƒæ˜¯ä¸€ç§å°†ä¸šåŠ¡é€»è¾‘ä»å¤–éƒ¨ä¾èµ–è§£è€¦çš„æ¶æ„æ¨¡å¼ï¼Œå¼ºè°ƒä¸šåŠ¡é€»è¾‘åº”è¯¥ç‹¬ç«‹äºå¤–éƒ¨æŠ€æœ¯å’Œæ¡†æ¶ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç®¡ç†å¤æ‚çš„ä¸šåŠ¡è§„åˆ™å’Œé€»è¾‘ã€‚</p><p>å…­è¾¹å½¢æ¶æ„çš„ä¸»è¦ç‰¹ç‚¹æ˜¯é€šè¿‡å®šä¹‰ç«¯å£ï¼ˆPortsï¼‰å’Œé€‚é…å™¨ï¼ˆAdaptersï¼‰çš„æ–¹å¼ï¼Œå°†åº”ç”¨ç¨‹åºåˆ’åˆ†ä¸ºä¸åŒçš„å±‚ï¼ŒåŒ…æ‹¬å†…éƒ¨æ ¸å¿ƒå±‚ã€å¤–éƒ¨ä¾èµ–å±‚å’Œåº”ç”¨ç¨‹åºæ¥å£å±‚ã€‚å…¶ä¸­ï¼š</p><ul><li>å†…éƒ¨æ ¸å¿ƒå±‚ï¼šåŒ…å«äº†ä¸šåŠ¡é¢†åŸŸçš„æ ¸å¿ƒé€»è¾‘ï¼Œä¹Ÿæ˜¯åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒã€‚å®ƒåŒ…æ‹¬é¢†åŸŸæ¨¡å‹ã€é¢†åŸŸæœåŠ¡ç­‰ï¼Œè´Ÿè´£å¤„ç†ä¸šåŠ¡é€»è¾‘å’Œä¸šåŠ¡è§„åˆ™ã€‚</li><li>å¤–éƒ¨ä¾èµ–å±‚ï¼šåŒ…å«äº†ä¸å¤–éƒ¨ç³»ç»Ÿçš„äº¤äº’ï¼Œå¦‚æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å¤–éƒ¨æœåŠ¡ç­‰ã€‚å®ƒè´Ÿè´£å¤„ç†ä¸å¤–éƒ¨ç³»ç»Ÿçš„é€šä¿¡å’Œæ•°æ®å­˜å‚¨ã€‚</li><li>åº”ç”¨ç¨‹åºæ¥å£å±‚ï¼šåŒ…å«äº†åº”ç”¨ç¨‹åºçš„æ¥å£ï¼Œå¯ä»¥æ˜¯ç”¨æˆ·ç•Œé¢ã€APIæ¥å£ç­‰ã€‚å®ƒè´Ÿè´£å¤„ç†ç”¨æˆ·è¾“å…¥ã€è¾“å‡ºå’Œåº”ç”¨ç¨‹åºçš„äº¤äº’ã€‚</li></ul><p>å…­è¾¹å½¢æ¶æ„é€šè¿‡å®šä¹‰æ¸…æ™°çš„æ¥å£å’Œé€‚é…å™¨æ¥å®ç°å†…å¤–éƒ¨ä¹‹é—´çš„è§£è€¦ï¼Œä»è€Œä½¿å¾—ä¸šåŠ¡é€»è¾‘èƒ½å¤Ÿç‹¬ç«‹äºå¤–éƒ¨æŠ€æœ¯å’Œæ¡†æ¶è¿›è¡Œæ¼”è¿›å’Œå˜åŒ–ã€‚è¿™ç§æ¶æ„æ¨¡å¼èƒ½å¤Ÿæé«˜åº”ç”¨ç¨‹åºçš„å¯æµ‹è¯•æ€§ã€å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿæ›´å¥½åœ°æ”¯æŒé¢†åŸŸé©±åŠ¨è®¾è®¡çš„å®è·µï¼Œä½¿ä¸šåŠ¡è§„åˆ™å’Œé¢†åŸŸæ¨¡å‹æ›´åŠ æ¸…æ™°å’Œå¯ç®¡ç†ã€‚</p><h3 id="DDDçš„CQRSæ¨¡å¼"><a href="#DDDçš„CQRSæ¨¡å¼" class="headerlink" title="DDDçš„CQRSæ¨¡å¼"></a>DDDçš„CQRSæ¨¡å¼</h3><p>CQRSï¼ˆCommand Query Responsibility Segregationï¼‰æ˜¯é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰ä¸­çš„ä¸€ç§æ¶æ„æ¨¡å¼ï¼Œç”¨äºå°†åº”ç”¨ç¨‹åºçš„è¯»æ“ä½œå’Œå†™æ“ä½œåˆ†ç¦»ã€‚</p><p>åœ¨ä¼ ç»Ÿçš„åº”ç”¨ç¨‹åºä¸­ï¼Œè¯»æ“ä½œå’Œå†™æ“ä½œé€šå¸¸æ˜¯é€šè¿‡ç›¸åŒçš„æ¨¡å‹å’Œæ•°æ®è®¿é—®å±‚è¿›è¡Œå¤„ç†çš„ã€‚è€Œåœ¨CQRSæ¨¡å¼ä¸­ï¼Œè¯»æ“ä½œå’Œå†™æ“ä½œè¢«æ˜ç¡®åœ°åˆ†ç¦»ä¸ºä¸¤ä¸ªä¸åŒçš„éƒ¨åˆ†ï¼Œåˆ†åˆ«ä½¿ç”¨ä¸åŒçš„æ¨¡å‹å’Œæ•°æ®è®¿é—®å±‚æ¥å¤„ç†ã€‚</p><p>å…·ä½“è€Œè¨€ï¼ŒCQRSæ¨¡å¼åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š</p><ul><li>å‘½ä»¤ï¼ˆCommandï¼‰ï¼šè¡¨ç¤ºå¯¹ç³»ç»Ÿçš„å†™æ“ä½œï¼Œä¾‹å¦‚åˆ›å»ºã€æ›´æ–°æˆ–åˆ é™¤æ•°æ®ã€‚å‘½ä»¤è´Ÿè´£ä¿®æ”¹ç³»ç»Ÿçš„çŠ¶æ€ã€‚</li><li>æŸ¥è¯¢ï¼ˆQueryï¼‰ï¼šè¡¨ç¤ºå¯¹ç³»ç»Ÿçš„è¯»æ“ä½œï¼Œä¾‹å¦‚è·å–æ•°æ®æˆ–æŸ¥è¯¢æ•°æ®ã€‚æŸ¥è¯¢è´Ÿè´£ä»ç³»ç»Ÿä¸­è¯»å–æ•°æ®ï¼Œä½†ä¸ä¿®æ”¹ç³»ç»Ÿçš„çŠ¶æ€ã€‚</li><li>æ¨¡å‹åˆ†ç¦»ï¼šCQRSæ¨¡å¼é€šè¿‡æ˜ç¡®åœ°åˆ†ç¦»å†™æ“ä½œå’Œè¯»æ“ä½œçš„æ¨¡å‹ï¼Œä½¿å…¶å¯ä»¥ç‹¬ç«‹æ¼”è¿›å’Œä¼˜åŒ–ã€‚é€šå¸¸ï¼Œå†™æ“ä½œä¼šä½¿ç”¨ä¸€ä¸ªæ›´åŠ é¢å‘è¡Œä¸ºçš„é¢†åŸŸæ¨¡å‹ï¼Œè€Œè¯»æ“ä½œåˆ™ä½¿ç”¨ä¸€ä¸ªæ›´åŠ é¢å‘æŸ¥è¯¢çš„æ¨¡å‹ï¼Œä¾‹å¦‚æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆDTOï¼‰ã€‚</li><li>æ•°æ®è®¿é—®å±‚åˆ†ç¦»ï¼šCQRSæ¨¡å¼è¿˜å°†å†™æ“ä½œå’Œè¯»æ“ä½œçš„æ•°æ®è®¿é—®å±‚è¿›è¡Œåˆ†ç¦»ã€‚é€šå¸¸ï¼Œå†™æ“ä½œä¼šä½¿ç”¨ä¸€ä¸ªæ›´åŠ é«˜æ•ˆçš„ã€é¢å‘äº‹åŠ¡çš„æ•°æ®è®¿é—®å±‚ï¼Œè€Œè¯»æ“ä½œåˆ™ä½¿ç”¨ä¸€ä¸ªæ›´åŠ é«˜æ€§èƒ½çš„ã€é¢å‘æŸ¥è¯¢çš„æ•°æ®è®¿é—®å±‚ã€‚</li></ul><p>CQRSæ¨¡å¼çš„ä¼˜åŠ¿åŒ…æ‹¬ï¼š</p><ul><li>çµæ´»æ€§ï¼šé€šè¿‡æ˜ç¡®åœ°åˆ†ç¦»è¯»å†™æ“ä½œï¼ŒCQRSæ¨¡å¼å…è®¸åº”ç”¨ç¨‹åºèƒ½å¤Ÿçµæ´»åœ°é’ˆå¯¹ä¸åŒçš„è¯»å†™æ“ä½œé€‰æ‹©åˆé€‚çš„ä¼˜åŒ–ç­–ç•¥ï¼Œä»è€Œæé«˜æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚</li><li>å¯æµ‹è¯•æ€§ï¼šCQRSæ¨¡å¼å°†è¯»å†™æ“ä½œåˆ†ç¦»ï¼Œä½¿å¾—å¯ä»¥å¯¹è¯»å†™æ“ä½œåˆ†åˆ«è¿›è¡Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼Œä»è€Œæé«˜æµ‹è¯•çš„ç²’åº¦å’Œæ•ˆæœã€‚</li><li>æ˜¾å¼æ€§ï¼šCQRSæ¨¡å¼é€šè¿‡æ˜ç¡®åœ°å®šä¹‰å‘½ä»¤å’ŒæŸ¥è¯¢çš„æ–¹å¼ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºçš„è¡Œä¸ºå’Œæ•°æ®è®¿é—®æ›´åŠ æ˜ç¡®å’Œå¯ç†è§£ã€‚</li><li>è§£è€¦æ€§ï¼šCQRSæ¨¡å¼é€šè¿‡æ˜ç¡®åœ°åˆ†ç¦»è¯»å†™æ“ä½œçš„æ¨¡å‹å’Œæ•°æ®è®¿é—®å±‚ï¼Œé™ä½äº†ä¸åŒæ“ä½œä¹‹é—´çš„è€¦åˆï¼Œä»è€Œä½¿å¾—åº”ç”¨ç¨‹åºæ›´åŠ çµæ´»å’Œå¯ç»´æŠ¤ã€‚</li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCQRSæ¨¡å¼å¹¶ä¸æ˜¯é€‚ç”¨äºæ‰€æœ‰åº”ç”¨ç¨‹åºçš„é€šç”¨è§£å†³æ–¹æ¡ˆï¼Œè€Œæ˜¯æ ¹æ®åº”ç”¨ç¨‹åºçš„ç‰¹ç‚¹å’Œéœ€æ±‚é€‰æ‹©åˆé€‚çš„æ¶æ„æ¨¡å¼ã€‚åœ¨åº”ç”¨CQRSæ¨¡å¼æ—¶ï¼Œéœ€è¦ä»”ç»†è€ƒè™‘åº”ç”¨ç¨‹åºçš„å¤æ‚æ€§ã€æ€§èƒ½éœ€æ±‚ã€å›¢é˜Ÿçš„æŠ€æœ¯èƒ½åŠ›ç­‰å› ç´ ï¼Œå¹¶è¿›è¡Œé€‚å½“çš„è®¾è®¡å’Œå®æ–½ã€‚</p><ol><li>æœåŠ¡æ³¨å†Œå‘ç°APä¸CPæ¶æ„å¯¹æ¯”</li><li>ç†”æ–­é™çº§ç­–ç•¥ï¼ˆæ»‘åŠ¨çª—å£å®ç°ï¼‰</li><li>åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒæ¨æ‹‰æ¨¡å¼å¯¹æ¯”</li><li>ç°åº¦å‘å¸ƒå®ç°æ–¹æ¡ˆ</li><li>åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªåŸç†ï¼ˆSpanæ ‘ï¼‰</li><li>Seata ATæ¨¡å¼å®ç°åŸç†</li><li>æ¥å£æ€§èƒ½çªå¢çš„é™æµç­–ç•¥</li><li>å¦‚ä½•è®¾è®¡æœåŠ¡æ²»ç†å¹³å°ï¼Ÿ</li><li>è®¾è®¡å¾®ä¿¡æœ‹å‹åœˆçš„å­˜å‚¨æ¶æ„</li><li>çŸ­é“¾ç³»ç»Ÿå¦‚ä½•å®ç°é«˜å¹¶å‘å†™å…¥ï¼Ÿ</li><li>åˆ†å¸ƒå¼å”¯ä¸€IDç”Ÿæˆæ–¹æ¡ˆï¼ˆSnowflakeä¼˜åŒ–ï¼‰</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªåˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ç³»ç»Ÿï¼Ÿ</li><li>å®ç°è·¨æ•°æ®ä¸­å¿ƒçš„æ•°æ®åŒæ­¥æ–¹æ¡ˆ</li><li>è®¾è®¡æ”¯æŒåƒä¸‡çº§ç”¨æˆ·çš„æ¨é€ç³»ç»Ÿ</li><li>å¾®åšçƒ­æœæ¦œå®æ—¶è®¡ç®—æ¶æ„è®¾è®¡</li><li>ç”µå•†åº“å­˜æ‰£å‡çš„é˜²è¶…å–æ–¹æ¡ˆ</li><li>å¤šçº§ç¼“å­˜æ¶æ„è®¾è®¡ï¼ˆæœ¬åœ°ç¼“å­˜+Redis+JVMï¼‰</li><li>è®¾è®¡æ”¯æŒPBçº§æ•°æ®çš„æ—¥å¿—åˆ†æç³»ç»Ÿ</li><li>å®ç°ä¸€ä¸ªåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ</li><li>è®¾è®¡æ”¯æŒåŠ¨æ€æ‰©å®¹çš„åˆ†åº“åˆ†è¡¨æ–¹æ¡ˆ</li><li>å¦‚ä½•è®¾è®¡APIç½‘å…³çš„é™æµç†”æ–­åŠŸèƒ½ï¼Ÿ</li><li>å®æ—¶èŠå¤©ç³»ç»Ÿçš„æ¶ˆæ¯å¯é æŠ•é€’æ–¹æ¡ˆ</li><li>è®¾è®¡æ”¯æŒç‰ˆæœ¬å›æ»šçš„é…ç½®ç®¡ç†ç³»ç»Ÿ</li><li>å®ç°è·¨è¯­è¨€æœåŠ¡è°ƒç”¨ï¼ˆThrift&#x2F;gRPCé€‰å‹ï¼‰</li><li>è®¾è®¡æ”¯æŒå¼¹æ€§ä¼¸ç¼©çš„å¾®æœåŠ¡æ¶æ„</li><li>å®ç°åˆ†å¸ƒå¼Sessionä¸€è‡´æ€§æ–¹æ¡ˆ</li><li>è®¾è®¡ä¸€ä¸ªé«˜æ€§èƒ½çš„æ—¥å¿—é‡‡é›†ç³»ç»Ÿ</li><li>å¦‚ä½•è®¾è®¡å¯è¿½æº¯çš„æ“ä½œæ—¥å¿—ç³»ç»Ÿï¼Ÿ</li><li>å¦‚ä½•å®ç°ç†”æ–­å™¨æ¨¡å¼ï¼ˆCircuit Breakerï¼‰ï¼Ÿ</li><li>CQRSæ¨¡å¼åœ¨ç”µå•†ç³»ç»Ÿä¸­çš„åº”ç”¨</li><li>äº‹ä»¶æº¯æºï¼ˆEvent Sourcingï¼‰çš„ä¼˜ç¼ºç‚¹åˆ†æ</li><li>Sidecaræ¨¡å¼åœ¨æœåŠ¡æ²»ç†ä¸­çš„åº”ç”¨</li><li>ç½‘å…³æ¨¡å¼ä¸­çš„è·¯ç”±ç­–ç•¥è®¾è®¡</li><li>é˜²è…å±‚ï¼ˆAnti-Corruption Layerï¼‰è®¾è®¡å®è·µ</li><li>é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰ä¸­çš„èšåˆæ ¹è®¾è®¡</li><li>é‡è¯•æ¨¡å¼ä¸­çš„æŒ‡æ•°é€€é¿ç®—æ³•å®ç°</li><li>å‰ç«¯çš„åç«¯æ¨¡å¼ï¼ˆBFFï¼‰é€‚ç”¨åœºæ™¯</li><li>åˆ†ç‰‡æ¨¡å¼ï¼ˆShardingï¼‰çš„æ•°æ®è¿ç§»æ–¹æ¡ˆ</li><li>ç®¡é“è¿‡æ»¤å™¨æ¨¡å¼åœ¨ETLä¸­çš„åº”ç”¨</li><li>ç‰©åŒ–è§†å›¾æ¨¡å¼ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½æ¡ˆä¾‹</li><li>ç­–ç•¥æ¨¡å¼åœ¨æ”¯ä»˜æ¸ é“é€‰æ‹©ä¸­çš„åº”ç”¨</li><li>è§‚å¯Ÿè€…æ¨¡å¼å®ç°é…ç½®åŠ¨æ€æ›´æ–°</li><li>ä»£ç†æ¨¡å¼åœ¨ç¼“å­˜ç©¿é€é˜²æŠ¤ä¸­çš„åº”ç”¨</li><li>å·¥å‚æ–¹æ³•æ¨¡å¼åœ¨è¿æ¥æ± åˆ›å»ºä¸­çš„åº”ç”¨</li><li>è£…é¥°å™¨æ¨¡å¼å®ç°APIé™æµåŠŸèƒ½</li><li>çŠ¶æ€æ¨¡å¼åœ¨è®¢å•çŠ¶æ€æµè½¬ä¸­çš„åº”ç”¨</li><li>ç»„åˆæ¨¡å¼å®ç°æƒé™æ ‘ç»“æ„è®¾è®¡</li><li>æ¨¡æ¿æ–¹æ³•æ¨¡å¼åœ¨äº‹åŠ¡ç®¡ç†ä¸­çš„åº”ç”¨</li><li>HTTPSæ¡æ‰‹è¿‡ç¨‹ä¼˜åŒ–ç­–ç•¥</li><li>é›¶æ‹·è´æŠ€æœ¯å®ç°åŸç†</li><li>ç™¾ä¸‡è¿æ¥æœåŠ¡å™¨æ¶æ„è®¾è®¡</li><li>çº¿ä¸ŠCPUé£™é«˜æ’æŸ¥æµç¨‹</li><li>è®¾è®¡ä¸€ä¸ªçŸ­é“¾ç³»ç»Ÿ</li><li>æ¥å£æ€§èƒ½ä¼˜åŒ–å…¨é“¾è·¯æ–¹æ¡ˆ</li><li>æµ·é‡æ•°æ®åˆ¤é‡æ–¹æ¡ˆï¼ˆå¸ƒéš†è¿‡æ»¤å™¨ï¼‰</li><li>å¦‚ä½•è®¾è®¡ç§’æ€ç³»ç»Ÿï¼Ÿ</li><li>å¤§å‹é¡¹ç›®ä»£ç è§„èŒƒè½åœ°å®è·µ</li><li>çº¿ä¸Šé—®é¢˜æ’æŸ¥å·¥å…·ç®±ï¼ˆarthas+prometheusï¼‰</li></ol><h2 id="è®¤è¯æˆæƒ"><a href="#è®¤è¯æˆæƒ" class="headerlink" title="è®¤è¯æˆæƒ"></a>è®¤è¯æˆæƒ</h2><h2 id="æ•°æ®å®‰å…¨"><a href="#æ•°æ®å®‰å…¨" class="headerlink" title="æ•°æ®å®‰å…¨"></a>æ•°æ®å®‰å…¨</h2><h2 id="é«˜æ€§èƒ½"><a href="#é«˜æ€§èƒ½" class="headerlink" title="é«˜æ€§èƒ½"></a>é«˜æ€§èƒ½</h2><h2 id="é«˜å¯ç”¨"><a href="#é«˜å¯ç”¨" class="headerlink" title="é«˜å¯ç”¨"></a>é«˜å¯ç”¨</h2><h3 id="é™æµ"><a href="#é™æµ" class="headerlink" title="é™æµ"></a>é™æµ</h3><p>æ ¸å¿ƒæ€æƒ³ï¼š<strong>åœ¨å•ä½æ—¶é—´å†…ï¼Œåªå…è®¸ç‰¹å®šæ•°é‡çš„è¯·æ±‚é€šè¿‡ï¼Œè¶…è¿‡é˜ˆå€¼çš„è¯·æ±‚å°†è¢«æ‹’ç»ã€æ’é˜Ÿç­‰å¾…æˆ–é™çº§å¤„ç†ã€‚</strong> ç›®çš„æ˜¯ä¿æŠ¤ç³»ç»Ÿä¸è¢«çªå‘æµé‡å‹å®ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨æœ€å¤§æ‰¿å—èƒ½åŠ›å†…ç¨³å®šè¿è¡Œã€‚</p><h4 id="å¸¸è§çš„é™æµç®—æ³•ä¸å®ç°"><a href="#å¸¸è§çš„é™æµç®—æ³•ä¸å®ç°" class="headerlink" title="å¸¸è§çš„é™æµç®—æ³•ä¸å®ç°"></a>å¸¸è§çš„é™æµç®—æ³•ä¸å®ç°</h4><h5 id="è®¡æ•°å™¨å›ºå®šçª—å£ç®—æ³•"><a href="#è®¡æ•°å™¨å›ºå®šçª—å£ç®—æ³•" class="headerlink" title="è®¡æ•°å™¨å›ºå®šçª—å£ç®—æ³•"></a>è®¡æ•°å™¨å›ºå®šçª—å£ç®—æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FixedWindowLimiter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> maxRequests;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> windowMillis;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> windowStart;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FixedWindowLimiter</span><span class="params">(<span class="type">int</span> maxRequests, <span class="type">long</span> windowMillis)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.maxRequests = maxRequests;</span><br><span class="line">        <span class="built_in">this</span>.windowMillis = windowMillis;</span><br><span class="line">        <span class="built_in">this</span>.windowStart = System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">boolean</span> <span class="title function_">allow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">if</span> (now - windowStart &gt; windowMillis) &#123;</span><br><span class="line">            count = <span class="number">0</span>; <span class="comment">// é‡ç½®è®¡æ•°å™¨</span></span><br><span class="line">            windowStart = now;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (count &lt; maxRequests) &#123;</span><br><span class="line">            count++;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é—®é¢˜</strong>ï¼šçª—å£åˆ‡æ¢æ—¶å¯èƒ½ç¬é—´æ¶Œå…¥2å€æµé‡ï¼ˆä¸´ç•Œé—®é¢˜ï¼‰ã€‚</p><h5 id="æ»‘åŠ¨æ—¥å¿—ç®—æ³•ï¼ˆè§£å†³ä¸´ç•Œé—®é¢˜ï¼‰"><a href="#æ»‘åŠ¨æ—¥å¿—ç®—æ³•ï¼ˆè§£å†³ä¸´ç•Œé—®é¢˜ï¼‰" class="headerlink" title="æ»‘åŠ¨æ—¥å¿—ç®—æ³•ï¼ˆè§£å†³ä¸´ç•Œé—®é¢˜ï¼‰"></a>æ»‘åŠ¨æ—¥å¿—ç®—æ³•ï¼ˆè§£å†³ä¸´ç•Œé—®é¢˜ï¼‰</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SlidingLogLimiter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> maxRequests;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> windowMillis;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Queue&lt;Long&gt; timestamps = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SlidingLogLimiter</span><span class="params">(<span class="type">int</span> maxRequests, <span class="type">long</span> windowMillis)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.maxRequests = maxRequests;</span><br><span class="line">        <span class="built_in">this</span>.windowMillis = windowMillis;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">boolean</span> <span class="title function_">allow</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// ç§»é™¤è¶…æ—¶è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">while</span> (!timestamps.isEmpty() &amp;&amp; now - timestamps.peek() &gt; windowMillis) &#123;</span><br><span class="line">            timestamps.poll();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (timestamps.size() &lt; maxRequests) &#123;</span><br><span class="line">            timestamps.add(now);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ¼æ¡¶ç®—æ³•ï¼ˆå¹³æ»‘æµé‡ï¼‰"><a href="#æ¼æ¡¶ç®—æ³•ï¼ˆå¹³æ»‘æµé‡ï¼‰" class="headerlink" title="æ¼æ¡¶ç®—æ³•ï¼ˆå¹³æ»‘æµé‡ï¼‰"></a>æ¼æ¡¶ç®—æ³•ï¼ˆå¹³æ»‘æµé‡ï¼‰</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeakyBucketLimiter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> capacity;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">water</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> lastLeakTime;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> leakRateMillis; <span class="comment">// æ¼å‡ºé—´éš”ï¼ˆæ¯«ç§’/è¯·æ±‚ï¼‰</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LeakyBucketLimiter</span><span class="params">(<span class="type">int</span> capacity, <span class="type">long</span> leakRateMillis)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">        <span class="built_in">this</span>.leakRateMillis = leakRateMillis;</span><br><span class="line">        <span class="built_in">this</span>.lastLeakTime = System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">boolean</span> <span class="title function_">allow</span><span class="params">()</span> &#123;</span><br><span class="line">        leakWater();</span><br><span class="line">        <span class="keyword">if</span> (water &lt; capacity) &#123;</span><br><span class="line">            water++;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">leakWater</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">long</span> <span class="variable">elapsed</span> <span class="operator">=</span> now - lastLeakTime;</span><br><span class="line">        <span class="type">long</span> <span class="variable">leaks</span> <span class="operator">=</span> elapsed / leakRateMillis;</span><br><span class="line">        <span class="keyword">if</span> (leaks &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            water = Math.max(<span class="number">0</span>, water - leaks);</span><br><span class="line">            lastLeakTime = now;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ä»¤ç‰Œæ¡¶ç®—æ³•ï¼ˆå…è®¸çªå‘æµé‡ï¼‰"><a href="#ä»¤ç‰Œæ¡¶ç®—æ³•ï¼ˆå…è®¸çªå‘æµé‡ï¼‰" class="headerlink" title="ä»¤ç‰Œæ¡¶ç®—æ³•ï¼ˆå…è®¸çªå‘æµé‡ï¼‰"></a>ä»¤ç‰Œæ¡¶ç®—æ³•ï¼ˆå…è®¸çªå‘æµé‡ï¼‰</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenBucketLimiter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> capacity;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> tokens;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> lastRefillTime;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">double</span> refillRate; <span class="comment">// ä»¤ç‰Œ/æ¯«ç§’</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TokenBucketLimiter</span><span class="params">(<span class="type">long</span> capacity, <span class="type">double</span> refillPerSecond)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">        <span class="built_in">this</span>.refillRate = refillPerSecond / <span class="number">1000.0</span>;</span><br><span class="line">        <span class="built_in">this</span>.tokens = capacity;</span><br><span class="line">        <span class="built_in">this</span>.lastRefillTime = System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">boolean</span> <span class="title function_">allow</span><span class="params">()</span> &#123;</span><br><span class="line">        refillTokens();</span><br><span class="line">        <span class="keyword">if</span> (tokens &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">            tokens--;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">refillTokens</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">double</span> <span class="variable">elapsed</span> <span class="operator">=</span> now - lastRefillTime;</span><br><span class="line">        tokens = Math.min(capacity, tokens + elapsed * refillRate);</span><br><span class="line">        lastRefillTime = now;</span><br><span class="line">    </span><br></pre></td></tr></table></figure><h4 id="ä¸šç•Œé™æµå·¥å…·"><a href="#ä¸šç•Œé™æµå·¥å…·" class="headerlink" title="ä¸šç•Œé™æµå·¥å…·"></a>ä¸šç•Œé™æµå·¥å…·</h4><h5 id="å•æœºé™æµ"><a href="#å•æœºé™æµ" class="headerlink" title="å•æœºé™æµ"></a>å•æœºé™æµ</h5><ul><li><p><strong>Guava RateLimiter</strong></p><ul><li>åŸºäºä»¤ç‰Œæ¡¶ï¼Œæ”¯æŒé¢„çƒ­æ¨¡å¼ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RateLimiter</span> <span class="variable">limiter</span> <span class="operator">=</span> RateLimiter.create(<span class="number">10.0</span>); <span class="comment">// æ¯ç§’10ä¸ªè¯·æ±‚</span></span><br><span class="line"><span class="keyword">if</span> (limiter.tryAcquire()) &#123;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œä¸šåŠ¡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="åˆ†å¸ƒå¼é™æµ"><a href="#åˆ†å¸ƒå¼é™æµ" class="headerlink" title="åˆ†å¸ƒå¼é™æµ"></a>åˆ†å¸ƒå¼é™æµ</h5><ul><li><p><strong>Redis Cell</strong></p><ul><li>é€šè¿‡ <code>CL.THROTTLE</code> å‘½ä»¤å®ç°æ¼æ¡¶ç®—æ³•ã€‚</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CL.THROTTLE user123 15 30 60 1</span><br><span class="line"><span class="comment"># å«ä¹‰ï¼š15å®¹é‡ï¼Œ30ç§’å†…60ä¸ªè¯·æ±‚ï¼Œ1æ¬¡è¯·æ±‚</span></span><br></pre></td></tr></table></figure></li><li><p><strong>Sentinel</strong>ï¼ˆé˜¿é‡Œå¼€æºï¼‰</p><ul><li>æ”¯æŒQPS&#x2F;çº¿ç¨‹æ•°é™æµã€ç³»ç»Ÿè‡ªé€‚åº”ä¿æŠ¤ã€å®æ—¶ç›‘æ§ã€‚</li><li>é›†æˆDubbo&#x2F;Spring Cloud&#x2F;Gatewayã€‚</li></ul></li><li><p><strong>Resilience4j</strong></p><ul><li>è½»é‡çº§å®¹é”™åº“ï¼Œæä¾›é™æµã€ç†”æ–­ç­‰åŠŸèƒ½ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RateLimiter</span> <span class="variable">limiter</span> <span class="operator">=</span> RateLimiter.of(<span class="string">&quot;serviceA&quot;</span>, RateLimiterConfig.custom()</span><br><span class="line">    .limitForPeriod(<span class="number">100</span>)</span><br><span class="line">    .limitRefreshPeriod(Duration.ofSeconds(<span class="number">1</span>))</span><br><span class="line">    .build());</span><br></pre></td></tr></table></figure></li></ul><h5 id="ç½‘å…³å±‚é™æµ"><a href="#ç½‘å…³å±‚é™æµ" class="headerlink" title="ç½‘å…³å±‚é™æµ"></a>ç½‘å…³å±‚é™æµ</h5><ul><li><p><strong>Spring Cloud Gateway</strong></p><ul><li>å†…ç½®RedisRateLimiterã€‚</li></ul></li><li><p><strong>Nginx</strong></p><ul><li><p>é€šè¿‡ <code>limit_req_zone</code> å®ç°æ¼æ¡¶ç®—æ³•ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">limit_req_zone</span> <span class="variable">$binary_remote_addr</span> zone=api:<span class="number">10m</span> rate=10r/s;</span><br><span class="line"><span class="section">location</span> /api &#123;</span><br><span class="line">    <span class="attribute">limit_req</span> zone=api burst=<span class="number">20</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><p><strong>é€‰å‹å»ºè®®</strong></p><table><thead><tr><th align="left">åœºæ™¯</th><th align="left">æ¨èæ–¹æ¡ˆ</th></tr></thead><tbody><tr><td align="left">å•æœºé™æµ</td><td align="left">Guava RateLimiter</td></tr><tr><td align="left">åˆ†å¸ƒå¼æœåŠ¡é™æµ</td><td align="left">Sentinel &#x2F; Resilience4j</td></tr><tr><td align="left">APIç½‘å…³å±‚é™æµ</td><td align="left">Nginx &#x2F; Spring Cloud Gateway</td></tr><tr><td align="left">é«˜ç²¾åº¦åˆ†å¸ƒå¼é™æµ</td><td align="left">Redis + Lua</td></tr></tbody></table><h3 id="é™çº§-ç†”æ–­"><a href="#é™çº§-ç†”æ–­" class="headerlink" title="é™çº§&amp;ç†”æ–­"></a>é™çº§&amp;ç†”æ–­</h3><h1 id="DevOps"><a href="#DevOps" class="headerlink" title="DevOps"></a>DevOps</h1><h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><h2 id="CI-CD"><a href="#CI-CD" class="headerlink" title="CI&#x2F;CD"></a>CI&#x2F;CD</h2><h1 id="å·¥å…·ç±»åº“"><a href="#å·¥å…·ç±»åº“" class="headerlink" title="å·¥å…·ç±»åº“"></a>å·¥å…·ç±»åº“</h1><h2 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h2><h2 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h2><p>Maven æ˜¯ä¸€ä¸ª <strong>é¡¹ç›®ç®¡ç†å’Œæ„å»ºå·¥å…·</strong>ï¼Œä¸»è¦ç”¨äº Java é¡¹ç›®çš„ä¾èµ–ç®¡ç†ã€æ„å»ºè‡ªåŠ¨åŒ–ä»¥åŠé¡¹ç›®ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p><h3 id="ä¾èµ–èŒƒå›´"><a href="#ä¾èµ–èŒƒå›´" class="headerlink" title="ä¾èµ–èŒƒå›´"></a>ä¾èµ–èŒƒå›´</h3><table><thead><tr><th>ä¾èµ–èŒƒå›´</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>compile</code></td><td><code>scope</code>å…ƒç´ çš„ç¼ºçœå€¼ã€‚ç¼–è¯‘ã€æµ‹è¯•ã€è¿è¡Œé˜¶æ®µéƒ½ä¼šå¼•å…¥</td></tr><tr><td><code>test</code></td><td>æµ‹è¯•é˜¶æ®µå¼•å…¥</td></tr><tr><td><code>provided</code></td><td>ç¼–è¯‘ã€æµ‹è¯•é˜¶æ®µå¼•å…¥</td></tr><tr><td><code>runtime</code></td><td>æµ‹è¯•ã€è¿è¡Œé˜¶æ®µå¼•å…¥</td></tr><tr><td><code>system</code></td><td>ç”¨äºæ·»åŠ æœ¬åœ°ä¾èµ–ï¼Œä¸æ¨èä½¿ç”¨</td></tr><tr><td><code>import</code></td><td>ä¸ <code>dependencyManagement</code> å…ƒç´ é…åˆä½¿â½¤ï¼Œå…¶åŠŸèƒ½æ˜¯å°†â½¬æ ‡ <code>pom.xml</code> â½‚ä»¶ä¸­ <code>dependencyManagement</code> çš„é…ç½®å¯¼â¼Šåˆå¹¶åˆ°å½“å‰ <code>pom.xml</code> çš„ <code>dependencyManagement</code> ä¸­</td></tr></tbody></table><h3 id="ä¾èµ–ä¼ é€’"><a href="#ä¾èµ–ä¼ é€’" class="headerlink" title="ä¾èµ–ä¼ é€’"></a>ä¾èµ–ä¼ é€’</h3><p>æœ‰ä¸‰ä¸ªæ¨¡å—Aã€Bã€Cï¼ŒAä¾èµ–Bï¼ŒBä¾èµ–Cï¼ŒCæ˜¯å¦èƒ½ä¼ é€’åˆ°Aï¼Œå–å†³äºBä¾èµ–Cæ—¶ä½¿ç”¨çš„ä¾èµ–èŒƒå›´å’Œé…ç½®ã€‚</p><ul><li><code>compile</code>æˆ–<code>runtime</code>ä¾èµ–å¯ä»¥ä¼ é€’ï¼Œå…¶ä»–ä¾èµ–èŒƒå›´ä¸èƒ½ä¼ é€’</li></ul><img src="/post/65a5b0d7/image-20241201105858259.png" class="" title="compileä¾èµ–"><img src="/post/65a5b0d7/image-20241201110755516.png" class="" title="runtimeä¾èµ–"><img src="/post/65a5b0d7/image-20241201110400431.png" class="" title="testä¾èµ–"><img src="/post/65a5b0d7/image-20241201110500022.png" class="" title="providedä¾èµ–"><ul><li><code>optional</code>ä¸º<code>true</code>çš„ä¾èµ–ä¸èƒ½ä¼ é€’</li></ul><img src="/post/65a5b0d7/image-20241201111836452.png" class="" title="optionalä¾èµ–"><h3 id="ä¾èµ–å†²çª"><a href="#ä¾èµ–å†²çª" class="headerlink" title="ä¾èµ–å†²çª"></a>ä¾èµ–å†²çª</h3><p>å½“ç›´æ¥å’Œé—´æ¥å¼•ç”¨äº†åŒä¸€ä¸ªä¾èµ–ï¼Œæœ€ç»ˆçš„ä¾èµ–ç‰ˆæœ¬å–å†³äºä¾èµ–çš„è·¯å¾„å’Œé¡ºåºã€‚</p><ul><li>æœ€çŸ­è·¯å¾„åŸåˆ™</li></ul><p>åœ¨ä¸‹é¢çš„æˆªå›¾ä¸­ï¼Œ<code>A</code>åˆ°<code>jackson-bind</code>æœ‰ä¸¤æ¡ä¾èµ–è·¯å¾„<code>A-&gt;B-&gt;C-&gt;jackson-databind</code>å’Œ<code>A-&gt;jackson-databind</code>ï¼Œæ ¹æ®æœ€çŸ­è·¯å¾„åŸåˆ™ï¼Œæœ€ç»ˆ<code>A</code>ä¼šä¾èµ–<code>jackson-databind</code>çš„<code>2.15.0</code>ç‰ˆæœ¬</p><img src="/post/65a5b0d7/image-20241201113454944.png" class="" title="æœ€çŸ­è·¯å¾„åŸåˆ™"><ul><li>å£°æ˜é¡ºåºåŸåˆ™</li></ul><p>åœ¨ä¸‹é¢æˆªå›¾ä¸­ï¼Œ<code>A</code>åˆ°<code>jackson-bind</code>çš„ä¾èµ–è·¯å¾„åŒ…æ‹¬<code>A-&gt;B-&gt;jackson-databind</code>å’Œ<code>A-&gt;C-&gt;jsckson-databind</code>ï¼Œä¾èµ–è·¯å¾„é•¿åº¦ä¸€æ ·ï¼Œæ‰€ä»¥æœ€çŸ­è·¯å¾„ä¾èµ–åŸåˆ™ä¸é€‚ç”¨ã€‚æ­¤æ—¶å°±éœ€è¦æ ¹æ®<code>B</code>å’Œ<code>C</code>çš„å£°æ˜é¡ºåºæ¥å†³å®š<code>jackson-databind</code>çš„ä¾èµ–ç‰ˆæœ¬ã€‚</p><img src="/post/65a5b0d7/image-20241201113752360-3024301.png" class="" title="Bå£°æ˜åœ¨å…ˆ"><img src="/post/65a5b0d7/image-20241201114225143.png" class="" title="Cå£°æ˜åœ¨å…ˆ"><h1 id="è®¡ç®—æœºåŸºç¡€"><a href="#è®¡ç®—æœºåŸºç¡€" class="headerlink" title="è®¡ç®—æœºåŸºç¡€"></a>è®¡ç®—æœºåŸºç¡€</h1><h2 id="æ“ä½œç³»ç»Ÿ"><a href="#æ“ä½œç³»ç»Ÿ" class="headerlink" title="æ“ä½œç³»ç»Ÿ"></a>æ“ä½œç³»ç»Ÿ</h2><ol><li>ç”¨æˆ·æ€ä¸å†…æ ¸æ€åˆ‡æ¢çš„å¼€é”€æ¥æºï¼Ÿ</li><li>è¿›ç¨‹é—´é€šä¿¡IPCçš„5ç§æ–¹å¼å¯¹æ¯”</li><li>è™šæ‹Ÿå†…å­˜ä¸ç‰©ç†å†…å­˜æ˜ å°„åŸç†ï¼ˆé¡µè¡¨å¯»å€ï¼‰</li><li>æ­»é”çš„å¿…è¦æ¡ä»¶åŠé“¶è¡Œå®¶ç®—æ³•å®ç°</li><li>è‡ªæ—‹é”ä¸äº’æ–¥é”çš„ä½¿ç”¨åœºæ™¯å·®å¼‚</li><li>é›¶æ‹·è´æŠ€æœ¯å®ç°åŸç†ï¼ˆsendfile&#x2F;mmapï¼‰</li><li>å­¤å„¿è¿›ç¨‹ä¸åƒµå°¸è¿›ç¨‹çš„åŒºåˆ«åŠå¤„ç†</li><li>CPUè½¯ä¸­æ–­ä¸ç¡¬ä¸­æ–­å¤„ç†æœºåˆ¶</li><li>å¦‚ä½•ç”¨topå‘½ä»¤åˆ†æCPUè´Ÿè½½å¼‚å¸¸ï¼Ÿ</li><li>å†…å­˜æ³„æ¼ä¸å†…å­˜æº¢å‡ºçš„å®šä½æ–¹æ³•</li><li>å¤§é¡µå†…å­˜ï¼ˆHugePageï¼‰ä¼˜åŒ–åŸç†</li><li>åç¨‹ä¸çº¿ç¨‹çš„è°ƒåº¦æ•ˆç‡å·®å¼‚</li><li>æ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰è€—å°½å¦‚ä½•å¤„ç†ï¼Ÿ</li><li>CPUç¼“å­˜è¡Œä¼ªå…±äº«é—®é¢˜è§£å†³æ–¹æ¡ˆ</li><li>NUMAæ¶æ„ä¸‹çš„æ€§èƒ½è°ƒä¼˜è¦ç‚¹</li><li>ç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹è¯¦è§£ï¼ˆint 0x80&#x2F;syscallï¼‰</li><li>å®æ—¶æ“ä½œç³»ç»Ÿä¸éå®æ—¶ç³»ç»Ÿçš„è°ƒåº¦å·®å¼‚</li><li>å®¹å™¨ä¸è™šæ‹Ÿæœºçš„èµ„æºéš”ç¦»åŸç†å¯¹æ¯”</li><li>å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„çº¿ç¨‹æ± ï¼Ÿ</li><li>ç³»ç»Ÿå¹³å‡è´Ÿè½½ï¼ˆLoad Averageï¼‰çš„æ·±å±‚å«ä¹‰</li></ol><h2 id="è®¡ç®—æœºç½‘ç»œ"><a href="#è®¡ç®—æœºç½‘ç»œ" class="headerlink" title="è®¡ç®—æœºç½‘ç»œ"></a>è®¡ç®—æœºç½‘ç»œ</h2><ol><li>TCPä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹çš„çŠ¶æ€å˜è¿å›¾</li><li>TIME_WAITçŠ¶æ€è¿‡å¤šå¦‚ä½•ä¼˜åŒ–ï¼Ÿ</li><li>HTTPSåŒå‘è®¤è¯æµç¨‹ä¸ä¸­é—´äººæ”»å‡»é˜²èŒƒ</li><li>QUICåè®®å¦‚ä½•è§£å†³é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼Ÿ</li><li>TCPæ‹¥å¡æ§åˆ¶ç®—æ³•ï¼ˆCUBIC&#x2F;BBRï¼‰</li><li>HTTP&#x2F;2å¤šè·¯å¤ç”¨ä¸é˜Ÿå¤´é˜»å¡è§£å†³æ–¹æ¡ˆ</li><li>Websocketæ¡æ‰‹åè®®ä¸å¿ƒè·³æœºåˆ¶å®ç°</li><li>DNSè§£æè¿‡ç¨‹ï¼ˆé€’å½’æŸ¥è¯¢ä¸è¿­ä»£æŸ¥è¯¢ï¼‰</li><li>CDNåŠ¨æ€åŠ é€Ÿä¸é™æ€åŠ é€ŸæŠ€æœ¯åŸç†</li><li>å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘è¿æ¥çš„æœåŠ¡ç«¯ï¼Ÿ</li><li>é•¿è¿æ¥ä¿æ´»ç­–ç•¥ï¼ˆTCP Keepalive vs åº”ç”¨å±‚å¿ƒè·³ï¼‰</li><li>ç½‘ç»œæŠ“åŒ…åˆ†æå®æˆ˜ï¼ˆWiresharkè¿‡æ»¤æŠ€å·§ï¼‰</li><li>å•æœºç™¾ä¸‡è¿æ¥çš„å®ç°ä¸ä¼˜åŒ–</li><li>HTTP Rangeè¯·æ±‚ä¸æ–­ç‚¹ç»­ä¼ å®ç°</li><li>5å±‚åè®®æ ˆä¸­æ¯å±‚çš„å…¸å‹è®¾å¤‡</li><li>VLANä¸VXLANçš„åŒºåˆ«åŠä½¿ç”¨åœºæ™¯</li><li>å¦‚ä½•å®ç°UDPå¯é ä¼ è¾“ï¼Ÿ</li><li>MTUä¸MSSçš„å…³ç³»åŠåˆ†ç‰‡é—®é¢˜</li><li>SYN Floodæ”»å‡»åŸç†ä¸é˜²å¾¡æ–¹æ¡ˆ</li><li>TLS1.3ç›¸æ¯”1.2çš„æ ¸å¿ƒæ”¹è¿›ç‚¹</li></ol><h2 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h2><h3 id="å€™é€‰ç "><a href="#å€™é€‰ç " class="headerlink" title="å€™é€‰ç "></a>å€™é€‰ç </h3><p>å…³ç³»æ¨¡å¼ä¸­ï¼Œèƒ½å¤Ÿå”¯ä¸€æ ‡è¯†æ¯ä¸€è¡Œæ•°æ®çš„æœ€å°å±æ€§é›†ã€‚åœ¨å¤šä¸ªå€™é€‰ç ä¸­ï¼Œå¯ä»¥é€‰æ‹©ä¸€ä¸ªä½œä¸ºè¡¨çš„ä¸»é”®ï¼ˆPrimary Keyï¼‰ï¼Œä¸€ä¸ªå…³ç³»åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ã€‚</p><h3 id="å‡½æ•°ä¾èµ–"><a href="#å‡½æ•°ä¾èµ–" class="headerlink" title="å‡½æ•°ä¾èµ–"></a>å‡½æ•°ä¾èµ–</h3><p>ç»™å®šå…³ç³»æ¨¡å¼Rï¼Œå¦‚æœå±æ€§é›†Xçš„å€¼ç¡®å®šå±æ€§é›†Yçš„å€¼ï¼Œåˆ™æˆYä¾èµ–äºXï¼Œè®°ä½œï¼šXâ†’Yã€‚</p><p>å¯¹äºXâ†’Yï¼Œå¦‚æœå­˜åœ¨Xçš„çœŸå­é›†ä½¿å¾—Xâ€™â†’Yï¼Œé‚£ä¹ˆXâ†’Yå°±æ˜¯éƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼Œå¦åˆ™å°±æ˜¯å®Œå…¨å‡½æ•°ä¾èµ–ã€‚</p><p>å¦‚æœXâ†’Yï¼ŒYâ†’Zï¼Œé‚£ä¹ˆXâ†’Zå°±æ˜¯ä¼ é€’å‡½æ•°ä¾èµ–ã€‚</p><h3 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h3><p>å‡è®¾æœ‰ä¸€ä¸ªå­¦ç”Ÿè¯¾ç¨‹å…³ç³»æ¨¡å¼å¦‚ä¸‹ï¼š</p><table><thead><tr><th>Sno</th><th>Sname</th><th>Sdept</th><th>Mname</th><th>Cname</th><th>Grade</th></tr></thead><tbody><tr><td>1</td><td>å­¦ç”Ÿ-1</td><td>å­¦é™¢-1</td><td>é™¢é•¿-1</td><td>è¯¾ç¨‹-1</td><td>90</td></tr><tr><td>2</td><td>å­¦ç”Ÿ-2</td><td>å­¦é™¢-2</td><td>é™¢é•¿-2</td><td>è¯¾ç¨‹-2</td><td>80</td></tr><tr><td>2</td><td>å­¦ç”Ÿ-2</td><td>å­¦é™¢-2</td><td>é™¢é•¿-2</td><td>è¯¾ç¨‹-1</td><td>100</td></tr><tr><td>3</td><td>å­¦ç”Ÿ-3</td><td>å­¦é™¢-2</td><td>é™¢é•¿-2</td><td>è¯¾ç¨‹-2</td><td>95</td></tr></tbody></table><p>å¯ä»¥çœ‹å‡ºè¿™ä¸ªå…³ç³»æ¨¡å¼çš„å€™é€‰ç æ˜¯{Sno, Cname}ï¼Œå› ä¸º{Sno, Cname}æ˜¯å¯ä»¥å”¯ä¸€æ ‡è¯†æ¯ä¸€è¡Œæ•°æ®çš„æœ€å°æ•°æ®é›†ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªä¸ç¬¦åˆèŒƒå¼çš„å…³ç³»æ¨¡å¼ï¼Œå­˜åœ¨å¦‚ä¸‹å¼‚å¸¸ï¼š</p><ul><li>æ•°æ®å†—ä½™ï¼šä¾‹å¦‚å­¦ç”Ÿ-2ã€è¯¾ç¨‹-1ã€è¯¾ç¨‹-2éƒ½å‡ºç°äº†å¤šæ¬¡</li><li>æ’å…¥å¼‚å¸¸ï¼šå¦‚æœå…³ç³»æ¨¡å¼è¦æ±‚è¯¾ç¨‹ä¸èƒ½ä¸ºç©ºï¼Œé‚£ä¹ˆåœ¨å­¦ç”Ÿå°šæœªé€‰è¯¾çš„æƒ…å†µä¸‹å°±æ— æ³•å•ç‹¬æ’å…¥å­¦ç”Ÿæ•°æ®</li><li>ä¿®æ”¹å¼‚å¸¸ï¼šå‡ºç°å¤šæ¬¡çš„æ•°æ®åªä¿®æ”¹äº†å…¶ä¸­ä¸€éƒ¨åˆ†ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´</li><li>åˆ é™¤å¼‚å¸¸ï¼šä¾‹å¦‚åˆ é™¤æ‰€æœ‰è¯¾ç¨‹-1ç›¸å…³æ•°æ®ä¼šå¯¼è‡´å­¦ç”Ÿ-1ä¿¡æ¯ä¸¢å¤±</li></ul><h3 id="èŒƒå¼vsåèŒƒå¼"><a href="#èŒƒå¼vsåèŒƒå¼" class="headerlink" title="èŒƒå¼vsåèŒƒå¼"></a>èŒƒå¼vsåèŒƒå¼</h3><p>ä¸ºäº†è§£å†³ä¸Šé¢æåˆ°çš„è¿™äº›å¼‚å¸¸ï¼Œå…³ç³»æ¨¡å¼çš„è®¾è®¡å°±éœ€è¦è§„èŒƒåŒ–ã€‚</p><p><strong>ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰</strong>ï¼šå±æ€§ä¸å¯åˆ†å‰²ï¼Œå³æ¯ä¸ªå±æ€§éƒ½æ˜¯ä¸å¯åˆ†å‰²çš„åŸå­é¡¹ã€‚</p><p><strong>ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰</strong>ï¼šæ»¡è¶³ç¬¬ä¸€èŒƒå¼ï¼Œä¸”ä¸å­˜åœ¨éƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼Œå³ä»»æ„éä¸»å±æ€§å®Œå…¨ä¾èµ–äºä¸»é”®ã€‚</p><p><strong>ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰</strong>ï¼šæ»¡è¶³ç¬¬äºŒèŒƒå¼ï¼Œä¸”ä¸å­˜åœ¨ä¼ é€’å‡½æ•°ä¾èµ–ï¼Œå³ä»»æ„éä¸»å±æ€§ç›´æ¥ä¾èµ–äºä¸»é”®ã€‚</p><p><strong>åèŒƒå¼</strong>ï¼šå®Œå…¨éµå¾ªèŒƒå¼çš„æ•°æ®åº“è®¾è®¡å¯èƒ½æ€§èƒ½è¾ƒå·®ï¼Œå› ä¸ºéœ€è¦å¤§é‡çš„è¿è¡¨æŸ¥è¯¢ã€‚åèŒƒå¼æ˜¯ç‰ºç‰²éƒ¨åˆ†èŒƒå¼ä»¥æé«˜æ€§èƒ½çš„ä¸€ç§è®¾è®¡æ–¹å¼ï¼Œå…·ä½“æœ‰ä»¥ä¸‹æ–¹å¼ï¼š</p><ul><li>å¢åŠ å†—ä½™åˆ—ï¼šåœ¨å¤šä¸ªè¡¨ä¸­å…·æœ‰ç›¸åŒçš„åˆ—ï¼Œé€šå¸¸ç”¨æ¥é¿å…æŸ¥è¯¢æ—¶çš„è¿è¡¨æ“ä½œã€‚</li><li>å¢åŠ æ´¾ç”Ÿåˆ—ï¼šå¢åŠ çš„åˆ—å¯ä»¥é€šè¿‡è¡¨ä¸­å…¶ä»–æ•°æ®è®¡ç®—èƒœåœºï¼Œä½œç”¨æ˜¯å‡å°‘æŸ¥è¯¢æ—¶çš„è®¡ç®—é‡ï¼Œä»è€ŒåŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚</li><li>é‡æ–°ç»„è¡¨ï¼šå¦‚æœè®¸å¤šç”¨æˆ·éœ€è¦æŸ¥çœ‹ä¸¤ä¸ªè¡¨è¿æ¥å‡ºæ¥çš„ç»“æœæ•°æ®ï¼Œåˆ™æŠŠè¿™ä¸¤ä¸ªè¡¨é‡æ–°ç»„æˆä¸€ä¸ªè¡¨æ¥å‡å°‘è¿æ¥ä»è€Œæé«˜æ€§èƒ½ã€‚</li><li>åˆ†å‰²è¡¨ï¼šå‚ç›´åˆ†å‰²ã€æ°´å¹³åˆ†å‰²</li></ul><p>å¾ˆæ˜¾ç„¶ï¼Œç‰ºç‰²èŒƒå¼ä»¥æé«˜æ€§èƒ½çš„åèŒƒå¼è®¾è®¡ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œå¦‚ï¼š</p><ul><li>æ•°æ®å†—ä½™ï¼Œæµªè´¹å­˜å‚¨ç©ºé—´</li><li>æ•°æ®ä¸ä¸€è‡´</li><li>å¢ã€åˆ ã€æ”¹æ•ˆç‡é™ä½</li><li>å¯èƒ½å¯¼è‡´æ’å…¥å¼‚å¸¸ã€åˆ é™¤å¼‚å¸¸ã€ä¿®æ”¹å¼‚å¸¸</li></ul><p>å› æ­¤åœ¨å®é™…çš„è®¾è®¡ä¸­ï¼Œéœ€è¦æ ¹æ®å…·ä½“åº”ç”¨åœºæ™¯è¿›è¡Œæƒè¡¡ã€‚</p><h1 id="æ€ç»´é€»è¾‘"><a href="#æ€ç»´é€»è¾‘" class="headerlink" title="æ€ç»´é€»è¾‘"></a>æ€ç»´é€»è¾‘</h1><h2 id="å°ç™½é¼ è¯•æ¯’è¯"><a href="#å°ç™½é¼ è¯•æ¯’è¯" class="headerlink" title="å°ç™½é¼ è¯•æ¯’è¯"></a>å°ç™½é¼ è¯•æ¯’è¯</h2><h2 id="100ä¸ªäººæŒ‰ç¯"><a href="#100ä¸ªäººæŒ‰ç¯" class="headerlink" title="100ä¸ªäººæŒ‰ç¯"></a>100ä¸ªäººæŒ‰ç¯</h2><blockquote><p>æœ‰100ç›ç¯,ç¼–å·ä¾æ¬¡ä¸º1,2,3â€¦100,ç”µç¯å…¨éƒ¨å…³ç€ã€‚ç°åœ¨æ¥äº†100ä¸ªäºº,ç¬¬ä¸€ä¸ªäººæŠŠæ‰€æœ‰çš„ç¯å¼€å…³æŒ‰ä¸‹ï¼›ç¬¬äºŒä¸ªäººéš”ä¸€ä¸ªç¯æŒ‰ä¸‹ï¼ˆ2,4,6â€¦ï¼‰ï¼›ç¬¬ä¸‰ä¸ªäººæ¯éš”ä¸¤ä¸ªç¯æŒ‰ä¸‹ï¼ˆ3,6,9â€¦ï¼‰.ç¬¬100ä¸ªäººéš”99ä¸ªç¯æŒ‰ä¸‹ï¼ˆ100ï¼‰,æœ€åè¿˜æœ‰å‡ ç›ç¯ï¼Œé‚£å‡ ç›ç¯äº®ç€ï¼Ÿ</p></blockquote><h2 id="100çš„é˜¶ä¹˜æœ‰å‡ ä¸ª0"><a href="#100çš„é˜¶ä¹˜æœ‰å‡ ä¸ª0" class="headerlink" title="100çš„é˜¶ä¹˜æœ‰å‡ ä¸ª0"></a>100çš„é˜¶ä¹˜æœ‰å‡ ä¸ª0</h2><p>100çš„é˜¶ä¹˜ï¼ˆ100!ï¼‰æœ‰å¤šå°‘ä¸ªæœ«å°¾çš„é›¶ï¼Œå¯ä»¥é€šè¿‡è®¡ç®—å…¶å› å¼åˆ†è§£ä¸­10çš„å› å­ä¸ªæ•°æ¥ç¡®å®šï¼Œå› ä¸ºæœ«å°¾çš„é›¶æ˜¯ç”±2å’Œ5ç›¸ä¹˜å¾—åˆ°çš„ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†100!è¿›è¡Œå› å¼åˆ†è§£ã€‚100!è¡¨ç¤ºä»1ä¹˜åˆ°100çš„è¿ç»­æ•´æ•°çš„ä¹˜ç§¯ï¼Œå¯ä»¥å†™æˆï¼š</p><p>100! &#x3D; 1 Ã— 2 Ã— 3 Ã— 4 Ã— â€¦ Ã— 99 Ã— 100</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è§‚å¯Ÿä¹˜æ³•ä¸­æ¯ä¸€é¡¹çš„å› å­ä¸­2å’Œ5çš„ä¸ªæ•°ã€‚</p><p>åœ¨100!ä¸­ï¼Œå¶æ•°çš„å› å­2çš„ä¸ªæ•°æ˜æ˜¾æ¯”5å¤šï¼Œå› ä¸ºæ¯éš”ä¸€ä¸ªæ•°å°±ä¼šæœ‰ä¸€ä¸ªå¶æ•°å‡ºç°ï¼Œè€Œå¶æ•°éƒ½åŒ…å«å› å­2ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨100!ä¸­5çš„å› å­ä¸ªæ•°ã€‚</p><p>åœ¨100!ä¸­ï¼Œ5ã€10ã€15ã€20ã€â€¦ã€95ã€100è¿™äº›æ•°éƒ½åŒ…å«å› å­5ï¼Œå…±æœ‰20ä¸ªæ•°ã€‚è€Œ25ã€50ã€75ã€100è¿™äº›æ•°åŒ…å«ä¸¤ä¸ªå› å­5ï¼Œæ‰€ä»¥éœ€è¦å°†å…¶è®¡ç®—åœ¨å†…ã€‚</p><p>å› æ­¤ï¼Œ100!ä¸­æ€»å…±æœ‰20 + 4 &#x3D; 24ä¸ªå› å­5ã€‚</p><p>ç»¼ä¸Šæ‰€è¿°ï¼Œ100!æœ«å°¾å…±æœ‰24ä¸ªé›¶ã€‚</p><h2 id="ç”¨å¤©å¹³æ‰¾æœ€è½»-é‡çš„çƒ"><a href="#ç”¨å¤©å¹³æ‰¾æœ€è½»-é‡çš„çƒ" class="headerlink" title="ç”¨å¤©å¹³æ‰¾æœ€è½»&#x2F;é‡çš„çƒ"></a>ç”¨å¤©å¹³æ‰¾æœ€è½»&#x2F;é‡çš„çƒ</h2><blockquote><p>8ä¸ªçƒï¼Œä¸€ä¸ªè½»ï¼Œå¤©å¹³2æ¬¡æ‰¾å‡ºæ¥</p></blockquote><p>ç¬¬ä¸€æ¬¡ç§°é‡ï¼šå°†ä»»æ„ä¸‰ä¸ªçƒæ”¾åœ¨å¤©å¹³çš„ä¸€è¾¹ï¼Œå†å°†å¦å¤–ä¸‰ä¸ªçƒæ”¾åœ¨å¦ä¸€è¾¹ï¼Œå‰©ä¸‹çš„ä¸¤ä¸ªçƒä¸æ”¾åœ¨å¤©å¹³ä¸Šã€‚å¦‚æœå¤©å¹³å¹³è¡¡ï¼Œåˆ™è½»çš„çƒåœ¨å‰©ä¸‹çš„ä¸¤ä¸ªçƒä¸­ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ç›®æµ‹æˆ–è€…æ‰‹æ„Ÿæ¥æ‰¾å‡ºè½»çš„çƒã€‚å¦‚æœå¤©å¹³ä¸å¹³è¡¡ï¼Œé‚£ä¹ˆè½»çš„çƒä¸€å®šåœ¨è½»çš„é‚£ä¸€è¾¹ã€‚</p><p>ç¬¬äºŒæ¬¡ç§°é‡ï¼šå°†è½»çš„é‚£ä¸€è¾¹çš„ä¸‰ä¸ªçƒä¸­çš„ä¸¤ä¸ªçƒæ”¾åœ¨å¤©å¹³çš„ä¸€è¾¹ï¼Œå°†å‰©ä¸‹çš„ä¸€ä¸ªçƒæ”¾åœ¨å¦ä¸€è¾¹ã€‚å¦‚æœå¤©å¹³å¹³è¡¡ï¼Œåˆ™å‰©ä¸‹çš„é‚£ä¸ªçƒå°±æ˜¯è½»çš„çƒï¼›å¦‚æœå¤©å¹³ä¸å¹³è¡¡ï¼Œé‚£ä¹ˆè½»çš„çƒå°±æ˜¯è½»çš„é‚£ä¸€è¾¹çš„çƒã€‚</p><h2 id="2017çš„2017-æ¬¡æ–¹çš„æœ€åä¸€ä½æ•°"><a href="#2017çš„2017-æ¬¡æ–¹çš„æœ€åä¸€ä½æ•°" class="headerlink" title="2017çš„2017 æ¬¡æ–¹çš„æœ€åä¸€ä½æ•°"></a>2017çš„2017 æ¬¡æ–¹çš„æœ€åä¸€ä½æ•°</h2><p>è®¡ç®—2017çš„2017æ¬¡æ–¹çš„æœ€åä¸€ä½æ•°ï¼Œå¯ä»¥ä½¿ç”¨æ•°è®ºä¸­çš„æ•°å­¦æ€§è´¨æ¥ç®€åŒ–è®¡ç®—ã€‚æ ¹æ®æ•°å­¦æ€§è´¨ï¼Œä¸€ä¸ªæ•´æ•°çš„æœ«ä½æ•°åªå’Œè¯¥æ•´æ•°çš„ä¸ªä½æ•°æœ‰å…³ï¼Œè€Œä¸å…¶ä»–ä½æ•°æ— å…³ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬è§‚å¯Ÿ2017çš„ä¸ªä½æ•°æ˜¯ä»€ä¹ˆã€‚2017é™¤ä»¥10çš„ä½™æ•°æ˜¯7ï¼Œå› æ­¤2017çš„ä¸ªä½æ•°æ˜¯7ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è§‚å¯Ÿ7çš„å¹‚çš„ä¸ªä½æ•°çš„è§„å¾‹ã€‚æˆ‘ä»¬å¯ä»¥åˆ—ä¸¾ä¸€äº›7çš„å¹‚ï¼Œçœ‹çœ‹ä¸ªä½æ•°çš„å˜åŒ–ï¼š</p><p>7^1 &#x3D; 7 7^2 &#x3D; 49 7^3 &#x3D; 343 7^4 &#x3D; 2401 7^5 &#x3D; 16807 â€¦</p><p>å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œ7çš„å¹‚çš„ä¸ªä½æ•°ä¼šåœ¨7ã€9ã€3ã€1è¿™å››ä¸ªæ•°å­—ä¹‹é—´å¾ªç¯ã€‚å…·ä½“åœ°ï¼Œ7^1çš„ä¸ªä½æ•°æ˜¯7ï¼Œ7^2çš„ä¸ªä½æ•°æ˜¯9ï¼Œ7^3çš„ä¸ªä½æ•°æ˜¯3ï¼Œ7^4çš„ä¸ªä½æ•°æ˜¯1ï¼Œ7^5çš„ä¸ªä½æ•°åˆæ˜¯7ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªè§„å¾‹æ¥ç®€åŒ–è®¡ç®—2017çš„2017æ¬¡æ–¹çš„ä¸ªä½æ•°ã€‚2017é™¤ä»¥4çš„ä½™æ•°æ˜¯1ï¼Œæ‰€ä»¥2017çš„2017æ¬¡æ–¹çš„ä¸ªä½æ•°ä¹Ÿæ˜¯1ã€‚</p><p>ç»¼ä¸Šæ‰€è¿°ï¼Œ2017çš„2017æ¬¡æ–¹çš„æœ€åä¸€ä½æ•°æ˜¯1ã€‚</p><h2 id="25åŒ¹é©¬ï¼Œ5ä¸ªè·‘é“ï¼Œæœ€å°‘æ¯”å¤šå°‘æ¬¡èƒ½æ¯”å‡ºå‰3å"><a href="#25åŒ¹é©¬ï¼Œ5ä¸ªè·‘é“ï¼Œæœ€å°‘æ¯”å¤šå°‘æ¬¡èƒ½æ¯”å‡ºå‰3å" class="headerlink" title="25åŒ¹é©¬ï¼Œ5ä¸ªè·‘é“ï¼Œæœ€å°‘æ¯”å¤šå°‘æ¬¡èƒ½æ¯”å‡ºå‰3å"></a>25åŒ¹é©¬ï¼Œ5ä¸ªè·‘é“ï¼Œæœ€å°‘æ¯”å¤šå°‘æ¬¡èƒ½æ¯”å‡ºå‰3å</h2><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å‚è€ƒä»£ç </title>
      <link href="/post/5cb37524.html"/>
      <url>/post/5cb37524.html</url>
      
        <content type="html"><![CDATA[<h1 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h1><h2 id="è·å–è¯·æ±‚è·¯å¾„ä¸Šçš„å‚æ•°"><a href="#è·å–è¯·æ±‚è·¯å¾„ä¸Šçš„å‚æ•°" class="headerlink" title="è·å–è¯·æ±‚è·¯å¾„ä¸Šçš„å‚æ•°"></a>è·å–è¯·æ±‚è·¯å¾„ä¸Šçš„å‚æ•°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserContextInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> Map&lt;String, String&gt; pathVariables = (Map&lt;String, String&gt;) request.getAttribute(</span><br><span class="line">                HandlerMapping.URI_TEMPLATE_VARIABLES_ATTRIBUTE);</span><br><span class="line">        <span class="type">var</span> <span class="variable">projectId</span> <span class="operator">=</span> pathVariables.get(<span class="string">&quot;project_id&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="streamæ“ä½œ"><a href="#streamæ“ä½œ" class="headerlink" title="streamæ“ä½œ"></a><code>stream</code>æ“ä½œ</h2><ul><li><code>List&lt;String&gt;</code>è½¬<code>Map&lt;String, List&lt;String&gt;&gt;</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Map&lt;String, List&lt;String&gt;&gt; <span class="title function_">list2Map</span><span class="params">(List&lt;String&gt; locations)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> locations.stream()</span><br><span class="line">        .map(s -&gt; s.split(<span class="string">&quot;:&quot;</span>))</span><br><span class="line">        .collect(Collectors.groupingBy(a -&gt; a[<span class="number">0</span>],</span><br><span class="line">            Collectors.mapping(a -&gt; a[<span class="number">1</span>], Collectors.toList())));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ—¥æœŸæ“ä½œ"><a href="#æ—¥æœŸæ“ä½œ" class="headerlink" title="æ—¥æœŸæ“ä½œ"></a>æ—¥æœŸæ“ä½œ</h2><ul><li><code>Date</code>è½¬<code>LocalDateTime</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> LocalDateTime <span class="title function_">asLocalDateTime</span><span class="params">(Date date)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> date.toInstant().atZone(ZoneId.systemDefault()).toLocalDateTime();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å«è¯­å¥"><a href="#å«è¯­å¥" class="headerlink" title="å«è¯­å¥"></a>å«è¯­å¥</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å«è¯­å¥ç”¨äºæ£€æŸ¥æŸäº›å‰ç½®æ¡ä»¶ï¼Œå¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼Œç›´æ¥è¿”å›æˆ–æŠ›å‡ºå¼‚å¸¸ï¼Œé¿å…ç»§ç»­æ‰§è¡Œåç»­çš„ä»£ç å—ã€‚</span></span><br><span class="line"><span class="comment"> * é€šè¿‡ä½¿ç”¨å«è¯­å¥ï¼Œå¯ä»¥å‡å°‘ä»£ç çš„åµŒå¥—ç¨‹åº¦ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> str</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(String str)</span> &#123;</span><br><span class="line">    <span class="comment">// æ£€æŸ¥è®¢å•æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">    <span class="keyword">if</span> (str == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>; <span class="comment">// ä½¿ç”¨å«è¯­å¥ç›´æ¥è¿”å›</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥è®¢å•çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span> (str.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span>; <span class="comment">// ä½¿ç”¨å«è¯­å¥ç›´æ¥è¿”å›</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰§è¡Œè®¢å•å¤„ç†é€»è¾‘</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»Ÿä¸€è¿”å›ç»“æ„"><a href="#ç»Ÿä¸€è¿”å›ç»“æ„" class="headerlink" title="ç»Ÿä¸€è¿”å›ç»“æ„"></a>ç»Ÿä¸€è¿”å›ç»“æ„</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IResult</span> &#123;</span><br><span class="line"></span><br><span class="line">    Integer <span class="title function_">getCode</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">getMessage</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><span id="more"></span><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ResultEnum</span> <span class="keyword">implements</span> <span class="title class_">IResult</span> &#123;</span><br><span class="line"></span><br><span class="line">    SUCCESS(<span class="number">2001</span>, <span class="string">&quot;æ¥å£è°ƒç”¨æˆåŠŸ&quot;</span>),</span><br><span class="line"></span><br><span class="line">    FAILED(<span class="number">2002</span>, <span class="string">&quot;æ¥å£è°ƒç”¨å¤±è´¥&quot;</span>),</span><br><span class="line"></span><br><span class="line">    VALIDATE_FAILED(<span class="number">2003</span>, <span class="string">&quot;å‚æ•°æ ¡éªŒå¤±è´¥&quot;</span>),</span><br><span class="line"></span><br><span class="line">    FORBIDDEN(<span class="number">2004</span>, <span class="string">&quot;ç¦æ­¢è®¿é—®&quot;</span>)</span><br><span class="line"></span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String message;</span><br><span class="line"></span><br><span class="line">    ResultEnum(Integer code, String message) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">success</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>&lt;&gt;(ResultEnum.SUCCESS.getCode(), ResultEnum.SUCCESS.getMessage(), data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">success</span><span class="params">(String message, T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>&lt;&gt;(ResultEnum.SUCCESS.getCode(), message, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result&lt;?&gt; failed() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>&lt;&gt;(ResultEnum.FAILED.getCode(), ResultEnum.FAILED.getMessage(), <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result&lt;?&gt; failed(String message) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>&lt;&gt;(ResultEnum.FAILED.getCode(), message, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result&lt;?&gt; failed(IResult result) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>&lt;&gt;(result.getCode(), result.getMessage(), <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;world&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">helloWorld</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success(<span class="string">&quot;Hello, World!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;java&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">helloJava</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success(<span class="string">&quot;Hello, Java!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æ‰€æœ‰æ¥å£çš„è¿”å›ç»“æ„éƒ½ç»Ÿä¸€äº†ï¼Œä½†æ¯ä¸ªæ¥å£éƒ½è¦å†™ä¸Šå°è£…çš„é€»è¾‘ä¹Ÿæ˜¯ä¸€é¡¹å¾ˆé‡å¤çš„å·¥ä½œï¼Œå¯ä»¥é€šè¿‡å®ç°<code>ResponseBodyAdvice</code>å¯¹ç»“æœç»Ÿä¸€åŒ…è£…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice(basePackages = &quot;com.tw.codesnippet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponseAdvice</span> <span class="keyword">implements</span> <span class="title class_">ResponseBodyAdvice</span>&lt;Object&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(MethodParameter returnType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; converterType)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">beforeBodyWrite</span><span class="params">(Object body, MethodParameter returnType, MediaType selectedContentType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; selectedConverterType, ServerHttpRequest request, ServerHttpResponse response)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (body <span class="keyword">instanceof</span> Result) &#123;</span><br><span class="line">            <span class="keyword">return</span> body;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.success(body);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶Controllerå±‚çš„ä»£ç å°±å¯ä»¥ç®€åŒ–å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;world&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">helloWorld</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, World!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;java&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">helloJava</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, Python!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†å¦‚æœè°ƒç”¨ä¸Šé¢çš„æ¥å£ä¼šæŠ›å‡ºå¦‚ä¸‹å¼‚å¸¸<code>Result cannot be cast to class java.lang.String</code>ï¼Œdebugå¯ä»¥å‘ç°ï¼Œå¦‚æœæ¥å£çš„è¿”å›å€¼æ˜¯Stringç±»å‹ï¼Œ<code>beforeBodyWrite</code>çš„<code>selectedConverterType</code>ä½¿ç”¨çš„æ˜¯<code>StringHttpMessageConverter</code>ï¼Œè€Œæ¥å£æ˜¯å…¶ä»–ç±»å‹è¿”å›å€¼æ—¶<code>selectedConverterType</code>ä½¿ç”¨çš„åˆ™æ˜¯<code>MappingJackson2HttpMessageConverter</code>ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç½‘ä¸Šçš„è§£å†³åŠæ³•æ˜¯æ·»åŠ ä¸€ä¸ª<code>MappingJackson2HttpMessageConverter</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">        converters.add(<span class="number">0</span>, <span class="keyword">new</span> <span class="title class_">MappingJackson2HttpMessageConverter</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†å®é™…è¿è¡Œä¼šå‘ç°ï¼Œ<code>selectedConverterType</code>çš„ç±»å‹ä¾ç„¶æ˜¯<code>StringHttpMessageConverter</code>ï¼Œå…·ä½“åŸå› æ˜¯ï¼šå½“æ¥å£è¿”å›Stringæ—¶ï¼ŒSpringé»˜è®¤ä¼šä¼˜å…ˆä½¿ç”¨<code>StringHttpMessageConverter</code>æ¥å¤„ç†ï¼Œå³ä½¿åœ¨<code>WebConfig</code>é‡Œæ·»åŠ äº†<code>MappingJackson2HttpMessageConverter</code>ã€‚</p><p>è¦è®©Springä½¿ç”¨<code>MappingJackson2HttpMessageConverter</code>æ¥å¤„ç†Stringè¿”å›å€¼å¹¶ç”ŸæˆJSONï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p><ol><li>åˆ é™¤<code>StringHttpMessageConverter</code>ï¼Œç¡®ä¿Springä½¿ç”¨<code>MappingJackson2HttpMessageConverter</code>ä½œä¸ºè½¬æ¢å™¨</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">        converters.removeIf(converter -&gt; converter <span class="keyword">instanceof</span> StringHttpMessageConverter);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>æ˜¾ç¤ºæŒ‡å®š <code>Content-Type</code> å’Œ <code>Accept</code> å¤´</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H <span class="string">&quot;Accept: application/json&quot;</span> http://localhost:8080/hello/world</span><br></pre></td></tr></table></figure><p>åœ¨å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸­æ˜ç¡®æŒ‡å®š <code>Accept: application/json</code>ï¼Œè¿™æ · Spring ä¼šæ ¹æ® <code>Accept</code> å¤´ä½¿ç”¨ <code>MappingJackson2HttpMessageConverter</code> æ¥ç”Ÿæˆ JSON å“åº”ã€‚</p><ol start="3"><li>å¯¹äºStringç±»å‹ï¼Œè®©æ¥å£è¿”å›<code>Result&lt;String&gt;</code></li></ol><h2 id="å­—æ®µæ ¡éªŒ"><a href="#å­—æ®µæ ¡éªŒ" class="headerlink" title="å­—æ®µæ ¡éªŒ"></a>å­—æ®µæ ¡éªŒ</h2><p>JSR303 å®šä¹‰äº† Bean æ ¡éªŒçš„æ ‡å‡† validation-apiï¼Œhibernate validation æ˜¯å¯¹è¿™ä¸ªæ ‡å‡†çš„å®ç°ï¼ŒSpring Validation åˆ™æ˜¯å¯¹ hibernate validation çš„äºŒæ¬¡å°è£…ã€‚</p><h3 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h3><h4 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate.validator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯¹äº web æœåŠ¡æ¥è¯´ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œè¯·æ±‚å‚æ•°åˆ†ä¸ºå¦‚ä¸‹ä¸¤ç§å½¢å¼ï¼š</p><ul><li>GET è¯·æ±‚ï¼Œä½¿ç”¨ <code>@RequestParam</code> å’Œ <code>@PathVariable</code> ä¼ é€’å‚æ•°</li><li>POST å’Œ PUT è¯·æ±‚ï¼Œä½¿ç”¨ <code>@RequestBody</code> ä¼ é€’å‚æ•°</li></ul><h4 id="GET-è¯·æ±‚å‚æ•°æ ¡éªŒ"><a href="#GET-è¯·æ±‚å‚æ•°æ ¡éªŒ" class="headerlink" title="GET è¯·æ±‚å‚æ•°æ ¡éªŒ"></a>GET è¯·æ±‚å‚æ•°æ ¡éªŒ</h4><p>GET è¯·æ±‚ä¸€èˆ¬ç”¨ <code>@RequestParam</code> æˆ– <code>@PathVariable</code>  ä¼ å‚ï¼Œéœ€åœ¨ Controller ä¸ŠåŠ  <code>@Validated</code> æ³¨è§£ï¼Œå¹¶åœ¨æ¥å£å‚æ•°åŠ çº¦æŸæ³¨è§£ï¼Œè‡ªåŠ¨å‚æ•°æ ¡éªŒæ‰èƒ½ç”Ÿæ•ˆã€‚æ ¡éªŒå¤±è´¥ä¼šæŠ›å‡º <code>javax.validation.ConstraintViolationException</code> å¼‚å¸¸ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;user&quot;)</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">getUser</span><span class="params">(<span class="meta">@RequestParam(&quot;userId&quot;)</span> <span class="meta">@NotBlank</span> String userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDTO</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="POST-PUT-è¯·æ±‚å‚æ•°æ ¡éªŒ"><a href="#POST-PUT-è¯·æ±‚å‚æ•°æ ¡éªŒ" class="headerlink" title="POST&#x2F;PUT è¯·æ±‚å‚æ•°æ ¡éªŒ"></a>POST&#x2F;PUT è¯·æ±‚å‚æ•°æ ¡éªŒ</h4><p>POST æˆ– PUT è¯·æ±‚ä¸€èˆ¬ç”¨ <code>@RequestBody</code> ä¼ å‚ï¼Œåç«¯ä½¿ç”¨ DTO å¯¹è±¡æ¥æ”¶å‚æ•°ï¼Œåªéœ€è¦åœ¨ DTO å¯¹è±¡å‰åŠ ä¸Š <code>@Valid</code> æˆ– <code>@Validated</code> æ³¨è§£å°±å¯ä»¥å®ç°è‡ªåŠ¨å‚æ•°æ ¡éªŒï¼Œæ ¡éªŒå¤±è´¥ä¼šæŠ›å‡º <code>org.springframework.web.bind.MethodArgumentNotValidException</code> å¼‚å¸¸ã€‚</p><p>æ¯”å¦‚æœ‰ä¸€ä¸ªä¿å­˜ <code>User</code> çš„æ¥å£ï¼Œè¦æ±‚ <code>username</code> é•¿åº¦æ˜¯ 2-10 ä¸ªå­—ç¬¦ï¼Œ<code>password</code> é•¿åº¦ä¸å°äº 6 ä¸ªå­—ç¬¦</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDTO</span> &#123;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Length(min = 2, max = 10)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="meta">@Length(min = 6, max = 10)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">saveUser</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Validated</span> UserDTO userDTO)</span> &#123; <span class="comment">// ä¹Ÿå¯ä»¥ä½¿ç”¨ @Valid</span></span><br><span class="line">        <span class="keyword">return</span> userDTO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç»Ÿä¸€å¼‚å¸¸å¤„ç†"><a href="#ç»Ÿä¸€å¼‚å¸¸å¤„ç†" class="headerlink" title="ç»Ÿä¸€å¼‚å¸¸å¤„ç†"></a>ç»Ÿä¸€å¼‚å¸¸å¤„ç†</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice(&quot;com.tw.codesnippet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonExceptionAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.OK)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">handleMethodArgumentNotValidException</span><span class="params">(MethodArgumentNotValidException ex)</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">BindingResult</span> <span class="variable">bindingResult</span> <span class="operator">=</span> ex.getBindingResult();</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> bindingResult.getFieldError().getField() + <span class="string">&quot;:&quot;</span> + bindingResult.getFieldError().getDefaultMessage();</span><br><span class="line">        <span class="keyword">return</span> Result.failed(ResultEnum.VALIDATE_FAILED.getCode(), msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(ConstraintViolationException.class)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.OK)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">handleConstraintViolationException</span><span class="params">(ConstraintViolationException ex)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.failed(ResultEnum.VALIDATE_FAILED.getCode(), ex.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è¿›é˜¶"><a href="#è¿›é˜¶" class="headerlink" title="è¿›é˜¶"></a>è¿›é˜¶</h3><h4 id="åˆ†ç»„æ ¡éªŒ"><a href="#åˆ†ç»„æ ¡éªŒ" class="headerlink" title="åˆ†ç»„æ ¡éªŒ"></a>åˆ†ç»„æ ¡éªŒ</h4><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œå­˜åœ¨å¤šä¸ªæ¥å£ä½¿ç”¨åŒä¸€ä¸ªDTOæ¥æ¥å£å‚æ•°çš„æƒ…å†µï¼Œè€Œä¸åŒçš„æ¥å£éœ€è¦æ ¡éªŒçš„å­—æ®µä»¥åŠè§„åˆ™å¯èƒ½ä¸ä¸€æ ·ï¼Œè¿™æ—¶åœ¨DTOçš„å­—æ®µä¸Šç¬¼ç»Ÿåœ°åŠ ä¸Šçº¦æŸæ³¨è§£æ— æ³•è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚ä¸ºæ­¤ï¼ŒSpring Validationæä¾›äº†åˆ†ç»„æ ¡éªŒåŠŸèƒ½ã€‚</p><p>è¿˜æ˜¯ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œä¿å­˜<code>User</code>æ—¶ï¼Œ<code>userId</code>å¯ä»¥ä¸ºç©ºï¼Œä½†æ˜¯æ›´æ–°æ—¶ï¼Œ<code>userId</code>ä¸å…è®¸ä¸ºç©ºã€‚</p><ul><li>DTOå­—æ®µä¸Šçš„çº¦æŸæ³¨è§£æŒ‡å®šåˆ†ç»„</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDTO</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(groups = Update.class)</span></span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(groups = &#123;Save.class, Update.class&#125;)</span></span><br><span class="line">    <span class="meta">@Length(min = 2, max = 10, groups = &#123;Save.class, Update.class&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(groups = &#123;Save.class, Update.class&#125;)</span></span><br><span class="line">    <span class="meta">@Length(min = 6, max = 10, groups = &#123;Save.class, Update.class&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Save</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Update</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ¥å£å‚æ•°çš„<code>@Validated</code>æ³¨è§£æŒ‡å®šåˆ†ç»„</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;user&quot;)</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">saveUser</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Validated(UserDTO.Save.class)</span> UserDTO userDTO)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userDTO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;update&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> UserDTO <span class="title function_">updateUser</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Validated(UserDTO.Update.class)</span> UserDTO userDTO)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userDTO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>PSï¼šæ­¤æ—¶ä¸èƒ½ä½¿ç”¨<code>@Valid</code>æ³¨è§£ï¼Œå› ä¸º<code>@Valid</code>ä¸å…·æœ‰åˆ†ç»„æ ¡éªŒåŠŸèƒ½</p><h4 id="åµŒå¥—æ ¡éªŒ"><a href="#åµŒå¥—æ ¡éªŒ" class="headerlink" title="åµŒå¥—æ ¡éªŒ"></a>åµŒå¥—æ ¡éªŒ</h4><p>å¦‚æœDTOçš„æŸä¸ªå­—æ®µæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¦è‡ªåŠ¨æ ¡éªŒè¿™ä¸ªå¯¹è±¡çš„å±æ€§ï¼Œå°±å¾—ç”¨åˆ°åµŒå¥—æ ¡éªŒã€‚</p><ul><li>åœ¨DTOå¯¹è±¡å­—æ®µåŠ ä¸Š<code>@Valid</code>æ³¨è§£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDTO</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(groups = Update.class)</span></span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(groups = &#123;Save.class, Update.class&#125;)</span></span><br><span class="line">    <span class="meta">@Length(min = 2, max = 10, groups = &#123;Save.class, Update.class&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(groups = &#123;Save.class, Update.class&#125;)</span></span><br><span class="line">    <span class="meta">@Length(min = 6, max = 10, groups = &#123;Save.class, Update.class&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull(groups = &#123;Save.class, Update.class&#125;)</span></span><br><span class="line">    <span class="meta">@Valid</span></span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@NotBlank(groups = &#123;Save.class, Update.class&#125;)</span></span><br><span class="line">        <span class="keyword">private</span> String country;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@NotBlank(groups = &#123;Save.class, Update.class&#125;)</span></span><br><span class="line">        <span class="keyword">private</span> String state;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@NotBlank(groups = &#123;Save.class, Update.class&#125;)</span></span><br><span class="line">        <span class="keyword">private</span> String city;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@NotBlank(groups = &#123;Save.class, Update.class&#125;)</span></span><br><span class="line">        <span class="keyword">private</span> String street;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Save</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Update</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰æ ¡éªŒ"><a href="#è‡ªå®šä¹‰æ ¡éªŒ" class="headerlink" title="è‡ªå®šä¹‰æ ¡éªŒ"></a>è‡ªå®šä¹‰æ ¡éªŒ</h4><p>æœ‰æ—¶æ¡†æ¶æä¾›çš„æ ¡éªŒæ— æ³•æ»¡è¶³ä¸šåŠ¡å¤æ‚çš„æ ¡éªŒéœ€æ±‚ï¼Œæ­¤æ—¶å¯ä»¥è‡ªå®šä¹‰æ ¡éªŒæ³¨è§£ã€‚</p><ul><li>è‡ªå®šä¹‰æ³¨è§£</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.PARAMETER&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Constraint(validatedBy = PhoneValidator.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Phone &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">message</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;æ— æ•ˆçš„æ‰‹æœºå·&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Payload</span>&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å®ç°è‡ªå®šä¹‰æ ¡éªŒå™¨</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PhoneValidator</span> <span class="keyword">implements</span> <span class="title class_">ConstraintValidator</span>&lt;Phone, String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Pattern</span> <span class="variable">PHONE_PATTERN</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;^1[3-9]\\d&#123;9&#125;$&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String value, ConstraintValidatorContext context)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> PHONE_PATTERN.matcher(value).matches();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><h2 id="æ‰¹é‡æ›´æ–°æ—¶é—´"><a href="#æ‰¹é‡æ›´æ–°æ—¶é—´" class="headerlink" title="æ‰¹é‡æ›´æ–°æ—¶é—´"></a>æ‰¹é‡æ›´æ–°æ—¶é—´</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UPDATE user_operate_record</span><br><span class="line">SET create_time = DATE_ADD(&#x27;2023-04-01 00:00:00&#x27;, INTERVAL FLOOR(RAND() * 31536000) SECOND);</span><br></pre></td></tr></table></figure><h2 id="æ‰¹é‡æ’å…¥æ•°æ®"><a href="#æ‰¹é‡æ’å…¥æ•°æ®" class="headerlink" title="æ‰¹é‡æ’å…¥æ•°æ®"></a>æ‰¹é‡æ’å…¥æ•°æ®</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">DROP PROCEDURE IF EXISTS BatchInsert;</span><br><span class="line">delimiter $$</span><br><span class="line">CREATE PROCEDURE BatchInsert(IN loop_counts INT)</span><br><span class="line">BEGIN</span><br><span class="line">DECLARE Var LONG;</span><br><span class="line">SET Var = 0;</span><br><span class="line">SET autocommit = 0;</span><br><span class="line">WHILE Var &lt; loop_counts DO</span><br><span class="line">INSERT INTO `user_operate_record` (`iam_id`, `tenant_id`, `region`, `operate_type`, `operate_module`, `module_id`, `input_param`, `output_param`, `create_time`, `is_system`)</span><br><span class="line">VALUES (&#x27;4b98e1d72c214f72af1fa55cfcb5ecf8&#x27;, &#x27;afc4784e64d146549764787876c60856&#x27;, &#x27;cn-north-7&#x27;, &#x27;read&#x27;, &#x27;template&#x27;, &#x27;cb1069e0278144d8f49976285e1efe68&#x27;, null, null, &#x27;2023-05-30 00:00:00&#x27;, 1);</span><br><span class="line">SET Var = Var + 1;</span><br><span class="line">END WHILE;</span><br><span class="line">COMMIT;</span><br><span class="line">END$$;</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br><span class="line">CALL BatchInsert(200000);</span><br></pre></td></tr></table></figure><h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="RedisTemplateåºåˆ—åŒ–"><a href="#RedisTemplateåºåˆ—åŒ–" class="headerlink" title="RedisTemplateåºåˆ—åŒ–"></a>RedisTemplateåºåˆ—åŒ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> &#123;</span><br><span class="line">    RedisTemplate&lt;String, Object&gt; redisTemplate = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">    redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="type">StringRedisSerializer</span> <span class="variable">stringRedisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line">    redisTemplate.setKeySerializer(stringRedisSerializer);</span><br><span class="line">    redisTemplate.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">    objectMapper.activateDefaultTyping(LaissezFaireSubTypeValidator.instance, ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.PROPERTY);</span><br><span class="line">    jackson2JsonRedisSerializer.setObjectMapper(objectMapper);</span><br><span class="line"></span><br><span class="line">    redisTemplate.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">    redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line"></span><br><span class="line">    redisTemplate.afterPropertiesSet();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> redisTemplate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>SQLè¿›é˜¶æ•™ç¨‹</title>
      <link href="/post/ee5ab589.html"/>
      <url>/post/ee5ab589.html</url>
      
        <content type="html"><![CDATA[<h2 id="CASE-è¡¨è¾¾å¼"><a href="#CASE-è¡¨è¾¾å¼" class="headerlink" title="CASE è¡¨è¾¾å¼"></a><code>CASE</code> è¡¨è¾¾å¼</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç®€å• case è¡¨è¾¾å¼</span></span><br><span class="line"><span class="keyword">CASE</span> sex</span><br><span class="line"><span class="keyword">WHEN</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;ç”·&#x27;</span></span><br><span class="line"><span class="keyword">WHEN</span> <span class="string">&#x27;2&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;å¥³&#x27;</span></span><br><span class="line"><span class="keyword">ELSE</span> <span class="string">&#x27;å…¶ä»–&#x27;</span> <span class="keyword">END</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æœç´¢ case è¡¨è¾¾å¼</span></span><br><span class="line"><span class="keyword">CASE</span> <span class="keyword">WHEN</span> sex <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;ç”·&#x27;</span></span><br><span class="line"> <span class="keyword">WHEN</span> sex <span class="operator">=</span> <span class="string">&#x27;2&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;å¥³&#x27;</span></span><br><span class="line"><span class="keyword">ELSE</span> <span class="string">&#x27;å…¶ä»–&#x27;</span> <span class="keyword">END</span></span><br></pre></td></tr></table></figure><p>æ•°æ®å‡†å¤‡</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `PopTbl` (</span><br><span class="line">  `pref_name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `population` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`pref_name`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl <span class="keyword">VALUES</span>(<span class="string">&#x27;å¾·å²›&#x27;</span>, <span class="number">100</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl <span class="keyword">VALUES</span>(<span class="string">&#x27;é¦™å·&#x27;</span>, <span class="number">200</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl <span class="keyword">VALUES</span>(<span class="string">&#x27;çˆ±åª›&#x27;</span>, <span class="number">150</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl <span class="keyword">VALUES</span>(<span class="string">&#x27;é«˜çŸ¥&#x27;</span>, <span class="number">200</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl <span class="keyword">VALUES</span>(<span class="string">&#x27;ç¦å†ˆ&#x27;</span>, <span class="number">300</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl <span class="keyword">VALUES</span>(<span class="string">&#x27;ä½è´º&#x27;</span>, <span class="number">100</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl <span class="keyword">VALUES</span>(<span class="string">&#x27;é•¿å´&#x27;</span>, <span class="number">200</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl <span class="keyword">VALUES</span>(<span class="string">&#x27;ä¸œäº¬&#x27;</span>, <span class="number">400</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl <span class="keyword">VALUES</span>(<span class="string">&#x27;ç¾¤é©¬&#x27;</span>, <span class="number">50</span>);</span><br></pre></td></tr></table></figure><h3 id="ç»ƒä¹ 1ï¼šç»Ÿè®¡ä¸åŒåœ°åŒºçš„äººå£æ€»æ•°"><a href="#ç»ƒä¹ 1ï¼šç»Ÿè®¡ä¸åŒåœ°åŒºçš„äººå£æ€»æ•°" class="headerlink" title="ç»ƒä¹ 1ï¼šç»Ÿè®¡ä¸åŒåœ°åŒºçš„äººå£æ€»æ•°"></a>ç»ƒä¹ 1ï¼šç»Ÿè®¡ä¸åŒåœ°åŒºçš„äººå£æ€»æ•°</h3><p>è¯´æ˜ï¼šå¾·å²›ã€é¦™å·ã€çˆ±åª›ã€é«˜çŸ¥å½’ä¸ºå››å›½åœ°åŒºï¼Œç¦å†ˆã€ä½è´ºã€é•¿å´å½’ä¸ºä¹å·åœ°åŒºï¼Œå‰©ä¸‹çš„å½’ä¸ºå…¶ä»–ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line">pref_name </span><br><span class="line"><span class="keyword">WHEN</span> <span class="string">&#x27;å¾·å²›&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;å››å›½&#x27;</span> </span><br><span class="line"><span class="keyword">WHEN</span> <span class="string">&#x27;é¦™å·&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;å››å›½&#x27;</span> </span><br><span class="line"><span class="keyword">WHEN</span> <span class="string">&#x27;çˆ±åª›&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;å››å›½&#x27;</span> </span><br><span class="line"><span class="keyword">WHEN</span> <span class="string">&#x27;é«˜çŸ¥&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;å››å›½&#x27;</span> </span><br><span class="line"><span class="keyword">WHEN</span> <span class="string">&#x27;ç¦å†ˆ&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;ä¹å·&#x27;</span> </span><br><span class="line"><span class="keyword">WHEN</span> <span class="string">&#x27;ä½è´º&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;ä¹å·&#x27;</span> </span><br><span class="line"><span class="keyword">WHEN</span> <span class="string">&#x27;é•¿å´&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;ä¹å·&#x27;</span> </span><br><span class="line"><span class="keyword">ELSE</span> <span class="string">&#x27;å…¶ä»–&#x27;</span> </span><br><span class="line"><span class="keyword">END</span> <span class="keyword">AS</span> district,</span><br><span class="line"><span class="built_in">SUM</span>( population ) </span><br><span class="line"><span class="keyword">FROM</span> PopTbl </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> district; # ä¸¥æ ¼æ¥è®²ï¼Œè¿™é‡Œä½¿ç”¨districtæ˜¯ä¸è§„èŒƒçš„ï¼Œå› ä¸º<span class="keyword">group</span> <span class="keyword">by</span>å…ˆäº<span class="keyword">select</span>æ‰§è¡Œ</span><br></pre></td></tr></table></figure><h3 id="ç»ƒä¹ 2ï¼šç»Ÿè®¡ä¸åŒäººå£ç­‰çº§çš„å¿åºœä¸ªæ•°"><a href="#ç»ƒä¹ 2ï¼šç»Ÿè®¡ä¸åŒäººå£ç­‰çº§çš„å¿åºœä¸ªæ•°" class="headerlink" title="ç»ƒä¹ 2ï¼šç»Ÿè®¡ä¸åŒäººå£ç­‰çº§çš„å¿åºœä¸ªæ•°"></a>ç»ƒä¹ 2ï¼šç»Ÿè®¡ä¸åŒäººå£ç­‰çº§çš„å¿åºœä¸ªæ•°</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line"><span class="keyword">WHEN</span> population <span class="operator">&lt;</span> <span class="number">100</span> <span class="keyword">THEN</span> <span class="string">&#x27;01&#x27;</span></span><br><span class="line"><span class="keyword">WHEN</span> population <span class="operator">&lt;</span> <span class="number">200</span> <span class="keyword">THEN</span> <span class="string">&#x27;02&#x27;</span></span><br><span class="line"><span class="keyword">WHEN</span> population <span class="operator">&lt;</span> <span class="number">300</span> <span class="keyword">THEN</span> <span class="string">&#x27;03&#x27;</span></span><br><span class="line"><span class="keyword">WHEN</span> population <span class="operator">&gt;=</span> <span class="number">300</span> <span class="keyword">THEN</span> <span class="string">&#x27;04&#x27;</span></span><br><span class="line"><span class="keyword">ELSE</span> <span class="keyword">NULL</span> <span class="keyword">END</span> <span class="keyword">AS</span> pop_class,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> cnt</span><br><span class="line"><span class="keyword">FROM</span> PopTbl</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> pop_class;</span><br></pre></td></tr></table></figure><p>æ•°æ®å‡†å¤‡</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> PopTbl2</span><br><span class="line">(pref_name <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line"> sex <span class="type">CHAR</span>(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> population <span class="type">INTEGER</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY(pref_name, sex));</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl2 <span class="keyword">VALUES</span>(<span class="string">&#x27;å¾·å²›&#x27;</span>, <span class="string">&#x27;1&#x27;</span>,<span class="number">60</span> );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl2 <span class="keyword">VALUES</span>(<span class="string">&#x27;å¾·å²›&#x27;</span>, <span class="string">&#x27;2&#x27;</span>,<span class="number">40</span> );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl2 <span class="keyword">VALUES</span>(<span class="string">&#x27;é¦™å·&#x27;</span>, <span class="string">&#x27;1&#x27;</span>,<span class="number">100</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl2 <span class="keyword">VALUES</span>(<span class="string">&#x27;é¦™å·&#x27;</span>, <span class="string">&#x27;2&#x27;</span>,<span class="number">100</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl2 <span class="keyword">VALUES</span>(<span class="string">&#x27;çˆ±åª›&#x27;</span>, <span class="string">&#x27;1&#x27;</span>,<span class="number">100</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl2 <span class="keyword">VALUES</span>(<span class="string">&#x27;çˆ±åª›&#x27;</span>, <span class="string">&#x27;2&#x27;</span>,<span class="number">50</span> );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl2 <span class="keyword">VALUES</span>(<span class="string">&#x27;é«˜çŸ¥&#x27;</span>, <span class="string">&#x27;1&#x27;</span>,<span class="number">100</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl2 <span class="keyword">VALUES</span>(<span class="string">&#x27;é«˜çŸ¥&#x27;</span>, <span class="string">&#x27;2&#x27;</span>,<span class="number">100</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl2 <span class="keyword">VALUES</span>(<span class="string">&#x27;ç¦å†ˆ&#x27;</span>, <span class="string">&#x27;1&#x27;</span>,<span class="number">100</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl2 <span class="keyword">VALUES</span>(<span class="string">&#x27;ç¦å†ˆ&#x27;</span>, <span class="string">&#x27;2&#x27;</span>,<span class="number">200</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl2 <span class="keyword">VALUES</span>(<span class="string">&#x27;ä½è´º&#x27;</span>, <span class="string">&#x27;1&#x27;</span>,<span class="number">20</span> );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl2 <span class="keyword">VALUES</span>(<span class="string">&#x27;ä½è´º&#x27;</span>, <span class="string">&#x27;2&#x27;</span>,<span class="number">80</span> );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl2 <span class="keyword">VALUES</span>(<span class="string">&#x27;é•¿å´&#x27;</span>, <span class="string">&#x27;1&#x27;</span>,<span class="number">125</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl2 <span class="keyword">VALUES</span>(<span class="string">&#x27;é•¿å´&#x27;</span>, <span class="string">&#x27;2&#x27;</span>,<span class="number">125</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl2 <span class="keyword">VALUES</span>(<span class="string">&#x27;ä¸œäº¬&#x27;</span>, <span class="string">&#x27;1&#x27;</span>,<span class="number">250</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PopTbl2 <span class="keyword">VALUES</span>(<span class="string">&#x27;ä¸œäº¬&#x27;</span>, <span class="string">&#x27;2&#x27;</span>,<span class="number">150</span>);</span><br></pre></td></tr></table></figure><h3 id="ç»ƒä¹ 3ï¼šç»Ÿè®¡å„å¿ç”·å¥³äººæ•°"><a href="#ç»ƒä¹ 3ï¼šç»Ÿè®¡å„å¿ç”·å¥³äººæ•°" class="headerlink" title="ç»ƒä¹ 3ï¼šç»Ÿè®¡å„å¿ç”·å¥³äººæ•°"></a>ç»ƒä¹ 3ï¼šç»Ÿè®¡å„å¿ç”·å¥³äººæ•°</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> pref_name,</span><br><span class="line">       <span class="comment">-- ç”·æ€§äººå£</span></span><br><span class="line">       <span class="built_in">SUM</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> sex<span class="operator">=</span><span class="string">&#x27;1&#x27;</span> <span class="keyword">THEN</span> population <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">AS</span> cnt_m,</span><br><span class="line">       <span class="comment">-- å¥³æ€§äººå£</span></span><br><span class="line">       <span class="built_in">SUM</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> sex<span class="operator">=</span><span class="string">&#x27;2&#x27;</span> <span class="keyword">THEN</span> population <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="keyword">AS</span> cnt_f</span><br><span class="line"><span class="keyword">FROM</span> PopTbl2</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> pref_name;</span><br></pre></td></tr></table></figure><h3 id="ç»ƒä¹ 4ï¼šæŒ‰æ¡ä»¶æ›´æ–°è–ªèµ„"><a href="#ç»ƒä¹ 4ï¼šæŒ‰æ¡ä»¶æ›´æ–°è–ªèµ„" class="headerlink" title="ç»ƒä¹ 4ï¼šæŒ‰æ¡ä»¶æ›´æ–°è–ªèµ„"></a>ç»ƒä¹ 4ï¼šæŒ‰æ¡ä»¶æ›´æ–°è–ªèµ„</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `Salaries` (</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `salary` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`name`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `Salaries` (`name`, `salary`) <span class="keyword">VALUES</span> (<span class="string">&#x27;æœ¨æ‘&#x27;</span>, <span class="number">220000</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `Salaries` (`name`, `salary`) <span class="keyword">VALUES</span> (<span class="string">&#x27;ç›¸ç”°&#x27;</span>, <span class="number">270000</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `Salaries` (`name`, `salary`) <span class="keyword">VALUES</span> (<span class="string">&#x27;ç¥å´&#x27;</span>, <span class="number">324000</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `Salaries` (`name`, `salary`) <span class="keyword">VALUES</span> (<span class="string">&#x27;é½è—¤&#x27;</span>, <span class="number">348000</span>);</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> Salaries </span><br><span class="line"><span class="keyword">SET</span> salary <span class="operator">=</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">300000</span> <span class="keyword">THEN</span> salary <span class="operator">*</span> <span class="number">0.9</span></span><br><span class="line">  <span class="keyword">WHEN</span> salary <span class="operator">&gt;=</span> <span class="number">250000</span> <span class="keyword">AND</span> salary <span class="operator">&lt;</span> <span class="number">2800000</span> <span class="keyword">THEN</span> salary <span class="operator">*</span> <span class="number">1.2</span></span><br><span class="line">      <span class="keyword">ELSE</span> salary <span class="keyword">END</span>;</span><br></pre></td></tr></table></figure><h3 id="ç»ƒä¹ 5ï¼šè°ƒæ¢å­—æ®µçš„å€¼"><a href="#ç»ƒä¹ 5ï¼šè°ƒæ¢å­—æ®µçš„å€¼" class="headerlink" title="ç»ƒä¹ 5ï¼šè°ƒæ¢å­—æ®µçš„å€¼"></a>ç»ƒä¹ 5ï¼šè°ƒæ¢å­—æ®µçš„å€¼</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> tb </span><br><span class="line"><span class="keyword">SET</span> p_key <span class="operator">=</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> p_key <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;b&#x27;</span></span><br><span class="line"> <span class="keyword">WHEN</span> p_key <span class="operator">=</span> <span class="string">&#x27;b&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;a&#x27;</span></span><br><span class="line"> <span class="keyword">ELSE</span> p_key <span class="keyword">END</span></span><br><span class="line"><span class="keyword">WHERE</span> p_key <span class="keyword">IN</span> (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="ç»ƒä¹ 6ï¼šç»Ÿè®¡æ¯ä¸ªæœˆå¼€è®¾çš„è¯¾ç¨‹"><a href="#ç»ƒä¹ 6ï¼šç»Ÿè®¡æ¯ä¸ªæœˆå¼€è®¾çš„è¯¾ç¨‹" class="headerlink" title="ç»ƒä¹ 6ï¼šç»Ÿè®¡æ¯ä¸ªæœˆå¼€è®¾çš„è¯¾ç¨‹"></a>ç»ƒä¹ 6ï¼šç»Ÿè®¡æ¯ä¸ªæœˆå¼€è®¾çš„è¯¾ç¨‹</h3><p>æ•°æ®å‡†å¤‡</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> CourseMaster</span><br><span class="line">(course_id   <span class="type">INTEGER</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line"> course_name <span class="type">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> CourseMaster <span class="keyword">VALUES</span>(<span class="number">1</span>, <span class="string">&#x27;ä¼šè®¡å…¥é—¨&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> CourseMaster <span class="keyword">VALUES</span>(<span class="number">2</span>, <span class="string">&#x27;è´¢åŠ¡çŸ¥è¯†&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> CourseMaster <span class="keyword">VALUES</span>(<span class="number">3</span>, <span class="string">&#x27;ç°¿è®°è€ƒè¯•&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> CourseMaster <span class="keyword">VALUES</span>(<span class="number">4</span>, <span class="string">&#x27;ç¨åŠ¡å¸ˆ&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> OpenCourses</span><br><span class="line">(<span class="keyword">month</span>       <span class="type">INTEGER</span> ,</span><br><span class="line"> course_id   <span class="type">INTEGER</span> ,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY(<span class="keyword">month</span>, course_id));</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> OpenCourses <span class="keyword">VALUES</span>(<span class="number">200706</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> OpenCourses <span class="keyword">VALUES</span>(<span class="number">200706</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> OpenCourses <span class="keyword">VALUES</span>(<span class="number">200706</span>, <span class="number">4</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> OpenCourses <span class="keyword">VALUES</span>(<span class="number">200707</span>, <span class="number">4</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> OpenCourses <span class="keyword">VALUES</span>(<span class="number">200708</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> OpenCourses <span class="keyword">VALUES</span>(<span class="number">200708</span>, <span class="number">4</span>);</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> course_name,</span><br><span class="line"><span class="keyword">CASE</span> <span class="keyword">WHEN</span> course_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> course_id <span class="keyword">FROM</span> OpenCourses <span class="keyword">WHERE</span> <span class="keyword">month</span><span class="operator">=</span><span class="number">200706</span>) <span class="keyword">THEN</span> <span class="string">&#x27;O&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;X&#x27;</span> <span class="keyword">END</span> <span class="keyword">AS</span> <span class="string">&#x27;6æœˆ&#x27;</span>,</span><br><span class="line"><span class="keyword">CASE</span> <span class="keyword">WHEN</span> course_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> course_id <span class="keyword">FROM</span> OpenCourses <span class="keyword">WHERE</span> <span class="keyword">month</span><span class="operator">=</span><span class="number">200707</span>) <span class="keyword">THEN</span> <span class="string">&#x27;O&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;X&#x27;</span> <span class="keyword">END</span> <span class="keyword">AS</span> <span class="string">&#x27;7æœˆ&#x27;</span>,</span><br><span class="line"><span class="keyword">CASE</span> <span class="keyword">WHEN</span> course_id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> course_id <span class="keyword">FROM</span> OpenCourses <span class="keyword">WHERE</span> <span class="keyword">month</span><span class="operator">=</span><span class="number">200708</span>) <span class="keyword">THEN</span> <span class="string">&#x27;O&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;X&#x27;</span> <span class="keyword">END</span> <span class="keyword">AS</span> <span class="string">&#x27;8æœˆ&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> CourseMaster;</span><br></pre></td></tr></table></figure><img src="/post/ee5ab589/image-20250306233843115.png" class="" title="image-20250306233843115"><h3 id="ç»ƒä¹ 7ï¼šåœ¨CASEè¡¨è¾¾å¼ä¸­ä½¿ç”¨èšåˆå‡½æ•°"><a href="#ç»ƒä¹ 7ï¼šåœ¨CASEè¡¨è¾¾å¼ä¸­ä½¿ç”¨èšåˆå‡½æ•°" class="headerlink" title="ç»ƒä¹ 7ï¼šåœ¨CASEè¡¨è¾¾å¼ä¸­ä½¿ç”¨èšåˆå‡½æ•°"></a>ç»ƒä¹ 7ï¼šåœ¨CASEè¡¨è¾¾å¼ä¸­ä½¿ç”¨èšåˆå‡½æ•°</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> StudentClub</span><br><span class="line">(std_id  <span class="type">INTEGER</span>,</span><br><span class="line"> club_id <span class="type">INTEGER</span>,</span><br><span class="line"> club_name <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line"> main_club_flg <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line"> <span class="keyword">PRIMARY</span> KEY (std_id, club_id));</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> StudentClub <span class="keyword">VALUES</span>(<span class="number">100</span>, <span class="number">1</span>, <span class="string">&#x27;æ£’çƒ&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> StudentClub <span class="keyword">VALUES</span>(<span class="number">100</span>, <span class="number">2</span>, <span class="string">&#x27;ç®¡å¼¦ä¹&#x27;</span>, <span class="string">&#x27;N&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> StudentClub <span class="keyword">VALUES</span>(<span class="number">200</span>, <span class="number">2</span>, <span class="string">&#x27;ç®¡å¼¦ä¹&#x27;</span>, <span class="string">&#x27;N&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> StudentClub <span class="keyword">VALUES</span>(<span class="number">200</span>, <span class="number">3</span>, <span class="string">&#x27;ç¾½æ¯›çƒ&#x27;</span>,<span class="string">&#x27;Y&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> StudentClub <span class="keyword">VALUES</span>(<span class="number">200</span>, <span class="number">4</span>, <span class="string">&#x27;è¶³çƒ&#x27;</span>, <span class="string">&#x27;N&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> StudentClub <span class="keyword">VALUES</span>(<span class="number">300</span>, <span class="number">4</span>, <span class="string">&#x27;è¶³çƒ&#x27;</span>, <span class="string">&#x27;N&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> StudentClub <span class="keyword">VALUES</span>(<span class="number">400</span>, <span class="number">5</span>, <span class="string">&#x27;æ¸¸æ³³&#x27;</span>, <span class="string">&#x27;N&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> StudentClub <span class="keyword">VALUES</span>(<span class="number">500</span>, <span class="number">6</span>, <span class="string">&#x27;å›´æ£‹&#x27;</span>, <span class="string">&#x27;N&#x27;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> std_id, </span><br><span class="line"><span class="keyword">CASE</span> <span class="keyword">WHEN</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">=</span> <span class="number">1</span> </span><br><span class="line">     <span class="keyword">THEN</span> <span class="built_in">MAX</span>(club_id)</span><br><span class="line">     <span class="keyword">ELSE</span> <span class="built_in">MAX</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> main_club_flg <span class="operator">=</span> <span class="string">&#x27;Y&#x27;</span></span><br><span class="line">   <span class="keyword">THEN</span> club_id</span><br><span class="line">   <span class="keyword">ELSE</span> <span class="keyword">NULL</span> <span class="keyword">END</span>) <span class="keyword">END</span> <span class="keyword">AS</span> main_club</span><br><span class="line"><span class="keyword">FROM</span> StudentClub</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> std_id;</span><br></pre></td></tr></table></figure><img src="/post/ee5ab589/image-20250306235304639.png" class="" title="image-20250306235304639"><h3 id="ç»ƒä¹ 8ï¼šæ±‚å¤šåˆ—çš„æœ€å¤§å€¼"><a href="#ç»ƒä¹ 8ï¼šæ±‚å¤šåˆ—çš„æœ€å¤§å€¼" class="headerlink" title="ç»ƒä¹ 8ï¼šæ±‚å¤šåˆ—çš„æœ€å¤§å€¼"></a>ç»ƒä¹ 8ï¼šæ±‚å¤šåˆ—çš„æœ€å¤§å€¼</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Greatests</span><br><span class="line">(key <span class="type">CHAR</span>(<span class="number">1</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line"> x   <span class="type">INTEGER</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> y   <span class="type">INTEGER</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> z   <span class="type">INTEGER</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Greatests <span class="keyword">VALUES</span>(<span class="string">&#x27;A&#x27;</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Greatests <span class="keyword">VALUES</span>(<span class="string">&#x27;B&#x27;</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Greatests <span class="keyword">VALUES</span>(<span class="string">&#x27;C&#x27;</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Greatests <span class="keyword">VALUES</span>(<span class="string">&#x27;D&#x27;</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">8</span>);</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> `key`,</span><br><span class="line"><span class="keyword">CASE</span> <span class="keyword">WHEN</span> x <span class="operator">&gt;=</span> y </span><br><span class="line">   <span class="keyword">THEN</span> x </span><br><span class="line"> <span class="keyword">ELSE</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> y <span class="operator">&gt;=</span> z</span><br><span class="line"> <span class="keyword">THEN</span> y</span><br><span class="line"> <span class="keyword">ELSE</span> z </span><br><span class="line"> <span class="keyword">END</span></span><br><span class="line">   <span class="keyword">END</span> <span class="keyword">AS</span> greatest</span><br><span class="line"><span class="keyword">FROM</span> Greatests;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> key,</span><br><span class="line">       <span class="keyword">CASE</span> <span class="keyword">WHEN</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> x <span class="operator">&lt;</span> y </span><br><span class="line">              <span class="keyword">THEN</span> y </span><br><span class="line">                <span class="keyword">ELSE</span> x <span class="keyword">END</span> <span class="operator">&lt;</span> z</span><br><span class="line">            <span class="keyword">THEN</span> z</span><br><span class="line">            <span class="keyword">ELSE</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> x <span class="operator">&lt;</span> y <span class="keyword">THEN</span> y <span class="keyword">ELSE</span> x <span class="keyword">END</span></span><br><span class="line">       <span class="keyword">END</span> <span class="keyword">AS</span> greatest</span><br><span class="line"><span class="keyword">FROM</span> Greatests;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Reidsé›†ç¾¤æ­å»º</title>
      <link href="/post/75b7478e.html"/>
      <url>/post/75b7478e.html</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸»ä»é›†ç¾¤"><a href="#ä¸»ä»é›†ç¾¤" class="headerlink" title="ä¸»ä»é›†ç¾¤"></a>ä¸»ä»é›†ç¾¤</h2><h3 id="ä¸»ä»åŒæ­¥åŸç†"><a href="#ä¸»ä»åŒæ­¥åŸç†" class="headerlink" title="ä¸»ä»åŒæ­¥åŸç†"></a>ä¸»ä»åŒæ­¥åŸç†</h3><p>ä¸»ä»åŒæ­¥æµç¨‹å¦‚å›¾ï¼š</p><img src="/post/75b7478e/image-20250219200529477.png" class="" title="image-20250219200529477"><p>ä¸»ä»åŒæ­¥ä¼˜åŒ–ï¼š</p><ul><li>åœ¨masterä¸­é…ç½®<code>repl-diskless-sync yes</code>å¯ç”¨æ— ç£ç›˜å¤åˆ¶ï¼Œé¿å…å…¨é‡å¤åˆ¶æ—¶çš„ç£ç›˜IO</li><li>å•èŠ‚ç‚¹ä¸ŠRediså ç”¨å†…å­˜ä¸è¦å¤ªå¤§ï¼Œå‡å°‘RDBæ–‡ä»¶çš„å¤§å°</li><li>é€‚å½“æé«˜<code>repl_log</code>çš„å¤§å°ï¼Œå‘ç°slaveå®•æœºæ—¶å°½å¿«å®ç°æ•…éšœæ¢å¤ï¼Œé¿å…å…¨é‡å¤åˆ¶</li></ul><h3 id="é›†ç¾¤æ­å»ºæµ‹è¯•"><a href="#é›†ç¾¤æ­å»ºæµ‹è¯•" class="headerlink" title="é›†ç¾¤æ­å»ºæµ‹è¯•"></a>é›†ç¾¤æ­å»ºæµ‹è¯•</h3><p>ä¸‹å›¾å°±æ˜¯ä¸€ä¸ªç®€å•çš„ä¸»ä»é›†ç¾¤ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œé›†ç¾¤åŒ…å«ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œä¸¤ä¸ªä»èŠ‚ç‚¹ã€‚ä¸»èŠ‚ç‚¹è´Ÿè´£å†™æ“ä½œï¼Œä»èŠ‚ç‚¹è´Ÿè´£è¯»æ“ä½œ</p><img src="/post/75b7478e/image-20250217231959576.png" class="" title="image-20250217231959576"><p>ä¸‹é¢åœ¨è™šæ‹Ÿæœºä¸­åˆ©ç”¨dockerå®¹å™¨æ­å»ºè¿™æ ·ä¸€ä¸ªä¸»ä»é›†ç¾¤ï¼Œé¦–å…ˆç¡®ä¿å®¹å™¨ä¸­æœ‰redisé•œåƒï¼Œå¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥é€šè¿‡ <code>docker pull</code> å‘½ä»¤æ‹‰å–ã€‚</p><p>æ¥ç€é€šè¿‡<code>docker-compose.yaml</code>æ–‡ä»¶æ„å»ºé›†ç¾¤ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">r1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r1</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7001&quot;</span>]</span><br><span class="line">  <span class="attr">r2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r2</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7002&quot;</span>]</span><br><span class="line">  <span class="attr">r3:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r3</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7003&quot;</span>]</span><br></pre></td></tr></table></figure><p>åœ¨<code>docker-compose.yaml</code>æ–‡ä»¶æ‰€åœ¨ç›®å½•æ‰§è¡Œ<code>docker compose up -d</code>å‘½ä»¤å¯åŠ¨å®¹å™¨ï¼š</p><img src="/post/75b7478e/image-20250217233502378.png" class="" title="image-20250217233502378"><p>é€šè¿‡<code>docker compse</code>å‘½ä»¤å¯åŠ¨äº†3ä¸ªrediså®ä¾‹ï¼Œä½†è¿™3ä¸ªå®ä¾‹è¿˜æœªç»„æˆé›†ç¾¤ï¼Œå› ä¸ºå®ƒä»¬ä¹‹é—´æ²¡æœ‰ä¸»ä»å…³ç³»ã€‚ä¸»ä»å…³ç³»å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œé…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis5.0ä»¥å‰</span></span><br><span class="line">$ slaveof &lt;masterip&gt; &lt;masterport&gt;</span><br><span class="line"><span class="comment"># redis5.0ä»¥å</span></span><br><span class="line">$ replicaof &lt;masterip&gt; &lt;masterport&gt;</span><br></pre></td></tr></table></figure><p>ä¸»ä»å…³ç³»çš„é…ç½®æœ‰ä¸¤ç§ç”Ÿæ•ˆæ–¹å¼ï¼š</p><ul><li>æ°¸ä¹…ç”Ÿæ•ˆï¼šåœ¨<code>redis.conf</code>æ–‡ä»¶ä¸­åˆ©ç”¨<code>slaveof</code>åˆ¶å®š<code>master</code>èŠ‚ç‚¹</li><li>ä¸´æ—¶ç”Ÿæ•ˆï¼šé€šè¿‡<code>redis-cli</code>è¿æ¥åˆ°rediså®ä¾‹ï¼Œå¹¶æ‰§è¡Œ<code>slaveof</code>å‘½ä»¤æŒ‡å®š<code>master</code>èŠ‚ç‚¹</li></ul><p>ä¸‹é¢æ¼”ç¤ºä¸´æ—¶ç”Ÿæ•ˆæ–¹å¼é…ç½®ä¸»ä»å…³ç³»ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿æ¥r2</span></span><br><span class="line">$ docker <span class="built_in">exec</span> -it r2 redis-cli -p 7002</span><br><span class="line">127.0.0.1:7002&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:758df4b32faf526a279240093645cc45984d0502</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line">127.0.0.1:7002&gt; slaveof 192.168.33.11 7001</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:7002&gt; info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:192.168.33.11</span><br><span class="line">master_port:7001</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:3</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_read_repl_offset:14</span><br><span class="line">slave_repl_offset:14</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">replica_announced:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:5519e1a0e085620420c0a7afa2ccc5bf71826a52</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:14</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:14</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥r3ï¼Œå¹¶æ‰§è¡Œç›¸åŒæ“ä½œ</span></span><br></pre></td></tr></table></figure><p>æ¥ç€è¿æ¥r1å¹¶é€šè¿‡<code>info replication</code>æŸ¥çœ‹èŠ‚ç‚¹çš„ä»èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¯ä»¥å‘ç°r1æ˜¯<code>master</code>èŠ‚ç‚¹ï¼Œå¹¶ä¸”æœ‰ä¸¤ä¸ªä»èŠ‚ç‚¹</p><img src="/post/75b7478e/image-20250217235009950.png" class="" title="image-20250217235009950"><p>æµ‹è¯•å†™æ“ä½œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># r1</span></span><br><span class="line">127.0.0.1:7001&gt; <span class="built_in">set</span> num 123</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:7001&gt; get num</span><br><span class="line"><span class="string">&quot;123&quot;</span></span><br><span class="line">127.0.0.1:7001&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># r2æˆ–r3</span></span><br><span class="line">127.0.0.1:7003&gt; <span class="built_in">set</span> num 456</span><br><span class="line">(error) READONLY You can<span class="string">&#x27;t write against a read only replica.</span></span><br><span class="line"><span class="string">127.0.0.1:7003&gt; get num</span></span><br><span class="line"><span class="string">&quot;123&quot;</span></span><br><span class="line"><span class="string">127.0.0.1:7003&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼Œä»èŠ‚ç‚¹åªèƒ½æ‰§è¡Œè¯»æ“ä½œã€‚</p><h2 id="å“¨å…µé›†ç¾¤"><a href="#å“¨å…µé›†ç¾¤" class="headerlink" title="å“¨å…µé›†ç¾¤"></a>å“¨å…µé›†ç¾¤</h2><p>ä¸»ä»é›†ç¾¤é™ä½äº†èŠ‚ç‚¹çš„è¯»å†™å‹åŠ›ï¼Œä½†æ˜¯å­˜åœ¨å•ç‚¹æ•…éšœçš„é£é™©ã€‚masterèŠ‚ç‚¹å¦‚æœå®•æœºï¼Œå°±ä¼šå¯¼è‡´æ•´ä¸ªé›†ç¾¤ä¸å¯ç”¨ã€‚Redisçš„å“¨å…µæœºåˆ¶å¯ä»¥é€šè¿‡å“¨å…µèŠ‚ç‚¹æ¥ç›‘æ§é›†ç¾¤çŠ¶æ€ï¼Œå½“æŸä¸ªèŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œèƒ½åŠæ—¶åœ°è¿›è¡Œæ•…éšœè½¬ç§»ï¼Œä»è€Œä¿è¯é›†ç¾¤çš„é«˜å¯ç”¨æ€§ã€‚</p><h3 id="å“¨å…µå·¥ä½œåŸç†"><a href="#å“¨å…µå·¥ä½œåŸç†" class="headerlink" title="å“¨å…µå·¥ä½œåŸç†"></a>å“¨å…µå·¥ä½œåŸç†</h3><p>å“¨å…µé›†ç¾¤çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><img src="/post/75b7478e/image-20250219214812553.png" class="" title="image-20250219214812553"><p>å“¨å…µçš„ä½œç”¨åŒ…æ‹¬ï¼š</p><ul><li>ç›‘æ§é›†ç¾¤ä¸­redisèŠ‚ç‚¹çš„çŠ¶æ€</li><li>æ•…éšœæ¢å¤(failover)ï¼šå¦‚æœmasteræ•…éšœï¼Œå“¨å…µä¼šå°†å…¶ä¸­ä¸€ä¸ªslaveæå‡ä¸ºæ–°çš„masterï¼Œæ—§masteræ¢å¤åä¼šå˜ä¸ºæ–°masterçš„slave</li><li>çŠ¶æ€é€šçŸ¥ï¼šå½“é›†ç¾¤å‘ç”Ÿfailoveråï¼Œå“¨å…µä¼šå°†æœ€æ–°çš„é›†ç¾¤ä¿¡æ¯æ¨é€ç»™å®¢æˆ·ç«¯</li></ul><h4 id="çŠ¶æ€ç›‘æ§"><a href="#çŠ¶æ€ç›‘æ§" class="headerlink" title="çŠ¶æ€ç›‘æ§"></a>çŠ¶æ€ç›‘æ§</h4><h4 id="æ•…éšœæ¢å¤"><a href="#æ•…éšœæ¢å¤" class="headerlink" title="æ•…éšœæ¢å¤"></a>æ•…éšœæ¢å¤</h4><h2 id="åˆ†ç‰‡é›†ç¾¤"><a href="#åˆ†ç‰‡é›†ç¾¤" class="headerlink" title="åˆ†ç‰‡é›†ç¾¤"></a>åˆ†ç‰‡é›†ç¾¤</h2><h2 id="æºç ç¯å¢ƒæ­å»º"><a href="#æºç ç¯å¢ƒæ­å»º" class="headerlink" title="æºç ç¯å¢ƒæ­å»º"></a>æºç ç¯å¢ƒæ­å»º</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clone æºç </span></span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/redis/redis.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥redisç›®å½•</span></span><br><span class="line">$ <span class="built_in">cd</span> redis</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»åˆ¶å®štagåˆ›å»ºåˆ†æ”¯</span></span><br><span class="line">$ git checkout tags/7.0.5 -b 7.0.5</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ˜¯å¦å®‰è£…äº†gccç¼–è¯‘å™¨</span></span><br><span class="line">$ gcc -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœæ²¡æœ‰åˆ¶å®šä»¥ä¸‹å‘½ä»¤å®‰è£…</span></span><br><span class="line">$ xcode-select --install</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨redisç›®å½•æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ç¼–è¯‘æºç </span></span><br><span class="line"><span class="comment"># -O0 è¡¨ç¤ºä¸è¦ä¼˜åŒ–ä»£ç ï¼Œé˜²æ­¢åœ¨Debugçš„æ—¶å€™ï¼Œ IDEé‡Œé¢çš„Redisæºç ä¸å®é™…è¿è¡Œçš„ä»£ç å¯¹åº”ä¸ä¸Š</span></span><br><span class="line">$ make CFLAGS=<span class="string">&quot;-g -O0&quot;</span> MALLOC=jemalloc</span><br></pre></td></tr></table></figure><p><code>CLion</code> å¯¼å…¥redisæºç å¹¶è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p><img src="/post/75b7478e/image-20250217230303910.png" class="" title="image-20250217230303910"><p>ç›´æ¥debugå¯åŠ¨ï¼Œç›¸å½“äºæ‰§è¡Œå‘½ä»¤ <code>/Users/tw/CLionProjects/redis/src/redis-server redis.conf</code>ï¼Œæ¥ä¸‹æ¥åœ¨<code>server.c</code>çš„<code>main()</code>ä¸­æ‰“æ–­ç‚¹ï¼Œå°±å¯ä»¥debugè°ƒè¯•æºç äº†ã€‚</p><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> é›†ç¾¤ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shellç¼–ç¨‹åŸºç¡€</title>
      <link href="/post/6e95fc76.html"/>
      <url>/post/6e95fc76.html</url>
      
        <content type="html"><![CDATA[<h2 id="åŸºæœ¬å‘½ä»¤"><a href="#åŸºæœ¬å‘½ä»¤" class="headerlink" title="åŸºæœ¬å‘½ä»¤"></a>åŸºæœ¬å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>#!/bin/bash</code></td><td>è„šæœ¬å›ºå®šå¼€å¤´</td></tr><tr><td><code>$PATH</code></td><td>åœ¨è„šæœ¬ä¸­å¼•ç”¨ç¯å¢ƒå˜é‡</td></tr><tr><td>today&#x3D;`date`</td><td>æ›¿æ¢å‘½ä»¤ï¼Œå°† <code>date</code> çš„è¾“å‡ºèµ‹ç»™ <code>today</code></td></tr><tr><td><code>today=$(date)</code></td><td>åŒä¸Š</td></tr><tr><td><code>date +%y%m%d</code></td><td>å°†æ—¥æœŸæ˜¾ç¤ºä¸ºä¸¤ä½æ•°çš„å¹´æœˆæ—¥çš„ç»„åˆ ï¼Œå¦‚250108</td></tr><tr><td><code>$[3 * 5]</code></td><td>æ•°å­¦è¿ç®—</td></tr><tr><td><code>(( expression ))</code></td><td>ç”¨äºæ•°å­¦è¡¨è¾¾å¼</td></tr><tr><td><code>[[ expression ]]</code></td><td>ç”¨äºé«˜çº§å­—ç¬¦ä¸²å¤„ç†</td></tr><tr><td><code>IFS=$&#39;\n&#39;</code></td><td>ä¿®æ”¹å†…éƒ¨å­—æ®µåˆ†éš”ç¬¦</td></tr><tr><td><code>for file in /etc/*</code></td><td>éå†ç›®å½•</td></tr></tbody></table><p>æ¡ä»¶è¯­å¥ï¼šæ£€æŸ¥å‘½ä»¤çš„é€€å‡ºçŠ¶æ€ç æ˜¯å¦ä¸º0</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># if-then</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">command</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  commands</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># if-then-else</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">command</span></span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"> commands</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"> commands</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># if-then-elif</span></span><br><span class="line"><span class="keyword">if</span> command1</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"> commands</span><br><span class="line"><span class="keyword">elif</span> command2</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"> more commands</span><br><span class="line"><span class="keyword">fi</span> </span><br></pre></td></tr></table></figure><p>æ¡ä»¶æµ‹è¯•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ condition ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"> commands</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><ul><li>æ•°å€¼æ¯”è¾ƒ</li></ul><table><thead><tr><th>æ¯”è¾ƒ</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>n1 -eq n2</code></td><td>æ£€æŸ¥n1æ˜¯å¦ä¸n2ç›¸ç­‰</td></tr><tr><td><code>n1 -ge n2</code></td><td>æ£€æŸ¥n1æ˜¯å¦å¤§äºæˆ–ç­‰äºn2</td></tr><tr><td><code>n1 -gt n2</code></td><td>æ£€æŸ¥n1æ˜¯å¦å¤§äºn2</td></tr><tr><td><code>n1 -le n2</code></td><td>æ£€æŸ¥n1æ˜¯å¦å°äºæˆ–ç­‰äºn2</td></tr><tr><td><code>n1 -lt n2</code></td><td>æ£€æŸ¥n1æ˜¯å¦å°äºn2</td></tr><tr><td><code>n1 -ne n2</code></td><td>æ£€æŸ¥n1æ˜¯å¦ä¸ç­‰äºn2</td></tr></tbody></table><ul><li>å­—ç¬¦ä¸²æ¯”è¾ƒ</li></ul><table><thead><tr><th>æ¯”è¾ƒ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>str1 = str2</code></td><td>æ£€æŸ¥str1æ˜¯å¦å’Œstr2ç›¸åŒ</td></tr><tr><td><code>str1 != str2</code></td><td>æ£€æŸ¥str1æ˜¯å¦å’Œstr2ä¸åŒ</td></tr><tr><td><code>str1 &lt; str2</code></td><td>æ£€æŸ¥str1æ˜¯å¦æ¯”str2å°</td></tr><tr><td><code>str1 &gt; str2</code></td><td>æ£€æŸ¥str1æ˜¯å¦æ¯”str2å¤§</td></tr><tr><td><code>-n str1</code></td><td>æ£€æŸ¥str1çš„é•¿åº¦æ˜¯å¦é0</td></tr><tr><td><code>-z str1</code></td><td>æ£€æŸ¥str1çš„é•¿åº¦æ˜¯å¦ä¸º0</td></tr></tbody></table><ul><li>æ–‡ä»¶æ¯”è¾ƒ</li></ul><table><thead><tr><th>æ¯”è¾ƒ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>-d file</code></td><td>æ£€æŸ¥fileæ˜¯å¦å­˜åœ¨å¹¶æ˜¯ä¸€ä¸ªç›®å½•</td></tr><tr><td><code>-e file</code></td><td>æ£€æŸ¥fileæ˜¯å¦å­˜åœ¨</td></tr><tr><td><code>-f file</code></td><td>æ£€æŸ¥fileæ˜¯å¦å­˜åœ¨å¹¶æ˜¯ä¸€ä¸ªæ–‡ä»¶</td></tr><tr><td><code>-r file</code></td><td>æ£€æŸ¥fileæ˜¯å¦å­˜åœ¨å¹¶å¯è¯»</td></tr><tr><td><code>-s file</code></td><td>æ£€æŸ¥fileæ˜¯å¦å­˜åœ¨å¹¶éç©º</td></tr><tr><td><code>-w file</code></td><td>æ£€æŸ¥fileæ˜¯å¦å­˜åœ¨å¹¶å¯å†™</td></tr><tr><td><code>-x file</code></td><td>æ£€æŸ¥fileæ˜¯å¦å­˜åœ¨å¹¶å¯æ‰§è¡Œ</td></tr><tr><td><code>-O file</code></td><td>æ£€æŸ¥fileæ˜¯å¦å­˜åœ¨å¹¶å±å½“å‰ç”¨æˆ·æ‰€æœ‰</td></tr><tr><td><code>-G file</code></td><td>æ£€æŸ¥fileæ˜¯å¦å­˜åœ¨å¹¶ä¸”é»˜è®¤ç»„ä¸å½“å‰ç”¨æˆ·ç›¸åŒ</td></tr><tr><td><code>file1 -nt file2</code></td><td>æ£€æŸ¥file1æ˜¯å¦æ¯”file2æ–°</td></tr><tr><td><code>file1 -ot file2</code></td><td>æ£€æŸ¥file1æ˜¯å¦æ¯”file2æ—§</td></tr></tbody></table><p>åˆ†æ”¯è¯­å¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> variable <span class="keyword">in</span></span><br><span class="line">pattern1 | pattern2) commands1;;</span><br><span class="line">pattern3) commands2;;</span><br><span class="line">*) default commands;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure><p>for-å¾ªç¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (( variable assignment ; condition ; iteration process ))</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">other commands</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>while-å¾ªç¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> condition</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">other commands</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>until-å¾ªç¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">until</span> condition</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">other commands</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="å®ç”¨è„šæœ¬"><a href="#å®ç”¨è„šæœ¬" class="headerlink" title="å®ç”¨è„šæœ¬"></a>å®ç”¨è„šæœ¬</h2><h3 id="æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶"><a href="#æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶"></a>æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># finding files in the PATH</span></span><br><span class="line"></span><br><span class="line">IFS=:</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">dir</span> <span class="keyword">in</span> <span class="variable">$PATH</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="comment"># æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    <span class="keyword">if</span> [ -d <span class="variable">$dir</span> ]; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$dir</span>:&quot;</span></span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> <span class="variable">$dir</span>/*:</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    <span class="comment"># æ£€æŸ¥æ˜¯å¦æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ä¸”ä¸æ˜¯ç›®å½•</span></span><br><span class="line">    <span class="keyword">if</span> [ -x <span class="variable">$file</span> ] &amp;&amp; [ ! -d <span class="variable">$file</span> ]; <span class="keyword">then</span> <span class="comment"># ä¸­æ‹¬å·ä¸æ¡ä»¶è¡¨è¾¾å¼éœ€ç©ºæ ¼éš”å¼€</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;    <span class="variable">$file</span>&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$dir</span>: [Not a valid directory]&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="æ‰¹é‡åˆ›å»ºç”¨æˆ·"><a href="#æ‰¹é‡åˆ›å»ºç”¨æˆ·" class="headerlink" title="æ‰¹é‡åˆ›å»ºç”¨æˆ·"></a>æ‰¹é‡åˆ›å»ºç”¨æˆ·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> users.csv</span><br><span class="line">rich,Richard Blum</span><br><span class="line">christine,Christine Bresnahan</span><br><span class="line">barbara,Barbara Blum</span><br><span class="line">tim,Timothy Bresnahan</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">input=<span class="string">&quot;users.csv&quot;</span></span><br><span class="line"><span class="keyword">while</span> IFS=<span class="string">&#x27;,&#x27;</span> <span class="built_in">read</span> -r userid name</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;adding <span class="variable">$userid</span>&quot;</span></span><br><span class="line">    useradd -c <span class="string">&quot;<span class="variable">$name</span>&quot;</span> -m <span class="variable">$userid</span></span><br><span class="line"><span class="keyword">done</span> &lt; <span class="string">&quot;<span class="variable">$input</span>&quot;</span></span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gawkåŸºç¡€</title>
      <link href="/post/132c5d7c.html"/>
      <url>/post/132c5d7c.html</url>
      
        <content type="html"><![CDATA[<p>gawkç¨‹åºæ˜¯Unixä¸­çš„åŸå§‹awkç¨‹åºçš„GNUç‰ˆæœ¬ï¼Œå…¶æŠ¥å‘Šç”Ÿæˆèƒ½åŠ›é€šå¸¸ç”¨æ¥ä»å¤§æ–‡æœ¬æ–‡ä»¶æ–‡ä»¶ä¸­æå–å…ƒç´ ï¼Œå¹¶å°†å®ƒä»¬æ ¼å¼åŒ–æˆå¯è¯»çš„æ ¼å¼ï¼Œå¦‚æ ¼å¼åŒ–æ—¥å¿—æ–‡ä»¶ã€‚</p><p>gawkçš„å‘½ä»¤æ ¼å¼ä¸ºï¼š<code>gawk options program file</code>ã€‚</p><p>å¸¸ç”¨çš„é€‰é¡¹å¦‚ä¸‹ï¼š</p><table><thead><tr><th>é€‰é¡¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>-F fs</code></td><td>æŒ‡å®šè¡Œä¸­åˆ’åˆ†æ•°æ®å­—æ®µçš„å­—æ®µåˆ†éš”ç¬¦</td></tr><tr><td><code>-f file</code></td><td>ä»æŒ‡å®šçš„æ–‡ä»¶ä¸­è¯»å–ç¨‹åº</td></tr><tr><td><code>-v var=value</code></td><td>å®šä¹‰gawkç¨‹åºä¸­çš„ä¸€ä¸ªå˜é‡åŠå…¶é»˜è®¤å€¼</td></tr><tr><td><code>-mf N</code></td><td>æŒ‡å®šè¦å¤„ç†çš„æ•°æ®æ–‡ä»¶ä¸­çš„æœ€å¤§å­—æ®µæ•°</td></tr><tr><td><code>-mr N</code></td><td>æŒ‡å®šæ•°æ®æ–‡ä»¶ä¸­çš„æœ€å¤§æ•°æ®è¡Œæ•°</td></tr><tr><td><code>-W keyword</code></td><td>æŒ‡å®šgawkçš„å…¼å®¹æ¨¡å¼æˆ–è­¦å‘Šç­‰çº§</td></tr></tbody></table><h2 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h2><p>æ‰€æœ‰ç¼–ç¨‹è¯­è¨€éƒ½å¯ä»¥ä½¿ç”¨å˜é‡æ¥å­˜å–å€¼ï¼Œgawkç¼–ç¨‹è¯­è¨€æ”¯æŒä¸¤ç§ç±»å‹å˜é‡ï¼š</p><ul><li>å†…å»ºå˜é‡</li><li>è‡ªå®šä¹‰å˜é‡</li></ul><h3 id="å†…å»ºå˜é‡"><a href="#å†…å»ºå˜é‡" class="headerlink" title="å†…å»ºå˜é‡"></a>å†…å»ºå˜é‡</h3><h4 id="æ•°æ®å­—æ®µå˜é‡"><a href="#æ•°æ®å­—æ®µå˜é‡" class="headerlink" title="æ•°æ®å­—æ®µå˜é‡"></a>æ•°æ®å­—æ®µå˜é‡</h4><p>åœ¨å¤„ç†æ–‡æœ¬æ—¶ï¼Œgawkä¼šç»™ä¸€è¡Œä¸­çš„æ¯ä¸ªæ•°æ®å…ƒç´ åˆ†é…ä¸€ä¸ªå˜é‡ï¼š</p><ul><li><code>$0</code>ï¼šè¡¨ç¤ºæ•´ä¸ªæ–‡æœ¬è¡Œ</li><li><code>$1</code>ï¼šè¡¨ç¤ºç¬¬1ä¸ªæ•°æ®å­—æ®µ</li><li><code>$n</code>ï¼šè¡¨ç¤ºç¬¬nä¸ªæ•°æ®å­—æ®µ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> data1.txt</span><br><span class="line">One line of <span class="built_in">test</span> text.</span><br><span class="line">Two lines of <span class="built_in">test</span> text.</span><br><span class="line">Three lines of <span class="built_in">test</span> text.</span><br><span class="line"></span><br><span class="line">$ gawk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> data1.txt</span><br><span class="line">One</span><br><span class="line">Two</span><br><span class="line">Three</span><br></pre></td></tr></table></figure><h4 id="åˆ†éš”ç¬¦å˜é‡"><a href="#åˆ†éš”ç¬¦å˜é‡" class="headerlink" title="åˆ†éš”ç¬¦å˜é‡"></a>åˆ†éš”ç¬¦å˜é‡</h4><p>gawké»˜è®¤é‡‡ç”¨ç©ºç™½å­—ç¬¦ä½œä¸ºè¾“å…¥å’Œè¾“å‡ºå­—æ®µåˆ†éš”ç¬¦ã€‚</p><table><thead><tr><th>å˜é‡</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>FIELDWIDTHS</code></td><td>ç”±ç©ºæ ¼åˆ†éš”çš„ä¸€åˆ—æ•°å­—ï¼Œå®šä¹‰äº†æ¯ä¸ªæ•°æ®å­—æ®µç¡®åˆ‡å®½åº¦</td></tr><tr><td><code>FS</code></td><td>è¾“å…¥å­—æ®µåˆ†éš”ç¬¦</td></tr><tr><td><code>RS</code></td><td>è¾“å…¥è®°å½•åˆ†éš”ç¬¦</td></tr><tr><td><code>OFS </code></td><td>è¾“å‡ºå­—æ®µåˆ†éš”ç¬¦</td></tr><tr><td><code>ORS</code></td><td>è¾“å‡ºè®°å½•åˆ†éš”ç¬¦</td></tr></tbody></table><ul><li>é€šè¿‡ <code>FS</code> æŒ‡å®šè¾“å…¥å­—æ®µåˆ†éš”ç¬¦</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># data2.txt</span></span><br><span class="line">$ <span class="built_in">cat</span> data2.txt</span><br><span class="line">data11,data12,data13,data14,data15</span><br><span class="line">data21,data22,data23,data24,data25</span><br><span class="line">data31,data32,data33,data34,data35</span><br><span class="line"></span><br><span class="line">$ gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125; &#123;print $1, $2, $3&#125;&#x27;</span> data2.txt</span><br><span class="line">data11 data12 data13</span><br><span class="line">data21 data22 data23</span><br><span class="line">data31 data32 data33</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡ <code>OFS</code> æŒ‡å®šè¾“å‡ºå­—æ®µåˆ†éš”ç¬¦</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;; OFS=&quot;-&quot;&#125; &#123;print $1, $2, $3&#125;&#x27;</span> data2.txt</span><br><span class="line">data11-data12-data13</span><br><span class="line">data21-data22-data23</span><br><span class="line">data31-data32-data33</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡ <code>FIELDWIDTHS</code> å˜é‡æ¥åŒ¹é…æ•°æ®åœ¨è®°å½•ä¸­çš„ä½ç½®</li></ul><p>åœ¨ä¸€äº›åº”ç”¨ç¨‹åºä¸­ï¼Œæ•°æ®å¹¶æ²¡æœ‰ä½¿ç”¨å­—æ®µåˆ†éš”ç¬¦ï¼Œè€Œæ˜¯è¢«æ”¾ç½®åœ¨äº†è®°å½•ä¸­çš„ç‰¹å®šåˆ—ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¿…é¡»è®¾å®š <code>FIELDWIDTHS</code> å˜é‡æ¥åŒ¹é…æ•°æ®åœ¨è®°å½•ä¸­çš„ä½ç½®ã€‚ä¸€æ—¦è®¾ç½®äº† <code>FIELDWIDTH</code> å˜é‡ï¼Œgawkå°±ä¼šå¿½ç•¥ <code>FS</code> å˜é‡ï¼Œå¹¶æ ¹æ®æä¾›çš„å­—æ®µå®½åº¦æ¥è®¡ç®—å­—æ®µã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># data3.txt</span></span><br><span class="line">$ <span class="built_in">cat</span> data3.txt</span><br><span class="line">1005.3247596.37</span><br><span class="line">115-2.349194.00</span><br><span class="line">05810.1298100.1</span><br><span class="line"></span><br><span class="line">$ gawk <span class="string">&#x27;BEGIN&#123;FIELDWIDTHS=&quot;3 5 2 5&quot;&#125; &#123;print $1, $2, $3, $4&#125;&#x27;</span> data3.txt</span><br><span class="line">100 5.324 75 96.37</span><br><span class="line">115 -2.34 91 94.00</span><br><span class="line">058 10.12 98 100.1</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡ <code>RS</code> æŒ‡å®šè¾“å…¥è®°å½•åˆ†éš”ç¬¦</li></ul><p>gawké»˜è®¤æŠŠæ¢è¡Œç¬¦ä½œä¸ºè®°å½•åˆ†éš”ç¬¦ã€‚å½“é‡åˆ°è®°å½•è·¨è¡Œå­˜å‚¨ï¼Œä¸åŒè®°å½•ä»¥ç©ºç™½è¡Œåˆ†éš”çš„æ–‡æœ¬ï¼Œå°±éœ€è¦é€šè¿‡ <code>RS</code> æŒ‡å®šè®°å½•åˆ†éš”ç¬¦ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> data4.txt</span><br><span class="line">Riley Mullen</span><br><span class="line">123 Main Street</span><br><span class="line">Chicago, IL 60601</span><br><span class="line">(312)555-1234</span><br><span class="line"></span><br><span class="line">Frank Williams</span><br><span class="line">456 Oak Street</span><br><span class="line">Indianapolis, IN 46201</span><br><span class="line">(317)555-9876</span><br><span class="line"></span><br><span class="line">Haley Snell</span><br><span class="line">4231 Elm Street</span><br><span class="line">Detroit, MI 48201</span><br><span class="line">(313)555-4938</span><br><span class="line"></span><br><span class="line"><span class="comment"># FSï¼šæŒ‡å®šå­—æ®µåˆ†éš”ç¬¦ä¸º\n</span></span><br><span class="line"><span class="comment"># RSï¼šæŒ‡å®šè®°å½•åˆ†éš”ç¬¦ä¸ºç©ºå­—ç¬¦</span></span><br><span class="line">$ gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;\n&quot;; RS=&quot;&quot;&#125; &#123;print $1, $4&#125;&#x27;</span> data4.txt</span><br><span class="line">Riley Mullen (312)555-1234</span><br><span class="line">Frank Williams (317)555-9876</span><br><span class="line">Haley Snell (313)555-4938</span><br></pre></td></tr></table></figure><h4 id="å…¶ä»–å†…å»ºå˜é‡"><a href="#å…¶ä»–å†…å»ºå˜é‡" class="headerlink" title="å…¶ä»–å†…å»ºå˜é‡"></a>å…¶ä»–å†…å»ºå˜é‡</h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>ARGC</code></td><td>å½“å‰å‘½ä»¤è¡Œå‚æ•°ä¸ªæ•°</td></tr><tr><td><code>ARGIND</code></td><td>å½“å‰æ–‡ä»¶åœ¨<code>ARGV</code>ä¸­çš„ä½ç½®</td></tr><tr><td><code>ARGV</code></td><td>åŒ…å«å‘½ä»¤è¡Œå‚æ•°çš„æ•°ç»„</td></tr><tr><td><code>CONVFMT</code></td><td>æ•°å­—çš„è½¬æ¢æ ¼å¼ï¼ˆå‚è§<code>printf</code>è¯­å¥ï¼‰ï¼Œé»˜è®¤å€¼ä¸º<code>%.6 g</code></td></tr><tr><td><code>ENVIRON</code></td><td>å½“å‰shellç¯å¢ƒå˜é‡åŠå…¶å€¼ç»„æˆçš„å…³è”æ•°ç»„</td></tr><tr><td><code>ERRNO</code></td><td>å½“è¯»å–æˆ–å…³é—­è¾“å…¥æ–‡ä»¶å‘ç”Ÿé”™è¯¯æ—¶çš„ç³»ç»Ÿé”™è¯¯å·</td></tr><tr><td><code>FILENAME</code></td><td>ç”¨ä½œgawkè¾“å…¥æ•°æ®çš„æ•°æ®æ–‡ä»¶çš„æ–‡ä»¶å</td></tr><tr><td><code>IGNORECASE</code></td><td>è®¾æˆéé›¶å€¼æ—¶ï¼Œå¿½ç•¥gawkå‘½ä»¤ä¸­å‡ºç°çš„å­—ç¬¦ä¸²çš„å­—ç¬¦å¤§å°å†™</td></tr><tr><td><code>NF</code></td><td>æ•°æ®æ–‡ä»¶ä¸­çš„å­—æ®µæ€»æ•°</td></tr><tr><td><code>NR</code></td><td>å·²å¤„ç†çš„è¾“å…¥è®°å½•æ•°</td></tr><tr><td><code>FNR</code></td><td>å½“å‰æ•°æ®æ–‡ä»¶ä¸­çš„æ•°æ®è¡Œæ•°</td></tr><tr><td><code>OFMT</code></td><td>æ•°å­—çš„è¾“å‡ºæ ¼å¼ï¼Œé»˜è®¤å€¼ä¸º<code>%.6 g</code></td></tr><tr><td><code>RLENGTH</code></td><td>ç”±<code>match</code>å‡½æ•°æ‰€åŒ¹é…çš„å­å­—ç¬¦ä¸²çš„é•¿åº¦</td></tr><tr><td><code>RSTART</code></td><td>ç”±<code>match</code>å‡½æ•°æ‰€åŒ¹é…çš„å­å­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½®</td></tr></tbody></table><ul><li><code>ARGC</code> å’Œ <code>ARGV</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gawkä¸æŠŠè„šæœ¬ç¨‹åºå½“ä½œå‘½ä»¤è¡Œå‚æ•°çš„ä¸€éƒ¨åˆ†</span></span><br><span class="line">$ gawk <span class="string">&#x27;BEGIN&#123;print ARGC, ARGV[0], ARGV[1]&#125;&#x27;</span> data1.txt</span><br><span class="line">2 gawk data1.txt</span><br></pre></td></tr></table></figure><ul><li><code>ENVIRON</code></li></ul><p>å¯ä»¥é€šè¿‡ <code>ENVIRON</code> æ¥è·å– shell ä¸­ä»»ä½•ç¯å¢ƒå˜é‡çš„å€¼ï¼Œä»¥ä¾› gawk ç¨‹åºä½¿ç”¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ gawk <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&gt; BEGIN&#123;</span></span><br><span class="line"><span class="string">&gt; print ENVIRON[&quot;HOME&quot;]</span></span><br><span class="line"><span class="string">&gt; print ENVIRON[&quot;PATH&quot;]</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span></span><br><span class="line">/home/rich</span><br><span class="line">/usr/local/bin:/bin:/usr/bin:</span><br></pre></td></tr></table></figure><ul><li><code>NF</code></li></ul><p>å½“ä¸çŸ¥è®°å½•æœ‰å¤šå°‘ä¸ªå­—æ®µï¼Œ<code>NF</code> å˜é‡å¯ä»¥ç”¨æ¥æŒ‡å®šæœ€åä¸€ä¸ªæ•°æ®å­—æ®µã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;:&quot;; OFS=&quot;:&quot;&#125; &#123;print $1, $NF&#125;&#x27;</span> /etc/passwd</span><br><span class="line">nobody:/usr/bin/false</span><br><span class="line">root:/bin/sh</span><br><span class="line">daemon:/usr/bin/false</span><br></pre></td></tr></table></figure><ul><li><code>FNR</code> å’Œ <code>NR</code></li></ul><p><code>FNR</code> å˜é‡çš„å€¼åœ¨ gawk å¤„ç†ç¬¬äºŒä¸ªæ•°æ®æ–‡ä»¶æ—¶è¢«é‡ç½®äº†ï¼Œè€Œ <code>NR</code> å˜é‡åˆ™åœ¨å¤„ç†ç¬¬äºŒä¸ªæ•°æ®æ–‡ä»¶æ—¶ç»§ç»­è®¡æ•°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ gawk <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&gt; BEGIN &#123;FS=&quot;,&quot;&#125;</span></span><br><span class="line"><span class="string">&gt; &#123;print $1, &quot;FNR=&quot;FNR, &quot;NR=&quot;NR&#125;</span></span><br><span class="line"><span class="string">&gt; END &#123;print &quot;There were&quot;,NR,&quot;records processed&quot;&#125;&#x27;</span> data2.txt data2.txt</span><br><span class="line">data11 FNR=1 NR=1</span><br><span class="line">data21 FNR=2 NR=2</span><br><span class="line">data31 FNR=3 NR=3</span><br><span class="line">data11 FNR=1 NR=4</span><br><span class="line">data21 FNR=2 NR=5</span><br><span class="line">data31 FNR=3 NR=6</span><br><span class="line">There were 6 records processed</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰å˜é‡"><a href="#è‡ªå®šä¹‰å˜é‡" class="headerlink" title="è‡ªå®šä¹‰å˜é‡"></a>è‡ªå®šä¹‰å˜é‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ gawk <span class="string">&#x27;BEGIN &#123;</span></span><br><span class="line"><span class="string">&gt; text=&quot;hello world&quot;</span></span><br><span class="line"><span class="string">&gt; print text</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span></span><br><span class="line">hello world</span><br></pre></td></tr></table></figure><ul><li>åœ¨å‘½ä»¤è¡Œä¸Šç»™è„šæœ¬ä¸­çš„å˜é‡èµ‹å€¼</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># script4.gawk</span></span><br><span class="line">$ <span class="built_in">cat</span> script4.gawk</span><br><span class="line">BEGIN &#123;FS=<span class="string">&quot;,&quot;</span>&#125;</span><br><span class="line">&#123;<span class="built_in">print</span> <span class="variable">$n</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨å‘½ä»¤è¡Œè®¾ç½®n</span></span><br><span class="line">$ gawk -f script4.gawk n=2 data2.txt</span><br><span class="line">data12</span><br><span class="line">data22</span><br><span class="line">data32</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æƒ…å†µä¸‹ <code>BEGIN</code> å‘½ä»¤è·å–ä¸åˆ°å‘½ä»¤è¡Œè®¾ç½®çš„å˜é‡çš„å€¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> script5.gawk</span><br><span class="line">BEGIN&#123;<span class="built_in">print</span> <span class="string">&quot;The&quot;</span>, n<span class="string">&quot;th field is&quot;</span>; FS=<span class="string">&quot;,&quot;</span>&#125;</span><br><span class="line">&#123;<span class="built_in">print</span> <span class="variable">$n</span>&#125;</span><br><span class="line"></span><br><span class="line">$ gawk -f script5.gawk n=2 data2.txt</span><br><span class="line">The th field is</span><br><span class="line">data12</span><br><span class="line">data22</span><br><span class="line">data32</span><br></pre></td></tr></table></figure><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦åŠ ä¸Š <code>-v</code> å‘½ä»¤è¡Œå‚æ•°ï¼Œä¸” <code>-v n=2</code> å¿…é¡»è¦æ”¾åœ¨ <code>-f</code> å‚æ•°å‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ gawk -v n=2 -f script5.gawk data2.txt</span><br><span class="line">The 2th field is</span><br><span class="line">data12</span><br><span class="line">data22</span><br><span class="line">data32</span><br></pre></td></tr></table></figure><h2 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h2><p>gawkä½¿ç”¨å…³è”æ•°ç»„æä¾›æ•°ç»„åŠŸèƒ½ã€‚å…³è”æ•°ç»„è·Ÿæ™®é€šæ•°ç»„ä¸åŒä¹‹å¤„åœ¨äºå®ƒçš„ç´¢å¼•å€¼å¯ä»¥æ˜¯ä»»æ„æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œç±»ä¼¼äºå­—å…¸ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ gawk <span class="string">&#x27;BEGIN&#123;</span></span><br><span class="line"><span class="string">&gt; capital[&quot;China&quot;] = &quot;Beijing&quot;</span></span><br><span class="line"><span class="string">&gt; print capital[&quot;China&quot;]</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span></span><br><span class="line">Beijing</span><br><span class="line"></span><br><span class="line">$ gawk <span class="string">&#x27;BEGIN&#123;</span></span><br><span class="line"><span class="string">&gt; var[1] = 34</span></span><br><span class="line"><span class="string">&gt; var[2] = 3</span></span><br><span class="line"><span class="string">&gt; total = var[1] + var[2]</span></span><br><span class="line"><span class="string">&gt; print total</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span></span><br><span class="line">37</span><br><span class="line"></span><br><span class="line"><span class="comment"># éå†&amp;åˆ é™¤æ•°ç»„</span></span><br><span class="line">$ gawk <span class="string">&#x27;BEGIN&#123;</span></span><br><span class="line"><span class="string">&gt; var[&quot;a&quot;] = 1</span></span><br><span class="line"><span class="string">&gt; var[&quot;g&quot;] = 2</span></span><br><span class="line"><span class="string">&gt; for (test in var)</span></span><br><span class="line"><span class="string">&gt; &#123;</span></span><br><span class="line"><span class="string">&gt; print &quot;Index:&quot;,test,&quot;- Value:&quot;,var[test]</span></span><br><span class="line"><span class="string">&gt; &#125;</span></span><br><span class="line"><span class="string">&gt; delete var[&quot;g&quot;]</span></span><br><span class="line"><span class="string">&gt; print &quot;-----&quot;</span></span><br><span class="line"><span class="string">&gt; for (test in var)</span></span><br><span class="line"><span class="string">&gt; &#123;</span></span><br><span class="line"><span class="string">&gt; print &quot;Index:&quot;,test,&quot;- Value:&quot;,var[test]</span></span><br><span class="line"><span class="string">&gt; &#125;</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span></span><br><span class="line">Index: a - Value: 1</span><br><span class="line">Index: g - Value: 2</span><br><span class="line">-----</span><br><span class="line">Index: a - Value: 1</span><br></pre></td></tr></table></figure><h2 id="æ¨¡å¼"><a href="#æ¨¡å¼" class="headerlink" title="æ¨¡å¼"></a>æ¨¡å¼</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> data1</span><br><span class="line">data11,data12,data13,data14,data15</span><br><span class="line">data21,data22,data23,data24,data25</span><br><span class="line">data31,data32,data33,data34,data35</span><br></pre></td></tr></table></figure><ul><li>æ­£åˆ™è¡¨è¾¾å¼</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /11/åŒ¹é…äº†æ•°æ®å­—æ®µä¸­å«æœ‰å­—ç¬¦ä¸²11çš„è®°å½•</span></span><br><span class="line">$ gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125; /11/&#123;print $0&#125;&#x27;</span> data1</span><br><span class="line">data11,data12,data13,data14,data15</span><br></pre></td></tr></table></figure><ul><li>åŒ¹é…æ“ä½œç¬¦</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $1 ~ /^data2/åŒ¹é…ç¬¬ä¸€ä¸ªå­—æ®µä»¥data2å¼€å¤´çš„è®°å½•</span></span><br><span class="line">$ gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125; $1 ~ /^data2/&#123;print $0&#125;&#x27;</span> data1</span><br><span class="line">data21,data22,data23,data24,data25</span><br><span class="line"></span><br><span class="line"><span class="comment"># $1 !~ /^data2/åŒ¹é…ç¬¬ä¸€ä¸ªå­—æ®µä¸ä»¥data2å¼€å¤´çš„è®°å½•</span></span><br><span class="line">$ gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125; $1 !~ /^data2/&#123;print $0&#125;&#x27;</span> data1</span><br><span class="line">data11,data12,data13,data14,data15</span><br><span class="line">data31,data32,data33,data34,data35</span><br></pre></td></tr></table></figure><ul><li>æ•°å­¦è¡¨è¾¾å¼</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># $1 == &quot;data11&quot;åŒ¹é…ç¬¬ä¸€ä¸ªå­—æ®µç­‰äºdata11çš„è®°å½•</span></span><br><span class="line">$ gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;,&quot;&#125; $1 == &quot;data11&quot;&#123;print $1&#125;&#x27;</span> data1</span><br><span class="line">data11,data12,data13,data14,data15</span><br></pre></td></tr></table></figure><h2 id="ç»“æ„åŒ–"><a href="#ç»“æ„åŒ–" class="headerlink" title="ç»“æ„åŒ–"></a>ç»“æ„åŒ–</h2><ul><li><code>if</code> è¯­å¥</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> data2</span><br><span class="line">10</span><br><span class="line">5</span><br><span class="line">13</span><br><span class="line">50</span><br><span class="line">34</span><br><span class="line"></span><br><span class="line">$ gawk <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">&gt; if ($1 &gt; 20) &#123;</span></span><br><span class="line"><span class="string">&gt; x = $1 / 2</span></span><br><span class="line"><span class="string">&gt; print x</span></span><br><span class="line"><span class="string">&gt; &#125; else &#123;</span></span><br><span class="line"><span class="string">&gt; x = $1 * 2</span></span><br><span class="line"><span class="string">&gt; print x</span></span><br><span class="line"><span class="string">&gt; &#125;</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span> data2</span><br><span class="line">20</span><br><span class="line">10</span><br><span class="line">26</span><br><span class="line">25</span><br><span class="line">17</span><br></pre></td></tr></table></figure><ul><li><code>while</code> è¯­å¥</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> data3</span><br><span class="line">130 120 135</span><br><span class="line">160 113 140</span><br><span class="line">145 170 215</span><br><span class="line"></span><br><span class="line">$ gawk <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">total = 0</span></span><br><span class="line"><span class="string">i = 1</span></span><br><span class="line"><span class="string">while (i &lt; 4) &#123;</span></span><br><span class="line"><span class="string">  total += $i</span></span><br><span class="line"><span class="string">  if (i == 2)</span></span><br><span class="line"><span class="string">    break</span></span><br><span class="line"><span class="string">  i++</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">avg = total / 2</span></span><br><span class="line"><span class="string">print &quot;Average:&quot;,avg</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> data3</span><br><span class="line">Average: 125</span><br><span class="line">Average: 136.5</span><br><span class="line">Average: 157.5</span><br></pre></td></tr></table></figure><ul><li><code>do-while</code> è¯­å¥</li><li><code>for</code> è¯­å¥</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ gawk <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">&gt; total = 0</span></span><br><span class="line"><span class="string">&gt; i = 1</span></span><br><span class="line"><span class="string">&gt; for (i = 1; i &lt; 4; i++) &#123;</span></span><br><span class="line"><span class="string">&gt; total += $i</span></span><br><span class="line"><span class="string">&gt; &#125;</span></span><br><span class="line"><span class="string">&gt; avg = total / 3</span></span><br><span class="line"><span class="string">&gt; print &quot;Average:&quot;,avg</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span> data3</span><br><span class="line">Average: 128.333</span><br><span class="line">Average: 137.667</span><br><span class="line">Average: 176.667</span><br></pre></td></tr></table></figure><h2 id="æ ¼å¼åŒ–"><a href="#æ ¼å¼åŒ–" class="headerlink" title="æ ¼å¼åŒ–"></a>æ ¼å¼åŒ–</h2><p>gawkä½¿ç”¨ <code>printf</code> å‘½ä»¤å®ç°æ ¼å¼åŒ–ï¼Œå‘½ä»¤æ ¼å¼ï¼š<code>printf &quot;%[modifier]control-letter ...&quot;, var1, var2 ...</code></p><table><thead><tr><th>æ§åˆ¶å­—æ¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>c</code></td><td>å°†ä¸€ä¸ªæ•°ä½œä¸ºASCIIå­—ç¬¦æ˜¾ç¤º</td></tr><tr><td><code>d</code></td><td>æ˜¾ç¤ºä¸€ä¸ªæ•´æ•°å€¼</td></tr><tr><td><code>i</code></td><td>æ˜¾ç¤ºä¸€ä¸ªæ•´æ•°å€¼ï¼ˆè·Ÿdä¸€æ ·ï¼‰</td></tr><tr><td><code>e</code></td><td>ç”¨ç§‘å­¦è®¡æ•°æ³•æ˜¾ç¤ºä¸€ä¸ªæ•°</td></tr><tr><td><code>f</code></td><td>æ˜¾ç¤ºä¸€ä¸ªæµ®ç‚¹å€¼</td></tr><tr><td><code>g</code></td><td>ç”¨ç§‘å­¦è®¡æ•°æ³•æˆ–æµ®ç‚¹æ•°æ˜¾ç¤ºï¼ˆé€‰æ‹©è¾ƒçŸ­çš„æ ¼å¼ï¼‰</td></tr><tr><td><code>o</code></td><td>æ˜¾ç¤ºä¸€ä¸ªå…«è¿›åˆ¶å€¼</td></tr><tr><td><code>s</code></td><td>æ˜¾ç¤ºä¸€ä¸ªæ–‡æœ¬å­—ç¬¦ä¸²</td></tr><tr><td><code>x</code></td><td>æ˜¾ç¤ºä¸€ä¸ªåå…­è¿›åˆ¶å€¼</td></tr><tr><td><code>X</code></td><td>æ˜¾ç¤ºä¸€ä¸ªåå…­è¿›åˆ¶å€¼ï¼Œä½†ç”¨å¤§å†™å­—æ¯A~F</td></tr></tbody></table><p>é™¤äº†æ§åˆ¶å­—æ¯å¤–ï¼Œè¿˜æœ‰3ç§ä¿®é¥°ç¬¦å¯ä»¥ç”¨æ¥è¿›ä¸€æ­¥æ§åˆ¶è¾“å‡ºã€‚</p><ul><li><p>widthï¼šæŒ‡å®šäº†è¾“å‡ºå­—æ®µæœ€å°å®½åº¦çš„æ•°å­—å€¼ã€‚å¦‚æœè¾“å‡ºçŸ­äºè¿™ä¸ªå€¼ï¼Œprintfä¼šå°†æ–‡æœ¬å³å¯¹é½ï¼Œå¹¶ç”¨ç©ºæ ¼è¿›è¡Œå¡«å……ã€‚å¦‚æœè¾“å‡ºæ¯”æŒ‡å®šçš„å®½åº¦è¿˜è¦é•¿ï¼Œåˆ™æŒ‰ç…§å®é™…çš„é•¿åº¦è¾“å‡ºã€‚</p></li><li><p>precï¼šæŒ‡å®šäº†æµ®ç‚¹æ•°ä¸­å°æ•°ç‚¹åé¢ä½æ•°ï¼Œæˆ–è€…æ–‡æœ¬å­—ç¬¦ä¸²ä¸­æ˜¾ç¤ºçš„æœ€å¤§å­—ç¬¦æ•°ã€‚</p></li><li><p>-ï¼ˆå‡å·ï¼‰ï¼šé‡‡ç”¨å·¦å¯¹é½ï¼ˆé»˜è®¤å³å¯¹é½ï¼‰ã€‚</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> data4</span><br><span class="line">Riley Mullen</span><br><span class="line">123 Main Street</span><br><span class="line">Chicago, IL 60601</span><br><span class="line">(312)555-1234</span><br><span class="line"></span><br><span class="line">Frank Williams</span><br><span class="line">456 Oak Street</span><br><span class="line">Indianapolis, IN 46201</span><br><span class="line">(317)555-9876</span><br><span class="line"></span><br><span class="line">Haley Snell</span><br><span class="line">4231 Elm Street</span><br><span class="line">Detroit, MI 48201</span><br><span class="line">(313)555-4938</span><br><span class="line"></span><br><span class="line">$ gawk <span class="string">&#x27;BEGIN&#123;FS=&quot;\n&quot;; RS=&quot;&quot;&#125; &#123;printf &quot;%-14s  %s\n&quot;, $1, $4&#125;&#x27;</span> data4</span><br><span class="line">Riley Mullen    (312)555-1234</span><br><span class="line">Frank Williams  (317)555-9876</span><br><span class="line">Haley Snell     (313)555-4938</span><br><span class="line"></span><br><span class="line">$ gawk <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">&gt; total = 0</span></span><br><span class="line"><span class="string">&gt; for (i = 1; i &lt; 4; i++) &#123;</span></span><br><span class="line"><span class="string">&gt; total += $i</span></span><br><span class="line"><span class="string">&gt; &#125;</span></span><br><span class="line"><span class="string">&gt; avg = total / 3</span></span><br><span class="line"><span class="string">&gt; printf &quot;Average: %5.1f\n&quot;,avg</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span> data3</span><br><span class="line">Average: 128.3</span><br><span class="line">Average: 137.7</span><br><span class="line">Average: 176.7</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gawk </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sedåŸºç¡€</title>
      <link href="/post/59cc7134.html"/>
      <url>/post/59cc7134.html</url>
      
        <content type="html"><![CDATA[<p><code>sed</code> ç¼–è¾‘å™¨å¯ä»¥æ ¹æ®å‘½ä»¤æ¥å¤„ç†æ•°æ®æµä¸­çš„æ•°æ®ï¼Œè¿™äº›å‘½ä»¤è¦ä¹ˆä»å‘½ä»¤è¡Œä¸­è¾“å…¥ï¼Œè¦ä¹ˆå­˜å‚¨åœ¨ä¸€ä¸ªå‘½ä»¤æ–‡æœ¬æ–‡ä»¶ä¸­ã€‚<code>sed</code> ç¼–è¾‘å™¨ä¼šæ‰§è¡Œä¸‹åˆ—æ“ä½œï¼š</p><ol><li>ä¸€æ¬¡ä»è¾“å…¥ä¸­è¯»å–ä¸€è¡Œæ•°æ®ã€‚</li><li>æ ¹æ®æ‰€æä¾›çš„ç¼–è¾‘å™¨å‘½ä»¤åŒ¹é…æ•°æ®ã€‚</li><li>æŒ‰ç…§å‘½ä»¤ä¿®æ”¹æµä¸­çš„æ•°æ®ã€‚</li><li>å°†æ–°çš„æ•°æ®è¾“å‡ºåˆ° <code>STDOUT</code>ã€‚</li></ol><h2 id="å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ"><a href="#å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ" class="headerlink" title="å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ"></a>å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ</h2><h3 id="æ¨¡å¼ç©ºé—´å’Œä¿æŒç©ºé—´"><a href="#æ¨¡å¼ç©ºé—´å’Œä¿æŒç©ºé—´" class="headerlink" title="æ¨¡å¼ç©ºé—´å’Œä¿æŒç©ºé—´"></a>æ¨¡å¼ç©ºé—´å’Œä¿æŒç©ºé—´</h3><p>æ¨¡å¼ç©ºé—´ï¼ˆPattern Spaceï¼‰æ˜¯å½“å‰å·¥ä½œçš„ç©ºé—´ï¼Œsedç¼–è¾‘å™¨ä¼šå°†æ•°æ®æµä¸­æ–‡æœ¬è¡Œè¯»å…¥åˆ°æ¨¡å¼ç©ºé—´è¿›è¡Œå¤„ç†ã€‚ä¿æŒç©ºé—´ï¼ˆHold Spaceï¼‰å¯ä»¥çœ‹ä½œæ˜¯æ¨¡å¼ç©ºé—´çš„å¤‡ä»½ç©ºé—´ï¼Œå¯ä»¥å°†æ¨¡å¼ç©ºé—´çš„æŸäº›è¡Œä¸´æ—¶å­˜å‚¨åœ¨ä¿æŒç©ºé—´ï¼Œä¹‹åå†å°†è¿™äº›è¡Œä»ä¿æŒç©ºé—´ç§»å›æ¨¡å¼ç©ºé—´ã€‚</p><p>æ¨¡å¼ç©ºé—´å’Œä¿æŒç©ºé—´çš„äº¤äº’å‘½ä»¤å¦‚ä¸‹ï¼š</p><table><thead><tr><th>å‘½ä»¤</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>h</code></td><td>å°†æ¨¡å¼ç©ºé—´å¤åˆ¶åˆ°ä¿æŒç©ºé—´</td></tr><tr><td><code>H</code></td><td>å°†æ¨¡å¼ç©ºé—´é™„åŠ åˆ°ä¿æŒç©ºé—´</td></tr><tr><td><code>g</code></td><td>å°†ä¿æŒç©ºé—´å¤åˆ¶åˆ°æ¨¡å¼ç©ºé—´</td></tr><tr><td><code>G</code></td><td>å°†ä¿æŒç©ºé—´é™„åŠ åˆ°æ¨¡å¼ç©ºé—´</td></tr><tr><td><code>X</code></td><td>äº¤ä»˜ä¸¤ä¸ªç©ºé—´çš„å†…å®¹</td></tr></tbody></table><h3 id="åœ°å€"><a href="#åœ°å€" class="headerlink" title="åœ°å€"></a>åœ°å€</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨sedç¼–è¾‘å™¨ä¸­ä½¿ç”¨çš„å‘½ä»¤ä¼šä½œç”¨äºæ–‡æœ¬æ•°æ®çš„æ‰€æœ‰è¡Œã€‚å¦‚æœåªæƒ³å°†å‘½ä»¤ä½œç”¨äºç‰¹å®šè¡Œæˆ–æŸäº›è¡Œï¼Œåˆ™å¿…é¡»ç”¨è¡Œå¯»å€ï¼ˆline addressingï¼‰ã€‚åœ¨sedç¼–è¾‘å™¨ä¸­æœ‰ä¸¤ç§å½¢å¼çš„è¡Œå¯»å€ï¼š</p><ul><li>ä»¥æ•°å­—å½¢å¼è¡¨ç¤ºè¡ŒåŒºé—´</li><li>ç”¨æ–‡æœ¬æ¨¡å¼æ¥è¿‡æ»¤å‡ºè¡Œ</li></ul><h4 id="æ•°å­—å½¢å¼è¡Œå¯»å€"><a href="#æ•°å­—å½¢å¼è¡Œå¯»å€" class="headerlink" title="æ•°å­—å½¢å¼è¡Œå¯»å€"></a>æ•°å­—å½¢å¼è¡Œå¯»å€</h4><ul><li>æŒ‡å®šæŸè¡Œï¼š<code>sed &#39;2command&#39; file</code></li><li>æŒ‡å®šè¡ŒåŒºé—´ï¼š<code>sed &#39;2,3command&#39; file</code></li><li>ä»æŸè¡Œå¼€å§‹åˆ°ç»“å°¾ï¼š<code>sed &#39;2,$command&#39; file</code></li></ul><h4 id="æ–‡æœ¬æ¨¡å¼è¡Œå¯»å€"><a href="#æ–‡æœ¬æ¨¡å¼è¡Œå¯»å€" class="headerlink" title="æ–‡æœ¬æ¨¡å¼è¡Œå¯»å€"></a>æ–‡æœ¬æ¨¡å¼è¡Œå¯»å€</h4><ul><li>åŒ¹é…æŸè¡Œï¼š<code>sed &#39;/pattern/command&#39; file</code></li><li>åŒ¹é…è¡ŒåŒºé—´ï¼š<code>sed &#39;/start/[,/end/]command&#39; file</code></li></ul><h2 id="åŸºæœ¬å‘½ä»¤"><a href="#åŸºæœ¬å‘½ä»¤" class="headerlink" title="åŸºæœ¬å‘½ä»¤"></a>åŸºæœ¬å‘½ä»¤</h2><h3 id="æ›¿æ¢ï¼šs"><a href="#æ›¿æ¢ï¼šs" class="headerlink" title="æ›¿æ¢ï¼šs"></a>æ›¿æ¢ï¼šs</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># data1.txt</span></span><br><span class="line">$ <span class="built_in">cat</span> data1.txt</span><br><span class="line">The quick brown fox jumps over the lazy dog.</span><br><span class="line">The quick brown fox jumps over the lazy dog.</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å•ä¸ªç¼–è¾‘å™¨å‘½ä»¤</span></span><br><span class="line">$ sed <span class="string">&quot;s/dog/cat/&quot;</span> data1.txt</span><br><span class="line">The quick brown fox jumps over the lazy <span class="built_in">cat</span>.</span><br><span class="line">The quick brown fox jumps over the lazy <span class="built_in">cat</span>.</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤šä¸ªç¼–è¾‘å™¨å‘½ä»¤</span></span><br><span class="line">$ sed <span class="string">&#x27;s/brown/green/; s/dog/cat/&#x27;</span> data1.txt</span><br><span class="line">The quick green fox jumps over the lazy <span class="built_in">cat</span>.</span><br><span class="line">The quick green fox jumps over the lazy <span class="built_in">cat</span>.</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> script1.sed</span><br><span class="line">s/brown/green/</span><br><span class="line">s/dog/cat/</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡ -f é€‰é¡¹ä»æ–‡ä»¶ä¸­è¯»å–ç¼–è¾‘å™¨å‘½ä»¤</span></span><br><span class="line">$ sed -f script1.sed data1.txt</span><br><span class="line">The quick green fox jumps over the lazy <span class="built_in">cat</span>.</span><br><span class="line">The quick green fox jumps over the lazy <span class="built_in">cat</span>.</span><br></pre></td></tr></table></figure><p>æ›¿æ¢å‘½ä»¤é»˜è®¤åªæ›¿æ¢ç¬¬ä¸€å¤„å‡ºç°çš„æ–‡æœ¬ï¼Œè¦æƒ³æ›¿æ¢å‡ºç°çš„æ‰€æœ‰æ–‡æœ¬å¿…é¡»ä½¿ç”¨<strong>æ›¿æ¢æ ‡è®°</strong>ï¼Œä½¿ç”¨æ–¹å¼ï¼š<code>s/pattern/replacement/flags</code>ã€‚</p><p>æ›¿æ¢æ ‡è®°æœ‰å¦‚ä¸‹2ç§ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># data2.txt</span></span><br><span class="line">$ <span class="built_in">cat</span> data2.txt</span><br><span class="line">This is a <span class="built_in">test</span> of the <span class="built_in">test</span> script.</span><br><span class="line">This is the second <span class="built_in">test</span> of the <span class="built_in">test</span> script.</span><br></pre></td></tr></table></figure><ul><li><p>æ•°å­—ï¼šæŒ‡å®šæ›¿æ¢ç¬¬å‡ ä¸ªå‡ºç°çš„æ–‡æœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;s/test/trial/2&#x27;</span> data2.txt</span><br><span class="line">This is a <span class="built_in">test</span> of the trial script.</span><br><span class="line">This is the second <span class="built_in">test</span> of the trial script.</span><br></pre></td></tr></table></figure></li><li><p><code>g</code>ï¼šæ›¿æ¢æ‰€æœ‰å‡ºç°çš„æ–‡æœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;s/test/trial/g&#x27;</span> data2.txt</span><br><span class="line">This is a trial of the trial script.</span><br><span class="line">This is the second trial of the trial script.</span><br></pre></td></tr></table></figure></li></ul><h3 id="åˆ é™¤ï¼šd"><a href="#åˆ é™¤ï¼šd" class="headerlink" title="åˆ é™¤ï¼šd"></a>åˆ é™¤ï¼šd</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># data3.txt</span></span><br><span class="line">$ <span class="built_in">cat</span> data3.txt</span><br><span class="line">This is line number 1.</span><br><span class="line">This is line number 2.</span><br><span class="line">This is line number 3.</span><br><span class="line">This is line number 4.</span><br></pre></td></tr></table></figure><ul><li>åˆ é™¤ç¬¬3è¡Œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;3d&#x27;</span> data3.txt</span><br><span class="line">This is line number 1.</span><br><span class="line">This is line number 2.</span><br><span class="line">This is line number 4.</span><br></pre></td></tr></table></figure><ul><li>åˆ é™¤ç¬¬2ï½3è¡Œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;2,3d&#x27;</span> data3.txt</span><br><span class="line">This is line number 1.</span><br><span class="line">This is line number 4.</span><br></pre></td></tr></table></figure><ul><li>åˆ é™¤ä»ç¬¬2è¡Œå¼€å§‹çš„æ‰€æœ‰è¡Œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;2,$d&#x27;</span> data3.txt</span><br><span class="line">This is line number 1.</span><br></pre></td></tr></table></figure><ul><li>åˆ é™¤åŒ¹é…åˆ°æ–‡æœ¬çš„è¡Œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;/number 1/d&#x27;</span> data3.txt</span><br><span class="line">This is line number 2.</span><br><span class="line">This is line number 3.</span><br><span class="line">This is line number 4.</span><br></pre></td></tr></table></figure><ul><li>åˆ é™¤æ–‡æœ¬ä¸­çš„ç©ºè¡Œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># data4.txt</span></span><br><span class="line">$ <span class="built_in">cat</span> data4.txt</span><br><span class="line">This is line number 1.</span><br><span class="line"></span><br><span class="line">This is line number 2.</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;/^$/d&#x27;</span> data4.txt</span><br><span class="line">This is line number 1.</span><br><span class="line">This is line number 2.</span><br></pre></td></tr></table></figure><h3 id="æ’å…¥ï¼ši"><a href="#æ’å…¥ï¼ši" class="headerlink" title="æ’å…¥ï¼ši"></a>æ’å…¥ï¼ši</h3><ul><li>æ’å…¥ä¸€è¡Œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;Test Line 2&quot;</span> | sed <span class="string">&#x27;i Test Line 1&#x27;</span></span><br><span class="line">Test Line 1</span><br><span class="line">Test Line 2</span><br></pre></td></tr></table></figure><ul><li>æ’å…¥å¤šè¡Œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;Test Line 2&quot;</span> | sed <span class="string">&#x27;i Test Line 1\</span></span><br><span class="line"><span class="string">&gt; Test Line 3&#x27;</span></span><br><span class="line">Test Line 1</span><br><span class="line">Test Line 3</span><br><span class="line">Test Line 2</span><br></pre></td></tr></table></figure><ul><li>åœ¨æ–‡ä»¶å¼€å¤´æ’å…¥</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;1i This is one line of new Text.&#x27;</span> data3.txt</span><br><span class="line">This is one line of new Text.</span><br><span class="line">This is line number 1.</span><br><span class="line">This is line number 2.</span><br><span class="line">This is line number 3.</span><br><span class="line">This is line number 4.</span><br></pre></td></tr></table></figure><h3 id="è¿½åŠ ï¼ša"><a href="#è¿½åŠ ï¼ša" class="headerlink" title="è¿½åŠ ï¼ša"></a>è¿½åŠ ï¼ša</h3><ul><li>è¿½åŠ ä¸€è¡Œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;Test Line 2&quot;</span> | sed <span class="string">&#x27;a Test Line 1&#x27;</span></span><br><span class="line">Test Line 2</span><br><span class="line">Test Line 1</span><br></pre></td></tr></table></figure><ul><li>è¿½åŠ å¤šè¡Œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;Test Line 2&quot;</span> | sed <span class="string">&#x27;a Test Line 1\</span></span><br><span class="line"><span class="string">&gt; Test Line 3&#x27;</span></span><br><span class="line">Test Line 2</span><br><span class="line">Test Line 1</span><br><span class="line">Test Line 3</span><br></pre></td></tr></table></figure><ul><li>åœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ </li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;$a This is one line of new text.&#x27;</span> data3.txt</span><br><span class="line">This is line number 1.</span><br><span class="line">This is line number 2.</span><br><span class="line">This is line number 3.</span><br><span class="line">This is line number 4.</span><br><span class="line">This is one line of new text.</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹è¡Œï¼šc"><a href="#ä¿®æ”¹è¡Œï¼šc" class="headerlink" title="ä¿®æ”¹è¡Œï¼šc"></a>ä¿®æ”¹è¡Œï¼šc</h3><ul><li>ä¿®æ”¹æŒ‡å®šè¡Œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;3c This is a changed line of text.&#x27;</span> data3.txt</span><br><span class="line">This is line number 1.</span><br><span class="line">This is line number 2.</span><br><span class="line">This is a changed line of text.</span><br><span class="line">This is line number 4.</span><br></pre></td></tr></table></figure><ul><li>ä¿®æ”¹åŒ¹é…åˆ°æ¨¡å¼çš„è¡Œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;/number 3/c This is a changed line of text.&#x27;</span> data3.txt</span><br><span class="line">This is line number 1.</span><br><span class="line">This is line number 2.</span><br><span class="line">This is a changed line of text.</span><br><span class="line">This is line number 4.</span><br></pre></td></tr></table></figure><h3 id="è½¬æ¢ï¼šy"><a href="#è½¬æ¢ï¼šy" class="headerlink" title="è½¬æ¢ï¼šy"></a>è½¬æ¢ï¼šy</h3><p><code>sed &#39;[address]y/inchars/outchars/ file&#39;</code>ï¼šå¯¹ <code>inchars</code> å’Œ <code>outchars</code> çš„å€¼è¿›è¡Œä¸€å¯¹ä¸€æ˜ å°„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;y/23/ab/&#x27;</span> data3.txt</span><br><span class="line">This is line number 1.</span><br><span class="line">This is line number a.</span><br><span class="line">This is line number b.</span><br><span class="line">This is line number 4.</span><br></pre></td></tr></table></figure><h3 id="æ‰“å°ï¼šp"><a href="#æ‰“å°ï¼šp" class="headerlink" title="æ‰“å°ï¼šp"></a>æ‰“å°ï¼šp</h3><ul><li>æ‰“å°ç¬¬2è¡Œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sed -n <span class="string">&#x27;2p&#x27;</span> data3.txt</span><br><span class="line">This is line number 2.</span><br></pre></td></tr></table></figure><ul><li>æ‰“å°ç¬¬2ï½3è¡Œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sed -n <span class="string">&#x27;2,3p&#x27;</span> data3.txt</span><br><span class="line">This is line number 2.</span><br><span class="line">This is line number 3.</span><br></pre></td></tr></table></figure><ul><li>æ‰“å°åŒ¹é…åˆ°çš„è¡Œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sed -n <span class="string">&#x27;/number 3/p&#x27;</span> data3.txt</span><br><span class="line">This is line number 3.</span><br></pre></td></tr></table></figure><ul><li>åŒæ—¶æ‰“å°åŸæ¥çš„è¡Œå’Œä¿®æ”¹åçš„è¡Œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sed -n <span class="string">&#x27;/3/&#123;</span></span><br><span class="line"><span class="string">&gt; p</span></span><br><span class="line"><span class="string">&gt; s/line/test/p</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span> data3.txt</span><br><span class="line">This is line number 3.</span><br><span class="line">This is <span class="built_in">test</span> number 3.</span><br></pre></td></tr></table></figure><ul><li>åŒæ¨¡å¼åŒ¹é…ï¼Œå¯ä»¥ç”¨æ¥è¿‡æ»¤å‡ºæŸä¸ªæ—¶é—´æ®µå†…çš„æ—¥å¿—</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sed -n <span class="string">&#x27;/2/,/3/p&#x27;</span> data3.txt</span><br><span class="line">This is line number 2.</span><br><span class="line">This is line number 3.</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æŒ‡å®šæ—¶é—´æ®µå†…çš„æ—¥å¿—</span></span><br><span class="line">$ sed -n <span class="string">&#x27;/2022-11-25T14:15:*/,/2022-11-25T15:*/p&#x27;</span> filename</span><br><span class="line">$ sed -n <span class="string">&#x27;/2024-01-25 08:54:*/,/2024-01-25 08:55:*/p&#x27;</span> filename</span><br></pre></td></tr></table></figure><h3 id="å†™æ–‡ä»¶ï¼šw"><a href="#å†™æ–‡ä»¶ï¼šw" class="headerlink" title="å†™æ–‡ä»¶ï¼šw"></a>å†™æ–‡ä»¶ï¼šw</h3><ul><li>å°†æ•°æ®æ–‡ä»¶çš„ç¬¬1è¡Œå†™å…¥æ–°æ–‡ä»¶</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;1w data3_1.txt&#x27;</span> data3.txt</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> data3_1.txt</span><br><span class="line">This is line number 1.</span><br></pre></td></tr></table></figure><ul><li>å°†æ•°æ®æ–‡ä»¶çš„ç¬¬2ï½3è¡Œå†™å…¥æ–°æ–‡ä»¶</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;2,3w data3_23.txt&#x27;</span> data3.txt</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> data3_23.txt</span><br><span class="line">This is line number 2.</span><br><span class="line">This is line number 3.</span><br></pre></td></tr></table></figure><ul><li>å†™å…¥åŒ¹é…åˆ°çš„è¡Œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;/4/w data3_4.txt&#x27;</span> data3.txt</span><br><span class="line"> </span><br><span class="line">$ <span class="built_in">cat</span> data3_4.txt</span><br><span class="line">This is line number 4.</span><br></pre></td></tr></table></figure><p>PSï¼šé™¤äº†å¯ä»¥é€šè¿‡wå‘½ä»¤å†™æ–‡ä»¶ï¼Œè¿˜å¯ä»¥é€šè¿‡ <code>-i</code> é€‰é¡¹ç›´æ¥ç¼–è¾‘åŸæ–‡ä»¶ã€‚</p><h3 id="ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œï¼šn"><a href="#ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œï¼šn" class="headerlink" title="ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œï¼šn"></a>ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œï¼šn</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># data5.txt</span></span><br><span class="line">$ <span class="built_in">cat</span> data5.txt</span><br><span class="line">This is the header line.</span><br><span class="line"></span><br><span class="line">This is a data line.</span><br><span class="line"></span><br><span class="line">This is the last line.</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„ï¼šæœ‰äº›ç³»ç»Ÿéœ€åœ¨dåé¢åŠ ä¸€ä¸ªåˆ†å·;</span></span><br><span class="line">$ sed <span class="string">&#x27;/header/&#123;n; d&#125;&#x27;</span> data5.txt</span><br><span class="line">This is the header line.</span><br><span class="line">This is a data line.</span><br><span class="line"></span><br><span class="line">This is the last line.</span><br></pre></td></tr></table></figure><p>å‘½ä»¤è§£é‡Šï¼šè¦åˆ é™¤ç¬¬1è¡Œå’Œç¬¬3è¡Œä¹‹é—´çš„ç©ºç™½è¡Œï¼Œéœ€å…ˆæ ¹æ®<code>/header/</code>åŒ¹é…åˆ°ç¬¬1è¡Œï¼Œå†ç”¨nå‘½ä»¤è®©sedç¼–è¾‘å™¨ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œï¼Œæœ€åç”¨då‘½ä»¤åˆ é™¤ç©ºç™½è¡Œã€‚</p><h3 id="è¿½åŠ ä¸‹ä¸€è¡Œï¼šN"><a href="#è¿½åŠ ä¸‹ä¸€è¡Œï¼šN" class="headerlink" title="è¿½åŠ ä¸‹ä¸€è¡Œï¼šN"></a>è¿½åŠ ä¸‹ä¸€è¡Œï¼šN</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># data6.txt</span></span><br><span class="line">$ <span class="built_in">cat</span> data6.txt</span><br><span class="line">This is the header line.</span><br><span class="line">This is the first data line.</span><br><span class="line">This is the second data line.</span><br><span class="line">This is the last line.</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;/first/&#123;N ; s/\n/ /&#125;&#x27;</span> data6.txt</span><br><span class="line">This is the header line.</span><br><span class="line">This is the first data line. This is the second data line.</span><br><span class="line">This is the last line.</span><br></pre></td></tr></table></figure><p>å‘½ä»¤è§£é‡Šï¼šå°å†™çš„nå‘½ä»¤è®©sedç¼–è¾‘å™¨ç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œï¼Œå¤§å†™çš„Nå‘½ä»¤åˆ™æ˜¯è®©ç¼–è¾‘å™¨å°†ä¸‹ä¸€è¡Œè¿½åŠ åˆ°æ¨¡å¼ç©ºé—´ã€‚å› æ­¤å½“åŒ¹é…åˆ°<code>/first/</code>æ‰€åœ¨çš„è¡Œæ—¶ï¼ŒNå‘½ä»¤è®©sedç¼–è¾‘å™¨ç»§ç»­è¯»å…¥ä¸‹ä¸€è¡Œï¼Œæ­¤æ—¶æ¨¡å¼ç©ºé—´çš„æ–‡æœ¬å†…å®¹æ˜¯ <code>This is the first data line.\nThis is the second data line.</code>ï¼Œæœ€åé€šè¿‡<code>s/\n/ /</code>å‘½ä»¤å°†æ¢è¡Œç¬¦æ›¿æ¢æˆç©ºæ ¼ã€‚è¯¥å‘½ä»¤å‘ˆç°å‡ºæ¥çš„æ•ˆæœå°±æ˜¯åˆå¹¶ä¸¤è¡Œã€‚</p><p>Nå‘½ä»¤çš„ä¸€ç§ä½¿ç”¨åœºæ™¯æ˜¯æŸ¥æ‰¾å¹¶ç¼–è¾‘å¯èƒ½åˆ†æ•£åœ¨å¤šè¡Œçš„çŸ­è¯­ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># data7.txt</span></span><br><span class="line">$ <span class="built_in">cat</span> data7.txt</span><br><span class="line">On Tuesday, the Linux System</span><br><span class="line">Administrator<span class="string">&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="string">All System Administrator should attend.</span></span><br><span class="line"><span class="string">Thank you for your attendance.</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ SED <span class="string">&#x27;N ; s/System.Administrator/Desktop user/&#x27;</span> data7.txt</span><br><span class="line">On Tuesday, the Linux Desktop user<span class="string">&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="string">All Desktop users should attend.</span></span><br><span class="line"><span class="string">Thank you for your attendance.</span></span><br></pre></td></tr></table></figure><p>Nå‘½ä»¤ä¼šæŠŠä¸Šä¸‹ä¸¤è¡Œè¯»å…¥æ¨¡å¼ç©ºé—´ï¼Œå¹¶é€šè¿‡æ¢è¡Œç¬¦<code>\n</code>åˆå¹¶æˆå•è¡Œæ–‡æœ¬ï¼Œæ‰€ä»¥æ¨¡å¼<code>/System.Administrator/</code>å°±å¯ä»¥åŒ¹é…åˆ° <code>System\nAdministrator</code>ï¼Œæœ€åé€šè¿‡så‘½ä»¤æ›¿æ¢æˆ <code>Desktop user</code>ã€‚</p><p>ç”±è¾“å‡ºç»“æœå¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢è¿™æ¡å‘½ä»¤è™½ç„¶åŒ¹é…åˆ°äº†è·¨è¡Œçš„çŸ­è¯­ï¼Œä½†æ˜¯åœ¨æ›¿æ¢ä¹‹åä¼šåˆå¹¶ä¸¤è¡Œï¼Œæœ‰æ—¶è¿™å¯èƒ½ä¸ç¬¦åˆé¢„æœŸã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å¤šæ¡æ›¿æ¢å‘½ä»¤ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;N</span></span><br><span class="line"><span class="string">&gt; s/System\nAdministrator/Desktop\nUser/</span></span><br><span class="line"><span class="string">&gt; s/System Administrator/Desktop User/</span></span><br><span class="line"><span class="string">&gt; &#x27;</span> data7.txt</span><br><span class="line">On Tuesday, the Linux Desktop</span><br><span class="line">User<span class="string">&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="string">All Desktop Users should attend.</span></span><br><span class="line"><span class="string">Thank you for your attendance.</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™æ¡å‘½ä»¤æ—¢å®Œæˆäº†è·¨è¡ŒçŸ­è¯­çš„æ›¿æ¢ï¼Œåˆä¸ä¼šåˆå¹¶ä¸¤è¡Œï¼Œä½†æ˜¯è¿™æ¡å‘½ä»¤ä»ç„¶æœ‰ç‚¹é—®é¢˜ï¼Œå‡è®¾æ•°æ®æ–‡ä»¶å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># data8.txt</span></span><br><span class="line">$ <span class="built_in">cat</span> data8.txt</span><br><span class="line">On Tuesday, the Linux System</span><br><span class="line">Administrator<span class="string">&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="string">All System Administrator should attend.</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ‰§è¡Œä¸Šé¢è¿™æ¡å‘½ä»¤ä¼šå‘ç°ï¼Œæœ€åä¸€è¡Œçš„çš„<code>System Administrators</code>æ²¡æœ‰æ›¿æ¢æˆåŠŸã€‚è¿™æ˜¯å› ä¸ºè™½ç„¶åŒ¹é…åˆ°è¯¥è¡Œï¼Œä½†æ˜¯æ²¡æœ‰ä¸‹ä¸€è¡Œäº†ï¼ŒNå‘½ä»¤ä¼šç»ˆæ­¢åç»­å‘½ä»¤çš„æ‰§è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;N</span></span><br><span class="line"><span class="string">&gt; s/System\nAdministrator/Desktop\nUser/</span></span><br><span class="line"><span class="string">&gt; s/System Administrator/Desktop User/</span></span><br><span class="line"><span class="string">&gt; &#x27;</span> data8.txt</span><br><span class="line">On Tuesday, the Linux Desktop</span><br><span class="line">User<span class="string">&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="string">All System Administrators should attend.</span></span><br></pre></td></tr></table></figure><p>è¦è§£å†³è¿™ä¸ªå‘½ä»¤ï¼Œéœ€è¦ç”¨åˆ°æ’é™¤å‘½ä»¤<code>!</code>ï¼Œå½“é‡åˆ°æ–‡ä»¶æœ€åä¸€è¡Œï¼Œç¦æ­¢Nå‘½ä»¤æ‰§è¡Œå³å¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;$!N;</span></span><br><span class="line"><span class="string">&gt; s/System\nAdministrator/Desktop\nUser/</span></span><br><span class="line"><span class="string">&gt; s/System Administrator/Desktop User/</span></span><br><span class="line"><span class="string">&gt; &#x27;</span> data8.txt</span><br><span class="line">On Tuesday, the Linux Desktop</span><br><span class="line">User<span class="string">&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="string">All Desktop Users should attend.</span></span><br></pre></td></tr></table></figure><h3 id="å¤šè¡Œåˆ é™¤ï¼šD"><a href="#å¤šè¡Œåˆ é™¤ï¼šD" class="headerlink" title="å¤šè¡Œåˆ é™¤ï¼šD"></a>å¤šè¡Œåˆ é™¤ï¼šD</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;N; /System\nAdministrator/d&#x27;</span> data8.txt</span><br><span class="line">All System Administrators should attend.</span><br></pre></td></tr></table></figure><p>å½“Nå‘½ä»¤å’Œdå‘½ä»¤ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œä¼šæŠŠå½“å‰æ¨¡å¼ç©ºé—´ä¸­çš„å†…å®¹å…¨éƒ¨åˆ é™¤ï¼Œè¿™æœªå¿…ç¬¦åˆé¢„æœŸã€‚sedæä¾›äº†åªå¤§å†™çš„Då‘½ä»¤ï¼Œåªåˆ é™¤æ¨¡å¼ç©ºé—´ä¸­çš„ç¬¬ä¸€è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;N; /System\nAdministrator/D&#x27;</span> data8.txt</span><br><span class="line">Administrator<span class="string">&#x27;s group meeting will be held.</span></span><br><span class="line"><span class="string">All System Administrators should attend.</span></span><br></pre></td></tr></table></figure><h3 id="æ’é™¤å‘½ä»¤ï¼š"><a href="#æ’é™¤å‘½ä»¤ï¼š" class="headerlink" title="æ’é™¤å‘½ä»¤ï¼š!"></a>æ’é™¤å‘½ä»¤ï¼š!</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sed -n <span class="string">&#x27;/header/!p&#x27;</span> data6.txt</span><br><span class="line">This is the first data line.</span><br><span class="line">This is the second data line.</span><br><span class="line">This is the last line.</span><br><span class="line"></span><br><span class="line">$ sed -n <span class="string">&#x27;2,3!p&#x27;</span> data6.txt</span><br><span class="line">This is the header line.</span><br><span class="line">This is the last line.</span><br></pre></td></tr></table></figure><h3 id="åˆ†æ”¯å‘½ä»¤ï¼šb"><a href="#åˆ†æ”¯å‘½ä»¤ï¼šb" class="headerlink" title="åˆ†æ”¯å‘½ä»¤ï¼šb"></a>åˆ†æ”¯å‘½ä»¤ï¼šb</h3><p>åˆ†æ”¯å‘½ä»¤æ ¼å¼ï¼š<code>[address]b [label]</code></p><p><code>address</code> å‚æ•°å†³å®šäº†å“ªäº›è¡Œçš„æ•°æ®ä¼šè§¦å‘åˆ†æ”¯å‘½ä»¤ã€‚<code>label</code> å‚æ•°å®šä¹‰äº†è¦è·³è½¬åˆ°çš„ä½ç½®ã€‚å¦‚æœæ²¡æœ‰åŠ  <code>label</code> å‚æ•°ï¼Œè·³è½¬å‘½ä»¤ä¼šè·³è½¬åˆ°è„šæœ¬çš„ç»“å°¾ã€‚</p><ul><li>ä¸å¸¦ <code>label</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·³è¿‡ç¬¬2ï½3è¡Œï¼Œä¸æ‰§è¡Œåç»­å‘½ä»¤</span></span><br><span class="line">$ sed <span class="string">&#x27;2,3b</span></span><br><span class="line"><span class="string">&gt; s/This is/Is this/</span></span><br><span class="line"><span class="string">&gt; s/line./test?/</span></span><br><span class="line"><span class="string">&gt; &#x27;</span> data6.txt</span><br><span class="line">Is this the header <span class="built_in">test</span>?</span><br><span class="line">This is the first data line.</span><br><span class="line">This is the second data line.</span><br><span class="line">Is this the last <span class="built_in">test</span>?</span><br></pre></td></tr></table></figure><ul><li>å¸¦ <code>label</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·³è½¬å‘½ä»¤æŒ‡å®šå¦‚æœæ–‡æœ¬è¡Œä¸­å‡ºç°äº†firstï¼Œç¨‹åºåº”è¯¥è·³åˆ°æ ‡ç­¾ä¸ºjump1çš„è„šæœ¬è¡Œã€‚</span></span><br><span class="line"><span class="comment"># å¦‚æœåˆ†æ”¯å‘½ä»¤çš„æ¨¡å¼æ²¡æœ‰åŒ¹é…ï¼Œsedç¼–è¾‘å™¨ä¼šç»§ç»­æ‰§è¡Œè„šæœ¬ä¸­çš„å‘½ä»¤ï¼ŒåŒ…æ‹¬åˆ†æ”¯æ ‡ç­¾åçš„å‘½ä»¤</span></span><br><span class="line">$ sed <span class="string">&#x27;/first/b jump1</span></span><br><span class="line"><span class="string">&gt; s/This is the/No jump on/</span></span><br><span class="line"><span class="string">&gt; :jump1</span></span><br><span class="line"><span class="string">&gt; s/This is the/Jump here on/</span></span><br><span class="line"><span class="string">&gt; &#x27;</span> data6.txt</span><br><span class="line">No jump on header line.</span><br><span class="line">Jump here on first data line.</span><br><span class="line">No jump on second data line.</span><br><span class="line">No jump on last line.</span><br></pre></td></tr></table></figure><p>å¾ªç¯åˆ é™¤æ–‡æœ¬ä¸­çš„é€—å·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;This, is, a, test, to, remove, commas.&quot;</span> | sed -n <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">:start</span></span><br><span class="line"><span class="string">s/,//1p</span></span><br><span class="line"><span class="string">/,/b start</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line">This is, a, <span class="built_in">test</span>, to, remove, commas.</span><br><span class="line">This is a, <span class="built_in">test</span>, to, remove, commas.</span><br><span class="line">This is a <span class="built_in">test</span>, to, remove, commas.</span><br><span class="line">This is a <span class="built_in">test</span> to, remove, commas.</span><br><span class="line">This is a <span class="built_in">test</span> to remove, commas.</span><br><span class="line">This is a <span class="built_in">test</span> to remove commas.</span><br></pre></td></tr></table></figure><p>ä¸ºäº†é˜²æ­¢æ— é™å¾ªç¯ï¼Œ<code>b start</code> å‰éœ€åŠ è¡Œæ¨¡å¼ <code>/,/</code>ï¼Œåªæœ‰æ–‡æœ¬ä¸­è¿˜å­˜åœ¨é€—å·æ—¶æ‰è·³è½¬ã€‚</p><h3 id="æµ‹è¯•å‘½ä»¤ï¼št"><a href="#æµ‹è¯•å‘½ä»¤ï¼št" class="headerlink" title="æµ‹è¯•å‘½ä»¤ï¼št"></a>æµ‹è¯•å‘½ä»¤ï¼št</h3><p>æµ‹è¯•å‘½ä»¤æ ¼å¼ï¼š<code>[address]t [label]</code></p><p>å¦‚æœæ›¿æ¢å‘½ä»¤æˆåŠŸåŒ¹é…å¹¶æ›¿æ¢äº†ä¸€ä¸ªæ¨¡å¼ï¼Œæµ‹è¯•å‘½ä»¤å°±ä¼šè·³è½¬åˆ°æŒ‡å®šçš„æ ‡ç­¾ã€‚å¦‚æœæ›¿æ¢å‘½ä»¤æœªèƒ½åŒ¹é…æŒ‡å®šçš„æ¨¡å¼ï¼Œæµ‹è¯•å‘½ä»¤å°±ä¸ä¼šè·³è½¬ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;This, is, a, test, to, remove, commas. &quot;</span> | sed -n <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">:start</span></span><br><span class="line"><span class="string">s/,//1p</span></span><br><span class="line"><span class="string">t start</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br><span class="line">This is, a, <span class="built_in">test</span>, to, remove, commas.</span><br><span class="line">This is a, <span class="built_in">test</span>, to, remove, commas.</span><br><span class="line">This is a <span class="built_in">test</span>, to, remove, commas.</span><br><span class="line">This is a <span class="built_in">test</span> to, remove, commas.</span><br><span class="line">This is a <span class="built_in">test</span> to remove, commas.</span><br><span class="line">This is a <span class="built_in">test</span> to remove commas.</span><br></pre></td></tr></table></figure><p><code>t start</code> åªæœ‰åœ¨å‰ä¸€ä¸ªæ›¿æ¢å‘½ä»¤æ‰§è¡ŒæˆåŠŸæ‰æ‰§è¡Œï¼ŒåŒæ ·é¿å…äº†æ— é™å¾ªç¯ã€‚</p><h2 id="å®ç”¨è„šæœ¬"><a href="#å®ç”¨è„šæœ¬" class="headerlink" title="å®ç”¨è„šæœ¬"></a>å®ç”¨è„šæœ¬</h2><h3 id="å€’åºè¾“å‡ºæ–‡ä»¶å†…å®¹"><a href="#å€’åºè¾“å‡ºæ–‡ä»¶å†…å®¹" class="headerlink" title="å€’åºè¾“å‡ºæ–‡ä»¶å†…å®¹"></a>å€’åºè¾“å‡ºæ–‡ä»¶å†…å®¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sed -n <span class="string">&#x27;1!G; h; $p&#x27;</span> data6.txt</span><br><span class="line">This is the last line.</span><br><span class="line">This is the second data line.</span><br><span class="line">This is the first data line.</span><br><span class="line">This is the header line.</span><br></pre></td></tr></table></figure><h3 id="ç»™æ–‡ä»¶çš„è¡Œç¼–å·"><a href="#ç»™æ–‡ä»¶çš„è¡Œç¼–å·" class="headerlink" title="ç»™æ–‡ä»¶çš„è¡Œç¼–å·"></a>ç»™æ–‡ä»¶çš„è¡Œç¼–å·</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;=&#x27;</span> data6.txt</span><br><span class="line">1</span><br><span class="line">This is the header line.</span><br><span class="line">2</span><br><span class="line">This is the first data line.</span><br><span class="line">3</span><br><span class="line">This is the second data line.</span><br><span class="line">4</span><br><span class="line">This is the last line.</span><br></pre></td></tr></table></figure><p>sedç¼–è¾‘å™¨çš„<code>=</code>å‘½ä»¤ä¼šåœ¨æ¯ä¸€è¡Œæ–‡æœ¬å‰è¾“å‡ºä¸€ä¸ªè¡Œå·ï¼Œä½†æ˜¯è¡Œå·ä¸æ–‡æœ¬è·¨è¡Œï¼Œéœ€è¦è¿›è¡Œåˆå¹¶å¤„ç†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;=&#x27;</span> data6.txt | sed <span class="string">&#x27;N; s/\n/ /g&#x27;</span></span><br><span class="line">1 This is the header line.</span><br><span class="line">2 This is the first data line.</span><br><span class="line">3 This is the second data line.</span><br><span class="line">4 This is the last line.</span><br></pre></td></tr></table></figure><p>æœ‰äº›shellå‘½ä»¤ä¹Ÿå¯ä»¥æ·»åŠ è¡Œå·ï¼Œä½†æ˜¯å¯èƒ½ä¼šåŠ å…¥ä¸€äº›ä¸éœ€è¦çš„ç©ºæ ¼ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">nl</span> data6.txt</span><br><span class="line">     1  This is the header line.</span><br><span class="line">     2  This is the first data line.</span><br><span class="line">     3  This is the second data line.</span><br><span class="line">     4  This is the last line.</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> -n data6.txt</span><br><span class="line">     1  This is the header line.</span><br><span class="line">     2  This is the first data line.</span><br><span class="line">     3  This is the second data line.</span><br><span class="line">     4  This is the last line.</span><br></pre></td></tr></table></figure><h3 id="æ’å…¥ç©ºç™½è¡Œ"><a href="#æ’å…¥ç©ºç™½è¡Œ" class="headerlink" title="æ’å…¥ç©ºç™½è¡Œ"></a>æ’å…¥ç©ºç™½è¡Œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sed <span class="string">&#x27;$!G&#x27;</span> data6.txt</span><br><span class="line">This is the header line.</span><br><span class="line"></span><br><span class="line">This is the first data line.</span><br><span class="line"></span><br><span class="line">This is the second data line.</span><br><span class="line"></span><br><span class="line">This is the last line.</span><br></pre></td></tr></table></figure><p>å½“å¯åŠ¨sedç¼–è¾‘å™¨æ—¶ï¼Œä¿æŒç©ºé—´é»˜è®¤æœ‰ä¸€ä¸ªç©ºè¡Œï¼Œsedç¼–è¾‘å™¨åœ¨å¤„ç†æ¯ä¸€è¡Œæ•°æ®æ—¶ï¼Œ<code>G</code>å‘½ä»¤ä¼šå°†ä¿æŒç©ºé—´å†…å®¹é™„åŠ åˆ°æ¨¡å¼ç©ºé—´å†…å®¹åã€‚</p><p>ä¸Šé¢è¿™ä¸ªå‘½ä»¤ä¼šæœ‰ä¸€ç‚¹å°é—®é¢˜ï¼Œå¦‚æœæ–‡æœ¬è¡Œä¹‹é—´å·²ç»æœ‰ç©ºè¡Œï¼Œç©ºè¡Œä¼šåŠ å€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># data9.txt</span></span><br><span class="line">$ <span class="built_in">cat</span> data9.txt</span><br><span class="line">This is the header line.</span><br><span class="line">This is the first data line.</span><br><span class="line"></span><br><span class="line">This is the second data line.</span><br><span class="line">This is the last line.</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;$!G&#x27;</span> data9.txt</span><br><span class="line">This is the header line.</span><br><span class="line"></span><br><span class="line">This is the first data line.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">This is the second data line.</span><br><span class="line"></span><br><span class="line">This is the last line.</span><br></pre></td></tr></table></figure><p>è§£å†³åŠæ³•æ˜¯å…ˆåˆ é™¤æ‰€æœ‰ç©ºç™½è¡Œå†æ’å…¥ç©ºç™½è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;/^$/d; $!G&#x27;</span> data9.txt</span><br><span class="line">This is the header line.</span><br><span class="line"></span><br><span class="line">This is the first data line.</span><br><span class="line"></span><br><span class="line">This is the second data line.</span><br><span class="line"></span><br><span class="line">This is the last line.</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤ç©ºç™½è¡Œ"><a href="#åˆ é™¤ç©ºç™½è¡Œ" class="headerlink" title="åˆ é™¤ç©ºç™½è¡Œ"></a>åˆ é™¤ç©ºç™½è¡Œ</h3><h4 id="åˆ é™¤å¤šä½™çš„ç©ºç™½è¡Œ"><a href="#åˆ é™¤å¤šä½™çš„ç©ºç™½è¡Œ" class="headerlink" title="åˆ é™¤å¤šä½™çš„ç©ºç™½è¡Œ"></a>åˆ é™¤å¤šä½™çš„ç©ºç™½è¡Œ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># data10.txt</span></span><br><span class="line">$ <span class="built_in">cat</span> data10.txt</span><br><span class="line">This is line one.</span><br><span class="line"></span><br><span class="line">This is line two.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">This is line three.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">This is line four.</span><br></pre></td></tr></table></figure><p><code>/./,/^$/</code>ï¼Œè¯¥æ¨¡å¼æœç´¢æœ‰å­—ç¬¦çš„è¡Œå’Œç©ºç™½è¡Œï¼Œè¿™ä¸ªè¡ŒåŒºé—´çš„è¡Œä¸ä¼šè¢«åˆ é™¤ï¼Œå› æ­¤ä¸åœ¨è¿™ä¸ªè¡ŒåŒºé—´çš„å¤šä½™ç©ºç™½è¡Œä¼šè¢«åˆ é™¤ã€‚ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;/./,/^$/!d&#x27;</span> data10.txt</span><br><span class="line">This is line one.</span><br><span class="line"></span><br><span class="line">This is line two.</span><br><span class="line"></span><br><span class="line">This is line three.</span><br><span class="line"></span><br><span class="line">This is line four.</span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤å¼€å¤´çš„ç©ºç™½è¡Œ"><a href="#åˆ é™¤å¼€å¤´çš„ç©ºç™½è¡Œ" class="headerlink" title="åˆ é™¤å¼€å¤´çš„ç©ºç™½è¡Œ"></a>åˆ é™¤å¼€å¤´çš„ç©ºç™½è¡Œ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># data11.txt</span></span><br><span class="line">$ <span class="built_in">cat</span> data11.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">This is line one.</span><br><span class="line"></span><br><span class="line">This is line two.</span><br></pre></td></tr></table></figure><p><code>/./,$!d</code>ï¼Œè¡¨ç¤ºä»ç¬¬ä¸€è¡Œæœ‰å­—ç¬¦çš„è¡Œåˆ°æ–‡ä»¶ç»“å°¾ä¹‹é—´çš„è¡Œä¸ä¼šè¢«åˆ é™¤ï¼Œå› æ­¤å¼€å¤´çš„ç©ºç™½è¡Œä¼šè¢«åˆ é™¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;/./,$!d&#x27;</span> data11.txt</span><br><span class="line">This is line one.</span><br><span class="line"></span><br><span class="line">This is line two.</span><br></pre></td></tr></table></figure><h4 id="åˆ é™¤ç»“å°¾çš„ç©ºç™½è¡Œ"><a href="#åˆ é™¤ç»“å°¾çš„ç©ºç™½è¡Œ" class="headerlink" title="åˆ é™¤ç»“å°¾çš„ç©ºç™½è¡Œ"></a>åˆ é™¤ç»“å°¾çš„ç©ºç™½è¡Œ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># data12.txt</span></span><br><span class="line">$ <span class="built_in">cat</span> data12.txt</span><br><span class="line">This is the first line.</span><br><span class="line">This is the second line.</span><br><span class="line"><span class="comment"># ç©ºè¡Œ</span></span><br><span class="line"><span class="comment"># ç©ºè¡Œ</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">&gt; :start</span></span><br><span class="line"><span class="string">&gt; /^\n*$/&#123;$d; N; b start&#125;</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span> data16.txt</span><br><span class="line">This is the first line.</span><br><span class="line">This is the second line.</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸åŒLinuxç³»ç»Ÿï¼Œsedå‘½ä»¤å®ç°æ–¹å¼å¯èƒ½ç•¥å¾®æœ‰ç‚¹å·®å¼‚</span></span><br><span class="line">$ sed <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">:start</span></span><br><span class="line"><span class="string">/^\n*$/&#123;</span></span><br><span class="line"><span class="string">$d</span></span><br><span class="line"><span class="string">N</span></span><br><span class="line"><span class="string">b start</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;&#x27;</span> data12.txt</span><br><span class="line">This is the first line.</span><br><span class="line">This is the second line.</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤HMTLæ ‡ç­¾"><a href="#åˆ é™¤HMTLæ ‡ç­¾" class="headerlink" title="åˆ é™¤HMTLæ ‡ç­¾"></a>åˆ é™¤HMTLæ ‡ç­¾</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># data13.txt</span></span><br><span class="line">$ <span class="built_in">cat</span> data13.txt</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;title&gt;This is the page title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;p&gt;</span><br><span class="line">This is the &lt;b&gt;first&lt;/b&gt; line <span class="keyword">in</span> the Web page.</span><br><span class="line">This should provide some &lt;i&gt;useful&lt;/i&gt;</span><br><span class="line">information to use <span class="keyword">in</span> our sed script.</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;s/&lt;.*&gt;//g&#x27;</span> data13.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">This is the  line <span class="keyword">in</span> the Web page.</span><br><span class="line">This should provide some</span><br><span class="line">information to use <span class="keyword">in</span> our sed script.</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>/&lt;.*&gt;/</code>æ¨¡å¼ä¼šåŒ¹é…åˆ°<code>&lt;head&gt;</code>ã€<code>&lt;b&gt;first&lt;/b&gt;</code>ç­‰ï¼Œå› æ­¤ä¼šæŠŠ<code>&lt;head&gt;</code>ã€<code>&lt;b&gt;first&lt;/b&gt;</code>éƒ½æ›¿æ¢æˆç©ºå­—ç¬¦ã€‚ä¸ºäº†æ­£ç¡®åœ°åŒ¹é…æ ‡ç­¾ï¼Œ<code>&lt;</code>å’Œ<code>&gt;</code>ä¹‹é—´çš„å†…å®¹ä¸èƒ½åŒ…å«<code>&lt;</code>å’Œ<code>&gt;</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;s/&lt;[^&gt;]*&gt;//g&#x27;</span> data13.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">This is the page title</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">This is the first line <span class="keyword">in</span> the Web page.</span><br><span class="line">This should provide some useful</span><br><span class="line">information to use <span class="keyword">in</span> our sed script.</span><br><span class="line"></span><br><span class="line">$ sed <span class="string">&#x27;s/&lt;[^&lt;]*&gt;//g&#x27;</span> data13.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">This is the page title</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">This is the first line <span class="keyword">in</span> the Web page.</span><br><span class="line">This should provide some useful</span><br><span class="line">information to use <span class="keyword">in</span> our sed script.</span><br></pre></td></tr></table></figure><p>è¿›ä¸€æ­¥å¯ä»¥åˆ é™¤å¤šä½™çš„ç©ºç™½è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;s/&lt;[^&lt;]*&gt;//g; /./,/^$/!d&#x27;</span> data13.txt</span><br><span class="line">This is the page title</span><br><span class="line"></span><br><span class="line">This is the first line <span class="keyword">in</span> the Web page.</span><br><span class="line">This should provide some useful</span><br><span class="line">information to use <span class="keyword">in</span> our sed script.</span><br></pre></td></tr></table></figure><h3 id="æ‰“å°æœ«å°¾nè¡Œ"><a href="#æ‰“å°æœ«å°¾nè¡Œ" class="headerlink" title="æ‰“å°æœ«å°¾nè¡Œ"></a>æ‰“å°æœ«å°¾nè¡Œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> data14.txt</span><br><span class="line">This is line 1.</span><br><span class="line">This is line 2.</span><br><span class="line">This is line 3.</span><br><span class="line">This is line 4.</span><br><span class="line">This is line 5.</span><br><span class="line">This is line 6.</span><br><span class="line">This is line 7.</span><br><span class="line">This is line 8.</span><br><span class="line">This is line 9.</span><br><span class="line">This is line 10.</span><br><span class="line">This is line 11.</span><br><span class="line">This is line 12.</span><br><span class="line">This is line 13.</span><br><span class="line">This is line 14.</span><br><span class="line">This is line 15.</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ sed <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">&gt; :start</span></span><br><span class="line"><span class="string">&gt; $q; N; 11,$D</span></span><br><span class="line"><span class="string">&gt; b start</span></span><br><span class="line"><span class="string">&gt; &#125;&#x27;</span> data14.txt</span><br><span class="line">This is line 6.</span><br><span class="line">This is line 7.</span><br><span class="line">This is line 8.</span><br><span class="line">This is line 9.</span><br><span class="line">This is line 10.</span><br><span class="line">This is line 11.</span><br><span class="line">This is line 12.</span><br><span class="line">This is line 13.</span><br><span class="line">This is line 14.</span><br><span class="line">This is line 15.</span><br></pre></td></tr></table></figure><h3 id="æ‰¹é‡é‡å‘½åæ–‡ä»¶"><a href="#æ‰¹é‡é‡å‘½åæ–‡ä»¶" class="headerlink" title="æ‰¹é‡é‡å‘½åæ–‡ä»¶"></a>æ‰¹é‡é‡å‘½åæ–‡ä»¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> *.txt | sed <span class="string">&#x27;s/\(.*\)\.txt/mv &amp; \1.log/&#x27;</span> | bash</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sed </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vimåŸºç¡€</title>
      <link href="/post/d16c64e7.html"/>
      <url>/post/d16c64e7.html</url>
      
        <content type="html"><![CDATA[<h2 id="åŸºæœ¬å‘½ä»¤"><a href="#åŸºæœ¬å‘½ä»¤" class="headerlink" title="åŸºæœ¬å‘½ä»¤"></a>åŸºæœ¬å‘½ä»¤</h2><h3 id="å¸¸ç”¨"><a href="#å¸¸ç”¨" class="headerlink" title="å¸¸ç”¨"></a>å¸¸ç”¨</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>i</code></td><td>åœ¨å…‰æ ‡å‰æ’å…¥</td></tr><tr><td><code>a</code></td><td>åœ¨å…‰æ ‡åæ’å…¥</td></tr><tr><td><code>o</code></td><td>åœ¨å½“å‰è¡Œåæ’å…¥ä¸€è¡Œ</td></tr><tr><td><code>O</code></td><td>åœ¨å½“å‰è¡Œå‰æ’å…¥ä¸€è¡Œ</td></tr><tr><td><code>esc</code></td><td>è¿”å›Normalæ¨¡å¼ï¼ˆé€€å‡ºç¼–è¾‘ï¼‰</td></tr><tr><td><code>:q</code></td><td>é€€å‡º</td></tr><tr><td><code>:q!</code></td><td>å¼ºåˆ¶é€€å‡º</td></tr><tr><td><code>:wq</code></td><td>ä¿å­˜å¹¶é€€å‡º</td></tr><tr><td><code>hjkl</code></td><td>â†â†“â†‘â†’</td></tr><tr><td><code>u</code></td><td>æ’¤é”€ä¸Šä¸€æ­¥æ“ä½œ</td></tr><tr><td><code>ctrl+r</code></td><td>é‡æ”¾ä¸Šä¸€æ­¥æ“ä½œ</td></tr><tr><td><code>:set number</code></td><td>è®¾ç½®è¡Œå·</td></tr><tr><td><code>:set nonumber</code></td><td>å–æ¶ˆè¡Œå·</td></tr><tr><td><code>G</code></td><td>è·³è½¬åˆ°æœ€åä¸€è¡Œå¼€å¤´</td></tr><tr><td><code>gg</code></td><td>è·³è½¬åˆ°ç¬¬ä¸€è¡Œå¼€å¤´</td></tr><tr><td><code>:n + enter</code></td><td>è·³è½¬åˆ°æŒ‡å®šè¡Œ</td></tr><tr><td><code>n + G</code></td><td>è·³è½¬åˆ°æŒ‡å®šè¡Œ</td></tr></tbody></table><h3 id="å…‰æ ‡ç§»åŠ¨"><a href="#å…‰æ ‡ç§»åŠ¨" class="headerlink" title="å…‰æ ‡ç§»åŠ¨"></a>å…‰æ ‡ç§»åŠ¨</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>0</code></td><td>ç§»åŠ¨å…‰æ ‡åˆ°è¡Œå¤´</td></tr><tr><td><code>$</code></td><td>ç§»åŠ¨å…‰æ ‡åˆ°è¡Œå°¾</td></tr><tr><td><code>^</code></td><td>ç§»åŠ¨å…‰æ ‡åˆ°ç¬¬ä¸€ä¸ªéç©ºå­—ç¬¦</td></tr><tr><td><code>g_</code></td><td>ç§»åŠ¨å…‰æ ‡åˆ°æœ€åä¸€ä¸ªéç©ºå­—ç¬¦</td></tr><tr><td><code>w</code></td><td>ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªå•è¯å¼€å¤´</td></tr><tr><td><code>b</code></td><td>ç§»åŠ¨å…‰æ ‡åˆ°å•è¯å¼€å¤´</td></tr><tr><td><code>B</code></td><td>ç§»åŠ¨å…‰æ ‡åˆ°å•è¯å¼€å¤´ï¼ŒåŒ…å«æ ‡ç‚¹ç¬¦å·</td></tr><tr><td><code>e</code></td><td>ç§»åŠ¨å…‰æ ‡åˆ°å•è¯ç»“å°¾</td></tr><tr><td><code>E</code></td><td>ç§»åŠ¨å…‰æ ‡åˆ°å•è¯ç»“å°¾ï¼ŒåŒ…å«æ ‡ç‚¹ç¬¦å·</td></tr></tbody></table><h3 id="é€‰æ‹©ã€å‰ªåˆ‡ã€æ‹·è´"><a href="#é€‰æ‹©ã€å‰ªåˆ‡ã€æ‹·è´" class="headerlink" title="é€‰æ‹©ã€å‰ªåˆ‡ã€æ‹·è´"></a>é€‰æ‹©ã€å‰ªåˆ‡ã€æ‹·è´</h3><table><thead><tr><th>å…‰æ ‡å‘½ä»¤</th><th>åˆ é™¤å‘½ä»¤</th><th>é€‰æ‹©å‘½ä»¤</th><th>å‰ªåˆ‡å‘½ä»¤</th><th>æ‹·è´å‘½ä»¤</th></tr></thead><tbody><tr><td></td><td></td><td></td><td><code>dd</code></td><td><code>yy</code></td></tr><tr><td><code>0</code></td><td><code>c0</code></td><td><code>v0</code></td><td><code>d0</code></td><td><code>y0</code></td></tr><tr><td><code>$</code></td><td><code>c$</code></td><td><code>v$</code></td><td><code>d$</code></td><td><code>y$</code></td></tr><tr><td><code>w</code></td><td><code>cw</code></td><td><code>vw</code></td><td><code>dw</code></td><td><code>yw</code></td></tr><tr><td><code>b</code></td><td><code>cb</code></td><td><code>vb</code></td><td><code>de</code></td><td><code>ye</code></td></tr><tr><td><code>B</code></td><td><code>cB</code></td><td><code>vB</code></td><td><code>dE</code></td><td><code>yE</code></td></tr><tr><td><code>e</code></td><td><code>ce</code></td><td><code>ve</code></td><td><code>db</code></td><td><code>yb</code></td></tr><tr><td><code>E</code></td><td><code>cE</code></td><td><code>vE</code></td><td><code>dB</code></td><td><code>yB</code></td></tr><tr><td><code>G</code></td><td><code>cG</code></td><td><code>vG</code></td><td><code>dG</code></td><td><code>yG</code></td></tr><tr><td><code>gg</code></td><td><code>cgg</code></td><td><code>vgg</code></td><td><code>dgg</code></td><td><code>ygg</code></td></tr></tbody></table><h3 id="åˆ é™¤å­—ç¬¦"><a href="#åˆ é™¤å­—ç¬¦" class="headerlink" title="åˆ é™¤å­—ç¬¦"></a>åˆ é™¤å­—ç¬¦</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>x</code></td><td>åˆ é™¤å½“å‰å­—ç¬¦</td></tr><tr><td><code>X</code></td><td>åˆ é™¤å‰ä¸€ä¸ªå­—ç¬¦</td></tr></tbody></table><h3 id="å¤åˆ¶"><a href="#å¤åˆ¶" class="headerlink" title="å¤åˆ¶"></a>å¤åˆ¶</h3><table><thead><tr><th>å‘½ä»¤</th><th>ç»„åˆå‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>p</code></td><td><code>x/X</code> + <code>p</code></td><td>å°å†™pï¼Œå°†å‰ªåˆ‡ç‰ˆå†…å®¹å¤åˆ¶åˆ°å½“å‰å…‰æ ‡çš„åé¢</td></tr><tr><td></td><td><code>d./y.</code> + <code>p</code></td><td>å°å†™pï¼Œå°†å‰ªåˆ‡ç‰ˆå†…å®¹å¤åˆ¶åˆ°å½“å‰å…‰æ ‡çš„ä¸‹ä¸€è¡Œ</td></tr><tr><td><code>P</code></td><td><code>x/X</code> + <code>P</code></td><td>å¤§å†™Pï¼Œå°†å‰ªåˆ‡ç‰ˆå†…å®¹å¤åˆ¶åˆ°å½“å‰å…‰æ ‡çš„å‰é¢</td></tr><tr><td></td><td><code>d./y.</code> + <code>P</code></td><td>å¤§å†™Pï¼Œå°†å‰ªåˆ‡ç‰ˆå†…å®¹å¤åˆ¶åˆ°å½“å‰å…‰æ ‡çš„ä¸Šä¸€è¡Œ</td></tr></tbody></table><h3 id="æœç´¢"><a href="#æœç´¢" class="headerlink" title="æœç´¢"></a>æœç´¢</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>/keyword</code> + <code>enter</code></td><td>å‘ä¸‹æœç´¢</td></tr><tr><td><code>?keyword</code> + <code>enter</code></td><td>å‘ä¸Šæœç´¢</td></tr><tr><td><code>n</code></td><td>ä¸‹ä¸€ä¸ªåŒ¹é…é¡¹</td></tr><tr><td><code>N</code></td><td>ä¸Šä¸€ä¸ªåŒ¹é…é¡¹</td></tr></tbody></table><h2 id="è¿›é˜¶å‘½ä»¤"><a href="#è¿›é˜¶å‘½ä»¤" class="headerlink" title="è¿›é˜¶å‘½ä»¤"></a>è¿›é˜¶å‘½ä»¤</h2><h3 id="é‡å¤"><a href="#é‡å¤" class="headerlink" title="é‡å¤"></a>é‡å¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>.</code></td><td>é‡å¤ä¸Šä¸€æ¬¡å‘½ä»¤</td></tr><tr><td><code>n&lt;command&gt;</code></td><td>é‡å¤æŸä¸ªå‘½ä»¤næ¬¡</td></tr></tbody></table><h3 id="å…‰æ ‡ç§»åŠ¨-1"><a href="#å…‰æ ‡ç§»åŠ¨-1" class="headerlink" title="å…‰æ ‡ç§»åŠ¨"></a>å…‰æ ‡ç§»åŠ¨</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>)</code></td><td>ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªå¥å­å¼€å¤´</td></tr><tr><td><code>(</code></td><td>ç§»åŠ¨å…‰æ ‡åˆ°ä¸Šä¸€ä¸ªå¥å­å¼€å¤´</td></tr><tr><td><code>&#125;</code></td><td>ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€æ®µè½å¼€å¤´</td></tr><tr><td><code>&#123;</code></td><td>ç§»åŠ¨å…‰æ ‡åˆ°ä¸Šä¸€æ®µè½å¼€å¤´</td></tr><tr><td><code>*</code></td><td>ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªåŒ¹é…å•è¯</td></tr><tr><td><code>#</code></td><td>ç§»åŠ¨å…‰æ ‡åˆ°ä¸Šä¸€ä¸ªåŒ¹é…å•è¯</td></tr><tr><td><code>f&lt;char&gt;</code></td><td>ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ª<code>&lt;char&gt;</code></td></tr><tr><td><code>t&lt;char&gt;</code></td><td>ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ª<code>&lt;char&gt;</code>çš„å‰ä¸€ä¸ªå­—ç¬¦</td></tr></tbody></table><h3 id="æœç´¢-1"><a href="#æœç´¢-1" class="headerlink" title="æœç´¢"></a>æœç´¢</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>:set hlsearch</code></td><td>å¼€å¯é«˜äº®æ˜¾ç¤º</td></tr><tr><td><code>:nohlsearch</code></td><td>å…³é—­é«˜äº®æ˜¾ç¤º</td></tr><tr><td><code>/\&lt;keyword\&gt;</code></td><td>å…¨è¯åŒ¹é…æœç´¢</td></tr><tr><td><code>:set noignorecae</code></td><td>å¤§å°å†™æ•æ„Ÿï¼ˆé»˜è®¤ï¼‰</td></tr><tr><td><code>:set ignorecase</code></td><td>å¿½ç•¥å¤§å°å†™</td></tr><tr><td><code>/\d</code></td><td>æœç´¢åŒ…å«æ•°å­—çš„è¡Œ</td></tr><tr><td><code>/^keyword</code></td><td>æœç´¢ä»¥<code>keyword</code>å¼€å¤´çš„è¡Œ</td></tr></tbody></table><h3 id="æœç´¢å¹¶æ›¿æ¢"><a href="#æœç´¢å¹¶æ›¿æ¢" class="headerlink" title="æœç´¢å¹¶æ›¿æ¢"></a>æœç´¢å¹¶æ›¿æ¢</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>:%s/foo/bar/g</code></td><td>å…¨æ–‡æ›¿æ¢</td></tr><tr><td><code>:%s/foo/bar/gc</code></td><td>æ›¿æ¢å‰ç¡®è®¤</td></tr><tr><td><code>:%s/foo/bar/gi</code></td><td>å¿½ç•¥å¤§å°å†™</td></tr><tr><td><code>:10,20s/foo/bar/g</code></td><td>æŒ‡å®šèŒƒå›´æ›¿æ¢</td></tr><tr><td><code>:.,$s/foo/bar/g</code></td><td>ä»å½“å‰è¡Œåˆ°æ–‡ä»¶æœ«å°¾æ›¿æ¢</td></tr><tr><td><code>:%s/foo//g</code></td><td>åˆ é™¤åŒ¹é…æ–‡æœ¬</td></tr></tbody></table><h3 id="å¤§å°å†™åˆ‡æ¢"><a href="#å¤§å°å†™åˆ‡æ¢" class="headerlink" title="å¤§å°å†™åˆ‡æ¢"></a>å¤§å°å†™åˆ‡æ¢</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>gu</code>+<code>l(â†’)</code></td><td>å½“å‰å­—ç¬¦å˜å°å†™</td></tr><tr><td><code>gu</code>+<code>enter</code></td><td>å½“å‰è¡Œå˜å°å†™</td></tr><tr><td><code>gU</code>+<code>l(â†’)</code></td><td>å½“å‰å­—ç¬¦å˜å¤§å†™</td></tr><tr><td><code>gU</code>+<code>enter</code></td><td>å½“å‰è¡Œå˜å¤§å†™</td></tr></tbody></table><h2 id="å®ç”¨å‘½ä»¤"><a href="#å®ç”¨å‘½ä»¤" class="headerlink" title="å®ç”¨å‘½ä»¤"></a>å®ç”¨å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>:%</code></td><td>é€‰ä¸­å…¨æ–‡</td></tr><tr><td><code>:%d</code></td><td>åˆ é™¤å…¨æ–‡</td></tr><tr><td><code>:%y</code></td><td>æ‹·è´å…¨æ–‡åˆ°å¯„å­˜å™¨</td></tr><tr><td><code>:%y+</code></td><td>æ‹·è´å…¨æ–‡åˆ°ç³»ç»Ÿå‰ªåˆ‡æ¿</td></tr><tr><td><code>ggVGy</code></td><td>æ‹·è´å…¨æ–‡åˆ°å¯„å­˜å™¨</td></tr><tr><td><code>dt&quot;</code></td><td>åˆ é™¤æ‰€æœ‰çš„å†…å®¹ï¼Œç›´åˆ°é‡åˆ°åŒå¼•å·</td></tr><tr><td><code>y2/foo</code></td><td>æ‹·è´ä¸¤ä¸ª <code>foo</code> ä¹‹é—´çš„å†…å®¹</td></tr></tbody></table><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vim </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­£åˆ™è¡¨è¾¾å¼</title>
      <link href="/post/2f57a694.html"/>
      <url>/post/2f57a694.html</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th>å­—ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>.</code></td><td>åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦</td></tr><tr><td><code>+</code></td><td>åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</td></tr><tr><td><code>?</code></td><td>åŒ¹é…é›¶ä¸ªæˆ–ä¸€ä¸ªå­—ç¬¦</td></tr><tr><td><code>*</code></td><td>åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</td></tr><tr><td><code>&#123;m&#125;</code></td><td>å‰é¢çš„å­—ç¬¦åˆšå¥½å‡ºç°mæ¬¡</td></tr><tr><td><code>&#123;m, n&#125;</code></td><td>å‰é¢çš„å­—ç¬¦å‡ºç°æœ€å°‘mæ¬¡ï¼Œæœ€å¤šnæ¬¡</td></tr><tr><td><code>&#123;m,&#125;</code></td><td>å‰é¢çš„å­—ç¬¦å‡ºç°æœ€å°‘mæ¬¡</td></tr><tr><td><code>[abc]</code></td><td>åŒ¹é… <code>a</code> æˆ– <code>b</code> æˆ– <code>c</code></td></tr><tr><td><code>[^abc]</code></td><td>åŒ¹é…é™¤ <code>abc</code> å¤–çš„å…¶ä»–å­—ç¬¦</td></tr><tr><td><code>[0-5]</code></td><td>åŒ¹é…0ã€1ã€2ã€3ã€4ã€5</td></tr><tr><td><code>[:alnum:]</code></td><td>ç­‰ä»·äº <code>[a-zA-Z0-9]</code></td></tr><tr><td><code>[:digit:]</code></td><td>ç­‰ä»·äº <code>[0-9]</code></td></tr><tr><td><code>[:alpha:]</code></td><td>ç­‰ä»·äº <code>[a-zA-Z]</code></td></tr><tr><td><code>[:lower:]</code></td><td>ç­‰ä»·äº <code>[a-z]</code></td></tr><tr><td><code>[:upper:]</code></td><td>ç­‰ä»·äº <code>[A-Z]</code></td></tr><tr><td><code>[:space:]</code></td><td>ä»»ä½•ä¸€ä¸ªç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼</td></tr><tr><td><code>[:xdigit:]</code></td><td>ä»»ä½•ä¸€ä¸ªåå…­è¿›åˆ¶æ•°ï¼Œç­‰ä»·äº <code>[a-fA-F0-9]</code></td></tr><tr><td><code>^</code></td><td>åŒ¹é…æ–‡æœ¬çš„å¼€å¤´</td></tr><tr><td><code>$</code></td><td>åŒ¹é…æ–‡æœ¬çš„ç»“å°¾</td></tr><tr><td>&#96;cat</td><td>dog&#96;</td></tr></tbody></table><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> æ­£åˆ™è¡¨è¾¾å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ­£åˆ™è¡¨è¾¾å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LinuxåŸºç¡€</title>
      <link href="/post/82734d8.html"/>
      <url>/post/82734d8.html</url>
      
        <content type="html"><![CDATA[<h2 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h2><h3 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h3><p>Linuxæ–‡ä»¶ç³»ç»Ÿç›®å½•ç»“æ„é€šå¸¸å¦‚ä¸‹ï¼š</p><img src="/post/82734d8/image-20240917223411860.png" class="" title="image-20240917223411860"><span id="more"></span><p>ç›®å½•è¯´æ˜ï¼š</p><ul><li>&#x2F;binï¼šå­˜æ”¾åŸºæœ¬çš„ç”¨æˆ·å‘½ä»¤æ–‡ä»¶ï¼Œå¦‚lsã€cpç­‰</li><li>&#x2F;bootï¼šå­˜æ”¾å¯åŠ¨ç³»ç»Ÿæ‰€éœ€æ–‡ä»¶</li><li>&#x2F;devï¼šè®¾å¤‡æ–‡ä»¶</li><li><strong>&#x2F;etcï¼šå­˜æ”¾ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶</strong></li><li>&#x2F;homeï¼šå­˜æ”¾ç”¨æˆ·çš„ä¸»ç›®å½•</li><li>&#x2F;libï¼šå­˜æ”¾ç³»ç»Ÿç¨‹åºå’Œå†…æ ¸æ‰€éœ€çš„å…±äº«åº“æ–‡ä»¶</li><li>&#x2F;mediaï¼šç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«ç§»åŠ¨è®¾å¤‡å¹¶æŒ‚è½½è¿™ä¸ªç›®å½•</li><li>&#x2F;mntï¼šå°†å¤–éƒ¨å­˜å‚¨æŒ‚è½½åˆ°å½“å‰ç›®å½•</li><li>&#x2F;optï¼šå­˜æ”¾å¯é€‰çš„ç¬¬ä¸‰æ–¹è½¯ä»¶åŒ…</li><li>&#x2F;procï¼šè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œæä¾›å…³äºå†…æ ¸å’Œè¿›ç¨‹çš„ä¿¡æ¯</li><li>&#x2F;rootï¼šè¶…çº§ç”¨æˆ·ï¼ˆrootï¼‰çš„ä¸»ç›®å½•</li><li>&#x2F;sbinï¼šå­˜æ”¾ç³»ç»Ÿç®¡ç†å‘½ä»¤å’Œå·¥å…·</li><li>&#x2F;srvï¼šå­˜æ”¾ç³»ç»Ÿæä¾›çš„æœåŠ¡çš„æ•°æ®ï¼Œå¦‚WebæœåŠ¡å™¨çš„æ•°æ®</li><li>&#x2F;tmpï¼šå­˜æ”¾ä¸´æ—¶æ–‡ä»¶</li><li><strong>&#x2F;usrï¼šå­˜æ”¾åº”ç”¨ç¨‹åºå’Œåº“ï¼ŒåŒ…æ‹¬å¤§å¤šæ•°ç³»ç»Ÿå·¥å…·å’Œåº”ç”¨ç¨‹åº</strong></li><li>&#x2F;varï¼šå­˜æ”¾åŠ¨æ€æ•°æ®ï¼Œå¦‚æ—¥å¿—ã€ç¼“å­˜ã€é‚®ä»¶ç­‰</li><li><strong>&#x2F;usr&#x2F;localï¼šå­˜æ”¾é€šè¿‡æºç å®‰è£…çš„è½¯ä»¶</strong></li></ul><h3 id="æ–‡ä»¶åŸºæœ¬å±æ€§"><a href="#æ–‡ä»¶åŸºæœ¬å±æ€§" class="headerlink" title="æ–‡ä»¶åŸºæœ¬å±æ€§"></a>æ–‡ä»¶åŸºæœ¬å±æ€§</h3><img src="/post/82734d8/image-20240916235314084.png" class="" title="image-20240916235314084"><p>æ–‡ä»¶ç±»å‹</p><ul><li>[d] ç›®å½•</li><li>[-] æ–‡ä»¶</li><li>[l] é“¾æ¥</li><li>[b] å­˜å‚¨è®¾å¤‡</li><li>[c] ä¸²è¡Œç«¯å£è®¾å¤‡ï¼Œå¦‚é¼ æ ‡ã€é”®ç›˜</li></ul><p>åœ¨ Linux ä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶å’Œç›®å½•éƒ½æœ‰ä¸‰ç±»æƒé™ï¼š</p><ul><li>**è¯»æƒé™ (r)**ï¼šå…è®¸è¯»å–æ–‡ä»¶å†…å®¹ï¼ˆå¯¹äºç›®å½•ï¼Œå…è®¸åˆ—å‡ºç›®å½•ä¸­çš„æ–‡ä»¶ï¼‰ã€‚</li><li>**å†™æƒé™ (w)**ï¼šå…è®¸ä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼ˆå¯¹äºç›®å½•ï¼Œå…è®¸åœ¨ç›®å½•ä¸­åˆ›å»ºã€åˆ é™¤æ–‡ä»¶ï¼‰ã€‚</li><li>**æ‰§è¡Œæƒé™ (x)**ï¼šå…è®¸æ‰§è¡Œæ–‡ä»¶ï¼ˆå¯¹äºç›®å½•ï¼Œå…è®¸è¿›å…¥ç›®å½•æˆ–è®¿é—®å…¶ä¸­çš„æ–‡ä»¶ï¼‰ã€‚</li></ul><p>è¿™äº›æƒé™æ˜¯åˆ†é…ç»™ä»¥ä¸‹ä¸‰ç§ç”¨æˆ·ç±»å‹çš„ï¼š</p><ul><li>**æ–‡ä»¶æ‰€æœ‰è€… (Owner)**ï¼šæ–‡ä»¶çš„åˆ›å»ºè€…ã€‚</li><li>**æ–‡ä»¶æ‰€å±ç»„ (Group)**ï¼šæ–‡ä»¶æ‰€å±çš„ç”¨æˆ·ç»„ã€‚</li><li>**å…¶ä»–ç”¨æˆ· (Others)**ï¼šé™¤æ–‡ä»¶æ‰€æœ‰è€…å’Œæ‰€å±ç»„ä¹‹å¤–çš„æ‰€æœ‰å…¶ä»–ç”¨æˆ·ã€‚</li></ul><p>ä»¥æˆªå›¾ä¸­çš„æ–‡ä»¶ <code>dockerfile</code> ä¸ºä¾‹ï¼š</p><ul><li>æ–‡ä»¶ç±»å‹ä¸º <code>d</code>ï¼Œå³ç›®å½•</li><li>æ–‡ä»¶æ‰€æœ‰è€…æƒé™ä¸º <code>rwx</code>ï¼Œå³å¯è¯»å¯å†™å¯è®¿é—®</li><li>æ–‡ä»¶æ‰€å±ç»„æƒé™ä¸º <code>r-x</code>ï¼Œå³å¯è¯»ä¸å¯å†™å¯è®¿é—®</li><li>å…¶ä»–ç”¨æˆ·æƒé™ä¸º <code>r-x</code>ï¼Œä¹Ÿæ˜¯å¯è¯»ä¸å¯å†™å¯è®¿é—®</li></ul><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><h3 id="æ–‡ä»¶å’Œç›®å½•æ“ä½œ"><a href="#æ–‡ä»¶å’Œç›®å½•æ“ä½œ" class="headerlink" title="æ–‡ä»¶å’Œç›®å½•æ“ä½œ"></a>æ–‡ä»¶å’Œç›®å½•æ“ä½œ</h3><h4 id="cd"><a href="#cd" class="headerlink" title="cd"></a><code>cd</code></h4><p>åˆ‡æ¢ç›®å½•</p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>cd -</code></td><td>è¿”å›ä¸Šæ¬¡æ‰€åœ¨çš„ç›®å½•</td></tr></tbody></table><h4 id="pwd"><a href="#pwd" class="headerlink" title="pwd"></a><code>pwd</code></h4><h4 id="mkdir"><a href="#mkdir" class="headerlink" title="mkdir"></a><code>mkdir</code></h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>mkdir -P dir1/dir2/dir3</code></td><td>é€’å½’åˆ›å»ºç›®å½•</td></tr></tbody></table><h4 id="rmdir"><a href="#rmdir" class="headerlink" title="rmdir"></a><code>rmdir</code></h4><h4 id="ls"><a href="#ls" class="headerlink" title="ls"></a><code>ls</code></h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>ls -a</code></td><td>æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬éšè—æ–‡ä»¶ï¼‰</td></tr><tr><td><code>ls -l</code></td><td>æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</td></tr><tr><td><code>ls -F</code></td><td>åœ¨æ–‡ä»¶ååé™„åŠ ä¸€ä¸ªæŒ‡ç¤ºç¬¦æ¥æ ‡è¯†æ–‡ä»¶ç±»å‹</td></tr><tr><td><code>ls -1</code></td><td>å¼ºåˆ¶æ¯ä¸ªæ–‡ä»¶å•ç‹¬å ä¸€è¡Œæ˜¾ç¤º</td></tr><tr><td><code>ls -R</code></td><td>é€’å½’åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶å’Œç›®å½•</td></tr><tr><td><code>ls -t</code></td><td>æŒ‰ä¿®æ”¹æ—¶é—´å€’åºæ˜¾ç¤º</td></tr><tr><td><code>ls -tr</code></td><td>æŒ‰ä¿®æ”¹æ—¶é—´æ­£åºæ˜¾ç¤º</td></tr></tbody></table><h4 id="cp"><a href="#cp" class="headerlink" title="cp"></a><code>cp</code></h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>cp -r dir1 dir2</code></td><td>é€’å½’å¤åˆ¶ï¼ˆä¿ç•™åŸºæœ¬ç»“æ„ï¼‰</td></tr><tr><td><code>cp -a dir1 dir2</code></td><td>å½’æ¡£å¤åˆ¶ï¼ˆä¿ç•™å…ƒæ•°æ®ï¼‰</td></tr><tr><td><code>cp -u file1 file2</code></td><td>æœ‰æ›´æ–°æ‰å¤åˆ¶</td></tr></tbody></table><h4 id="mv"><a href="#mv" class="headerlink" title="mv"></a><code>mv</code></h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>mv -i</code></td><td>ç§»åŠ¨å‰æç¤ºç”¨æˆ·ç¡®è®¤</td></tr></tbody></table><h4 id="rm"><a href="#rm" class="headerlink" title="rm"></a><code>rm</code></h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>rm -i</code></td><td>åˆ é™¤å‰æç¤ºç”¨æˆ·ç¡®è®¤</td></tr><tr><td><code>rm -r</code></td><td>é€’å½’åˆ é™¤</td></tr><tr><td><code>rm -f</code></td><td>ä¸æç¤ºï¼Œå¼ºåˆ¶åˆ é™¤</td></tr></tbody></table><h4 id="touch"><a href="#touch" class="headerlink" title="touch"></a><code>touch</code></h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>touch file</code></td><td>åˆ›å»ºç©ºæ–‡ä»¶</td></tr><tr><td><code>touch existed_file</code></td><td>æ›´æ–°æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´</td></tr><tr><td><code>touch -a existed_file</code></td><td>æ›´æ–°æ–‡ä»¶çš„è®¿é—®æ—¶é—´</td></tr></tbody></table><h4 id="ln"><a href="#ln" class="headerlink" title="ln"></a><code>ln</code></h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>ln file hl_file</code></td><td>åˆ›å»ºç¡¬é“¾æ¥</td></tr><tr><td><code>ln -s file sl_file</code></td><td>åˆ›å»ºè½¯é“¾æ¥</td></tr></tbody></table><h3 id="æ–‡ä»¶æœç´¢"><a href="#æ–‡ä»¶æœç´¢" class="headerlink" title="æ–‡ä»¶æœç´¢"></a>æ–‡ä»¶æœç´¢</h3><h4 id="find"><a href="#find" class="headerlink" title="find"></a><code>find</code></h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>find /path -name filename</code></td><td>æœç´¢å½“å‰ç›®å½•åŠå…¶å­ç›®å½•</td></tr><tr><td><code>find /path -maxdepth 1 -name filename</code></td><td>ä»…æœç´¢å½“å‰ç›®å½•</td></tr><tr><td><code>find /path -mindepth 2 -name filename</code></td><td>ä»æŒ‡å®šæ·±åº¦å¼€å§‹æœç´¢</td></tr><tr><td><code>find /path -type f </code></td><td>æœç´¢æ–‡ä»¶</td></tr><tr><td><code>find /path -iname filename</code></td><td>å¿½ç•¥å¤§å°å†™</td></tr></tbody></table><h4 id="locate"><a href="#locate" class="headerlink" title="locate"></a><code>locate</code></h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>locate -i filename</code></td><td>å¿½ç•¥å¤§å°å†™</td></tr><tr><td><code>locate -r pattern</code></td><td>æ­£åˆ™åŒ¹é…æŸ¥æ‰¾</td></tr></tbody></table><h4 id="which"><a href="#which" class="headerlink" title="which"></a><code>which</code></h4><p><code>which</code> ç”¨äºæ˜¾ç¤ºæŸä¸ªå‘½ä»¤æˆ–ç¨‹åºçš„ç»å¯¹è·¯å¾„ã€‚å®ƒä¼šæŸ¥æ‰¾ç³»ç»Ÿçš„ <code>$PATH</code> ç¯å¢ƒå˜é‡ä¸­åˆ—å‡ºçš„ç›®å½•ï¼Œå¹¶è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…çš„å‘½ä»¤æˆ–ç¨‹åºçš„è·¯å¾„ã€‚</p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>which python</code></td><td>æ˜¾ç¤ºä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æˆ–å¯æ‰§è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„</td></tr></tbody></table><h4 id="whereis"><a href="#whereis" class="headerlink" title="whereis"></a><code>whereis</code></h4><p><code>whereis</code> æ˜¯ä¸€ä¸ªç±»ä¼¼äº <code>which</code> çš„å‘½ä»¤ï¼Œç”¨äºæŸ¥æ‰¾å‘½ä»¤ã€äºŒè¿›åˆ¶æ–‡ä»¶ã€æºä»£ç å’Œæ‰‹å†Œé¡µçš„æ‰€åœ¨ä½ç½®ã€‚ä¸ <code>which</code> åªæŸ¥æ‰¾ <code>$PATH</code> ç¯å¢ƒå˜é‡ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸åŒï¼Œ<code>whereis</code> ä¼šæœç´¢ç³»ç»Ÿä¸­æ›´å¤šçš„è·¯å¾„ï¼ŒåŒ…æ‹¬æ ‡å‡†äºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„ã€æºä»£ç ç›®å½•å’Œæ‰‹å†Œé¡µç›®å½•ã€‚</p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>whereis python </code></td><td>è¾“å‡ºä¼šåŒ…æ‹¬å¤šä¸ªè·¯å¾„ï¼Œæ˜¾ç¤ºå‘½ä»¤ã€æºä»£ç å’Œæ‰‹å†Œé¡µçš„è·¯å¾„</td></tr><tr><td><code>whereis -b python</code></td><td>æŸ¥æ‰¾ <code>python</code> çš„äºŒè¿›åˆ¶æ–‡ä»¶</td></tr><tr><td><code>whereis -m python</code></td><td>æŸ¥æ‰¾ <code>python</code> çš„æ‰‹å†Œé¡µ</td></tr></tbody></table><h3 id="æ–‡ä»¶å†…å®¹æŸ¥çœ‹å’Œç¼–è¾‘"><a href="#æ–‡ä»¶å†…å®¹æŸ¥çœ‹å’Œç¼–è¾‘" class="headerlink" title="æ–‡ä»¶å†…å®¹æŸ¥çœ‹å’Œç¼–è¾‘"></a>æ–‡ä»¶å†…å®¹æŸ¥çœ‹å’Œç¼–è¾‘</h3><h4 id="wc"><a href="#wc" class="headerlink" title="wc"></a><code>wc</code></h4><p>ç»Ÿè®¡æ–‡æœ¬ï¼Œè¾“å‡º3ä¸ªå€¼ï¼šæ–‡æœ¬è¡Œæ•°ã€æ–‡æœ¬è¯æ•°ã€æ–‡æœ¬å­—èŠ‚æ•°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å†…è”è¾“å…¥é‡å®šå‘</span></span><br><span class="line">$ <span class="built_in">wc</span> &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">&gt; hello</span></span><br><span class="line"><span class="string">&gt; EOF</span></span><br><span class="line">      1       1       6</span><br></pre></td></tr></table></figure><h4 id="cat"><a href="#cat" class="headerlink" title="cat"></a><code>cat</code></h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>cat -n file</code></td><td>æ˜¾ç¤ºæ—¶æ·»åŠ è¡Œå·</td></tr><tr><td><code>cat -b file</code></td><td>ç©ºè¡Œä¸æ·»åŠ è¡Œå·</td></tr><tr><td><code>cat /dev/null &gt; file</code></td><td>æ¸…ç©ºæ–‡ä»¶</td></tr></tbody></table><h4 id="more"><a href="#more" class="headerlink" title="more"></a><code>more</code></h4><h4 id="less"><a href="#less" class="headerlink" title="less"></a><code>less</code></h4><h4 id="head"><a href="#head" class="headerlink" title="head"></a><code>head</code></h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>head -n 5 file</code> &#x2F; <code>head -5 file</code></td><td>æ˜¾ç¤ºæ–‡ä»¶å‰5è¡Œ</td></tr></tbody></table><h4 id="tail"><a href="#tail" class="headerlink" title="tail"></a><code>tail</code></h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>tail -n 5 file</code> &#x2F; <code>tail -f file</code></td><td>æ˜¾ç¤ºæ–‡ä»¶æœ€å5è¡Œ</td></tr><tr><td><code>tail -f file</code></td><td>å®æ—¶ç›‘æ§æ–‡ä»¶æ›´æ–°</td></tr></tbody></table><h4 id="sort"><a href="#sort" class="headerlink" title="sort"></a><code>sort</code></h4><h4 id="grep"><a href="#grep" class="headerlink" title="grep"></a><code>grep</code></h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>grep &quot;keyword&quot; file</code></td><td>æŸ¥æ‰¾åŒ…å« <code>keyword</code> çš„è¡Œ</td></tr><tr><td><code>grep -i &quot;keyword&quot; file</code></td><td>å¿½ç•¥å¤§å°å†™</td></tr><tr><td><code>grep -n &quot;keyword&quot; file</code></td><td>æŸ¥æ‰¾åŒ…å« <code>keyword</code> çš„è¡Œå¹¶æ˜¾ç¤ºè¡Œå·</td></tr><tr><td><code>grep &quot;^keyword&quot; file</code></td><td>æŸ¥æ‰¾ä»¥ <code>keyword</code> å¼€å¤´çš„è¡Œ</td></tr><tr><td><code>grep &quot;keyword$&quot; file</code></td><td>æŸ¥æ‰¾ä»¥ <code>keyword</code> ç»“å°¾çš„è¡Œ</td></tr><tr><td><code>grep &quot;[0-9]&quot; file</code></td><td>æŸ¥æ‰¾åŒ…å«æ•°å­—çš„è¡Œ</td></tr><tr><td><code>grep -E</code></td><td>æ”¯æŒæ›´å¼ºå¤§çš„æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼</td></tr><tr><td><code>grep -r &quot;keyword&quot; .</code></td><td>åœ¨å½“å‰ç›®å½•åŠå…¶å­ç›®å½•æŸ¥æ‰¾</td></tr><tr><td><code>grep -A 10 &quot;keyword&quot; file</code></td><td>æ˜¾ç¤ºåŒ¹é…è¡Œåé¢ <code>n</code> è¡Œ</td></tr><tr><td><code>grep -B 10 &quot;keyword&quot; file</code></td><td>æ˜¾ç¤ºåŒ¹é…è¡Œå‰é¢ <code>n</code> è¡Œ</td></tr><tr><td><code>grep -C 10 &quot;keyword&quot; file</code></td><td>æ˜¾ç¤ºåŒ¹é…è¡Œå‰åå„ <code>n</code> è¡Œ</td></tr></tbody></table><p>PSï¼šæƒ³é«˜æ•ˆåœ°ä½¿ç”¨ <code>grep</code>ï¼Œéœ€è¦ç†Ÿç»ƒæŒæ¡æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><h3 id="æ–‡ä»¶æƒé™å’Œæ‰€æœ‰æƒ"><a href="#æ–‡ä»¶æƒé™å’Œæ‰€æœ‰æƒ" class="headerlink" title="æ–‡ä»¶æƒé™å’Œæ‰€æœ‰æƒ"></a>æ–‡ä»¶æƒé™å’Œæ‰€æœ‰æƒ</h3><h4 id="chmod"><a href="#chmod" class="headerlink" title="chmod"></a><code>chmod</code></h4><h4 id="chown"><a href="#chown" class="headerlink" title="chown"></a><code>chown</code></h4><h4 id="chgrp"><a href="#chgrp" class="headerlink" title="chgrp"></a><code>chgrp</code></h4><h3 id="ç³»ç»Ÿç›‘æ§å’Œç®¡ç†"><a href="#ç³»ç»Ÿç›‘æ§å’Œç®¡ç†" class="headerlink" title="ç³»ç»Ÿç›‘æ§å’Œç®¡ç†"></a>ç³»ç»Ÿç›‘æ§å’Œç®¡ç†</h3><h4 id="ps"><a href="#ps" class="headerlink" title="ps"></a><code>ps</code></h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>ps -aux</code></td><td><code>-a</code>ï¼šæ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·çš„è¿›ç¨‹</td></tr><tr><td></td><td><code>-u</code>ï¼šæ˜¾ç¤ºè¿›ç¨‹çš„è¯¦ç»†ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯è¿›ç¨‹æ‰€å±çš„ç”¨æˆ·ï¼ˆUSERï¼‰ï¼ŒCPU å’Œå†…å­˜å ç”¨æƒ…å†µï¼ˆ%CPUã€%MEMï¼‰</td></tr><tr><td></td><td><code>-x</code>ï¼šåŒ…æ‹¬åå°è¿›ç¨‹</td></tr><tr><td><code>ps -ef</code></td><td><code>-e</code>ï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ï¼Œç­‰åŒäº <code>-A</code></td></tr><tr><td></td><td><code>-f</code>ï¼šä»¥æ ‘çŠ¶ç»“æ„æ˜¾ç¤ºè¿›ç¨‹ï¼Œæ˜¾ç¤ºè¿›ç¨‹çš„çˆ¶å­å…³ç³»ï¼Œå¹¶ä¸”åŒ…æ‹¬æ›´å¤šçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚çˆ¶è¿›ç¨‹ IDï¼ˆPPIDï¼‰ã€ç»ˆç«¯ï¼ˆTTYï¼‰ç­‰</td></tr></tbody></table><img src="/post/82734d8/image-20240917103223950.png" class="" title="image-20240917103223950"><img src="/post/82734d8/image-20240917103250778.png" class="" title="image-20240917103250778"><p>å°ç»“ï¼š</p><ul><li><p><code>ps -aux</code> æ˜¾ç¤ºè¯¦ç»†çš„è¿›ç¨‹ä¿¡æ¯ï¼ˆåŒ…æ‹¬èµ„æºå ç”¨ï¼‰ï¼Œæ²¡æœ‰çˆ¶å­è¿›ç¨‹å…³ç³»ã€‚</p></li><li><p><code>ps -ef</code> æ˜¾ç¤ºè¿›ç¨‹æ ‘ï¼Œé‡ç‚¹å±•ç¤ºè¿›ç¨‹é—´çš„å±‚æ¬¡ç»“æ„</p></li></ul><h4 id="top"><a href="#top" class="headerlink" title="top"></a><code>top</code></h4><p><code>top</code> ç”¨äºå®æ—¶æ˜¾ç¤ºç³»ç»Ÿçš„èµ„æºä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬ CPUã€å†…å­˜ã€è¿›ç¨‹ç­‰ä¿¡æ¯ã€‚</p><h4 id="df"><a href="#df" class="headerlink" title="df"></a><code>df</code></h4><p><code>df</code> ç”¨äºæ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬å·²ç”¨ç©ºé—´ã€å¯ç”¨ç©ºé—´å’Œæ–‡ä»¶ç³»ç»Ÿæ€»å®¹é‡ç­‰ä¿¡æ¯ã€‚</p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>df -h</code></td><td>æ˜¾ç¤ºå¯è¯»æ€§æ›´å¥½çš„è¾“å‡º</td></tr></tbody></table><h4 id="du"><a href="#du" class="headerlink" title="du"></a><code>du</code></h4><p><code>du</code> ç”¨äºæ˜¾ç¤ºæ–‡ä»¶å’Œç›®å½•çš„ç£ç›˜ä½¿ç”¨æƒ…å†µï¼Œå¯ä»¥å¸®åŠ©æŸ¥çœ‹æ–‡ä»¶æˆ–ç›®å½•å ç”¨çš„ç£ç›˜ç©ºé—´ï¼Œä»¥ä¾¿æœ‰æ•ˆåœ°ç®¡ç†ç£ç›˜ç©ºé—´ã€‚</p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>du -h /path</code></td><td>æŸ¥çœ‹ <code>/path</code> ç›®å½•çš„ç£ç›˜ä½¿ç”¨æƒ…å†µ</td></tr><tr><td><code>du -sh /path</code></td><td>æ˜¾ç¤ºç›®å½•çš„æ€»ç£ç›˜ä½¿ç”¨æƒ…å†µ</td></tr></tbody></table><h4 id="uptime"><a href="#uptime" class="headerlink" title="uptime"></a><code>uptime</code></h4><p>æ˜¾ç¤ºç³»ç»Ÿçš„è¿è¡Œæ—¶é—´å’Œè´Ÿè½½ã€‚</p><h3 id="ç½‘ç»œæ“ä½œ"><a href="#ç½‘ç»œæ“ä½œ" class="headerlink" title="ç½‘ç»œæ“ä½œ"></a>ç½‘ç»œæ“ä½œ</h3><h4 id="ping"><a href="#ping" class="headerlink" title="ping"></a><code>ping</code></h4><p><code>ping</code> æ˜¯ä¸€ä¸ªç½‘ç»œè¯Šæ–­å·¥å…·ï¼Œç”¨äºæµ‹è¯•ä¸»æœºä¹‹é—´çš„ç½‘ç»œè¿é€šæ€§ï¼Œä»¥åŠé€šä¿¡çš„å»¶è¿Ÿæƒ…å†µã€‚</p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>ping -c 3 baidu.com</code></td><td>å‘é€æŒ‡å®šæ•°é‡çš„è¯·æ±‚</td></tr></tbody></table><h4 id="ifconfig-ip"><a href="#ifconfig-ip" class="headerlink" title="ifconfig/ip"></a><code>ifconfig/ip</code></h4><p><code>ifconfig</code>ï¼ˆInterface Configurationï¼‰ç”¨äºé…ç½®å’Œæ˜¾ç¤ºç½‘ç»œæ¥å£ä¿¡æ¯ã€‚åœ¨ç°ä»£Linuxç³»ç»Ÿä¸­ï¼Œ<code>ifconfig</code> é€æ¸è¢« <code>ip</code> å‘½ä»¤æ‰€å–ä»£ï¼Œä½†ä»ç„¶å¹¿æ³›ä½¿ç”¨ã€‚</p><h4 id="netstat-ss"><a href="#netstat-ss" class="headerlink" title="netstat/ss"></a><code>netstat/ss</code></h4><p><code>netstat</code>ï¼ˆnetwork statisticsï¼‰ç”¨äºæ˜¾ç¤ºç½‘ç»œè¿æ¥ã€è·¯ç”±è¡¨ã€æ¥å£ç»Ÿè®¡ã€ä¼ªè£…è¿æ¥å’Œå¤šæ’­æˆå‘˜çš„ä¿¡æ¯ã€‚å®ƒæä¾›äº†ä¸€ä¸ªæ¦‚è¿°å½“å‰ç³»ç»Ÿç½‘ç»œçŠ¶æ€çš„æ–¹å¼ï¼Œå¸®åŠ©ç”¨æˆ·äº†è§£å“ªäº›ç«¯å£æ­£åœ¨è¢«ä½¿ç”¨ã€è¿æ¥çš„çŠ¶æ€ä»¥åŠç½‘ç»œæ¥å£çš„ç»Ÿè®¡æ•°æ®ã€‚</p><h4 id="curl"><a href="#curl" class="headerlink" title="curl"></a><code>curl</code></h4><p>ä¸‹è½½æ–‡ä»¶æˆ–æµ‹è¯•ç½‘ç»œè¯·æ±‚</p><h4 id="wget"><a href="#wget" class="headerlink" title="wget"></a><code>wget</code></h4><p>ä¸‹è½½æ–‡ä»¶æˆ–æµ‹è¯•ç½‘ç»œè¯·æ±‚</p><h3 id="å‹ç¼©å’Œè§£å‹ç¼©"><a href="#å‹ç¼©å’Œè§£å‹ç¼©" class="headerlink" title="å‹ç¼©å’Œè§£å‹ç¼©"></a>å‹ç¼©å’Œè§£å‹ç¼©</h3><h4 id="tar"><a href="#tar" class="headerlink" title="tar"></a><code>tar</code></h4><p>å¸¸ç”¨é€‰é¡¹ï¼š</p><ul><li><p><code>-c</code>ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å½’æ¡£æ–‡ä»¶ã€‚</p></li><li><p><code>-x</code>ï¼šè§£å‹å½’æ¡£æ–‡ä»¶ã€‚</p></li><li><p><code>-t</code>ï¼šæŸ¥çœ‹å½’æ¡£æ–‡ä»¶çš„å†…å®¹ã€‚</p></li><li><p><code>-v</code>ï¼šæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</p></li><li><p><code>-f</code>ï¼šæŒ‡å®šå½’æ¡£æ–‡ä»¶åã€‚</p></li><li><p><code>-z</code>ï¼šä½¿ç”¨ gzip å‹ç¼©ã€‚</p></li><li><p><code>-C</code>ï¼šè§£å‹åˆ°æŒ‡å®šç›®å½•ã€‚</p></li></ul><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>tar -cvf archive.tar file1 file2 dir1</code></td><td>åˆ›å»ºæœªå‹ç¼©å½’æ¡£æ–‡ä»¶</td></tr><tr><td><code>tar -czvf archive.tar file1 file2 dir1</code></td><td>åˆ›å»ºå‹ç¼©å½’æ¡£æ–‡ä»¶</td></tr><tr><td><code>tar -xvf archive.tar</code></td><td>è§£å‹æœªå‹ç¼©å½’æ¡£æ–‡ä»¶</td></tr><tr><td><code>tar -xzvf arvhive.tar</code></td><td>è§£å‹å‹ç¼©å½’æ¡£æ–‡ä»¶</td></tr></tbody></table><h4 id="zip-unzip"><a href="#zip-unzip" class="headerlink" title="zip/unzip"></a><code>zip/unzip</code></h4><p>ç”¨äºåˆ›å»ºå’Œè§£å‹ç¼© zip æ–‡ä»¶</p><h4 id="gzip-gunzip"><a href="#gzip-gunzip" class="headerlink" title="gzip/gunzip"></a><code>gzip/gunzip</code></h4><p>ç”¨äºå‹ç¼©å’Œè§£å‹ç¼© gzip æ–‡ä»¶</p><h3 id="å…¶ä»–å‘½ä»¤"><a href="#å…¶ä»–å‘½ä»¤" class="headerlink" title="å…¶ä»–å‘½ä»¤"></a>å…¶ä»–å‘½ä»¤</h3><h4 id="history"><a href="#history" class="headerlink" title="history"></a><code>history</code></h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>history -5</code></td><td>æ˜¾ç¤ºæœ€è¿‘5æ¡å‘½ä»¤</td></tr><tr><td><code>!10057</code></td><td>æ‰§è¡Œç¼–å·ä¸º10057çš„å‘½ä»¤</td></tr><tr><td><code>!man</code></td><td>è°ƒå‡ºæœ€è¿‘ä¸€æ¡ <code>man</code> å‘½ä»¤</td></tr><tr><td><code>!!</code></td><td>è°ƒå‡ºæœ€è¿‘ä¸€æ¡å‘½ä»¤</td></tr></tbody></table><p><code>history | grep man</code>ï¼šæŸ¥æ‰¾åŒ…å« <code>man</code> çš„å†å²å‘½ä»¤</p><p>PSï¼šå‘½ä»¤å†å²é€šå¸¸ä¿å­˜åœ¨ <code>~/.bash_history</code> æ–‡ä»¶ä¸­</p><h4 id="un-alias"><a href="#un-alias" class="headerlink" title="(un)alias"></a><code>(un)alias</code></h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>alias</code></td><td>æŸ¥çœ‹æ‰€æœ‰åˆ«å</td></tr><tr><td><code>unalias ll</code></td><td>åˆ é™¤åˆ«å</td></tr><tr><td><code>alias ll=&#39;ls -l&#39;</code></td><td>è®¾ç½®åˆ«å</td></tr></tbody></table><p>åœ¨å‘½ä»¤è¡Œé€šè¿‡ <code>alias</code> è®¾ç½®çš„åˆ«ååªåœ¨å½“å‰ shell æœ‰æ•ˆï¼Œè¦è®©åˆ«åæ°¸ä¹…ç”Ÿæ•ˆï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ï¼Œç”¨æˆ·çš„ shell é…ç½®æ–‡ä»¶é€šå¸¸æ˜¯<code>~/.bashrc</code> æˆ– <code>~/.bash_profile</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ vim ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨æ–‡ä»¶æœ«å°¾æ·»æ”¹è¡Œ</span></span><br><span class="line"><span class="built_in">alias</span> ll=<span class="string">&#x27;ls -l&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ä½¿åˆ«åç”Ÿæ•ˆ</span></span><br><span class="line">$ <span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><h4 id="echo"><a href="#echo" class="headerlink" title="echo"></a><code>echo</code></h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>echo -n &gt; file</code></td><td>æ¸…ç©ºæ–‡ä»¶</td></tr><tr><td><code>echo -n &quot;prompt: &quot;; command</code></td><td>åœ¨åŒä¸€è¡Œæ˜¾ç¤ºæç¤ºå’Œå‘½ä»¤è¾“å‡º</td></tr><tr><td><code>echo $?</code></td><td>æŸ¥çœ‹shellæ‰§è¡Œçš„æœ€åä¸€æ¡å‘½ä»¤çš„é€€å‡ºçŠ¶æ€ç </td></tr></tbody></table><h4 id="set"><a href="#set" class="headerlink" title="set"></a><code>set</code></h4><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>set</code></td><td>æ˜¾ç¤ºå½“å‰çš„å®Œæ•´ç¯å¢ƒå˜é‡åˆ—è¡¨</td></tr></tbody></table><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gitå¸¸ç”¨å‘½ä»¤</title>
      <link href="/post/e8c9512e.html"/>
      <url>/post/e8c9512e.html</url>
      
        <content type="html"><![CDATA[<p>Git å¸¸ç”¨å‘½ä»¤ï¼š<a href="https://git-scm.com/docs">Reference</a></p><span id="more"></span><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><h3 id="git-help"><a href="#git-help" class="headerlink" title="git help"></a><code>git help</code></h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>git &lt;verb&gt; --help</code></td><td>æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£</td></tr><tr><td><code>git &lt;verb&gt; -h</code></td><td>æŸ¥çœ‹å¿«é€Ÿå‚è€ƒ</td></tr></tbody></table><h3 id="git-config"><a href="#git-config" class="headerlink" title="git config"></a><code>git config</code></h3><p>æ ¹æ®ä½œç”¨èŒƒå›´ï¼Œgitæœ‰å¦‚ä¸‹ä¸‰ç§é…ç½®æ–‡ä»¶ï¼š</p><table><thead><tr><th>é…ç½®æ–‡ä»¶</th><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>/etc/gitconfig</code></td><td><code>git config --system</code></td><td>åŒ…å«ç³»ç»Ÿä¸Šæ‰€æœ‰ç”¨æˆ·çš„é…ç½®</td></tr><tr><td><code>~/.gitconfig</code></td><td><code>git config --global</code></td><td>åªåŒ…å«å½“å‰ç”¨æˆ·çš„é…ç½®</td></tr><tr><td><code>.git/config</code></td><td><code>git config --local</code></td><td>åªåŒ…å«å½“å‰ä»“åº“çš„é…ç½®</td></tr></tbody></table><p>å’Œé…ç½®æœ‰å…³çš„å¸¸ç”¨å‘½ä»¤ï¼š</p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>git config user.name</code></td><td>æŸ¥çœ‹å•ä¸ªé…ç½®</td></tr><tr><td><code>git config --list </code></td><td>åˆ—å‡ºæ‰€æœ‰é…ç½®</td></tr><tr><td><code>git config --list --show-origin</code></td><td>åˆ—å‡ºæ‰€æœ‰é…ç½®åŠé…ç½®æ‰€åœ¨çš„æ–‡ä»¶</td></tr><tr><td><code>git config --global use.name &quot;zhang3&quot;</code></td><td>é…ç½®ç”¨æˆ·å</td></tr><tr><td><code>git config --global use.email &quot;xxx@xxx.com&quot;</code></td><td>é…ç½®é‚®ç®±</td></tr><tr><td><code>git config --global alias.co checkout</code></td><td>é…ç½®åˆ«å</td></tr></tbody></table><h3 id="git-add"><a href="#git-add" class="headerlink" title="git add"></a><code>git add</code></h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>git add &lt;file&gt;...</code></td><td>è·Ÿè¸ª&#x2F;æš‚å­˜æ–‡ä»¶</td></tr></tbody></table><h3 id="git-restore"><a href="#git-restore" class="headerlink" title="git restore"></a><code>git restore</code></h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>git restore --staged &lt;file&gt;...</code></td><td>å–æ¶ˆæš‚å­˜</td></tr><tr><td><code>git restore &lt;file&gt;...</code></td><td>æ’¤é”€ä¿®æ”¹</td></tr></tbody></table><h3 id="git-status"><a href="#git-status" class="headerlink" title="git status"></a><code>git status</code></h3><p><code>git status</code>çš„ä½œç”¨æ˜¯æŸ¥çœ‹æ–‡ä»¶çš„çŠ¶æ€ï¼Œä½†è¯¥å‘½ä»¤çš„è¾“å‡ºè¾ƒä¸ºç¹çï¼Œå¯ä»¥åŠ ä¸Š<code>-s</code>é€‰é¡¹ç®€åŒ–è¾“å‡ºã€‚</p><p><code>git status -s</code>çš„è¾“å‡ºä¸­æœ‰ä¸¤æ è¡¨ç¤ºçŠ¶æ€ï¼Œå·¦ä¾§æ˜¯æš‚å­˜åŒºçŠ¶æ€ï¼Œå³ä¾§æ˜¯å·¥ä½œåŒºçŠ¶æ€ï¼š</p><ul><li><code>??</code>ï¼šæ–°æ–‡ä»¶ï¼Œæœªè·Ÿè¸ª</li><li><code>A </code>ï¼šæ–°æ–‡ä»¶ï¼Œå·²è·Ÿè¸ª</li><li><code>  M</code>ï¼šæ—§æ–‡ä»¶ï¼Œå·²ä¿®æ”¹æœªæš‚å­˜</li><li><code>M </code>ï¼šæ—§æ–‡ä»¶ï¼Œå·²ä¿®æ”¹å·²æš‚å­˜</li><li><code>MM</code>ï¼šæ—§æ–‡ä»¶ï¼Œä¿®æ”¹å¹¶æš‚å­˜åå†æ¬¡ä¿®æ”¹</li></ul><h3 id="git-diff"><a href="#git-diff" class="headerlink" title="git diff"></a><code>git diff</code></h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>git diff &lt;file&gt;...</code></td><td>æŸ¥çœ‹å·²ä¿®æ”¹æœªæš‚å­˜çš„æ”¹åŠ¨</td></tr><tr><td><code>git diff --staged &lt;file&gt;...</code></td><td>æŸ¥çœ‹å·²æš‚å­˜æœªæäº¤çš„æ”¹åŠ¨</td></tr></tbody></table><h3 id="git-log"><a href="#git-log" class="headerlink" title="git log"></a><code>git log</code></h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>git log</code></td><td>æŸ¥çœ‹æäº¤å†å²</td></tr><tr><td><code>git log -n</code></td><td>æŸ¥çœ‹æœ€è¿‘næ¬¡æäº¤å†å²</td></tr><tr><td><code>git log -p</code></td><td>æŸ¥çœ‹æ¯æ¬¡æäº¤å¼•å…¥çš„å·®å¼‚</td></tr><tr><td><code>git log --stat</code></td><td>æŸ¥çœ‹æäº¤çš„ç®€ç•¥ç»Ÿè®¡ä¿¡æ¯</td></tr><tr><td><code>git log --graph</code></td><td>å›¾å½¢æ˜¾ç¤ºåˆ†æ”¯åˆå¹¶å†å²</td></tr><tr><td><code>git log --since=&quot;2020-10-10&quot; --until=&quot;2024-10-10&quot;</code></td><td>æ˜¾ç¤ºæŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æäº¤</td></tr><tr><td><code>git log --grep=&#39;commit&#39;</code></td><td>æœç´¢æäº¤è¯´æ˜ä¸­åŒ…å«æŒ‡å®šå…³é”®å­—çš„æäº¤</td></tr><tr><td><code>git log --name-only</code></td><td>æŸ¥çœ‹å·²ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•</td></tr><tr><td><code>git log --name-status</code></td><td></td></tr><tr><td><code>git log --author=&#39;zhang3&#39;</code></td><td>æŸ¥çœ‹æŒ‡å®šç”¨æˆ·çš„æäº¤</td></tr><tr><td><code>git log --pretty=formt:&quot;%h - %an, %cd: %s&quot; --date=short</code></td><td>è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼</td></tr><tr><td><code>git log --oneline --decorate</code></td><td>æŸ¥çœ‹å½“å‰å„åˆ†æ”¯æ‰€æŒ‡çš„æäº¤å¯¹è±¡</td></tr><tr><td><code>git log --oneline --decorate --graph</code></td><td>æŸ¥çœ‹æäº¤å†å²ã€å„ä¸ªåˆ†æ”¯çš„æŒ‡å‘ä»¥åŠåˆ†æ”¯åˆ†å‰æƒ…å†µ</td></tr><tr><td><code>git log master..dev</code></td><td>æŸ¥çœ‹åœ¨devåˆ†æ”¯ä½†ä¸åœ¨masteråˆ†æ”¯çš„æäº¤</td></tr><tr><td><code>git log ^master dev test</code></td><td>æŸ¥çœ‹åœ¨devå’Œteståˆ†æ”¯ä½†ä¸åœ¨masteråˆ†æ”¯çš„æäº¤</td></tr><tr><td><code>git log dev test --not master</code></td><td>æŸ¥çœ‹åœ¨devå’Œteståˆ†æ”¯ä½†ä¸åœ¨masteråˆ†æ”¯çš„æäº¤</td></tr><tr><td><code>git log origin/master..HEAD</code></td><td>æŸ¥çœ‹å³å°†æ¨é€åˆ°è¿œç«¯çš„æäº¤</td></tr><tr><td><code>git log master...dev</code></td><td>æŸ¥çœ‹åªåœ¨å…¶ä¸­ä¸€ä¸ªåˆ†æ”¯ä¸Šçš„æäº¤</td></tr></tbody></table><p>ç»Ÿè®¡ä»£ç è¡Œæ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --since=<span class="string">&quot;2021-08-01&quot;</span> --<span class="keyword">until</span>==<span class="string">&quot;2023-05-31&quot;</span> --author=<span class="string">&quot;linfeng&quot;</span> --pretty=tformat: --numstat | awk <span class="string">&#x27; &#123; add += $1; subs += $2; loc += $1 - $2 &#125; END &#123; printf &quot;added lines: %s, removed lines: %s, total lines: %sn&quot;, add, subs, loc &#125;&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="git-reflog"><a href="#git-reflog" class="headerlink" title="git reflog"></a><code>git reflog</code></h3><p>æŸ¥çœ‹<code>HEAD</code>æˆ–åˆ†æ”¯å¼•ç”¨æŒ‡å‘çš„å†å²</p><h3 id="git-show"><a href="#git-show" class="headerlink" title="git show"></a><code>git show</code></h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>git show HEAD^</code></td><td>æŸ¥çœ‹<code>HEAD</code>çš„ç¬¬1ä¸ªçˆ¶æäº¤</td></tr><tr><td><code>git show HEAD~</code></td><td>æŸ¥çœ‹<code>HEAD</code>çš„ç¬¬1ä¸ªçˆ¶æäº¤</td></tr><tr><td><code>git show HEAD^2</code></td><td>æŸ¥çœ‹<code>HEAD</code>çš„ç¬¬2ä¸ªçˆ¶æäº¤</td></tr><tr><td><code>git show HEAD~2</code></td><td>æŸ¥çœ‹<code>HEAD</code>çš„ç¬¬1ä¸ªçˆ¶æäº¤çš„çˆ¶æäº¤</td></tr><tr><td><code>git show HEAD^2~</code></td><td>æŸ¥çœ‹<code>HEAD</code>çš„ç¬¬2ä¸ªçˆ¶æäº¤çš„çˆ¶æäº¤</td></tr></tbody></table><h3 id="git-remote"><a href="#git-remote" class="headerlink" title="git remote"></a><code>git remote</code></h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>git remote -v</code></td><td>æŸ¥çœ‹è¿œç¨‹ä»“åº“åŠå…¶url</td></tr><tr><td><code>git remote add &lt;remote-name&gt; &lt;url&gt;</code></td><td>å…³è”è¿œç¨‹ä»“åº“</td></tr><tr><td><code>git remote rename &lt;remote-name&gt; &lt;another-name&gt;</code></td><td>é‡å‘½åè¿œç¨‹ä»“åº“å</td></tr><tr><td><code>git remote rm &lt;remote-name&gt;</code></td><td>åˆ é™¤å…³è”</td></tr></tbody></table><h3 id="git-tag"><a href="#git-tag" class="headerlink" title="git tag"></a><code>git tag</code></h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>git tag</code></td><td>åˆ—å‡ºå·²æœ‰æ ‡ç­¾</td></tr><tr><td><code>git log -l &#39;v1.0*&#39;</code></td><td>åˆ—å‡ºç‰¹å®šæ ‡ç­¾</td></tr><tr><td><code>git log -a v1.0</code></td><td>æ‰“é™„æ³¨æ ‡ç­¾</td></tr><tr><td><code>git log v1.0-lw</code></td><td>æ‰“è½»é‡æ ‡ç­¾</td></tr><tr><td><code>git log -a v0.9 &lt;commit-id&gt;</code></td><td>ç»™å†å²æäº¤æ‰“æ ‡ç­¾</td></tr><tr><td><code>git push origin v1.0</code></td><td>æ¨é€æ ‡ç­¾</td></tr></tbody></table><h3 id="git-branch"><a href="#git-branch" class="headerlink" title="git branch"></a><code>git branch</code></h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>git branch dev</code></td><td>åˆ›å»ºåˆ†æ”¯</td></tr><tr><td><code>git checkout dev</code></td><td>åˆ‡æ¢åˆ†æ”¯</td></tr><tr><td><code>git checkout -b dev</code></td><td>åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯</td></tr><tr><td><code>git checkout -b dev origin/dev</code></td><td>ä»è¿œç¨‹åˆ†æ”¯åˆ›å»ºåˆ†æ”¯</td></tr><tr><td><code>git checkout --track origin/dev</code></td><td>ä»è¿œç¨‹åˆ†æ”¯åˆ›å»ºåˆ†æ”¯</td></tr><tr><td><code>git checkout tag/1.0 -b 1.0</code></td><td>ä»tagä¸­åˆ›å»ºåˆ†æ”¯</td></tr><tr><td><code>git branch -u origin/dev</code></td><td>è®¾ç½®æœ¬åœ°åˆ†æ”¯è·Ÿè¸ªè¿œç¨‹åˆ†æ”¯</td></tr><tr><td><code>git branch -v</code></td><td>æŸ¥çœ‹æ¯ä¸€ä¸ªåˆ†æ”¯çš„æœ€åä¸€æ¬¡æäº¤</td></tr><tr><td><code>git branch -vv</code></td><td>æŸ¥çœ‹è®¾ç½®çš„æ‰€æœ‰è·Ÿè¸ªåˆ†æ”¯</td></tr><tr><td><code>git branch --merged</code></td><td>æŸ¥çœ‹å·²åˆå¹¶åˆ†æ”¯</td></tr><tr><td><code>git branch --no-merged</code></td><td>æŸ¥çœ‹æœªåˆå¹¶åˆ†æ”¯</td></tr><tr><td><code>git branch -d dev</code></td><td>åˆ é™¤åˆ†æ”¯</td></tr><tr><td><code>git branch -D dev</code></td><td>å¼ºåˆ¶åˆ é™¤åˆ†æ”¯</td></tr><tr><td><code>git push origin --delete dev</code></td><td>åˆ é™¤è¿œç¨‹åˆ†æ”¯</td></tr><tr><td><code>git branch --unset-upstream åˆ†å€¼å</code></td><td>å–æ¶ˆæœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯çš„å…³è”</td></tr></tbody></table><p><code>git branch | grep &#39;feature_&#39; | xargs git branch -d/-D</code>ï¼šæ‰¹é‡åˆ é™¤åˆ†æ”¯</p><h3 id="git-merge"><a href="#git-merge" class="headerlink" title="git merge"></a><code>git merge</code></h3><p><code>fast-forward</code>ï¼šå½“å‰æ‰€åœ¨åˆ†æ”¯æŒ‡å‘çš„æäº¤æ˜¯è¢«åˆå¹¶åˆ†æ”¯æ‰€æŒ‡å‘çš„æäº¤çš„ç›´æ¥ä¸Šæ¸¸ï¼Œåˆå¹¶æ“ä½œåªç®€å•çš„å°†è®©å½“å‰åˆ†æ”¯æŒ‡å‘è¢«åˆå¹¶åˆ†æ”¯æ‰€æŒ‡å‘çš„æäº¤ï¼Œè¿™ç§åˆå¹¶å°±å«åš <code>fast-forward</code></p><h3 id="git-rebase"><a href="#git-rebase" class="headerlink" title="git rebase"></a><code>git rebase</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git co dev</span><br><span class="line">git rebase master</span><br><span class="line">git co master</span><br><span class="line">git merge dev</span><br><span class="line"></span><br><span class="line">git rebase master devï¼ˆå¦‚æœå½“å‰åˆ†æ”¯ä¸æ˜¯devï¼Œæ­¤å‘½ä»¤ä¼šåˆ‡åˆ°devåˆ†æ”¯ï¼‰</span><br><span class="line">git co master</span><br><span class="line">git merge dev</span><br><span class="line"></span><br><span class="line">git rebase --onto master server clientï¼šé€‰ä¸­åœ¨clientåˆ†æ”¯ä½†ä¸åœ¨serveråˆ†æ”¯çš„ä¿®æ”¹ï¼Œå°†å®ƒä»¬åœ¨masteråˆ†æ”¯é‡æ”¾</span><br></pre></td></tr></table></figure><p>æœ€ä½³å®è·µï¼šåªæŠŠå˜åŸºå‘½ä»¤ç”¨äºæ¨é€å‰æ•´ç†æäº¤å†å²ï¼Œå¹¶ä¸”åªåœ¨ä»æœªæ¨é€è‡³å…¬å…±ä»“çš„æäº¤ä¸Šæ‰§è¡Œå˜åŸºå‘½ä»¤ã€‚</p><h3 id="git-stash"><a href="#git-stash" class="headerlink" title="git stash"></a><code>git stash</code></h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>git stash</code></td><td>å‚¨è—ä¿®æ”¹</td></tr><tr><td><code>git stash save &#39;æè¿°&#39;</code></td><td>å‚¨è—ä¿®æ”¹å¹¶å‘½å</td></tr><tr><td><code>git stash list</code></td><td>æŸ¥çœ‹å‚¨è—åˆ—è¡¨</td></tr><tr><td><code>git stash apply</code></td><td>åº”ç”¨å‚¨è—</td></tr><tr><td><code>git stash apply --index</code></td><td>å¦‚æœå‚¨è—åŒ…å«å·²æš‚å­˜çš„æ–‡ä»¶ï¼Œéœ€åŠ â€“indexå‚æ•°</td></tr><tr><td><code>git stash drop</code></td><td>åˆ é™¤å‚¨è—</td></tr><tr><td><code>git stash pop</code></td><td>åº”ç”¨å¹¶åˆ é™¤å‚¨è—</td></tr><tr><td><code>git stash --keep-index</code></td><td>åªå‚¨è—æœªæš‚å­˜çš„æ–‡ä»¶</td></tr><tr><td><code>git stash -u</code></td><td>stashé»˜è®¤åªå‚¨è—å·²è·Ÿè¸ªçš„æ–‡ä»¶ï¼Œæƒ³è¦å‚¨è—æœªè·Ÿè¸ªçš„æ–‡ä»¶ï¼Œéœ€åŠ ä¸Š-uå‚æ•°</td></tr><tr><td><code>git stash branch &lt;branch_name&gt;</code></td><td>ä»å‚¨è—åˆ›å»ºåˆ†æ”¯</td></tr></tbody></table><h3 id="git-reset"><a href="#git-reset" class="headerlink" title="git reset"></a><code>git reset</code></h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>git reset --soft HEAD~</code></td><td>å›é€€åˆ°ä¸Šä¸€ä¸ªæäº¤ï¼Œæš‚å­˜åŒºå’Œå·¥ä½œç›®å½•ä¸å˜</td></tr><tr><td><code>git reset [--mixed] HEAD~</code></td><td>é»˜è®¤æ¨¡å¼ï¼Œå›é€€åˆ°ä¸Šä¸€ä¸ªæäº¤ï¼Œå–æ¶ˆæš‚å­˜ï¼Œä¿ç•™å·¥ä½œç›®å½•çš„ä¿®æ”¹</td></tr><tr><td><code>git reset --hard HEAD~</code></td><td>å›é€€åˆ°ä¸Šä¸€ä¸ªæäº¤ï¼Œæ’¤é”€å·¥ä½œç›®å½•çš„æ‰€æœ‰ä¿®æ”¹</td></tr></tbody></table><p><code>git reset</code> ä¼šåŒæ—¶ç§»åŠ¨ <code>HEAD</code> å’Œåˆ†æ”¯çš„æŒ‡å‘ï¼Œ<code>git checkout</code> åªç§»åŠ¨ <code>HEAD</code></p><h3 id="git-lfs"><a href="#git-lfs" class="headerlink" title="git lfs"></a><code>git lfs</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git lfs install (éœ€ç¡®ä¿æœ¬åœ°git lfså·²å®‰è£…)</span><br><span class="line">git lfs track &#123;file_path&#125;  ï¼ˆç›´æ¥trackç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼‰</span><br><span class="line">git add .</span><br><span class="line">git commit -m</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><h2 id="å‡ ä¸ªå‘½ä»¤çš„åŸç†"><a href="#å‡ ä¸ªå‘½ä»¤çš„åŸç†" class="headerlink" title="å‡ ä¸ªå‘½ä»¤çš„åŸç†"></a>å‡ ä¸ªå‘½ä»¤çš„åŸç†</h2><h3 id="git-ç›®å½•"><a href="#git-ç›®å½•" class="headerlink" title=".git ç›®å½•"></a><code>.git</code> ç›®å½•</h3><p>å‡†å¤‡ä¸€ä¸ªç©ºç›®å½• <code>repo</code>ï¼Œ<code>cd</code> åˆ°è¿™ä¸ªç›®å½•æ‰§è¡Œ <code>git init</code> å‘½ä»¤ã€‚å½“åœ¨ä¸€ä¸ªç›®å½•æ‰§è¡Œ <code>git init</code> å‘½ä»¤æ—¶ï¼ŒGit ä¼šåˆ›å»ºä¸€ä¸ª <code>.git</code> ç›®å½•ï¼Œè¿™ä¸ªç›®å½•åŒ…å«äº†å‡ ä¹æ‰€æœ‰ Git å­˜å‚¨å’Œæ“ä½œçš„å¯¹è±¡ã€‚è¯¥ç›®å½•çš„ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> -F1 .git</span><br><span class="line">HEAD <span class="comment">#å­˜å‚¨ç›®å‰æ£€å‡ºçš„åˆ†æ”¯çš„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">config</span><br><span class="line">description</span><br><span class="line">hooks/</span><br><span class="line">info/</span><br><span class="line">objects/ <span class="comment">#å­˜å‚¨å¯¹è±¡æ–‡ä»¶ï¼ŒåŒ…æ‹¬blobå¯¹è±¡ã€treeå¯¹è±¡ã€commitå¯¹è±¡</span></span><br><span class="line">refs/ <span class="comment">#refs/headsç›®å½•å­˜å‚¨åˆ†æ”¯æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹æ˜¯åˆ†æ”¯å½“å‰æŒ‡å‘çš„æäº¤çš„æ ¡éªŒå’Œ</span></span><br></pre></td></tr></table></figure><p>æœ€åˆï¼Œ<code>.git/objects</code> ç›®å½•å’Œ <code>.git/refs/heads</code> ç›®å½•éƒ½æ˜¯ç©ºçš„ï¼Œæ‰§è¡Œå®Œç›¸åº”å‘½ä»¤åæ‰ä¼šåœ¨è¿™ä¸¤ä¸ªç›®å½•ä¸‹ç”Ÿæˆæ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ll .git/objects</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x  2 tw  staff    64B 12 29 18:49 info</span><br><span class="line">drwxr-xr-x  2 tw  staff    64B 12 29 18:49 pack</span><br><span class="line"></span><br><span class="line">$ ll .git/refs/heads</span><br><span class="line">total 0</span><br></pre></td></tr></table></figure><p><code>.git/HEAD</code> å­˜å‚¨å½“å‰åˆ†æ”¯çš„æ–‡ä»¶è·¯å¾„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> .git/HEAD</span><br><span class="line">ref: refs/heads/main</span><br></pre></td></tr></table></figure><p>psï¼šå½“å‰ <code>.git/refs/heads</code> ç›®å½•ä¸‹å¹¶æ²¡æœ‰ <code>main</code> è¿™ä¸ªåˆ†æ”¯æ–‡ä»¶ï¼Œè¿™æ˜¯å› ä¸ºä»“åº“å½“å‰æ²¡æœ‰ä»»ä½•æäº¤ï¼Œåªæœ‰äº§ç”Ÿæäº¤æ‰ä¼šç”Ÿæˆè¿™ä¸ªæ–‡ä»¶ã€‚</p><h3 id="git-add-1"><a href="#git-add-1" class="headerlink" title="git add"></a><code>git add</code></h3><p>åœ¨ <code>repo</code> ç›®å½•ä¸­å‡†å¤‡ä¸‰ä¸ªæ–‡ä»¶ï¼Œ<code>file1</code>ã€<code>file2</code>ã€<code>dir/file3</code>ã€‚</p><p>æŸ¥çœ‹ä»“åº“çš„çŠ¶æ€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch main</span><br><span class="line"></span><br><span class="line">No commits yet</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to include <span class="keyword">in</span> what will be committed)</span><br><span class="line"><span class="built_in">dir</span>/</span><br><span class="line">file1</span><br><span class="line">file2</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use <span class="string">&quot;git add&quot;</span> to track)</span><br></pre></td></tr></table></figure><p>è·Ÿè¸ªæ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git add file1 file2 <span class="built_in">dir</span>/file3 <span class="comment"># ä¹Ÿå¯ä»¥ä½¿ç”¨ git add . è·Ÿè¸ªæ‰€æœ‰æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><p>å½“æ‰§è¡Œ <code>git add</code> å‘½ä»¤æ—¶ï¼ŒGit ä¼šä¸ºæ¯ä¸€ä¸ªæ–‡ä»¶ç”Ÿæˆé•¿åº¦ä¸º40ä½çš„æ ¡éªŒå’Œï¼Œå¹¶ä»¥æ ¡éªŒå’Œçš„å‰2ä½ä¸ºç›®å½•åï¼Œå38ä½ä¸ºæ–‡ä»¶åæ¥å­˜å‚¨æ–‡ä»¶å¿«ç…§ï¼Œæ–‡ä»¶å¿«ç…§ä»¥ <code>blob</code> å¯¹è±¡å­˜å‚¨ï¼Œå­˜å‚¨ä½ç½®å°±æ˜¯ <code>.git/objects</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> -F1R .git/objects</span><br><span class="line">25/</span><br><span class="line">7d/</span><br><span class="line">b8/</span><br><span class="line"></span><br><span class="line">.git/objects/25:</span><br><span class="line">a8f74b822fb9b0efd64d7443c1c35f361bb7cc <span class="comment">#blob</span></span><br><span class="line"></span><br><span class="line">.git/objects/7d:</span><br><span class="line">2832ce3bae5b3b3f54731b4886947f977e2ac2 <span class="comment">#blob</span></span><br><span class="line"></span><br><span class="line">.git/objects/b8:</span><br><span class="line">914fa8629794ecb72cfc7fcdadbececeea0b4f <span class="comment">#blob</span></span><br></pre></td></tr></table></figure><img src="/post/e8c9512e/image-20241229115204753.png" class="" title="image-20241229115204753"><h3 id="git-commit"><a href="#git-commit" class="headerlink" title="git commit"></a><code>git commit</code></h3><p>é€šè¿‡ <code>git add</code> å‘½ä»¤è·Ÿè¸ªæ–‡ä»¶åå†æ¬¡æŸ¥çœ‹ä»“åº“çŠ¶æ€ï¼Œæ­¤æ—¶æ–‡ä»¶å·²è¢«æš‚å­˜ï¼Œç­‰å¾…æäº¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch main</span><br><span class="line"></span><br><span class="line">No commits yet</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">&quot;git rm --cached &lt;file&gt;...&quot;</span> to unstage)</span><br><span class="line">new file:   <span class="built_in">dir</span>/file3.txt</span><br><span class="line">new file:   file1.txt</span><br><span class="line">new file:   file2.txt</span><br></pre></td></tr></table></figure><p>æäº¤æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m <span class="string">&#x27;the initial commit of repo&#x27;</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ <code>git commit</code> å‘½ä»¤ï¼ŒGit ä¼šç”Ÿæˆæ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><ul><li><p>ä¸ºæ¯ä¸€ä¸ªæœ‰æ–‡ä»¶å˜æ›´çš„ç›®å½•ç”Ÿæˆä¸€ä¸ª <code>tree</code> å¯¹è±¡</p></li><li><p>ç”Ÿæˆä¸€ä¸ª <code>commit</code> å¯¹è±¡ï¼Œä¿å­˜æ ¹ç›®å½• <code>tree</code> å¯¹è±¡çš„æ ¡éªŒå’Œï¼Œå¦‚æœæœ‰çˆ¶æäº¤ï¼Œè¿˜ä¼šä¿å­˜çˆ¶æäº¤å¯¹è±¡çš„æ ¡éªŒå’Œ</p></li><li><p>åœ¨ <code>.git/refs/heads</code> ç›®å½•ä¸­åˆ›å»ºåˆ†æ”¯æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å°±æ˜¯å½“å‰åˆ†æ”¯æœ€æ–°æäº¤çš„æ ¡éªŒå’Œ</p></li></ul><p>ä¸ <code>blob</code> å¯¹è±¡ç±»ä¼¼ï¼ŒGit ä¼šä¸ºæ¯ä¸€ä¸ª <code>tree</code> å¯¹è±¡å’Œ <code>commit</code> å¯¹è±¡è®¡ç®—æ ¡éªŒå’Œï¼ŒåŒæ ·ä»¥æ ¡éªŒå’Œçš„å‰2ä½ä¸ºç›®å½•åï¼Œå38ä½ä¸ºæ–‡ä»¶åæ¥å­˜å‚¨è¿™ä¸¤ç§å¯¹è±¡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> -F1R .git/objects</span><br><span class="line">25/</span><br><span class="line">54/</span><br><span class="line">7d/</span><br><span class="line">9f/</span><br><span class="line">b8/</span><br><span class="line"><span class="built_in">fc</span>/</span><br><span class="line"></span><br><span class="line">.git/objects/25:</span><br><span class="line">a8f74b822fb9b0efd64d7443c1c35f361bb7cc <span class="comment">#blob</span></span><br><span class="line"></span><br><span class="line">.git/objects/54:</span><br><span class="line">8f32fb2ee149dee0637bea72ef60963eca6b51 <span class="comment">#commit</span></span><br><span class="line"></span><br><span class="line">.git/objects/7d:</span><br><span class="line">2832ce3bae5b3b3f54731b4886947f977e2ac2 <span class="comment">#blob</span></span><br><span class="line"></span><br><span class="line">.git/objects/9f:</span><br><span class="line">a6bc0f50083bf5f7ec4bc14c4ea6f48cfe35eb <span class="comment">#tree</span></span><br><span class="line"></span><br><span class="line">.git/objects/b8:</span><br><span class="line">914fa8629794ecb72cfc7fcdadbececeea0b4f <span class="comment">#blob</span></span><br><span class="line"></span><br><span class="line">.git/objects/fc:</span><br><span class="line">41d977852fce6e0c8cce1632884b7efaca4a98 <span class="comment">#tree</span></span><br></pre></td></tr></table></figure><img src="/post/e8c9512e/image-20241229120752341.png" class="" title="image-20241229120752341"><p>å› ä¸ºæœ‰äº†æäº¤ï¼Œæ­¤æ—¶ <code>.git/refs/heads</code> ç›®å½•ä¸­å°±ä¼šç”Ÿæˆ <code>main</code> åˆ†æ”¯æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ll .git/refs/heads</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r--  1 tw  staff    41B 12 29 19:13 main</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> .git/refs/heads/main</span><br><span class="line">548f32fb2ee149dee0637bea72ef60963eca6b51</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ <code>file1</code> å’Œ <code>dir/file3</code>ï¼Œå¹¶ä½¿ç”¨ <code>git add</code> å‘½ä»¤æš‚å­˜æ–‡ä»¶ï¼ŒGit ä¼šä¸º <code>file1</code> å’Œ <code>dir/file3</code> é‡æ–°è®¡ç®—æ ¡éªŒå’Œï¼Œä¹Ÿå°±æ˜¯è¯´ <code>.git/objects</code> ç›®å½•ä¼šæ–°ç”Ÿæˆä¸¤ä¸ª <code>blob</code> å¯¹è±¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ ll .git/objects</span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 11:14 25</span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 11:25 54</span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 11:14 7d</span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 11:25 9f</span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 11:14 b8</span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 11:25 <span class="built_in">fc</span></span><br><span class="line"></span><br><span class="line">$ git add file1 <span class="built_in">dir</span>/file3</span><br><span class="line"></span><br><span class="line">$ ll .git/objects</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 11:14 25</span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 11:25 54</span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 11:14 7d</span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 11:25 9f</span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 11:14 b8</span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 12:22 c0 <span class="comment">#new blob</span></span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 12:22 c9 <span class="comment">#new blob</span></span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 11:25 <span class="built_in">fc</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>git commit</code> å‘½ä»¤æäº¤ï¼Œå› ä¸º <code>dir</code> å’Œä»“åº“æ ¹ç›®å½•ä¸‹éƒ½æœ‰æ–‡ä»¶å˜æ›´ï¼Œå› æ­¤ä¼šæ–°ç”Ÿæˆä¸¤ä¸ª <code>tree</code> å¯¹è±¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ ll .git/objects</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x  4 tw  staff   128B 12 29 12:26 25 </span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 12:26 47 <span class="comment">#new tree</span></span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 11:25 54</span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 11:14 7d</span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 12:26 81 <span class="comment">#new commit</span></span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 11:25 9f</span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 11:14 b8</span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 12:22 c0</span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 12:22 c9</span><br><span class="line">drwxr-xr-x  3 tw  staff    96B 12 29 11:25 <span class="built_in">fc</span></span><br><span class="line"></span><br><span class="line">$ ll .git/objects/25</span><br><span class="line">total 16</span><br><span class="line">-r--r--r--  1 tw  staff    33B 12 29 11:14 a8f74b822fb9b0efd64d7443c1c35f361bb7cc</span><br><span class="line">-r--r--r--  1 tw  staff    50B 12 29 12:26 b034b431c310c762aa9d7272ac847bf8b32dfa <span class="comment">#new tree</span></span><br></pre></td></tr></table></figure><img src="/post/e8c9512e/image-20241229124958332.png" class="" title="image-20241229124958332"><h3 id="git-checkout"><a href="#git-checkout" class="headerlink" title="git checkout"></a><code>git checkout</code></h3><p>Git åˆ†æ”¯ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯æŒ‡å‘æäº¤å¯¹è±¡çš„å¯å˜æŒ‡é’ˆã€‚åœ¨ <code>.git/refs/heads</code> ç›®å½•ä¸‹ï¼Œæ¯ä¸ªåˆ†æ”¯éƒ½æœ‰ä¸€ä¸ªå¯¹åº”æ–‡ä»¶ï¼Œå­˜å‚¨ç€å½“å‰åˆ†æ”¯æ‰€æŒ‡å‘çš„æœ€æ–°æäº¤çš„æ ¡éªŒå’Œã€‚</p><p>åˆ›å»ºåˆ†æ”¯ï¼Œå°±æ˜¯æ–°å»ºä¸€ä¸ªåˆ†æ”¯æ–‡ä»¶ï¼Œå†™å…¥æäº¤å¯¹è±¡çš„æ ¡éªŒå’Œï¼›åˆ é™¤åˆ†æ”¯ï¼Œå°±æ˜¯åˆ é™¤å¯¹åº”çš„åˆ†æ”¯æ–‡ä»¶ã€‚å› æ­¤ Git åˆ†æ”¯çš„åˆ›å»ºå’Œé”€æ¯éƒ½éå¸¸é«˜æ•ˆã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git branch</span><br><span class="line">* main</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> .git/HEAD</span><br><span class="line">ref: refs/heads/main</span><br><span class="line"></span><br><span class="line">$ ll .git/refs/heads</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r--  1 tw  staff    41B 12 29 12:26 main</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸Šå‡ ä¸ªå‘½ä»¤å¯ä»¥çœ‹å‡ºï¼Œå½“å‰åªæœ‰ä¸€ä¸ªåˆ†æ”¯ <code>main</code>ï¼Œå¹¶ä¸”å½“å‰æ£€å‡ºåˆ†æ”¯å°±æ˜¯ <code>main</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git branch dev</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> .git/HEAD</span><br><span class="line">ref: refs/heads/main</span><br><span class="line"></span><br><span class="line">$ ll .git/refs/heads</span><br><span class="line">total 24</span><br><span class="line">-rw-r--r--  1 tw  staff    41B 12 29 20:07 dev</span><br><span class="line">-rw-r--r--  1 tw  staff    41B 12 29 12:26 main</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> .git/refs/heads/dev</span><br><span class="line">81306fe754dae188929a1e98c3a894a5641a3728</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>git branch</code> åˆ›å»ºæ–°çš„åˆ†æ”¯åï¼Œå¯ä»¥çœ‹å‡ºï¼Œå½“å‰æ£€å‡ºåˆ†æ”¯ä¾ç„¶æ˜¯ <code>main</code>ï¼Œä½† <code>.git/refs/heads</code> ç›®å½•ä¸‹å¤šä¸€ä¸ª <code>dev</code> åˆ†æ”¯æ–‡ä»¶ï¼Œåˆ†æ”¯å†…å®¹æ˜¯ <code>main</code> åˆ†æ”¯æœ€æ–°æäº¤çš„æ ¡éªŒå’Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout dev</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> .git/HEAD</span><br><span class="line">ref: refs/heads/dev</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>git checkout</code> å‘½ä»¤æ£€å‡ºåˆ° <code>dev</code> åˆ†æ”¯åï¼Œå¯ä»¥çœ‹åˆ° <code>HEAD</code> æ–‡ä»¶ç°åœ¨ä¿å­˜çš„æ˜¯ <code>dev</code> åˆ†æ”¯çš„æ–‡ä»¶è·¯å¾„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout main</span><br><span class="line"></span><br><span class="line">$ git branch -d dev</span><br><span class="line"></span><br><span class="line">$ ll .git/refs/heads</span><br><span class="line">total 8</span><br><span class="line">-rw-r--r--  1 tw  staff    41B 12 29 12:26 main</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>git branch -d</code> åˆ é™¤åˆ†æ”¯åï¼ŒGit ä¼šåˆ é™¤ <code>.git/refs/heads</code> ç›®å½•ä¸‹å¯¹åº”çš„åˆ†æ”¯æ–‡ä»¶ã€‚</p><h3 id="git-merge-1"><a href="#git-merge-1" class="headerlink" title="git merge"></a><code>git merge</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b iss37</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;file2: version 2&quot;</span> &gt; file2</span><br><span class="line"></span><br><span class="line">$ git add file2</span><br><span class="line"></span><br><span class="line">$ git commit -m <span class="string">&#x27;iss37: made a achange to file2&#x27;</span></span><br><span class="line"></span><br><span class="line">$ git checkout main</span><br><span class="line"></span><br><span class="line">$ git checkout -b hotfix</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;file1: version 3&quot;</span> &gt; file1</span><br><span class="line"></span><br><span class="line">$ git add file1</span><br><span class="line"></span><br><span class="line">$ git commit -m <span class="string">&#x27;hotfix: made a change to file1&#x27;</span></span><br><span class="line"></span><br><span class="line">$ git checkout main</span><br><span class="line"></span><br><span class="line">$ git <span class="built_in">log</span> --oneline --decorate --graph --all</span><br><span class="line">* 9ba0744 (hotfix) hotfix: made a change to file1</span><br><span class="line">| * d222cd6 (iss37) iss37: made a achange to file2</span><br><span class="line">|/</span><br><span class="line">* 81306fe (HEAD -&gt; main) made changes to file1 and file3</span><br><span class="line">* 548f32f the initial commit of repo</span><br></pre></td></tr></table></figure><p>ä¾æ¬¡æ‰§è¡Œå¦‚ä¸Šå‘½ä»¤åï¼Œå½“å‰æ£€å‡ºåˆ†æ”¯ï¼Œä»¥åŠå„ä¸ªåˆ†æ”¯çš„æŒ‡å‘å¦‚ä¸‹å¦‚æ‰€ç¤ºï¼š</p><img src="/post/e8c9512e/image-20241229221518223.png" class="" title="image-20241229221518223"><p>å°† <code>hotfix</code> åˆ†æ”¯åˆå…¥ <code>main</code> åˆ†æ”¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git merge hotfix</span><br><span class="line">Updating 81306fe..9ba0744</span><br><span class="line">Fast-forward</span><br><span class="line"> file1 | 2 +-</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line"> </span><br><span class="line">$ git <span class="built_in">log</span> --oneline --decorate --graph --all</span><br><span class="line">* 9ba0744 (HEAD -&gt; main, hotfix) hotfix: made a change to file1</span><br><span class="line">| * d222cd6 (iss37) iss37: made a achange to file2</span><br><span class="line">|/</span><br><span class="line">* 81306fe made changes to file1 and file3</span><br><span class="line">* 548f32f the initial commit of repo</span><br></pre></td></tr></table></figure><img src="/post/e8c9512e/image-20241229222153973.png" class="" title="image-20241229222153973"><p>æ³¨æ„ä¸Šè¿°çš„ <code>Fast-forward</code> ï¼š <code>main</code> åˆ†æ”¯æŒ‡å‘çš„æäº¤æ˜¯ <code>hotfix</code> åˆ†æ”¯æŒ‡å‘çš„æäº¤çš„ç›´æ¥ä¸Šæ¸¸ï¼Œ<code>git merge</code> åªæ˜¯ç®€å•çš„è®© <code>main</code> åˆ†æ”¯æŒ‡å‘ <code>hotfix</code> åˆ†æ”¯æ‰€æŒ‡å‘çš„æäº¤ï¼Œè¿™ç§åˆå¹¶å°±å«åš <code>fast-forward</code>ã€‚</p><p>ä¸ä¹‹ç›¸å¯¹åº”çš„ï¼Œåˆå¹¶å®Œ <code>hotfix</code> åˆ†æ”¯åï¼Œ<code>main</code> åˆ†æ”¯å½“å‰æŒ‡å‘çš„æäº¤ä¸æ˜¯ <code>iss37</code> æŒ‡å‘çš„æäº¤çš„ç›´æ¥ä¸Šæ¸¸ï¼Œæ­¤æ—¶å¦‚æœè¦åˆå¹¶ <code>iss37</code> åˆ†æ”¯ï¼Œå°±æ— æ³•é€šè¿‡ <code>Fast-forward</code> æ–¹å¼ç®€å•åœ°æ”¹å˜ <code>main</code> åˆ†æ”¯çš„æŒ‡å‘æ¥å®Œæˆäº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout main</span><br><span class="line"></span><br><span class="line">$ git merge iss37</span><br><span class="line">Merge made by the <span class="string">&#x27;ort&#x27;</span> strategy.</span><br><span class="line"> file2 | 2 +-</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line"> </span><br><span class="line">$ git <span class="built_in">log</span> --oneline --decorate --graph --all</span><br><span class="line">*   6d58973 (HEAD -&gt; main) Merge branch <span class="string">&#x27;iss37&#x27;</span></span><br><span class="line">|\</span><br><span class="line">| * d222cd6 (iss37) iss37: made a achange to file2</span><br><span class="line">* | 9ba0744 (hotfix) hotfix: made a change to file1</span><br><span class="line">|/</span><br><span class="line">* 81306fe made changes to file1 and file3</span><br><span class="line">* 548f32f the initial commit of repo</span><br></pre></td></tr></table></figure><img src="/post/e8c9512e/image-20241229224617129.png" class="" title="image-20241229224617129"><p>å¯ä»¥çœ‹åˆ°ï¼Œåˆå¹¶ <code>iss37</code> åˆ†æ”¯ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æäº¤ï¼Œæ–°çš„æäº¤æœ‰ä¸¤ä¸ªçˆ¶æäº¤ã€‚</p><h2 id="åº•å±‚å‘½ä»¤"><a href="#åº•å±‚å‘½ä»¤" class="headerlink" title="åº•å±‚å‘½ä»¤"></a>åº•å±‚å‘½ä»¤</h2><h3 id="git-rebase-1"><a href="#git-rebase-1" class="headerlink" title="git rebase"></a><code>git rebase</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b feature_a</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;file_a: version 1&quot;</span> &gt; file_a</span><br><span class="line"></span><br><span class="line">$ git add file_a</span><br><span class="line"></span><br><span class="line">$ git cm <span class="string">&#x27;feature_a: add a new file&#x27;</span></span><br><span class="line"></span><br><span class="line">$ git checkout main</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;file2: version 3&quot;</span> &gt; file2</span><br><span class="line"></span><br><span class="line">$ git add file2</span><br><span class="line"></span><br><span class="line">$ git cm <span class="string">&#x27;main: made a change to file2&#x27;</span></span><br><span class="line"></span><br><span class="line">$ git <span class="built_in">log</span> --oneline --decorate --graph --all</span><br><span class="line">* 594eabd (HEAD -&gt; main) main: made a change to file2</span><br><span class="line">| * 05cfcab (feature_a) feature_a: add a new file</span><br><span class="line">|/</span><br><span class="line">*   6d58973 Merge branch <span class="string">&#x27;iss37&#x27;</span></span><br><span class="line">|\</span><br><span class="line">| * d222cd6 (iss37) iss37: made a achange to file2</span><br><span class="line">* | 9ba0744 (hotfix) hotfix: made a change to file1</span><br><span class="line">|/</span><br><span class="line">* 81306fe made changes to file1 and file3</span><br><span class="line">* 548f32f the initial commit of repo</span><br></pre></td></tr></table></figure><img src="/post/e8c9512e/image-20241229225433535.png" class="" title="image-20241229225433535"><p>é€šè¿‡ <code>git rebase</code> åˆå¹¶ <code>feature_a</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git rebase main feature_a</span><br><span class="line">Successfully rebased and updated refs/heads/feature_a.</span><br><span class="line"></span><br><span class="line">$ git <span class="built_in">log</span> --oneline --decorate --graph --all</span><br><span class="line">* ac7d58d (HEAD -&gt; feature_a) feature_a: add a new file</span><br><span class="line">* 594eabd (main) main: made a change to file2</span><br><span class="line">*   6d58973 Merge branch <span class="string">&#x27;iss37&#x27;</span></span><br><span class="line">|\</span><br><span class="line">| * d222cd6 (iss37) iss37: made a achange to file2</span><br><span class="line">* | 9ba0744 (hotfix) hotfix: made a change to file1</span><br><span class="line">|/</span><br><span class="line">* 81306fe made changes to file1 and file3</span><br><span class="line">* 548f32f the initial commit of repo</span><br></pre></td></tr></table></figure><img src="/post/e8c9512e/image-20241229225758134.png" class="" title="image-20241229225758134"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout main</span><br><span class="line"></span><br><span class="line">$ git merge feature_a</span><br><span class="line">Updating 594eabd..ac7d58d</span><br><span class="line">Fast-forward</span><br><span class="line"> file_a | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 file_a</span><br><span class="line"> </span><br><span class="line">$ git <span class="built_in">log</span> --oneline --decorate --graph --all</span><br><span class="line">* ac7d58d (HEAD -&gt; main, feature_a) feature_a: add a new file</span><br><span class="line">* 594eabd main: made a change to file2</span><br><span class="line">*   6d58973 Merge branch <span class="string">&#x27;iss37&#x27;</span></span><br><span class="line">|\</span><br><span class="line">| * d222cd6 (iss37) iss37: made a achange to file2</span><br><span class="line">* | 9ba0744 (hotfix) hotfix: made a change to file1</span><br><span class="line">|/</span><br><span class="line">* 81306fe made changes to file1 and file3</span><br><span class="line">* 548f32f the initial commit of repo</span><br></pre></td></tr></table></figure><img src="/post/e8c9512e/image-20241229230127060.png" class="" title="image-20241229230127060"><p>ä»ç»“æœä¸Šæ¥çœ‹ï¼Œå°±å¥½å°† <code>feature_a</code> åˆ†æ”¯ä¸Šçš„æäº¤åœ¨ <code>main</code> åˆ†æ”¯ä¸Šé‡æ”¾äº†ä¸€éï¼Œç„¶åé€šè¿‡ <code>Fast-forward</code> æ–¹å¼è¿›è¡Œå¿«é€Ÿåˆå¹¶ã€‚</p><p>æ€»ç»“ï¼š<code>git rebase</code> æ•´ç†äº†æäº¤å†å²ï¼Œä½¿æäº¤å†å²æ›´åŠ çº¿æ€§ï¼Œä½†æ˜¯ä¸¢å¤±äº†åŸæœ¬çš„æäº¤è®°å½•ã€‚å‡è®¾æŸä¸ªåˆ†æ”¯å·²ç»æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œå¹¶ä¸”æœ‰å…¶ä»–äººå·²ç»æ‹‰å–äº†è¯¥åˆ†æ”¯ï¼Œå¹¶åœ¨è¯¥åˆ†æ”¯ä¸Šæäº¤äº†å˜æ›´ï¼Œå¦‚æœå¯¹è¿™ç§åˆ†æ”¯çš„æäº¤è®°å½•æ‰§è¡Œ <code>git rebase</code>ï¼Œä¼šä½¿ç”¨æƒ…å†µå˜æ›´çš„å¤æ‚ã€‚å› æ­¤æœ€ä½³å®è·µå°±æ˜¯ï¼ŒåªæŠŠ <code>git rebase</code> å‘½ä»¤ç”¨äºæ¨é€å‰æ•´ç†æäº¤å†å²ï¼Œå¹¶ä¸”åªåœ¨ä»æœªæ¨é€è‡³å…¬å…±ä»“çš„æäº¤ä¸Šæ‰§è¡Œå˜åŸºå‘½ä»¤ã€‚</p><h3 id="git-cat-file"><a href="#git-cat-file" class="headerlink" title="git cat-file"></a><code>git cat-file</code></h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>git cat-file -p d670460</code></td><td>æŸ¥çœ‹å¯¹è±¡å†…å®¹</td></tr><tr><td><code>git cat-file -t d670460</code></td><td>æŸ¥çœ‹å¯¹è±¡ç±»å‹</td></tr><tr><td><code>git cat-file -p master^&#123;tree&#125;</code></td><td>æŸ¥çœ‹masteråˆ†æ”¯æœ€æ–°æäº¤æ‰€æŒ‡å‘çš„æ ‘å¯¹è±¡å†…å®¹</td></tr></tbody></table><h3 id="git-ls-tree"><a href="#git-ls-tree" class="headerlink" title="git ls-tree"></a><code>git ls-tree</code></h3><h3 id="git-ls-files"><a href="#git-ls-files" class="headerlink" title="git ls-files"></a><code>git ls-files</code></h3><h3 id="git-rev-parse"><a href="#git-rev-parse" class="headerlink" title="git rev-parse"></a><code>git rev-parse</code></h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>git rev-parse &lt;branch&gt;</code></td><td>æŸ¥çœ‹åˆ†æ”¯æŒ‡å‘çš„æäº¤çš„<code>SHA-1</code></td></tr></tbody></table><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IDEAå¸¸ç”¨å¿«æ·é”®</title>
      <link href="/post/566321e7.html"/>
      <url>/post/566321e7.html</url>
      
        <content type="html"><![CDATA[<h2 id="é€šç”¨æ“ä½œ"><a href="#é€šç”¨æ“ä½œ" class="headerlink" title="é€šç”¨æ“ä½œ"></a>é€šç”¨æ“ä½œ</h2><table><thead><tr><th>æ“ä½œ</th><th>Windows</th><th>Mac</th></tr></thead><tbody><tr><td>é‡å‘½å</td><td>Shift+F6</td><td>â‡§+Fn+F6</td></tr><tr><td>è·³è½¬åˆ°æŸè¡Œ</td><td>Ctrl+G</td><td>âŒ˜+L</td></tr><tr><td>æ–°å»º</td><td></td><td>âŒ˜+N</td></tr><tr><td>å…¨å±€æœç´¢&#x2F;æ›¿æ¢</td><td>Ctrl+Shift+F&#x2F;R</td><td>â‡§+âŒ˜+F&#x2F;R</td></tr><tr><td>æ ¼å¼åŒ–</td><td>Ctrl+Alt+L</td><td>âŒ˜+âŒ¥+L</td></tr><tr><td>importä¼˜åŒ–</td><td>Ctrl+Alt+O</td><td>âŒƒ+âŒ¥+O</td></tr><tr><td>å¤åˆ¶è¡Œ</td><td>Ctrl+D</td><td>âŒ˜+D</td></tr></tbody></table><span id="more"></span><h2 id="å…‰æ ‡ç§»åŠ¨"><a href="#å…‰æ ‡ç§»åŠ¨" class="headerlink" title="å…‰æ ‡ç§»åŠ¨"></a>å…‰æ ‡ç§»åŠ¨</h2><table><thead><tr><th>æ“ä½œ</th><th>Windows</th><th>Mac</th></tr></thead><tbody><tr><td>ç§»åŠ¨å…‰æ ‡åˆ°ä»£ç å—å¼€å§‹ä½ç½®</td><td>Ctrl+[</td><td>âŒ˜+âŒ¥+[</td></tr><tr><td>ç§»åŠ¨å…‰æ ‡åˆ°ä»£ç å—ç»“æŸä½ç½®</td><td>Ctrl+]</td><td>âŒ˜+âŒ¥+]</td></tr><tr><td>ç§»åŠ¨å…‰æ ‡åˆ°å½“å‰è¡Œçš„å¼€å§‹ä½ç½®</td><td>Home</td><td>âŒ˜+â†</td></tr><tr><td>ç§»åŠ¨å…‰æ ‡åˆ°å½“å‰è¡Œçš„ç»“æŸä½ç½®</td><td>End</td><td>âŒ˜+â†’</td></tr><tr><td>ç§»åŠ¨å…‰æ ‡åˆ°ä¸Šä¸€ä¸ªå•è¯</td><td>Ctrl+â†</td><td>âŒ¥+â†</td></tr><tr><td>ç§»åŠ¨å…‰æ ‡åˆ°ä¸‹ä¸€ä¸ªå•è¯</td><td>Ctrl+â†’</td><td>âŒ¥+â†’</td></tr></tbody></table><h2 id="ä»£ç å—æ“ä½œ"><a href="#ä»£ç å—æ“ä½œ" class="headerlink" title="ä»£ç å—æ“ä½œ"></a>ä»£ç å—æ“ä½œ</h2><table><thead><tr><th>æ“ä½œ</th><th>Windows</th><th>Mac</th></tr></thead><tbody><tr><td>å—æ³¨é‡Š</td><td>Ctrl+Shift+&#x2F;</td><td>âŒ˜+â‡§+&#x2F;</td></tr><tr><td>å±•å¼€&#x2F;æŠ˜å ä»£ç å—</td><td>Ctrl+åŠ å·&#x2F;å‡å·</td><td>âŒ˜+åŠ å·&#x2F;å‡å·</td></tr><tr><td>å±•å¼€&#x2F;æŠ˜å å…¨éƒ¨ä»£ç å—</td><td>Ctrl+Shift+åŠ å·&#x2F;å‡å·</td><td>âŒ˜+â‡§+åŠ å·&#x2F;å‡å·</td></tr></tbody></table><h2 id="ä»£ç ç¼–è¾‘"><a href="#ä»£ç ç¼–è¾‘" class="headerlink" title="ä»£ç ç¼–è¾‘"></a>ä»£ç ç¼–è¾‘</h2><table><thead><tr><th>æ“ä½œ</th><th>Windows</th><th>Mac</th></tr></thead><tbody><tr><td>å­—é¢é‡åˆ‡æ¢å¤§å°å†™</td><td>Ctrl+Shift+U</td><td>âŒ˜+â‡§+U</td></tr><tr><td>åˆ é™¤å…‰æ ‡åé¢çš„å•è¯</td><td>Ctrl+Delete</td><td>âŒ¥+Fn+âŒ«</td></tr><tr><td>åˆ é™¤å…‰æ ‡å‰é¢çš„å•è¯</td><td>Ctrl+BackSpace</td><td>âŒ¥+âŒ¦</td></tr><tr><td>åŒ…å›´ä»£ç </td><td>Ctrl+Alt+T</td><td>âŒ˜+âŒ¥+T</td></tr><tr><td>ç”Ÿæˆä»£ç </td><td>Alt+Insert</td><td>âŒƒ+Enter</td></tr><tr><td>è¦†ç›–æ–¹æ³•</td><td>Ctrl+O</td><td>âŒ˜+O</td></tr><tr><td>å®ç°æ–¹æ³•</td><td>Ctrl+I</td><td>âŒ˜+I</td></tr><tr><td>æ›´æ”¹ç­¾å</td><td>Ctrl+F6</td><td>âŒ˜+Fn+F6</td></tr><tr><td>æå–æ–¹æ³•</td><td>Ctrl+Alt+M</td><td>âŒ˜+âŒ¥+M</td></tr><tr><td>æå–å˜é‡</td><td>Ctrl+Alt+V</td><td>âŒ˜+âŒ¥+V</td></tr><tr><td>æå–å­—æ®µ</td><td>Ctrl+Alt+F</td><td>âŒ˜+âŒ¥+F</td></tr><tr><td>æå–å‚æ•°</td><td>Ctrl+Alt+P</td><td>âŒ˜+âŒ¥+P</td></tr><tr><td>å‘ä¸Šæ’å…¥ä¸€è¡Œ</td><td>Ctrl+Alt+Enter</td><td>âŒ˜+Enter</td></tr><tr><td>å‘ä¸‹æ’å…¥ä¸€è¡Œ</td><td>Shift+Enter</td><td>â‡§+Enter</td></tr></tbody></table><h2 id="ç±»å’Œæ–¹æ³•"><a href="#ç±»å’Œæ–¹æ³•" class="headerlink" title="ç±»å’Œæ–¹æ³•"></a>ç±»å’Œæ–¹æ³•</h2><table><thead><tr><th>æ“ä½œ</th><th>Windows</th><th>Mac</th></tr></thead><tbody><tr><td>å¼¹çª—æ˜¾ç¤ºå½“å‰ç±»ç»“æ„</td><td>Ctrl+F12</td><td>âŒ˜+Fn+F12</td></tr><tr><td>æŸ¥çœ‹ç»§æ‰¿æ ‘ç»“æ„</td><td>Ctrl+H</td><td>âŒƒ+H</td></tr><tr><td>ç±»çš„UMLå…³ç³»å›¾</td><td>Ctrl+Alt+U</td><td>âŒ¥+âŒ˜+U</td></tr><tr><td>å¼¹çª—æ˜¾ç¤ºæˆ–è·³è½¬åˆ°çˆ¶ç±»ï¼ˆæ¥å£ï¼‰</td><td>Ctrl+U</td><td>âŒ˜+U</td></tr><tr><td>å¼¹çª—æ˜¾ç¤ºæˆ–è·³è½¬åˆ°å­ç±»</td><td>Ctrl+Alt+B</td><td>âŒ¥+âŒ˜+B</td></tr><tr><td>è·³è½¬åˆ°é€‰æ‹©ç›®æ ‡çš„å®šä¹‰å¤„æˆ–ä½¿ç”¨å¤„</td><td>Ctrl+B</td><td>âŒ˜+B</td></tr><tr><td>æŸ¥çœ‹æ–¹æ³•è°ƒç”¨é“¾</td><td>Ctrl+Alt+H</td><td>âŒƒ+âŒ˜+H</td></tr><tr><td>å½¢å‚æç¤º</td><td>Ctrl+P</td><td>âŒ˜+P</td></tr><tr><td>æŸ¥çœ‹æ–‡æ¡£</td><td>Ctrl+Q</td><td>âŒƒ+J</td></tr></tbody></table><h2 id="ä»£ç è°ƒè¯•"><a href="#ä»£ç è°ƒè¯•" class="headerlink" title="ä»£ç è°ƒè¯•"></a>ä»£ç è°ƒè¯•</h2><table><thead><tr><th>æ“ä½œ</th><th><strong>Windows</strong></th><th><strong>Mac</strong></th></tr></thead><tbody><tr><td>Runå¯åŠ¨</td><td>Shift+F10</td><td>âŒƒ+R</td></tr><tr><td>Debugå¯åŠ¨</td><td>Shift+F9</td><td>âŒƒ+D</td></tr><tr><td>åœæ­¢</td><td>Ctrl+F2</td><td>âŒ˜+Fn+F2</td></tr><tr><td>ä¸‹ä¸€æ­¥ï¼ˆStep Overï¼‰</td><td>F8</td><td>Fn+F8</td></tr><tr><td>ä¸‹ä¸€æ­¥ï¼ˆStep Inï¼‰</td><td>F7</td><td>Fn+F7</td></tr><tr><td>é€‰æ‹©è¿›å…¥å“ªä¸ªæ–¹æ³•</td><td>Shift+F7</td><td>â‡§+Fn+F7</td></tr><tr><td>è·³å‡ºï¼ˆStep Outï¼‰</td><td>Shift+F8</td><td>â‡§+Fn+F8</td></tr><tr><td>æ¢å¤è¿è¡Œ</td><td>F9</td><td>âŒ¥+âŒ˜+R</td></tr><tr><td>è¿è¡Œåˆ°å…‰æ ‡å¤„</td><td>Alt+F9</td><td>âŒ¥+Fn+F9</td></tr><tr><td>åŠ ä¸Š&#x2F;å–æ¶ˆæ–­ç‚¹</td><td>Ctrl+F8</td><td>âŒ˜+Fn+F8</td></tr><tr><td>æŸ¥çœ‹æ‰€æœ‰æ–­ç‚¹</td><td>Ctrl+Shift+F8</td><td>âŒ˜+â‡§+Fn+F8</td></tr><tr><td>è®¡ç®—è¡¨è¾¾å¼</td><td>Alt+F8</td><td>âŒ¥+Fn+F8</td></tr></tbody></table><h2 id="Gitæ“ä½œ"><a href="#Gitæ“ä½œ" class="headerlink" title="Gitæ“ä½œ"></a>Gitæ“ä½œ</h2><table><thead><tr><th>æ“ä½œ</th><th>Windows</th><th>Mac</th></tr></thead><tbody><tr><td>æäº¤ä»£ç </td><td>Ctrl+K</td><td>âŒ˜+K</td></tr><tr><td>æ¨é€ä»£ç </td><td>Ctrl+Shift+K</td><td>â‡§+âŒ˜+K</td></tr><tr><td>æ‹‰å–ä»£ç </td><td>Ctrl+T</td><td>âŒ˜+T</td></tr><tr><td>å¼¹å‡ºgitæ“ä½œ</td><td>Alt+&#96;</td><td>âŒƒ+V</td></tr></tbody></table><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IDEA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatis PlusåŸºç¡€</title>
      <link href="/post/e9be66b7.html"/>
      <url>/post/e9be66b7.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/baomidou/mybatis-plus">MyBatis-Plus</a> æ˜¯ä¸€ä¸ª <a href="https://www.mybatis.org/mybatis-3/">MyBatis</a> çš„å¢å¼ºå·¥å…·ï¼Œåœ¨ MyBatis çš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚</p><p>è¿™ç¯‡ç¬”è®°ä¸»è¦è®°å½•MyBatis-Plusçš„å…¥é—¨ä½¿ç”¨ï¼Œä¸»è¦åŒ…å«å¦‚ä¸‹å†…å®¹ï¼š</p><ul><li>ä½¿ç”¨MyBatis-Pluså®ç°åŸºæœ¬çš„CRUD</li><li>ä½¿ç”¨æ¡ä»¶æ„é€ å™¨æ„å»ºæŸ¥è¯¢å’Œæ›´æ–°è¯­å¥</li><li>ä½¿ç”¨MyBatis-Plusçš„åŸºæœ¬æ³¨è§£</li><li>ä½¿ç”¨MyBatis-Plusçš„æ‰©å±•åŠŸèƒ½</li></ul><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p>åˆ›å»ºè¡¨å¹¶æ’å…¥ä¸€äº›æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> `mp`;</span><br><span class="line">USE `mp`;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">user</span>` (</span><br><span class="line">`id` <span class="type">BIGINT</span>(<span class="number">19</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;ç”¨æˆ·id&#x27;</span>,</span><br><span class="line">`username` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ç”¨æˆ·å&#x27;</span> <span class="keyword">COLLATE</span> <span class="string">&#x27;utf8_general_ci&#x27;</span>,</span><br><span class="line">`password` <span class="type">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;å¯†ç &#x27;</span> <span class="keyword">COLLATE</span> <span class="string">&#x27;utf8_general_ci&#x27;</span>,</span><br><span class="line">`phone` <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æ³¨å†Œæ‰‹æœºå·&#x27;</span> <span class="keyword">COLLATE</span> <span class="string">&#x27;utf8_general_ci&#x27;</span>,</span><br><span class="line">`info` JSON <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è¯¦ç»†ä¿¡æ¯&#x27;</span>,</span><br><span class="line">`status` <span class="type">INT</span>(<span class="number">10</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;ä½¿ç”¨çŠ¶æ€ï¼ˆ1æ­£å¸¸ 2å†»ç»“ï¼‰&#x27;</span>,</span><br><span class="line">`balance` <span class="type">INT</span>(<span class="number">10</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;è´¦æˆ·ä½™é¢&#x27;</span>,</span><br><span class="line">`create_time` DATETIME <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">`update_time` DATETIME <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line"><span class="keyword">UNIQUE</span> INDEX `username` (`username`) <span class="keyword">USING</span> BTREE</span><br><span class="line">)</span><br><span class="line">COMMENT<span class="operator">=</span><span class="string">&#x27;ç”¨æˆ·è¡¨&#x27;</span></span><br><span class="line"><span class="keyword">COLLATE</span><span class="operator">=</span><span class="string">&#x27;utf8_general_ci&#x27;</span></span><br><span class="line">ENGINE<span class="operator">=</span>InnoDB</span><br><span class="line">ROW_FORMAT<span class="operator">=</span>COMPACT</span><br><span class="line">AUTO_INCREMENT<span class="operator">=</span><span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `<span class="keyword">user</span>` (`id`, `username`, `password`, `phone`, `info`, `status`, `balance`, `create_time`, `update_time`) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;Jack&#x27;</span>, <span class="string">&#x27;123&#x27;</span>, <span class="string">&#x27;13900112224&#x27;</span>, <span class="string">&#x27;&#123;&quot;age&quot;: 20, &quot;gender&quot;: &quot;male&quot;&#125;&#x27;</span>, <span class="number">1</span>, <span class="number">1600</span>, <span class="string">&#x27;2023-05-19 20:50:21&#x27;</span>, <span class="string">&#x27;2023-06-19 20:50:21&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;Rose&#x27;</span>, <span class="string">&#x27;123&#x27;</span>, <span class="string">&#x27;13900112223&#x27;</span>, <span class="string">&#x27;&#123;&quot;age&quot;: 19, &quot;gender&quot;: &quot;female&quot;&#125;&#x27;</span>, <span class="number">1</span>, <span class="number">600</span>, <span class="string">&#x27;2023-05-19 21:00:23&#x27;</span>, <span class="string">&#x27;2023-06-19 21:00:23&#x27;</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;Hope&#x27;</span>, <span class="string">&#x27;123&#x27;</span>, <span class="string">&#x27;13900112222&#x27;</span>, <span class="string">&#x27;&#123;&quot;age&quot;: 25, &quot;gender&quot;: &quot;male&quot;&#125;&#x27;</span>, <span class="number">1</span>, <span class="number">100000</span>, <span class="string">&#x27;2023-06-19 22:37:44&#x27;</span>, <span class="string">&#x27;2023-06-19 22:37:44&#x27;</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;Thomas&#x27;</span>, <span class="string">&#x27;123&#x27;</span>, <span class="string">&#x27;17701265258&#x27;</span>, <span class="string">&#x27;&#123;&quot;age&quot;: 29, &quot;gender&quot;: &quot;male&quot;&#125;&#x27;</span>, <span class="number">1</span>, <span class="number">800</span>, <span class="string">&#x27;2023-06-19 23:44:45&#x27;</span>, <span class="string">&#x27;2023-06-19 23:44:45&#x27;</span>);</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå·¥ç¨‹ã€æ–°å»º<code>User</code>ã€<code>UserMapper</code></p><img src="/post/e9be66b7/image-20241102093153288.png" class="" title="image-20241102093153288"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">    <span class="keyword">private</span> String info;</span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="keyword">private</span> Integer balance;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼•å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-plus.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åŸºæœ¬é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/mp?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">xxx</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.itheima:</span> <span class="string">debug</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">dateformat:</span> <span class="string">HH:mm:ss</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath*:/mapper/**/*.xml</span></span><br></pre></td></tr></table></figure><h2 id="åŸºæœ¬åŠŸèƒ½"><a href="#åŸºæœ¬åŠŸèƒ½" class="headerlink" title="åŸºæœ¬åŠŸèƒ½"></a>åŸºæœ¬åŠŸèƒ½</h2><h3 id="å•è¡¨CRUD"><a href="#å•è¡¨CRUD" class="headerlink" title="å•è¡¨CRUD"></a>å•è¡¨CRUD</h3><p>MyBatis Plusæä¾›äº†ä¸€ä¸ªåŸºç¡€çš„<code>BaseMapper</code>æ¥å£ï¼Œå®ç°äº†å•è¡¨çš„CRUDï¼Œè‡ªå®šä¹‰Mapperåªè¦ç»§æ‰¿äº†<code>BaseMapper</code>ï¼Œå°±æ— éœ€å®ç°å•è¡¨çš„CRUDäº†ã€‚</p><img src="/post/e9be66b7/image-20241102144540554.png" class="" title="image-20241102144540554"><p>åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»ï¼Œæµ‹è¯•åŸºæœ¬çš„CRUDåŠŸèƒ½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testInsert</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(<span class="number">5L</span>);</span><br><span class="line">        user.setUsername(<span class="string">&quot;Lucy&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        user.setPhone(<span class="string">&quot;18688990011&quot;</span>);</span><br><span class="line">        user.setBalance(<span class="number">200</span>);</span><br><span class="line">        user.setInfo(<span class="string">&quot;&#123;\&quot;age\&quot;: 24, \&quot;intro\&quot;: \&quot;è‹±æ–‡è€å¸ˆ\&quot;, \&quot;gender\&quot;: \&quot;female\&quot;&#125;&quot;</span>);</span><br><span class="line">        user.setCreateTime(LocalDateTime.now());</span><br><span class="line">        user.setUpdateTime(LocalDateTime.now());</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSelectById</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(<span class="number">5L</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;user = &quot;</span> + user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testQueryByIds</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;User&gt; users = userMapper.selectBatchIds(Arrays.asList(<span class="number">1L</span>, <span class="number">2L</span>, <span class="number">3L</span>));</span><br><span class="line">        users.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testUpdateById</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(<span class="number">5L</span>);</span><br><span class="line">        user.setBalance(<span class="number">20000</span>);</span><br><span class="line">        userMapper.updateById(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDeleteUser</span><span class="params">()</span> &#123;</span><br><span class="line">        userMapper.deleteById(<span class="number">5L</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¸¸ç”¨æ³¨è§£"><a href="#å¸¸ç”¨æ³¨è§£" class="headerlink" title="å¸¸ç”¨æ³¨è§£"></a>å¸¸ç”¨æ³¨è§£</h3><p>MyBatis Plusé€šè¿‡æ‰«æå®ä½“ç±»ï¼ŒåŸºäºåå°„å°†å®ä½“ç±»æ˜ å°„åˆ°æ•°æ®åº“ä¸­çš„è¡¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ä½“ç±»çš„ç±»åå’Œå­—æ®µåä¸è¡¨ä¸­çš„åˆ—ååº”è¯¥ä¸€ä¸€å¯¹åº”ï¼Œå¦‚æœå‡ºç°ä¸ä¸€è‡´ï¼Œå°±éœ€è¦é€šè¿‡æ³¨è§£è¿›è¡ŒæŒ‡å®šã€‚</p><p>å¸¸ç”¨æ³¨è§£</p><ul><li><code>@TableName</code>ï¼šæŒ‡å®šè¡¨å</li><li><code>@TableId</code>ï¼šæŒ‡å®šä¸»é”®</li><li><code>@TableFiled</code>ï¼šæŒ‡å®šæ™®é€šå­—æ®µ</li></ul><p>å…¶ä¸­ <code>@TableField</code> çš„å¸¸è§ä½¿ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableName(&quot;tb_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœidæ˜¯è‡ªå¢é•¿ç±»å‹ï¼Œéœ€æ˜ç¡®æŒ‡å®šIdTypeä¸ºAUTO</span></span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">// æˆå‘˜å˜é‡åä¸è¡¨å­—æ®µåä¸ä¸€è‡´</span></span><br><span class="line">    <span class="meta">@TableFiled(&quot;username&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">// ä»¥iså¼€å¤´çš„å¸ƒå°”ç±»å‹æˆå‘˜å˜é‡ï¼Œåºåˆ—åŒ–æ—¶ä¼šå°†iså»é™¤ï¼Œå¯¼è‡´æ— æ³•ä¸è¡¨ä¸­is_marriedåŒ¹é…ï¼Œéœ€æ‰‹åŠ¨æŒ‡å®š</span></span><br><span class="line">    <span class="meta">@TableField(&quot;is_married&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isMarried;</span><br><span class="line">    <span class="comment">// è¡¨å­—æ®µæ˜¯æ•°æ®åº“å…³é”®å­—</span></span><br><span class="line">    <span class="meta">@TableField(&quot;`order`&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer order;</span><br><span class="line">    <span class="comment">// æˆå‘˜å˜é‡ä¸æ˜¯æ•°æ®åº“å­—æ®µ</span></span><br><span class="line">    <span class="meta">@TableField(exist = false)</span></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¡ä»¶æ„é€ å™¨"><a href="#æ¡ä»¶æ„é€ å™¨" class="headerlink" title="æ¡ä»¶æ„é€ å™¨"></a>æ¡ä»¶æ„é€ å™¨</h2><p>MyBatis-Plusé™¤äº†æ”¯æŒä»¥<code>id</code>ä½œä¸ºåŸºæœ¬çš„æŸ¥è¯¢æ¡ä»¶ä¹‹å¤–ï¼Œè¿˜æ”¯æŒé€šè¿‡<code>Wrapper</code>æ„é€ å¤æ‚çš„æŸ¥è¯¢æ¡ä»¶ã€‚<code>Wrapper</code>çš„ç»§æ‰¿å…³ç³»å›¾å¦‚ä¸‹ï¼š</p><img src="/post/e9be66b7/image-20241102143801416.png" class="" title="image-20241102143801416"><p>å…¶ä¸­å­ç±»<code>AbstractWrapper</code>æä¾›äº†<code>where</code>å­å¥ä¸­ä¼šç”¨åˆ°çš„æ‰€æœ‰æ¡ä»¶æ„é€ æ–¹æ³•ï¼š</p><img src="/post/e9be66b7/image-20241102144423632.png" class="" title="image-20241102144423632"><h3 id="QueryWrapper"><a href="#QueryWrapper" class="headerlink" title="QueryWrapper"></a><code>QueryWrapper</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testQueryWrapper</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;()</span><br><span class="line">        .select(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;username&quot;</span>, <span class="string">&quot;balance&quot;</span>) <span class="comment">// ç¡¬ç¼–ç </span></span><br><span class="line">        .like(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;ho&quot;</span>)</span><br><span class="line">        .ge(<span class="string">&quot;balance&quot;</span>, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">final</span> List&lt;User&gt; users = userMapper.selectList(queryWrapper);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="UpdateWrapper"><a href="#UpdateWrapper" class="headerlink" title="UpdateWrapper"></a><code>UpdateWrapper</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdateWrapper</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> UpdateWrapper&lt;User&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;User&gt;()</span><br><span class="line">        .setSql(<span class="string">&quot;balance = balance + 1000&quot;</span>) </span><br><span class="line">        .in(<span class="string">&quot;id&quot;</span>, <span class="number">1L</span>, <span class="number">2L</span>); <span class="comment">// ç¡¬ç¼–ç </span></span><br><span class="line">    userMapper.update(updateWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="LambdaQueryWrapper"><a href="#LambdaQueryWrapper" class="headerlink" title="LambdaQueryWrapper"></a><code>LambdaQueryWrapper</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLambdaQueryWrapper</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;()</span><br><span class="line">        .select(User::getId, User::getUsername, User::getBalance)</span><br><span class="line">        .like(User::getUsername, <span class="string">&quot;ho&quot;</span>)</span><br><span class="line">        .ge(User::getBalance, <span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">final</span> List&lt;User&gt; users = userMapper.selectList(queryWrapper);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="LambdaUpdateWrapper"><a href="#LambdaUpdateWrapper" class="headerlink" title="LambdaUpdateWrapper"></a><code>LambdaUpdateWrapper</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testLambdaUpdateWrapper</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> LambdaUpdateWrapper&lt;User&gt; updateWrapper = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;User&gt;()</span><br><span class="line">        .setSql(<span class="string">&quot;balance = balance - 500&quot;</span>)</span><br><span class="line">        .in(User::getId, <span class="number">1L</span>, <span class="number">2L</span>);</span><br><span class="line">    userMapper.update(updateWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="IServiceæ¥å£"><a href="#IServiceæ¥å£" class="headerlink" title="IServiceæ¥å£"></a>IServiceæ¥å£</h2><p><code>BaseMapper</code>æ¥å£æä¾›äº†åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥æ¥å£ï¼Œä½†æ˜¯è¿™äº›æ¥å£åªèƒ½æ“ä½œå•ä¸ªå¯¹è±¡ã€‚å› æ­¤MyBatis-Pluså¦å¤–æä¾›äº†ä¸€ä¸ª<code>IService</code>æ¥å£ï¼Œæ¥å£åŒ…å«äº†ä¸€å †æ‰¹å¤„ç†æ¥å£ï¼Œå®ç°ç±»<code>ServiceImpl</code>æä¾›äº†åŸºæœ¬çš„å®ç°ã€‚</p><img src="/post/e9be66b7/image-20241102164213193.png" class="" title="image-20241102164213193"><h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h3><p>å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-openapi2-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>swaggeré…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">knife4j:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">openapi:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">æ¥å£æ–‡æ¡£</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">&quot;æ¥å£æ–‡æ¡£&quot;</span></span><br><span class="line">    <span class="attr">group:</span></span><br><span class="line">      <span class="attr">default:</span></span><br><span class="line">        <span class="attr">group-name:</span> <span class="string">default</span></span><br><span class="line">        <span class="attr">api-rule:</span> <span class="string">package</span></span><br><span class="line">        <span class="attr">api-rule-resources:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">com.tw.mbp.controller</span></span><br></pre></td></tr></table></figure><p>mapper</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateBalanceByIds</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> LambdaQueryWrapper&lt;User&gt; queryWrapper, <span class="meta">@Param(&quot;amount&quot;)</span> <span class="type">int</span> amount)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update(&quot;update user set balance = balance - #&#123;amount&#125; where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deductBalance</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Long id, <span class="meta">@Param(&quot;amount&quot;)</span> Integer amount)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>service</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deductBalance</span><span class="params">(Long id, Integer amount)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ç®€å•CURDç›´æ¥ä½¿ç”¨IServiceä¸­å®šä¹‰å¥½çš„æ–¹æ³•ï¼Œå¦‚getById()æ–¹æ³•</span></span><br><span class="line"><span class="comment">         * ä¸šåŠ¡å¤„ç†åœ¨è‡ªå®šä¹‰serviceä¸­å®ç°ï¼Œå¦‚ç”¨æˆ·çŠ¶æ€æ ¡éªŒã€ä½™é¢æ ¡éªŒ</span></span><br><span class="line"><span class="comment">         * éœ€è¦ç¼–å†™é¢å¤–SQLåœ¨è‡ªå®šä¹‰Mapperä¸­å®ç°ï¼Œå¦‚deductBalance()æ–¹æ³•</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> getById(id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç”¨æˆ·çŠ¶æ€æ ¡éªŒ</span></span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span> || user.getStatus() == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç”¨æˆ·ä¸å­˜åœ¨æˆ–å·²è¢«å†»ç»“&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½™é¢æ ¡éªŒ</span></span><br><span class="line">        <span class="keyword">if</span> (user.getBalance() &lt; amount) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç”¨æˆ·ä½™é¢ä¸è¶³&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›´æ–°ä½™é¢</span></span><br><span class="line">        <span class="built_in">this</span>.baseMapper.deductBalance(id, amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(tags = &quot;ç”¨æˆ·ç®¡ç†æ¥å£&quot;)</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Springæ¨èä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥ï¼Œå› æ­¤è¿™é‡Œä¸ä½¿ç”¨@Autowiredæ³¨è§£ï¼›</span></span><br><span class="line">    <span class="comment">// ä½†æ˜¯å¦‚æœç±»çš„å­—æ®µè¿‡å¤šï¼Œæ„é€ å‡½æ•°ä¼šæ˜¾å¾—è‡ƒè‚¿ï¼Œå¯ä»¥ç”¨finalä¿®é¥°ç¬¦åŠ @RequiredArgsConstructoræ³¨è§£å®ç°å­—æ®µæ³¨å…¥</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;æ‰£å‡ä½™é¢&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/&#123;id&#125;/deduct/&#123;amount&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deductBalance</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@PathVariable</span> Integer amount)</span> &#123;</span><br><span class="line">        userService.deductBalance(id, amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="lambdaæ–¹æ³•"><a href="#lambdaæ–¹æ³•" class="headerlink" title="lambdaæ–¹æ³•"></a>lambdaæ–¹æ³•</h3><p><code>lambdaQuery()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">queryUsers</span><span class="params">(UserQuery query)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> lambdaQuery()</span><br><span class="line">        .like(StrUtil.isNotBlank(query.getName()), User::getUsername, query.getName())</span><br><span class="line">        .eq(query.getStatus() != <span class="literal">null</span>, User::getStatus, query.getStatus())</span><br><span class="line">        .ge(query.getMinBalance() != <span class="literal">null</span>, User::getBalance, query.getMinBalance())</span><br><span class="line">        .le(query.getMaxBalance() != <span class="literal">null</span>, User::getBalance, query.getMaxBalance())</span><br><span class="line">        .list();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>lambdaUpdate</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deductBalance</span><span class="params">(Long id, Integer amount)</span> &#123;</span><br><span class="line">    <span class="comment">// æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> getById(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¡éªŒç”¨æˆ·çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">if</span> (user == <span class="literal">null</span> || user.getStatus() == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç”¨æˆ·ä¸å­˜åœ¨æˆ–å·²è¢«å†»ç»“&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¡éªŒä½™é¢</span></span><br><span class="line">    <span class="keyword">if</span> (user.getBalance() &lt; amount) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ç”¨æˆ·ä½™é¢ä¸è¶³&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ›´æ–°ä½™é¢</span></span><br><span class="line">    <span class="comment">// this.baseMapper.deductBalance(id, amount);</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">newBalance</span> <span class="operator">=</span> user.getBalance() - amount;</span><br><span class="line">    lambdaUpdate()</span><br><span class="line">        .set(User::getBalance, newBalance)</span><br><span class="line">        .set(newBalance &lt;= <span class="number">0</span>, User::getStatus, <span class="number">2</span>)</span><br><span class="line">        .eq(User::getId, id)</span><br><span class="line">        .update();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‰¹å¤„ç†"><a href="#æ‰¹å¤„ç†" class="headerlink" title="æ‰¹å¤„ç†"></a>æ‰¹å¤„ç†</h3><p>å½“è¦æ’å…¥å¤šæ¡æ•°æ®æ—¶ï¼Œå¦‚æœé€æ¡æ’å…¥ï¼ˆè°ƒç”¨<code>save()</code>æ–¹æ³•ï¼‰ï¼Œæ•ˆç‡è¾ƒä½ï¼Œå› ä¸ºæ¯æ¬¡æ’å…¥éƒ½ä¼šè¯·æ±‚ç½‘ç»œï¼Œæ•°æ®åº“å±‚é¢çš„sqlä¹Ÿæ˜¯é€æ¡æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testSaveOneByOne</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">5_0000</span>; i++) &#123;</span><br><span class="line">        userService.save(buildUser(i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">&quot;è€—è´¹æ—¶é—´&quot;</span> + (endTime - startTime));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/post/e9be66b7/image-20241102213505591.png" class="" title="image-20241102213505591"><p>ä¸ºäº†æé«˜æ•ˆç‡ï¼Œå¯ä»¥æ”¹ç”¨æ‰¹é‡æ’å…¥ï¼ˆè°ƒç”¨<code>saveBatch()</code>æ–¹æ³•ï¼‰ï¼Œ<code>saveBatch()</code>åŸºäºé¢„ç¼–è¯‘å¤„ç†ï¼Œåªéœ€å‘èµ·å°‘é‡ç½‘ç»œè¯·æ±‚ï¼Œä½†æ•°æ®åº“å±‚é¢çš„sqlä¾ç„¶æ˜¯é€æ¡æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testSaveBatch</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(<span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">5_0000</span>; i++) &#123;</span><br><span class="line">        users.add(buildUser(i));</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">1000</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            userService.saveBatch(users);</span><br><span class="line">            users.clear();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    System.out.println(<span class="string">&quot;è€—è´¹æ—¶é—´&quot;</span> + (endTime - startTime));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/post/e9be66b7/image-20241102213654618.png" class="" title="image-20241102213654618"><p>ä¸ºäº†æ˜¯æ‰¹é‡æ’å…¥çš„æ•ˆç‡æœ€å¤§åŒ–ï¼Œéœ€å¼€å¯<code>rewriteBatchedStatements=true</code>ï¼Œå¼€å¯åæ•°æ®åº“ä¼šé‡å†™sqlï¼Œå¤šæ¡æ’å…¥è¯­å¥ä¼šåˆå¹¶æˆä¸€æ¡æ¥æ‰§è¡Œ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/mp?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai&amp;rewriteBatchedStatements=true</span></span><br></pre></td></tr></table></figure><img src="/post/e9be66b7/image-20241102213940690.png" class="" title="image-20241102213940690"><h2 id="é«˜çº§åŠŸèƒ½"><a href="#é«˜çº§åŠŸèƒ½" class="headerlink" title="é«˜çº§åŠŸèƒ½"></a>é«˜çº§åŠŸèƒ½</h2><h3 id="é€»è¾‘åˆ é™¤"><a href="#é€»è¾‘åˆ é™¤" class="headerlink" title="é€»è¾‘åˆ é™¤"></a>é€»è¾‘åˆ é™¤</h3><p>æ·»åŠ é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">logic-delete-field:</span> <span class="string">deleted</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testLogicDelete</span><span class="params">()</span> &#123;</span><br><span class="line">    userService.removeById(<span class="number">1L</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><img src="/post/e9be66b7/image-20241102231813017.png" class="" title="image-20241102231813017"><p>å¼€å¯é€»è¾‘åˆ é™¤åŠŸèƒ½åï¼ŒæŸ¥è¯¢æ“ä½œçš„è¿‡æ»¤æ¡ä»¶é»˜è®¤éƒ½ä¼šå¸¦ä¸Š <code>deleted = 0</code> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testQueryWithLogicDelete</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(<span class="number">1L</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="/post/e9be66b7/image-20241102232415756.png" class="" title="image-20241102232415756"><p>PSï¼šé€»è¾‘åˆ é™¤ä¼šå¯¼è‡´è¡¨ä¸­æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œéšç€æ•°æ®çš„å †ç§¯ä¼šå½±å“æŸ¥è¯¢æ•ˆç‡ã€‚</p><h3 id="æšä¸¾æ˜ å°„"><a href="#æšä¸¾æ˜ å°„" class="headerlink" title="æšä¸¾æ˜ å°„"></a>æšä¸¾æ˜ å°„</h3><p>æšä¸¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">UserStatus</span> &#123;</span><br><span class="line"></span><br><span class="line">    NORMAL(<span class="number">1</span>, <span class="string">&quot;æ­£å¸¸&quot;</span>),</span><br><span class="line">    FREEZE(<span class="number">2</span>, <span class="string">&quot;å†»ç»“&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EnumValue</span> <span class="comment">// æŒ‡å®šä¸è¡¨ä¸­å­—æ®µæ˜ å°„çš„æšä¸¾å­—æ®µ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonValue</span> <span class="comment">// æŒ‡å®šåºåˆ—åŒ–è¿”å›ç»™å‰ç«¯çš„æšä¸¾å­—æ®µ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String desc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é…ç½®</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">default-enum-type-handler:</span> <span class="string">com.baomidou.mybatisplus.core.handlers.MybatisEnumTypeHandler</span></span><br></pre></td></tr></table></figure><h3 id="JSONæ˜ å°„"><a href="#JSONæ˜ å°„" class="headerlink" title="JSONæ˜ å°„"></a>JSONæ˜ å°„</h3><p>å°†è¡¨ä¸­<code>json</code>ç±»å‹å­—æ®µè½¬æ¢æˆå®ä½“ç±»ä¸­å¯¹è±¡æˆå‘˜å˜é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(value = &quot;user&quot;, autoResultMap = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableField(typeHandler = JacksonTypeHandler.class)</span></span><br><span class="line">    <span class="keyword">private</span> ExtraInfo info;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor(staticName = &quot;of&quot;)</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExtraInfo</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è‡ªåŠ¨å¡«å……å­—æ®µ"><a href="#è‡ªåŠ¨å¡«å……å­—æ®µ" class="headerlink" title="è‡ªåŠ¨å¡«å……å­—æ®µ"></a>è‡ªåŠ¨å¡«å……å­—æ®µ</h3><img src="/post/e9be66b7/image-20241103020436064.png" class="" title="image-20241103020436064"><p><code>user</code>è¡¨çš„æ—¶é—´å­—æ®µå®šä¹‰äº†é»˜è®¤å€¼ï¼Œå› æ­¤åœ¨æ’å…¥æ•°æ®æ—¶æ— éœ€æ‰‹åŠ¨å¡«å……è¿™ä¸¤ä¸ªå­—æ®µçš„å€¼ã€‚ä½†æ˜¯å¦‚æœå®šä¹‰è¡¨æ—¶æœªæŒ‡å®šå­—æ®µçš„é»˜è®¤å€¼ï¼Œå¯ä»¥ä½¿ç”¨MyBatis-Plusæä¾›çš„è‡ªåŠ¨å¡«å……å­—æ®µåŠŸèƒ½åœ¨æ’å…¥æ•°æ®æ—¶è‡ªåŠ¨å¡«å……æ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strictInsertFill(metaObject, <span class="string">&quot;createTime&quot;</span>, LocalDateTime::now, LocalDateTime.class);</span><br><span class="line">        <span class="built_in">this</span>.strictInsertFill(metaObject, <span class="string">&quot;updateTime&quot;</span>, LocalDateTime::now, LocalDateTime.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strictUpdateFill(metaObject, <span class="string">&quot;updateTime&quot;</span>, LocalDateTime::now, LocalDateTime.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableField(value = &quot;create_time&quot;, fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ›´æ–°æ—¶é—´</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@TableField(value = &quot;update_time&quot;, fill = FieldFill.INSERT_UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime updateTime;</span><br></pre></td></tr></table></figure><h3 id="åˆ†é¡µ"><a href="#åˆ†é¡µ" class="headerlink" title="åˆ†é¡µ"></a>åˆ†é¡µ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">MybatisPlusInterceptor</span> <span class="variable">mybatisPlusInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ†é¡µæ’ä»¶</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">PaginationInnerInterceptor</span> <span class="variable">paginationInnerInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.MYSQL);</span><br><span class="line">        paginationInnerInterceptor.setMaxLimit(<span class="number">100L</span>);</span><br><span class="line">        mybatisPlusInterceptor.addInnerInterceptor(paginationInnerInterceptor);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> mybatisPlusInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testPaginationInnerInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">    Page&lt;User&gt; page = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(<span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">    page.setOrders(OrderItem.ascs(<span class="string">&quot;balance&quot;</span>));</span><br><span class="line">    page = userService.page(page);</span><br><span class="line">    page.getRecords().forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><img src="/post/e9be66b7/image-20241103005233009.png" class="" title="image-20241103005233009"><h3 id="ä¹è§‚é”"><a href="#ä¹è§‚é”" class="headerlink" title="ä¹è§‚é”"></a>ä¹è§‚é”</h3><p>æ›´æ–°æ—¶ä¼šå¢åŠ ä¸€ä¸ªversionæ¡ä»¶ï¼Œå¦‚æœversionå’Œä¹‹å‰æŸ¥å‡ºæ¥çš„ä¸ä¸€è‡´ï¼Œå°±åœæ­¢æ›´æ–°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">MybatisPlusInterceptor</span> <span class="variable">mybatisPlusInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¹è§‚é”æ’ä»¶</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">OptimisticLockerInnerInterceptor</span> <span class="variable">optimisticLockerInnerInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OptimisticLockerInnerInterceptor</span>();</span><br><span class="line">        mybatisPlusInterceptor.addInnerInterceptor(optimisticLockerInnerInterceptor);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> mybatisPlusInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testOptimisticLockerInnerInterceptor</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(<span class="number">2L</span>);</span><br><span class="line">    user.setBalance(<span class="number">999</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> userService.getById(<span class="number">2L</span>);</span><br><span class="line">        user1.setBalance(<span class="number">888</span>);</span><br><span class="line">        userService.updateById(user1);</span><br><span class="line">    &#125;).start();</span><br><span class="line"></span><br><span class="line">    TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">updated</span> <span class="operator">=</span> userService.updateById(user);</span><br><span class="line">    Assertions.assertFalse(updated);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œç»“æœ</p><img src="/post/e9be66b7/image-20241103015855684.png" class="" title="image-20241103015855684"><img src="/post/e9be66b7/image-20241103020004869.png" class="" title="image-20241103020004869"><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> MyBatis-Plus </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MyBatis-Plus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatisåŸºç¡€</title>
      <link href="/post/4658a061.html"/>
      <url>/post/4658a061.html</url>
      
        <content type="html"><![CDATA[<h2 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h2><h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><p>åˆ›å»º<code>user</code>è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">user</span>` (</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `pwd` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">6</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci;</span><br></pre></td></tr></table></figure><span id="more"></span><p>åˆ›å»ºmavenå·¥ç¨‹ï¼Œå¹¶å®šä¹‰<code>User</code>å®ä½“ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name, String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h3><p>å®šä¹‰ <code>UserMapper</code>ï¼Œå¹¶å®šä¹‰ä¸€ä¸ªæŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·çš„æ–¹æ³•<code>listUsers</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">listUsers</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨resources&#x2F;mapperç›®å½•ä¸‹åˆ›å»º<code>UserMapper.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.tw.mybatis.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.tw.mybatis.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        select * from User</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨resourcesç›®å½•ä¸‹åˆ›å»º<code>mybatis-config.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatis?useSSL=false<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8<span class="symbol">&amp;amp;</span>serverTimezone=Asia/Shanghai&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Time_Wait7&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mapper/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å®šä¹‰<code>MyBatisUtil</code>ï¼Œç”¨äºè·å–<code>SqlSession</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">            sqlSessionFactory = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title function_">getSqlSession</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory.openSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title function_">getSqlSession</span><span class="params">(<span class="type">boolean</span> autoCommit)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory.openSession(autoCommit);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserMapperTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testListUsers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MyBatisUtil.getSqlSession()) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> sqlSession.getMapper(UserDao.class);</span><br><span class="line">            userDao.listUsers().forEach(System.out::println);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç®€å•CRUD"><a href="#ç®€å•CRUD" class="headerlink" title="ç®€å•CRUD"></a>ç®€å•CRUD</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; <span class="title function_">listUsers</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">addUser</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateUser</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteUser</span><span class="params">(Long id)</span>;</span><br><span class="line">    </span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="xmlé…ç½®"><a href="#xmlé…ç½®" class="headerlink" title="xmlé…ç½®"></a>xmlé…ç½®</h4><p>åœ¨<code>UserMapper.xml</code>ç¼–å†™å¯¹åº”çš„sql</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.tw.mybatis.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addUser&quot;</span>&gt;</span></span><br><span class="line">        insert into User(name,pwd) values(#&#123;name&#125;,#&#123;pwd&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span>&gt;</span></span><br><span class="line">        update User set name = #&#123;name&#125;,pwd = #&#123;pwd&#125; where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUser&quot;</span>&gt;</span></span><br><span class="line">        delete from User where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.tw.mybatis.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        select * from User</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.tw.mybatis.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        select * from User where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tw.mybatis.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.tw.mybatis.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Delete;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Insert;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Update;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from user&quot;)</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">listUsers</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨è§£æ–¹å¼ï¼Œæ ¹æ®idæŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Select(&quot;select * from user where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨è§£æ–¹å¼ï¼Œæ·»åŠ ç”¨æˆ·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into user(name, pwd) values(#&#123;name&#125;, #&#123;password&#125;) &quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">addUser</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨è§£æ–¹å¼ï¼Œæ›´æ–°ç”¨æˆ·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Update(&quot;update user set pwd = #&#123;password&#125; where name = #&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateUser</span><span class="params">(User user)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨è§£æ–¹å¼ï¼Œåˆ é™¤ç”¨æˆ·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Delete(&quot;delete from user where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteUser</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="åˆ†é¡µæŸ¥è¯¢"><a href="#åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="åˆ†é¡µæŸ¥è¯¢"></a>åˆ†é¡µæŸ¥è¯¢</h3><p>æ–¹å¼ä¸€ï¼šè‡ªå®šä¹‰sql</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">listUsersByPage</span><span class="params">(<span class="meta">@Param(&quot;offset&quot;)</span> Integer offset, <span class="meta">@Param(&quot;limit&quot;)</span> Integer limit)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.tw.mybatis.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;UserMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span> <span class="attr">column</span>=<span class="string">&quot;pwd&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listUsersByPage&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;UserMap&quot;</span>&gt;</span></span><br><span class="line">        select * from User limit #&#123;offset&#125;,#&#123;limit&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ–¹å¼äºŒï¼š<code>RowBounds</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">listUsersByRowBounds</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.tw.mybatis.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;UserMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span> <span class="attr">column</span>=<span class="string">&quot;pwd&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listUsersByPage&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;UserMap&quot;</span>&gt;</span></span><br><span class="line">        select * from User</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testListUsersByRowBounds</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MyBatisUtil.getSqlSession()) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> sqlSession.getMapper(UserDao.class);</span><br><span class="line">        <span class="keyword">final</span> List&lt;User&gt; users = sqlSession.selectList(<span class="string">&quot;com.tw.mybatis.dao.UserDao.listUsersByRowBounds&quot;</span>, <span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">RowBounds</span>(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">        users.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><h3 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h3><p>ç›´æ¥å°†æ•°æ®åº“è¿æ¥ä¿¡æ¯ç¡¬ç¼–ç åœ¨<code>mybatis-config.xml</code>æ–‡ä»¶ä¸­ä¸å¤Ÿä¼˜é›…ï¼Œæ•°æ®åº“è¿æ¥å±æ€§å¯ä»¥åœ¨å¤–éƒ¨è¿›è¡Œé…ç½®ï¼Œå¹¶å¯ä»¥è¿›è¡ŒåŠ¨æ€æ›¿æ¢ã€‚</p><p>åˆ›å»º<code>db.properties</code>æ–‡ä»¶</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis?useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">xxx</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;db.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mapper/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ç±»å‹åˆ«å"><a href="#ç±»å‹åˆ«å" class="headerlink" title="ç±»å‹åˆ«å"></a>ç±»å‹åˆ«å</h3><p>åœ¨ä¸Šè¿°ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ<code>resultType</code>å±æ€§éœ€è¦å†™ç±»çš„å…¨è·¯å¾„ï¼Œæœ‰ç‚¹ç¹çï¼Œå¯ä»¥é…ç½®åˆ«åç®€åŒ–ä¹¦å†™ã€‚é…ç½®åˆ«åæœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š</p><p>æ–¹å¼ä¸€ï¼šä¸ºæŒ‡å®šç±»é…ç½®åˆ«å</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®åˆ«å --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.tw.mybatis.pojo.User&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;user&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ–¹å¼äºŒï¼šæŒ‡å®šåŒ…ä¸‹çš„å®ä½“ç±»é»˜è®¤ä»¥ç±»åå°å†™ä½œä¸ºåˆ«å</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é…ç½®åˆ«å --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.tw.mybatis.pojo&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®åˆ«åä¹‹åï¼Œ<code>resultType</code>å°±å¯ä»¥ç®€å†™å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.tw.mybatis.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        select * from User</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        select * from User where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="æ˜ å°„"><a href="#æ˜ å°„" class="headerlink" title="æ˜ å°„"></a>æ˜ å°„</h2><h3 id="ç®€å•æ˜ å°„"><a href="#ç®€å•æ˜ å°„" class="headerlink" title="ç®€å•æ˜ å°„"></a>ç®€å•æ˜ å°„</h3><p>å¦‚æœå®ä½“ç±»å±æ€§å’Œè¡¨å­—æ®µä¸ä¸€è‡´ï¼Œå°±éœ€è¦æ‰‹åŠ¨æŒ‡å®šæ˜ å°„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¡¨å­—æ®µæ˜¯pwd</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.tw.mybatis.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;UserMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æŒ‡å®šå®ä½“ç±»å±æ€§ä¸è¡¨å­—æ®µçš„æ˜ å°„å…³ç³» --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span> <span class="attr">column</span>=<span class="string">&quot;pwd&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listUsers&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;UserMap&quot;</span>&gt;</span></span><br><span class="line">        select * from User</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å¤æ‚æ˜ å°„"><a href="#å¤æ‚æ˜ å°„" class="headerlink" title="å¤æ‚æ˜ å°„"></a>å¤æ‚æ˜ å°„</h3><h4 id="ç¯å¢ƒå‡†å¤‡-1"><a href="#ç¯å¢ƒå‡†å¤‡-1" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h4><p>åˆ›å»º<code>student</code>å’Œ<code>teacher</code>è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `student` (</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `tid` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `fk_tid` (`tid`),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `fk_tid` <span class="keyword">FOREIGN</span> KEY (`tid`) <span class="keyword">REFERENCES</span> `teacher` (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">6</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `teacher` (</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3;</span><br></pre></td></tr></table></figure><p>å®šä¹‰<code>Student</code>å’Œ<code>Teacher</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Teacher</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Teacher teacher;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰<code>Mapper</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentMapper</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TeacherMapper</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»º<code>Mapper.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.tw.mybatis.dao.StudentMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.tw.mybatis.dao.TeacherMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®æ˜ å°„æ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mapper/TeacherMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mapper/StudentMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="association"><a href="#association" class="headerlink" title="association"></a><code>association</code></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯ï¼ŒåŒæ—¶åŒ…å«è€å¸ˆä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;Student&gt; <span class="title function_">listStudentsWithTeacher</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å­æŸ¥è¯¢æ–¹å¼"><a href="#å­æŸ¥è¯¢æ–¹å¼" class="headerlink" title="å­æŸ¥è¯¢æ–¹å¼"></a>å­æŸ¥è¯¢æ–¹å¼</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.tw.mybatis.dao.StudentMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;StudentWithTeacher&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;teacher&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Teacher&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tid&quot;</span> <span class="attr">select</span>=<span class="string">&quot;getTeacher&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listStudentsWithTeacher&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;StudentWithTeacher&quot;</span>&gt;</span></span><br><span class="line">        select * from student</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getTeacher&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Teacher&quot;</span>&gt;</span></span><br><span class="line">        select * from teacher where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="è¿è¡¨æŸ¥è¯¢æ–¹å¼"><a href="#è¿è¡¨æŸ¥è¯¢æ–¹å¼" class="headerlink" title="è¿è¡¨æŸ¥è¯¢æ–¹å¼"></a>è¿è¡¨æŸ¥è¯¢æ–¹å¼</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.tw.mybatis.dao.StudentMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;StudentWithTeacher2&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;teacher&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Teacher&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tid&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tname&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listStudentsWithTeacher2&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;StudentWithTeacher2&quot;</span>&gt;</span></span><br><span class="line">        select s.id sid, s.name sname, t.id tid, t.name tname</span><br><span class="line">        from student s left join teacher t</span><br><span class="line">        on s.tid = t.id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="collection"><a href="#collection" class="headerlink" title="collection"></a><code>collection</code></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long tid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Teacher</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Student&gt; students;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TeacherMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;Teacher&gt; <span class="title function_">selectList</span><span class="params">(Object o)</span>;</span><br><span class="line"></span><br><span class="line">    Teacher <span class="title function_">getTeacherWithStudents</span><span class="params">(<span class="meta">@Param(&quot;tid&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="å­æŸ¥è¯¢æ–¹å¼-1"><a href="#å­æŸ¥è¯¢æ–¹å¼-1" class="headerlink" title="å­æŸ¥è¯¢æ–¹å¼"></a>å­æŸ¥è¯¢æ–¹å¼</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.tw.mybatis.dao.TeacherMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;TeacherWithStudents&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Teacher&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;students&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;ArrayList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Student&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;listStudentByTid&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getTeacherWithStudents&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;TeacherWithStudents&quot;</span>&gt;</span></span><br><span class="line">        select * from teacher where id = #&#123;tid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listStudentByTid&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">        select * from student where tid = #&#123;tid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="è¿è¡¨æŸ¥è¯¢æ–¹å¼-1"><a href="#è¿è¡¨æŸ¥è¯¢æ–¹å¼-1" class="headerlink" title="è¿è¡¨æŸ¥è¯¢æ–¹å¼"></a>è¿è¡¨æŸ¥è¯¢æ–¹å¼</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.tw.mybatis.dao.TeacherMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;TeacherWithStudents&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Teacher&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tname&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;students&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Student&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;tid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getTeacherWithStudents&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;TeacherWithStudents&quot;</span>&gt;</span></span><br><span class="line">        select t.id tid, t.name tname, s.id sid, s.name sname</span><br><span class="line">        from teacher t left join student s</span><br><span class="line">        on t.id = s.tid</span><br><span class="line">        where t.id = #&#123;tid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="åŠ¨æ€SQL"><a href="#åŠ¨æ€SQL" class="headerlink" title="åŠ¨æ€SQL"></a>åŠ¨æ€SQL</h2><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>åˆ›å»º<code>blog</code>è¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `blog` (</span><br><span class="line">  `id` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;åšå®¢id&#x27;</span>,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;åšå®¢æ ‡é¢˜&#x27;</span>,</span><br><span class="line">  `author` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;ä½œè€…&#x27;</span>,</span><br><span class="line">  `create_time` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  `views` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;æµè§ˆé‡&#x27;</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3;</span><br></pre></td></tr></table></figure><p>å®šä¹‰<code>Blog</code>å®ä½“ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Blog</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String author;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer views;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰<code>BlogMapper</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlogMapper</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»º<code>BlogMapper.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.tw.mybatis.dao.BlogMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨<code>mybatis-config.xml</code>æ·»åŠ æ˜ å°„</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mapper/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="if"><a href="#if" class="headerlink" title="if"></a><code>if</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlogMapper</span> &#123;</span><br><span class="line">List&lt;Blog&gt; <span class="title function_">listBlogs</span><span class="params">(Map&lt;String, Object&gt; params)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listBlogs&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.tw.mybatis.pojo.Blog&quot;</span>&gt;</span></span><br><span class="line">    select * from Blog</span><br><span class="line">    where  1 = 1</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;author != null&quot;</span>&gt;</span></span><br><span class="line">        and author like concat(&#x27;%&#x27;, #&#123;author&#125;, &#x27;%&#x27;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">        and title like concat(&#x27;%&#x27;, #&#123;title&#125;, &#x27;%&#x27;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;createTime != null&quot;</span>&gt;</span></span><br><span class="line">        and create_time &gt; #&#123;createTime&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;views != null&quot;</span>&gt;</span></span><br><span class="line">        and views &gt; #&#123;views&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testListBlogs</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> MyBatisUtil.getSqlSession()) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">BlogMapper</span> <span class="variable">blogMapper</span> <span class="operator">=</span> sqlSession.getMapper(BlogMapper.class);</span><br><span class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        params.put(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;learning&quot;</span>);</span><br><span class="line">        <span class="keyword">final</span> List&lt;Blog&gt; blogs = blogMapper.listBlogs(params);</span><br><span class="line">        blogs.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="where"><a href="#where" class="headerlink" title="where"></a><code>where</code></h3><p>å‰é¢çš„ä¾‹å­ä¸­ä¸ºäº†é¿å…æ‹¼æ¥å‡ºå¦‚ä¸‹é”™è¯¯sqlï¼Œæ‰‹åŠ¨åŠ äº†æ¡ä»¶<code>1 = 1</code>ï¼Œè¿™æ ·è™½ç„¶èƒ½è§£å†³é—®é¢˜ï¼Œä½†æ˜¾å¾—ä¸å¤Ÿä¼˜é›…ï¼Œä¸ºæ­¤MyBatisæä¾›äº†<code>&lt;where&gt;</code>æ ‡ç­¾ï¼Œå¯ä»¥æ›´å¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Blog</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Blog</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line"><span class="keyword">and</span> title <span class="keyword">like</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listBlogs&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.tw.mybatis.pojo.Blog&quot;</span>&gt;</span></span><br><span class="line">    select * from Blog</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;author != null&quot;</span>&gt;</span></span><br><span class="line">            and author like concat(&#x27;%&#x27;, #&#123;author&#125;, &#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">            and title like concat(&#x27;%&#x27;, #&#123;title&#125;, &#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;createTime != null&quot;</span>&gt;</span></span><br><span class="line">            and create_time &gt; #&#123;createTime&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;views != null&quot;</span>&gt;</span></span><br><span class="line">            and views &gt; #&#123;views&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="set"><a href="#set" class="headerlink" title="set"></a><code>set</code></h3><p>ä¸<code>where</code>æ ‡ç­¾ç±»ä¼¼ï¼Œ<code>set</code>æ ‡ç­¾å¯ä»¥å»é™¤å¯èƒ½å¤šä½™çš„å­—ç¬¦ï¼Œä¿è¯sqlæ‹¼æ¥æ­£ç¡®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlogMapper</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateBlog</span><span class="params">(Map&lt;String, Object&gt; params)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateBlog&quot;</span>&gt;</span></span><br><span class="line">    update Blog</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">            title = #&#123;title&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;author != null&quot;</span>&gt;</span></span><br><span class="line">            author = #&#123;author&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;createTime != null&quot;</span>&gt;</span></span><br><span class="line">            create_time = #&#123;createTime&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;views != null&quot;</span>&gt;</span></span><br><span class="line">            views = #&#123;views&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>choose-when-otherwise</code></p><p>æœ‰ç‚¹ç±»ä¼¼<code>switch</code>è¯­å¥ï¼Œä¼ å…¥å“ªä¸ªæ¡ä»¶å°±ç”¨å“ªä¸ªæ¡ä»¶æŸ¥è¯¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlogMapper</span> &#123;</span><br><span class="line">    List&lt;Blog&gt; <span class="title function_">listBlogsByChoose</span><span class="params">(Map&lt;String, Object&gt; params)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listBlogsByChoose&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.tw.mybatis.pojo.Blog&quot;</span>&gt;</span></span><br><span class="line">    select * from Blog</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span><br><span class="line">                and title like concat(&#x27;%&#x27;, #&#123;title&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;author != null&quot;</span>&gt;</span></span><br><span class="line">                and author like concat(&#x27;%&#x27;, #&#123;author&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">                and 1 = 1</span><br><span class="line">            <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a><code>foreach</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BlogMapper</span> &#123;</span><br><span class="line">List&lt;Blog&gt; <span class="title function_">listBlogsByForEach</span><span class="params">(<span class="meta">@Param(&quot;ids&quot;)</span> List&lt;String&gt; ids)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listBlogsByForEach&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.tw.mybatis.pojo.Blog&quot;</span>&gt;</span></span><br><span class="line">    select * from Blog</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">open</span>=<span class="string">&quot;id in (&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="sqlç‰‡æ®µ"><a href="#sqlç‰‡æ®µ" class="headerlink" title="sqlç‰‡æ®µ"></a>sqlç‰‡æ®µ</h3><h2 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h2><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> MyBatis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MyBatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NginxåŸºç¡€</title>
      <link href="/post/33a007fa.html"/>
      <url>/post/33a007fa.html</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…Nginx"><a href="#å®‰è£…Nginx" class="headerlink" title="å®‰è£…Nginx"></a>å®‰è£…Nginx</h2><ul><li>å®‰è£…</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install nginx</span><br></pre></td></tr></table></figure><ul><li>æ£€æŸ¥æ˜¯å¦è£…æˆåŠŸ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nginx -v</span><br><span class="line"><span class="comment"># nginx version: nginx/1.21.2</span></span><br></pre></td></tr></table></figure><ul><li>å®‰è£…æˆåŠŸåçš„ç›¸å…³ç›®å½•</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£…æ–‡ä»¶ç›®å½•</span><br><span class="line">/usr/local/Cellar/nginx/1.21.2</span><br><span class="line"># é…ç½®æ–‡ä»¶ç›®å½•</span><br><span class="line">/usr/local/etc/nginx</span><br><span class="line"># htmlç›®å½•</span><br><span class="line">/usr/local/var/www</span><br></pre></td></tr></table></figure><span id="more"></span><h2 id="NginxåŸºæœ¬å‘½ä»¤"><a href="#NginxåŸºæœ¬å‘½ä»¤" class="headerlink" title="NginxåŸºæœ¬å‘½ä»¤"></a>NginxåŸºæœ¬å‘½ä»¤</h2><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>brew list nginx</code></td><td>æŸ¥çœ‹nginxçš„å®‰è£…ä¿¡æ¯</td></tr><tr><td><code>nginx</code></td><td>å¯åŠ¨</td></tr><tr><td><code>nginx -s stop</code></td><td>åœæ­¢</td></tr><tr><td><code>nginx -s reload</code></td><td>é‡å¯</td></tr><tr><td><code>nginx -t</code></td><td>æŸ¥çœ‹é…ç½®æ–‡ä»¶ä½ç½®</td></tr></tbody></table><h2 id="åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡"><a href="#åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡" class="headerlink" title="åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡"></a>åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡</h2><p>åˆ›å»ºä¸€ä¸ªdemoé¡¹ç›®ï¼Œå¹¶æ‰“åŒ…ï¼Œé€šè¿‡<code>java -jar</code>æ–¹å¼å¯åŠ¨ä¸¤ä¸ªå®ä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java -jar demo-0.0.1-SNAPSHOT.jar --server.port=8080</span><br><span class="line"></span><br><span class="line">java -jar demo-0.0.1-SNAPSHOT.jar --server.port=8081</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹nginx.confï¼Œé…ç½®åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡</p><img src="/post/33a007fa/image-20240916203606556.png" class="" title="image-20240916203606556"><p>è®¿é—®æµ‹è¯•ï¼š<a href="http://localhost/hello%EF%BC%8C%E5%A4%9A%E6%AC%A1%E8%AE%BF%E9%97%AE%E8%BF%99%E4%B8%AA%E8%BF%9E%E6%8E%A5%EF%BC%8C%E8%AF%B7%E6%B1%82%E9%9A%8F%E6%9C%BA%E6%89%93%E5%88%B0%E4%B8%8D%E5%90%8C%E5%AE%9E%E4%BE%8B">http://localhost/helloï¼Œå¤šæ¬¡è®¿é—®è¿™ä¸ªè¿æ¥ï¼Œè¯·æ±‚éšæœºæ‰“åˆ°ä¸åŒå®ä¾‹</a></p><img src="/post/33a007fa/image-20240916203807897.png" class="" title="image-20240916203807897"><img src="/post/33a007fa/image-20240916203832170.png" class="" title="image-20240916203832170"><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DockeråŸºç¡€</title>
      <link href="/post/89826705.html"/>
      <url>/post/89826705.html</url>
      
        <content type="html"><![CDATA[<h2 id="Dockeræ¶æ„å›¾"><a href="#Dockeræ¶æ„å›¾" class="headerlink" title="Dockeræ¶æ„å›¾"></a>Dockeræ¶æ„å›¾</h2><img src="/post/89826705/Docker%E6%9E%B6%E6%9E%84%E5%9B%BE.png" class=""><span id="more"></span><h2 id="Dockerä¸è™šæ‹Ÿæœº"><a href="#Dockerä¸è™šæ‹Ÿæœº" class="headerlink" title="Dockerä¸è™šæ‹Ÿæœº"></a>Dockerä¸è™šæ‹Ÿæœº</h2><img src="/post/89826705/Docker%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%8A%BD%E8%B1%A1%E5%9B%BE.png" class=""><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><img src="/post/89826705/image-20241027223956215.png" class="" title="image-20241027223956215"><h3 id="é•œåƒå‘½ä»¤"><a href="#é•œåƒå‘½ä»¤" class="headerlink" title="é•œåƒå‘½ä»¤"></a>é•œåƒå‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>docker build</code></td><td>æ„å»ºé•œåƒ</td></tr><tr><td><code>docker images</code></td><td>æŸ¥çœ‹æœ¬åœ°é•œåƒ</td></tr><tr><td><code>docker images -q</code></td><td>åªæ˜¾ç¤ºé•œåƒID</td></tr><tr><td><code>docker search mysql</code></td><td>æŸ¥æ‰¾é•œåƒ</td></tr><tr><td><code>docker pull mysql</code></td><td>æ‹‰å–æœ€æ–°ç‰ˆæœ¬é•œåƒ</td></tr><tr><td><code>docker pull mysql:5.7</code></td><td>æ‹‰å–æŒ‡å®šç‰ˆæœ¬é•œåƒ</td></tr><tr><td><code>docker rmi é•œåƒå/é•œåƒID ...</code></td><td>åˆ é™¤é•œåƒ</td></tr><tr><td><code>docker rmi $(docker images -q)</code></td><td>æ‰¹é‡åˆ é™¤é•œåƒ</td></tr></tbody></table><h3 id="å®¹å™¨å‘½ä»¤"><a href="#å®¹å™¨å‘½ä»¤" class="headerlink" title="å®¹å™¨å‘½ä»¤"></a>å®¹å™¨å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>docker ps</code></td><td>æŸ¥çœ‹å®¹å™¨</td></tr><tr><td><code>docker ps -a</code></td><td>æŸ¥çœ‹æ‰€æœ‰å®¹å™¨</td></tr><tr><td><code>docker ps -a -n=1</code></td><td>æŸ¥çœ‹æœ€æ–°åˆ›å»ºçš„å®¹å™¨</td></tr><tr><td><code>docker run -d --name nginx -p 80:80 nginx</code></td><td>è¿è¡Œå®¹å™¨</td></tr><tr><td><code>docker stop</code></td><td>åœæ­¢å®¹å™¨</td></tr><tr><td><code>docker start</code></td><td>å¯åŠ¨å®¹å™¨</td></tr><tr><td><code>docker restart</code></td><td>é‡å¯å®¹å™¨</td></tr><tr><td><code>docker rm -f å®¹å™¨</code></td><td>åˆ é™¤å®¹å™¨</td></tr><tr><td><code>docker logs</code></td><td>æŸ¥çœ‹å®¹å™¨è¿è¡Œæ—¥å¿—</td></tr><tr><td><code>docker exec -it å®¹å™¨ /bin/bash</code></td><td>è¿›å…¥å®¹å™¨</td></tr><tr><td><code>docker inspect å®¹å™¨</code></td><td>æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</td></tr><tr><td><code>docker update --restart=always å®¹å™¨</code></td><td>è®¾ç½®å®¹å™¨å¼€æœºè‡ªå¯</td></tr><tr><td><code>docker ps --format &quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Image&#125;&#125;\t&#123;&#123;.Ports&#125;&#125;\t&#123;&#123;.Status&#125;&#125;\t&#123;&#123;.Names&#125;&#125;&quot;</code></td><td>æ ¼å¼åŒ–è¾“å‡º</td></tr><tr><td><code>docker save</code></td><td>ä¿å­˜é•œåƒ</td></tr><tr><td><code>docker load</code></td><td>åŠ è½½é•œåƒ</td></tr></tbody></table><p>psï¼šä¸Šé¢è¿™äº›å‘½ä»¤ä¸­çš„å®¹å™¨å³å¯ä»¥è¯—å®¹å™¨åä¹Ÿå¯ä»¥æ˜¯å®¹å™¨ID</p><h3 id="å…¶ä»–å‘½ä»¤"><a href="#å…¶ä»–å‘½ä»¤" class="headerlink" title="å…¶ä»–å‘½ä»¤"></a>å…¶ä»–å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>docker COMMAND --help</code></td><td>æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£</td></tr><tr><td><code>systemctl enable docker</code></td><td>è®¾ç½®dockerå¼€æœºè‡ªå¯åŠ¨</td></tr></tbody></table><h3 id="å‘½ä»¤åˆ«å"><a href="#å‘½ä»¤åˆ«å" class="headerlink" title="å‘½ä»¤åˆ«å"></a>å‘½ä»¤åˆ«å</h3><p>ä¿®æ”¹ <code>/root/.bashrc</code> æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .bashrc</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># User specific aliases and functions</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">rm</span>=<span class="string">&#x27;rm -i&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">cp</span>=<span class="string">&#x27;cp -i&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> <span class="built_in">mv</span>=<span class="string">&#x27;mv -i&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> psf=<span class="string">&#x27;ps --format &quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Image&#125;&#125;\t&#123;&#123;.Ports&#125;&#125;\t&#123;&#123;.Status&#125;&#125;\t&#123;&#123;.Names&#125;&#125;&quot;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Source global definitions</span></span><br><span class="line"><span class="keyword">if</span> [ -f /etc/bashrc ]; <span class="keyword">then</span></span><br><span class="line">        . /etc/bashrc</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤è®©åˆ«åç”Ÿæ•ˆï¼š<code>source /root/.bashrc</code></p><h2 id="æ•°æ®å·"><a href="#æ•°æ®å·" class="headerlink" title="æ•°æ®å·"></a>æ•°æ®å·</h2><p>æ•°æ®å·ï¼ˆVolumeï¼‰æ˜¯å®¹å™¨æŠ€æœ¯ï¼ˆå¦‚ Dockerï¼‰ä¸­ä¸€ç§ç”¨äº<strong>æŒä¹…åŒ–æ•°æ®</strong>å’Œ<strong>å…±äº«æ•°æ®</strong>çš„æœºåˆ¶ã€‚å®ƒå…è®¸å®¹å™¨ä¹‹é—´ã€æˆ–è€…å®¹å™¨å’Œå®¿ä¸»æœºä¹‹é—´å…±äº«æ•°æ®ï¼ŒåŒæ—¶å®ç°æ•°æ®çš„æŒä¹…å­˜å‚¨ï¼Œå³ä½¿å®¹å™¨è¢«åˆ é™¤ï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</p><img src="/post/89826705/image-20241028233002568.png" class="" title="image-20241028233002568"><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>docker volume create</code></td><td>åˆ›å»ºæ•°æ®å·</td></tr><tr><td><code>docker volume ls</code></td><td>æŸ¥çœ‹æ•°æ®å·</td></tr><tr><td><code>docker volume rm</code></td><td>åˆ é™¤æ•°æ®å·</td></tr><tr><td><code>docker volume prune</code></td><td>æ¸…é™¤æ•°æ®å·</td></tr><tr><td><code>docker volume inspect</code></td><td>æŸ¥çœ‹æ•°æ®å·è¯¦æƒ…</td></tr></tbody></table><p>æ•°æ®å·æŒ‚è½½ï¼šåœ¨åˆ›å»ºå®¹å™¨æ—¶ç”¨ <code>-v å·å:å®¹å™¨ç›®å½•</code> è¿›è¡ŒæŒ‚è½½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name nginx -p 80:80 -v html:/usr/share/nginx/html nginx</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ˜¯å¦æŒ‚è½½æˆåŠŸï¼š</p><img src="/post/89826705/image-20241029000212988.png" class="" title="image-20241029000212988"><p>æŸ¥çœ‹å…·ä½“çš„æŒ‚è½½è·¯å¾„ï¼š</p><img src="/post/89826705/image-20241028234315885.png" class="" title="image-20241028234315885"><p>è¿™æ ·å°±å®Œæˆäº†å®¿ä¸»æœºç›®å½• <code>/var/lib/docker/volumes/html/_data</code> å’Œå®¹å™¨ç›®å½• <code>/usr/share/nginx/html</code> çš„åŒå‘æ˜ å°„ã€‚</p><p>PSï¼šå¦‚æœåˆ›å»ºå®¹å™¨æ—¶æœªé€šè¿‡ <code>-v html:/usr/share/nginx/html</code> é€‰é¡¹æŒ‚è½½ï¼Œè™šæ‹Ÿæœºä¼šåˆ›å»ºä¸€ä¸ªåŒ¿åå·ï¼Œå¹¶å°† <code>/usr/share/nginx/html</code> æŒ‚è½½åˆ°è¿™ä¸ªåŒ¿åå·ä¸Šï¼ŒåŒ¿åå·çš„åç§°æ˜¯ä¸€ä¸²éšæœºå­—ç¬¦ä¸²ï¼Œå…·ä½“çš„æŒ‚è½½è·¯å¾„å°±æ˜¯ <code>/var/lib/docker/volumes/xxx/_data</code>ã€‚</p><p>é€šè¿‡æ•°æ®å·è¿›è¡ŒæŒ‚è½½ï¼Œå®¿ä¸»æœºä¸­çš„æŒ‚è½½ç›®å½•é»˜è®¤æ˜¯ï¼š<code>/var/lib/docker/volumes/å·å/_data</code>ï¼ŒæŒ‚è½½è·¯å¾„æœ‰ç‚¹å¤ªæ·±ï¼Œæ‰€ä»¥ docker ä¹Ÿæ”¯æŒç›´æ¥æŒ‡å®šå®¿ä¸»æœºç›®å½•è¿›è¡ŒæŒ‚è½½ï¼Œå¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">--name mysql \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-e TZ=Asia/Shanghai \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">-v /root/mysql/data:/var/lib/mysql \</span><br><span class="line">-v /root/mysql/init:/docker-entrypoint-initdb.d \</span><br><span class="line">-v /root/mysql/conf:/etc/mysql/conf.d \</span><br><span class="line">mysql</span><br></pre></td></tr></table></figure><p>psï¼šæœ¬åœ°ç›®å½•æˆ–æ–‡ä»¶å¿…é¡»ä»¥ <code>/</code> æˆ– <code>./</code>å¼€å¤´ï¼Œå¦‚æœç›´æ¥ä»¥åå­—å¼€å¤´ï¼Œä¼šè¢«è¯†åˆ«ä¸ºæ•°æ®å·åã€‚</p><h2 id="é•œåƒ"><a href="#é•œåƒ" class="headerlink" title="é•œåƒ"></a>é•œåƒ</h2><h3 id="é•œåƒç»“æ„"><a href="#é•œåƒç»“æ„" class="headerlink" title="é•œåƒç»“æ„"></a>é•œåƒç»“æ„</h3><p>è”åˆæ–‡ä»¶ç³»ç»Ÿ</p><p>é•œåƒåˆ†å±‚</p><h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a><code>Dockerfile</code></h3><p><code>Dockerfile</code> å°±æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ŒåŒ…å«ä¸€ç³»åˆ—æŒ‡ä»¤ï¼Œç”¨æ¥è¯´æ˜å¦‚ä½•æ„å»ºé•œåƒã€‚å¸¸è§æŒ‡ä»¤å¦‚ä¸‹ï¼š</p><table><thead><tr><th>æŒ‡ä»¤</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>FROM</code></td><td>æŒ‡å®šåŸºç¡€é•œåƒ</td><td><code>FROM centos:7</code></td></tr><tr><td><code>ENV</code></td><td>é…ç½®ç¯å¢ƒå˜é‡ï¼Œç”¨äºåç»­æŒ‡ä»¤</td><td><code>ENV key=value</code></td></tr><tr><td><code>COPY</code></td><td>æ‹·è´æœ¬åœ°æ–‡ä»¶åˆ°é•œåƒçš„æŒ‡å®šç›®å½•</td><td><code>COPY ./jre11.tar.gz /tmp</code></td></tr><tr><td><code>RUN</code></td><td>æ‰§è¡ŒLinuxçš„shellå‘½ä»¤</td><td><code>RUN tar -zxvf /tmp/jre11.tar.gz &amp;&amp; EXPORTS path=/tmp/jre11:$path</code></td></tr><tr><td><code>EXPOSE</code></td><td>æŒ‡å®šå®¹å™¨è¿è¡Œæ—¶ç›‘å¬çš„ç«¯å£</td><td><code>EXPOSE 8080</code></td></tr><tr><td><code>ENTRYPOINT</code></td><td>é•œåƒä¸­åº”ç”¨çš„å¯åŠ¨å‘½ä»¤ï¼Œå®¹å™¨è¿è¡Œæ—¶è°ƒç”¨</td><td><code>ENTRYPOINT java -jar xxx.jar</code></td></tr><tr><td><code>VOLUME</code></td><td>åˆ›å»ºä¸€ä¸ªæ•°æ®å·æŒ‚è½½ç‚¹</td><td></td></tr><tr><td><code>WORKDIR</code></td><td>é…ç½®å·¥ä½œç›®å½•</td><td></td></tr></tbody></table><p><code>Dockerfile</code> ç¤ºä¾‹ï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šåŸºç¡€é•œåƒ</span></span><br><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ç¯å¢ƒå˜é‡ï¼šjdkå®‰è£…ç›®å½•</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_DIR=/usr/local</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹·è´æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./jdk8.tar.gz <span class="variable">$JAVA_DIR</span>/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./docker-demo.jar /app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…jdk</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">cd</span> <span class="variable">$JAVA_DIR</span> &amp;&amp; tar -xf ./jdk8.tar.gz &amp;&amp; <span class="built_in">mv</span> ./jdk1.8.0_144 ./jdk8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME=$JAVA_DIR/jdk8</span><br><span class="line"><span class="keyword">ENV</span> PATH=$PATH:$JAVA_HOME/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¥å£ï¼Œjavaé¡¹ç›®çš„å¯åŠ¨å‘½ä»¤</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;/app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ª <code>Dockerfile</code> ç­‰åŒäºï¼š</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸºç¡€é•œåƒ</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">11.0</span>-jre-buster</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹·è´æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./docker-demo.jar /app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¥å£</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;/app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>æ„å»ºé•œåƒ</p><p>æœ‰äº† <code>Dockerfile</code> ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æ„å»ºé•œåƒäº†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># . è¡¨ç¤ºDockerfileæ‰€åœ¨ç›®å½•</span></span><br><span class="line">docker build -t é•œåƒåç§° .</span><br></pre></td></tr></table></figure><p>PSï¼šå¦‚æœæ„å»ºé•œåƒæ‰€ç”¨æ–‡ä»¶åç§°ä¸æ˜¯ <code>Dockerfile</code>ï¼Œéœ€é€šè¿‡ <code>-f dockerfileName</code> é€‰é¡¹æŒ‡å®šæ„å»ºé•œåƒæ‰€ç”¨æ–‡ä»¶</p><h2 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h2><p>åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œç½‘ç»œé…ç½®æ–‡ä»¶ç›®å½•æ˜¯<code>/etc/sysconfig/network-scripts</code>ã€‚è™šæ‹Ÿæœºå’Œä¸»æœºå®¿ä¸»æœºçš„ç½‘ç»œè¿æ¥æ–¹å¼ä¸»è¦åˆ†ä¸ºå¦‚ä¸‹ä¸‰ç§ï¼š</p><ul><li>æ¡¥æ¥æ¨¡å¼ (Bridged)</li></ul><blockquote><p>æ¡¥æ¥æ¨¡å¼ä¸‹ï¼Œè™šæ‹Ÿæœºä¸å®¿ä¸»æœºä½äºåŒä¸€ä¸ªç‰©ç†ç½‘ç»œä¸­ã€‚è™šæ‹Ÿæœºé€šè¿‡å®¿ä¸»æœºçš„ç‰©ç†ç½‘å¡ç›´æ¥è¿æ¥åˆ°ç½‘ç»œï¼Œå¹¶è·å¾—ä¸å®¿ä¸»æœºç›¸åŒç½‘æ®µçš„IPåœ°å€ã€‚è¿™ä½¿å¾—è™šæ‹Ÿæœºä¸å…¶ä»–ç½‘ç»œè®¾å¤‡å¯ä»¥ç›´æ¥è¿›è¡Œé€šä¿¡ï¼Œç±»ä¼¼äºå®ƒè‡ªå·±æ˜¯ä¸€å°ç‰©ç†æœºã€‚</p><p>å¸¸ç”¨äºéœ€è¦è™šæ‹Ÿæœºåƒç‰©ç†æœºä¸€æ ·ç›´æ¥è®¿é—®å¤–éƒ¨ç½‘ç»œçš„æƒ…å†µï¼Œå¦‚æ–‡ä»¶æœåŠ¡å™¨ã€WebæœåŠ¡å™¨ç­‰ã€‚</p></blockquote><ul><li>ç½‘ç»œåœ°å€è½¬æ¢ (NAT)</li></ul><blockquote><p>NATæ¨¡å¼ä¸‹ï¼Œè™šæ‹Ÿæœºé€šè¿‡å®¿ä¸»æœºçš„ç½‘ç»œè¿æ¥è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚å®¿ä¸»æœºä¸ºè™šæ‹Ÿæœºæä¾›ä¸€ä¸ªè™šæ‹Ÿç½‘å¡ï¼Œå¹¶å°†è™šæ‹Ÿæœºçš„ç½‘ç»œè¯·æ±‚è½¬æ¢ä¸ºå®¿ä¸»æœºçš„ç½‘ç»œè¯·æ±‚ã€‚è¿™ç§æ–¹å¼ç±»ä¼¼äºè·¯ç”±å™¨å·¥ä½œåŸç†ï¼Œè™šæ‹Ÿæœºè‡ªå·±ä¸èƒ½è¢«å¤–éƒ¨ç½‘ç»œç›´æ¥è®¿é—®ï¼Œä½†å¯ä»¥è®¿é—®å¤–éƒ¨èµ„æºã€‚</p><p>å¸¸ç”¨äºéœ€è¦è™šæ‹Ÿæœºè®¿é—®å¤–éƒ¨ç½‘ç»œä½†æ— éœ€è¢«å¤–éƒ¨è®¾å¤‡è®¿é—®çš„åœºæ™¯ï¼Œæ¯”å¦‚å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒã€‚</p></blockquote><ul><li>ä»…ä¸»æœºæ¨¡å¼ (Host-only)</li></ul><blockquote><p>ä»…ä¸»æœºæ¨¡å¼ä¸‹ï¼Œè™šæ‹Ÿæœºåªèƒ½ä¸å®¿ä¸»æœºè¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œæ— æ³•è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚è¿™ç§æ¨¡å¼åˆ›å»ºäº†ä¸€ä¸ªè™šæ‹Ÿçš„ç½‘ç»œç¯å¢ƒï¼Œè™šæ‹Ÿæœºåªèƒ½å’Œå®¿ä¸»æœºæˆ–å…¶ä»–é…ç½®ä¸ºHost-onlyæ¨¡å¼çš„è™šæ‹Ÿæœºé€šä¿¡ã€‚</p><p>é€‚ç”¨äºéœ€è¦å®Œå…¨å°é—­çš„ç½‘ç»œç¯å¢ƒï¼Œå¦‚å±€åŸŸç½‘æµ‹è¯•æˆ–è°ƒè¯•ç­‰ã€‚</p></blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å®¹å™¨éƒ½æ˜¯ä»¥ <code>bridge</code> æ–¹å¼è¿æ¥åˆ° Docker çš„ä¸€ä¸ªè™šæ‹Ÿç½‘æ¡¥ä¸Šï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src="/post/89826705/image-20241030004706881.png" class="" title="image-20241030004706881"><p>é€šè¿‡é»˜è®¤ç½‘æ¡¥è¿æ¥çš„å®¹å™¨ä¹‹é—´åªèƒ½é€šè¿‡ipäº’ç›¸è®¿é—®ï¼Œä½†æ˜¯å¦‚æœå®¹å™¨é‡å¯ï¼Œipåœ°å€å˜äº†ï¼Œç›¸å…³çš„ipé…ç½®æœªåŒæ­¥ä¿®æ”¹ï¼Œå°±ä¼šå¯¼è‡´å®¹å™¨ä¹‹é—´ä¸é€šã€‚è§£å†³åŠæ³•æ˜¯åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œï¼Œå¹¶å°†éœ€è¦äº’ç›¸è®¿é—®çš„å®¹å™¨åŠ å…¥è¯¥ç½‘ç»œï¼Œè¿™æ ·å®¹å™¨ä¹‹é—´å°±å¯ä»¥é€šè¿‡å®¹å™¨åäº’ç›¸è®¿é—®ï¼Œä¸ä¼šå—ipåœ°å€å˜åŒ–çš„å½±å“ã€‚</p><p>Dockerå¸¸ç”¨ç½‘ç»œå‘½ä»¤ï¼š</p><table><thead><tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>docker network ls</code></td><td>æŸ¥çœ‹æ‰€æœ‰ç½‘ç»œ</td></tr><tr><td><code>docker network create</code></td><td>åˆ›å»ºç½‘ç»œ</td></tr><tr><td><code>docker network rm</code></td><td>åˆ é™¤æŒ‡å®šç½‘ç»œ</td></tr><tr><td><code>docker network prune</code></td><td>æ¸…é™¤æœªä½¿ç”¨ç½‘ç»œ</td></tr><tr><td><code>docker network connect</code></td><td>ä½¿æŒ‡å®šå®¹å™¨åŠ å…¥ç½‘ç»œ</td></tr><tr><td><code>docker network disconnect</code></td><td>ä½¿æŒ‡å®šå®¹å™¨ç¦»å¼€ç½‘ç»œ</td></tr><tr><td><code>docker network inspect</code></td><td>æŸ¥çœ‹ç½‘ç»œè¯¦ç»†ä¿¡æ¯</td></tr></tbody></table><p>PSï¼šå®¹å™¨å¯ä»¥å…ˆå¯åŠ¨å†é€šè¿‡å‘½ä»¤ <code>docker network connect</code> åŠ å…¥æŒ‡å®šç½‘ç»œï¼Œä¹Ÿå¯ä»¥åœ¨å¯åŠ¨å®¹å™¨æ—¶é€šè¿‡é€‰é¡¹ <code>--network ç½‘ç»œå</code> ç›´æ¥åŠ å…¥æŒ‡å®šç½‘ç»œã€‚ä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼šæ–¹å¼ä¸€ä¼šåŒæ—¶åŠ å…¥é»˜è®¤ç½‘ç»œdocker0å’ŒæŒ‡å®šç½‘ç»œï¼Œæ–¹å¼äºŒåªä¼šåŠ å…¥æŒ‡å®šç½‘ç»œã€‚</p><h2 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h2><h3 id="åˆ¶ä½œTomcaté•œåƒ"><a href="#åˆ¶ä½œTomcaté•œåƒ" class="headerlink" title="åˆ¶ä½œTomcaté•œåƒ"></a>åˆ¶ä½œ<code>Tomcat</code>é•œåƒ</h3><ul><li>ç¼–å†™ <code>Dockerfile</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">MAINTAINER timewait7&lt;1029776125@qq.com&gt;</span><br><span class="line"></span><br><span class="line">ADD jdk-8u202-linux-x64.tar.gz /usr/local</span><br><span class="line">ADD apache-tomcat-9.0.94.tar.gz /usr/local</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_202</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt/jar $JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.94</span><br><span class="line">ENV CATALINA_BASE /usr/local/apache-tomcat-9.0.94</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">CMD /usr/local/apache-tomcat-9.0.94/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9.0.94/bin/logs/catalina.out</span><br></pre></td></tr></table></figure><ul><li>æ„å»ºé•œåƒ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»¥Dockerfileä½œä¸ºæ–‡ä»¶åï¼Œæ„å»ºæ—¶ä¸éœ€è¦é€šè¿‡ -f å‚æ•°æŒ‡å®šæ–‡ä»¶</span></span><br><span class="line">docker build -t diytomcat .</span><br></pre></td></tr></table></figure><img src="/post/89826705/%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%E8%BF%87%E7%A8%8B.png" class=""><ul><li>å¯åŠ¨é•œåƒ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8080:8080 --name diytomcat -v /home/mount/tomcat/test:/usr/local/apache-tomcat-9.0.94/webapps/test -v /home/mount/tomcat/logs:/usr/local/apache-tomcat-9.0.94/logs diytomcat</span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•tomcat</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹æ­¥éª¤</span></span><br><span class="line"><span class="built_in">cd</span> /home/mount/tomcat/test</span><br><span class="line"><span class="built_in">mkdir</span> WEB-INF</span><br><span class="line"><span class="built_in">cd</span> WEB-INF</span><br><span class="line">vi web.xml</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">vi index.jsp</span><br></pre></td></tr></table></figure><p><code>web.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">version</span>=<span class="string">&quot;2.4&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2ee&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2ee</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>index.jsp</code></p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Hello World JSP&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Hello, World!&lt;/h1&gt;</span><br><span class="line">&lt;% System.out.println(<span class="string">&quot;----------logs----------&quot;</span>); %&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><img src="/post/89826705/image-20240915230103023.png" class="" title="image-20240915230103023"><img src="/post/89826705/image-20240915230216263.png" class="" title="image-20240915230216263"><h3 id="éƒ¨ç½²å‰åç«¯é¡¹ç›®"><a href="#éƒ¨ç½²å‰åç«¯é¡¹ç›®" class="headerlink" title="éƒ¨ç½²å‰åç«¯é¡¹ç›®"></a>éƒ¨ç½²å‰åç«¯é¡¹ç›®</h3><h4 id="åˆ›å»ºç½‘ç»œ"><a href="#åˆ›å»ºç½‘ç»œ" class="headerlink" title="åˆ›å»ºç½‘ç»œ"></a>åˆ›å»ºç½‘ç»œ</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªåä¸ºtestçš„ç½‘ç»œ</span></span><br><span class="line">docker network create <span class="built_in">test</span></span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºæ•°æ®åº“å®¹å™¨"><a href="#åˆ›å»ºæ•°æ®åº“å®¹å™¨" class="headerlink" title="åˆ›å»ºæ•°æ®åº“å®¹å™¨"></a>åˆ›å»ºæ•°æ®åº“å®¹å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">--name mysql \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-e TZ=Asia/Shanghai \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">-v /root/mysql/data:/var/lib/mysql \</span><br><span class="line">-v /root/mysql/init:/docker-entrypoint-initdb.d \</span><br><span class="line">-v /root/mysql/conf:/etc/mysql/conf.d \</span><br><span class="line">--network <span class="built_in">test</span> \</span><br><span class="line">mysql</span><br></pre></td></tr></table></figure><h4 id="éƒ¨ç½²åç«¯åº”ç”¨"><a href="#éƒ¨ç½²åç«¯åº”ç”¨" class="headerlink" title="éƒ¨ç½²åç«¯åº”ç”¨"></a>éƒ¨ç½²åç«¯åº”ç”¨</h4><ol><li><p>å‡†å¤‡ jar åŒ…å’Œ <code>Dockerfile</code> æ–‡ä»¶ï¼Œå‡è®¾æ”¾åœ¨è™šæ‹Ÿæœºçš„ &#x2F;root ç›®å½•ä¸‹</p></li><li><p>æ„å»ºé•œåƒ</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line">docker built -t appname .</span><br></pre></td></tr></table></figure><ol start="3"><li>åˆ›å»ºå®¹å™¨å¹¶è¿è¡Œ</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿è¡Œå®¹å™¨å¹¶è¿æ¥ç½‘ç»œtest</span></span><br><span class="line">docker run -d --name imagename -p 8080:8080 --network <span class="built_in">test</span> appname</span><br></pre></td></tr></table></figure><h4 id="éƒ¨ç½²å‰ç«¯åº”ç”¨"><a href="#éƒ¨ç½²å‰ç«¯åº”ç”¨" class="headerlink" title="éƒ¨ç½²å‰ç«¯åº”ç”¨"></a>éƒ¨ç½²å‰ç«¯åº”ç”¨</h4><ol><li>å°†å‰ç«¯é¡¹ç›®å’Œ nginx é…ç½®æ–‡ä»¶æ”¾åœ¨ &#x2F;root&#x2F;nginx ç›®å½•ä¸‹</li><li>åˆ›å»ºå®¹å™¨å¹¶è¿è¡Œ</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">--name nginx \</span><br><span class="line">-p 18080:18080 \</span><br><span class="line">-p 18081:18081 \</span><br><span class="line">-v /root/nginx/html:/usr/share/nginx/html \</span><br><span class="line">-v /root/nginx/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">--network <span class="built_in">test</span> \</span><br><span class="line">nginx</span><br></pre></td></tr></table></figure><h3 id="éƒ¨ç½²Redisé›†ç¾¤"><a href="#éƒ¨ç½²Redisé›†ç¾¤" class="headerlink" title="éƒ¨ç½²Redisé›†ç¾¤"></a>éƒ¨ç½²Redisé›†ç¾¤</h3><h4 id="æ–¹å¼ä¸€"><a href="#æ–¹å¼ä¸€" class="headerlink" title="æ–¹å¼ä¸€"></a>æ–¹å¼ä¸€</h4><ul><li>åˆ›å»ºredisç½‘ç»œ</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create --driver bridge --subnet 172.38.0.0/16 --gateway 172.38.0.1 redis-net</span><br></pre></td></tr></table></figure><ul><li>é›†ç¾¤é…ç½®æ–‡ä»¶è„šæœ¬</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">for port in $(seq 1 6); \</span><br><span class="line">do \</span><br><span class="line">mkdir -p /mydata/redis/node-$&#123;port&#125;/conf</span><br><span class="line">touch /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">cat &lt;&lt; EOF &gt; /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">port 6379</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly yes</span><br><span class="line">EOF</span><br><span class="line">done</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨å®¹å™¨ï¼Œåˆ›å»ºé›†ç¾¤èŠ‚ç‚¹</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># node-01</span></span><br><span class="line">docker run -d -p 6371:6379 -p 16371:16379 --name redis-01 \</span><br><span class="line">-v /mydata/redis/node-1/data:/data \</span><br><span class="line">-v /mydata/redis/node-1/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">--net redis-net --ip 172.38.0.11 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># node-02</span></span><br><span class="line">docker run -d -p 6372:6379 -p 16372:16379 --name redis-02 \</span><br><span class="line">-v /mydata/redis/node-2/data:/data \</span><br><span class="line">-v /mydata/redis/node-2/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">--net redis-net --ip 172.38.0.12 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¶ä»–èŠ‚ç‚¹ç±»æ¨</span></span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºé›†ç¾¤</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</span><br></pre></td></tr></table></figure><img src="/post/89826705/image-20240916133527083.png" class="" title="image-20240916133527083"><ul><li>ä»¥é›†ç¾¤æ–¹å¼åˆ›å»ºrediså®¢æˆ·ç«¯</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cluster info</span><br></pre></td></tr></table></figure><img src="/post/89826705/image-20240916133836873.png" class="" title="image-20240916133836873"><ul><li>æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cluster nodes</span><br></pre></td></tr></table></figure><img src="/post/89826705/image-20240916133936635.png" class="" title="image-20240916133936635"><ul><li>æµ‹è¯•é›†ç¾¤é«˜å¯ç”¨</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®ä¸€ä¸ªé”®å€¼å¯¹</span></span><br><span class="line"><span class="built_in">set</span> hello world</span><br></pre></td></tr></table></figure><img src="/post/89826705/image-20240916134512178.png" class="" title="image-20240916134512178"><p>åœæ‰redis-01èŠ‚ç‚¹ï¼Œredis-05è‡ªåŠ¨å‡çº§ä¸ºmaster</p><img src="/post/89826705/image-20240916134700142.png" class="" title="image-20240916134700142"><p>æ­¤æ—¶ä¾ç„¶å¯ä»¥<code>get hello</code>ä¾ç„¶å¯ä»¥æˆåŠŸè¿”å›å€¼</p><img src="/post/89826705/image-20240916135154195.png" class="" title="image-20240916135154195"><h4 id="æ–¹å¼äºŒ"><a href="#æ–¹å¼äºŒ" class="headerlink" title="æ–¹å¼äºŒ"></a>æ–¹å¼äºŒ</h4><ul><li>ç¼–å†™<code>docker-compose.yaml</code>æ–‡ä»¶</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">r1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r1</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7001&quot;</span>]</span><br><span class="line">  <span class="attr">r2:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r2</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7002&quot;</span>]</span><br><span class="line">  <span class="attr">r3:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r3</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">entrypoint:</span> [<span class="string">&quot;redis-server&quot;</span>, <span class="string">&quot;--port&quot;</span>, <span class="string">&quot;7003&quot;</span>]</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨å®¹å™¨</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker compose up -d</span><br></pre></td></tr></table></figure><ul><li>é…ç½®ä¸»ä»å…³ç³»</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it r2 redis-cli -p 7002</span><br><span class="line">$ slaveof è™šæ‹Ÿæœºip 7001</span><br><span class="line"></span><br><span class="line">$ docker <span class="built_in">exec</span> -it r2 redis-cli -p 7003</span><br><span class="line">$ slaveof è™šæ‹Ÿæœºip 7001</span><br></pre></td></tr></table></figure><ul><li>æµ‹è¯•</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">exec</span> -it r1 redis-cli -p 7001</span><br><span class="line">$ info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:2</span><br><span class="line">slave0:ip=192.168.33.11,port=7002,state=online,offset=2165,lag=1</span><br><span class="line">slave1:ip=192.168.33.11,port=7003,state=online,offset=2165,lag=1</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:f7b8c1f916ecc6e3ab6fcba7d73c1f115a880cb6</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:2165</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:2165</span><br><span class="line">$ <span class="built_in">set</span> num 123</span><br><span class="line">$ get num</span><br><span class="line"><span class="string">&quot;123&quot;</span></span><br><span class="line"></span><br><span class="line">$ docker <span class="built_in">exec</span> -it r2 redis-cli -p 7002</span><br><span class="line">$ info replication</span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:192.168.33.11</span><br><span class="line">master_port:7001</span><br><span class="line">master_link_status:up</span><br><span class="line">master_last_io_seconds_ago:6</span><br><span class="line">master_sync_in_progress:0</span><br><span class="line">slave_read_repl_offset:2249</span><br><span class="line">slave_repl_offset:2249</span><br><span class="line">slave_priority:100</span><br><span class="line">slave_read_only:1</span><br><span class="line">replica_announced:1</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:f7b8c1f916ecc6e3ab6fcba7d73c1f115a880cb6</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:2249</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:15</span><br><span class="line">repl_backlog_histlen:2235</span><br><span class="line">$ <span class="built_in">set</span> num 456</span><br><span class="line">(error) READONLY You can<span class="string">&#x27;t write against a read only replica.</span></span><br><span class="line"><span class="string">$ get num</span></span><br><span class="line"><span class="string">&quot;123&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ docker exec -it r3 redis-cli -p 7003</span></span><br><span class="line"><span class="string"># Replication</span></span><br><span class="line"><span class="string">role:slave</span></span><br><span class="line"><span class="string">master_host:192.168.33.11</span></span><br><span class="line"><span class="string">master_port:7001</span></span><br><span class="line"><span class="string">master_link_status:up</span></span><br><span class="line"><span class="string">master_last_io_seconds_ago:1</span></span><br><span class="line"><span class="string">master_sync_in_progress:0</span></span><br><span class="line"><span class="string">slave_read_repl_offset:2417</span></span><br><span class="line"><span class="string">slave_repl_offset:2417</span></span><br><span class="line"><span class="string">slave_priority:100</span></span><br><span class="line"><span class="string">slave_read_only:1</span></span><br><span class="line"><span class="string">replica_announced:1</span></span><br><span class="line"><span class="string">connected_slaves:0</span></span><br><span class="line"><span class="string">master_failover_state:no-failover</span></span><br><span class="line"><span class="string">master_replid:f7b8c1f916ecc6e3ab6fcba7d73c1f115a880cb6</span></span><br><span class="line"><span class="string">master_replid2:0000000000000000000000000000000000000000</span></span><br><span class="line"><span class="string">master_repl_offset:2417</span></span><br><span class="line"><span class="string">second_repl_offset:-1</span></span><br><span class="line"><span class="string">repl_backlog_active:1</span></span><br><span class="line"><span class="string">repl_backlog_size:1048576</span></span><br><span class="line"><span class="string">repl_backlog_first_byte_offset:113</span></span><br><span class="line"><span class="string">repl_backlog_histlen:2305</span></span><br><span class="line"><span class="string">$ set num 789</span></span><br><span class="line"><span class="string">(error) READONLY You can&#x27;</span>t write against a <span class="built_in">read</span> only replica.</span><br><span class="line">$ get num</span><br><span class="line"><span class="string">&quot;123&quot;</span></span><br></pre></td></tr></table></figure><h2 id="é•œåƒå®‰è£…"><a href="#é•œåƒå®‰è£…" class="headerlink" title="é•œåƒå®‰è£…"></a>é•œåƒå®‰è£…</h2><h3 id="nacos"><a href="#nacos" class="headerlink" title="nacos"></a>nacos</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ‹‰é•œåƒ</span></span><br><span class="line">docker pull nacos/nacos-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨å®¹å™¨ï¼Œä½¿ç”¨å†…åµŒå­˜å‚¨</span></span><br><span class="line">docker run -d --name nacos -e MODE=standalone -p 8848:8848 -p 9848:9848 -p 9849:9849 nacos/nacos-server:v2.4.3-slim</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨å¤–éƒ¨å­˜å‚¨</span></span><br><span class="line">docker run -d \</span><br><span class="line">--name nacos \</span><br><span class="line">--env-file ./nacos/custom.env \</span><br><span class="line">-p 8848:8848 \</span><br><span class="line">-p 9848:9848 \</span><br><span class="line">-p 9849:9849 \</span><br><span class="line">nacos/nacos-server:v2.4.3-slim</span><br></pre></td></tr></table></figure><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># custom.env</span></span><br><span class="line"><span class="attr">PREFER_HOST_MODE</span>=<span class="string">hostname</span></span><br><span class="line"><span class="attr">MODE</span>=<span class="string">standalone</span></span><br><span class="line"><span class="attr">SPRING_DATASOURCE_PLATFORM</span>=<span class="string">mysql</span></span><br><span class="line"><span class="attr">MYSQL_SERVICE_HOST</span>=<span class="string">192.168.33.11</span></span><br><span class="line"><span class="attr">MYSQL_SERVICE_DB_NAME</span>=<span class="string">nacos</span></span><br><span class="line"><span class="attr">MYSQL_SERVICE_PORT</span>=<span class="string">3306</span></span><br><span class="line"><span class="attr">MYSQL_SERVICE_USER</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">MYSQL_SERVICE_PASSWORD</span>=<span class="string">123456</span></span><br><span class="line"><span class="attr">MYSQL_SERVICE_DB_PARAM</span>=<span class="string">characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useSSL=false&amp;allowPublicKeyRetrieval=true&amp;serverTimezone=Asia/Shanghai</span></span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vagrantä½¿ç”¨å…¥é—¨</title>
      <link href="/post/f8d4142b.html"/>
      <url>/post/f8d4142b.html</url>
      
        <content type="html"><![CDATA[<h2 id="åˆ›å»ºè™šæ‹Ÿæœº"><a href="#åˆ›å»ºè™šæ‹Ÿæœº" class="headerlink" title="åˆ›å»ºè™šæ‹Ÿæœº"></a>åˆ›å»ºè™šæ‹Ÿæœº</h2><ul><li>å®‰è£…Vagrant</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew tap hashicorp/tap</span><br><span class="line">brew install hashicorp/tap/hashicorp-vagrant</span><br></pre></td></tr></table></figure><ul><li>åˆå§‹åŒ–è™šæ‹Ÿæœº</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»…åˆ›å»ºä¸€ä¸ªVagrantfile</span></span><br><span class="line"><span class="built_in">mkdir</span> vm</span><br><span class="line"><span class="built_in">cd</span> vm</span><br><span class="line">vagrant init centos/7</span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨è™šæ‹Ÿæœº</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™ä¸€æ­¥æ‰æ˜¯æ‹‰å–å¹¶å¯åŠ¨é•œåƒ</span></span><br><span class="line">vagrant up</span><br></pre></td></tr></table></figure><ul><li>è¿æ¥è™šæ‹Ÿæœº</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant ssh</span><br></pre></td></tr></table></figure><h2 id="å®‰è£…docker"><a href="#å®‰è£…docker" class="headerlink" title="å®‰è£…docker"></a>å®‰è£…docker</h2><ul><li>å¸è½½æ—§ç‰ˆdocker</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure><ul><li>å®‰è£…yum-utilså¹¶è®¾ç½®dockerä»“åº“</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br><span class="line">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><ul><li><p>å®‰è£…docker</p><ul><li><p>å®‰è£…æœ€æ–°ç‰ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£…æŒ‡å®šç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹dockerç‰ˆæœ¬</span></span><br><span class="line">yum list docker-ce --showduplicates | <span class="built_in">sort</span> -r</span><br><span class="line"></span><br><span class="line">docker-ce.x86_64    3:27.1.1-1.el9    docker-ce-stable</span><br><span class="line">docker-ce.x86_64    3:27.1.0-1.el9    docker-ce-stable</span><br><span class="line">&lt;...&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…æŒ‡å®šç‰ˆæœ¬</span></span><br><span class="line">sudo yum install docker-ce-&lt;VERSION_STRING&gt; docker-ce-cli-&lt;VERSION_STRING&gt; containerd.io docker-buildx-plugin docker-compose-plugin</span><br></pre></td></tr></table></figure></li></ul></li><li><p>å¯åŠ¨docker</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¼€æœºé»˜è®¤å¯åŠ¨</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å®¹å™¨è‡ªåŠ¨å¯åŠ¨</span></span><br><span class="line">docker run -d --restart=always --name å®¹å™¨åç§° é•œåƒ</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹å®¹å™¨è‡ªåŠ¨å¯åŠ¨</span></span><br><span class="line">docker update --restart=always å®¹å™¨ID</span><br></pre></td></tr></table></figure><h2 id="ç«¯å£è½¬å‘"><a href="#ç«¯å£è½¬å‘" class="headerlink" title="ç«¯å£è½¬å‘"></a>ç«¯å£è½¬å‘</h2><p>å‡è®¾åœ¨è™šæ‹Ÿæœºä¸­å¯åŠ¨äº†ä¸€ä¸ªtomcaté•œåƒï¼Œè¦æƒ³åœ¨å®¿ä¸»æœºä¸­çš„è®¿é—®è¯¥tomcatï¼Œéœ€é…ç½®ç«¯å£è½¬å‘ã€‚æ‰“å¼€Vagrantfileï¼ŒæŒ‰å¦‚ä¸‹ä¿®æ”¹é…ç½®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.vm.network &quot;forwarded_port&quot;, guest: 8080, host: 8080</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å®ŒVagrantfileåï¼Œéœ€é‡å¯è™šæ‹Ÿæœº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vagrant reload</span><br></pre></td></tr></table></figure><h2 id="Tabbyè¿æ¥è™šæ‹Ÿæœº"><a href="#Tabbyè¿æ¥è™šæ‹Ÿæœº" class="headerlink" title="Tabbyè¿æ¥è™šæ‹Ÿæœº"></a>Tabbyè¿æ¥è™šæ‹Ÿæœº</h2><p>Tabbyæ˜¯ä¸€ä¸ªç±»ç»ˆç«¯çš„sshå®¢æˆ·ç«¯ï¼Œä½¿ç”¨Tabbyè¿æ¥åˆ°è™šæ‹Ÿæœºåï¼Œå¯ä»¥å‘è™šæ‹Ÿæœºä¸Šä¼ æ–‡ä»¶ã€‚æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>è·å–è™šæ‹Ÿæœºçš„SSHä¿¡æ¯</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥Vagrantfileæ‰€åœ¨ç›®å½•</span></span><br><span class="line">vagrant ssh-config</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œä¸Šè¿°å‘½ä»¤ï¼Œå°†å¾—åˆ°è¿æ¥è™šæ‹Ÿæœºæ‰€éœ€çš„sshä¿¡æ¯ï¼š</span></span><br><span class="line">Host default</span><br><span class="line">  HostName 127.0.0.1</span><br><span class="line">  User vagrant</span><br><span class="line">  Port 2222</span><br><span class="line">  IdentityFile /path/to/private_key</span><br></pre></td></tr></table></figure><ol start="2"><li>é…ç½®Tabbyè¿æ¥</li></ol><blockquote><p>åœ¨ Tabby ä¸­ï¼Œç‚¹å‡» <code>Profiles</code> -&gt; <code>New Profile</code>ã€‚</p><p>åœ¨ <code>Connection</code> é€‰é¡¹å¡ä¸­è®¾ç½®ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ul><li><strong>Host:</strong> <code>127.0.0.1</code> ï¼ˆä» <code>vagrant ssh-config</code> ä¸­è·å–çš„ <code>HostName</code>ï¼‰</li><li><strong>Port:</strong> <code>2222</code> ï¼ˆä» <code>vagrant ssh-config</code> ä¸­è·å–çš„ <code>Port</code>ï¼‰</li><li><strong>User:</strong> <code>vagrant</code> ï¼ˆä» <code>vagrant ssh-config</code> ä¸­è·å–çš„ <code>User</code>ï¼‰</li><li><strong>Private Key</strong>: é€‰æ‹© <code>IdentityFile</code> çš„è·¯å¾„ï¼ˆä» <code>vagrant ssh-config</code> ä¸­è·å–çš„ <code>/path/to/private_key</code>ï¼‰ã€‚</li></ul></blockquote><img src="/post/f8d4142b/Tabby%E8%BF%9E%E6%8E%A5%E8%99%9A%E6%8B%9F%E6%9C%BA.png" class=""><ol start="3"><li><p>ä¸Šä¼ æ–‡ä»¶</p><p>å¦‚æœä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¸Šä¼ å¤±è´¥ï¼Œè¯·æ³¨æ„vagrantå¯¹è™šæ‹Ÿæœºä¸­çš„ç›®çš„è·¯å¾„æ˜¯å¦æœ‰å†™æƒé™ï¼Œå¦‚æœæ²¡æœ‰ï¼Œéœ€è¦ç”¨chmodå’Œchownå‘½ä»¤ä¿®æ”¹æ–‡ä»¶çš„å±æ€§ä»¥è·å¾—å†™æƒé™ã€‚</p><ul><li><p>å›¾å½¢ç•Œé¢åŒ–æ–¹å¼</p><img src="/post/f8d4142b/Tabby%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%88%B0%E8%99%9A%E6%8B%9F%E6%9C%BA.png" class=""></li><li><p>å‘½ä»¤è¡Œæ–¹å¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /path/to/private_key è¿æ¥è™šæ‹Ÿæœºçš„sshä¿¡æ¯ä¸­çš„IdentityFile</span></span><br><span class="line"><span class="comment"># /Users/yourname/Documents/example.txt å®¿ä¸»æœºæ–‡ä»¶è·¯å¾„</span></span><br><span class="line">scp -i /path/to/private_key -P 2222 /Users/yourname/Documents/example.txt vagrant@127.0.0.1:/home/vagrant/</span><br></pre></td></tr></table></figure><p>PSï¼šè¯¥å‘½ä»¤åœ¨å®¿ä¸»æœºå‘½ä»¤è¡Œç»ˆç«¯ä¸­æ‰§è¡Œ</p></li></ul></li></ol><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><h3 id="é—®é¢˜1"><a href="#é—®é¢˜1" class="headerlink" title="é—®é¢˜1"></a>é—®é¢˜1</h3><img src="/post/f8d4142b/image-20241027114900897.png" class="" title="image-20241027114900897"><p>è§£å†³æ–¹æ³•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br><span class="line">sed -i <span class="string">&#x27;s/mirrorlist/#mirrorlist/g&#x27;</span> /etc/yum.repos.d/CentOS-*</span><br><span class="line">sed -i <span class="string">&#x27;s|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g&#x27;</span> /etc/yum.repos.d/CentOS-*</span><br></pre></td></tr></table></figure><h3 id="é—®é¢˜2"><a href="#é—®é¢˜2" class="headerlink" title="é—®é¢˜2"></a>é—®é¢˜2</h3><img src="/post/f8d4142b/image-20241027115202371.png" class="" title="image-20241027115202371"><p>è§£å†³æ–¹æ³•ï¼šä½¿ç”¨é˜¿é‡Œäº‘é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><h3 id="é—®é¢˜3"><a href="#é—®é¢˜3" class="headerlink" title="é—®é¢˜3"></a>é—®é¢˜3</h3><img src="/post/f8d4142b/image-20241027135816837.png" class="" title="image-20241027135816837"><p>è§£å†³æ–¹æ³•ï¼šæ·»åŠ é•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;https://xxx.mirror.aliyuncs.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>,</span><br><span class="line">        <span class="string">&quot;https://docker.m.daocloud.io&quot;</span>,</span><br><span class="line">        <span class="string">&quot;https://dockerproxy.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;https://docker.nju.edu.cn&quot;</span>,</span><br><span class="line">        <span class="string">&quot;http://hammal.staronearth.win/&quot;</span>,</span><br><span class="line">        <span class="string">&quot;http://hub.staronearth.win/&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      <categories>
          
          <category> è™šæ‹Ÿæœº </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vagrant </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bug checklist</title>
      <link href="/post/7c4f87d.html"/>
      <url>/post/7c4f87d.html</url>
      
        <content type="html"><![CDATA[<h2 id="jpa"><a href="#jpa" class="headerlink" title="jpa"></a>jpa</h2><h3 id="jpa-æ•°ç»„è¶Šç•Œå¼‚å¸¸"><a href="#jpa-æ•°ç»„è¶Šç•Œå¼‚å¸¸" class="headerlink" title="jpa æ•°ç»„è¶Šç•Œå¼‚å¸¸"></a>jpa æ•°ç»„è¶Šç•Œå¼‚å¸¸</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Type</span> &#123;</span><br><span class="line">    A,</span><br><span class="line">    B</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@Enumerated</span></span><br><span class="line">    <span class="keyword">private</span> Type type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡è®¾è¡¨é‡Œå­˜åœ¨ä¸€æ¡æ•°æ®ï¼Œ<code>type</code> åˆ—çš„å€¼ä¸º2ï¼Œåœ¨ä½¿ç”¨JPAæŸ¥è¯¢æ•°æ®è¿™æ¡æ•°æ®æ—¶ä¼šæŠ¥æ•°ç»„è¶Šç•Œå¼‚å¸¸ï¼Œå…·ä½“æŠ¥é”™å¦‚ï¼š<code>nested exception is java.lang.ArrayIndexOutOfBoundsException: Index 2 out of bounds for length 2</code></p><p>æŠ¥é”™çš„åŸå› æ˜¯ <code>Type</code> çš„ <code>ordinal</code> èŒƒå›´æ˜¯[0, 1]ï¼Œ2ä¸åœ¨èŒƒå›´å†…ã€‚</p><h3 id="jpa-ç¼“å­˜é—®é¢˜"><a href="#jpa-ç¼“å­˜é—®é¢˜" class="headerlink" title="jpa ç¼“å­˜é—®é¢˜"></a>jpa ç¼“å­˜é—®é¢˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CanvasInstanceDataObject</span> &#123;</span><br><span class="line">    <span class="comment">// å…¶ä»–å­—æ®µ</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@CreatedDate</span></span><br><span class="line">    <span class="meta">@Column(updatable = false)</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;)</span></span><br><span class="line">    <span class="keyword">protected</span> Date createdAt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@LastModifiedDate</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;)</span></span><br><span class="line">    <span class="keyword">protected</span> Date updatedAt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_canvas_instance` (</span><br><span class="line">  `created_at` datetime(<span class="number">6</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `updated_at` datetime(<span class="number">6</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>é—®é¢˜èƒŒæ™¯ï¼šæŸå¼ è¡¨åŠå…¶å¯¹åº”çš„å®ä½“ç±»å®šä¹‰å¦‚ä¸Šï¼Œä»£ç ä¸­æ‰§è¡Œè¯­å¥ <code>DataObject dataObject = canvasInstanceGateway.save(dataObject);</code> ï¼Œ<code>dataObject</code> çš„ <code>createdAt</code> å­—æ®µæ ¼å¼ä¸º <code>2025-01-03 16:46:51.876</code>ï¼Œè€Œ <code>updatedAt</code> ä¸º <code>Mon Jan 06 19:55:43 CST 2025</code> ã€‚</p><p>ç»è¿‡æŸ¥è¯¢èµ„æ–™å‘ç° JPA åœ¨è°ƒç”¨ <code>save</code> æ–¹æ³•ä¿å­˜å¯¹è±¡æ—¶ä¼šå°†å¯¹è±¡ç¼“å­˜åœ¨ä¸€çº§ç¼“å­˜ä¸­ï¼Œå¦‚æœä¿å­˜ä¹‹åç«‹å³æŸ¥è¯¢è¯¥å¯¹è±¡ï¼Œä¼šä»ç¼“å­˜ä¸­è·å–æ•°æ®ï¼Œè€Œä¸æ˜¯ä»æ•°æ®åº“ä¸­é‡æ–°æŸ¥è¯¢ã€‚è€Œå†…å­˜ä¸­çš„ <code>dataObject</code> çš„ <code>updatedAt</code> å­—æ®µæ˜¯ <code>Date</code> ç±»å‹ï¼Œåªæœ‰åœ¨çœŸæ­£ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œæ‰ä¼šåºåˆ—åŒ–ä¸ºæ—¶é—´æˆ³ç±»å‹ã€‚ä¸ºäº†ç¡®ä¿ä»æ•°æ®åº“ä¸­é‡æ–°æŸ¥è¯¢æ•°æ®ï¼Œéœ€ä½¿ç”¨ <code>EntityManager</code> çš„ <code>clear</code> æ–¹æ³•æ¥æ¸…ç©ºä¸€çº§ç¼“å­˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CanvasInstanceService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CanvasInstanceRepository repository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PersistenceContext</span></span><br><span class="line">    <span class="keyword">private</span> EntityManager entityManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> CanvasInstanceDataObject <span class="title function_">saveAndFindById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">CanvasInstanceDataObject</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CanvasInstanceDataObject</span>();</span><br><span class="line">        <span class="comment">// è®¾ç½® model çš„å±æ€§</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¿å­˜åˆ°æ•°æ®åº“</span></span><br><span class="line">        <span class="type">CanvasInstanceDataObject</span> <span class="variable">savedModel</span> <span class="operator">=</span> repository.save(model);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¸…ç©ºå®ä½“ç®¡ç†å™¨çš„ç¼“å­˜</span></span><br><span class="line">        entityManager.clear();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»æ•°æ®åº“ä¸­é‡æ–°æŸ¥è¯¢</span></span><br><span class="line">        <span class="type">CanvasInstanceDataObject</span> <span class="variable">foundModel</span> <span class="operator">=</span> repository.findById(id).orElse(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> foundModel;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="jackson"><a href="#jackson" class="headerlink" title="jackson"></a>jackson</h2><h3 id="jackson-åºåˆ—åŒ–ç©ºæŒ‡é’ˆå¼‚å¸¸"><a href="#jackson-åºåˆ—åŒ–ç©ºæŒ‡é’ˆå¼‚å¸¸" class="headerlink" title="jackson åºåˆ—åŒ–ç©ºæŒ‡é’ˆå¼‚å¸¸"></a>jackson åºåˆ—åŒ–ç©ºæŒ‡é’ˆå¼‚å¸¸</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Storage</span> &#123;</span><br><span class="line">    </span><br><span class="line">    String endpoint;</span><br><span class="line"></span><br><span class="line">    String storagePath;</span><br><span class="line"></span><br><span class="line">    String schema;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getRegion</span><span class="params">()</span> &#123;</span><br><span class="line">        String[] parts = endpoint.split(<span class="string">&quot;\\.&quot;</span>);</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨<code>Jackson</code>åºåˆ—åŒ–<code>Storage</code>å¯¹è±¡æ—¶ï¼Œå¦‚æœ<code>endpoint</code>ä¸º<code>null</code>ï¼Œä¼šæŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šä¿®æ”¹å‡½æ•°åï¼Œå¦‚å°†<code>getRegion</code>æ”¹ä¸º<code>resolveRegion</code>ã€‚</p><h3 id="é…ç½®ååºåˆ—åŒ–æ„é€ å‡½æ•°"><a href="#é…ç½®ååºåˆ—åŒ–æ„é€ å‡½æ•°" class="headerlink" title="é…ç½®ååºåˆ—åŒ–æ„é€ å‡½æ•°"></a>é…ç½®ååºåˆ—åŒ–æ„é€ å‡½æ•°</h3><p><code>Jackson</code>ååºåˆ—åŒ–é»˜è®¤éœ€è¦ä¸€ä¸ªæ— å‚æ„é€ å™¨æ¥åˆ›å»ºå¯¹è±¡ï¼Œä¹‹åå†é€šè¿‡<code>setter</code>æ–¹æ³•è®¾ç½®å¯¹è±¡çš„å±æ€§å€¼ã€‚å¦‚æœç±»æ²¡æœ‰æ— å‚æ„é€ å™¨ï¼Œååºåˆ—åŒ–ä¼šå¤±è´¥ï¼Œå¦‚æœä¸æƒ³æ·»åŠ æ— å‚æ„é€ å™¨ï¼Œå¯ä»¥é€šè¿‡é…ç½®è®©<code>Jackson</code>ç”¨å…¶ä»–æ„é€ å™¨æ¥ååºåˆ—åŒ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonCreator</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(<span class="meta">@JsonProperty(&quot;name&quot;)</span> String name, </span></span><br><span class="line"><span class="params">                  <span class="meta">@JsonProperty(&quot;age&quot;)</span> Integer age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="spring"><a href="#spring" class="headerlink" title="spring"></a>spring</h2><h3 id="ä¾èµ–æ³¨å…¥"><a href="#ä¾èµ–æ³¨å…¥" class="headerlink" title="ä¾èµ–æ³¨å…¥"></a>ä¾èµ–æ³¨å…¥</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>(redisTemplate))</span><br><span class="line">            .addPathPatterns(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">            .excludePathPatterns(</span><br><span class="line">                <span class="string">&quot;/user/code&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/user/login&quot;</span></span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ç¨‹åºä¼šæŠ›å‡ºå¦‚ä¸‹å¼‚å¸¸ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Caused by: org.springframework.beans.factory.BeanNotOfRequiredTypeException: Bean named <span class="string">&#x27;redisTemplate&#x27;</span> is expected to be of <span class="built_in">type</span> <span class="string">&#x27;org.springframework.data.redis.core.StringRedisTemplate&#x27;</span> but was actually of <span class="built_in">type</span> <span class="string">&#x27;org.springframework.data.redis.core.RedisTemplate&#x27;</span></span><br></pre></td></tr></table></figure><p>åŸå› æ˜¯<code>@Resource</code>æ³¨è§£é»˜è®¤æŒ‰åç§°æ³¨å…¥ä¾èµ–å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="java-stream"><a href="#java-stream" class="headerlink" title="java stream"></a>java stream</h2><h3 id="Collectors-toMap"><a href="#Collectors-toMap" class="headerlink" title="Collectors.toMap()"></a><code>Collectors.toMap()</code></h3><p>JDK 8 å¼•å…¥äº† <code>stream</code>ï¼Œæå¤§åœ°ç®€åŒ–äº†æ—¥å¸¸å¼€å‘ä¸­çš„é›†åˆå¤„ç†ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨ä¸å½“ï¼Œä¹Ÿä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œå…¶ä¸­ <code>Collectors.toMap()</code> å°±éœ€è¦è°¨æ…ä½¿ç”¨ã€‚ä¸‹é¢ç®€å•è®°å½•ä¸€ä¸‹ä½¿ç”¨ <code>Collectors.toMap()</code> è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸¤ä¸ªé—®é¢˜ã€‚</p><p>å…ˆå‡†å¤‡ä¸€ä¸ªå®ä½“ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é—®é¢˜1ï¼škeyé‡å¤"><a href="#é—®é¢˜1ï¼škeyé‡å¤" class="headerlink" title="é—®é¢˜1ï¼škeyé‡å¤"></a>é—®é¢˜1ï¼š<code>key</code>é‡å¤</h4><p>å•å…ƒæµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testToMapWithDuplicateKey</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;User&gt; users = Arrays.asList(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1L</span>, <span class="string">&quot;Tom&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1L</span>, <span class="string">&quot;Jerry&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Map&lt;Long, String&gt; map = users.stream().collect(Collectors.toMap(User::getId, User::getName));</span><br><span class="line">    System.out.println(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œæµ‹è¯•æ–¹æ³•ä¼šçœ‹åˆ°å¦‚ä¸‹æŠ¥é”™ï¼š</p><img src="/post/7c4f87d/image-20241015001026308.png" class="" title="image-20241015001026308"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> &lt;T, K, V&gt;</span><br><span class="line">BiConsumer&lt;Map&lt;K, V&gt;, T&gt; <span class="title function_">uniqKeysMapAccumulator</span><span class="params">(Function&lt;? <span class="built_in">super</span> T, ? extends K&gt; keyMapper,</span></span><br><span class="line"><span class="params">                                                Function&lt;? <span class="built_in">super</span> T, ? extends V&gt; valueMapper)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (map, element) -&gt; &#123;</span><br><span class="line">        <span class="type">K</span> <span class="variable">k</span> <span class="operator">=</span> keyMapper.apply(element);</span><br><span class="line">        <span class="type">V</span> <span class="variable">v</span> <span class="operator">=</span> Objects.requireNonNull(valueMapper.apply(element));</span><br><span class="line">        <span class="type">V</span> <span class="variable">u</span> <span class="operator">=</span> map.putIfAbsent(k, v);</span><br><span class="line">        <span class="keyword">if</span> (u != <span class="literal">null</span>) <span class="keyword">throw</span> duplicateKeyException(k, u, v);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç‚¹å‡»è¿›å…¥æŠ¥é”™çš„æºç ï¼Œå¯ä»¥çœ‹åˆ°å¦‚æœ <code>key</code> é‡å¤ï¼Œjdk é»˜è®¤çš„å¤„ç†æ–¹å¼æ˜¯æŠ›å‡ºå¼‚å¸¸ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦ç”¨æˆ·è‡ªå®šä¹‰å¤„ç† <code>key</code> é‡å¤çš„ç­–ç•¥ï¼Œæ¯”å¦‚ç”¨æ–°å€¼è¦†ç›–æ—§å€¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testToMapWithDuplicateKey</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;User&gt; users = Arrays.asList(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1L</span>, <span class="string">&quot;Tom&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1L</span>, <span class="string">&quot;Jerry&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Map&lt;Long, String&gt; map = users.stream().collect(Collectors.toMap(User::getId, User::getName, (oldVal, newVal) -&gt; newVal));</span><br><span class="line">    System.out.println(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é—®é¢˜2ï¼švalueä¸ºnull"><a href="#é—®é¢˜2ï¼švalueä¸ºnull" class="headerlink" title="é—®é¢˜2ï¼švalueä¸ºnull"></a>é—®é¢˜2ï¼š<code>value</code>ä¸º<code>null</code></h4><p>å•å…ƒæµ‹è¯•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testToMapWithNullValue</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;User&gt; users = Arrays.asList(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1L</span>, <span class="string">&quot;Tom&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">2L</span>, <span class="literal">null</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Map&lt;Long, String&gt; map = users.stream().collect(Collectors.toMap(User::getId, User::getName, (oldVal, newVal) -&gt; newVal));</span><br><span class="line">    System.out.println(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œæµ‹è¯•æ–¹æ³•å¯ä»¥çœ‹åˆ°å¦‚ä¸‹æŠ¥é”™ï¼š</p><img src="/post/7c4f87d/image-20241015001918076.png" class="" title="image-20241015001918076"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> V <span class="title function_">merge</span><span class="params">(K key, V value,</span></span><br><span class="line"><span class="params">               BiFunction&lt;? <span class="built_in">super</span> V, ? <span class="built_in">super</span> V, ? extends V&gt; remappingFunction)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿›å…¥æºç ï¼Œå¯ä»¥çœ‹åˆ° jdk åœ¨åˆå¹¶ <code>key</code> ç›¸åŒçš„å…ƒç´ æ—¶ï¼Œå¦‚æœ <code>value</code> ä¸º <code>null</code>ï¼Œä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å…ˆè¿‡æ»¤æ‰ <code>value</code> å¯èƒ½ä¸º <code>null</code> çš„æ•°æ®ï¼Œæˆ–è¿”å›é»˜è®¤å€¼ã€‚</p><p>è¿‡æ»¤æ‰ <code>name</code> ä¸º <code>null</code> çš„æ•°æ®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testToMapWithNullValue</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;User&gt; users = Arrays.asList(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1L</span>, <span class="string">&quot;Tom&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">2L</span>, <span class="literal">null</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Map&lt;Long, String&gt; map = users.stream()</span><br><span class="line">        .filter(user -&gt; user.getName() != <span class="literal">null</span>)</span><br><span class="line">        .collect(Collectors.toMap(User::getId, User::getName, (oldVal, newVal) -&gt; newVal));</span><br><span class="line">    System.out.println(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ <code>name</code> ä¸º <code>null</code>ï¼Œé»˜è®¤è¿”å›ç©ºå­—ç¬¦ä¸²ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testToMapWithNullValue</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;User&gt; users = Arrays.asList(</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1L</span>, <span class="string">&quot;Tom&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">2L</span>, <span class="literal">null</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Map&lt;Long, String&gt; map = users.stream()</span><br><span class="line">        .collect(Collectors.toMap(User::getId, it -&gt; Optional.ofNullable(it.getName()).orElse(<span class="string">&quot;&quot;</span>), (oldVal, newVal) -&gt; newVal));</span><br><span class="line">    System.out.println(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="rabbitmq"><a href="#rabbitmq" class="headerlink" title="rabbitmq"></a>rabbitmq</h2><h3 id="rabbitmq-å¯åŠ¨å¼‚å¸¸"><a href="#rabbitmq-å¯åŠ¨å¼‚å¸¸" class="headerlink" title="rabbitmq å¯åŠ¨å¼‚å¸¸"></a>rabbitmq å¯åŠ¨å¼‚å¸¸</h3><p>é”™è¯¯ä¿¡æ¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">BOOT FAILED</span><br><span class="line">2024-12-08 23:37:59.182161+08:00 [error] &lt;0.215.0&gt;</span><br><span class="line">2024-12-08 23:37:59.182161+08:00 [error] &lt;0.215.0&gt; BOOT FAILED</span><br><span class="line">2024-12-08 23:37:59.182161+08:00 [error] &lt;0.215.0&gt; ===========</span><br><span class="line">2024-12-08 23:37:59.182161+08:00 [error] &lt;0.215.0&gt; Error during startup: &#123;error,failed_to_initialize_feature_flags_registry&#125;</span><br><span class="line">2024-12-08 23:37:59.182161+08:00 [error] &lt;0.215.0&gt;</span><br><span class="line">===========</span><br><span class="line">Error during startup: &#123;error,failed_to_initialize_feature_flags_registry&#125;</span><br><span class="line"></span><br><span class="line">2024-12-08 23:38:00.183638+08:00 [notice] &lt;0.45.0&gt; Application rabbit exited with reason: &#123;failed_to_initialize_feature_flags_registry,&#123;rabbit,start,[normal,[]]&#125;&#125;</span><br><span class="line">&#123;<span class="built_in">exit</span>,terminating,[&#123;application_controller,call,2,[&#123;file,<span class="string">&quot;application_controller.erl&quot;</span>&#125;,&#123;line,511&#125;]&#125;,&#123;application,<span class="string">&#x27;-ensure_all_started/3-lc$^0/1-0-&#x27;</span>,1,[&#123;file,<span class="string">&quot;application.erl&quot;</span>&#125;,&#123;line,367&#125;]&#125;,&#123;application,ensure_all_started,3,[&#123;file,<span class="string">&quot;application.erl&quot;</span>&#125;,&#123;line,367&#125;]&#125;,&#123;rabbit,<span class="string">&#x27;-start_it/1-fun-0-&#x27;</span>,1,[&#123;file,<span class="string">&quot;rabbit.erl&quot;</span>&#125;,&#123;line,430&#125;]&#125;,&#123;timer,tc,2,[&#123;file,<span class="string">&quot;timer.erl&quot;</span>&#125;,&#123;line,590&#125;]&#125;,&#123;rabbit,start_it,1,[&#123;file,<span class="string">&quot;rabbit.erl&quot;</span>&#125;,&#123;line,426&#125;]&#125;,&#123;init,start_it,1,[]&#125;,&#123;init,start_em,1,[]&#125;]&#125;</span><br><span class="line">Runtime terminating during boot (terminating)</span><br></pre></td></tr></table></figure><p>é”™è¯¯åŸå› ï¼šRabbitMQ çš„æ•°æ®ç›®å½•å¯èƒ½å·²ç»æŸåæˆ–è€…ä¸ä¸€è‡´</p><p>è§£å†³æ–¹å¼ï¼šåˆ é™¤ RabbitMQ çš„æ•°æ®ç›®å½•å¹¶é‡å¯æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rf /usr/local/var/lib/rabbitmq/mnesia</span><br><span class="line">brew services start rabbitmq</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>build you own X</title>
      <link href="/post/eb09633c.html"/>
      <url>/post/eb09633c.html</url>
      
        <content type="html"><![CDATA[<h2 id="ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼"><a href="#ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼" class="headerlink" title="ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼"></a>ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼</h2><h2 id="wait-notify"><a href="#wait-notify" class="headerlink" title="wait/notify"></a><code>wait/notify</code></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Buffer</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> data;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">boolean</span> empty;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Buffer</span><span class="params">()</span> &#123;</span><br><span class="line">      empty = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç”Ÿäº§æ•°æ®</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">produce</span><span class="params">(<span class="type">int</span> newData)</span> &#123;</span><br><span class="line">      <span class="keyword">while</span> (!empty) &#123; <span class="comment">// å¦‚æœç¼“å†²åŒºä¸ä¸ºç©ºï¼Œåˆ™ç­‰å¾…</span></span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              wait();</span><br><span class="line">          &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">              e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      data = newData; <span class="comment">// æ”¾å…¥æ•°æ®</span></span><br><span class="line">      empty = <span class="literal">false</span>; <span class="comment">// æ ‡è®°ç¼“å†²åŒºä¸ä¸ºç©º</span></span><br><span class="line">      notify(); <span class="comment">// é€šçŸ¥æ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹æ•°æ®</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¶ˆè´¹æ•°æ®</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">int</span> <span class="title function_">consume</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">while</span> (empty) &#123; <span class="comment">// å¦‚æœç¼“å†²åŒºä¸ºç©ºï¼Œåˆ™ç­‰å¾…</span></span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              wait();</span><br><span class="line">          &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">              e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">int</span> <span class="variable">consumedData</span> <span class="operator">=</span> data; <span class="comment">// å–å‡ºæ•°æ®</span></span><br><span class="line">      empty = <span class="literal">true</span>; <span class="comment">// æ ‡è®°ç¼“å†²åŒºä¸ºç©º</span></span><br><span class="line">      notify(); <span class="comment">// é€šçŸ¥ç”Ÿäº§è€…å¯ä»¥ç”Ÿäº§æ•°æ®</span></span><br><span class="line">      <span class="keyword">return</span> consumedData;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Buffer buffer;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Producer</span><span class="params">(Buffer buffer)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.buffer = buffer;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">          buffer.produce(i);</span><br><span class="line">          System.out.println(<span class="string">&quot;ç”Ÿäº§è€…ç”Ÿäº§äº†æ•°æ®: &quot;</span> + i);</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              Thread.sleep(<span class="number">1000</span>); <span class="comment">// æ¨¡æ‹Ÿç”Ÿäº§è€…ç”Ÿäº§æ•°æ®çš„è€—æ—¶æ“ä½œ</span></span><br><span class="line">          &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">              e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Buffer buffer;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Consumer</span><span class="params">(Buffer buffer)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.buffer = buffer;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">          <span class="type">int</span> <span class="variable">consumedData</span> <span class="operator">=</span> buffer.consume();</span><br><span class="line">          System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…æ¶ˆè´¹äº†æ•°æ®: &quot;</span> + consumedData);</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              Thread.sleep(<span class="number">1500</span>); <span class="comment">// æ¨¡æ‹Ÿæ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®çš„è€—æ—¶æ“ä½œ</span></span><br><span class="line">          &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">              e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">      <span class="type">Buffer</span> <span class="variable">buffer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Buffer</span>();</span><br><span class="line">      <span class="type">Producer</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Producer</span>(buffer);</span><br><span class="line">      <span class="type">Consumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Consumer</span>(buffer);</span><br><span class="line"></span><br><span class="line">      <span class="type">Thread</span> <span class="variable">producerThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(producer);</span><br><span class="line">      <span class="type">Thread</span> <span class="variable">consumerThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(consumer);</span><br><span class="line"></span><br><span class="line">      producerThread.start();</span><br><span class="line">      consumerThread.start();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="await-signal"><a href="#await-signal" class="headerlink" title="await/signal"></a><code>await/signal</code></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Buffer</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Queue&lt;Integer&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="variable">maxSize</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">  <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">notEmpty</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">  <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">notFull</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">produce</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">      lock.lock();</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">while</span> (queue.size() == maxSize) &#123;</span><br><span class="line">              <span class="comment">// ç¼“å†²åŒºå·²æ»¡ï¼Œç”Ÿäº§è€…ç­‰å¾…</span></span><br><span class="line">              notFull.await();</span><br><span class="line">          &#125;</span><br><span class="line">          queue.add(num);</span><br><span class="line">          System.out.println(<span class="string">&quot;Produced: &quot;</span> + num);</span><br><span class="line">          notEmpty.signal(); <span class="comment">// é€šçŸ¥æ¶ˆè´¹è€…ç¼“å†²åŒºä¸ä¸ºç©º</span></span><br><span class="line">      &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          lock.unlock();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">consume</span><span class="params">()</span> &#123;</span><br><span class="line">      lock.lock();</span><br><span class="line">      <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">while</span> (queue.isEmpty()) &#123;</span><br><span class="line">              <span class="comment">// ç¼“å†²åŒºä¸ºç©ºï¼Œæ¶ˆè´¹è€…ç­‰å¾…</span></span><br><span class="line">              notEmpty.await();</span><br><span class="line">          &#125;</span><br><span class="line">          num = queue.poll();</span><br><span class="line">          System.out.println(<span class="string">&quot;Consumed: &quot;</span> + num);</span><br><span class="line">          notFull.signal(); <span class="comment">// é€šçŸ¥ç”Ÿäº§è€…ç¼“å†²åŒºä¸æ»¡</span></span><br><span class="line">      &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          lock.unlock();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> num;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç®¡é“"><a href="#ç®¡é“" class="headerlink" title="ç®¡é“"></a>ç®¡é“</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PipedInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.PipedOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerConsumerExample</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">      <span class="type">PipedInputStream</span> <span class="variable">pipedInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PipedInputStream</span>();</span><br><span class="line">      <span class="type">PipedOutputStream</span> <span class="variable">pipedOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PipedOutputStream</span>();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å°†ç®¡é“è¾“å…¥æµå’Œç®¡é“è¾“å‡ºæµå…³è”èµ·æ¥</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          pipedInputStream.connect(pipedOutputStream);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ›å»ºç”Ÿäº§è€…çº¿ç¨‹å’Œæ¶ˆè´¹è€…çº¿ç¨‹</span></span><br><span class="line">      <span class="type">Thread</span> <span class="variable">producerThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Producer</span>(pipedOutputStream));</span><br><span class="line">      <span class="type">Thread</span> <span class="variable">consumerThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Consumer</span>(pipedInputStream));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¯åŠ¨ç”Ÿäº§è€…çº¿ç¨‹å’Œæ¶ˆè´¹è€…çº¿ç¨‹</span></span><br><span class="line">      producerThread.start();</span><br><span class="line">      consumerThread.start();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">      <span class="keyword">private</span> PipedOutputStream pipedOutputStream;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> <span class="title function_">Producer</span><span class="params">(PipedOutputStream pipedOutputStream)</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.pipedOutputStream = pipedOutputStream;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="comment">// ç”Ÿäº§è€…å‘ç®¡é“å†™å…¥æ•°æ®</span></span><br><span class="line">              <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">                  <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="string">&quot;Data &quot;</span> + i;</span><br><span class="line">                  pipedOutputStream.write(data.getBytes());</span><br><span class="line">                  System.out.println(<span class="string">&quot;Produced: &quot;</span> + data);</span><br><span class="line">              &#125;</span><br><span class="line">              pipedOutputStream.close();</span><br><span class="line">          &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">              e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">      <span class="keyword">private</span> PipedInputStream pipedInputStream;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> <span class="title function_">Consumer</span><span class="params">(PipedInputStream pipedInputStream)</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.pipedInputStream = pipedInputStream;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="comment">// æ¶ˆè´¹è€…ä»ç®¡é“è¯»å–æ•°æ®</span></span><br><span class="line">              <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">              <span class="type">int</span> bytesRead;</span><br><span class="line">              <span class="keyword">while</span> ((bytesRead = pipedInputStream.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                  <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(buffer, <span class="number">0</span>, bytesRead);</span><br><span class="line">                  System.out.println(<span class="string">&quot;Consumed: &quot;</span> + data);</span><br><span class="line">              &#125;</span><br><span class="line">              pipedInputStream.close();</span><br><span class="line">          &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">              e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é˜»å¡é˜Ÿåˆ—"><a href="#é˜»å¡é˜Ÿåˆ—" class="headerlink" title="é˜»å¡é˜Ÿåˆ—"></a>é˜»å¡é˜Ÿåˆ—</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.BlockingQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerConsumerExample</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">      <span class="comment">// åˆ›å»ºä¸€ä¸ªå®¹é‡ä¸º10çš„é˜»å¡é˜Ÿåˆ—</span></span><br><span class="line">      BlockingQueue&lt;String&gt; blockingQueue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ›å»ºç”Ÿäº§è€…çº¿ç¨‹å’Œæ¶ˆè´¹è€…çº¿ç¨‹</span></span><br><span class="line">      <span class="type">Thread</span> <span class="variable">producerThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Producer</span>(blockingQueue));</span><br><span class="line">      <span class="type">Thread</span> <span class="variable">consumerThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Consumer</span>(blockingQueue));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¯åŠ¨ç”Ÿäº§è€…çº¿ç¨‹å’Œæ¶ˆè´¹è€…çº¿ç¨‹</span></span><br><span class="line">      producerThread.start();</span><br><span class="line">      consumerThread.start();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">      <span class="keyword">private</span> BlockingQueue&lt;String&gt; blockingQueue;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> <span class="title function_">Producer</span><span class="params">(BlockingQueue&lt;String&gt; blockingQueue)</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.blockingQueue = blockingQueue;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="comment">// ç”Ÿäº§è€…å‘é˜»å¡é˜Ÿåˆ—æ·»åŠ æ•°æ®</span></span><br><span class="line">              <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">                  <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="string">&quot;Data &quot;</span> + i;</span><br><span class="line">                  blockingQueue.put(data);</span><br><span class="line">                  System.out.println(<span class="string">&quot;Produced: &quot;</span> + data);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">              e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">      <span class="keyword">private</span> BlockingQueue&lt;String&gt; blockingQueue;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> <span class="title function_">Consumer</span><span class="params">(BlockingQueue&lt;String&gt; blockingQueue)</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.blockingQueue = blockingQueue;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="comment">// æ¶ˆè´¹è€…ä»é˜»å¡é˜Ÿåˆ—å–å‡ºæ•°æ®</span></span><br><span class="line">              <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                  <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> blockingQueue.take();</span><br><span class="line">                  System.out.println(<span class="string">&quot;Consumed: &quot;</span> + data);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">              e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="semaphore"><a href="#semaphore" class="headerlink" title="semaphore"></a><code>semaphore</code></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.Semaphore;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerConsumerExample</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">      <span class="comment">// åˆ›å»ºä¸€ä¸ªåˆå§‹è®¡æ•°ä¸º0çš„ Semaphoreï¼Œç”¨äºæ§åˆ¶ç”Ÿäº§è€…çº¿ç¨‹çš„è®¿é—®</span></span><br><span class="line">      <span class="type">Semaphore</span> <span class="variable">producerSemaphore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="comment">// åˆ›å»ºä¸€ä¸ªåˆå§‹è®¡æ•°ä¸º1çš„ Semaphoreï¼Œç”¨äºæ§åˆ¶æ¶ˆè´¹è€…çº¿ç¨‹çš„è®¿é—®</span></span><br><span class="line">      <span class="type">Semaphore</span> <span class="variable">consumerSemaphore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ›å»ºç”Ÿäº§è€…çº¿ç¨‹å’Œæ¶ˆè´¹è€…çº¿ç¨‹</span></span><br><span class="line">      <span class="type">Thread</span> <span class="variable">producerThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Producer</span>(producerSemaphore, consumerSemaphore));</span><br><span class="line">      <span class="type">Thread</span> <span class="variable">consumerThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Consumer</span>(producerSemaphore, consumerSemaphore));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¯åŠ¨ç”Ÿäº§è€…çº¿ç¨‹å’Œæ¶ˆè´¹è€…çº¿ç¨‹</span></span><br><span class="line">      producerThread.start();</span><br><span class="line">      consumerThread.start();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">      <span class="keyword">private</span> Semaphore producerSemaphore;</span><br><span class="line">      <span class="keyword">private</span> Semaphore consumerSemaphore;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> <span class="title function_">Producer</span><span class="params">(Semaphore producerSemaphore, Semaphore consumerSemaphore)</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.producerSemaphore = producerSemaphore;</span><br><span class="line">          <span class="built_in">this</span>.consumerSemaphore = consumerSemaphore;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="comment">// ç”Ÿäº§è€…çº¿ç¨‹ç”Ÿäº§æ•°æ®</span></span><br><span class="line">              <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">                  Thread.sleep(<span class="number">1000</span>); <span class="comment">// æ¨¡æ‹Ÿç”Ÿäº§è€—æ—¶</span></span><br><span class="line">                  System.out.println(<span class="string">&quot;Produced: Data &quot;</span> + i);</span><br><span class="line">                  producerSemaphore.release(); <span class="comment">// å¢åŠ  producerSemaphore çš„è®¡æ•°</span></span><br><span class="line">                  consumerSemaphore.acquire(); <span class="comment">// è·å– consumerSemaphore çš„è®¸å¯</span></span><br><span class="line">              &#125;</span><br><span class="line">          &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">              e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">      <span class="keyword">private</span> Semaphore producerSemaphore;</span><br><span class="line">      <span class="keyword">private</span> Semaphore consumerSemaphore;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> <span class="title function_">Consumer</span><span class="params">(Semaphore producerSemaphore, Semaphore consumerSemaphore)</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.producerSemaphore = producerSemaphore;</span><br><span class="line">          <span class="built_in">this</span>.consumerSemaphore = consumerSemaphore;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="comment">// æ¶ˆè´¹è€…çº¿ç¨‹æ¶ˆè´¹æ•°æ®</span></span><br><span class="line">              <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">                  consumerSemaphore.acquire(); <span class="comment">// è·å– consumerSemaphore çš„è®¸å¯</span></span><br><span class="line">                  Thread.sleep(<span class="number">1000</span>); <span class="comment">// æ¨¡æ‹Ÿæ¶ˆè´¹è€—æ—¶</span></span><br><span class="line">                  System.out.println(<span class="string">&quot;Consumed: Data &quot;</span> + i);</span><br><span class="line">                  producerSemaphore.release(); <span class="comment">// å¢åŠ  producerSemaphore çš„è®¡æ•°</span></span><br><span class="line">              &#125;</span><br><span class="line">          &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">              e.printStackTrace();</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><script type="text&#x2F;javascript" src="https://unpkg.com/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://unpkg.com/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://unpkg.com/hexo-simple-mindmap@0.8.0/dist/mindmap.min.css">]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
